/*! For license information please see psychojs-2023.2.2.js.LEGAL.txt */
var PsychoJS=(()=>{var __create=Object.create;var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropNames=Object.getOwnPropertyNames,__getOwnPropSymbols=Object.getOwnPropertySymbols,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),__markAsModule=target=>__defProp(target,"__esModule",{value:!0});var __objRest=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(source))exclude.indexOf(prop)<0&&__propIsEnum.call(source,prop)&&(target[prop]=source[prop]);return target};var __commonJS=(cb,mod)=>function(){return mod||(0,cb[Object.keys(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},__export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__reExport=(target,module2,desc)=>{if(module2&&typeof module2=="object"||typeof module2=="function")for(let key of __getOwnPropNames(module2))!__hasOwnProp.call(target,key)&&key!=="default"&&__defProp(target,key,{get:()=>module2[key],enumerable:!(desc=__getOwnPropDesc(module2,key))||desc.enumerable});return target},__toModule=module2=>__reExport(__markAsModule(__defProp(module2!=null?__create(__getProtoOf(module2)):{},"default",module2&&module2.__esModule&&"default"in module2?{get:()=>module2.default,enumerable:!0}:{value:module2,enumerable:!0})),module2);var __publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value),__accessCheck=(obj,member,msg)=>{if(!member.has(obj))throw TypeError("Cannot "+msg)};var __privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),__privateAdd=(obj,member,value)=>{if(member.has(obj))throw TypeError("Cannot add the same private member more than once");member instanceof WeakSet?member.add(obj):member.set(obj,value)};var require_alea=__commonJS({"node_modules/seedrandom/lib/alea.js"(exports2,module2){(function(global2,module3,define2){function Alea(seed){var me=this,mash=Mash();me.next=function(){var t=2091639*me.s0+me.c*23283064365386963e-26;return me.s0=me.s1,me.s1=me.s2,me.s2=t-(me.c=t|0)},me.c=1,me.s0=mash(" "),me.s1=mash(" "),me.s2=mash(" "),me.s0-=mash(seed),me.s0<0&&(me.s0+=1),me.s1-=mash(seed),me.s1<0&&(me.s1+=1),me.s2-=mash(seed),me.s2<0&&(me.s2+=1),mash=null}function copy(f,t){return t.c=f.c,t.s0=f.s0,t.s1=f.s1,t.s2=f.s2,t}function impl(seed,opts){var xg=new Alea(seed),state=opts&&opts.state,prng=xg.next;return prng.int32=function(){return xg.next()*4294967296|0},prng.double=function(){return prng()+(prng()*2097152|0)*11102230246251565e-32},prng.quick=prng,state&&(typeof state=="object"&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}function Mash(){var n=4022871197,mash=function(data){data=String(data);for(var i=0;i<data.length;i++){n+=data.charCodeAt(i);var h=.02519603282416938*n;n=h>>>0,h-=n,h*=n,n=h>>>0,h-=n,n+=h*4294967296}return(n>>>0)*23283064365386963e-26};return mash}module3&&module3.exports?module3.exports=impl:define2&&define2.amd?define2(function(){return impl}):this.alea=impl})(exports2,typeof module2=="object"&&module2,typeof define=="function"&&define)}});var require_xor128=__commonJS({"node_modules/seedrandom/lib/xor128.js"(exports2,module2){(function(global2,module3,define2){function XorGen(seed){var me=this,strseed="";me.x=0,me.y=0,me.z=0,me.w=0,me.next=function(){var t=me.x^me.x<<11;return me.x=me.y,me.y=me.z,me.z=me.w,me.w^=me.w>>>19^t^t>>>8},seed===(seed|0)?me.x=seed:strseed+=seed;for(var k=0;k<strseed.length+64;k++)me.x^=strseed.charCodeAt(k)|0,me.next()}function copy(f,t){return t.x=f.x,t.y=f.y,t.z=f.z,t.w=f.w,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21);while(result===0);return result},prng.int32=xg.next,prng.quick=prng,state&&(typeof state=="object"&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module3&&module3.exports?module3.exports=impl:define2&&define2.amd?define2(function(){return impl}):this.xor128=impl})(exports2,typeof module2=="object"&&module2,typeof define=="function"&&define)}});var require_xorwow=__commonJS({"node_modules/seedrandom/lib/xorwow.js"(exports2,module2){(function(global2,module3,define2){function XorGen(seed){var me=this,strseed="";me.next=function(){var t=me.x^me.x>>>2;return me.x=me.y,me.y=me.z,me.z=me.w,me.w=me.v,(me.d=me.d+362437|0)+(me.v=me.v^me.v<<4^(t^t<<1))|0},me.x=0,me.y=0,me.z=0,me.w=0,me.v=0,seed===(seed|0)?me.x=seed:strseed+=seed;for(var k=0;k<strseed.length+64;k++)me.x^=strseed.charCodeAt(k)|0,k==strseed.length&&(me.d=me.x<<10^me.x>>>4),me.next()}function copy(f,t){return t.x=f.x,t.y=f.y,t.z=f.z,t.w=f.w,t.v=f.v,t.d=f.d,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21);while(result===0);return result},prng.int32=xg.next,prng.quick=prng,state&&(typeof state=="object"&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module3&&module3.exports?module3.exports=impl:define2&&define2.amd?define2(function(){return impl}):this.xorwow=impl})(exports2,typeof module2=="object"&&module2,typeof define=="function"&&define)}});var require_xorshift7=__commonJS({"node_modules/seedrandom/lib/xorshift7.js"(exports2,module2){(function(global2,module3,define2){function XorGen(seed){var me=this;me.next=function(){var X=me.x,i=me.i,t,v,w;return t=X[i],t^=t>>>7,v=t^t<<24,t=X[i+1&7],v^=t^t>>>10,t=X[i+3&7],v^=t^t>>>3,t=X[i+4&7],v^=t^t<<7,t=X[i+7&7],t=t^t<<13,v^=t^t<<9,X[i]=v,me.i=i+1&7,v};function init8(me2,seed2){var j,w,X=[];if(seed2===(seed2|0))w=X[0]=seed2;else for(seed2=""+seed2,j=0;j<seed2.length;++j)X[j&7]=X[j&7]<<15^seed2.charCodeAt(j)+X[j+1&7]<<13;for(;X.length<8;)X.push(0);for(j=0;j<8&&X[j]===0;++j);for(j==8?w=X[7]=-1:w=X[j],me2.x=X,me2.i=0,j=256;j>0;--j)me2.next()}init8(me,seed)}function copy(f,t){return t.x=f.x.slice(),t.i=f.i,t}function impl(seed,opts){seed==null&&(seed=+new Date);var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21);while(result===0);return result},prng.int32=xg.next,prng.quick=prng,state&&(state.x&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module3&&module3.exports?module3.exports=impl:define2&&define2.amd?define2(function(){return impl}):this.xorshift7=impl})(exports2,typeof module2=="object"&&module2,typeof define=="function"&&define)}});var require_xor4096=__commonJS({"node_modules/seedrandom/lib/xor4096.js"(exports2,module2){(function(global2,module3,define2){function XorGen(seed){var me=this;me.next=function(){var w=me.w,X=me.X,i=me.i,t,v;return me.w=w=w+1640531527|0,v=X[i+34&127],t=X[i=i+1&127],v^=v<<13,t^=t<<17,v^=v>>>15,t^=t>>>12,v=X[i]=v^t,me.i=i,v+(w^w>>>16)|0};function init8(me2,seed2){var t,v,i,j,w,X=[],limit=128;for(seed2===(seed2|0)?(v=seed2,seed2=null):(seed2=seed2+"\0",v=0,limit=Math.max(limit,seed2.length)),i=0,j=-32;j<limit;++j)seed2&&(v^=seed2.charCodeAt((j+32)%seed2.length)),j===0&&(w=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,j>=0&&(w=w+1640531527|0,t=X[j&127]^=v+w,i=t==0?i+1:0);for(i>=128&&(X[(seed2&&seed2.length||0)&127]=-1),i=127,j=4*128;j>0;--j)v=X[i+34&127],t=X[i=i+1&127],v^=v<<13,t^=t<<17,v^=v>>>15,t^=t>>>12,X[i]=v^t;me2.w=w,me2.X=X,me2.i=i}init8(me,seed)}function copy(f,t){return t.i=f.i,t.w=f.w,t.X=f.X.slice(),t}function impl(seed,opts){seed==null&&(seed=+new Date);var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21);while(result===0);return result},prng.int32=xg.next,prng.quick=prng,state&&(state.X&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module3&&module3.exports?module3.exports=impl:define2&&define2.amd?define2(function(){return impl}):this.xor4096=impl})(exports2,typeof module2=="object"&&module2,typeof define=="function"&&define)}});var require_tychei=__commonJS({"node_modules/seedrandom/lib/tychei.js"(exports2,module2){(function(global2,module3,define2){function XorGen(seed){var me=this,strseed="";me.next=function(){var b=me.b,c=me.c,d=me.d,a=me.a;return b=b<<25^b>>>7^c,c=c-d|0,d=d<<24^d>>>8^a,a=a-b|0,me.b=b=b<<20^b>>>12^c,me.c=c=c-d|0,me.d=d<<16^c>>>16^a,me.a=a-b|0},me.a=0,me.b=0,me.c=2654435769|0,me.d=1367130551,seed===Math.floor(seed)?(me.a=seed/4294967296|0,me.b=seed|0):strseed+=seed;for(var k=0;k<strseed.length+20;k++)me.b^=strseed.charCodeAt(k)|0,me.next()}function copy(f,t){return t.a=f.a,t.b=f.b,t.c=f.c,t.d=f.d,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21);while(result===0);return result},prng.int32=xg.next,prng.quick=prng,state&&(typeof state=="object"&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module3&&module3.exports?module3.exports=impl:define2&&define2.amd?define2(function(){return impl}):this.tychei=impl})(exports2,typeof module2=="object"&&module2,typeof define=="function"&&define)}});var require_crypto=__commonJS({"(disabled):crypto"(){}});var require_seedrandom=__commonJS({"node_modules/seedrandom/seedrandom.js"(exports2,module2){(function(global2,pool,math){var width=256,chunks=6,digits=52,rngname="random",startdenom=math.pow(width,chunks),significance=math.pow(2,digits),overflow=significance*2,mask=width-1,nodecrypto;function seedrandom4(seed,options,callback){var key=[];options=options==!0?{entropy:!0}:options||{};var shortseed=mixkey(flatten(options.entropy?[seed,tostring(pool)]:seed==null?autoseed():seed,3),key),arc4=new ARC4(key),prng=function(){for(var n=arc4.g(chunks),d=startdenom,x=0;n<significance;)n=(n+x)*width,d*=width,x=arc4.g(1);for(;n>=overflow;)n/=2,d/=2,x>>>=1;return(n+x)/d};return prng.int32=function(){return arc4.g(4)|0},prng.quick=function(){return arc4.g(4)/4294967296},prng.double=prng,mixkey(tostring(arc4.S),pool),(options.pass||callback||function(prng2,seed2,is_math_call,state){return state&&(state.S&&copy(state,arc4),prng2.state=function(){return copy(arc4,{})}),is_math_call?(math[rngname]=prng2,seed2):prng2})(prng,shortseed,"global"in options?options.global:this==math,options.state)}function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];for(keylen||(key=[keylen++]);i<width;)s[i]=i++;for(i=0;i<width;i++)s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])],s[j]=t;(me.g=function(count2){for(var t2,r=0,i2=me.i,j2=me.j,s2=me.S;count2--;)t2=s2[i2=mask&i2+1],r=r*width+s2[mask&(s2[i2]=s2[j2=mask&j2+t2])+(s2[j2]=t2)];return me.i=i2,me.j=j2,r})(width)}function copy(f,t){return t.i=f.i,t.j=f.j,t.S=f.S.slice(),t}function flatten(obj,depth){var result=[],typ=typeof obj,prop;if(depth&&typ=="object")for(prop in obj)try{result.push(flatten(obj[prop],depth-1))}catch(e){}return result.length?result:typ=="string"?obj:obj+"\0"}function mixkey(seed,key){for(var stringseed=seed+"",smear,j=0;j<stringseed.length;)key[mask&j]=mask&(smear^=key[mask&j]*19)+stringseed.charCodeAt(j++);return tostring(key)}function autoseed(){try{var out;return nodecrypto&&(out=nodecrypto.randomBytes)?out=out(width):(out=new Uint8Array(width),(global2.crypto||global2.msCrypto).getRandomValues(out)),tostring(out)}catch(e){var browser=global2.navigator,plugins=browser&&browser.plugins;return[+new Date,global2,plugins,global2.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}if(mixkey(math.random(),pool),typeof module2=="object"&&module2.exports){module2.exports=seedrandom4;try{nodecrypto=require_crypto()}catch(ex){}}else typeof define=="function"&&define.amd?define(function(){return seedrandom4}):math["seed"+rngname]=seedrandom4})(typeof self!="undefined"?self:exports2,[],Math)}});var require_seedrandom2=__commonJS({"node_modules/seedrandom/index.js"(exports2,module2){var alea=require_alea(),xor128=require_xor128(),xorwow=require_xorwow(),xorshift7=require_xorshift7(),xor4096=require_xor4096(),tychei=require_tychei(),sr=require_seedrandom();sr.alea=alea;sr.xor128=xor128;sr.xorwow=xorwow;sr.xorshift7=xorshift7;sr.xor4096=xor4096;sr.tychei=tychei;module2.exports=sr}});var require_object_assign=__commonJS({"node_modules/object-assign/index.js"(exports2,module2){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty2=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de",Object.getOwnPropertyNames(test1)[0]==="5")return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789")return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),Object.keys(Object.assign({},test3)).join("")==="abcdefghijklmnopqrst"}catch(err){return!1}}module2.exports=shouldUseNative()?Object.assign:function(target,source){for(var from,to=toObject(target),symbols,s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from)hasOwnProperty2.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}}});var require_eventemitter3=__commonJS({"node_modules/eventemitter3/index.js"(exports2,module2){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(prefix=!1));function EE(fn,context4,once){this.fn=fn,this.context=context4,this.once=once||!1}function addListener(emitter,event,fn,context4,once){if(typeof fn!="function")throw new TypeError("The listener must be a function");var listener=new EE(fn,context4||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){--emitter._eventsCount==0?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter2(){this._events=new Events,this._eventsCount=0}EventEmitter2.prototype.eventNames=function(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names};EventEmitter2.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee};EventEmitter2.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0};EventEmitter2.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var listeners=this._events[evt],len2=arguments.length,args,i;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len2){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len2-1);i<len2;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len2){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len2-1);j<len2;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0};EventEmitter2.prototype.on=function(event,fn,context4){return addListener(this,event,fn,context4,!1)};EventEmitter2.prototype.once=function(event,fn,context4){return addListener(this,event,fn,context4,!0)};EventEmitter2.prototype.removeListener=function(event,fn,context4,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn===fn&&(!once||listeners.once)&&(!context4||listeners.context===context4)&&clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context4&&listeners[i].context!==context4)&&events.push(listeners[i]);events.length?this._events[evt]=events.length===1?events[0]:events:clearEvent(this,evt)}return this};EventEmitter2.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this};EventEmitter2.prototype.off=EventEmitter2.prototype.removeListener;EventEmitter2.prototype.addListener=EventEmitter2.prototype.on;EventEmitter2.prefixed=prefix;EventEmitter2.EventEmitter=EventEmitter2;typeof module2!="undefined"&&(module2.exports=EventEmitter2)}});var require_earcut=__commonJS({"node_modules/earcut/src/earcut.js"(exports2,module2){"use strict";module2.exports=earcut;module2.exports.default=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles&&(outerNode=eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)x=data[i],y=data[i+1],x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=Math.max(maxX-minX,maxY-minY),invSize=invSize!==0?32767/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0),triangles}function linkedList(data,start2,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start2,end,dim)>0)for(i=start2;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start2;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start2,end){if(!start2)return start2;end||(end=start2);var p=start2,again;do if(again=!1,!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){if(removeNode(p),p=end=p.prev,p===p.next)break;again=!0}else p=p.next;while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!!ear){!pass&&invSize&&indexCurve(ear,minX,minY,invSize);for(var stop=ear,prev,next;ear.prev!==ear.next;){if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i/dim|0),triangles.push(ear.i/dim|0),triangles.push(next.i/dim|0),removeNode(ear),ear=next.next,stop=next.next;continue}if(ear=next,ear===stop){pass?pass===1?(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),earcutLinked(ear,triangles,dim,minX,minY,invSize,2)):pass===2&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,p=c.next;p!==a;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0||(p=p.prevZ,n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0))return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start2,triangles,dim){var p=start2;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim|0),triangles.push(p.i/dim|0),triangles.push(b.i/dim|0),removeNode(p),removeNode(p.next),p=start2=b),p=p.next}while(p!==start2);return filterPoints(p)}function splitEarcut(start2,triangles,dim,minX,minY,invSize){var a=start2;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize,0),earcutLinked(c,triangles,dim,minX,minY,invSize,0);return}b=b.next}a=a.next}while(a!==start2)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue2=[],i,len2,start2,end,list;for(i=0,len2=holeIndices.length;i<len2;i++)start2=holeIndices[i]*dim,end=i<len2-1?holeIndices[i+1]*dim:data.length,list=linkedList(data,start2,end,dim,!1),list===list.next&&(list.steiner=!0),queue2.push(getLeftmost(list));for(queue2.sort(compareX),i=0;i<queue2.length;i++)outerNode=eliminateHole(queue2[i],outerNode);return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=findHoleBridge(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole);return filterPoints(bridgeReverse,bridgeReverse.next),filterPoints(bridge,bridge.next)}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx&&(qx=x,m=p.x<p.next.x?p:p.next,x===hx))return m}p=p.next}while(p!==outerNode);if(!m)return null;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan2;p=m;do hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan2=Math.abs(hy-p.y)/(hx-p.x),locallyInside(p,hole)&&(tan2<tanMin||tan2===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))&&(m=p,tanMin=tan2)),p=p.next;while(p!==stop);return m}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function indexCurve(start2,minX,minY,invSize){var p=start2;do p.z===0&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==start2);p.prevZ.nextZ=null,p.prevZ=null,sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ,!!q);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)pSize!==0&&(qSize===0||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,invSize){return x=(x-minX)*invSize|0,y=(y-minY)*invSize|0,x=(x|x<<8)&16711935,x=(x|x<<4)&252645135,x=(x|x<<2)&858993459,x=(x|x<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,x|y<<1}function getLeftmost(start2){var p=start2,leftmost=start2;do(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next;while(p!==start2);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign2(area(p1,q1,p2)),o2=sign2(area(p1,q1,q2)),o3=sign2(area(p2,q2,p1)),o4=sign2(area(p2,q2,q1));return!!(o1!==o2&&o3!==o4||o1===0&&onSegment(p1,p2,q1)||o2===0&&onSegment(p1,q2,q1)||o3===0&&onSegment(p2,p1,q2)||o4===0&&onSegment(p2,q1,q2))}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign2(num){return num>0?1:num<0?-1:0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next;while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len2=holeIndices.length;i<len2;i++){var start2=holeIndices[i]*dim,end=i<len2-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start2,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start2,end,dim){for(var sum2=0,i=start2,j=end-dim;i<end;i+=dim)sum2+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum2}earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}}});var require_punycode=__commonJS({"node_modules/url/node_modules/punycode/punycode.js"(exports2,module2){(function(root){var freeExports=typeof exports2=="object"&&exports2&&!exports2.nodeType&&exports2,freeModule=typeof module2=="object"&&module2&&!module2.nodeType&&module2,freeGlobal=typeof global=="object"&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var punycode2,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map4(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map4(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var output=[],counter=0,length=string.length,value,extra;counter<length;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length?(extra=string.charCodeAt(counter++),(extra&64512)==56320?output.push(((value&1023)<<10)+(extra&1023)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map4(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|value&1023),output+=stringFromCharCode(value),output}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode2(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index3,oldi,w,k,digit,t,baseMinusT;for(basic=input.lastIndexOf(delimiter),basic<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index3=basic>0?basic+1:0;index3<inputLength;){for(oldi=i,w=1,k=base;index3>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index3++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(digit<t);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,oldi==0),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode2(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)currentValue=input[j],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)currentValue=input[j],currentValue>=n&&currentValue<m&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if(currentValue=input[j],currentValue<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(q<t);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode2(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode2(string):string})}if(punycode2={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode2,encode:encode2,toASCII,toUnicode},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return punycode2});else if(freeExports&&freeModule)if(module2.exports==freeExports)freeModule.exports=punycode2;else for(key in punycode2)punycode2.hasOwnProperty(key)&&(freeExports[key]=punycode2[key]);else root.punycode=punycode2})(exports2)}});var require_util=__commonJS({"node_modules/url/util.js"(exports2,module2){"use strict";module2.exports={isString:function(arg){return typeof arg=="string"},isObject:function(arg){return typeof arg=="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}}});var require_decode=__commonJS({"node_modules/querystring/decode.js"(exports2,module2){"use strict";function hasOwnProperty2(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module2.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if(typeof qs!="string"||qs.length===0)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&typeof options.maxKeys=="number"&&(maxKeys=options.maxKeys);var len2=qs.length;maxKeys>0&&len2>maxKeys&&(len2=maxKeys);for(var i=0;i<len2;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty2(obj,k)?Array.isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj}}});var require_encode=__commonJS({"node_modules/querystring/encode.js"(exports2,module2){"use strict";var stringifyPrimitive2=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module2.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",obj===null&&(obj=void 0),typeof obj=="object"?Object.keys(obj).map(function(k){var ks=encodeURIComponent(stringifyPrimitive2(k))+eq;return Array.isArray(obj[k])?obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive2(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive2(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive2(name))+eq+encodeURIComponent(stringifyPrimitive2(obj)):""}}});var require_querystring=__commonJS({"node_modules/querystring/index.js"(exports2){"use strict";exports2.decode=exports2.parse=require_decode();exports2.encode=exports2.stringify=require_encode()}});var require_url=__commonJS({"node_modules/url/url.js"(exports2){"use strict";var punycode2=require_punycode(),util29=require_util();exports2.parse=urlParse2;exports2.resolve=urlResolve2;exports2.resolveObject=urlResolveObject;exports2.format=urlFormat2;exports2.Url=Url3;function Url3(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern2=/^([a-z0-9.+-]+:)/i,portPattern2=/:[0-9]*$/,simplePathPattern2=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims2=["<",">",'"',"`"," ","\r",`
`,"	"],unwise2=["{","}","|","\\","^","`"].concat(delims2),autoEscape2=["'"].concat(unwise2),nonHostChars2=["%","/","?",";","#"].concat(autoEscape2),hostEndingChars2=["/","?","#"],hostnameMaxLen2=255,hostnamePartPattern2=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart2=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol2={javascript:!0,"javascript:":!0},hostlessProtocol2={javascript:!0,"javascript:":!0},slashedProtocol2={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring2=require_querystring();function urlParse2(url3,parseQueryString,slashesDenoteHost){if(url3&&util29.isObject(url3)&&url3 instanceof Url3)return url3;var u=new Url3;return u.parse(url3,parseQueryString,slashesDenoteHost),u}Url3.prototype.parse=function(url3,parseQueryString,slashesDenoteHost){if(!util29.isString(url3))throw new TypeError("Parameter 'url' must be a string, not "+typeof url3);var queryIndex=url3.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url3.indexOf("#")?"?":"#",uSplit=url3.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/"),url3=uSplit.join(splitter);var rest=url3;if(rest=rest.trim(),!slashesDenoteHost&&url3.split("#").length===1){var simplePath=simplePathPattern2.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],parseQueryString?this.query=querystring2.parse(this.search.substr(1)):this.query=this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern2.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";slashes&&!(proto&&hostlessProtocol2[proto])&&(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol2[proto]&&(slashes||proto&&!slashedProtocol2[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars2.length;i++){var hec=rest.indexOf(hostEndingChars2[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;hostEnd===-1?atSign=rest.lastIndexOf("@"):atSign=rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars2.length;i++){var hec=rest.indexOf(nonHostChars2[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!!part&&!part.match(hostnamePartPattern2)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern2)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart2);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>hostnameMaxLen2?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode2.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),rest[0]!=="/"&&(rest="/"+rest))}if(!unsafeProtocol2[lowerProto])for(var i=0,l=autoEscape2.length;i<l;i++){var ae=autoEscape2[i];if(rest.indexOf(ae)!==-1){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring2.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol2[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this};function urlFormat2(obj){return util29.isString(obj)&&(obj=urlParse2(obj)),obj instanceof Url3?obj.format():Url3.prototype.format.call(obj)}Url3.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util29.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring2.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&protocol.substr(-1)!==":"&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol2[protocol])&&host!==!1?(host="//"+(host||""),pathname&&pathname.charAt(0)!=="/"&&(pathname="/"+pathname)):host||(host=""),hash&&hash.charAt(0)!=="#"&&(hash="#"+hash),search&&search.charAt(0)!=="?"&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash};function urlResolve2(source,relative){return urlParse2(source,!1,!0).resolve(relative)}Url3.prototype.resolve=function(relative){return this.resolveObject(urlParse2(relative,!1,!0)).format()};function urlResolveObject(source,relative){return source?urlParse2(source,!1,!0).resolveObject(relative):relative}Url3.prototype.resolveObject=function(relative){if(util29.isString(relative)){var rel=new Url3;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url3,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,relative.href==="")return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];rkey!=="protocol"&&(result[rkey]=relative[rkey])}return slashedProtocol2[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol2[relative.protocol]){for(var keys2=Object.keys(relative),v=0;v<keys2.length;v++){var k=keys2[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,!relative.host&&!hostlessProtocol2[relative.protocol]){for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),relPath[0]!==""&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}else result.pathname=relative.pathname;if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol2[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(srcPath[0]===""?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(relPath[0]===""?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")),isRelAbs)result.host=relative.host||relative.host===""?relative.host:result.host,result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util29.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,(!util29.isNull(result.pathname)||!util29.isNull(result.search))&&(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="",up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],last==="."?srcPath.splice(i,1):last===".."?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")&&srcPath.unshift(""),hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"&&srcPath.push("");var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),(!util29.isNull(result.pathname)||!util29.isNull(result.search))&&(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result};Url3.prototype.parseHost=function(){var host=this.host,port=portPattern2.exec(host);port&&(port=port[0],port!==":"&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}}});var require_parse_uri=__commonJS({"node_modules/parse-uri/index.js"(exports2,module2){"use strict";function parseURI(str,opts){if(!!str){opts=opts||{};for(var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser[opts.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}}module2.exports=parseURI}});var require_mini_signals=__commonJS({"node_modules/mini-signals/lib/mini-signals.js"(exports2,module2){"use strict";Object.defineProperty(exports2,"__esModule",{value:!0});var _createClass2=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var MiniSignalBinding=function(){function MiniSignalBinding2(fn,once,thisArg){once===void 0&&(once=!1),_classCallCheck(this,MiniSignalBinding2),this._fn=fn,this._once=once,this._thisArg=thisArg,this._next=this._prev=this._owner=null}return _createClass2(MiniSignalBinding2,[{key:"detach",value:function(){return this._owner===null?!1:(this._owner.detach(this),!0)}}]),MiniSignalBinding2}();function _addMiniSignalBinding(self2,node){return self2._head?(self2._tail._next=node,node._prev=self2._tail,self2._tail=node):(self2._head=node,self2._tail=node),node._owner=self2,node}var MiniSignal=function(){function MiniSignal2(){_classCallCheck(this,MiniSignal2),this._head=this._tail=void 0}return _createClass2(MiniSignal2,[{key:"handlers",value:function(){var exists=arguments.length<=0||arguments[0]===void 0?!1:arguments[0],node=this._head;if(exists)return!!node;for(var ee=[];node;)ee.push(node),node=node._next;return ee}},{key:"has",value:function(node){if(!(node instanceof MiniSignalBinding))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return node._owner===this}},{key:"dispatch",value:function(){var node=this._head;if(!node)return!1;for(;node;)node._once&&this.detach(node),node._fn.apply(node._thisArg,arguments),node=node._next;return!0}},{key:"add",value:function(fn){var thisArg=arguments.length<=1||arguments[1]===void 0?null:arguments[1];if(typeof fn!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return _addMiniSignalBinding(this,new MiniSignalBinding(fn,!1,thisArg))}},{key:"once",value:function(fn){var thisArg=arguments.length<=1||arguments[1]===void 0?null:arguments[1];if(typeof fn!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return _addMiniSignalBinding(this,new MiniSignalBinding(fn,!0,thisArg))}},{key:"detach",value:function(node){if(!(node instanceof MiniSignalBinding))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return node._owner!==this?this:(node._prev&&(node._prev._next=node._next),node._next&&(node._next._prev=node._prev),node===this._head?(this._head=node._next,node._next===null&&(this._tail=null)):node===this._tail&&(this._tail=node._prev,this._tail._next=null),node._owner=null,this)}},{key:"detachAll",value:function(){var node=this._head;if(!node)return this;for(this._head=this._tail=null;node;)node._owner=null,node=node._next;return this}}]),MiniSignal2}();MiniSignal.MiniSignalBinding=MiniSignalBinding;exports2.default=MiniSignal;module2.exports=exports2.default}});var require_log4javascript=__commonJS({"node_modules/log4javascript/log4javascript.js"(exports,module){(function(factory,root){typeof define=="function"&&define.amd?define(factory):typeof module!="undefined"&&typeof exports=="object"?module.exports=factory():root.log4javascript=factory()})(function(){Array.prototype.push||(Array.prototype.push=function(){for(var i=0,len2=arguments.length;i<len2;i++)this[this.length]=arguments[i];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(this.length>0){for(var firstItem=this[0],i=0,len2=this.length-1;i<len2;i++)this[i]=this[i+1];return this.length=this.length-1,firstItem}}),Array.prototype.splice||(Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount),itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;for(var argumentsArray=[],i=0,len2=arguments.length;i<len2;i++)argumentsArray[i]=arguments[i];var itemsToAppend=argumentsArray.length>2?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len2=itemsToAppend.length;i<len2;i++)this.push(itemsToAppend[i]);return itemsDeleted});function isUndefined(obj){return typeof obj=="undefined"}function EventSupport(){}EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(eventTypesParam){if(eventTypesParam instanceof Array){this.eventTypes=eventTypesParam,this.eventListeners={};for(var i=0,len2=this.eventTypes.length;i<len2;i++)this.eventListeners[this.eventTypes[i]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(eventType,listener){typeof listener=="function"?(array_contains(this.eventTypes,eventType)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+eventType+"'"),this.eventListeners[eventType].push(listener)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(eventType,listener){typeof listener=="function"?(array_contains(this.eventTypes,eventType)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+eventType+"'"),array_remove(this.eventListeners[eventType],listener)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(eventType,eventArgs){if(array_contains(this.eventTypes,eventType))for(var listeners=this.eventListeners[eventType],i=0,len2=listeners.length;i<len2;i++)listeners[i](this,eventType,eventArgs);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+eventType+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(Math.random()*1e8),emptyFunction=function(){},newLine=`\r
`,pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;log4javascript.version="1.4.13",log4javascript.edition="log4javascript";function toStr(obj){return obj&&obj.toString?obj.toString():String(obj)}function getExceptionMessage(ex){return ex.message?ex.message:ex.description?ex.description:toStr(ex)}function getUrlFileName(url3){var lastSlashIndex=Math.max(url3.lastIndexOf("/"),url3.lastIndexOf("\\"));return url3.substr(lastSlashIndex+1)}function getExceptionStringRep(ex){if(ex){var exStr="Exception: "+getExceptionMessage(ex);try{ex.lineNumber&&(exStr+=" on line number "+ex.lineNumber),ex.fileName&&(exStr+=" in file "+getUrlFileName(ex.fileName))}catch(localEx){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&ex.stack&&(exStr+=newLine+"Stack trace:"+newLine+ex.stack),exStr}return null}function bool(obj){return Boolean(obj)}function trim(str){return str.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(text){var text2=text.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return text2.split(`
`)}var urlEncode=typeof window.encodeURIComponent!="undefined"?function(str){return encodeURIComponent(str)}:function(str){return escape(str).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(arr,val){for(var index3=-1,i=0,len2=arr.length;i<len2;i++)if(arr[i]===val){index3=i;break}return index3>=0?(arr.splice(index3,1),!0):!1}function array_contains(arr,val){for(var i=0,len2=arr.length;i<len2;i++)if(arr[i]==val)return!0;return!1}function extractBooleanFromParam(param,defaultValue3){return isUndefined(param)?defaultValue3:bool(param)}function extractStringFromParam(param,defaultValue3){return isUndefined(param)?defaultValue3:String(param)}function extractIntFromParam(param,defaultValue3){if(isUndefined(param))return defaultValue3;try{var value=parseInt(param,10);return isNaN(value)?defaultValue3:value}catch(ex){return logLog.warn("Invalid int param "+param,ex),defaultValue3}}function extractFunctionFromParam(param,defaultValue3){return typeof param=="function"?param:defaultValue3}function isError(err){return err instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";typeof obj[methodName]!="undefined"&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(obj){for(var args=[],i=1,len2=arguments.length;i<len2;i++)args[i-1]=arguments[i];return this.apply(obj,args)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(quietMode){this.quietMode=bool(quietMode)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(alertAllErrors){this.alertAllErrors=alertAllErrors},debug:function(message){this.debugMessages.push(message)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(message,exception){},error:function(message,exception){if((++this.numberOfErrors==1||this.alertAllErrors)&&!this.quietMode){var alertMessage="log4javascript error: "+message;exception&&(alertMessage+=newLine+newLine+"Original error: "+getExceptionStringRep(exception)),alert(alertMessage)}}};log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]);function handleError(message,exception){logLog.error(message,exception),log4javascript.dispatchEvent("error",{message,exception})}log4javascript.handleError=handleError;var enabled=!(typeof log4javascript_disabled!="undefined"&&log4javascript_disabled);log4javascript.setEnabled=function(enable){enabled=bool(enable)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(timeStampsInMilliseconds){useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(show){showStackTraces=bool(show)};var Level=function(level,name){this.level=level,this.name=name};Level.prototype={toString:function(){return this.name},equals:function(level){return this.level==level.level},isGreaterOrEqual:function(level){return this.level>=level.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level;function Timer(name,level){this.name=name,this.level=isUndefined(level)?Level.INFO:level,this.start=new Date}Timer.prototype.getElapsedTime=function(){return new Date().getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(name){this.name=name,this.parent=null,this.children=[];var appenders=[],loggerLevel=null,isRoot=this.name===rootLoggerName,isNull=this.name===nullLoggerName,appenderCache=null,appenderCacheInvalidated=!1;this.addChild=function(childLogger){this.children.push(childLogger),childLogger.parent=this,childLogger.invalidateAppenderCache()};var additive=!0;this.getAdditivity=function(){return additive},this.setAdditivity=function(additivity){var valueChanged=additive!=additivity;additive=additivity,valueChanged&&this.invalidateAppenderCache()},this.addAppender=function(appender){isNull?handleError("Logger.addAppender: you may not add an appender to the null logger"):appender instanceof log4javascript.Appender?array_contains(appenders,appender)||(appenders.push(appender),appender.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(appender)+"') is not a subclass of Appender")},this.removeAppender=function(appender){array_remove(appenders,appender),appender.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var appenderCount=appenders.length;if(appenderCount>0){for(var i=0;i<appenderCount;i++)appenders[i].setRemovedFromLogger(this);appenders.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(appenderCache===null||appenderCacheInvalidated){var parentEffectiveAppenders=isRoot||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();appenderCache=parentEffectiveAppenders.concat(appenders),appenderCacheInvalidated=!1}return appenderCache},this.invalidateAppenderCache=function(){appenderCacheInvalidated=!0;for(var i=0,len2=this.children.length;i<len2;i++)this.children[i].invalidateAppenderCache()},this.log=function(level,params){if(enabled&&level.isGreaterOrEqual(this.getEffectiveLevel())){var exception,finalParamIndex=params.length-1,lastParam=params[finalParamIndex];params.length>1&&isError(lastParam)&&(exception=lastParam,finalParamIndex--);for(var messages=[],i=0;i<=finalParamIndex;i++)messages[i]=params[i];var loggingEvent=new LoggingEvent(this,new Date,level,messages,exception);this.callAppenders(loggingEvent)}},this.callAppenders=function(loggingEvent){for(var effectiveAppenders=this.getEffectiveAppenders(),i=0,len2=effectiveAppenders.length;i<len2;i++)effectiveAppenders[i].doAppend(loggingEvent)},this.setLevel=function(level){isRoot&&level===null?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):level instanceof Level?loggerLevel=level:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return loggerLevel},this.getEffectiveLevel=function(){for(var logger=this;logger!==null;logger=logger.parent){var level=logger.getLevel();if(level!==null)return level}},this.group=function(name2,initiallyExpanded){if(enabled)for(var effectiveAppenders=this.getEffectiveAppenders(),i=0,len2=effectiveAppenders.length;i<len2;i++)effectiveAppenders[i].group(name2,initiallyExpanded)},this.groupEnd=function(){if(enabled)for(var effectiveAppenders=this.getEffectiveAppenders(),i=0,len2=effectiveAppenders.length;i<len2;i++)effectiveAppenders[i].groupEnd()};var timers={};this.time=function(name2,level){enabled&&(isUndefined(name2)?handleError("Logger.time: a name for the timer must be supplied"):level&&!(level instanceof Level)?handleError("Logger.time: level supplied to timer "+name2+" is not an instance of log4javascript.Level"):timers[name2]=new Timer(name2,level))},this.timeEnd=function(name2){if(enabled)if(isUndefined(name2))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(timers[name2]){var timer=timers[name2],milliseconds=timer.getElapsedTime();this.log(timer.level,["Timer "+toStr(name2)+" completed in "+milliseconds+"ms"]),delete timers[name2]}else logLog.warn("Logger.timeEnd: no timer found with name "+name2)},this.assert=function(expr){if(enabled&&!expr){for(var args=[],i=1,len2=arguments.length;i<len2;i++)args.push(arguments[i]);args=args.length>0?args:["Assertion Failure"],args.push(newLine),args.push(expr),this.log(Level.ERROR,args)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(level){return level.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(loggerName){if(typeof loggerName!="string"&&(loggerName=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(loggerName)+" supplied, returning anonymous logger")),loggerName==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[loggerName]){var logger=new Logger(loggerName);loggers[loggerName]=logger,loggerNames.push(loggerName);var lastDotIndex=loggerName.lastIndexOf("."),parentLogger;if(lastDotIndex>-1){var parentLoggerName=loggerName.substring(0,lastDotIndex);parentLogger=log4javascript.getLogger(parentLoggerName)}else parentLogger=rootLogger;parentLogger.addChild(logger)}return loggers[loggerName]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName),nullLogger.setLevel(Level.OFF)),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(logger,timeStamp,level,messages,exception){this.logger=logger,this.timeStamp=timeStamp,this.timeStampInMilliseconds=timeStamp.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=level,this.messages=messages,this.exception=exception};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return this.messages.length==1?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(timeStampsInMilliseconds){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(loggingEvent){return this.isTimeStampsInMilliseconds()?loggingEvent.timeStampInMilliseconds:loggingEvent.timeStampInSeconds},getDataValues:function(loggingEvent,combineMessages){var dataValues=[[this.loggerKey,loggingEvent.logger.name],[this.timeStampKey,this.getTimeStampValue(loggingEvent)],[this.levelKey,loggingEvent.level.name],[this.urlKey,window.location.href],[this.messageKey,combineMessages?loggingEvent.getCombinedMessages():loggingEvent.messages]];if(this.isTimeStampsInMilliseconds()||dataValues.push([this.millisecondsKey,loggingEvent.milliseconds]),loggingEvent.exception&&dataValues.push([this.exceptionKey,getExceptionStringRep(loggingEvent.exception)]),this.hasCustomFields())for(var i=0,len2=this.customFields.length;i<len2;i++){var val=this.customFields[i].value;typeof val=="function"&&(val=val(this,loggingEvent)),dataValues.push([this.customFields[i].name,val])}return dataValues},setKeys:function(loggerKey,timeStampKey,levelKey,messageKey,exceptionKey,urlKey,millisecondsKey){this.loggerKey=extractStringFromParam(loggerKey,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(timeStampKey,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(levelKey,this.defaults.levelKey),this.messageKey=extractStringFromParam(messageKey,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(exceptionKey,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(urlKey,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(millisecondsKey,this.defaults.millisecondsKey)},setCustomField:function(name,value){for(var fieldUpdated=!1,i=0,len2=this.customFields.length;i<len2;i++)this.customFields[i].name===name&&(this.customFields[i].value=value,fieldUpdated=!0);fieldUpdated||this.customFields.push({name,value})},hasCustomFields:function(){return this.customFields.length>0},formatWithException:function(loggingEvent){var formatted=this.format(loggingEvent);return loggingEvent.exception&&this.ignoresThrowable()&&(formatted+=loggingEvent.getThrowableStrRep()),formatted},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(loggingEvent){enabled&&loggingEvent.level.level>=this.threshold.level&&this.append(loggingEvent)},Appender.prototype.append=function(loggingEvent){},Appender.prototype.setLayout=function(layout){layout instanceof Layout?this.layout=layout:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(threshold){threshold instanceof Level?this.threshold=threshold:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(logger){this.loggers.push(logger)},Appender.prototype.setRemovedFromLogger=function(logger){array_remove(this.loggers,logger)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender;function SimpleLayout(){this.customFields=[]}SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(loggingEvent){return loggingEvent.level.name+" - "+loggingEvent.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout;function NullLayout(){this.customFields=[]}NullLayout.prototype=new Layout,NullLayout.prototype.format=function(loggingEvent){return loggingEvent.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(loggingEvent){var messages=loggingEvent.messages,ex=loggingEvent.exception;return ex?messages.concat([ex]):messages},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout;function XmlLayout(combineMessages){this.combineMessages=extractBooleanFromParam(combineMessages,!0),this.customFields=[]}XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(str){return str.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(loggingEvent){var layout=this,i,len2;function formatMessage(message){return message=typeof message=="string"?message:toStr(message),"<log4javascript:message><![CDATA["+layout.escapeCdata(message)+"]]></log4javascript:message>"}var str='<log4javascript:event logger="'+loggingEvent.logger.name+'" timestamp="'+this.getTimeStampValue(loggingEvent)+'"';if(this.isTimeStampsInMilliseconds()||(str+=' milliseconds="'+loggingEvent.milliseconds+'"'),str+=' level="'+loggingEvent.level.name+'">'+newLine,this.combineMessages)str+=formatMessage(loggingEvent.getCombinedMessages());else{for(str+="<log4javascript:messages>"+newLine,i=0,len2=loggingEvent.messages.length;i<len2;i++)str+=formatMessage(loggingEvent.messages[i])+newLine;str+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(i=0,len2=this.customFields.length;i<len2;i++)str+='<log4javascript:customfield name="'+this.customFields[i].name+'"><![CDATA['+this.customFields[i].value.toString()+"]]></log4javascript:customfield>"+newLine;return loggingEvent.exception&&(str+="<log4javascript:exception><![CDATA["+getExceptionStringRep(loggingEvent.exception)+"]]></log4javascript:exception>"+newLine),str+="</log4javascript:event>"+newLine+newLine,str},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout;function escapeNewLines(str){return str.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(readable,combineMessages){this.readable=extractBooleanFromParam(readable,!1),this.combineMessages=extractBooleanFromParam(combineMessages,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"	":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(loggingEvent){var layout=this,dataValues=this.getDataValues(loggingEvent,this.combineMessages),str="{"+this.lineBreak,i,len2;function formatValue(val,prefix,expand){var formattedValue,valType=typeof val;if(val instanceof Date)formattedValue=String(val.getTime());else if(expand&&val instanceof Array){formattedValue="["+layout.lineBreak;for(var i2=0,len3=val.length;i2<len3;i2++){var childPrefix=prefix+layout.tab;formattedValue+=childPrefix+formatValue(val[i2],childPrefix,!1),i2<val.length-1&&(formattedValue+=","),formattedValue+=layout.lineBreak}formattedValue+=prefix+"]"}else valType!=="number"&&valType!=="boolean"?formattedValue='"'+escapeNewLines(toStr(val).replace(/\"/g,'\\"'))+'"':formattedValue=val;return formattedValue}for(i=0,len2=dataValues.length-1;i<=len2;i++)str+=this.tab+'"'+dataValues[i][0]+'"'+this.colon+formatValue(dataValues[i][1],this.tab,!0),i<len2&&(str+=","),str+=this.lineBreak;return str+="}"+this.lineBreak,str},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout;function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(loggingEvent){for(var dataValues=this.getDataValues(loggingEvent),queryBits=[],i=0,len2=dataValues.length;i<len2;i++){var val=dataValues[i][1]instanceof Date?String(dataValues[i][1].getTime()):dataValues[i][1];queryBits.push(urlEncode(dataValues[i][0])+"="+urlEncode(val))}return queryBits.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(loggingEvent){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout;function formatObjectExpansion(obj,depth,indentation){var objectsExpanded=[];function doFormat(obj2,depth2,indentation2){var i,len2,childDepth,childIndentation,childLines,expansion,childExpansion;indentation2||(indentation2="");function formatString(text){for(var lines=splitIntoLines(text),j=1,jLen=lines.length;j<jLen;j++)lines[j]=indentation2+lines[j];return lines.join(newLine)}if(obj2===null)return"null";if(typeof obj2=="undefined")return"undefined";if(typeof obj2=="string")return formatString(obj2);if(typeof obj2=="object"&&array_contains(objectsExpanded,obj2)){try{expansion=toStr(obj2)}catch(ex){expansion="Error formatting property. Details: "+getExceptionStringRep(ex)}return expansion+" [already expanded]"}else if(obj2 instanceof Array&&depth2>0){for(objectsExpanded.push(obj2),expansion="["+newLine,childDepth=depth2-1,childIndentation=indentation2+"  ",childLines=[],i=0,len2=obj2.length;i<len2;i++)try{childExpansion=doFormat(obj2[i],childDepth,childIndentation),childLines.push(childIndentation+childExpansion)}catch(ex){childLines.push(childIndentation+"Error formatting array member. Details: "+getExceptionStringRep(ex)+"")}return expansion+=childLines.join(","+newLine)+newLine+indentation2+"]",expansion}else{if(Object.prototype.toString.call(obj2)=="[object Date]")return obj2.toString();if(typeof obj2=="object"&&depth2>0){objectsExpanded.push(obj2),expansion="{"+newLine,childDepth=depth2-1,childIndentation=indentation2+"  ",childLines=[];for(i in obj2)try{childExpansion=doFormat(obj2[i],childDepth,childIndentation),childLines.push(childIndentation+i+": "+childExpansion)}catch(ex){childLines.push(childIndentation+i+": Error formatting property. Details: "+getExceptionStringRep(ex))}return expansion+=childLines.join(","+newLine)+newLine+indentation2+"}",expansion}else return formatString(toStr(obj2))}}return doFormat(obj,depth,indentation)}var SimpleDateFormat;(function(){var regex=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],TEXT2=0,TEXT3=1,NUMBER=2,YEAR=3,MONTH=4,TIMEZONE=5,types={G:TEXT2,y:YEAR,M:MONTH,w:NUMBER,W:NUMBER,D:NUMBER,d:NUMBER,F:NUMBER,E:TEXT3,a:TEXT2,H:NUMBER,k:NUMBER,K:NUMBER,h:NUMBER,m:NUMBER,s:NUMBER,S:NUMBER,Z:TIMEZONE},ONE_DAY=24*60*60*1e3,ONE_WEEK=7*ONE_DAY,DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK=1,newDateAtMidnight=function(year,month,day){var d=new Date(year,month,day,0,0,0);return d.setMilliseconds(0),d};Date.prototype.getDifference=function(date){return this.getTime()-date.getTime()},Date.prototype.isBefore=function(d){return this.getTime()<d.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(d){return this.getUTCTime()-d.getUTCTime()},Date.prototype.getPreviousSunday=function(){var midday=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),previousSunday=new Date(midday.getTime()-this.getDay()*ONE_DAY);return newDateAtMidnight(previousSunday.getFullYear(),previousSunday.getMonth(),previousSunday.getDate())},Date.prototype.getWeekInYear=function(minimalDaysInFirstWeek){isUndefined(this.minimalDaysInFirstWeek)&&(minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK);var previousSunday=this.getPreviousSunday(),startOfYear=newDateAtMidnight(this.getFullYear(),0,1),numberOfSundays=previousSunday.isBefore(startOfYear)?0:1+Math.floor(previousSunday.getTimeSince(startOfYear)/ONE_WEEK),numberOfDaysInFirstWeek=7-startOfYear.getDay(),weekInYear=numberOfSundays;return numberOfDaysInFirstWeek<minimalDaysInFirstWeek&&weekInYear--,weekInYear},Date.prototype.getWeekInMonth=function(minimalDaysInFirstWeek){isUndefined(this.minimalDaysInFirstWeek)&&(minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK);var previousSunday=this.getPreviousSunday(),startOfMonth=newDateAtMidnight(this.getFullYear(),this.getMonth(),1),numberOfSundays=previousSunday.isBefore(startOfMonth)?0:1+Math.floor(previousSunday.getTimeSince(startOfMonth)/ONE_WEEK),numberOfDaysInFirstWeek=7-startOfMonth.getDay(),weekInMonth=numberOfSundays;return numberOfDaysInFirstWeek>=minimalDaysInFirstWeek&&weekInMonth++,weekInMonth},Date.prototype.getDayInYear=function(){var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(startOfYear)/ONE_DAY)},SimpleDateFormat=function(formatString){this.formatString=formatString},SimpleDateFormat.prototype.setMinimalDaysInFirstWeek=function(days2){this.minimalDaysInFirstWeek=days2},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK:this.minimalDaysInFirstWeek};var padWithZeroes=function(str,len2){for(;str.length<len2;)str="0"+str;return str},formatText=function(data,numberOfLetters,minLength){return numberOfLetters>=4?data:data.substr(0,Math.max(minLength,numberOfLetters))},formatNumber=function(data,numberOfLetters){var dataString=""+data;return padWithZeroes(dataString,numberOfLetters)};SimpleDateFormat.prototype.format=function(date){for(var formattedString="",result,searchString=this.formatString;result=regex.exec(searchString);){var quotedString=result[1],patternLetters=result[2],otherLetters=result[3],otherCharacters=result[4];if(quotedString)quotedString=="''"?formattedString+="'":formattedString+=quotedString.substring(1,quotedString.length-1);else if(!otherLetters){if(otherCharacters)formattedString+=otherCharacters;else if(patternLetters){var patternLetter=patternLetters.charAt(0),numberOfLetters=patternLetters.length,rawData="";switch(patternLetter){case"G":rawData="AD";break;case"y":rawData=date.getFullYear();break;case"M":rawData=date.getMonth();break;case"w":rawData=date.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":rawData=date.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":rawData=date.getDayInYear();break;case"d":rawData=date.getDate();break;case"F":rawData=1+Math.floor((date.getDate()-1)/7);break;case"E":rawData=dayNames[date.getDay()];break;case"a":rawData=date.getHours()>=12?"PM":"AM";break;case"H":rawData=date.getHours();break;case"k":rawData=date.getHours()||24;break;case"K":rawData=date.getHours()%12;break;case"h":rawData=date.getHours()%12||12;break;case"m":rawData=date.getMinutes();break;case"s":rawData=date.getSeconds();break;case"S":rawData=date.getMilliseconds();break;case"Z":rawData=date.getTimezoneOffset();break}switch(types[patternLetter]){case TEXT2:formattedString+=formatText(rawData,numberOfLetters,2);break;case TEXT3:formattedString+=formatText(rawData,numberOfLetters,3);break;case NUMBER:formattedString+=formatNumber(rawData,numberOfLetters);break;case YEAR:if(numberOfLetters<=3){var dataString=""+rawData;formattedString+=dataString.substr(2,2)}else formattedString+=formatNumber(rawData,numberOfLetters);break;case MONTH:numberOfLetters>=3?formattedString+=formatText(monthNames[rawData],numberOfLetters,numberOfLetters):formattedString+=formatNumber(rawData+1,numberOfLetters);break;case TIMEZONE:var isPositive=rawData>0,prefix=isPositive?"-":"+",absData=Math.abs(rawData),hours=""+Math.floor(absData/60);hours=padWithZeroes(hours,2);var minutes=""+absData%60;minutes=padWithZeroes(minutes,2),formattedString+=prefix+hours+minutes;break}}}searchString=searchString.substr(result.index+result[0].length)}return formattedString}})(),log4javascript.SimpleDateFormat=SimpleDateFormat;function PatternLayout(pattern){pattern?this.pattern=pattern:this.pattern=PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(loggingEvent){for(var regex=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,formattedString="",result,searchString=this.pattern;result=regex.exec(searchString);){var matchedString=result[0],padding=result[1],truncation=result[2],conversionCharacter=result[3],specifier=result[5],text=result[6];if(text)formattedString+=""+text;else{var replacement="";switch(conversionCharacter){case"a":case"m":var depth=0;specifier&&(depth=parseInt(specifier,10),isNaN(depth)&&(handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character '"+conversionCharacter+"' - should be a number"),depth=0));for(var messages=conversionCharacter==="a"?loggingEvent.messages[0]:loggingEvent.messages,i=0,len2=messages.length;i<len2;i++)i>0&&replacement.charAt(replacement.length-1)!==" "&&(replacement+=" "),depth===0?replacement+=messages[i]:replacement+=formatObjectExpansion(messages[i],depth);break;case"c":var loggerName=loggingEvent.logger.name;if(specifier){var precision=parseInt(specifier,10),loggerNameBits=loggingEvent.logger.name.split(".");precision>=loggerNameBits.length?replacement=loggerName:replacement=loggerNameBits.slice(loggerNameBits.length-precision).join(".")}else replacement=loggerName;break;case"d":var dateFormat=PatternLayout.ISO8601_DATEFORMAT;specifier&&(dateFormat=specifier,dateFormat=="ISO8601"?dateFormat=PatternLayout.ISO8601_DATEFORMAT:dateFormat=="ABSOLUTE"?dateFormat=PatternLayout.ABSOLUTETIME_DATEFORMAT:dateFormat=="DATE"&&(dateFormat=PatternLayout.DATETIME_DATEFORMAT)),replacement=new SimpleDateFormat(dateFormat).format(loggingEvent.timeStamp);break;case"f":if(this.hasCustomFields()){var fieldIndex=0;specifier&&(fieldIndex=parseInt(specifier,10),isNaN(fieldIndex)?handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character 'f' - should be a number"):fieldIndex===0?handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character 'f' - must be greater than zero"):fieldIndex>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character 'f' - there aren't that many custom fields"):fieldIndex=fieldIndex-1);var val=this.customFields[fieldIndex].value;typeof val=="function"&&(val=val(this,loggingEvent)),replacement=val}break;case"n":replacement=newLine;break;case"p":replacement=loggingEvent.level.name;break;case"r":replacement=""+loggingEvent.timeStamp.getDifference(applicationStartDate);break;case"%":replacement="%";break;default:replacement=matchedString;break}var l;if(truncation){l=parseInt(truncation.substr(1),10);var strLen=replacement.length;l<strLen&&(replacement=replacement.substring(strLen-l,strLen))}if(padding)if(padding.charAt(0)=="-")for(l=parseInt(padding.substr(1),10);replacement.length<l;)replacement+=" ";else for(l=parseInt(padding,10);replacement.length<l;)replacement=" "+replacement;formattedString+=replacement}searchString=searchString.substr(result.index+result[0].length)}return formattedString},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout;function AlertAppender(){}AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(loggingEvent){alert(this.getLayout().formatWithException(loggingEvent))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender;function BrowserConsoleAppender(){}BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(loggingEvent){var appender=this,getFormattedMessage=function(concatenate){var formattedMessage=appender.getLayout().formatWithException(loggingEvent);return typeof formattedMessage=="string"?concatenate?formattedMessage:[formattedMessage]:concatenate?formattedMessage.join(" "):formattedMessage},console2=window.console;if(console2&&console2.log){var consoleMethodName;console2.debug&&Level.DEBUG.isGreaterOrEqual(loggingEvent.level)?consoleMethodName="debug":console2.info&&Level.INFO.equals(loggingEvent.level)?consoleMethodName="info":console2.warn&&Level.WARN.equals(loggingEvent.level)?consoleMethodName="warn":console2.error&&loggingEvent.level.isGreaterOrEqual(Level.ERROR)?consoleMethodName="error":consoleMethodName="log",typeof console2[consoleMethodName].apply=="function"?console2[consoleMethodName].apply(console2,getFormattedMessage(!1)):console2[consoleMethodName](getFormattedMessage(!0))}else typeof opera!="undefined"&&opera.postError&&opera.postError(getFormattedMessage(!0))},BrowserConsoleAppender.prototype.group=function(name){window.console&&window.console.group&&window.console.group(name)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(errorHandler){for(var xmlHttp=null,factory,i=0,len2=xmlHttpFactories.length;i<len2;i++){factory=xmlHttpFactories[i];try{return xmlHttp=factory(),withCredentialsSupported=factory==xhrFactory&&"withCredentials"in xmlHttp,getXmlHttp=factory,xmlHttp}catch(e){}}errorHandler?errorHandler():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")};function isHttpRequestSuccessful(xmlHttp){return isUndefined(xmlHttp.status)||xmlHttp.status===0||xmlHttp.status>=200&&xmlHttp.status<300||xmlHttp.status==1223}function AjaxAppender(url3,withCredentials){var appender=this,isSupported2=!0;url3||(handleError("AjaxAppender: URL must be specified in constructor"),isSupported2=!1);var timed=this.defaults.timed,waitForResponse=this.defaults.waitForResponse,batchSize=this.defaults.batchSize,timerInterval=this.defaults.timerInterval,requestSuccessCallback=this.defaults.requestSuccessCallback,failCallback=this.defaults.failCallback,postVarName=this.defaults.postVarName,sendAllOnUnload=this.defaults.sendAllOnUnload,contentType=this.defaults.contentType,sessionId=null,queuedLoggingEvents=[],queuedRequests=[],headers=[],sending=!1,initialized=!1;function checkCanConfigure(configOptionName){return initialized?(handleError("AjaxAppender: configuration option '"+configOptionName+"' may not be set after the appender has been initialized"),!1):!0}this.getSessionId=function(){return sessionId},this.setSessionId=function(sessionIdParam){sessionId=extractStringFromParam(sessionIdParam,null),this.layout.setCustomField("sessionid",sessionId)},this.setLayout=function(layoutParam){checkCanConfigure("layout")&&(this.layout=layoutParam,sessionId!==null&&this.setSessionId(sessionId))},this.isTimed=function(){return timed},this.setTimed=function(timedParam){checkCanConfigure("timed")&&(timed=bool(timedParam))},this.getTimerInterval=function(){return timerInterval},this.setTimerInterval=function(timerIntervalParam){checkCanConfigure("timerInterval")&&(timerInterval=extractIntFromParam(timerIntervalParam,timerInterval))},this.isWaitForResponse=function(){return waitForResponse},this.setWaitForResponse=function(waitForResponseParam){checkCanConfigure("waitForResponse")&&(waitForResponse=bool(waitForResponseParam))},this.getBatchSize=function(){return batchSize},this.setBatchSize=function(batchSizeParam){checkCanConfigure("batchSize")&&(batchSize=extractIntFromParam(batchSizeParam,batchSize))},this.isSendAllOnUnload=function(){return sendAllOnUnload},this.setSendAllOnUnload=function(sendAllOnUnloadParam){checkCanConfigure("sendAllOnUnload")&&(sendAllOnUnload=extractBooleanFromParam(sendAllOnUnloadParam,sendAllOnUnload))},this.setRequestSuccessCallback=function(requestSuccessCallbackParam){requestSuccessCallback=extractFunctionFromParam(requestSuccessCallbackParam,requestSuccessCallback)},this.setFailCallback=function(failCallbackParam){failCallback=extractFunctionFromParam(failCallbackParam,failCallback)},this.getPostVarName=function(){return postVarName},this.setPostVarName=function(postVarNameParam){checkCanConfigure("postVarName")&&(postVarName=extractStringFromParam(postVarNameParam,postVarName))},this.getHeaders=function(){return headers},this.addHeader=function(name,value){name.toLowerCase()=="content-type"?contentType=value:headers.push({name,value})};function sendAll(){if(isSupported2&&enabled){sending=!0;var currentRequestBatch;if(waitForResponse)queuedRequests.length>0?(currentRequestBatch=queuedRequests.shift(),sendRequest(preparePostData(currentRequestBatch),sendAll)):(sending=!1,timed&&scheduleSending());else{for(;currentRequestBatch=queuedRequests.shift();)sendRequest(preparePostData(currentRequestBatch));sending=!1,timed&&scheduleSending()}}}this.sendAll=sendAll;function sendAllRemaining(){var sendingAnything=!1;if(isSupported2&&enabled){for(var actualBatchSize=appender.getLayout().allowBatching()?batchSize:1,currentLoggingEvent,batchedLoggingEvents=[];currentLoggingEvent=queuedLoggingEvents.shift();)batchedLoggingEvents.push(currentLoggingEvent),queuedLoggingEvents.length>=actualBatchSize&&(queuedRequests.push(batchedLoggingEvents),batchedLoggingEvents=[]);batchedLoggingEvents.length>0&&queuedRequests.push(batchedLoggingEvents),sendingAnything=queuedRequests.length>0,waitForResponse=!1,timed=!1,sendAll()}return sendingAnything}this.sendAllRemaining=sendAllRemaining;function preparePostData(batchedLoggingEvents){for(var formattedMessages=[],currentLoggingEvent,postData="";currentLoggingEvent=batchedLoggingEvents.shift();)formattedMessages.push(appender.getLayout().formatWithException(currentLoggingEvent));return batchedLoggingEvents.length==1?postData=formattedMessages.join(""):postData=appender.getLayout().batchHeader+formattedMessages.join(appender.getLayout().batchSeparator)+appender.getLayout().batchFooter,contentType==appender.defaults.contentType&&(postData=appender.getLayout().returnsPostData?postData:urlEncode(postVarName)+"="+urlEncode(postData),postData.length>0&&(postData+="&"),postData+="layout="+urlEncode(appender.getLayout().toString())),postData}function scheduleSending(){window.setTimeout(sendAll,timerInterval)}function xmlHttpErrorHandler(){var msg="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(msg),isSupported2=!1,failCallback&&failCallback(msg)}function sendRequest(postData,successCallback){try{var xmlHttp=getXmlHttp(xmlHttpErrorHandler);if(isSupported2){xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){if(isHttpRequestSuccessful(xmlHttp))requestSuccessCallback&&requestSuccessCallback(xmlHttp),successCallback&&successCallback(xmlHttp);else{var msg2="AjaxAppender.append: XMLHttpRequest request to URL "+url3+" returned status code "+xmlHttp.status;handleError(msg2),failCallback&&failCallback(msg2)}xmlHttp.onreadystatechange=emptyFunction,xmlHttp=null}},xmlHttp.open("POST",url3,!0),withCredentials&&withCredentialsSupported&&(xmlHttp.withCredentials=!0);try{for(var i=0,header;header=headers[i++];)xmlHttp.setRequestHeader(header.name,header.value);xmlHttp.setRequestHeader("Content-Type",contentType)}catch(headerEx){var msg="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";handleError(msg),isSupported2=!1,failCallback&&failCallback(msg);return}xmlHttp.send(postData)}}catch(ex){var errMsg="AjaxAppender.append: error sending log message to "+url3;handleError(errMsg,ex),isSupported2=!1,failCallback&&failCallback(errMsg+". Details: "+getExceptionStringRep(ex))}}this.append=function(loggingEvent){if(isSupported2){initialized||init8(),queuedLoggingEvents.push(loggingEvent);var actualBatchSize=this.getLayout().allowBatching()?batchSize:1;if(queuedLoggingEvents.length>=actualBatchSize){for(var currentLoggingEvent,batchedLoggingEvents=[];currentLoggingEvent=queuedLoggingEvents.shift();)batchedLoggingEvents.push(currentLoggingEvent);queuedRequests.push(batchedLoggingEvents),!timed&&(!waitForResponse||waitForResponse&&!sending)&&sendAll()}}};function init8(){if(initialized=!0,sendAllOnUnload){var oldBeforeUnload=window.onbeforeunload;window.onbeforeunload=function(){oldBeforeUnload&&oldBeforeUnload(),sendAllRemaining()}}timed&&scheduleSending()}}AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender;function setCookie(name,value,days2,path){var expires;if(path=path?"; path="+path:"",days2){var date=new Date;date.setTime(date.getTime()+days2*24*60*60*1e3),expires="; expires="+date.toGMTString()}else expires="";document.cookie=escape(name)+"="+escape(value)+expires+path}function getCookie(name){for(var nameEquals=escape(name)+"=",ca=document.cookie.split(";"),i=0,len2=ca.length;i<len2;i++){for(var c=ca[i];c.charAt(0)===" ";)c=c.substring(1,c.length);if(c.indexOf(nameEquals)===0)return unescape(c.substring(nameEquals.length,c.length))}return null}function getBaseUrl(){for(var scripts=document.getElementsByTagName("script"),i=0,len2=scripts.length;i<len2;++i)if(scripts[i].src.indexOf("log4javascript")!=-1){var lastSlash=scripts[i].src.lastIndexOf("/");return lastSlash==-1?"":scripts[i].src.substr(0,lastSlash+1)}return null}function isLoaded(win){try{return bool(win.loaded)}catch(ex){return!1}}var ConsoleAppender;(function(){var getConsoleHtmlLines=function(){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"<head>","<title>log4javascript</title>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"<!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work -->",'<meta http-equiv="X-UA-Compatible" content="IE=7" />','<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','<!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]-->','<!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]-->','<script type="text/javascript">',"//<![CDATA[","var loggingEnabled=true;var logQueuedEventsTimer=null;var logEntries=[];var logEntriesAndSeparators=[];var logItems=[];var renderDelay=100;var unrenderedLogItemsExist=false;var rootGroup,currentGroup=null;var loaded=false;var currentLogItem=null;var logMainContainer;function copyProperties(obj,props){for(var i in props){obj[i]=props[i];}}","function LogItem(){}","LogItem.prototype={mainContainer:null,wrappedContainer:null,unwrappedContainer:null,group:null,appendToLog:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].appendToLog();}","this.group.update();},doRemove:function(doUpdate,removeFromGroup){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].remove();}","this.unwrappedElementContainer=null;this.wrappedElementContainer=null;this.mainElementContainer=null;}","if(this.group&&removeFromGroup){this.group.removeChild(this,doUpdate);}","if(this===currentLogItem){currentLogItem=null;}},remove:function(doUpdate,removeFromGroup){this.doRemove(doUpdate,removeFromGroup);},render:function(){},accept:function(visitor){visitor.visit(this);},getUnwrappedDomContainer:function(){return this.group.unwrappedElementContainer.contentDiv;},getWrappedDomContainer:function(){return this.group.wrappedElementContainer.contentDiv;},getMainDomContainer:function(){return this.group.mainElementContainer.contentDiv;}};LogItem.serializedItemKeys={LOG_ENTRY:0,GROUP_START:1,GROUP_END:2};function LogItemContainerElement(){}",'LogItemContainerElement.prototype={appendToLog:function(){var insertBeforeFirst=(newestAtTop&&this.containerDomNode.hasChildNodes());if(insertBeforeFirst){this.containerDomNode.insertBefore(this.mainDiv,this.containerDomNode.firstChild);}else{this.containerDomNode.appendChild(this.mainDiv);}}};function SeparatorElementContainer(containerDomNode){this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="separator";this.mainDiv.innerHTML="&nbsp;";}',"SeparatorElementContainer.prototype=new LogItemContainerElement();SeparatorElementContainer.prototype.remove=function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;};function Separator(){this.rendered=false;}","Separator.prototype=new LogItem();copyProperties(Separator.prototype,{render:function(){var containerDomNode=this.group.contentDiv;if(isIe){this.unwrappedElementContainer=new SeparatorElementContainer(this.getUnwrappedDomContainer());this.wrappedElementContainer=new SeparatorElementContainer(this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new SeparatorElementContainer(this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}",'this.content=this.formattedMessage;this.rendered=true;}});function GroupElementContainer(group,containerDomNode,isRoot,isWrapped){this.group=group;this.containerDomNode=containerDomNode;this.isRoot=isRoot;this.isWrapped=isWrapped;this.expandable=false;if(this.isRoot){if(isIe){this.contentDiv=logMainContainer.appendChild(document.createElement("div"));this.contentDiv.id=this.isWrapped?"log_wrapped":"log_unwrapped";}else{this.contentDiv=logMainContainer;}}else{var groupElementContainer=this;this.mainDiv=document.createElement("div");this.mainDiv.className="group";this.headingDiv=this.mainDiv.appendChild(document.createElement("div"));this.headingDiv.className="groupheading";this.expander=this.headingDiv.appendChild(document.createElement("span"));this.expander.className="expander unselectable greyedout";this.expander.unselectable=true;var expanderText=this.group.expanded?"-":"+";this.expanderTextNode=this.expander.appendChild(document.createTextNode(expanderText));this.headingDiv.appendChild(document.createTextNode(" "+this.group.name));this.contentDiv=this.mainDiv.appendChild(document.createElement("div"));var contentCssClass=this.group.expanded?"expanded":"collapsed";this.contentDiv.className="groupcontent "+contentCssClass;this.expander.onclick=function(){if(groupElementContainer.group.expandable){groupElementContainer.group.toggleExpanded();}};}}','GroupElementContainer.prototype=new LogItemContainerElement();copyProperties(GroupElementContainer.prototype,{toggleExpanded:function(){if(!this.isRoot){var oldCssClass,newCssClass,expanderText;if(this.group.expanded){newCssClass="expanded";oldCssClass="collapsed";expanderText="-";}else{newCssClass="collapsed";oldCssClass="expanded";expanderText="+";}',"replaceClass(this.contentDiv,newCssClass,oldCssClass);this.expanderTextNode.nodeValue=expanderText;}},remove:function(){if(!this.isRoot){this.headingDiv=null;this.expander.onclick=null;this.expander=null;this.expanderTextNode=null;this.contentDiv=null;this.containerDomNode=null;this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;}},reverseChildren:function(){var node=null;var childDomNodes=[];while((node=this.contentDiv.firstChild)){this.contentDiv.removeChild(node);childDomNodes.push(node);}",'while((node=childDomNodes.pop())){this.contentDiv.appendChild(node);}},update:function(){if(!this.isRoot){if(this.group.expandable){removeClass(this.expander,"greyedout");}else{addClass(this.expander,"greyedout");}}},clear:function(){if(this.isRoot){this.contentDiv.innerHTML="";}}});function Group(name,isRoot,initiallyExpanded){this.name=name;this.group=null;this.isRoot=isRoot;this.initiallyExpanded=initiallyExpanded;this.elementContainers=[];this.children=[];this.expanded=initiallyExpanded;this.rendered=false;this.expandable=false;}',"Group.prototype=new LogItem();copyProperties(Group.prototype,{addChild:function(logItem){this.children.push(logItem);logItem.group=this;},render:function(){if(isIe){var unwrappedDomContainer,wrappedDomContainer;if(this.isRoot){unwrappedDomContainer=logMainContainer;wrappedDomContainer=logMainContainer;}else{unwrappedDomContainer=this.getUnwrappedDomContainer();wrappedDomContainer=this.getWrappedDomContainer();}","this.unwrappedElementContainer=new GroupElementContainer(this,unwrappedDomContainer,this.isRoot,false);this.wrappedElementContainer=new GroupElementContainer(this,wrappedDomContainer,this.isRoot,true);this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{var mainDomContainer=this.isRoot?logMainContainer:this.getMainDomContainer();this.mainElementContainer=new GroupElementContainer(this,mainDomContainer,this.isRoot,false);this.elementContainers=[this.mainElementContainer];}","this.rendered=true;},toggleExpanded:function(){this.expanded=!this.expanded;for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].toggleExpanded();}},expand:function(){if(!this.expanded){this.toggleExpanded();}},accept:function(visitor){visitor.visitGroup(this);},reverseChildren:function(){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].reverseChildren();}}},update:function(){var previouslyExpandable=this.expandable;this.expandable=(this.children.length!==0);if(this.expandable!==previouslyExpandable){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].update();}}},flatten:function(){var visitor=new GroupFlattener();this.accept(visitor);return visitor.logEntriesAndSeparators;},removeChild:function(child,doUpdate){array_remove(this.children,child);child.group=null;if(doUpdate){this.update();}},remove:function(doUpdate,removeFromGroup){for(var i=0,len=this.children.length;i<len;i++){this.children[i].remove(false,false);}","this.children=[];this.update();if(this===currentGroup){currentGroup=this.group;}","this.doRemove(doUpdate,removeFromGroup);},serialize:function(items){items.push([LogItem.serializedItemKeys.GROUP_START,this.name]);for(var i=0,len=this.children.length;i<len;i++){this.children[i].serialize(items);}","if(this!==currentGroup){items.push([LogItem.serializedItemKeys.GROUP_END]);}},clear:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clear();}}});function LogEntryElementContainer(){}",'LogEntryElementContainer.prototype=new LogItemContainerElement();copyProperties(LogEntryElementContainer.prototype,{remove:function(){this.doRemove();},doRemove:function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;this.contentElement=null;this.containerDomNode=null;},setContent:function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=content;}},setSearchMatch:function(isMatch){var oldCssClass=isMatch?"searchnonmatch":"searchmatch";var newCssClass=isMatch?"searchmatch":"searchnonmatch";replaceClass(this.mainDiv,newCssClass,oldCssClass);},clearSearch:function(){removeClass(this.mainDiv,"searchmatch");removeClass(this.mainDiv,"searchnonmatch");}});function LogEntryWrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.mainDiv.className="logentry wrapped "+this.logEntry.level;this.contentElement=this.mainDiv;}','LogEntryWrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryWrappedElementContainer.prototype.setContent=function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=wrappedContent;}};function LogEntryUnwrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry unwrapped "+this.logEntry.level;this.pre=this.mainDiv.appendChild(document.createElement("pre"));this.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.pre.className="unwrapped";this.contentElement=this.pre;}','LogEntryUnwrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryUnwrappedElementContainer.prototype.remove=function(){this.doRemove();this.pre=null;};function LogEntryMainElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry nonielogentry "+this.logEntry.level;this.contentElement=this.mainDiv.appendChild(document.createElement("span"));this.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));}',"LogEntryMainElementContainer.prototype=new LogEntryElementContainer();function LogEntry(level,formattedMessage){this.level=level;this.formattedMessage=formattedMessage;this.rendered=false;}",'LogEntry.prototype=new LogItem();copyProperties(LogEntry.prototype,{render:function(){var logEntry=this;var containerDomNode=this.group.contentDiv;if(isIe){this.formattedMessage=this.formattedMessage.replace(/\\r\\n/g,"\\r");this.unwrappedElementContainer=new LogEntryUnwrappedElementContainer(this,this.getUnwrappedDomContainer());this.wrappedElementContainer=new LogEntryWrappedElementContainer(this,this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new LogEntryMainElementContainer(this,this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}','this.content=this.formattedMessage;this.rendered=true;},setContent:function(content,wrappedContent){if(content!=this.content){if(isIe&&(content!==this.formattedMessage)){content=content.replace(/\\r\\n/g,"\\r");}',"for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setContent(content,wrappedContent);}",'this.content=content;}},getSearchMatches:function(){var matches=[];var i,len;if(isIe){var unwrappedEls=getElementsByClass(this.unwrappedElementContainer.mainDiv,"searchterm","span");var wrappedEls=getElementsByClass(this.wrappedElementContainer.mainDiv,"searchterm","span");for(i=0,len=unwrappedEls.length;i<len;i++){matches[i]=new Match(this.level,null,unwrappedEls[i],wrappedEls[i]);}}else{var els=getElementsByClass(this.mainElementContainer.mainDiv,"searchterm","span");for(i=0,len=els.length;i<len;i++){matches[i]=new Match(this.level,els[i]);}}',"return matches;},setSearchMatch:function(isMatch){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setSearchMatch(isMatch);}},clearSearch:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clearSearch();}},accept:function(visitor){visitor.visitLogEntry(this);},serialize:function(items){items.push([LogItem.serializedItemKeys.LOG_ENTRY,this.level,this.formattedMessage]);}});function LogItemVisitor(){}","LogItemVisitor.prototype={visit:function(logItem){},visitParent:function(logItem){if(logItem.group){logItem.group.accept(this);}},visitChildren:function(logItem){for(var i=0,len=logItem.children.length;i<len;i++){logItem.children[i].accept(this);}},visitLogEntry:function(logEntry){this.visit(logEntry);},visitSeparator:function(separator){this.visit(separator);},visitGroup:function(group){this.visit(group);}};function GroupFlattener(){this.logEntriesAndSeparators=[];}",'GroupFlattener.prototype=new LogItemVisitor();GroupFlattener.prototype.visitGroup=function(group){this.visitChildren(group);};GroupFlattener.prototype.visitLogEntry=function(logEntry){this.logEntriesAndSeparators.push(logEntry);};GroupFlattener.prototype.visitSeparator=function(separator){this.logEntriesAndSeparators.push(separator);};window.onload=function(){if(location.search){var queryBits=unescape(location.search).substr(1).split("&"),nameValueBits;for(var i=0,len=queryBits.length;i<len;i++){nameValueBits=queryBits[i].split("=");if(nameValueBits[0]=="log4javascript_domain"){document.domain=nameValueBits[1];break;}}}','logMainContainer=$("log");if(isIePre7){addClass(logMainContainer,"oldIe");}','rootGroup=new Group("root",true);rootGroup.render();currentGroup=rootGroup;setCommandInputWidth();setLogContainerHeight();toggleLoggingEnabled();toggleSearchEnabled();toggleSearchFilter();toggleSearchHighlight();applyFilters();checkAllLevels();toggleWrap();toggleNewestAtTop();toggleScrollToLatest();renderQueuedLogItems();loaded=true;$("command").value="";$("command").autocomplete="off";$("command").onkeydown=function(evt){evt=getEvent(evt);if(evt.keyCode==10||evt.keyCode==13){evalCommandLine();stopPropagation(evt);}else if(evt.keyCode==27){this.value="";this.focus();}else if(evt.keyCode==38&&commandHistory.length>0){currentCommandIndex=Math.max(0,currentCommandIndex-1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}else if(evt.keyCode==40&&commandHistory.length>0){currentCommandIndex=Math.min(commandHistory.length-1,currentCommandIndex+1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}};$("command").onkeypress=function(evt){evt=getEvent(evt);if(evt.keyCode==38&&commandHistory.length>0&&evt.preventDefault){evt.preventDefault();}};$("command").onkeyup=function(evt){evt=getEvent(evt);if(evt.keyCode==27&&evt.preventDefault){evt.preventDefault();this.focus();}};document.onkeydown=function keyEventHandler(evt){evt=getEvent(evt);switch(evt.keyCode){case 69:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){evalLastCommand();cancelKeyEvent(evt);return false;}',"break;case 75:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusSearch();cancelKeyEvent(evt);return false;}","break;case 40:case 76:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusCommandLine();cancelKeyEvent(evt);return false;}","break;}};setTimeout(setLogContainerHeight,20);setShowCommandLine(showCommandLine);doSearch();};window.onunload=function(){if(mainWindowExists()){appender.unload();}",'appender=null;};function toggleLoggingEnabled(){setLoggingEnabled($("enableLogging").checked);}',"function setLoggingEnabled(enable){loggingEnabled=enable;}","var appender=null;function setAppender(appenderParam){appender=appenderParam;}",'function setShowCloseButton(showCloseButton){$("closeButton").style.display=showCloseButton?"inline":"none";}','function setShowHideButton(showHideButton){$("hideButton").style.display=showHideButton?"inline":"none";}',"var newestAtTop=false;function LogItemContentReverser(){}","LogItemContentReverser.prototype=new LogItemVisitor();LogItemContentReverser.prototype.visitGroup=function(group){group.reverseChildren();this.visitChildren(group);};function setNewestAtTop(isNewestAtTop){var oldNewestAtTop=newestAtTop;var i,iLen,j,jLen;newestAtTop=Boolean(isNewestAtTop);if(oldNewestAtTop!=newestAtTop){var visitor=new LogItemContentReverser();rootGroup.accept(visitor);if(currentSearch){var currentMatch=currentSearch.matches[currentMatchIndex];var matchIndex=0;var matches=[];var actOnLogEntry=function(logEntry){var logEntryMatches=logEntry.getSearchMatches();for(j=0,jLen=logEntryMatches.length;j<jLen;j++){matches[matchIndex]=logEntryMatches[j];if(currentMatch&&logEntryMatches[j].equals(currentMatch)){currentMatchIndex=matchIndex;}","matchIndex++;}};if(newestAtTop){for(i=logEntries.length-1;i>=0;i--){actOnLogEntry(logEntries[i]);}}else{for(i=0,iLen=logEntries.length;i<iLen;i++){actOnLogEntry(logEntries[i]);}}","currentSearch.matches=matches;if(currentMatch){currentMatch.setCurrent();}}else if(scrollToLatest){doScrollToLatest();}}",'$("newestAtTop").checked=isNewestAtTop;}','function toggleNewestAtTop(){var isNewestAtTop=$("newestAtTop").checked;setNewestAtTop(isNewestAtTop);}',"var scrollToLatest=true;function setScrollToLatest(isScrollToLatest){scrollToLatest=isScrollToLatest;if(scrollToLatest){doScrollToLatest();}",'$("scrollToLatest").checked=isScrollToLatest;}','function toggleScrollToLatest(){var isScrollToLatest=$("scrollToLatest").checked;setScrollToLatest(isScrollToLatest);}','function doScrollToLatest(){var l=logMainContainer;if(typeof l.scrollTop!="undefined"){if(newestAtTop){l.scrollTop=0;}else{var latestLogEntry=l.lastChild;if(latestLogEntry){l.scrollTop=l.scrollHeight;}}}}',"var closeIfOpenerCloses=true;function setCloseIfOpenerCloses(isCloseIfOpenerCloses){closeIfOpenerCloses=isCloseIfOpenerCloses;}","var maxMessages=null;function setMaxMessages(max){maxMessages=max;pruneLogEntries();}",'var showCommandLine=false;function setShowCommandLine(isShowCommandLine){showCommandLine=isShowCommandLine;if(loaded){$("commandLine").style.display=showCommandLine?"block":"none";setCommandInputWidth();setLogContainerHeight();}}','function focusCommandLine(){if(loaded){$("command").focus();}}','function focusSearch(){if(loaded){$("searchBox").focus();}}',"function getLogItems(){var items=[];for(var i=0,len=logItems.length;i<len;i++){logItems[i].serialize(items);}","return items;}","function setLogItems(items){var loggingReallyEnabled=loggingEnabled;loggingEnabled=true;for(var i=0,len=items.length;i<len;i++){switch(items[i][0]){case LogItem.serializedItemKeys.LOG_ENTRY:log(items[i][1],items[i][2]);break;case LogItem.serializedItemKeys.GROUP_START:group(items[i][1]);break;case LogItem.serializedItemKeys.GROUP_END:groupEnd();break;}}","loggingEnabled=loggingReallyEnabled;}","function log(logLevel,formattedMessage){if(loggingEnabled){var logEntry=new LogEntry(logLevel,formattedMessage);logEntries.push(logEntry);logEntriesAndSeparators.push(logEntry);logItems.push(logEntry);currentGroup.addChild(logEntry);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}","logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}","function renderQueuedLogItems(){logQueuedEventsTimer=null;var pruned=pruneLogEntries();var initiallyHasMatches=currentSearch?currentSearch.hasMatches():false;for(var i=0,len=logItems.length;i<len;i++){if(!logItems[i].rendered){logItems[i].render();logItems[i].appendToLog();if(currentSearch&&(logItems[i]instanceof LogEntry)){currentSearch.applyTo(logItems[i]);}}}","if(currentSearch){if(pruned){if(currentSearch.hasVisibleMatches()){if(currentMatchIndex===null){setCurrentMatchIndex(0);}","displayMatches();}else{displayNoMatches();}}else if(!initiallyHasMatches&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}}","if(scrollToLatest){doScrollToLatest();}","unrenderedLogItemsExist=false;}","function pruneLogEntries(){if((maxMessages!==null)&&(logEntriesAndSeparators.length>maxMessages)){var numberToDelete=logEntriesAndSeparators.length-maxMessages;var prunedLogEntries=logEntriesAndSeparators.slice(0,numberToDelete);if(currentSearch){currentSearch.removeMatches(prunedLogEntries);}","var group;for(var i=0;i<numberToDelete;i++){group=logEntriesAndSeparators[i].group;array_remove(logItems,logEntriesAndSeparators[i]);array_remove(logEntries,logEntriesAndSeparators[i]);logEntriesAndSeparators[i].remove(true,true);if(group.children.length===0&&group!==currentGroup&&group!==rootGroup){array_remove(logItems,group);group.remove(true,true);}}","logEntriesAndSeparators=array_removeFromStart(logEntriesAndSeparators,numberToDelete);return true;}","return false;}",'function group(name,startExpanded){if(loggingEnabled){initiallyExpanded=(typeof startExpanded==="undefined")?true:Boolean(startExpanded);var newGroup=new Group(name,false,initiallyExpanded);currentGroup.addChild(newGroup);currentGroup=newGroup;logItems.push(newGroup);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}',"logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}","function groupEnd(){currentGroup=(currentGroup===rootGroup)?rootGroup:currentGroup.group;}","function mainPageReloaded(){currentGroup=rootGroup;var separator=new Separator();logEntriesAndSeparators.push(separator);logItems.push(separator);currentGroup.addChild(separator);}","function closeWindow(){if(appender&&mainWindowExists()){appender.close(true);}else{window.close();}}","function hide(){if(appender&&mainWindowExists()){appender.hide();}}",'var mainWindow=window;var windowId="log4javascriptConsoleWindow_"+new Date().getTime()+"_"+(""+Math.random()).substr(2);function setMainWindow(win){mainWindow=win;mainWindow[windowId]=window;if(opener&&closeIfOpenerCloses){pollOpener();}}',"function pollOpener(){if(closeIfOpenerCloses){if(mainWindowExists()){setTimeout(pollOpener,500);}else{closeWindow();}}}","function mainWindowExists(){try{return(mainWindow&&!mainWindow.closed&&mainWindow[windowId]==window);}catch(ex){}","return false;}",'var logLevels=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];function getCheckBox(logLevel){return $("switch_"+logLevel);}','function getIeWrappedLogContainer(){return $("log_wrapped");}','function getIeUnwrappedLogContainer(){return $("log_unwrapped");}',"function applyFilters(){for(var i=0;i<logLevels.length;i++){if(getCheckBox(logLevels[i]).checked){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}","updateSearchFromFilters();}",'function toggleAllLevels(){var turnOn=$("switch_ALL").checked;for(var i=0;i<logLevels.length;i++){getCheckBox(logLevels[i]).checked=turnOn;if(turnOn){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}}','function checkAllLevels(){for(var i=0;i<logLevels.length;i++){if(!getCheckBox(logLevels[i]).checked){getCheckBox("ALL").checked=false;return;}}','getCheckBox("ALL").checked=true;}',"function clearLog(){rootGroup.clear();currentGroup=rootGroup;logEntries=[];logItems=[];logEntriesAndSeparators=[];doSearch();}",'function toggleWrap(){var enable=$("wrap").checked;if(enable){addClass(logMainContainer,"wrap");}else{removeClass(logMainContainer,"wrap");}',"refreshCurrentMatch();}","var searchTimer=null;function scheduleSearch(){try{clearTimeout(searchTimer);}catch(ex){}","searchTimer=setTimeout(doSearch,500);}","function Search(searchTerm,isRegex,searchRegex,isCaseSensitive){this.searchTerm=searchTerm;this.isRegex=isRegex;this.searchRegex=searchRegex;this.isCaseSensitive=isCaseSensitive;this.matches=[];}","Search.prototype={hasMatches:function(){return this.matches.length>0;},hasVisibleMatches:function(){if(this.hasMatches()){for(var i=0;i<this.matches.length;i++){if(this.matches[i].isVisible()){return true;}}}","return false;},match:function(logEntry){var entryText=String(logEntry.formattedMessage);var matchesSearch=false;if(this.isRegex){matchesSearch=this.searchRegex.test(entryText);}else if(this.isCaseSensitive){matchesSearch=(entryText.indexOf(this.searchTerm)>-1);}else{matchesSearch=(entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1);}","return matchesSearch;},getNextVisibleMatchIndex:function(){for(var i=currentMatchIndex+1;i<this.matches.length;i++){if(this.matches[i].isVisible()){return i;}}","for(i=0;i<=currentMatchIndex;i++){if(this.matches[i].isVisible()){return i;}}","return-1;},getPreviousVisibleMatchIndex:function(){for(var i=currentMatchIndex-1;i>=0;i--){if(this.matches[i].isVisible()){return i;}}","for(var i=this.matches.length-1;i>=currentMatchIndex;i--){if(this.matches[i].isVisible()){return i;}}",'return-1;},applyTo:function(logEntry){var doesMatch=this.match(logEntry);if(doesMatch){logEntry.group.expand();logEntry.setSearchMatch(true);var logEntryContent;var wrappedLogEntryContent;var searchTermReplacementStartTag="<span class=\\"searchterm\\">";var searchTermReplacementEndTag="<"+"/span>";var preTagName=isIe?"pre":"span";var preStartTag="<"+preTagName+" class=\\"pre\\">";var preEndTag="<"+"/"+preTagName+">";var startIndex=0;var searchIndex,matchedText,textBeforeMatch;if(this.isRegex){var flags=this.isCaseSensitive?"g":"gi";var capturingRegex=new RegExp("("+this.searchRegex.source+")",flags);var rnd=(""+Math.random()).substr(2);var startToken="%%s"+rnd+"%%";var endToken="%%e"+rnd+"%%";logEntryContent=logEntry.formattedMessage.replace(capturingRegex,startToken+"$1"+endToken);logEntryContent=escapeHtml(logEntryContent);var result;var searchString=logEntryContent;logEntryContent="";wrappedLogEntryContent="";while((searchIndex=searchString.indexOf(startToken,startIndex))>-1){var endTokenIndex=searchString.indexOf(endToken,searchIndex);matchedText=searchString.substring(searchIndex+startToken.length,endTokenIndex);textBeforeMatch=searchString.substring(startIndex,searchIndex);logEntryContent+=preStartTag+textBeforeMatch+preEndTag;logEntryContent+=searchTermReplacementStartTag+preStartTag+matchedText+',"preEndTag+searchTermReplacementEndTag;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+","matchedText+searchTermReplacementEndTag;}","startIndex=endTokenIndex+endToken.length;}",'logEntryContent+=preStartTag+searchString.substr(startIndex)+preEndTag;if(isIe){wrappedLogEntryContent+=searchString.substr(startIndex);}}else{logEntryContent="";wrappedLogEntryContent="";var searchTermReplacementLength=searchTermReplacementStartTag.length+',"this.searchTerm.length+searchTermReplacementEndTag.length;var searchTermLength=this.searchTerm.length;var searchTermLowerCase=this.searchTerm.toLowerCase();var logTextLowerCase=logEntry.formattedMessage.toLowerCase();while((searchIndex=logTextLowerCase.indexOf(searchTermLowerCase,startIndex))>-1){matchedText=escapeHtml(logEntry.formattedMessage.substr(searchIndex,this.searchTerm.length));textBeforeMatch=escapeHtml(logEntry.formattedMessage.substring(startIndex,searchIndex));var searchTermReplacement=searchTermReplacementStartTag+","preStartTag+matchedText+preEndTag+searchTermReplacementEndTag;logEntryContent+=preStartTag+textBeforeMatch+preEndTag+searchTermReplacement;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+","matchedText+searchTermReplacementEndTag;}","startIndex=searchIndex+searchTermLength;}","var textAfterLastMatch=escapeHtml(logEntry.formattedMessage.substr(startIndex));logEntryContent+=preStartTag+textAfterLastMatch+preEndTag;if(isIe){wrappedLogEntryContent+=textAfterLastMatch;}}","logEntry.setContent(logEntryContent,wrappedLogEntryContent);var logEntryMatches=logEntry.getSearchMatches();this.matches=this.matches.concat(logEntryMatches);}else{logEntry.setSearchMatch(false);logEntry.setContent(logEntry.formattedMessage,logEntry.formattedMessage);}","return doesMatch;},removeMatches:function(logEntries){var matchesToRemoveCount=0;var currentMatchRemoved=false;var matchesToRemove=[];var i,iLen,j,jLen;for(i=0,iLen=this.matches.length;i<iLen;i++){for(j=0,jLen=logEntries.length;j<jLen;j++){if(this.matches[i].belongsTo(logEntries[j])){matchesToRemove.push(this.matches[i]);if(i===currentMatchIndex){currentMatchRemoved=true;}}}}","var newMatch=currentMatchRemoved?null:this.matches[currentMatchIndex];if(currentMatchRemoved){for(i=currentMatchIndex,iLen=this.matches.length;i<iLen;i++){if(this.matches[i].isVisible()&&!array_contains(matchesToRemove,this.matches[i])){newMatch=this.matches[i];break;}}}","for(i=0,iLen=matchesToRemove.length;i<iLen;i++){array_remove(this.matches,matchesToRemove[i]);matchesToRemove[i].remove();}","if(this.hasVisibleMatches()){if(newMatch===null){setCurrentMatchIndex(0);}else{var newMatchIndex=0;for(i=0,iLen=this.matches.length;i<iLen;i++){if(newMatch===this.matches[i]){newMatchIndex=i;break;}}","setCurrentMatchIndex(newMatchIndex);}}else{currentMatchIndex=null;displayNoMatches();}}};function getPageOffsetTop(el,container){var currentEl=el;var y=0;while(currentEl&&currentEl!=container){y+=currentEl.offsetTop;currentEl=currentEl.offsetParent;}","return y;}",'function scrollIntoView(el){var logContainer=logMainContainer;if(!$("wrap").checked){var logContainerLeft=logContainer.scrollLeft;var logContainerRight=logContainerLeft+logContainer.offsetWidth;var elLeft=el.offsetLeft;var elRight=elLeft+el.offsetWidth;if(elLeft<logContainerLeft||elRight>logContainerRight){logContainer.scrollLeft=elLeft-(logContainer.offsetWidth-el.offsetWidth)/2;}}',"var logContainerTop=logContainer.scrollTop;var logContainerBottom=logContainerTop+logContainer.offsetHeight;var elTop=getPageOffsetTop(el)-getToolBarsHeight();var elBottom=elTop+el.offsetHeight;if(elTop<logContainerTop||elBottom>logContainerBottom){logContainer.scrollTop=elTop-(logContainer.offsetHeight-el.offsetHeight)/2;}}","function Match(logEntryLevel,spanInMainDiv,spanInUnwrappedPre,spanInWrappedDiv){this.logEntryLevel=logEntryLevel;this.spanInMainDiv=spanInMainDiv;if(isIe){this.spanInUnwrappedPre=spanInUnwrappedPre;this.spanInWrappedDiv=spanInWrappedDiv;}","this.mainSpan=isIe?spanInUnwrappedPre:spanInMainDiv;}",'Match.prototype={equals:function(match){return this.mainSpan===match.mainSpan;},setCurrent:function(){if(isIe){addClass(this.spanInUnwrappedPre,"currentmatch");addClass(this.spanInWrappedDiv,"currentmatch");var elementToScroll=$("wrap").checked?this.spanInWrappedDiv:this.spanInUnwrappedPre;scrollIntoView(elementToScroll);}else{addClass(this.spanInMainDiv,"currentmatch");scrollIntoView(this.spanInMainDiv);}},belongsTo:function(logEntry){if(isIe){return isDescendant(this.spanInUnwrappedPre,logEntry.unwrappedPre);}else{return isDescendant(this.spanInMainDiv,logEntry.mainDiv);}},setNotCurrent:function(){if(isIe){removeClass(this.spanInUnwrappedPre,"currentmatch");removeClass(this.spanInWrappedDiv,"currentmatch");}else{removeClass(this.spanInMainDiv,"currentmatch");}},isOrphan:function(){return isOrphan(this.mainSpan);},isVisible:function(){return getCheckBox(this.logEntryLevel).checked;},remove:function(){if(isIe){this.spanInUnwrappedPre=null;this.spanInWrappedDiv=null;}else{this.spanInMainDiv=null;}}};var currentSearch=null;var currentMatchIndex=null;function doSearch(){var searchBox=$("searchBox");var searchTerm=searchBox.value;var isRegex=$("searchRegex").checked;var isCaseSensitive=$("searchCaseSensitive").checked;var i;if(searchTerm===""){$("searchReset").disabled=true;$("searchNav").style.display="none";removeClass(document.body,"searching");removeClass(searchBox,"hasmatches");removeClass(searchBox,"nomatches");for(i=0;i<logEntries.length;i++){logEntries[i].clearSearch();logEntries[i].setContent(logEntries[i].formattedMessage,logEntries[i].formattedMessage);}','currentSearch=null;setLogContainerHeight();}else{$("searchReset").disabled=false;$("searchNav").style.display="block";var searchRegex;var regexValid;if(isRegex){try{searchRegex=isCaseSensitive?new RegExp(searchTerm,"g"):new RegExp(searchTerm,"gi");regexValid=true;replaceClass(searchBox,"validregex","invalidregex");searchBox.title="Valid regex";}catch(ex){regexValid=false;replaceClass(searchBox,"invalidregex","validregex");searchBox.title="Invalid regex: "+(ex.message?ex.message:(ex.description?ex.description:"unknown error"));return;}}else{searchBox.title="";removeClass(searchBox,"validregex");removeClass(searchBox,"invalidregex");}','addClass(document.body,"searching");currentSearch=new Search(searchTerm,isRegex,searchRegex,isCaseSensitive);for(i=0;i<logEntries.length;i++){currentSearch.applyTo(logEntries[i]);}',"setLogContainerHeight();if(currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}else{displayNoMatches();}}}","function updateSearchFromFilters(){if(currentSearch){if(currentSearch.hasMatches()){if(currentMatchIndex===null){currentMatchIndex=0;}","var currentMatch=currentSearch.matches[currentMatchIndex];if(currentMatch.isVisible()){displayMatches();setCurrentMatchIndex(currentMatchIndex);}else{currentMatch.setNotCurrent();var nextVisibleMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextVisibleMatchIndex>-1){setCurrentMatchIndex(nextVisibleMatchIndex);displayMatches();}else{displayNoMatches();}}}else{displayNoMatches();}}}","function refreshCurrentMatch(){if(currentSearch&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(currentMatchIndex);}}",'function displayMatches(){replaceClass($("searchBox"),"hasmatches","nomatches");$("searchBox").title=""+currentSearch.matches.length+" matches found";$("searchNav").style.display="block";setLogContainerHeight();}','function displayNoMatches(){replaceClass($("searchBox"),"nomatches","hasmatches");$("searchBox").title="No matches found";$("searchNav").style.display="none";setLogContainerHeight();}','function toggleSearchEnabled(enable){enable=(typeof enable=="undefined")?!$("searchDisable").checked:enable;$("searchBox").disabled=!enable;$("searchReset").disabled=!enable;$("searchRegex").disabled=!enable;$("searchNext").disabled=!enable;$("searchPrevious").disabled=!enable;$("searchCaseSensitive").disabled=!enable;$("searchNav").style.display=(enable&&($("searchBox").value!=="")&&currentSearch&&currentSearch.hasVisibleMatches())?"block":"none";if(enable){removeClass($("search"),"greyedout");addClass(document.body,"searching");if($("searchHighlight").checked){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}','if($("searchFilter").checked){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}','$("searchDisable").checked=!enable;}else{addClass($("search"),"greyedout");removeClass(document.body,"searching");removeClass(logMainContainer,"searchhighlight");removeClass(logMainContainer,"searchfilter");}',"setLogContainerHeight();}",'function toggleSearchFilter(){var enable=$("searchFilter").checked;if(enable){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}',"refreshCurrentMatch();}",'function toggleSearchHighlight(){var enable=$("searchHighlight").checked;if(enable){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}}','function clearSearch(){$("searchBox").value="";doSearch();}','function searchNext(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var nextMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextMatchIndex>currentMatchIndex||confirm("Reached the end of the page. Start from the top?")){setCurrentMatchIndex(nextMatchIndex);}}}','function searchPrevious(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var previousMatchIndex=currentSearch.getPreviousVisibleMatchIndex();if(previousMatchIndex<currentMatchIndex||confirm("Reached the start of the page. Continue from the bottom?")){setCurrentMatchIndex(previousMatchIndex);}}}',"function setCurrentMatchIndex(index){currentMatchIndex=index;currentSearch.matches[currentMatchIndex].setCurrent();}",'function addClass(el,cssClass){if(!hasClass(el,cssClass)){if(el.className){el.className+=" "+cssClass;}else{el.className=cssClass;}}}','function hasClass(el,cssClass){if(el.className){var classNames=el.className.split(" ");return array_contains(classNames,cssClass);}',"return false;}",'function removeClass(el,cssClass){if(hasClass(el,cssClass)){var existingClasses=el.className.split(" ");var newClasses=[];for(var i=0,len=existingClasses.length;i<len;i++){if(existingClasses[i]!=cssClass){newClasses[newClasses.length]=existingClasses[i];}}','el.className=newClasses.join(" ");}}',"function replaceClass(el,newCssClass,oldCssClass){removeClass(el,oldCssClass);addClass(el,newCssClass);}","function getElementsByClass(el,cssClass,tagName){var elements=el.getElementsByTagName(tagName);var matches=[];for(var i=0,len=elements.length;i<len;i++){if(hasClass(elements[i],cssClass)){matches.push(elements[i]);}}","return matches;}","function $(id){return document.getElementById(id);}","function isDescendant(node,ancestorNode){while(node!=null){if(node===ancestorNode){return true;}","node=node.parentNode;}","return false;}","function isOrphan(node){var currentNode=node;while(currentNode){if(currentNode==document.body){return false;}","currentNode=currentNode.parentNode;}","return true;}",'function escapeHtml(str){return str.replace(/&/g,"&amp;").replace(/[<]/g,"&lt;").replace(/>/g,"&gt;");}',"function getWindowWidth(){if(window.innerWidth){return window.innerWidth;}else if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth;}else if(document.body){return document.body.clientWidth;}","return 0;}","function getWindowHeight(){if(window.innerHeight){return window.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight;}else if(document.body){return document.body.clientHeight;}","return 0;}",'function getToolBarsHeight(){return $("switches").offsetHeight;}','function getChromeHeight(){var height=getToolBarsHeight();if(showCommandLine){height+=$("commandLine").offsetHeight;}',"return height;}",'function setLogContainerHeight(){if(logMainContainer){var windowHeight=getWindowHeight();$("body").style.height=getWindowHeight()+"px";logMainContainer.style.height=""+','Math.max(0,windowHeight-getChromeHeight())+"px";}}','function setCommandInputWidth(){if(showCommandLine){$("command").style.width=""+Math.max(0,$("commandLineContainer").offsetWidth-','($("evaluateButton").offsetWidth+13))+"px";}}',"window.onresize=function(){setCommandInputWidth();setLogContainerHeight();};if(!Array.prototype.push){Array.prototype.push=function(){for(var i=0,len=arguments.length;i<len;i++){this[this.length]=arguments[i];}","return this.length;};}","if(!Array.prototype.pop){Array.prototype.pop=function(){if(this.length>0){var val=this[this.length-1];this.length=this.length-1;return val;}};}","if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var firstItem=this[0];for(var i=0,len=this.length-1;i<len;i++){this[i]=this[i+1];}","this.length=this.length-1;return firstItem;}};}","if(!Array.prototype.splice){Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount);var itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;var argumentsArray=[];for(var i=0,len=arguments.length;i<len;i++){argumentsArray[i]=arguments[i];}","var itemsToAppend=(argumentsArray.length>2)?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len=itemsToAppend.length;i<len;i++){this.push(itemsToAppend[i]);}","return itemsDeleted;};}","function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break;}}","if(index>=0){arr.splice(index,1);return index;}else{return false;}}","function array_removeFromStart(array,numberToRemove){if(Array.prototype.splice){array.splice(0,numberToRemove);}else{for(var i=numberToRemove,len=array.length;i<len;i++){array[i-numberToRemove]=array[i];}","array.length=array.length-numberToRemove;}","return array;}","function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true;}}","return false;}","function getErrorMessage(ex){if(ex.message){return ex.message;}else if(ex.description){return ex.description;}",'return""+ex;}',"function moveCaretToEnd(input){if(input.setSelectionRange){input.focus();var length=input.value.length;input.setSelectionRange(length,length);}else if(input.createTextRange){var range=input.createTextRange();range.collapse(false);range.select();}","input.focus();}",'function stopPropagation(evt){if(evt.stopPropagation){evt.stopPropagation();}else if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true;}}',"function getEvent(evt){return evt?evt:event;}","function getTarget(evt){return evt.target?evt.target:evt.srcElement;}",'function getRelatedTarget(evt){if(evt.relatedTarget){return evt.relatedTarget;}else if(evt.srcElement){switch(evt.type){case"mouseover":return evt.fromElement;case"mouseout":return evt.toElement;default:return evt.srcElement;}}}',"function cancelKeyEvent(evt){evt.returnValue=false;stopPropagation(evt);}",'function evalCommandLine(){var expr=$("command").value;evalCommand(expr);$("command").value="";}',"function evalLastCommand(){if(lastCommand!=null){evalCommand(lastCommand);}}",'var lastCommand=null;var commandHistory=[];var currentCommandIndex=0;function evalCommand(expr){if(appender){appender.evalCommandAndAppend(expr);}else{var prefix=">>> "+expr+"\\r\\n";try{log("INFO",prefix+eval(expr));}catch(ex){log("ERROR",prefix+"Error: "+getErrorMessage(ex));}}',"if(expr!=commandHistory[commandHistory.length-1]){commandHistory.push(expr);if(appender){appender.storeCommandHistory(commandHistory);}}","currentCommandIndex=(expr==commandHistory[currentCommandIndex])?currentCommandIndex+1:commandHistory.length;lastCommand=expr;}","//]]>","<\/script>",'<style type="text/css">',"body{background-color:white;color:black;padding:0;margin:0;font-family:tahoma,verdana,arial,helvetica,sans-serif;overflow:hidden}div#switchesContainer input{margin-bottom:0}div.toolbar{border-top:solid #ffffff 1px;border-bottom:solid #aca899 1px;background-color:#f1efe7;padding:3px 5px;font-size:68.75%}div.toolbar,div#search input{font-family:tahoma,verdana,arial,helvetica,sans-serif}div.toolbar input.button{padding:0 5px;font-size:100%}div.toolbar input.hidden{display:none}div#switches input#clearButton{margin-left:20px}div#levels label{font-weight:bold}div#levels label,div#options label{margin-right:5px}div#levels label#wrapLabel{font-weight:normal}div#search label{margin-right:10px}div#search label.searchboxlabel{margin-right:0}div#search input{font-size:100%}div#search input.validregex{color:green}div#search input.invalidregex{color:red}div#search input.nomatches{color:white;background-color:#ff6666}div#search input.nomatches{color:white;background-color:#ff6666}div#searchNav{display:none}div#commandLine{display:none}div#commandLine input#command{font-size:100%;font-family:Courier New,Courier}div#commandLine input#evaluateButton{}*.greyedout{color:gray !important;border-color:gray !important}*.greyedout *.alwaysenabled{color:black}*.unselectable{-khtml-user-select:none;-moz-user-select:none;user-select:none}div#log{font-family:Courier New,Courier;font-size:75%;width:100%;overflow:auto;clear:both;position:relative}div.group{border-color:#cccccc;border-style:solid;border-width:1px 0 1px 1px;overflow:visible}div.oldIe div.group,div.oldIe div.group *,div.oldIe *.logentry{height:1%}div.group div.groupheading span.expander{border:solid black 1px;font-family:Courier New,Courier;font-size:0.833em;background-color:#eeeeee;position:relative;top:-1px;color:black;padding:0 2px;cursor:pointer;cursor:hand;height:1%}div.group div.groupcontent{margin-left:10px;padding-bottom:2px;overflow:visible}div.group div.expanded{display:block}div.group div.collapsed{display:none}*.logentry{overflow:visible;display:none;white-space:pre}span.pre{white-space:pre}pre.unwrapped{display:inline !important}pre.unwrapped pre.pre,div.wrapped pre.pre{display:inline}div.wrapped pre.pre{white-space:normal}div.wrapped{display:none}body.searching *.logentry span.currentmatch{color:white !important;background-color:green !important}body.searching div.searchhighlight *.logentry span.searchterm{color:black;background-color:yellow}div.wrap *.logentry{white-space:normal !important;border-width:0 0 1px 0;border-color:#dddddd;border-style:dotted}div.wrap #log_wrapped,#log_unwrapped{display:block}div.wrap #log_unwrapped,#log_wrapped{display:none}div.wrap *.logentry span.pre{overflow:visible;white-space:normal}div.wrap *.logentry pre.unwrapped{display:none}div.wrap *.logentry span.wrapped{display:inline}div.searchfilter *.searchnonmatch{display:none !important}div#log *.TRACE,label#label_TRACE{color:#666666}div#log *.DEBUG,label#label_DEBUG{color:green}div#log *.INFO,label#label_INFO{color:#000099}div#log *.WARN,label#label_WARN{color:#999900}div#log *.ERROR,label#label_ERROR{color:red}div#log *.FATAL,label#label_FATAL{color:#660066}div.TRACE#log *.TRACE,div.DEBUG#log *.DEBUG,div.INFO#log *.INFO,div.WARN#log *.WARN,div.ERROR#log *.ERROR,div.FATAL#log *.FATAL{display:block}div#log div.separator{background-color:#cccccc;margin:5px 0;line-height:1px}","</style>","</head>",'<body id="body">','<div id="switchesContainer">','<div id="switches">','<div id="levels" class="toolbar">',"Filters:",'<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"</div>",'<div id="search" class="toolbar">','<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','<div id="searchNav">','<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"</div>","</div>",'<div id="options" class="toolbar">',"Options:",'<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"</div>","</div>","</div>",'<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','<div id="commandLine" class="toolbar">','<div id="commandLineContainer">',`<input type="text" id="command" title="Enter a JavaScript command here and hit return or press 'Evaluate'" />`,'<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"</div>","</div>","</body>","</html>",""]},defaultCommandLineFunctions=[];ConsoleAppender=function(){};var consoleAppenderIdCounter=1;ConsoleAppender.prototype=new Appender,ConsoleAppender.prototype.create=function(inPage,container,lazyInit,initiallyMinimized,useDocumentWrite,width,height,focusConsoleWindow){var appender=this,initialized=!1,consoleWindowCreated=!1,consoleWindowLoaded=!1,consoleClosed=!1,queuedLoggingEvents=[],isSupported2=!0,consoleAppenderId=consoleAppenderIdCounter++;initiallyMinimized=extractBooleanFromParam(initiallyMinimized,this.defaults.initiallyMinimized),lazyInit=extractBooleanFromParam(lazyInit,this.defaults.lazyInit),useDocumentWrite=extractBooleanFromParam(useDocumentWrite,this.defaults.useDocumentWrite);var newestMessageAtTop=this.defaults.newestMessageAtTop,scrollToLatestMessage=this.defaults.scrollToLatestMessage;width=width||this.defaults.width,height=height||this.defaults.height;var maxMessages=this.defaults.maxMessages,showCommandLine=this.defaults.showCommandLine,commandLineObjectExpansionDepth=this.defaults.commandLineObjectExpansionDepth,showHideButton=this.defaults.showHideButton,showCloseButton=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var init8,createWindow2,safeToAppend,getConsoleWindow,open,appenderName=inPage?"InPageAppender":"PopUpAppender",checkCanConfigure=function(configOptionName){return consoleWindowCreated?(handleError(appenderName+": configuration option '"+configOptionName+"' may not be set after the appender has been initialized"),!1):!0},consoleWindowExists=function(){return consoleWindowLoaded&&isSupported2&&!consoleClosed};this.isNewestMessageAtTop=function(){return newestMessageAtTop},this.setNewestMessageAtTop=function(newestMessageAtTopParam){newestMessageAtTop=bool(newestMessageAtTopParam),consoleWindowExists()&&getConsoleWindow().setNewestAtTop(newestMessageAtTop)},this.isScrollToLatestMessage=function(){return scrollToLatestMessage},this.setScrollToLatestMessage=function(scrollToLatestMessageParam){scrollToLatestMessage=bool(scrollToLatestMessageParam),consoleWindowExists()&&getConsoleWindow().setScrollToLatest(scrollToLatestMessage)},this.getWidth=function(){return width},this.setWidth=function(widthParam){checkCanConfigure("width")&&(width=extractStringFromParam(widthParam,width))},this.getHeight=function(){return height},this.setHeight=function(heightParam){checkCanConfigure("height")&&(height=extractStringFromParam(heightParam,height))},this.getMaxMessages=function(){return maxMessages},this.setMaxMessages=function(maxMessagesParam){maxMessages=extractIntFromParam(maxMessagesParam,maxMessages),consoleWindowExists()&&getConsoleWindow().setMaxMessages(maxMessages)},this.isShowCommandLine=function(){return showCommandLine},this.setShowCommandLine=function(showCommandLineParam){showCommandLine=bool(showCommandLineParam),consoleWindowExists()&&getConsoleWindow().setShowCommandLine(showCommandLine)},this.isShowHideButton=function(){return showHideButton},this.setShowHideButton=function(showHideButtonParam){showHideButton=bool(showHideButtonParam),consoleWindowExists()&&getConsoleWindow().setShowHideButton(showHideButton)},this.isShowCloseButton=function(){return showCloseButton},this.setShowCloseButton=function(showCloseButtonParam){showCloseButton=bool(showCloseButtonParam),consoleWindowExists()&&getConsoleWindow().setShowCloseButton(showCloseButton)},this.getCommandLineObjectExpansionDepth=function(){return commandLineObjectExpansionDepth},this.setCommandLineObjectExpansionDepth=function(commandLineObjectExpansionDepthParam){commandLineObjectExpansionDepth=extractIntFromParam(commandLineObjectExpansionDepthParam,commandLineObjectExpansionDepth)};var minimized=initiallyMinimized;this.isInitiallyMinimized=function(){return initiallyMinimized},this.setInitiallyMinimized=function(initiallyMinimizedParam){checkCanConfigure("initiallyMinimized")&&(initiallyMinimized=bool(initiallyMinimizedParam),minimized=initiallyMinimized)},this.isUseDocumentWrite=function(){return useDocumentWrite},this.setUseDocumentWrite=function(useDocumentWriteParam){checkCanConfigure("useDocumentWrite")&&(useDocumentWrite=bool(useDocumentWriteParam))};function QueuedLoggingEvent(loggingEvent,formattedMessage){this.loggingEvent=loggingEvent,this.levelName=loggingEvent.level.name,this.formattedMessage=formattedMessage}QueuedLoggingEvent.prototype.append=function(){getConsoleWindow().log(this.levelName,this.formattedMessage)};function QueuedGroup(name,initiallyExpanded){this.name=name,this.initiallyExpanded=initiallyExpanded}QueuedGroup.prototype.append=function(){getConsoleWindow().group(this.name,this.initiallyExpanded)};function QueuedGroupEnd(){}QueuedGroupEnd.prototype.append=function(){getConsoleWindow().groupEnd()};var checkAndAppend=function(){safeToAppend(),initialized?consoleClosed&&reopenWhenClosed&&createWindow2():init8(),safeToAppend()&&appendQueuedLoggingEvents()};this.append=function(loggingEvent){if(isSupported2){var formattedMessage=appender.getLayout().formatWithException(loggingEvent);queuedLoggingEvents.push(new QueuedLoggingEvent(loggingEvent,formattedMessage)),checkAndAppend()}},this.group=function(name,initiallyExpanded){isSupported2&&(queuedLoggingEvents.push(new QueuedGroup(name,initiallyExpanded)),checkAndAppend())},this.groupEnd=function(){isSupported2&&(queuedLoggingEvents.push(new QueuedGroupEnd),checkAndAppend())};var appendQueuedLoggingEvents=function(){for(;queuedLoggingEvents.length>0;)queuedLoggingEvents.shift().append();focusConsoleWindow&&getConsoleWindow().focus()};this.setAddedToLogger=function(logger){this.loggers.push(logger),enabled&&!lazyInit&&init8()},this.clear=function(){consoleWindowExists()&&getConsoleWindow().clearLog(),queuedLoggingEvents.length=0},this.focus=function(){consoleWindowExists()&&getConsoleWindow().focus()},this.focusCommandLine=function(){consoleWindowExists()&&getConsoleWindow().focusCommandLine()},this.focusSearch=function(){consoleWindowExists()&&getConsoleWindow().focusSearch()};var commandWindow=window;this.getCommandWindow=function(){return commandWindow},this.setCommandWindow=function(commandWindowParam){commandWindow=commandWindowParam},this.executeLastCommand=function(){consoleWindowExists()&&getConsoleWindow().evalLastCommand()};var commandLayout=new PatternLayout("%m");this.getCommandLayout=function(){return commandLayout},this.setCommandLayout=function(commandLayoutParam){commandLayout=commandLayoutParam},this.evalCommandAndAppend=function(expr){var commandReturnValue={appendResult:!0,isError:!1},commandOutput="";try{var result,i;!commandWindow.eval&&commandWindow.execScript&&commandWindow.execScript("null");var commandLineFunctionsHash={};for(i=0,len=commandLineFunctions.length;i<len;i++)commandLineFunctionsHash[commandLineFunctions[i][0]]=commandLineFunctions[i][1];var objectsToRestore=[],addObjectToRestore=function(name){objectsToRestore.push([name,commandWindow[name]])};addObjectToRestore("appender"),commandWindow.appender=appender,addObjectToRestore("commandReturnValue"),commandWindow.commandReturnValue=commandReturnValue,addObjectToRestore("commandLineFunctionsHash"),commandWindow.commandLineFunctionsHash=commandLineFunctionsHash;var addFunctionToWindow=function(name){addObjectToRestore(name),commandWindow[name]=function(){return this.commandLineFunctionsHash[name](appender,arguments,commandReturnValue)}};for(i=0,len=commandLineFunctions.length;i<len;i++)addFunctionToWindow(commandLineFunctions[i][0]);for(commandWindow===window&&commandWindow.execScript?(addObjectToRestore("evalExpr"),addObjectToRestore("result"),window.evalExpr=expr,commandWindow.execScript("window.result=eval(window.evalExpr);"),result=window.result):result=commandWindow.eval(expr),commandOutput=isUndefined(result)?result:formatObjectExpansion(result,commandLineObjectExpansionDepth),i=0,len=objectsToRestore.length;i<len;i++)commandWindow[objectsToRestore[i][0]]=objectsToRestore[i][1]}catch(ex){commandOutput="Error evaluating command: "+getExceptionStringRep(ex),commandReturnValue.isError=!0}if(commandReturnValue.appendResult){var message=">>> "+expr;isUndefined(commandOutput)||(message+=newLine+commandOutput);var level=commandReturnValue.isError?Level.ERROR:Level.INFO,loggingEvent=new LoggingEvent(null,new Date,level,[message],null),mainLayout=this.getLayout();this.setLayout(commandLayout),this.append(loggingEvent),this.setLayout(mainLayout)}};var commandLineFunctions=defaultCommandLineFunctions.concat([]);this.addCommandLineFunction=function(functionName,commandLineFunction){commandLineFunctions.push([functionName,commandLineFunction])};var commandHistoryCookieName="log4javascriptCommandHistory";this.storeCommandHistory=function(commandHistory){setCookie(commandHistoryCookieName,commandHistory.join(","))};var writeHtml=function(doc){var lines=getConsoleHtmlLines();doc.open();for(var i=0,len2=lines.length;i<len2;i++)doc.writeln(lines[i]);doc.close()};this.setEventTypes(["load","unload"]);var consoleWindowLoadHandler=function(){var win=getConsoleWindow();win.setAppender(appender),win.setNewestAtTop(newestMessageAtTop),win.setScrollToLatest(scrollToLatestMessage),win.setMaxMessages(maxMessages),win.setShowCommandLine(showCommandLine),win.setShowHideButton(showHideButton),win.setShowCloseButton(showCloseButton),win.setMainWindow(window);var storedValue=getCookie(commandHistoryCookieName);storedValue&&(win.commandHistory=storedValue.split(","),win.currentCommandIndex=win.commandHistory.length),appender.dispatchEvent("load",{win})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),consoleClosed||(logLog.debug("really doing unload "+this),consoleClosed=!0,consoleWindowLoaded=!1,consoleWindowCreated=!1,appender.dispatchEvent("unload",{}))};var pollConsoleWindow=function(windowTest,interval,successCallback,errorMessage){function doPoll(){try{consoleClosed&&clearInterval(poll),windowTest(getConsoleWindow())&&(clearInterval(poll),successCallback())}catch(ex){clearInterval(poll),isSupported2=!1,handleError(errorMessage,ex)}}var poll=setInterval(doPoll,interval)},getConsoleUrl=function(){var documentDomainSet=document.domain!=location.hostname;return useDocumentWrite?"":getBaseUrl()+"console.html"+(documentDomainSet?"?log4javascript_domain="+escape(document.domain):"")};if(inPage){var containerElement=null,cssProperties=[];this.addCssProperty=function(name,value){checkCanConfigure("cssProperties")&&cssProperties.push([name,value])};var windowCreationStarted=!1,iframeContainerDiv,iframeId=uniqueId+"_InPageAppender_"+consoleAppenderId;this.hide=function(){initialized&&consoleWindowCreated&&(consoleWindowExists()&&getConsoleWindow().$("command").blur(),iframeContainerDiv.style.display="none",minimized=!0)},this.show=function(){initialized&&(consoleWindowCreated?(iframeContainerDiv.style.display="block",this.setShowCommandLine(showCommandLine),minimized=!1):windowCreationStarted||createWindow2(!0))},this.isVisible=function(){return!minimized&&!consoleClosed},this.close=function(fromButton){!consoleClosed&&(!fromButton||confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?"))&&(iframeContainerDiv.parentNode.removeChild(iframeContainerDiv),this.unload())},open=function(){var initErrorMessage="InPageAppender.open: unable to create console iframe";function finalInit(){try{initiallyMinimized||appender.show(),consoleWindowLoadHandler(),consoleWindowLoaded=!0,appendQueuedLoggingEvents()}catch(ex){isSupported2=!1,handleError(initErrorMessage,ex)}}function writeToDocument(){try{var windowTest=function(win){return isLoaded(win)};useDocumentWrite&&writeHtml(getConsoleWindow().document),windowTest(getConsoleWindow())?finalInit():pollConsoleWindow(windowTest,100,finalInit,initErrorMessage)}catch(ex){isSupported2=!1,handleError(initErrorMessage,ex)}}minimized=!1,iframeContainerDiv=containerElement.appendChild(document.createElement("div")),iframeContainerDiv.style.width=width,iframeContainerDiv.style.height=height,iframeContainerDiv.style.border="solid gray 1px";for(var i=0,len2=cssProperties.length;i<len2;i++)iframeContainerDiv.style[cssProperties[i][0]]=cssProperties[i][1];var iframeSrc=useDocumentWrite?"":" src='"+getConsoleUrl()+"'";iframeContainerDiv.innerHTML="<iframe id='"+iframeId+"' name='"+iframeId+"' width='100%' height='100%' frameborder='0'"+iframeSrc+" scrolling='no'></iframe>",consoleClosed=!1;var iframeDocumentExistsTest=function(win){try{return bool(win)&&bool(win.document)}catch(ex){return!1}};iframeDocumentExistsTest(getConsoleWindow())?writeToDocument():pollConsoleWindow(iframeDocumentExistsTest,100,writeToDocument,initErrorMessage),consoleWindowCreated=!0},createWindow2=function(show){if(show||!initiallyMinimized){var pageLoadHandler=function(){if(!container)containerElement=document.createElement("div"),containerElement.style.position="fixed",containerElement.style.left="0",containerElement.style.right="0",containerElement.style.bottom="0",document.body.appendChild(containerElement),appender.addCssProperty("borderWidth","1px 0 0 0"),appender.addCssProperty("zIndex",1e6),open();else try{var el=document.getElementById(container);el.nodeType==1&&(containerElement=el),open()}catch(ex){handleError("InPageAppender.init: invalid container element '"+container+"' supplied",ex)}};pageLoaded&&container&&container.appendChild?(containerElement=container,open()):pageLoaded?pageLoadHandler():log4javascript.addEventListener("load",pageLoadHandler),windowCreationStarted=!0}},init8=function(){createWindow2(),initialized=!0},getConsoleWindow=function(){var iframe=window.frames[iframeId];if(iframe)return iframe},safeToAppend=function(){return isSupported2&&!consoleClosed?(consoleWindowCreated&&!consoleWindowLoaded&&getConsoleWindow()&&isLoaded(getConsoleWindow())&&(consoleWindowLoaded=!0),consoleWindowLoaded):!1}}else{var useOldPopUp=appender.defaults.useOldPopUp,complainAboutPopUpBlocking=appender.defaults.complainAboutPopUpBlocking,reopenWhenClosed=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return useOldPopUp},this.setUseOldPopUp=function(useOldPopUpParam){checkCanConfigure("useOldPopUp")&&(useOldPopUp=bool(useOldPopUpParam))},this.isComplainAboutPopUpBlocking=function(){return complainAboutPopUpBlocking},this.setComplainAboutPopUpBlocking=function(complainAboutPopUpBlockingParam){checkCanConfigure("complainAboutPopUpBlocking")&&(complainAboutPopUpBlocking=bool(complainAboutPopUpBlockingParam))},this.isFocusPopUp=function(){return focusConsoleWindow},this.setFocusPopUp=function(focusPopUpParam){focusConsoleWindow=bool(focusPopUpParam)},this.isReopenWhenClosed=function(){return reopenWhenClosed},this.setReopenWhenClosed=function(reopenWhenClosedParam){reopenWhenClosed=bool(reopenWhenClosedParam)},this.close=function(){logLog.debug("close "+this);try{popUp.close(),this.unload()}catch(ex){}},this.hide=function(){logLog.debug("hide "+this),consoleWindowExists()&&this.close()},this.show=function(){logLog.debug("show "+this),consoleWindowCreated||open()},this.isVisible=function(){return safeToAppend()};var popUp;open=function(){var windowProperties="width="+width+",height="+height+",status,resizable",frameInfo="";try{var frameEl=window.frameElement;frameEl&&(frameInfo="_"+frameEl.tagName+"_"+(frameEl.name||frameEl.id||""))}catch(e){frameInfo="_inaccessibleParentFrame"}var windowName="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+consoleAppenderId+frameInfo;(!useOldPopUp||!useDocumentWrite)&&(windowName=windowName+"_"+uniqueId);var checkPopUpClosed=function(win){if(consoleClosed)return!0;try{return bool(win)&&win.closed}catch(ex){}return!1},popUpClosedCallback=function(){consoleClosed||appender.unload()};function finalInit(){getConsoleWindow().setCloseIfOpenerCloses(!useOldPopUp||!useDocumentWrite),consoleWindowLoadHandler(),consoleWindowLoaded=!0,appendQueuedLoggingEvents(),pollConsoleWindow(checkPopUpClosed,500,popUpClosedCallback,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{if(popUp=window.open(getConsoleUrl(),windowName,windowProperties),consoleClosed=!1,consoleWindowCreated=!0,popUp&&popUp.document)if(useDocumentWrite&&useOldPopUp&&isLoaded(popUp))popUp.mainPageReloaded(),finalInit();else{useDocumentWrite&&writeHtml(popUp.document);var popUpLoadedTest=function(win){return bool(win)&&isLoaded(win)};isLoaded(popUp)?finalInit():pollConsoleWindow(popUpLoadedTest,100,finalInit,"PopUpAppender.init: unable to create console window")}else isSupported2=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),complainAboutPopUpBlocking&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(ex){handleError("PopUpAppender.init: error creating pop-up",ex)}},createWindow2=function(){initiallyMinimized||open()},init8=function(){createWindow2(),initialized=!0},getConsoleWindow=function(){return popUp},safeToAppend=function(){if(isSupported2&&!isUndefined(popUp)&&!consoleClosed){if(popUp.closed||consoleWindowLoaded&&isUndefined(popUp.closed))return appender.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!consoleWindowLoaded&&isLoaded(popUp)&&(consoleWindowLoaded=!0)}return isSupported2&&consoleWindowLoaded&&!consoleClosed}}this.getConsoleWindow=getConsoleWindow},ConsoleAppender.addGlobalCommandLineFunction=function(functionName,commandLineFunction){defaultCommandLineFunctions.push([functionName,commandLineFunction])};function PopUpAppender(lazyInit,initiallyMinimized,useDocumentWrite,width,height){this.create(!1,null,lazyInit,initiallyMinimized,useDocumentWrite,width,height,this.defaults.focusPopUp)}PopUpAppender.prototype=new ConsoleAppender,PopUpAppender.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},PopUpAppender.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=PopUpAppender;function InPageAppender(container,lazyInit,initiallyMinimized,useDocumentWrite,width,height){this.create(!0,container,lazyInit,initiallyMinimized,useDocumentWrite,width,height,!1)}InPageAppender.prototype=new ConsoleAppender,InPageAppender.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},InPageAppender.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=InPageAppender,log4javascript.InlineAppender=InPageAppender})();function padWithSpaces(str,len2){if(str.length<len2){for(var spaces=[],numberOfSpaces=Math.max(0,len2-str.length),i=0;i<numberOfSpaces;i++)spaces[i]=" ";str+=spaces.join("")}return str}(function(){function dir(obj){var maxLen=0;for(var p in obj)maxLen=Math.max(toStr(p).length,maxLen);var propList=[];for(p in obj){var propNameStr="  "+padWithSpaces(toStr(p),maxLen+2),propVal;try{propVal=splitIntoLines(toStr(obj[p])).join(padWithSpaces(newLine,maxLen+6))}catch(ex){propVal="[Error obtaining property. Details: "+getExceptionMessage(ex)+"]"}propList.push(propNameStr+propVal)}return propList.join(newLine)}var nodeTypes={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},preFormattedElements=["script","pre"],emptyElements=["br","img","hr","param","link","area","input","col","base","meta"],indentationUnit="  ";function getXhtml(rootNode,includeRootNode,indentation,startNewLine,preformatted){includeRootNode=typeof includeRootNode=="undefined"?!0:!!includeRootNode,typeof indentation!="string"&&(indentation=""),startNewLine=!!startNewLine,preformatted=!!preformatted;var xhtml;function isWhitespace(node){return node.nodeType==nodeTypes.TEXT_NODE&&/^[ \t\r\n]*$/.test(node.nodeValue)}function fixAttributeValue(attrValue){return attrValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function getStyleAttributeValue(el){for(var stylePairs=el.style.cssText.split(";"),styleValue2="",j=0,len3=stylePairs.length;j<len3;j++){var nameValueBits=stylePairs[j].split(":"),props=[];/^\s*$/.test(nameValueBits[0])||props.push(trim(nameValueBits[0]).toLowerCase()+":"+trim(nameValueBits[1])),styleValue2=props.join(";")}return styleValue2}function getNamespace(el){if(el.prefix)return el.prefix;if(el.outerHTML){var regex=new RegExp("<([^:]+):"+el.tagName+"[^>]*>","i");if(regex.test(el.outerHTML))return RegExp.$1.toLowerCase()}return""}var lt="<",gt=">",i,len2;if(includeRootNode&&rootNode.nodeType!=nodeTypes.DOCUMENT_FRAGMENT_NODE)switch(rootNode.nodeType){case nodeTypes.ELEMENT_NODE:var tagName=rootNode.tagName.toLowerCase();xhtml=startNewLine?newLine+indentation:"",xhtml+=lt;var prefix=getNamespace(rootNode),hasPrefix=!!prefix;for(hasPrefix&&(xhtml+=prefix+":"),xhtml+=tagName,i=0,len2=rootNode.attributes.length;i<len2;i++){var currentAttr=rootNode.attributes[i];!currentAttr.specified||currentAttr.nodeValue===null||currentAttr.nodeName.toLowerCase()==="style"||typeof currentAttr.nodeValue!="string"||currentAttr.nodeName.indexOf("_moz")===0||(xhtml+=" "+currentAttr.nodeName.toLowerCase()+'="',xhtml+=fixAttributeValue(currentAttr.nodeValue),xhtml+='"')}if(rootNode.style.cssText){var styleValue=getStyleAttributeValue(rootNode);styleValue!==""&&(xhtml+=' style="'+getStyleAttributeValue(rootNode)+'"')}if(array_contains(emptyElements,tagName)||hasPrefix&&!rootNode.hasChildNodes())xhtml+="/"+gt;else{xhtml+=gt;var childStartNewLine=!(rootNode.childNodes.length===1&&rootNode.childNodes[0].nodeType===nodeTypes.TEXT_NODE),childPreformatted=array_contains(preFormattedElements,tagName);for(i=0,len2=rootNode.childNodes.length;i<len2;i++)xhtml+=getXhtml(rootNode.childNodes[i],!0,indentation+indentationUnit,childStartNewLine,childPreformatted);var endTag=lt+"/"+tagName+gt;xhtml+=childStartNewLine?newLine+indentation+endTag:endTag}return xhtml;case nodeTypes.TEXT_NODE:if(isWhitespace(rootNode))xhtml="";else{if(preformatted)xhtml=rootNode.nodeValue;else{var lines=splitIntoLines(trim(rootNode.nodeValue)),trimmedLines=[];for(i=0,len2=lines.length;i<len2;i++)trimmedLines[i]=trim(lines[i]);xhtml=trimmedLines.join(newLine+indentation)}startNewLine&&(xhtml=newLine+indentation+xhtml)}return xhtml;case nodeTypes.CDATA_SECTION_NODE:return"<![CDATA["+rootNode.nodeValue+"]]>"+newLine;case nodeTypes.DOCUMENT_NODE:for(xhtml="",i=0,len2=rootNode.childNodes.length;i<len2;i++)xhtml+=getXhtml(rootNode.childNodes[i],!0,indentation);return xhtml;default:return""}else{for(xhtml="",i=0,len2=rootNode.childNodes.length;i<len2;i++)xhtml+=getXhtml(rootNode.childNodes[i],!0,indentation+indentationUnit);return xhtml}}function createCommandLineFunctions(){ConsoleAppender.addGlobalCommandLineFunction("$",function(appender,args,returnValue){return document.getElementById(args[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(appender,args,returnValue){for(var lines=[],i=0,len2=args.length;i<len2;i++)lines[i]=dir(args[i]);return lines.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(appender,args,returnValue){for(var lines=[],i=0,len2=args.length;i<len2;i++)lines[i]=getXhtml(args[i]);return lines.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(appender,args,returnValue){var win,message;return args.length===0||args[0]===""?(win=window,message="Command line set to run in main window"):args[0].window==args[0]?(win=args[0],message="Command line set to run in frame '"+args[0].name+"'"):(win=window.frames[args[0]],win?message="Command line set to run in frame '"+args[0]+"'":(returnValue.isError=!0,message="Frame '"+args[0]+"' does not exist",win=appender.getCommandWindow())),appender.setCommandWindow(win),message}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(appender,args,returnValue){returnValue.appendResult=!1,appender.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(appender,args,returnValue){var keys2=[];for(var k in args[0])keys2.push(k);return keys2}),ConsoleAppender.addGlobalCommandLineFunction("values",function(appender,args,returnValue){var values=[];for(var k in args[0])try{values.push(args[0][k])}catch(ex){logLog.warn("values(): Unable to obtain value for key "+k+". Details: "+getExceptionMessage(ex))}return values}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(appender,args,returnValue){var expansionDepth=parseInt(args[0],10);return isNaN(expansionDepth)||expansionDepth<0?(returnValue.isError=!0,""+args[0]+" is not a valid expansion depth"):(appender.setCommandLineObjectExpansionDepth(expansionDepth),"Object expansion depth set to "+expansionDepth)})}function init8(){createCommandLineFunctions()}init8()})();function createDefaultLogger(){var logger=log4javascript.getLogger(defaultLoggerName),a=new log4javascript.PopUpAppender;return logger.addAppender(a),logger}if(log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;typeof window.onload!="function"?window.onload=log4javascript.setDocumentReady:window.onload=function(evt){oldOnload&&oldOnload(evt),log4javascript.setDocumentReady()}}return log4javascript},exports)}});var require_arrayWithHoles=__commonJS({"node_modules/@babel/runtime/helpers/arrayWithHoles.js"(exports2,module2){function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}module2.exports=_arrayWithHoles;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_iterableToArrayLimit=__commonJS({"node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"(exports2,module2){function _iterableToArrayLimit(arr,i){var _i=arr&&(typeof Symbol!="undefined"&&arr[Symbol.iterator]||arr["@@iterator"]);if(_i!=null){var _arr=[],_n=!0,_d=!1,_s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!(i&&_arr.length===i));_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return!=null&&_i.return()}finally{if(_d)throw _e}}return _arr}}module2.exports=_iterableToArrayLimit;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_arrayLikeToArray=__commonJS({"node_modules/@babel/runtime/helpers/arrayLikeToArray.js"(exports2,module2){function _arrayLikeToArray(arr,len2){(len2==null||len2>arr.length)&&(len2=arr.length);for(var i=0,arr2=new Array(len2);i<len2;i++)arr2[i]=arr[i];return arr2}module2.exports=_arrayLikeToArray;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_unsupportedIterableToArray=__commonJS({"node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js"(exports2,module2){var arrayLikeToArray=require_arrayLikeToArray();function _unsupportedIterableToArray(o,minLen){if(!!o){if(typeof o=="string")return arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor&&(n=o.constructor.name),n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return arrayLikeToArray(o,minLen)}}module2.exports=_unsupportedIterableToArray;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_nonIterableRest=__commonJS({"node_modules/@babel/runtime/helpers/nonIterableRest.js"(exports2,module2){function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}module2.exports=_nonIterableRest;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_slicedToArray=__commonJS({"node_modules/@babel/runtime/helpers/slicedToArray.js"(exports2,module2){var arrayWithHoles=require_arrayWithHoles(),iterableToArrayLimit=require_iterableToArrayLimit(),unsupportedIterableToArray=require_unsupportedIterableToArray(),nonIterableRest=require_nonIterableRest();function _slicedToArray(arr,i){return arrayWithHoles(arr)||iterableToArrayLimit(arr,i)||unsupportedIterableToArray(arr,i)||nonIterableRest()}module2.exports=_slicedToArray;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_classCallCheck=__commonJS({"node_modules/@babel/runtime/helpers/classCallCheck.js"(exports2,module2){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}module2.exports=_classCallCheck;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_createClass=__commonJS({"node_modules/@babel/runtime/helpers/createClass.js"(exports2,module2){function _defineProperties2(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass2(Constructor,protoProps,staticProps){return protoProps&&_defineProperties2(Constructor.prototype,protoProps),staticProps&&_defineProperties2(Constructor,staticProps),Constructor}module2.exports=_createClass2;module2.exports.default=module2.exports,module2.exports.__esModule=!0}});var require_bundle=__commonJS({"node_modules/automation-events/build/es5/bundle.js"(exports2,module2){(function(global2,factory){typeof exports2=="object"&&typeof module2!="undefined"?factory(exports2,require_slicedToArray(),require_classCallCheck(),require_createClass()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/slicedToArray","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass"],factory):(global2=typeof globalThis!="undefined"?globalThis:global2||self,factory(global2.automationEvents={},global2._slicedToArray,global2._classCallCheck,global2._createClass))})(exports2,function(exports3,_slicedToArray,_classCallCheck,_createClass2){"use strict";function _interopDefaultLegacy(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var _slicedToArray__default=_interopDefaultLegacy(_slicedToArray),_classCallCheck__default=_interopDefaultLegacy(_classCallCheck),_createClass__default=_interopDefaultLegacy(_createClass2),createExtendedExponentialRampToValueAutomationEvent=function(value,endTime,insertTime){return{endTime,insertTime,type:"exponentialRampToValue",value}},createExtendedLinearRampToValueAutomationEvent=function(value,endTime,insertTime){return{endTime,insertTime,type:"linearRampToValue",value}},createSetValueAutomationEvent2=function(value,startTime){return{startTime,type:"setValue",value}},createSetValueCurveAutomationEvent2=function(values,startTime,duration){return{duration,startTime,type:"setValueCurve",values}},getTargetValueAtTime=function(time,valueAtStartTime,_ref){var startTime=_ref.startTime,target=_ref.target,timeConstant=_ref.timeConstant;return target+(valueAtStartTime-target)*Math.exp((startTime-time)/timeConstant)},isExponentialRampToValueAutomationEvent=function(automationEvent){return automationEvent.type==="exponentialRampToValue"},isLinearRampToValueAutomationEvent=function(automationEvent){return automationEvent.type==="linearRampToValue"},isAnyRampToValueAutomationEvent=function(automationEvent){return isExponentialRampToValueAutomationEvent(automationEvent)||isLinearRampToValueAutomationEvent(automationEvent)},isSetValueAutomationEvent=function(automationEvent){return automationEvent.type==="setValue"},isSetValueCurveAutomationEvent=function(automationEvent){return automationEvent.type==="setValueCurve"},getValueOfAutomationEventAtIndexAtTime=function getValueOfAutomationEventAtIndexAtTime2(automationEvents,index3,time,defaultValue3){var automationEvent=automationEvents[index3];return automationEvent===void 0?defaultValue3:isAnyRampToValueAutomationEvent(automationEvent)||isSetValueAutomationEvent(automationEvent)?automationEvent.value:isSetValueCurveAutomationEvent(automationEvent)?automationEvent.values[automationEvent.values.length-1]:getTargetValueAtTime(time,getValueOfAutomationEventAtIndexAtTime2(automationEvents,index3-1,automationEvent.startTime,defaultValue3),automationEvent)},getEndTimeAndValueOfPreviousAutomationEvent=function(automationEvents,index3,currentAutomationEvent,nextAutomationEvent,defaultValue3){return currentAutomationEvent===void 0?[nextAutomationEvent.insertTime,defaultValue3]:isAnyRampToValueAutomationEvent(currentAutomationEvent)?[currentAutomationEvent.endTime,currentAutomationEvent.value]:isSetValueAutomationEvent(currentAutomationEvent)?[currentAutomationEvent.startTime,currentAutomationEvent.value]:isSetValueCurveAutomationEvent(currentAutomationEvent)?[currentAutomationEvent.startTime+currentAutomationEvent.duration,currentAutomationEvent.values[currentAutomationEvent.values.length-1]]:[currentAutomationEvent.startTime,getValueOfAutomationEventAtIndexAtTime(automationEvents,index3-1,currentAutomationEvent.startTime,defaultValue3)]},isCancelAndHoldAutomationEvent=function(automationEvent){return automationEvent.type==="cancelAndHold"},isCancelScheduledValuesAutomationEvent=function(automationEvent){return automationEvent.type==="cancelScheduledValues"},getEventTime=function(automationEvent){return isCancelAndHoldAutomationEvent(automationEvent)||isCancelScheduledValuesAutomationEvent(automationEvent)?automationEvent.cancelTime:isExponentialRampToValueAutomationEvent(automationEvent)||isLinearRampToValueAutomationEvent(automationEvent)?automationEvent.endTime:automationEvent.startTime},getExponentialRampValueAtTime=function(time,startTime,valueAtStartTime,_ref){var endTime=_ref.endTime,value=_ref.value;return valueAtStartTime===value?value:0<valueAtStartTime&&0<value||valueAtStartTime<0&&value<0?valueAtStartTime*Math.pow(value/valueAtStartTime,(time-startTime)/(endTime-startTime)):0},getLinearRampValueAtTime=function(time,startTime,valueAtStartTime,_ref){var endTime=_ref.endTime,value=_ref.value;return valueAtStartTime+(time-startTime)/(endTime-startTime)*(value-valueAtStartTime)},interpolateValue=function(values,theoreticIndex){var lowerIndex=Math.floor(theoreticIndex),upperIndex=Math.ceil(theoreticIndex);return lowerIndex===upperIndex?values[lowerIndex]:(1-(theoreticIndex-lowerIndex))*values[lowerIndex]+(1-(upperIndex-theoreticIndex))*values[upperIndex]},getValueCurveValueAtTime=function(time,_ref){var duration=_ref.duration,startTime=_ref.startTime,values=_ref.values,theoreticIndex=(time-startTime)/duration*(values.length-1);return interpolateValue(values,theoreticIndex)},isSetTargetAutomationEvent=function(automationEvent){return automationEvent.type==="setTarget"},AutomationEventList2=function(){function AutomationEventList3(defaultValue3){_classCallCheck__default.default(this,AutomationEventList3),this._automationEvents=[],this._currenTime=0,this._defaultValue=defaultValue3}return _createClass__default.default(AutomationEventList3,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(automationEvent){var eventTime=getEventTime(automationEvent);if(isCancelAndHoldAutomationEvent(automationEvent)||isCancelScheduledValuesAutomationEvent(automationEvent)){var index3=this._automationEvents.findIndex(function(currentAutomationEvent){return isCancelScheduledValuesAutomationEvent(automationEvent)&&isSetValueCurveAutomationEvent(currentAutomationEvent)?currentAutomationEvent.startTime+currentAutomationEvent.duration>=eventTime:getEventTime(currentAutomationEvent)>=eventTime}),removedAutomationEvent=this._automationEvents[index3];if(index3!==-1&&(this._automationEvents=this._automationEvents.slice(0,index3)),isCancelAndHoldAutomationEvent(automationEvent)){var lastAutomationEvent=this._automationEvents[this._automationEvents.length-1];if(removedAutomationEvent!==void 0&&isAnyRampToValueAutomationEvent(removedAutomationEvent)){if(isSetTargetAutomationEvent(lastAutomationEvent))throw new Error("The internal list is malformed.");var startTime=isSetValueCurveAutomationEvent(lastAutomationEvent)?lastAutomationEvent.startTime+lastAutomationEvent.duration:getEventTime(lastAutomationEvent),startValue=isSetValueCurveAutomationEvent(lastAutomationEvent)?lastAutomationEvent.values[lastAutomationEvent.values.length-1]:lastAutomationEvent.value,value=isExponentialRampToValueAutomationEvent(removedAutomationEvent)?getExponentialRampValueAtTime(eventTime,startTime,startValue,removedAutomationEvent):getLinearRampValueAtTime(eventTime,startTime,startValue,removedAutomationEvent),truncatedAutomationEvent=isExponentialRampToValueAutomationEvent(removedAutomationEvent)?createExtendedExponentialRampToValueAutomationEvent(value,eventTime,this._currenTime):createExtendedLinearRampToValueAutomationEvent(value,eventTime,this._currenTime);this._automationEvents.push(truncatedAutomationEvent)}lastAutomationEvent!==void 0&&isSetTargetAutomationEvent(lastAutomationEvent)&&this._automationEvents.push(createSetValueAutomationEvent2(this.getValue(eventTime),eventTime)),lastAutomationEvent!==void 0&&isSetValueCurveAutomationEvent(lastAutomationEvent)&&lastAutomationEvent.startTime+lastAutomationEvent.duration>eventTime&&(this._automationEvents[this._automationEvents.length-1]=createSetValueCurveAutomationEvent2(new Float32Array([6,7]),lastAutomationEvent.startTime,eventTime-lastAutomationEvent.startTime))}}else{var _index=this._automationEvents.findIndex(function(currentAutomationEvent){return getEventTime(currentAutomationEvent)>eventTime}),previousAutomationEvent=_index===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[_index-1];if(previousAutomationEvent!==void 0&&isSetValueCurveAutomationEvent(previousAutomationEvent)&&getEventTime(previousAutomationEvent)+previousAutomationEvent.duration>eventTime)return!1;var persistentAutomationEvent=isExponentialRampToValueAutomationEvent(automationEvent)?createExtendedExponentialRampToValueAutomationEvent(automationEvent.value,automationEvent.endTime,this._currenTime):isLinearRampToValueAutomationEvent(automationEvent)?createExtendedLinearRampToValueAutomationEvent(automationEvent.value,eventTime,this._currenTime):automationEvent;if(_index===-1)this._automationEvents.push(persistentAutomationEvent);else{if(isSetValueCurveAutomationEvent(automationEvent)&&eventTime+automationEvent.duration>getEventTime(this._automationEvents[_index]))return!1;this._automationEvents.splice(_index,0,persistentAutomationEvent)}}return!0}},{key:"flush",value:function(time){var index3=this._automationEvents.findIndex(function(currentAutomationEvent){return getEventTime(currentAutomationEvent)>time});if(index3>1){var remainingAutomationEvents=this._automationEvents.slice(index3-1),firstRemainingAutomationEvent=remainingAutomationEvents[0];isSetTargetAutomationEvent(firstRemainingAutomationEvent)&&remainingAutomationEvents.unshift(createSetValueAutomationEvent2(getValueOfAutomationEventAtIndexAtTime(this._automationEvents,index3-2,firstRemainingAutomationEvent.startTime,this._defaultValue),firstRemainingAutomationEvent.startTime)),this._automationEvents=remainingAutomationEvents}}},{key:"getValue",value:function(time){if(this._automationEvents.length===0)return this._defaultValue;var indexOfNextEvent=this._automationEvents.findIndex(function(automationEvent){return getEventTime(automationEvent)>time}),nextAutomationEvent=this._automationEvents[indexOfNextEvent],indexOfCurrentEvent=(indexOfNextEvent===-1?this._automationEvents.length:indexOfNextEvent)-1,currentAutomationEvent=this._automationEvents[indexOfCurrentEvent];if(currentAutomationEvent!==void 0&&isSetTargetAutomationEvent(currentAutomationEvent)&&(nextAutomationEvent===void 0||!isAnyRampToValueAutomationEvent(nextAutomationEvent)||nextAutomationEvent.insertTime>time))return getTargetValueAtTime(time,getValueOfAutomationEventAtIndexAtTime(this._automationEvents,indexOfCurrentEvent-1,currentAutomationEvent.startTime,this._defaultValue),currentAutomationEvent);if(currentAutomationEvent!==void 0&&isSetValueAutomationEvent(currentAutomationEvent)&&(nextAutomationEvent===void 0||!isAnyRampToValueAutomationEvent(nextAutomationEvent)))return currentAutomationEvent.value;if(currentAutomationEvent!==void 0&&isSetValueCurveAutomationEvent(currentAutomationEvent)&&(nextAutomationEvent===void 0||!isAnyRampToValueAutomationEvent(nextAutomationEvent)||currentAutomationEvent.startTime+currentAutomationEvent.duration>time))return time<currentAutomationEvent.startTime+currentAutomationEvent.duration?getValueCurveValueAtTime(time,currentAutomationEvent):currentAutomationEvent.values[currentAutomationEvent.values.length-1];if(currentAutomationEvent!==void 0&&isAnyRampToValueAutomationEvent(currentAutomationEvent)&&(nextAutomationEvent===void 0||!isAnyRampToValueAutomationEvent(nextAutomationEvent)))return currentAutomationEvent.value;if(nextAutomationEvent!==void 0&&isExponentialRampToValueAutomationEvent(nextAutomationEvent)){var _getEndTimeAndValueOf=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,indexOfCurrentEvent,currentAutomationEvent,nextAutomationEvent,this._defaultValue),_getEndTimeAndValueOf2=_slicedToArray__default.default(_getEndTimeAndValueOf,2),startTime=_getEndTimeAndValueOf2[0],value=_getEndTimeAndValueOf2[1];return getExponentialRampValueAtTime(time,startTime,value,nextAutomationEvent)}if(nextAutomationEvent!==void 0&&isLinearRampToValueAutomationEvent(nextAutomationEvent)){var _getEndTimeAndValueOf3=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,indexOfCurrentEvent,currentAutomationEvent,nextAutomationEvent,this._defaultValue),_getEndTimeAndValueOf4=_slicedToArray__default.default(_getEndTimeAndValueOf3,2),_startTime=_getEndTimeAndValueOf4[0],_value=_getEndTimeAndValueOf4[1];return getLinearRampValueAtTime(time,_startTime,_value,nextAutomationEvent)}return this._defaultValue}}]),AutomationEventList3}(),createCancelAndHoldAutomationEvent2=function(cancelTime){return{cancelTime,type:"cancelAndHold"}},createCancelScheduledValuesAutomationEvent2=function(cancelTime){return{cancelTime,type:"cancelScheduledValues"}},createExponentialRampToValueAutomationEvent2=function(value,endTime){return{endTime,type:"exponentialRampToValue",value}},createLinearRampToValueAutomationEvent2=function(value,endTime){return{endTime,type:"linearRampToValue",value}},createSetTargetAutomationEvent2=function(target,startTime,timeConstant){return{startTime,target,timeConstant,type:"setTarget"}};exports3.AutomationEventList=AutomationEventList2,exports3.createCancelAndHoldAutomationEvent=createCancelAndHoldAutomationEvent2,exports3.createCancelScheduledValuesAutomationEvent=createCancelScheduledValuesAutomationEvent2,exports3.createExponentialRampToValueAutomationEvent=createExponentialRampToValueAutomationEvent2,exports3.createLinearRampToValueAutomationEvent=createLinearRampToValueAutomationEvent2,exports3.createSetTargetAutomationEvent=createSetTargetAutomationEvent2,exports3.createSetValueAutomationEvent=createSetValueAutomationEvent2,exports3.createSetValueCurveAutomationEvent=createSetValueCurveAutomationEvent2,Object.defineProperty(exports3,"__esModule",{value:!0})})}});var require_tslib=__commonJS({"node_modules/tslib/tslib.js"(exports2,module2){var __extends27,__assign2,__rest2,__decorate2,__param2,__metadata2,__awaiter3,__generator3,__exportStar2,__values2,__read2,__spread2,__spreadArrays2,__spreadArray2,__await2,__asyncGenerator2,__asyncDelegator2,__asyncValues2,__makeTemplateObject2,__importStar2,__importDefault2,__classPrivateFieldGet2,__classPrivateFieldSet2,__createBinding2;(function(factory){var root=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(exports3){factory(createExporter(root,createExporter(exports3)))}):typeof module2=="object"&&typeof module2.exports=="object"?factory(createExporter(root,createExporter(module2.exports))):factory(createExporter(root));function createExporter(exports3,previous){return exports3!==root&&(typeof Object.create=="function"?Object.defineProperty(exports3,"__esModule",{value:!0}):exports3.__esModule=!0),function(id,v){return exports3[id]=previous?previous(id,v):v}}})(function(exporter){var extendStatics26=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};__extends27=function(d,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics26(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},__assign2=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__rest2=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t},__decorate2=function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param2=function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__metadata2=function(metadataKey,metadataValue){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(metadataKey,metadataValue)},__awaiter3=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve4){resolve4(value)})}return new(P||(P=Promise))(function(resolve4,reject2){function fulfilled(value){try{step(generator.next(value))}catch(e){reject2(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject2(e)}}function step(result){result.done?resolve4(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator3=function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},__exportStar2=function(m,o){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(o,p)&&__createBinding2(o,m,p)},__createBinding2=Object.create?function(o,m,k,k2){k2===void 0&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){k2===void 0&&(k2=k),o[k2]=m[k]},__values2=function(o){var s=typeof Symbol=="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},__read2=function(o,n){var m=typeof Symbol=="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{for(;(n===void 0||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar},__spread2=function(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read2(arguments[i]));return ar},__spreadArrays2=function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r},__spreadArray2=function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to},__await2=function(v){return this instanceof __await2?(this.v=v,this):new __await2(v)},__asyncGenerator2=function(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await2?Promise.resolve(r.value.v).then(fulfill,reject2):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject2(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}},__asyncDelegator2=function(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await2(o[n](v)),done:n==="return"}:f?f(v):v}:f}},__asyncValues2=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=o[Symbol.asyncIterator],i;return m?m.call(o):(o=typeof __values2=="function"?__values2(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve4,reject2){v=o[n](v),settle(resolve4,reject2,v.done,v.value)})}}function settle(resolve4,reject2,d,v){Promise.resolve(v).then(function(v2){resolve4({value:v2,done:d})},reject2)}},__makeTemplateObject2=function(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked};var __setModuleDefault=Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v};__importStar2=function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding2(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault2=function(mod){return mod&&mod.__esModule?mod:{default:mod}},__classPrivateFieldGet2=function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state=="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)},__classPrivateFieldSet2=function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state=="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value},exporter("__extends",__extends27),exporter("__assign",__assign2),exporter("__rest",__rest2),exporter("__decorate",__decorate2),exporter("__param",__param2),exporter("__metadata",__metadata2),exporter("__awaiter",__awaiter3),exporter("__generator",__generator3),exporter("__exportStar",__exportStar2),exporter("__createBinding",__createBinding2),exporter("__values",__values2),exporter("__read",__read2),exporter("__spread",__spread2),exporter("__spreadArrays",__spreadArrays2),exporter("__spreadArray",__spreadArray2),exporter("__await",__await2),exporter("__asyncGenerator",__asyncGenerator2),exporter("__asyncDelegator",__asyncDelegator2),exporter("__asyncValues",__asyncValues2),exporter("__makeTemplateObject",__makeTemplateObject2),exporter("__importStar",__importStar2),exporter("__importDefault",__importDefault2),exporter("__classPrivateFieldGet",__classPrivateFieldGet2),exporter("__classPrivateFieldSet",__classPrivateFieldSet2)})}});var require_howler=__commonJS({"node_modules/howler/dist/howler.js"(exports2){(function(){"use strict";var HowlerGlobal2=function(){this.init()};HowlerGlobal2.prototype={init:function(){var self2=this||Howler2;return self2._counter=1e3,self2._html5AudioPool=[],self2.html5PoolSize=10,self2._codecs={},self2._howls=[],self2._muted=!1,self2._volume=1,self2._canPlayEvent="canplaythrough",self2._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,self2.masterGain=null,self2.noAudio=!1,self2.usingWebAudio=!0,self2.autoSuspend=!0,self2.ctx=null,self2.autoUnlock=!0,self2._setup(),self2},volume:function(vol){var self2=this||Howler2;if(vol=parseFloat(vol),self2.ctx||setupAudioContext(),typeof vol!="undefined"&&vol>=0&&vol<=1){if(self2._volume=vol,self2._muted)return self2;self2.usingWebAudio&&self2.masterGain.gain.setValueAtTime(vol,Howler2.ctx.currentTime);for(var i=0;i<self2._howls.length;i++)if(!self2._howls[i]._webAudio)for(var ids=self2._howls[i]._getSoundIds(),j=0;j<ids.length;j++){var sound=self2._howls[i]._soundById(ids[j]);sound&&sound._node&&(sound._node.volume=sound._volume*vol)}return self2}return self2._volume},mute:function(muted){var self2=this||Howler2;self2.ctx||setupAudioContext(),self2._muted=muted,self2.usingWebAudio&&self2.masterGain.gain.setValueAtTime(muted?0:self2._volume,Howler2.ctx.currentTime);for(var i=0;i<self2._howls.length;i++)if(!self2._howls[i]._webAudio)for(var ids=self2._howls[i]._getSoundIds(),j=0;j<ids.length;j++){var sound=self2._howls[i]._soundById(ids[j]);sound&&sound._node&&(sound._node.muted=muted?!0:sound._muted)}return self2},stop:function(){for(var self2=this||Howler2,i=0;i<self2._howls.length;i++)self2._howls[i].stop();return self2},unload:function(){for(var self2=this||Howler2,i=self2._howls.length-1;i>=0;i--)self2._howls[i].unload();return self2.usingWebAudio&&self2.ctx&&typeof self2.ctx.close!="undefined"&&(self2.ctx.close(),self2.ctx=null,setupAudioContext()),self2},codecs:function(ext){return(this||Howler2)._codecs[ext.replace(/^x-/,"")]},_setup:function(){var self2=this||Howler2;if(self2.state=self2.ctx&&self2.ctx.state||"suspended",self2._autoSuspend(),!self2.usingWebAudio)if(typeof Audio!="undefined")try{var test=new Audio;typeof test.oncanplaythrough=="undefined"&&(self2._canPlayEvent="canplay")}catch(e){self2.noAudio=!0}else self2.noAudio=!0;try{var test=new Audio;test.muted&&(self2.noAudio=!0)}catch(e){}return self2.noAudio||self2._setupCodecs(),self2},_setupCodecs:function(){var self2=this||Howler2,audioTest=null;try{audioTest=typeof Audio!="undefined"?new Audio:null}catch(err){return self2}if(!audioTest||typeof audioTest.canPlayType!="function")return self2;var mpegTest=audioTest.canPlayType("audio/mpeg;").replace(/^no$/,""),checkOpera=self2._navigator&&self2._navigator.userAgent.match(/OPR\/([0-6].)/g),isOldOpera=checkOpera&&parseInt(checkOpera[0].split("/")[1],10)<33;return self2._codecs={mp3:!!(!isOldOpera&&(mpegTest||audioTest.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!mpegTest,opus:!!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(audioTest.canPlayType('audio/wav; codecs="1"')||audioTest.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!audioTest.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!audioTest.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(audioTest.canPlayType("audio/x-m4b;")||audioTest.canPlayType("audio/m4b;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(audioTest.canPlayType("audio/x-mp4;")||audioTest.canPlayType("audio/mp4;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!audioTest.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(audioTest.canPlayType("audio/x-flac;")||audioTest.canPlayType("audio/flac;")).replace(/^no$/,"")},self2},_unlockAudio:function(){var self2=this||Howler2;if(!(self2._audioUnlocked||!self2.ctx)){self2._audioUnlocked=!1,self2.autoUnlock=!1,!self2._mobileUnloaded&&self2.ctx.sampleRate!==44100&&(self2._mobileUnloaded=!0,self2.unload()),self2._scratchBuffer=self2.ctx.createBuffer(1,1,22050);var unlock=function(e){for(;self2._html5AudioPool.length<self2.html5PoolSize;)try{var audioNode=new Audio;audioNode._unlocked=!0,self2._releaseHtml5Audio(audioNode)}catch(e2){self2.noAudio=!0;break}for(var i=0;i<self2._howls.length;i++)if(!self2._howls[i]._webAudio)for(var ids=self2._howls[i]._getSoundIds(),j=0;j<ids.length;j++){var sound=self2._howls[i]._soundById(ids[j]);sound&&sound._node&&!sound._node._unlocked&&(sound._node._unlocked=!0,sound._node.load())}self2._autoResume();var source=self2.ctx.createBufferSource();source.buffer=self2._scratchBuffer,source.connect(self2.ctx.destination),typeof source.start=="undefined"?source.noteOn(0):source.start(0),typeof self2.ctx.resume=="function"&&self2.ctx.resume(),source.onended=function(){source.disconnect(0),self2._audioUnlocked=!0,document.removeEventListener("touchstart",unlock,!0),document.removeEventListener("touchend",unlock,!0),document.removeEventListener("click",unlock,!0);for(var i2=0;i2<self2._howls.length;i2++)self2._howls[i2]._emit("unlock")}};return document.addEventListener("touchstart",unlock,!0),document.addEventListener("touchend",unlock,!0),document.addEventListener("click",unlock,!0),self2}},_obtainHtml5Audio:function(){var self2=this||Howler2;if(self2._html5AudioPool.length)return self2._html5AudioPool.pop();var testPlay=new Audio().play();return testPlay&&typeof Promise!="undefined"&&(testPlay instanceof Promise||typeof testPlay.then=="function")&&testPlay.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(audio){var self2=this||Howler2;return audio._unlocked&&self2._html5AudioPool.push(audio),self2},_autoSuspend:function(){var self2=this;if(!(!self2.autoSuspend||!self2.ctx||typeof self2.ctx.suspend=="undefined"||!Howler2.usingWebAudio)){for(var i=0;i<self2._howls.length;i++)if(self2._howls[i]._webAudio){for(var j=0;j<self2._howls[i]._sounds.length;j++)if(!self2._howls[i]._sounds[j]._paused)return self2}return self2._suspendTimer&&clearTimeout(self2._suspendTimer),self2._suspendTimer=setTimeout(function(){if(!!self2.autoSuspend){self2._suspendTimer=null,self2.state="suspending";var handleSuspension=function(){self2.state="suspended",self2._resumeAfterSuspend&&(delete self2._resumeAfterSuspend,self2._autoResume())};self2.ctx.suspend().then(handleSuspension,handleSuspension)}},3e4),self2}},_autoResume:function(){var self2=this;if(!(!self2.ctx||typeof self2.ctx.resume=="undefined"||!Howler2.usingWebAudio))return self2.state==="running"&&self2.ctx.state!=="interrupted"&&self2._suspendTimer?(clearTimeout(self2._suspendTimer),self2._suspendTimer=null):self2.state==="suspended"||self2.state==="running"&&self2.ctx.state==="interrupted"?(self2.ctx.resume().then(function(){self2.state="running";for(var i=0;i<self2._howls.length;i++)self2._howls[i]._emit("resume")}),self2._suspendTimer&&(clearTimeout(self2._suspendTimer),self2._suspendTimer=null)):self2.state==="suspending"&&(self2._resumeAfterSuspend=!0),self2}};var Howler2=new HowlerGlobal2,Howl4=function(o){var self2=this;if(!o.src||o.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}self2.init(o)};Howl4.prototype={init:function(o){var self2=this;return Howler2.ctx||setupAudioContext(),self2._autoplay=o.autoplay||!1,self2._format=typeof o.format!="string"?o.format:[o.format],self2._html5=o.html5||!1,self2._muted=o.mute||!1,self2._loop=o.loop||!1,self2._pool=o.pool||5,self2._preload=typeof o.preload=="boolean"||o.preload==="metadata"?o.preload:!0,self2._rate=o.rate||1,self2._sprite=o.sprite||{},self2._src=typeof o.src!="string"?o.src:[o.src],self2._volume=o.volume!==void 0?o.volume:1,self2._xhr={method:o.xhr&&o.xhr.method?o.xhr.method:"GET",headers:o.xhr&&o.xhr.headers?o.xhr.headers:null,withCredentials:o.xhr&&o.xhr.withCredentials?o.xhr.withCredentials:!1},self2._duration=0,self2._state="unloaded",self2._sounds=[],self2._endTimers={},self2._queue=[],self2._playLock=!1,self2._onend=o.onend?[{fn:o.onend}]:[],self2._onfade=o.onfade?[{fn:o.onfade}]:[],self2._onload=o.onload?[{fn:o.onload}]:[],self2._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[],self2._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[],self2._onpause=o.onpause?[{fn:o.onpause}]:[],self2._onplay=o.onplay?[{fn:o.onplay}]:[],self2._onstop=o.onstop?[{fn:o.onstop}]:[],self2._onmute=o.onmute?[{fn:o.onmute}]:[],self2._onvolume=o.onvolume?[{fn:o.onvolume}]:[],self2._onrate=o.onrate?[{fn:o.onrate}]:[],self2._onseek=o.onseek?[{fn:o.onseek}]:[],self2._onunlock=o.onunlock?[{fn:o.onunlock}]:[],self2._onresume=[],self2._webAudio=Howler2.usingWebAudio&&!self2._html5,typeof Howler2.ctx!="undefined"&&Howler2.ctx&&Howler2.autoUnlock&&Howler2._unlockAudio(),Howler2._howls.push(self2),self2._autoplay&&self2._queue.push({event:"play",action:function(){self2.play()}}),self2._preload&&self2._preload!=="none"&&self2.load(),self2},load:function(){var self2=this,url3=null;if(Howler2.noAudio){self2._emit("loaderror",null,"No audio support.");return}typeof self2._src=="string"&&(self2._src=[self2._src]);for(var i=0;i<self2._src.length;i++){var ext,str;if(self2._format&&self2._format[i])ext=self2._format[i];else{if(str=self2._src[i],typeof str!="string"){self2._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}ext=/^data:audio\/([^;,]+);/i.exec(str),ext||(ext=/\.([^.]+)$/.exec(str.split("?",1)[0])),ext&&(ext=ext[1].toLowerCase())}if(ext||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),ext&&Howler2.codecs(ext)){url3=self2._src[i];break}}if(!url3){self2._emit("loaderror",null,"No codec support for selected audio sources.");return}return self2._src=url3,self2._state="loading",window.location.protocol==="https:"&&url3.slice(0,5)==="http:"&&(self2._html5=!0,self2._webAudio=!1),new Sound3(self2),self2._webAudio&&loadBuffer(self2),self2},play:function(sprite,internal){var self2=this,id=null;if(typeof sprite=="number")id=sprite,sprite=null;else{if(typeof sprite=="string"&&self2._state==="loaded"&&!self2._sprite[sprite])return null;if(typeof sprite=="undefined"&&(sprite="__default",!self2._playLock)){for(var num=0,i=0;i<self2._sounds.length;i++)self2._sounds[i]._paused&&!self2._sounds[i]._ended&&(num++,id=self2._sounds[i]._id);num===1?sprite=null:id=null}}var sound=id?self2._soundById(id):self2._inactiveSound();if(!sound)return null;if(id&&!sprite&&(sprite=sound._sprite||"__default"),self2._state!=="loaded"){sound._sprite=sprite,sound._ended=!1;var soundId=sound._id;return self2._queue.push({event:"play",action:function(){self2.play(soundId)}}),soundId}if(id&&!sound._paused)return internal||self2._loadQueue("play"),sound._id;self2._webAudio&&Howler2._autoResume();var seek=Math.max(0,sound._seek>0?sound._seek:self2._sprite[sprite][0]/1e3),duration=Math.max(0,(self2._sprite[sprite][0]+self2._sprite[sprite][1])/1e3-seek),timeout=duration*1e3/Math.abs(sound._rate),start2=self2._sprite[sprite][0]/1e3,stop=(self2._sprite[sprite][0]+self2._sprite[sprite][1])/1e3;sound._sprite=sprite,sound._ended=!1;var setParams=function(){sound._paused=!1,sound._seek=seek,sound._start=start2,sound._stop=stop,sound._loop=!!(sound._loop||self2._sprite[sprite][2])};if(seek>=stop){self2._ended(sound);return}var node=sound._node;if(self2._webAudio){var playWebAudio=function(){self2._playLock=!1,setParams(),self2._refreshBuffer(sound);var vol=sound._muted||self2._muted?0:sound._volume;node.gain.setValueAtTime(vol,Howler2.ctx.currentTime),sound._playStart=Howler2.ctx.currentTime,typeof node.bufferSource.start=="undefined"?sound._loop?node.bufferSource.noteGrainOn(0,seek,86400):node.bufferSource.noteGrainOn(0,seek,duration):sound._loop?node.bufferSource.start(0,seek,86400):node.bufferSource.start(0,seek,duration),timeout!==Infinity&&(self2._endTimers[sound._id]=setTimeout(self2._ended.bind(self2,sound),timeout)),internal||setTimeout(function(){self2._emit("play",sound._id),self2._loadQueue()},0)};Howler2.state==="running"&&Howler2.ctx.state!=="interrupted"?playWebAudio():(self2._playLock=!0,self2.once("resume",playWebAudio),self2._clearTimer(sound._id))}else{var playHtml5=function(){node.currentTime=seek,node.muted=sound._muted||self2._muted||Howler2._muted||node.muted,node.volume=sound._volume*Howler2.volume(),node.playbackRate=sound._rate;try{var play=node.play();if(play&&typeof Promise!="undefined"&&(play instanceof Promise||typeof play.then=="function")?(self2._playLock=!0,setParams(),play.then(function(){self2._playLock=!1,node._unlocked=!0,internal||(self2._emit("play",sound._id),self2._loadQueue())}).catch(function(){self2._playLock=!1,self2._emit("playerror",sound._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),sound._ended=!0,sound._paused=!0})):internal||(self2._playLock=!1,setParams(),self2._emit("play",sound._id),self2._loadQueue()),node.playbackRate=sound._rate,node.paused){self2._emit("playerror",sound._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}sprite!=="__default"||sound._loop?self2._endTimers[sound._id]=setTimeout(self2._ended.bind(self2,sound),timeout):(self2._endTimers[sound._id]=function(){self2._ended(sound),node.removeEventListener("ended",self2._endTimers[sound._id],!1)},node.addEventListener("ended",self2._endTimers[sound._id],!1))}catch(err){self2._emit("playerror",sound._id,err)}};node.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(node.src=self2._src,node.load());var loadedNoReadyState=window&&window.ejecta||!node.readyState&&Howler2._navigator.isCocoonJS;if(node.readyState>=3||loadedNoReadyState)playHtml5();else{self2._playLock=!0;var listener=function(){playHtml5(),node.removeEventListener(Howler2._canPlayEvent,listener,!1)};node.addEventListener(Howler2._canPlayEvent,listener,!1),self2._clearTimer(sound._id)}}return sound._id},pause:function(id){var self2=this;if(self2._state!=="loaded"||self2._playLock)return self2._queue.push({event:"pause",action:function(){self2.pause(id)}}),self2;for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){self2._clearTimer(ids[i]);var sound=self2._soundById(ids[i]);if(sound&&!sound._paused&&(sound._seek=self2.seek(ids[i]),sound._rateSeek=0,sound._paused=!0,self2._stopFade(ids[i]),sound._node))if(self2._webAudio){if(!sound._node.bufferSource)continue;typeof sound._node.bufferSource.stop=="undefined"?sound._node.bufferSource.noteOff(0):sound._node.bufferSource.stop(0),self2._cleanBuffer(sound._node)}else(!isNaN(sound._node.duration)||sound._node.duration===Infinity)&&sound._node.pause();arguments[1]||self2._emit("pause",sound?sound._id:null)}return self2},stop:function(id,internal){var self2=this;if(self2._state!=="loaded"||self2._playLock)return self2._queue.push({event:"stop",action:function(){self2.stop(id)}}),self2;for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){self2._clearTimer(ids[i]);var sound=self2._soundById(ids[i]);sound&&(sound._seek=sound._start||0,sound._rateSeek=0,sound._paused=!0,sound._ended=!0,self2._stopFade(ids[i]),sound._node&&(self2._webAudio?sound._node.bufferSource&&(typeof sound._node.bufferSource.stop=="undefined"?sound._node.bufferSource.noteOff(0):sound._node.bufferSource.stop(0),self2._cleanBuffer(sound._node)):(!isNaN(sound._node.duration)||sound._node.duration===Infinity)&&(sound._node.currentTime=sound._start||0,sound._node.pause(),sound._node.duration===Infinity&&self2._clearSound(sound._node))),internal||self2._emit("stop",sound._id))}return self2},mute:function(muted,id){var self2=this;if(self2._state!=="loaded"||self2._playLock)return self2._queue.push({event:"mute",action:function(){self2.mute(muted,id)}}),self2;if(typeof id=="undefined")if(typeof muted=="boolean")self2._muted=muted;else return self2._muted;for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){var sound=self2._soundById(ids[i]);sound&&(sound._muted=muted,sound._interval&&self2._stopFade(sound._id),self2._webAudio&&sound._node?sound._node.gain.setValueAtTime(muted?0:sound._volume,Howler2.ctx.currentTime):sound._node&&(sound._node.muted=Howler2._muted?!0:muted),self2._emit("mute",sound._id))}return self2},volume:function(){var self2=this,args=arguments,vol,id;if(args.length===0)return self2._volume;if(args.length===1||args.length===2&&typeof args[1]=="undefined"){var ids=self2._getSoundIds(),index3=ids.indexOf(args[0]);index3>=0?id=parseInt(args[0],10):vol=parseFloat(args[0])}else args.length>=2&&(vol=parseFloat(args[0]),id=parseInt(args[1],10));var sound;if(typeof vol!="undefined"&&vol>=0&&vol<=1){if(self2._state!=="loaded"||self2._playLock)return self2._queue.push({event:"volume",action:function(){self2.volume.apply(self2,args)}}),self2;typeof id=="undefined"&&(self2._volume=vol),id=self2._getSoundIds(id);for(var i=0;i<id.length;i++)sound=self2._soundById(id[i]),sound&&(sound._volume=vol,args[2]||self2._stopFade(id[i]),self2._webAudio&&sound._node&&!sound._muted?sound._node.gain.setValueAtTime(vol,Howler2.ctx.currentTime):sound._node&&!sound._muted&&(sound._node.volume=vol*Howler2.volume()),self2._emit("volume",sound._id))}else return sound=id?self2._soundById(id):self2._sounds[0],sound?sound._volume:0;return self2},fade:function(from,to,len2,id){var self2=this;if(self2._state!=="loaded"||self2._playLock)return self2._queue.push({event:"fade",action:function(){self2.fade(from,to,len2,id)}}),self2;from=Math.min(Math.max(0,parseFloat(from)),1),to=Math.min(Math.max(0,parseFloat(to)),1),len2=parseFloat(len2),self2.volume(from,id);for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){var sound=self2._soundById(ids[i]);if(sound){if(id||self2._stopFade(ids[i]),self2._webAudio&&!sound._muted){var currentTime=Howler2.ctx.currentTime,end=currentTime+len2/1e3;sound._volume=from,sound._node.gain.setValueAtTime(from,currentTime),sound._node.gain.linearRampToValueAtTime(to,end)}self2._startFadeInterval(sound,from,to,len2,ids[i],typeof id=="undefined")}}return self2},_startFadeInterval:function(sound,from,to,len2,id,isGroup){var self2=this,vol=from,diff=to-from,steps=Math.abs(diff/.01),stepLen=Math.max(4,steps>0?len2/steps:len2),lastTick=Date.now();sound._fadeTo=to,sound._interval=setInterval(function(){var tick=(Date.now()-lastTick)/len2;lastTick=Date.now(),vol+=diff*tick,vol=Math.round(vol*100)/100,diff<0?vol=Math.max(to,vol):vol=Math.min(to,vol),self2._webAudio?sound._volume=vol:self2.volume(vol,sound._id,!0),isGroup&&(self2._volume=vol),(to<from&&vol<=to||to>from&&vol>=to)&&(clearInterval(sound._interval),sound._interval=null,sound._fadeTo=null,self2.volume(to,sound._id),self2._emit("fade",sound._id))},stepLen)},_stopFade:function(id){var self2=this,sound=self2._soundById(id);return sound&&sound._interval&&(self2._webAudio&&sound._node.gain.cancelScheduledValues(Howler2.ctx.currentTime),clearInterval(sound._interval),sound._interval=null,self2.volume(sound._fadeTo,id),sound._fadeTo=null,self2._emit("fade",id)),self2},loop:function(){var self2=this,args=arguments,loop,id,sound;if(args.length===0)return self2._loop;if(args.length===1)if(typeof args[0]=="boolean")loop=args[0],self2._loop=loop;else return sound=self2._soundById(parseInt(args[0],10)),sound?sound._loop:!1;else args.length===2&&(loop=args[0],id=parseInt(args[1],10));for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++)sound=self2._soundById(ids[i]),sound&&(sound._loop=loop,self2._webAudio&&sound._node&&sound._node.bufferSource&&(sound._node.bufferSource.loop=loop,loop&&(sound._node.bufferSource.loopStart=sound._start||0,sound._node.bufferSource.loopEnd=sound._stop)));return self2},rate:function(){var self2=this,args=arguments,rate,id;if(args.length===0)id=self2._sounds[0]._id;else if(args.length===1){var ids=self2._getSoundIds(),index3=ids.indexOf(args[0]);index3>=0?id=parseInt(args[0],10):rate=parseFloat(args[0])}else args.length===2&&(rate=parseFloat(args[0]),id=parseInt(args[1],10));var sound;if(typeof rate=="number"){if(self2._state!=="loaded"||self2._playLock)return self2._queue.push({event:"rate",action:function(){self2.rate.apply(self2,args)}}),self2;typeof id=="undefined"&&(self2._rate=rate),id=self2._getSoundIds(id);for(var i=0;i<id.length;i++)if(sound=self2._soundById(id[i]),sound){self2.playing(id[i])&&(sound._rateSeek=self2.seek(id[i]),sound._playStart=self2._webAudio?Howler2.ctx.currentTime:sound._playStart),sound._rate=rate,self2._webAudio&&sound._node&&sound._node.bufferSource?sound._node.bufferSource.playbackRate.setValueAtTime(rate,Howler2.ctx.currentTime):sound._node&&(sound._node.playbackRate=rate);var seek=self2.seek(id[i]),duration=(self2._sprite[sound._sprite][0]+self2._sprite[sound._sprite][1])/1e3-seek,timeout=duration*1e3/Math.abs(sound._rate);(self2._endTimers[id[i]]||!sound._paused)&&(self2._clearTimer(id[i]),self2._endTimers[id[i]]=setTimeout(self2._ended.bind(self2,sound),timeout)),self2._emit("rate",sound._id)}}else return sound=self2._soundById(id),sound?sound._rate:self2._rate;return self2},seek:function(){var self2=this,args=arguments,seek,id;if(args.length===0)id=self2._sounds[0]._id;else if(args.length===1){var ids=self2._getSoundIds(),index3=ids.indexOf(args[0]);index3>=0?id=parseInt(args[0],10):self2._sounds.length&&(id=self2._sounds[0]._id,seek=parseFloat(args[0]))}else args.length===2&&(seek=parseFloat(args[0]),id=parseInt(args[1],10));if(typeof id=="undefined")return self2;if(typeof seek=="number"&&(self2._state!=="loaded"||self2._playLock))return self2._queue.push({event:"seek",action:function(){self2.seek.apply(self2,args)}}),self2;var sound=self2._soundById(id);if(sound)if(typeof seek=="number"&&seek>=0){var playing=self2.playing(id);playing&&self2.pause(id,!0),sound._seek=seek,sound._ended=!1,self2._clearTimer(id),!self2._webAudio&&sound._node&&!isNaN(sound._node.duration)&&(sound._node.currentTime=seek);var seekAndEmit=function(){self2._emit("seek",id),playing&&self2.play(id,!0)};if(playing&&!self2._webAudio){var emitSeek=function(){self2._playLock?setTimeout(emitSeek,0):seekAndEmit()};setTimeout(emitSeek,0)}else seekAndEmit()}else if(self2._webAudio){var realTime=self2.playing(id)?Howler2.ctx.currentTime-sound._playStart:0,rateSeek=sound._rateSeek?sound._rateSeek-sound._seek:0;return sound._seek+(rateSeek+realTime*Math.abs(sound._rate))}else return sound._node.currentTime;return self2},playing:function(id){var self2=this;if(typeof id=="number"){var sound=self2._soundById(id);return sound?!sound._paused:!1}for(var i=0;i<self2._sounds.length;i++)if(!self2._sounds[i]._paused)return!0;return!1},duration:function(id){var self2=this,duration=self2._duration,sound=self2._soundById(id);return sound&&(duration=self2._sprite[sound._sprite][1]/1e3),duration},state:function(){return this._state},unload:function(){for(var self2=this,sounds=self2._sounds,i=0;i<sounds.length;i++)sounds[i]._paused||self2.stop(sounds[i]._id),self2._webAudio||(self2._clearSound(sounds[i]._node),sounds[i]._node.removeEventListener("error",sounds[i]._errorFn,!1),sounds[i]._node.removeEventListener(Howler2._canPlayEvent,sounds[i]._loadFn,!1),sounds[i]._node.removeEventListener("ended",sounds[i]._endFn,!1),Howler2._releaseHtml5Audio(sounds[i]._node)),delete sounds[i]._node,self2._clearTimer(sounds[i]._id);var index3=Howler2._howls.indexOf(self2);index3>=0&&Howler2._howls.splice(index3,1);var remCache=!0;for(i=0;i<Howler2._howls.length;i++)if(Howler2._howls[i]._src===self2._src||self2._src.indexOf(Howler2._howls[i]._src)>=0){remCache=!1;break}return cache2&&remCache&&delete cache2[self2._src],Howler2.noAudio=!1,self2._state="unloaded",self2._sounds=[],self2=null,null},on:function(event,fn,id,once){var self2=this,events=self2["_on"+event];return typeof fn=="function"&&events.push(once?{id,fn,once}:{id,fn}),self2},off:function(event,fn,id){var self2=this,events=self2["_on"+event],i=0;if(typeof fn=="number"&&(id=fn,fn=null),fn||id)for(i=0;i<events.length;i++){var isId=id===events[i].id;if(fn===events[i].fn&&isId||!fn&&isId){events.splice(i,1);break}}else if(event)self2["_on"+event]=[];else{var keys2=Object.keys(self2);for(i=0;i<keys2.length;i++)keys2[i].indexOf("_on")===0&&Array.isArray(self2[keys2[i]])&&(self2[keys2[i]]=[])}return self2},once:function(event,fn,id){var self2=this;return self2.on(event,fn,id,1),self2},_emit:function(event,id,msg){for(var self2=this,events=self2["_on"+event],i=events.length-1;i>=0;i--)(!events[i].id||events[i].id===id||event==="load")&&(setTimeout(function(fn){fn.call(this,id,msg)}.bind(self2,events[i].fn),0),events[i].once&&self2.off(event,events[i].fn,events[i].id));return self2._loadQueue(event),self2},_loadQueue:function(event){var self2=this;if(self2._queue.length>0){var task=self2._queue[0];task.event===event&&(self2._queue.shift(),self2._loadQueue()),event||task.action()}return self2},_ended:function(sound){var self2=this,sprite=sound._sprite;if(!self2._webAudio&&sound._node&&!sound._node.paused&&!sound._node.ended&&sound._node.currentTime<sound._stop)return setTimeout(self2._ended.bind(self2,sound),100),self2;var loop=!!(sound._loop||self2._sprite[sprite][2]);if(self2._emit("end",sound._id),!self2._webAudio&&loop&&self2.stop(sound._id,!0).play(sound._id),self2._webAudio&&loop){self2._emit("play",sound._id),sound._seek=sound._start||0,sound._rateSeek=0,sound._playStart=Howler2.ctx.currentTime;var timeout=(sound._stop-sound._start)*1e3/Math.abs(sound._rate);self2._endTimers[sound._id]=setTimeout(self2._ended.bind(self2,sound),timeout)}return self2._webAudio&&!loop&&(sound._paused=!0,sound._ended=!0,sound._seek=sound._start||0,sound._rateSeek=0,self2._clearTimer(sound._id),self2._cleanBuffer(sound._node),Howler2._autoSuspend()),!self2._webAudio&&!loop&&self2.stop(sound._id,!0),self2},_clearTimer:function(id){var self2=this;if(self2._endTimers[id]){if(typeof self2._endTimers[id]!="function")clearTimeout(self2._endTimers[id]);else{var sound=self2._soundById(id);sound&&sound._node&&sound._node.removeEventListener("ended",self2._endTimers[id],!1)}delete self2._endTimers[id]}return self2},_soundById:function(id){for(var self2=this,i=0;i<self2._sounds.length;i++)if(id===self2._sounds[i]._id)return self2._sounds[i];return null},_inactiveSound:function(){var self2=this;self2._drain();for(var i=0;i<self2._sounds.length;i++)if(self2._sounds[i]._ended)return self2._sounds[i].reset();return new Sound3(self2)},_drain:function(){var self2=this,limit=self2._pool,cnt=0,i=0;if(!(self2._sounds.length<limit)){for(i=0;i<self2._sounds.length;i++)self2._sounds[i]._ended&&cnt++;for(i=self2._sounds.length-1;i>=0;i--){if(cnt<=limit)return;self2._sounds[i]._ended&&(self2._webAudio&&self2._sounds[i]._node&&self2._sounds[i]._node.disconnect(0),self2._sounds.splice(i,1),cnt--)}}},_getSoundIds:function(id){var self2=this;if(typeof id=="undefined"){for(var ids=[],i=0;i<self2._sounds.length;i++)ids.push(self2._sounds[i]._id);return ids}else return[id]},_refreshBuffer:function(sound){var self2=this;return sound._node.bufferSource=Howler2.ctx.createBufferSource(),sound._node.bufferSource.buffer=cache2[self2._src],sound._panner?sound._node.bufferSource.connect(sound._panner):sound._node.bufferSource.connect(sound._node),sound._node.bufferSource.loop=sound._loop,sound._loop&&(sound._node.bufferSource.loopStart=sound._start||0,sound._node.bufferSource.loopEnd=sound._stop||0),sound._node.bufferSource.playbackRate.setValueAtTime(sound._rate,Howler2.ctx.currentTime),self2},_cleanBuffer:function(node){var self2=this,isIOS=Howler2._navigator&&Howler2._navigator.vendor.indexOf("Apple")>=0;if(Howler2._scratchBuffer&&node.bufferSource&&(node.bufferSource.onended=null,node.bufferSource.disconnect(0),isIOS))try{node.bufferSource.buffer=Howler2._scratchBuffer}catch(e){}return node.bufferSource=null,self2},_clearSound:function(node){var checkIE=/MSIE |Trident\//.test(Howler2._navigator&&Howler2._navigator.userAgent);checkIE||(node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Sound3=function(howl){this._parent=howl,this.init()};Sound3.prototype={init:function(){var self2=this,parent=self2._parent;return self2._muted=parent._muted,self2._loop=parent._loop,self2._volume=parent._volume,self2._rate=parent._rate,self2._seek=0,self2._paused=!0,self2._ended=!0,self2._sprite="__default",self2._id=++Howler2._counter,parent._sounds.push(self2),self2.create(),self2},create:function(){var self2=this,parent=self2._parent,volume=Howler2._muted||self2._muted||self2._parent._muted?0:self2._volume;return parent._webAudio?(self2._node=typeof Howler2.ctx.createGain=="undefined"?Howler2.ctx.createGainNode():Howler2.ctx.createGain(),self2._node.gain.setValueAtTime(volume,Howler2.ctx.currentTime),self2._node.paused=!0,self2._node.connect(Howler2.masterGain)):Howler2.noAudio||(self2._node=Howler2._obtainHtml5Audio(),self2._errorFn=self2._errorListener.bind(self2),self2._node.addEventListener("error",self2._errorFn,!1),self2._loadFn=self2._loadListener.bind(self2),self2._node.addEventListener(Howler2._canPlayEvent,self2._loadFn,!1),self2._endFn=self2._endListener.bind(self2),self2._node.addEventListener("ended",self2._endFn,!1),self2._node.src=parent._src,self2._node.preload=parent._preload===!0?"auto":parent._preload,self2._node.volume=volume*Howler2.volume(),self2._node.load()),self2},reset:function(){var self2=this,parent=self2._parent;return self2._muted=parent._muted,self2._loop=parent._loop,self2._volume=parent._volume,self2._rate=parent._rate,self2._seek=0,self2._rateSeek=0,self2._paused=!0,self2._ended=!0,self2._sprite="__default",self2._id=++Howler2._counter,self2},_errorListener:function(){var self2=this;self2._parent._emit("loaderror",self2._id,self2._node.error?self2._node.error.code:0),self2._node.removeEventListener("error",self2._errorFn,!1)},_loadListener:function(){var self2=this,parent=self2._parent;parent._duration=Math.ceil(self2._node.duration*10)/10,Object.keys(parent._sprite).length===0&&(parent._sprite={__default:[0,parent._duration*1e3]}),parent._state!=="loaded"&&(parent._state="loaded",parent._emit("load"),parent._loadQueue()),self2._node.removeEventListener(Howler2._canPlayEvent,self2._loadFn,!1)},_endListener:function(){var self2=this,parent=self2._parent;parent._duration===Infinity&&(parent._duration=Math.ceil(self2._node.duration*10)/10,parent._sprite.__default[1]===Infinity&&(parent._sprite.__default[1]=parent._duration*1e3),parent._ended(self2)),self2._node.removeEventListener("ended",self2._endFn,!1)}};var cache2={},loadBuffer=function(self2){var url3=self2._src;if(cache2[url3]){self2._duration=cache2[url3].duration,loadSound(self2);return}if(/^data:[^;]+;base64,/.test(url3)){for(var data=atob(url3.split(",")[1]),dataView=new Uint8Array(data.length),i=0;i<data.length;++i)dataView[i]=data.charCodeAt(i);decodeAudioData2(dataView.buffer,self2)}else{var xhr=new XMLHttpRequest;xhr.open(self2._xhr.method,url3,!0),xhr.withCredentials=self2._xhr.withCredentials,xhr.responseType="arraybuffer",self2._xhr.headers&&Object.keys(self2._xhr.headers).forEach(function(key){xhr.setRequestHeader(key,self2._xhr.headers[key])}),xhr.onload=function(){var code=(xhr.status+"")[0];if(code!=="0"&&code!=="2"&&code!=="3"){self2._emit("loaderror",null,"Failed loading audio file with status: "+xhr.status+".");return}decodeAudioData2(xhr.response,self2)},xhr.onerror=function(){self2._webAudio&&(self2._html5=!0,self2._webAudio=!1,self2._sounds=[],delete cache2[url3],self2.load())},safeXhrSend(xhr)}},safeXhrSend=function(xhr){try{xhr.send()}catch(e){xhr.onerror()}},decodeAudioData2=function(arraybuffer,self2){var error=function(){self2._emit("loaderror",null,"Decoding audio data failed.")},success=function(buffer){buffer&&self2._sounds.length>0?(cache2[self2._src]=buffer,loadSound(self2,buffer)):error()};typeof Promise!="undefined"&&Howler2.ctx.decodeAudioData.length===1?Howler2.ctx.decodeAudioData(arraybuffer).then(success).catch(error):Howler2.ctx.decodeAudioData(arraybuffer,success,error)},loadSound=function(self2,buffer){buffer&&!self2._duration&&(self2._duration=buffer.duration),Object.keys(self2._sprite).length===0&&(self2._sprite={__default:[0,self2._duration*1e3]}),self2._state!=="loaded"&&(self2._state="loaded",self2._emit("load"),self2._loadQueue())},setupAudioContext=function(){if(!!Howler2.usingWebAudio){try{typeof AudioContext!="undefined"?Howler2.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?Howler2.ctx=new webkitAudioContext:Howler2.usingWebAudio=!1}catch(e){Howler2.usingWebAudio=!1}Howler2.ctx||(Howler2.usingWebAudio=!1);var iOS=/iP(hone|od|ad)/.test(Howler2._navigator&&Howler2._navigator.platform),appVersion=Howler2._navigator&&Howler2._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),version3=appVersion?parseInt(appVersion[1],10):null;if(iOS&&version3&&version3<9){var safari2=/safari/.test(Howler2._navigator&&Howler2._navigator.userAgent.toLowerCase());Howler2._navigator&&!safari2&&(Howler2.usingWebAudio=!1)}Howler2.usingWebAudio&&(Howler2.masterGain=typeof Howler2.ctx.createGain=="undefined"?Howler2.ctx.createGainNode():Howler2.ctx.createGain(),Howler2.masterGain.gain.setValueAtTime(Howler2._muted?0:Howler2._volume,Howler2.ctx.currentTime),Howler2.masterGain.connect(Howler2.ctx.destination)),Howler2._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:Howler2,Howl:Howl4}}),typeof exports2!="undefined"&&(exports2.Howler=Howler2,exports2.Howl=Howl4),typeof global!="undefined"?(global.HowlerGlobal=HowlerGlobal2,global.Howler=Howler2,global.Howl=Howl4,global.Sound=Sound3):typeof window!="undefined"&&(window.HowlerGlobal=HowlerGlobal2,window.Howler=Howler2,window.Howl=Howl4,window.Sound=Sound3)})();(function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(pan){var self2=this;if(!self2.ctx||!self2.ctx.listener)return self2;for(var i=self2._howls.length-1;i>=0;i--)self2._howls[i].stereo(pan);return self2},HowlerGlobal.prototype.pos=function(x,y,z){var self2=this;if(!self2.ctx||!self2.ctx.listener)return self2;if(y=typeof y!="number"?self2._pos[1]:y,z=typeof z!="number"?self2._pos[2]:z,typeof x=="number")self2._pos=[x,y,z],typeof self2.ctx.listener.positionX!="undefined"?(self2.ctx.listener.positionX.setTargetAtTime(self2._pos[0],Howler.ctx.currentTime,.1),self2.ctx.listener.positionY.setTargetAtTime(self2._pos[1],Howler.ctx.currentTime,.1),self2.ctx.listener.positionZ.setTargetAtTime(self2._pos[2],Howler.ctx.currentTime,.1)):self2.ctx.listener.setPosition(self2._pos[0],self2._pos[1],self2._pos[2]);else return self2._pos;return self2},HowlerGlobal.prototype.orientation=function(x,y,z,xUp,yUp,zUp){var self2=this;if(!self2.ctx||!self2.ctx.listener)return self2;var or=self2._orientation;if(y=typeof y!="number"?or[1]:y,z=typeof z!="number"?or[2]:z,xUp=typeof xUp!="number"?or[3]:xUp,yUp=typeof yUp!="number"?or[4]:yUp,zUp=typeof zUp!="number"?or[5]:zUp,typeof x=="number")self2._orientation=[x,y,z,xUp,yUp,zUp],typeof self2.ctx.listener.forwardX!="undefined"?(self2.ctx.listener.forwardX.setTargetAtTime(x,Howler.ctx.currentTime,.1),self2.ctx.listener.forwardY.setTargetAtTime(y,Howler.ctx.currentTime,.1),self2.ctx.listener.forwardZ.setTargetAtTime(z,Howler.ctx.currentTime,.1),self2.ctx.listener.upX.setTargetAtTime(xUp,Howler.ctx.currentTime,.1),self2.ctx.listener.upY.setTargetAtTime(yUp,Howler.ctx.currentTime,.1),self2.ctx.listener.upZ.setTargetAtTime(zUp,Howler.ctx.currentTime,.1)):self2.ctx.listener.setOrientation(x,y,z,xUp,yUp,zUp);else return or;return self2},Howl.prototype.init=function(_super){return function(o){var self2=this;return self2._orientation=o.orientation||[1,0,0],self2._stereo=o.stereo||null,self2._pos=o.pos||null,self2._pannerAttr={coneInnerAngle:typeof o.coneInnerAngle!="undefined"?o.coneInnerAngle:360,coneOuterAngle:typeof o.coneOuterAngle!="undefined"?o.coneOuterAngle:360,coneOuterGain:typeof o.coneOuterGain!="undefined"?o.coneOuterGain:0,distanceModel:typeof o.distanceModel!="undefined"?o.distanceModel:"inverse",maxDistance:typeof o.maxDistance!="undefined"?o.maxDistance:1e4,panningModel:typeof o.panningModel!="undefined"?o.panningModel:"HRTF",refDistance:typeof o.refDistance!="undefined"?o.refDistance:1,rolloffFactor:typeof o.rolloffFactor!="undefined"?o.rolloffFactor:1},self2._onstereo=o.onstereo?[{fn:o.onstereo}]:[],self2._onpos=o.onpos?[{fn:o.onpos}]:[],self2._onorientation=o.onorientation?[{fn:o.onorientation}]:[],_super.call(this,o)}}(Howl.prototype.init),Howl.prototype.stereo=function(pan,id){var self2=this;if(!self2._webAudio)return self2;if(self2._state!=="loaded")return self2._queue.push({event:"stereo",action:function(){self2.stereo(pan,id)}}),self2;var pannerType=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof id=="undefined")if(typeof pan=="number")self2._stereo=pan,self2._pos=[pan,0,0];else return self2._stereo;for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){var sound=self2._soundById(ids[i]);if(sound)if(typeof pan=="number")sound._stereo=pan,sound._pos=[pan,0,0],sound._node&&(sound._pannerAttr.panningModel="equalpower",(!sound._panner||!sound._panner.pan)&&setupPanner(sound,pannerType),pannerType==="spatial"?typeof sound._panner.positionX!="undefined"?(sound._panner.positionX.setValueAtTime(pan,Howler.ctx.currentTime),sound._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),sound._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):sound._panner.setPosition(pan,0,0):sound._panner.pan.setValueAtTime(pan,Howler.ctx.currentTime)),self2._emit("stereo",sound._id);else return sound._stereo}return self2},Howl.prototype.pos=function(x,y,z,id){var self2=this;if(!self2._webAudio)return self2;if(self2._state!=="loaded")return self2._queue.push({event:"pos",action:function(){self2.pos(x,y,z,id)}}),self2;if(y=typeof y!="number"?0:y,z=typeof z!="number"?-.5:z,typeof id=="undefined")if(typeof x=="number")self2._pos=[x,y,z];else return self2._pos;for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){var sound=self2._soundById(ids[i]);if(sound)if(typeof x=="number")sound._pos=[x,y,z],sound._node&&((!sound._panner||sound._panner.pan)&&setupPanner(sound,"spatial"),typeof sound._panner.positionX!="undefined"?(sound._panner.positionX.setValueAtTime(x,Howler.ctx.currentTime),sound._panner.positionY.setValueAtTime(y,Howler.ctx.currentTime),sound._panner.positionZ.setValueAtTime(z,Howler.ctx.currentTime)):sound._panner.setPosition(x,y,z)),self2._emit("pos",sound._id);else return sound._pos}return self2},Howl.prototype.orientation=function(x,y,z,id){var self2=this;if(!self2._webAudio)return self2;if(self2._state!=="loaded")return self2._queue.push({event:"orientation",action:function(){self2.orientation(x,y,z,id)}}),self2;if(y=typeof y!="number"?self2._orientation[1]:y,z=typeof z!="number"?self2._orientation[2]:z,typeof id=="undefined")if(typeof x=="number")self2._orientation=[x,y,z];else return self2._orientation;for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++){var sound=self2._soundById(ids[i]);if(sound)if(typeof x=="number")sound._orientation=[x,y,z],sound._node&&(sound._panner||(sound._pos||(sound._pos=self2._pos||[0,0,-.5]),setupPanner(sound,"spatial")),typeof sound._panner.orientationX!="undefined"?(sound._panner.orientationX.setValueAtTime(x,Howler.ctx.currentTime),sound._panner.orientationY.setValueAtTime(y,Howler.ctx.currentTime),sound._panner.orientationZ.setValueAtTime(z,Howler.ctx.currentTime)):sound._panner.setOrientation(x,y,z)),self2._emit("orientation",sound._id);else return sound._orientation}return self2},Howl.prototype.pannerAttr=function(){var self2=this,args=arguments,o,id,sound;if(!self2._webAudio)return self2;if(args.length===0)return self2._pannerAttr;if(args.length===1)if(typeof args[0]=="object")o=args[0],typeof id=="undefined"&&(o.pannerAttr||(o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}),self2._pannerAttr={coneInnerAngle:typeof o.pannerAttr.coneInnerAngle!="undefined"?o.pannerAttr.coneInnerAngle:self2._coneInnerAngle,coneOuterAngle:typeof o.pannerAttr.coneOuterAngle!="undefined"?o.pannerAttr.coneOuterAngle:self2._coneOuterAngle,coneOuterGain:typeof o.pannerAttr.coneOuterGain!="undefined"?o.pannerAttr.coneOuterGain:self2._coneOuterGain,distanceModel:typeof o.pannerAttr.distanceModel!="undefined"?o.pannerAttr.distanceModel:self2._distanceModel,maxDistance:typeof o.pannerAttr.maxDistance!="undefined"?o.pannerAttr.maxDistance:self2._maxDistance,refDistance:typeof o.pannerAttr.refDistance!="undefined"?o.pannerAttr.refDistance:self2._refDistance,rolloffFactor:typeof o.pannerAttr.rolloffFactor!="undefined"?o.pannerAttr.rolloffFactor:self2._rolloffFactor,panningModel:typeof o.pannerAttr.panningModel!="undefined"?o.pannerAttr.panningModel:self2._panningModel});else return sound=self2._soundById(parseInt(args[0],10)),sound?sound._pannerAttr:self2._pannerAttr;else args.length===2&&(o=args[0],id=parseInt(args[1],10));for(var ids=self2._getSoundIds(id),i=0;i<ids.length;i++)if(sound=self2._soundById(ids[i]),sound){var pa=sound._pannerAttr;pa={coneInnerAngle:typeof o.coneInnerAngle!="undefined"?o.coneInnerAngle:pa.coneInnerAngle,coneOuterAngle:typeof o.coneOuterAngle!="undefined"?o.coneOuterAngle:pa.coneOuterAngle,coneOuterGain:typeof o.coneOuterGain!="undefined"?o.coneOuterGain:pa.coneOuterGain,distanceModel:typeof o.distanceModel!="undefined"?o.distanceModel:pa.distanceModel,maxDistance:typeof o.maxDistance!="undefined"?o.maxDistance:pa.maxDistance,refDistance:typeof o.refDistance!="undefined"?o.refDistance:pa.refDistance,rolloffFactor:typeof o.rolloffFactor!="undefined"?o.rolloffFactor:pa.rolloffFactor,panningModel:typeof o.panningModel!="undefined"?o.panningModel:pa.panningModel};var panner=sound._panner;panner?(panner.coneInnerAngle=pa.coneInnerAngle,panner.coneOuterAngle=pa.coneOuterAngle,panner.coneOuterGain=pa.coneOuterGain,panner.distanceModel=pa.distanceModel,panner.maxDistance=pa.maxDistance,panner.refDistance=pa.refDistance,panner.rolloffFactor=pa.rolloffFactor,panner.panningModel=pa.panningModel):(sound._pos||(sound._pos=self2._pos||[0,0,-.5]),setupPanner(sound,"spatial"))}return self2},Sound.prototype.init=function(_super){return function(){var self2=this,parent=self2._parent;self2._orientation=parent._orientation,self2._stereo=parent._stereo,self2._pos=parent._pos,self2._pannerAttr=parent._pannerAttr,_super.call(this),self2._stereo?parent.stereo(self2._stereo):self2._pos&&parent.pos(self2._pos[0],self2._pos[1],self2._pos[2],self2._id)}}(Sound.prototype.init),Sound.prototype.reset=function(_super){return function(){var self2=this,parent=self2._parent;return self2._orientation=parent._orientation,self2._stereo=parent._stereo,self2._pos=parent._pos,self2._pannerAttr=parent._pannerAttr,self2._stereo?parent.stereo(self2._stereo):self2._pos?parent.pos(self2._pos[0],self2._pos[1],self2._pos[2],self2._id):self2._panner&&(self2._panner.disconnect(0),self2._panner=void 0,parent._refreshBuffer(self2)),_super.call(this)}}(Sound.prototype.reset);var setupPanner=function(sound,type){type=type||"spatial",type==="spatial"?(sound._panner=Howler.ctx.createPanner(),sound._panner.coneInnerAngle=sound._pannerAttr.coneInnerAngle,sound._panner.coneOuterAngle=sound._pannerAttr.coneOuterAngle,sound._panner.coneOuterGain=sound._pannerAttr.coneOuterGain,sound._panner.distanceModel=sound._pannerAttr.distanceModel,sound._panner.maxDistance=sound._pannerAttr.maxDistance,sound._panner.refDistance=sound._pannerAttr.refDistance,sound._panner.rolloffFactor=sound._pannerAttr.rolloffFactor,sound._panner.panningModel=sound._pannerAttr.panningModel,typeof sound._panner.positionX!="undefined"?(sound._panner.positionX.setValueAtTime(sound._pos[0],Howler.ctx.currentTime),sound._panner.positionY.setValueAtTime(sound._pos[1],Howler.ctx.currentTime),sound._panner.positionZ.setValueAtTime(sound._pos[2],Howler.ctx.currentTime)):sound._panner.setPosition(sound._pos[0],sound._pos[1],sound._pos[2]),typeof sound._panner.orientationX!="undefined"?(sound._panner.orientationX.setValueAtTime(sound._orientation[0],Howler.ctx.currentTime),sound._panner.orientationY.setValueAtTime(sound._orientation[1],Howler.ctx.currentTime),sound._panner.orientationZ.setValueAtTime(sound._orientation[2],Howler.ctx.currentTime)):sound._panner.setOrientation(sound._orientation[0],sound._orientation[1],sound._orientation[2])):(sound._panner=Howler.ctx.createStereoPanner(),sound._panner.pan.setValueAtTime(sound._stereo,Howler.ctx.currentTime)),sound._panner.connect(sound._node),sound._paused||sound._parent.pause(sound._id,!0).play(sound._id,!0)}})()}});var require_common=__commonJS({"node_modules/pako/lib/utils/common.js"(exports2){"use strict";var TYPED_OK=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}exports2.assign=function(obj){for(var sources=Array.prototype.slice.call(arguments,1);sources.length;){var source=sources.shift();if(!!source){if(typeof source!="object")throw new TypeError(source+"must be non-object");for(var p in source)_has(source,p)&&(obj[p]=source[p])}}return obj};exports2.shrinkBuf=function(buf,size){return buf.length===size?buf:buf.subarray?buf.subarray(0,size):(buf.length=size,buf)};var fnTyped={arraySet:function(dest,src,src_offs,len2,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len2),dest_offs);return}for(var i=0;i<len2;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){var i,l,len2,pos,chunk,result;for(len2=0,i=0,l=chunks.length;i<l;i++)len2+=chunks[i].length;for(result=new Uint8Array(len2),pos=0,i=0,l=chunks.length;i<l;i++)chunk=chunks[i],result.set(chunk,pos),pos+=chunk.length;return result}},fnUntyped={arraySet:function(dest,src,src_offs,len2,dest_offs){for(var i=0;i<len2;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports2.setTyped=function(on){on?(exports2.Buf8=Uint8Array,exports2.Buf16=Uint16Array,exports2.Buf32=Int32Array,exports2.assign(exports2,fnTyped)):(exports2.Buf8=Array,exports2.Buf16=Array,exports2.Buf32=Array,exports2.assign(exports2,fnUntyped))};exports2.setTyped(TYPED_OK)}});var require_trees=__commonJS({"node_modules/pako/lib/zlib/trees.js"(exports2){"use strict";var utils2=require_common(),Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(buf){for(var len2=buf.length;--len2>=0;)buf[len2]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH=3,MAX_MATCH=258,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree,this.extra_bits=extra_bits,this.extra_base=extra_base,this.elems=elems,this.max_length=max_length,this.has_stree=static_tree&&static_tree.length}var static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree,this.max_code=0,this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255,s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){s.bi_valid>Buf_size-length?(s.bi_buf|=value<<s.bi_valid&65535,put_short(s,s.bi_buf),s.bi_buf=value>>Buf_size-s.bi_valid,s.bi_valid+=length-Buf_size):(s.bi_buf|=value<<s.bi_valid&65535,s.bi_valid+=length)}function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}function bi_reverse(code,len2){var res=0;do res|=code&1,code>>>=1,res<<=1;while(--len2>0);return res>>>1}function bi_flush(s){s.bi_valid===16?(put_short(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=s.bi_buf&255,s.bi_buf>>=8,s.bi_valid-=8)}function gen_bitlen(s,desc){var tree=desc.dyn_tree,max_code=desc.max_code,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,extra=desc.stat_desc.extra_bits,base=desc.stat_desc.extra_base,max_length=desc.stat_desc.max_length,h,n,m,bits,xbits,f,overflow=0;for(bits=0;bits<=MAX_BITS;bits++)s.bl_count[bits]=0;for(tree[s.heap[s.heap_max]*2+1]=0,h=s.heap_max+1;h<HEAP_SIZE;h++)n=s.heap[h],bits=tree[tree[n*2+1]*2+1]+1,bits>max_length&&(bits=max_length,overflow++),tree[n*2+1]=bits,!(n>max_code)&&(s.bl_count[bits]++,xbits=0,n>=base&&(xbits=extra[n-base]),f=tree[n*2],s.opt_len+=f*(bits+xbits),has_stree&&(s.static_len+=f*(stree[n*2+1]+xbits)));if(overflow!==0){do{for(bits=max_length-1;s.bl_count[bits]===0;)bits--;s.bl_count[bits]--,s.bl_count[bits+1]+=2,s.bl_count[max_length]--,overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--)for(n=s.bl_count[bits];n!==0;)m=s.heap[--h],!(m>max_code)&&(tree[m*2+1]!==bits&&(s.opt_len+=(bits-tree[m*2+1])*tree[m*2],tree[m*2+1]=bits),n--)}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1),code=0,bits,n;for(bits=1;bits<=MAX_BITS;bits++)next_code[bits]=code=code+bl_count[bits-1]<<1;for(n=0;n<=max_code;n++){var len2=tree[n*2+1];len2!==0&&(tree[n*2]=bi_reverse(next_code[len2]++,len2))}}function tr_static_init(){var n,bits,length,code,dist,bl_count=new Array(MAX_BITS+1);for(length=0,code=0;code<LENGTH_CODES-1;code++)for(base_length[code]=length,n=0;n<1<<extra_lbits[code];n++)_length_code[length++]=code;for(_length_code[length-1]=code,dist=0,code=0;code<16;code++)for(base_dist[code]=dist,n=0;n<1<<extra_dbits[code];n++)_dist_code[dist++]=code;for(dist>>=7;code<D_CODES;code++)for(base_dist[code]=dist<<7,n=0;n<1<<extra_dbits[code]-7;n++)_dist_code[256+dist++]=code;for(bits=0;bits<=MAX_BITS;bits++)bl_count[bits]=0;for(n=0;n<=143;)static_ltree[n*2+1]=8,n++,bl_count[8]++;for(;n<=255;)static_ltree[n*2+1]=9,n++,bl_count[9]++;for(;n<=279;)static_ltree[n*2+1]=7,n++,bl_count[7]++;for(;n<=287;)static_ltree[n*2+1]=8,n++,bl_count[8]++;for(gen_codes(static_ltree,L_CODES+1,bl_count),n=0;n<D_CODES;n++)static_dtree[n*2+1]=5,static_dtree[n*2]=bi_reverse(n,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++)s.dyn_ltree[n*2]=0;for(n=0;n<D_CODES;n++)s.dyn_dtree[n*2]=0;for(n=0;n<BL_CODES;n++)s.bl_tree[n*2]=0;s.dyn_ltree[END_BLOCK*2]=1,s.opt_len=s.static_len=0,s.last_lit=s.matches=0}function bi_windup(s){s.bi_valid>8?put_short(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0}function copy_block(s,buf,len2,header){bi_windup(s),header&&(put_short(s,len2),put_short(s,~len2)),utils2.arraySet(s.pending_buf,s.window,buf,len2,s.pending),s.pending+=len2}function smaller(tree,n,m,depth){var _n2=n*2,_m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){for(var v=s.heap[k],j=k<<1;j<=s.heap_len&&(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)&&j++,!smaller(tree,v,s.heap[j],s.depth));)s.heap[k]=s.heap[j],k=j,j<<=1;s.heap[k]=v}function compress_block(s,ltree,dtree){var dist,lc,lx=0,code,extra;if(s.last_lit!==0)do dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1],lc=s.pending_buf[s.l_buf+lx],lx++,dist===0?send_code(s,lc,ltree):(code=_length_code[lc],send_code(s,code+LITERALS+1,ltree),extra=extra_lbits[code],extra!==0&&(lc-=base_length[code],send_bits(s,lc,extra)),dist--,code=d_code(dist),send_code(s,code,dtree),extra=extra_dbits[code],extra!==0&&(dist-=base_dist[code],send_bits(s,dist,extra)));while(lx<s.last_lit);send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,elems=desc.stat_desc.elems,n,m,max_code=-1,node;for(s.heap_len=0,s.heap_max=HEAP_SIZE,n=0;n<elems;n++)tree[n*2]!==0?(s.heap[++s.heap_len]=max_code=n,s.depth[n]=0):tree[n*2+1]=0;for(;s.heap_len<2;)node=s.heap[++s.heap_len]=max_code<2?++max_code:0,tree[node*2]=1,s.depth[node]=0,s.opt_len--,has_stree&&(s.static_len-=stree[node*2+1]);for(desc.max_code=max_code,n=s.heap_len>>1;n>=1;n--)pqdownheap(s,tree,n);node=elems;do n=s.heap[1],s.heap[1]=s.heap[s.heap_len--],pqdownheap(s,tree,1),m=s.heap[1],s.heap[--s.heap_max]=n,s.heap[--s.heap_max]=m,tree[node*2]=tree[n*2]+tree[m*2],s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1,tree[n*2+1]=tree[m*2+1]=node,s.heap[1]=node++,pqdownheap(s,tree,1);while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],gen_bitlen(s,desc),gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n,prevlen=-1,curlen,nextlen=tree[0*2+1],count2=0,max_count=7,min_count=4;for(nextlen===0&&(max_count=138,min_count=3),tree[(max_code+1)*2+1]=65535,n=0;n<=max_code;n++)curlen=nextlen,nextlen=tree[(n+1)*2+1],!(++count2<max_count&&curlen===nextlen)&&(count2<min_count?s.bl_tree[curlen*2]+=count2:curlen!==0?(curlen!==prevlen&&s.bl_tree[curlen*2]++,s.bl_tree[REP_3_6*2]++):count2<=10?s.bl_tree[REPZ_3_10*2]++:s.bl_tree[REPZ_11_138*2]++,count2=0,prevlen=curlen,nextlen===0?(max_count=138,min_count=3):curlen===nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4))}function send_tree(s,tree,max_code){var n,prevlen=-1,curlen,nextlen=tree[0*2+1],count2=0,max_count=7,min_count=4;for(nextlen===0&&(max_count=138,min_count=3),n=0;n<=max_code;n++)if(curlen=nextlen,nextlen=tree[(n+1)*2+1],!(++count2<max_count&&curlen===nextlen)){if(count2<min_count)do send_code(s,curlen,s.bl_tree);while(--count2!=0);else curlen!==0?(curlen!==prevlen&&(send_code(s,curlen,s.bl_tree),count2--),send_code(s,REP_3_6,s.bl_tree),send_bits(s,count2-3,2)):count2<=10?(send_code(s,REPZ_3_10,s.bl_tree),send_bits(s,count2-3,3)):(send_code(s,REPZ_11_138,s.bl_tree),send_bits(s,count2-11,7));count2=0,prevlen=curlen,nextlen===0?(max_count=138,min_count=3):curlen===nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4)}}function build_bl_tree(s){var max_blindex;for(scan_tree(s,s.dyn_ltree,s.l_desc.max_code),scan_tree(s,s.dyn_dtree,s.d_desc.max_code),build_tree(s,s.bl_desc),max_blindex=BL_CODES-1;max_blindex>=3&&s.bl_tree[bl_order[max_blindex]*2+1]===0;max_blindex--);return s.opt_len+=3*(max_blindex+1)+5+5+4,max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;for(send_bits(s,lcodes-257,5),send_bits(s,dcodes-1,5),send_bits(s,blcodes-4,4),rank=0;rank<blcodes;rank++)send_bits(s,s.bl_tree[bl_order[rank]*2+1],3);send_tree(s,s.dyn_ltree,lcodes-1),send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447,n;for(n=0;n<=31;n++,black_mask>>>=1)if(black_mask&1&&s.dyn_ltree[n*2]!==0)return Z_BINARY;if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0)return Z_TEXT;for(n=32;n<LITERALS;n++)if(s.dyn_ltree[n*2]!==0)return Z_TEXT;return Z_BINARY}var static_init_done=!1;function _tr_init(s){static_init_done||(tr_static_init(),static_init_done=!0),s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc),s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc),s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc),s.bi_buf=0,s.bi_valid=0,init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3),copy_block(s,buf,stored_len,!0)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3),send_code(s,END_BLOCK,static_ltree),bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb,max_blindex=0;s.level>0?(s.strm.data_type===Z_UNKNOWN&&(s.strm.data_type=detect_data_type(s)),build_tree(s,s.l_desc),build_tree(s,s.d_desc),max_blindex=build_bl_tree(s),opt_lenb=s.opt_len+3+7>>>3,static_lenb=s.static_len+3+7>>>3,static_lenb<=opt_lenb&&(opt_lenb=static_lenb)):opt_lenb=static_lenb=stored_len+5,stored_len+4<=opt_lenb&&buf!==-1?_tr_stored_block(s,buf,stored_len,last):s.strategy===Z_FIXED||static_lenb===opt_lenb?(send_bits(s,(STATIC_TREES<<1)+(last?1:0),3),compress_block(s,static_ltree,static_dtree)):(send_bits(s,(DYN_TREES<<1)+(last?1:0),3),send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1),compress_block(s,s.dyn_ltree,s.dyn_dtree)),init_block(s),last&&bi_windup(s)}function _tr_tally(s,dist,lc){return s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255,s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255,s.pending_buf[s.l_buf+s.last_lit]=lc&255,s.last_lit++,dist===0?s.dyn_ltree[lc*2]++:(s.matches++,dist--,s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++,s.dyn_dtree[d_code(dist)*2]++),s.last_lit===s.lit_bufsize-1}exports2._tr_init=_tr_init;exports2._tr_stored_block=_tr_stored_block;exports2._tr_flush_block=_tr_flush_block;exports2._tr_tally=_tr_tally;exports2._tr_align=_tr_align}});var require_adler32=__commonJS({"node_modules/pako/lib/zlib/adler32.js"(exports2,module2){"use strict";function adler32(adler,buf,len2,pos){for(var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;len2!==0;){n=len2>2e3?2e3:len2,len2-=n;do s1=s1+buf[pos++]|0,s2=s2+s1|0;while(--n);s1%=65521,s2%=65521}return s1|s2<<16|0}module2.exports=adler32}});var require_crc32=__commonJS({"node_modules/pako/lib/zlib/crc32.js"(exports2,module2){"use strict";function makeTable(){for(var c,table=[],n=0;n<256;n++){c=n;for(var k=0;k<8;k++)c=c&1?3988292384^c>>>1:c>>>1;table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len2,pos){var t=crcTable,end=pos+len2;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[(crc^buf[i])&255];return crc^-1}module2.exports=crc32}});var require_messages=__commonJS({"node_modules/pako/lib/zlib/messages.js"(exports2,module2){"use strict";module2.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}});var require_deflate=__commonJS({"node_modules/pako/lib/zlib/deflate.js"(exports2){"use strict";var utils2=require_common(),trees=require_trees(),adler32=require_adler32(),crc32=require_crc32(),msg=require_messages(),Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED=4,Z_DEFAULT_STRATEGY=0,Z_UNKNOWN=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3;function err(strm,errorCode){return strm.msg=msg[errorCode],errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){for(var len2=buf.length;--len2>=0;)buf[len2]=0}function flush_pending(strm){var s=strm.state,len2=s.pending;len2>strm.avail_out&&(len2=strm.avail_out),len2!==0&&(utils2.arraySet(strm.output,s.pending_buf,s.pending_out,len2,strm.next_out),strm.next_out+=len2,s.pending_out+=len2,strm.total_out+=len2,strm.avail_out-=len2,s.pending-=len2,s.pending===0&&(s.pending_out=0))}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last),s.block_start=s.strstart,flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255,s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start2,size){var len2=strm.avail_in;return len2>size&&(len2=size),len2===0?0:(strm.avail_in-=len2,utils2.arraySet(buf,strm.input,strm.next_in,len2,start2),strm.state.wrap===1?strm.adler=adler32(strm.adler,buf,len2,start2):strm.state.wrap===2&&(strm.adler=crc32(strm.adler,buf,len2,start2)),strm.next_in+=len2,strm.total_in+=len2,len2)}function longest_match(s,cur_match){var chain_length=s.max_chain_length,scan=s.strstart,match,len2,best_len=s.prev_length,nice_match=s.nice_match,limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0,_win=s.window,wmask=s.w_mask,prev=s.prev,strend=s.strstart+MAX_MATCH,scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len];s.prev_length>=s.good_match&&(chain_length>>=2),nice_match>s.lookahead&&(nice_match=s.lookahead);do if(match=cur_match,!(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1])){scan+=2,match++;do;while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);if(len2=MAX_MATCH-(strend-scan),scan=strend-MAX_MATCH,len2>best_len){if(s.match_start=cur_match,best_len=len2,len2>=nice_match)break;scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!=0);return best_len<=s.lookahead?best_len:s.lookahead}function fill_window(s){var _w_size=s.w_size,p,n,m,more,str;do{if(more=s.window_size-s.lookahead-s.strstart,s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils2.arraySet(s.window,s.window,_w_size,_w_size,0),s.match_start-=_w_size,s.strstart-=_w_size,s.block_start-=_w_size,n=s.hash_size,p=n;do m=s.head[--p],s.head[p]=m>=_w_size?m-_w_size:0;while(--n);n=_w_size,p=n;do m=s.prev[--p],s.prev[p]=m>=_w_size?m-_w_size:0;while(--n);more+=_w_size}if(s.strm.avail_in===0)break;if(n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more),s.lookahead+=n,s.lookahead+s.insert>=MIN_MATCH)for(str=s.strstart-s.insert,s.ins_h=s.window[str],s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask,s.prev[str&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=str,str++,s.insert--,!(s.lookahead+s.insert<MIN_MATCH)););}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;for(max_block_size>s.pending_buf_size-5&&(max_block_size=s.pending_buf_size-5);;){if(s.lookahead<=1){if(fill_window(s),s.lookahead===0&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}s.strstart+=s.lookahead,s.lookahead=0;var max_start=s.block_start+max_block_size;if((s.strstart===0||s.strstart>=max_start)&&(s.lookahead=s.strstart-max_start,s.strstart=max_start,flush_block_only(s,!1),s.strm.avail_out===0)||s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD&&(flush_block_only(s,!1),s.strm.avail_out===0))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),s.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):(s.strstart>s.block_start&&(flush_block_only(s,!1),s.strm.avail_out===0),BS_NEED_MORE)}function deflate_fast(s,flush){for(var hash_head,bflush;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}if(hash_head=0,s.lookahead>=MIN_MATCH&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head)),s.match_length>=MIN_MATCH)if(bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do s.strstart++,s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart;while(--s.match_length!=0);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask;else bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(bflush&&(flush_block_only(s,!1),s.strm.avail_out===0))return BS_NEED_MORE}return s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1,flush===Z_FINISH?(flush_block_only(s,!0),s.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),s.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(s,flush){for(var hash_head,bflush,max_insert;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}if(hash_head=0,s.lookahead>=MIN_MATCH&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=MIN_MATCH-1,hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head),s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)&&(s.match_length=MIN_MATCH-1)),s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH,bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH),s.lookahead-=s.prev_length-1,s.prev_length-=2;do++s.strstart<=max_insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart);while(--s.prev_length!=0);if(s.match_available=0,s.match_length=MIN_MATCH-1,s.strstart++,bflush&&(flush_block_only(s,!1),s.strm.avail_out===0))return BS_NEED_MORE}else if(s.match_available){if(bflush=trees._tr_tally(s,0,s.window[s.strstart-1]),bflush&&flush_block_only(s,!1),s.strstart++,s.lookahead--,s.strm.avail_out===0)return BS_NEED_MORE}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(bflush=trees._tr_tally(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1,flush===Z_FINISH?(flush_block_only(s,!0),s.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),s.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(s,flush){for(var bflush,prev,scan,strend,_win=s.window;;){if(s.lookahead<=MAX_MATCH){if(fill_window(s),s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=MIN_MATCH&&s.strstart>0&&(scan=s.strstart-1,prev=_win[scan],prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan])){strend=s.strstart+MAX_MATCH;do;while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=MIN_MATCH?(bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),bflush&&(flush_block_only(s,!1),s.strm.avail_out===0))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),s.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),s.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(s,flush){for(var bflush;;){if(s.lookahead===0&&(fill_window(s),s.lookahead===0)){if(flush===Z_NO_FLUSH)return BS_NEED_MORE;break}if(s.match_length=0,bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,bflush&&(flush_block_only(s,!1),s.strm.avail_out===0))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),s.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),s.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length,this.max_lazy=max_lazy,this.nice_length=nice_length,this.max_chain=max_chain,this.func=func}var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size,zero(s.head),s.max_lazy_match=configuration_table[s.level].max_lazy,s.good_match=configuration_table[s.level].good_length,s.nice_match=configuration_table[s.level].nice_length,s.max_chain_length=configuration_table[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=MIN_MATCH-1,s.match_available=0,s.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new utils2.Buf16(HEAP_SIZE*2),this.dyn_dtree=new utils2.Buf16((2*D_CODES+1)*2),this.bl_tree=new utils2.Buf16((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new utils2.Buf16(MAX_BITS+1),this.heap=new utils2.Buf16(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new utils2.Buf16(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(strm){var s;return!strm||!strm.state?err(strm,Z_STREAM_ERROR):(strm.total_in=strm.total_out=0,strm.data_type=Z_UNKNOWN,s=strm.state,s.pending=0,s.pending_out=0,s.wrap<0&&(s.wrap=-s.wrap),s.status=s.wrap?INIT_STATE:BUSY_STATE,strm.adler=s.wrap===2?0:1,s.last_flush=Z_NO_FLUSH,trees._tr_init(s),Z_OK)}function deflateReset(strm){var ret=deflateResetKeep(strm);return ret===Z_OK&&lm_init(strm.state),ret}function deflateSetHeader(strm,head){return!strm||!strm.state||strm.state.wrap!==2?Z_STREAM_ERROR:(strm.state.gzhead=head,Z_OK)}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm)return Z_STREAM_ERROR;var wrap=1;if(level===Z_DEFAULT_COMPRESSION&&(level=6),windowBits<0?(wrap=0,windowBits=-windowBits):windowBits>15&&(wrap=2,windowBits-=16),memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED)return err(strm,Z_STREAM_ERROR);windowBits===8&&(windowBits=9);var s=new DeflateState;return strm.state=s,s.strm=strm,s.wrap=wrap,s.gzhead=null,s.w_bits=windowBits,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=memLevel+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH),s.window=new utils2.Buf8(s.w_size*2),s.head=new utils2.Buf16(s.hash_size),s.prev=new utils2.Buf16(s.w_size),s.lit_bufsize=1<<memLevel+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new utils2.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=(1+2)*s.lit_bufsize,s.level=level,s.strategy=strategy,s.method=method,deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s,beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0)return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;if(s=strm.state,!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH)return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR);if(s.strm=strm,old_flush=s.last_flush,s.last_flush=flush,s.status===INIT_STATE)if(s.wrap===2)strm.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead?(put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,s.gzhead.time&255),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,s.gzhead.os&255),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,s.gzhead.extra.length&255),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=EXTRA_STATE):(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,OS_CODE),s.status=BUSY_STATE);else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8,level_flags=-1;s.strategy>=Z_HUFFMAN_ONLY||s.level<2?level_flags=0:s.level<6?level_flags=1:s.level===6?level_flags=2:level_flags=3,header|=level_flags<<6,s.strstart!==0&&(header|=PRESET_DICT),header+=31-header%31,s.status=BUSY_STATE,putShortMSB(s,header),s.strstart!==0&&(putShortMSB(s,strm.adler>>>16),putShortMSB(s,strm.adler&65535)),strm.adler=1}if(s.status===EXTRA_STATE)if(s.gzhead.extra){for(beg=s.pending;s.gzindex<(s.gzhead.extra.length&65535)&&!(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size));)put_byte(s,s.gzhead.extra[s.gzindex]&255),s.gzindex++;s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=NAME_STATE)}else s.status=NAME_STATE;if(s.status===NAME_STATE)if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}s.gzindex<s.gzhead.name.length?val=s.gzhead.name.charCodeAt(s.gzindex++)&255:val=0,put_byte(s,val)}while(val!==0);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),val===0&&(s.gzindex=0,s.status=COMMENT_STATE)}else s.status=COMMENT_STATE;if(s.status===COMMENT_STATE)if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}s.gzindex<s.gzhead.comment.length?val=s.gzhead.comment.charCodeAt(s.gzindex++)&255:val=0,put_byte(s,val)}while(val!==0);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),val===0&&(s.status=HCRC_STATE)}else s.status=HCRC_STATE;if(s.status===HCRC_STATE&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&flush_pending(strm),s.pending+2<=s.pending_buf_size&&(put_byte(s,strm.adler&255),put_byte(s,strm.adler>>8&255),strm.adler=0,s.status=BUSY_STATE)):s.status=BUSY_STATE),s.pending!==0){if(flush_pending(strm),strm.avail_out===0)return s.last_flush=-1,Z_OK}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH)return err(strm,Z_BUF_ERROR);if(s.status===FINISH_STATE&&strm.avail_in!==0)return err(strm,Z_BUF_ERROR);if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if((bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE)&&(s.status=FINISH_STATE),bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED)return strm.avail_out===0&&(s.last_flush=-1),Z_OK;if(bstate===BS_BLOCK_DONE&&(flush===Z_PARTIAL_FLUSH?trees._tr_align(s):flush!==Z_BLOCK&&(trees._tr_stored_block(s,0,0,!1),flush===Z_FULL_FLUSH&&(zero(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(strm),strm.avail_out===0))return s.last_flush=-1,Z_OK}return flush!==Z_FINISH?Z_OK:s.wrap<=0?Z_STREAM_END:(s.wrap===2?(put_byte(s,strm.adler&255),put_byte(s,strm.adler>>8&255),put_byte(s,strm.adler>>16&255),put_byte(s,strm.adler>>24&255),put_byte(s,strm.total_in&255),put_byte(s,strm.total_in>>8&255),put_byte(s,strm.total_in>>16&255),put_byte(s,strm.total_in>>24&255)):(putShortMSB(s,strm.adler>>>16),putShortMSB(s,strm.adler&65535)),flush_pending(strm),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Z_OK:Z_STREAM_END)}function deflateEnd(strm){var status;return!strm||!strm.state?Z_STREAM_ERROR:(status=strm.state.status,status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE?err(strm,Z_STREAM_ERROR):(strm.state=null,status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK))}function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length,s,str,n,wrap,avail,next,input,tmpDict;if(!strm||!strm.state||(s=strm.state,wrap=s.wrap,wrap===2||wrap===1&&s.status!==INIT_STATE||s.lookahead))return Z_STREAM_ERROR;for(wrap===1&&(strm.adler=adler32(strm.adler,dictionary,dictLength,0)),s.wrap=0,dictLength>=s.w_size&&(wrap===0&&(zero(s.head),s.strstart=0,s.block_start=0,s.insert=0),tmpDict=new utils2.Buf8(s.w_size),utils2.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0),dictionary=tmpDict,dictLength=s.w_size),avail=strm.avail_in,next=strm.next_in,input=strm.input,strm.avail_in=dictLength,strm.next_in=0,strm.input=dictionary,fill_window(s);s.lookahead>=MIN_MATCH;){str=s.strstart,n=s.lookahead-(MIN_MATCH-1);do s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask,s.prev[str&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=str,str++;while(--n);s.strstart=str,s.lookahead=MIN_MATCH-1,fill_window(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=MIN_MATCH-1,s.match_available=0,strm.next_in=next,strm.input=input,strm.avail_in=avail,s.wrap=wrap,Z_OK}exports2.deflateInit=deflateInit;exports2.deflateInit2=deflateInit2;exports2.deflateReset=deflateReset;exports2.deflateResetKeep=deflateResetKeep;exports2.deflateSetHeader=deflateSetHeader;exports2.deflate=deflate;exports2.deflateEnd=deflateEnd;exports2.deflateSetDictionary=deflateSetDictionary;exports2.deflateInfo="pako deflate (from Nodeca project)"}});var require_strings=__commonJS({"node_modules/pako/lib/utils/strings.js"(exports2){"use strict";var utils2=require_common(),STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}var _utf8len=new utils2.Buf8(256);for(var q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1;exports2.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++)c=str.charCodeAt(m_pos),(c&64512)==55296&&m_pos+1<str_len&&(c2=str.charCodeAt(m_pos+1),(c2&64512)==56320&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++)),buf_len+=c<128?1:c<2048?2:c<65536?3:4;for(buf=new utils2.Buf8(buf_len),i=0,m_pos=0;i<buf_len;m_pos++)c=str.charCodeAt(m_pos),(c&64512)==55296&&m_pos+1<str_len&&(c2=str.charCodeAt(m_pos+1),(c2&64512)==56320&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++)),c<128?buf[i++]=c:c<2048?(buf[i++]=192|c>>>6,buf[i++]=128|c&63):c<65536?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|c&63):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|c&63);return buf};function buf2binstring(buf,len2){if(len2<65534&&(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils2.shrinkBuf(buf,len2));for(var result="",i=0;i<len2;i++)result+=String.fromCharCode(buf[i]);return result}exports2.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports2.binstring2buf=function(str){for(var buf=new utils2.Buf8(str.length),i=0,len2=buf.length;i<len2;i++)buf[i]=str.charCodeAt(i);return buf};exports2.buf2string=function(buf,max){var i,out,c,c_len,len2=max||buf.length,utf16buf=new Array(len2*2);for(out=0,i=0;i<len2;){if(c=buf[i++],c<128){utf16buf[out++]=c;continue}if(c_len=_utf8len[c],c_len>4){utf16buf[out++]=65533,i+=c_len-1;continue}for(c&=c_len===2?31:c_len===3?15:7;c_len>1&&i<len2;)c=c<<6|buf[i++]&63,c_len--;if(c_len>1){utf16buf[out++]=65533;continue}c<65536?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|c&1023)}return buf2binstring(utf16buf,out)};exports2.utf8border=function(buf,max){var pos;for(max=max||buf.length,max>buf.length&&(max=buf.length),pos=max-1;pos>=0&&(buf[pos]&192)==128;)pos--;return pos<0||pos===0?max:pos+_utf8len[buf[pos]]>max?pos:max}}});var require_zstream=__commonJS({"node_modules/pako/lib/zlib/zstream.js"(exports2,module2){"use strict";function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}module2.exports=ZStream}});var require_deflate2=__commonJS({"node_modules/pako/lib/deflate.js"(exports2){"use strict";var zlib_deflate=require_deflate(),utils2=require_common(),strings=require_strings(),msg=require_messages(),ZStream=require_zstream(),toString2=Object.prototype.toString,Z_NO_FLUSH=0,Z_FINISH=4,Z_OK=0,Z_STREAM_END=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION=-1,Z_DEFAULT_STRATEGY=0,Z_DEFLATED=8;function Deflate(options){if(!(this instanceof Deflate))return new Deflate(options);this.options=utils2.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>0?opt.windowBits=-opt.windowBits:opt.gzip&&opt.windowBits>0&&opt.windowBits<16&&(opt.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;var status=zlib_deflate.deflateInit2(this.strm,opt.level,opt.method,opt.windowBits,opt.memLevel,opt.strategy);if(status!==Z_OK)throw new Error(msg[status]);if(opt.header&&zlib_deflate.deflateSetHeader(this.strm,opt.header),opt.dictionary){var dict;if(typeof opt.dictionary=="string"?dict=strings.string2buf(opt.dictionary):toString2.call(opt.dictionary)==="[object ArrayBuffer]"?dict=new Uint8Array(opt.dictionary):dict=opt.dictionary,status=zlib_deflate.deflateSetDictionary(this.strm,dict),status!==Z_OK)throw new Error(msg[status]);this._dict_set=!0}}Deflate.prototype.push=function(data,mode){var strm=this.strm,chunkSize=this.options.chunkSize,status,_mode;if(this.ended)return!1;_mode=mode===~~mode?mode:mode===!0?Z_FINISH:Z_NO_FLUSH,typeof data=="string"?strm.input=strings.string2buf(data):toString2.call(data)==="[object ArrayBuffer]"?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(strm.avail_out===0&&(strm.output=new utils2.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),status=zlib_deflate.deflate(strm,_mode),status!==Z_STREAM_END&&status!==Z_OK)return this.onEnd(status),this.ended=!0,!1;(strm.avail_out===0||strm.avail_in===0&&(_mode===Z_FINISH||_mode===Z_SYNC_FLUSH))&&(this.options.to==="string"?this.onData(strings.buf2binstring(utils2.shrinkBuf(strm.output,strm.next_out))):this.onData(utils2.shrinkBuf(strm.output,strm.next_out)))}while((strm.avail_in>0||strm.avail_out===0)&&status!==Z_STREAM_END);return _mode===Z_FINISH?(status=zlib_deflate.deflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===Z_OK):(_mode===Z_SYNC_FLUSH&&(this.onEnd(Z_OK),strm.avail_out=0),!0)};Deflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Deflate.prototype.onEnd=function(status){status===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=utils2.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg};function deflate(input,options){var deflator=new Deflate(options);if(deflator.push(input,!0),deflator.err)throw deflator.msg||msg[deflator.err];return deflator.result}function deflateRaw(input,options){return options=options||{},options.raw=!0,deflate(input,options)}function gzip(input,options){return options=options||{},options.gzip=!0,deflate(input,options)}exports2.Deflate=Deflate;exports2.deflate=deflate;exports2.deflateRaw=deflateRaw;exports2.gzip=gzip}});var require_inffast=__commonJS({"node_modules/pako/lib/zlib/inffast.js"(exports2,module2){"use strict";var BAD=30,TYPE=12;module2.exports=function(strm,start2){var state,_in,last,_out,beg,end,dmax,wsize,whave,wnext,s_window,hold,bits,lcode,dcode,lmask,dmask,here,op,len2,dist,from,from_source,input,output;state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start2-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,s_window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];dolen:for(;;){if(op=here>>>24,hold>>>=op,bits-=op,op=here>>>16&255,op===0)output[_out++]=here&65535;else if(op&16){len2=here&65535,op&=15,op&&(bits<op&&(hold+=input[_in++]<<bits,bits+=8),len2+=hold&(1<<op)-1,hold>>>=op,bits-=op),bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];dodist:for(;;){if(op=here>>>24,hold>>>=op,bits-=op,op=here>>>16&255,op&16){if(dist=here&65535,op&=15,bits<op&&(hold+=input[_in++]<<bits,bits+=8,bits<op&&(hold+=input[_in++]<<bits,bits+=8)),dist+=hold&(1<<op)-1,dist>dmax){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(hold>>>=op,bits-=op,op=_out-beg,dist>op){if(op=dist-op,op>whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(from=0,from_source=s_window,wnext===0){if(from+=wsize-op,op<len2){len2-=op;do output[_out++]=s_window[from++];while(--op);from=_out-dist,from_source=output}}else if(wnext<op){if(from+=wsize+wnext-op,op-=wnext,op<len2){len2-=op;do output[_out++]=s_window[from++];while(--op);if(from=0,wnext<len2){op=wnext,len2-=op;do output[_out++]=s_window[from++];while(--op);from=_out-dist,from_source=output}}}else if(from+=wnext-op,op<len2){len2-=op;do output[_out++]=s_window[from++];while(--op);from=_out-dist,from_source=output}for(;len2>2;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len2-=3;len2&&(output[_out++]=from_source[from++],len2>1&&(output[_out++]=from_source[from++]))}else{from=_out-dist;do output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],len2-=3;while(len2>2);len2&&(output[_out++]=output[from++],len2>1&&(output[_out++]=output[from++]))}}else if((op&64)==0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code",state.mode=BAD;break top}break}}else if((op&64)==0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code",state.mode=BAD;break top}break}}while(_in<last&&_out<end);len2=bits>>3,_in-=len2,bits-=len2<<3,hold&=(1<<bits)-1,strm.next_in=_in,strm.next_out=_out,strm.avail_in=_in<last?5+(last-_in):5-(_in-last),strm.avail_out=_out<end?257+(end-_out):257-(_out-end),state.hold=hold,state.bits=bits}}});var require_inftrees=__commonJS({"node_modules/pako/lib/zlib/inftrees.js"(exports2,module2){"use strict";var utils2=require_common(),MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module2.exports=function(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits,len2=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,incr,fill2,low,mask,next,base=null,base_index=0,end,count2=new utils2.Buf16(MAXBITS+1),offs=new utils2.Buf16(MAXBITS+1),extra=null,extra_index=0,here_bits,here_op,here_val;for(len2=0;len2<=MAXBITS;len2++)count2[len2]=0;for(sym=0;sym<codes;sym++)count2[lens[lens_index+sym]]++;for(root=bits,max=MAXBITS;max>=1&&count2[max]===0;max--);if(root>max&&(root=max),max===0)return table[table_index++]=1<<24|64<<16|0,table[table_index++]=1<<24|64<<16|0,opts.bits=1,0;for(min=1;min<max&&count2[min]===0;min++);for(root<min&&(root=min),left=1,len2=1;len2<=MAXBITS;len2++)if(left<<=1,left-=count2[len2],left<0)return-1;if(left>0&&(type===CODES||max!==1))return-1;for(offs[1]=0,len2=1;len2<MAXBITS;len2++)offs[len2+1]=offs[len2]+count2[len2];for(sym=0;sym<codes;sym++)lens[lens_index+sym]!==0&&(work[offs[lens[lens_index+sym]]++]=sym);if(type===CODES?(base=extra=work,end=19):type===LENS?(base=lbase,base_index-=257,extra=lext,extra_index-=257,end=256):(base=dbase,extra=dext,end=-1),huff=0,sym=0,len2=min,next=table_index,curr=root,drop=0,low=-1,used=1<<root,mask=used-1,type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;for(;;){here_bits=len2-drop,work[sym]<end?(here_op=0,here_val=work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],here_val=base[base_index+work[sym]]):(here_op=32+64,here_val=0),incr=1<<len2-drop,fill2=1<<curr,min=fill2;do fill2-=incr,table[next+(huff>>drop)+fill2]=here_bits<<24|here_op<<16|here_val|0;while(fill2!==0);for(incr=1<<len2-1;huff&incr;)incr>>=1;if(incr!==0?(huff&=incr-1,huff+=incr):huff=0,sym++,--count2[len2]==0){if(len2===max)break;len2=lens[lens_index+work[sym]]}if(len2>root&&(huff&mask)!==low){for(drop===0&&(drop=root),next+=min,curr=len2-drop,left=1<<curr;curr+drop<max&&(left-=count2[curr+drop],!(left<=0));)curr++,left<<=1;if(used+=1<<curr,type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;low=huff&mask,table[low]=root<<24|curr<<16|next-table_index|0}}return huff!==0&&(table[next+huff]=len2-drop<<24|64<<16|0),opts.bits=root,0}}});var require_inflate=__commonJS({"node_modules/pako/lib/zlib/inflate.js"(exports2){"use strict";var utils2=require_common(),adler32=require_adler32(),crc32=require_crc32(),inflate_fast=require_inffast(),inflate_table=require_inftrees(),CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils2.Buf16(320),this.work=new utils2.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(strm){var state;return!strm||!strm.state?Z_STREAM_ERROR:(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=state.wrap&1),state.mode=HEAD,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new utils2.Buf32(ENOUGH_LENS),state.distcode=state.distdyn=new utils2.Buf32(ENOUGH_DISTS),state.sane=1,state.back=-1,Z_OK)}function inflateReset(strm){var state;return!strm||!strm.state?Z_STREAM_ERROR:(state=strm.state,state.wsize=0,state.whave=0,state.wnext=0,inflateResetKeep(strm))}function inflateReset2(strm,windowBits){var wrap,state;return!strm||!strm.state||(state=strm.state,windowBits<0?(wrap=0,windowBits=-windowBits):(wrap=(windowBits>>4)+1,windowBits<48&&(windowBits&=15)),windowBits&&(windowBits<8||windowBits>15))?Z_STREAM_ERROR:(state.window!==null&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))}function inflateInit2(strm,windowBits){var ret,state;return strm?(state=new InflateState,strm.state=state,state.window=null,ret=inflateReset2(strm,windowBits),ret!==Z_OK&&(strm.state=null),ret):Z_STREAM_ERROR}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=!0,lenfix,distfix;function fixedtables(state){if(virgin){var sym;for(lenfix=new utils2.Buf32(512),distfix=new utils2.Buf32(32),sym=0;sym<144;)state.lens[sym++]=8;for(;sym<256;)state.lens[sym++]=9;for(;sym<280;)state.lens[sym++]=7;for(;sym<288;)state.lens[sym++]=8;for(inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;sym<32;)state.lens[sym++]=5;inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}function updatewindow(strm,src,end,copy){var dist,state=strm.state;return state.window===null&&(state.wsize=1<<state.wbits,state.wnext=0,state.whave=0,state.window=new utils2.Buf8(state.wsize)),copy>=state.wsize?(utils2.arraySet(state.window,src,end-state.wsize,state.wsize,0),state.wnext=0,state.whave=state.wsize):(dist=state.wsize-state.wnext,dist>copy&&(dist=copy),utils2.arraySet(state.window,src,end-copy,dist,state.wnext),copy-=dist,copy?(utils2.arraySet(state.window,src,end-copy,copy,0),state.wnext=copy,state.whave=state.wsize):(state.wnext+=dist,state.wnext===state.wsize&&(state.wnext=0),state.whave<state.wsize&&(state.whave+=dist))),0}function inflate(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here=0,here_bits,here_op,here_val,last_bits,last_op,last_val,len2,ret,hbuf=new utils2.Buf8(4),opts,n,order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0)return Z_STREAM_ERROR;state=strm.state,state.mode===TYPE&&(state.mode=TYPEDO),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=Z_OK;inf_leave:for(;;)switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}for(;bits<16;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.wrap&2&&hold===35615){state.check=0,hbuf[0]=hold&255,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0),hold=0,bits=0,state.mode=FLAGS;break}if(state.flags=0,state.head&&(state.head.done=!1),!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(hold>>>=4,bits-=4,len2=(hold&15)+8,state.wbits===0)state.wbits=len2;else if(len2>state.wbits){strm.msg="invalid window size",state.mode=BAD;break}state.dmax=1<<len2,strm.adler=state.check=1,state.mode=hold&512?DICTID:TYPE,hold=0,bits=0;break;case FLAGS:for(;bits<16;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,(state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set",state.mode=BAD;break}state.head&&(state.head.text=hold>>8&1),state.flags&512&&(hbuf[0]=hold&255,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=TIME;case TIME:for(;bits<32;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),state.flags&512&&(hbuf[0]=hold&255,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32(state.check,hbuf,4,0)),hold=0,bits=0,state.mode=OS;case OS:for(;bits<16;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=hold&255,state.head.os=hold>>8),state.flags&512&&(hbuf[0]=hold&255,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=EXLEN;case EXLEN:if(state.flags&1024){for(;bits<16;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),state.flags&512&&(hbuf[0]=hold&255,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0}else state.head&&(state.head.extra=null);state.mode=EXTRA;case EXTRA:if(state.flags&1024&&(copy=state.length,copy>have&&(copy=have),copy&&(state.head&&(len2=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),utils2.arraySet(state.head.extra,input,next,copy,len2)),state.flags&512&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=NAME;case NAME:if(state.flags&2048){if(have===0)break inf_leave;copy=0;do len2=input[next+copy++],state.head&&len2&&state.length<65536&&(state.head.name+=String.fromCharCode(len2));while(len2&&copy<have);if(state.flags&512&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len2)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0)break inf_leave;copy=0;do len2=input[next+copy++],state.head&&len2&&state.length<65536&&(state.head.comment+=String.fromCharCode(len2));while(len2&&copy<have);if(state.flags&512&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len2)break inf_leave}else state.head&&(state.head.comment=null);state.mode=HCRC;case HCRC:if(state.flags&512){for(;bits<16;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch",state.mode=BAD;break}hold=0,bits=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=TYPE;break;case DICTID:for(;bits<32;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=zswap32(hold),hold=0,bits=0,state.mode=DICT;case DICT:if(state.havedict===0)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,Z_NEED_DICT;strm.adler=state.check=1,state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES)break inf_leave;case TYPEDO:if(state.last){hold>>>=bits&7,bits-=bits&7,state.mode=CHECK;break}for(;bits<3;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=hold&1,hold>>>=1,bits-=1,hold&3){case 0:state.mode=STORED;break;case 1:if(fixedtables(state),state.mode=LEN_,flush===Z_TREES){hold>>>=2,bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type",state.mode=BAD}hold>>>=2,bits-=2;break;case STORED:for(hold>>>=bits&7,bits-=bits&7;bits<32;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((hold&65535)!=(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=BAD;break}if(state.length=hold&65535,hold=0,bits=0,state.mode=COPY_,flush===Z_TREES)break inf_leave;case COPY_:state.mode=COPY;case COPY:if(copy=state.length,copy){if(copy>have&&(copy=have),copy>left&&(copy=left),copy===0)break inf_leave;utils2.arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=TYPE;break;case TABLE:for(;bits<14;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=(hold&31)+257,hold>>>=5,bits-=5,state.ndist=(hold&31)+1,hold>>>=5,bits-=5,state.ncode=(hold&15)+4,hold>>>=4,bits-=4,state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols",state.mode=BAD;break}state.have=0,state.mode=LENLENS;case LENLENS:for(;state.have<state.ncode;){for(;bits<3;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=hold&7,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=BAD;break}state.have=0,state.mode=CODELENS;case CODELENS:for(;state.have<state.nlen+state.ndist;){for(;here=state.lencode[hold&(1<<state.lenbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=here&65535,!(here_bits<=bits);){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_val<16)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(here_val===16){for(n=here_bits+2;bits<n;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,state.have===0){strm.msg="invalid bit length repeat",state.mode=BAD;break}len2=state.lens[state.have-1],copy=3+(hold&3),hold>>>=2,bits-=2}else if(here_val===17){for(n=here_bits+3;bits<n;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=here_bits,bits-=here_bits,len2=0,copy=3+(hold&7),hold>>>=3,bits-=3}else{for(n=here_bits+7;bits<n;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=here_bits,bits-=here_bits,len2=0,copy=11+(hold&127),hold>>>=7,bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=BAD;break}for(;copy--;)state.lens[state.have++]=len2}}if(state.mode===BAD)break;if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block",state.mode=BAD;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=BAD;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=BAD;break}if(state.mode=LEN_,flush===Z_TREES)break inf_leave;case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,inflate_fast(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,state.mode===TYPE&&(state.back=-1);break}for(state.back=0;here=state.lencode[hold&(1<<state.lenbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=here&65535,!(here_bits<=bits);){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&(here_op&240)==0){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)],here_bits=here>>>24,here_op=here>>>16&255,here_val=here&65535,!(last_bits+here_bits<=bits);){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1,state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code",state.mode=BAD;break}state.extra=here_op&15,state.mode=LENEXT;case LENEXT:if(state.extra){for(n=state.extra;bits<n;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=DIST;case DIST:for(;here=state.distcode[hold&(1<<state.distbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=here&65535,!(here_bits<=bits);){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((here_op&240)==0){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)],here_bits=here>>>24,here_op=here>>>16&255,here_val=here&65535,!(last_bits+here_bits<=bits);){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,here_op&64){strm.msg="invalid distance code",state.mode=BAD;break}state.offset=here_val,state.extra=here_op&15,state.mode=DISTEXT;case DISTEXT:if(state.extra){for(n=state.extra;bits<n;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0)break inf_leave;if(copy=_out-left,state.offset>copy){if(copy=state.offset-copy,copy>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break}copy>state.wnext?(copy-=state.wnext,from=state.wsize-copy):from=state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;copy>left&&(copy=left),left-=copy,state.length-=copy;do output[put++]=from_source[from++];while(--copy);state.length===0&&(state.mode=LEN);break;case LIT:if(left===0)break inf_leave;output[put++]=state.length,left--,state.mode=LEN;break;case CHECK:if(state.wrap){for(;bits<32;){if(have===0)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check",state.mode=BAD;break}hold=0,bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){for(;bits<32;){if(have===0)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check",state.mode=BAD;break}hold=0,bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH))&&updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)?(state.mode=MEM,Z_MEM_ERROR):(_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0),(_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK&&(ret=Z_BUF_ERROR),ret)}function inflateEnd(strm){if(!strm||!strm.state)return Z_STREAM_ERROR;var state=strm.state;return state.window&&(state.window=null),strm.state=null,Z_OK}function inflateGetHeader(strm,head){var state;return!strm||!strm.state||(state=strm.state,(state.wrap&2)==0)?Z_STREAM_ERROR:(state.head=head,head.done=!1,Z_OK)}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length,state,dictid,ret;return!strm||!strm.state||(state=strm.state,state.wrap!==0&&state.mode!==DICT)?Z_STREAM_ERROR:state.mode===DICT&&(dictid=1,dictid=adler32(dictid,dictionary,dictLength,0),dictid!==state.check)?Z_DATA_ERROR:(ret=updatewindow(strm,dictionary,dictLength,dictLength),ret?(state.mode=MEM,Z_MEM_ERROR):(state.havedict=1,Z_OK))}exports2.inflateReset=inflateReset;exports2.inflateReset2=inflateReset2;exports2.inflateResetKeep=inflateResetKeep;exports2.inflateInit=inflateInit;exports2.inflateInit2=inflateInit2;exports2.inflate=inflate;exports2.inflateEnd=inflateEnd;exports2.inflateGetHeader=inflateGetHeader;exports2.inflateSetDictionary=inflateSetDictionary;exports2.inflateInfo="pako inflate (from Nodeca project)"}});var require_constants=__commonJS({"node_modules/pako/lib/zlib/constants.js"(exports2,module2){"use strict";module2.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}});var require_gzheader=__commonJS({"node_modules/pako/lib/zlib/gzheader.js"(exports2,module2){"use strict";function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}module2.exports=GZheader}});var require_inflate2=__commonJS({"node_modules/pako/lib/inflate.js"(exports2){"use strict";var zlib_inflate=require_inflate(),utils2=require_common(),strings=require_strings(),c=require_constants(),msg=require_messages(),ZStream=require_zstream(),GZheader=require_gzheader(),toString2=Object.prototype.toString;function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=utils2.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>=0&&opt.windowBits<16&&(opt.windowBits=-opt.windowBits,opt.windowBits===0&&(opt.windowBits=-15)),opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)&&(opt.windowBits+=32),opt.windowBits>15&&opt.windowBits<48&&(opt.windowBits&15)==0&&(opt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK)throw new Error(msg[status]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),opt.dictionary&&(typeof opt.dictionary=="string"?opt.dictionary=strings.string2buf(opt.dictionary):toString2.call(opt.dictionary)==="[object ArrayBuffer]"&&(opt.dictionary=new Uint8Array(opt.dictionary)),opt.raw&&(status=zlib_inflate.inflateSetDictionary(this.strm,opt.dictionary),status!==c.Z_OK)))throw new Error(msg[status])}Inflate.prototype.push=function(data,mode){var strm=this.strm,chunkSize=this.options.chunkSize,dictionary=this.options.dictionary,status,_mode,next_out_utf8,tail,utf8str,allowBufError=!1;if(this.ended)return!1;_mode=mode===~~mode?mode:mode===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof data=="string"?strm.input=strings.binstring2buf(data):toString2.call(data)==="[object ArrayBuffer]"?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(strm.avail_out===0&&(strm.output=new utils2.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH),status===c.Z_NEED_DICT&&dictionary&&(status=zlib_inflate.inflateSetDictionary(this.strm,dictionary)),status===c.Z_BUF_ERROR&&allowBufError===!0&&(status=c.Z_OK,allowBufError=!1),status!==c.Z_STREAM_END&&status!==c.Z_OK)return this.onEnd(status),this.ended=!0,!1;strm.next_out&&(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH))&&(this.options.to==="string"?(next_out_utf8=strings.utf8border(strm.output,strm.next_out),tail=strm.next_out-next_out_utf8,utf8str=strings.buf2string(strm.output,next_out_utf8),strm.next_out=tail,strm.avail_out=chunkSize-tail,tail&&utils2.arraySet(strm.output,strm.output,next_out_utf8,tail,0),this.onData(utf8str)):this.onData(utils2.shrinkBuf(strm.output,strm.next_out))),strm.avail_in===0&&strm.avail_out===0&&(allowBufError=!0)}while((strm.avail_in>0||strm.avail_out===0)&&status!==c.Z_STREAM_END);return status===c.Z_STREAM_END&&(_mode=c.Z_FINISH),_mode===c.Z_FINISH?(status=zlib_inflate.inflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===c.Z_OK):(_mode===c.Z_SYNC_FLUSH&&(this.onEnd(c.Z_OK),strm.avail_out=0),!0)};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){status===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=utils2.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);if(inflator.push(input,!0),inflator.err)throw inflator.msg||msg[inflator.err];return inflator.result}function inflateRaw(input,options){return options=options||{},options.raw=!0,inflate(input,options)}exports2.Inflate=Inflate;exports2.inflate=inflate;exports2.inflateRaw=inflateRaw;exports2.ungzip=inflate}});var require_pako=__commonJS({"node_modules/pako/index.js"(exports2,module2){"use strict";var assign=require_common().assign,deflate=require_deflate2(),inflate=require_inflate2(),constants=require_constants(),pako2={};assign(pako2,deflate,inflate,constants);module2.exports=pako2}});var src_exports={};__export(src_exports,{core:()=>core_exports,data:()=>data_exports,hardware:()=>hardware_exports,sound:()=>sound_exports,util:()=>util_exports,visual:()=>visual_exports});var util_exports={};__export(util_exports,{Clock:()=>Clock,Color:()=>Color,ColorMixin:()=>ColorMixin,CountdownTimer:()=>CountdownTimer,EventEmitter:()=>EventEmitter,IsPointInsidePolygon:()=>IsPointInsidePolygon,MonotonicClock:()=>MonotonicClock,PsychObject:()=>PsychObject,Scheduler:()=>Scheduler,TEXT_DIRECTION:()=>TEXT_DIRECTION,addInfoFromUrl:()=>addInfoFromUrl,average:()=>average,count:()=>count,detectBrowser:()=>detectBrowser,extensionFromMimeType:()=>extensionFromMimeType,flattenArray:()=>flattenArray,getDownloadSpeed:()=>getDownloadSpeed,getErrorStack:()=>getErrorStack,getPositionFromObject:()=>getPositionFromObject,getRequestError:()=>getRequestError,getUrlParameters:()=>getUrlParameters,hasTouchScreen:()=>hasTouchScreen,index:()=>index,isEmpty:()=>isEmpty,isInt:()=>isInt,isNumeric:()=>isNumeric,linspace:()=>linspace,loadCss:()=>loadCss,makeUuid:()=>makeUuid,mix:()=>mix,offerDataForDownload:()=>offerDataForDownload,pad:()=>pad,promiseToTupple:()=>promiseToTupple,randchoice:()=>randchoice,randint:()=>randint,range:()=>range,round:()=>round,selectFromArray:()=>selectFromArray,shuffle:()=>shuffle,sliceArray:()=>sliceArray,sort:()=>sort,sum:()=>sum,toNumerical:()=>toNumerical,toString:()=>toString,to_height:()=>to_height,to_norm:()=>to_norm,to_pixiPoint:()=>to_pixiPoint,to_px:()=>to_px,to_unit:()=>to_unit,to_win:()=>to_win,turnSquareBracketsIntoArrays:()=>turnSquareBracketsIntoArrays});var MonotonicClock=class{constructor(startTime=MonotonicClock.getReferenceTime()){this._timeAtLastReset=startTime}getTime(){return MonotonicClock.getReferenceTime()-this._timeAtLastReset}getLastResetTime(){return this._timeAtLastReset}static getReferenceTime(){return performance.now()/1e3-MonotonicClock._referenceTime}static getDate(locales="en-CA",options){let dataTimeOptions=Object.assign({hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3},options),dateTimeFormat=new Intl.DateTimeFormat(locales,dataTimeOptions),date=new Date;return dateTimeFormat.format(date)}static getDateStr(){return MonotonicClock.getDate().replaceAll("/","-").replace(", ","_").replace(":","h").replace(":",".")}};MonotonicClock._referenceTime=performance.now()/1e3;var Clock=class extends MonotonicClock{constructor(){super()}reset(newTime=0){this._timeAtLastReset=MonotonicClock.getReferenceTime()+newTime}add(deltaTime){this._timeAtLastReset+=deltaTime}},CountdownTimer=class extends Clock{constructor(startTime=0){super();this._timeAtLastReset=MonotonicClock.getReferenceTime(),this._countdown_duration=startTime,startTime&&this.add(startTime)}add(deltaTime){this._timeAtLastReset+=deltaTime}reset(newTime=void 0){typeof newTime=="undefined"?this._timeAtLastReset=MonotonicClock.getReferenceTime()+this._countdown_duration:(this._countdown_duration=newTime,this._timeAtLastReset=MonotonicClock.getReferenceTime()+newTime)}getTime(){return this._timeAtLastReset-MonotonicClock.getReferenceTime()}};var Color=class{constructor(obj="black",colorspace=Color.COLOR_SPACE.RGB){let response2={origin:"Color",context:"when defining a color"};if(typeof obj=="string"){if(colorspace!==Color.COLOR_SPACE.RGB)throw Object.assign(response2,{error:"the colorspace must be RGB for a named color"});if(obj[0]==="#")this._hex=obj;else{if(!(obj.toLowerCase()in Color.NAMED_COLORS))throw Object.assign(response2,{error:"unknown named color: "+obj});this._hex=Color.NAMED_COLORS[obj.toLowerCase()]}this._rgb=Color.hexToRgb(this._hex)}else if(typeof obj=="number"){if(colorspace!==Color.COLOR_SPACE.RGB)throw Object.assign(response2,{error:"the colorspace must be RGB for a named color"});this._rgb=Color._intToRgb(obj)}else if(Array.isArray(obj)){Color._checkTypeAndRange(obj);let[a,b,c]=obj;switch(colorspace!==Color.COLOR_SPACE.RGB255&&(Color._checkTypeAndRange(obj,[-1,1]),a=(a+1)/2,b=(b+1)/2,c=(c+1)/2),colorspace){case Color.COLOR_SPACE.RGB255:Color._checkTypeAndRange(obj,[0,255]),this._rgb=[a/255,b/255,c/255];break;case Color.COLOR_SPACE.RGB:this._rgb=[a,b,c];break;case Color.COLOR_SPACE.HSV:break;case Color.COLOR_SPACE.DKL:break;case Color.COLOR_SPACE.LMS:break;default:throw Object.assign(response2,{error:"unknown colorspace: "+colorspace})}}else obj instanceof Color&&(this._rgb=obj._rgb.slice());this._rgbFull=this._rgb.map(c=>c*2-1)}get rgb(){return this._rgb}get rgbFull(){return this._rgbFull}get rgb255(){return[Math.round(this._rgb[0]*255),Math.round(this._rgb[1]*255),Math.round(this._rgb[2]*255)]}get hex(){return typeof this._hex=="undefined"&&(this._hex=Color._rgbToHex(this._rgb)),this._hex}get int(){return typeof this._int=="undefined"&&(this._int=Color._rgbToInt(this._rgb)),this._int}toString(){return this.hex}static hexToRgb255(hex){let result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);if(result==null)throw{origin:"Color.hexToRgb255",context:"when converting an hexadecimal color code to its 255- or [0,1]-based RGB color representation",error:"unable to parse the argument: wrong type or wrong code"};return[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]}static hexToRgb(hex){let[r255,g255,b255]=Color.hexToRgb255(hex);return[r255/255,g255/255,b255/255]}static rgb255ToHex(rgb255){let response2={origin:"Color.rgb255ToHex",context:"when converting an rgb triplet to its hexadecimal color representation"};try{return Color._checkTypeAndRange(rgb255,[0,255]),Color._rgb255ToHex(rgb255)}catch(error){throw Object.assign(response2,{error})}}static rgbToHex(rgb){let response2={origin:"Color.rgbToHex",context:"when converting an rgb triplet to its hexadecimal color representation"};try{return Color._checkTypeAndRange(rgb,[0,1]),Color._rgbToHex(rgb)}catch(error){throw Object.assign(response2,{error})}}static rgbToInt(rgb){let response2={origin:"Color.rgbToInt",context:"when converting an rgb triplet to its integer representation"};try{return Color._checkTypeAndRange(rgb,[0,1]),Color._rgbToInt(rgb)}catch(error){throw Object.assign(response2,{error})}}static rgb255ToInt(rgb255){let response2={origin:"Color.rgb255ToInt",context:"when converting an rgb triplet to its integer representation"};try{return Color._checkTypeAndRange(rgb255,[0,255]),Color._rgb255ToInt(rgb255)}catch(error){throw Object.assign(response2,{error})}}static _rgb255ToHex(rgb255){return"#"+((1<<24)+(rgb255[0]<<16)+(rgb255[1]<<8)+rgb255[2]).toString(16).slice(1)}static _rgbToHex(rgb){let rgb255=[Math.round(rgb[0]*255),Math.round(rgb[1]*255),Math.round(rgb[2]*255)];return Color._rgb255ToHex(rgb255)}static _rgbToInt(rgb){let rgb255=[Math.round(rgb[0]*255),Math.round(rgb[1]*255),Math.round(rgb[2]*255)];return Color._rgb255ToInt(rgb255)}static _rgb255ToInt(rgb255){return rgb255[0]*65536+rgb255[1]*256+rgb255[2]}static _intToRgb255(hex){let r255=hex>>>16,g255=(hex&65280)/256,b255=hex&255;return[r255,g255,b255]}static _intToRgb(hex){let[r255,g255,b255]=Color._intToRgb255(hex);return[r255/255,g255/255,b255/255]}static _checkTypeAndRange(arg,range3=void 0){if(!Array.isArray(arg)||arg.length!==3||typeof arg[0]!="number"||typeof arg[1]!="number"||typeof arg[2]!="number")throw"the argument should be an array of numbers of length 3";if(typeof range3!="undefined"&&(arg[0]<range3[0]||arg[0]>range3[1]||arg[1]<range3[0]||arg[1]>range3[1]||arg[2]<range3[0]||arg[2]>range3[1]))throw"the color components should all belong to ["+range3[0]+", "+range3[1]+"]"}};Color.COLOR_SPACE={RGB:Symbol.for("RGB"),RGB255:Symbol.for("RGB255")};Color.NAMED_COLORS={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8B",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};var ColorMixin=superclass=>class extends superclass{constructor(args){super(args)}setColor(color,log3){this._setAttribute("color",color,log3),this._needUpdate=!0,this._needPixiUpdate=!0}setContrast(contrast,log3){this._setAttribute("contrast",contrast,log3),this._needUpdate=!0,this._needPixiUpdate=!0}getContrastedColor(color,contrast){let rgb=color.rgb.map(c=>(c*2-1)*contrast);return new Color(rgb,Color.COLOR_SPACE.RGB)}};var import_seedrandom=__toModule(require_seedrandom2());var mix=superclass=>new MixinBuilder(superclass),MixinBuilder=class{constructor(superclass){this.superclass=superclass}with(...mixins){return mixins.reduce((c,mixin)=>mixin(c),this.superclass)}};function promiseToTupple(promise){return promise.then(data=>[null,data]).catch(error=>[error,null])}function makeUuid(root){if(typeof root=="undefined")return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){let r=Math.random()*16|0;return(c==="x"?r:r&3|8).toString(16)});{let generator=(0,import_seedrandom.default)(root),digits=generator().toString().substring(2);return digits+=generator().toString().substring(2),`${digits.substring(0,8)}-${digits.substring(8,12)}-4${digits.substring(12,15)}-8${digits.substring(15,18)}-${digits.substring(18,30)}`}}function getErrorStack(){try{throw Error("")}catch(error){let stack=error.stack.split(`
`);return stack.splice(1,1),JSON.stringify(stack.join(`
`))}}function isEmpty(x){return typeof x=="undefined"?!0:Array.isArray(x)?x.length===0||x.length===1&&typeof x[0]=="undefined":!1}function detectBrowser(){let isOpera=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(isOpera)return"Opera";if(typeof InstallTrigger!="undefined")return"Firefox";if(/constructor/i.test(window.HTMLElement)||function(p){return p.toString()==="[object SafariRemoteNotification]"}(!window.safari||typeof safari!="undefined"&&safari.pushNotification))return"Safari";let isIE=!!document.documentMode;if(isIE)return"IE";if(!isIE&&!!window.StyleMedia)return"Edge";let isChrome=window.chrome;return isChrome?"Chrome":isChrome&&navigator.userAgent.indexOf("Edg")!==-1?"EdgeChromium":(isChrome||isOpera)&&!!window.CSS?"Blink":"unknown"}function toNumerical(obj){let response2={origin:"util.toNumerical",context:"when converting an object to its numerical form"};try{if(obj===null)throw"unable to convert null to a number";if(typeof obj=="undefined")throw"unable to convert undefined to a number";if(typeof obj=="number")return obj;let convertToNumber=input=>{let n=Number.parseFloat(input);if(Number.isNaN(n))throw`unable to convert ${input} to a number`;return n};if(Array.isArray(obj))return obj.map(convertToNumber);let arrayMaybe=turnSquareBracketsIntoArrays(obj);if(Array.isArray(arrayMaybe))return arrayMaybe.map(convertToNumber);if(typeof obj=="string")return convertToNumber(obj);throw"unable to convert the object to a number"}catch(error){throw Object.assign(response2,{error})}}function isNumeric(input){return Number.isNaN(Number(input))===!1}function IsPointInsidePolygon(point,vertices){let x=point[0],y=point[1],isInside=!1;for(let i=0,j=vertices.length-1;i<vertices.length;j=i++){let xi=vertices[i][0],yi=vertices[i][1],xj=vertices[j][0],yj=vertices[j][1];yi>y!=yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(isInside=!isInside)}return isInside}function shuffle(array,randomNumberGenerator=void 0,startIndex=void 0,endIndex=void 0){if(!array||!Array.isArray(array))return array;typeof startIndex=="undefined"&&(startIndex=0),typeof endIndex=="undefined"&&(endIndex=array.length-1),typeof randomNumberGenerator=="undefined"&&(randomNumberGenerator=Math.random);for(let i=endIndex;i>startIndex;i--){let j=Math.floor(randomNumberGenerator()*(i+1));[array[i],array[j]]=[array[j],array[i]]}return array}function linspace(startValue,stopValue,cardinality){for(var arr=[],step=(stopValue-startValue)/(cardinality-1),i=0;i<cardinality;i++)arr.push(startValue+step*i);return arr}function randchoice(array,randomNumberGenerator=void 0){randomNumberGenerator===void 0&&(randomNumberGenerator=Math.random);let j=Math.floor(randomNumberGenerator()*array.length);return array[j]}function getPositionFromObject(object,units){let response2={origin:"util.getPositionFromObject",context:"when getting the position of an object"};try{if(typeof object=="undefined")throw"cannot get the position of an undefined object";let objectWin;return typeof object.getPos=="function"&&(units=object.units,objectWin=object.win,object=object.getPos()),to_px(object,units,objectWin)}catch(error){throw Object.assign(response2,{error})}}function to_px(pos,posUnit,win,integerCoordinates=!1){let response2={origin:"util.to_px",context:"when converting a position to pixel units"},pos_px;if(posUnit==="pix")pos_px=pos;else if(posUnit==="norm")pos_px=[pos[0]*win.size[0]/2,pos[1]*win.size[1]/2];else if(posUnit==="height"){let minSize=Math.min(win.size[0],win.size[1]);pos_px=[pos[0]*minSize,pos[1]*minSize]}else throw Object.assign(response2,{error:`unknown position units: ${posUnit}`});return integerCoordinates?[Math.round(pos_px[0]),Math.round(pos_px[1])]:pos_px}function to_norm(pos,posUnit,win){let response2={origin:"util.to_norm",context:"when converting a position to norm units"};if(posUnit==="norm")return pos;if(posUnit==="pix")return[pos[0]/(win.size[0]/2),pos[1]/(win.size[1]/2)];if(posUnit==="height"){let minSize=Math.min(win.size[0],win.size[1]);return[pos[0]*minSize/(win.size[0]/2),pos[1]*minSize/(win.size[1]/2)]}throw Object.assign(response2,{error:`unknown position units: ${posUnit}`})}function to_height(pos,posUnit,win){let response2={origin:"util.to_height",context:"when converting a position to height units"};if(posUnit==="height")return pos;if(posUnit==="pix"){let minSize=Math.min(win.size[0],win.size[1]);return[pos[0]/minSize,pos[1]/minSize]}if(posUnit==="norm"){let minSize=Math.min(win.size[0],win.size[1]);return[pos[0]*win.size[0]/2/minSize,pos[1]*win.size[1]/2/minSize]}throw Object.assign(response2,{error:`unknown position units: ${posUnit}`})}function to_win(pos,posUnit,win){let response2={origin:"util.to_win",context:"when converting a position to window units"};try{if(win._units==="pix")return to_px(pos,posUnit,win);if(win._units==="norm")return to_norm(pos,posUnit,win);if(win._units==="height")return to_height(pos,posUnit,win);throw`unknown window units: ${win._units}`}catch(error){throw Object.assign(response2,{response:response2,error})}}function to_unit(pos,posUnit,win,targetUnit){let response2={origin:"util.to_unit",context:"when converting a position to different units"};try{if(targetUnit==="pix")return to_px(pos,posUnit,win);if(targetUnit==="norm")return to_norm(pos,posUnit,win);if(targetUnit==="height")return to_height(pos,posUnit,win);throw`unknown target units: ${targetUnit}`}catch(error){throw Object.assign(response2,{error})}}function toString(object){if(typeof object=="undefined")return"undefined";if(!object)return"null";if(typeof object=="string")return object;if(object.constructor.toString().substring(0,5)==="class"&&typeof object.toString=="function")return object.toString();if(typeof object=="function")return`<function ${object.name}>`;try{let symbolReplacer=(key,value)=>(typeof value=="symbol"&&(value=Symbol.keyFor(value)),value);return JSON.stringify(object,symbolReplacer)}catch(e){return"Object (circular)"}}String.prototype.format||(String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match}).replace(/{([$_a-zA-Z][$_a-zA-Z0-9]*)}/g,function(match,name){return args.length>0&&args[0][name]!==void 0?args[0][name]:match})});function getRequestError(jqXHR,textStatus,errorThrown){let errorMsg="unknown error";return typeof jqXHR.responseJSON!="undefined"?errorMsg=jqXHR.responseJSON:typeof jqXHR.responseText!="undefined"?errorMsg=jqXHR.responseText:typeof errorThrown!="undefined"&&(errorMsg=errorThrown),errorMsg}function isInt(obj){if(isNaN(obj))return!1;let x=parseFloat(obj);return(x|0)===x}function getUrlParameters(){let urlQuery=window.location.search.slice(1);return new URLSearchParams(urlQuery)}function addInfoFromUrl(info){return getUrlParameters().forEach((value,key)=>{key.indexOf("__")!==0&&(info[key]=value)}),info}function selectFromArray(array,selection){if(isInt(selection))return[array[parseInt(selection)]];if(Array.isArray(selection))return selection.map(i=>array[i]);if(typeof selection=="string"){if(selection.indexOf(",")>-1){let selectionAsArray=selection.split(",").map(i=>parseInt(i));return selectFromArray(array,selectionAsArray)}else if(selection.indexOf(":")>-1){let sliceParams=selection.split(":").map(a=>parseInt(a));return sliceParams.length===3?sliceArray(array,sliceParams[0],sliceParams[2],sliceParams[1]):sliceArray(array,...sliceParams)}}else throw{origin:"selectFromArray",context:"when selecting entries from an array",error:"unknown selection type: "+typeof selection}}function flattenArray(array){return array.reduce((flat,next)=>(flat.push(Array.isArray(next)&&Array.isArray(next[0])?flattenArray(next):next),flat),[])}function sliceArray(array,from=NaN,to=NaN,step=NaN){isNaN(from)&&(from=0),isNaN(to)&&(to=array.length);let arraySlice=array.slice(from,to);return isNaN(step)||(step<0&&arraySlice.reverse(),step=Math.abs(step),step===1)?arraySlice:arraySlice.filter((e,i)=>i%step==0)}function offerDataForDownload(filename,data,type){let blob=new Blob([data],{type});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(blob,filename);else{let anchor=document.createElement("a");anchor.href=window.URL.createObjectURL(blob),anchor.download=filename,document.body.appendChild(anchor),anchor.click(),document.body.removeChild(anchor)}}function turnSquareBracketsIntoArrays(input,max=1){if(String(input)!==input)return;let matchesMaybe=input.match(/\[(.*?)\]/g);if(matchesMaybe===null)return;let matches=matchesMaybe.map(data=>data.replace(/[\[\]]+/g,"").split(/[, ]+/));return max<2?matches[0]:matches}function randint(min=0,max){let lo=min,hi=max;if(typeof max=="undefined"&&(hi=lo,lo=0),hi<lo)throw{origin:"util.randint",context:"when generating a random integer",error:"min should be <= max"};return Math.floor(Math.random()*(hi-lo))+lo}function round(input,places=0){return+(Math.round(`${input}e+${places}`)+`e-${places}`)}function sum(input=[],start2=0){if(!Array.isArray(input))return start2;let add=(a,b)=>a+b;return input.map(value=>Number(value)).filter(value=>Number.isNaN(value)===!1).reduce(add,start2)}function average(input=[]){return!Array.isArray(input)||input.length===0?0:sum(input,0)/input.length}function sort(input){let response2={origin:"util.sort",context:"when sorting the elements of an array"};try{if(!Array.isArray(input))throw"the input argument should be an array";if(input.every(element=>typeof element=="number"))return input.sort((a,b)=>a-b);if(input.every(element=>typeof element=="string"))return input.sort();throw"the input array should either consist entirely of strings or of numbers"}catch(error){throw __spreadProps(__spreadValues({},response2),{error})}}function range(...args){let response2={origin:"util.range",context:"when building a range of numbers"};try{let start2,stop,step;switch(args.length){case 0:throw"at least one argument is required";case 1:start2=0,stop=args[0],step=1;break;case 2:start2=args[0],stop=args[1],step=1;break;case 3:start2=args[0],stop=args[1],step=args[2];break;default:throw"range requires at least one and at most 3 arguments"}if(!Number.isInteger(start2))throw"start should be an integer";if(!Number.isInteger(stop))throw"stop should be an integer";if(!Number.isInteger(step))throw"step should be an integer";if(start2>=stop)return[];let result=[];for(let i=start2;i<stop;i+=step)result.push(i);return result}catch(error){throw __spreadProps(__spreadValues({},response2),{error})}}function _match(value){let response2={origin:"util._match",context:"when creating a function that compares an input element to the given value"};try{if(typeof value=="function")throw"the value cannot be a function";if(Number.isNaN(value))return element=>Number.isNaN(element);if(value===null)return element=>element===null;if(typeof value=="object"){let jsonValue=JSON.stringify(value);if(typeof jsonValue=="undefined")throw"value could not be converted to a JSON string";return element=>JSON.stringify(element)===jsonValue}return element=>element===value}catch(error){throw __spreadProps(__spreadValues({},response2),{error})}}function count(input,value){let response2={origin:"util.count",context:"when counting how many elements in the input array match the given value"};try{if(!Array.isArray(input))throw"the input argument should be an array";let match=_match(value),nbMatches=0;return input.forEach(element=>{match(element)&&++nbMatches}),nbMatches}catch(error){throw __spreadProps(__spreadValues({},response2),{error})}}function pad(n,width=2){let integerPart=Number.parseInt(n),decimalPart=(n+"").match(/\.[0-9]*/);return decimalPart||(decimalPart=""),(integerPart+"").padStart(width,"0")+decimalPart}function index(input,value){let response2={origin:"util.index",context:"when getting the index in the input array of the first element that matches the given value"};try{if(!Array.isArray(input))throw"the input argument should be an array";let match=_match(value),index3=input.findIndex(match);if(index3===-1)throw"no element in the input array matches the value";return index3}catch(error){throw __spreadProps(__spreadValues({},response2),{error})}}function extensionFromMimeType(mimeType){return typeof mimeType!="string"?".dat":mimeType.indexOf("audio/webm")===0?".webm":mimeType.indexOf("audio/ogg")===0?".ogg":mimeType.indexOf("audio/wav")===0?".wav":mimeType.indexOf("video/webm")===0?".webm":".dat"}function getDownloadSpeed(psychoJS,nbDownloads=1){let imageUrl="https://upload.wikimedia.org/wikipedia/commons/a/a6/Brandenburger_Tor_abends.jpg",imageSize_b=2707459*8;return new Promise((resolve4,reject2)=>{let downloadTimeAccumulator=0,downloadCounter=0,download=new Image;download.onload=()=>{if(downloadTimeAccumulator+=performance.now()-tic,++downloadCounter,downloadCounter===nbDownloads){let speed_bps=imageSize_b*nbDownloads/(downloadTimeAccumulator/1e3);resolve4(speed_bps/1024/1024)}else tic=performance.now(),download.src=`${imageUrl}?salt=${tic}`},download.onerror=event=>{let errorMsg=`unable to estimate the download speed: ${JSON.stringify(event)}`;psychoJS.logger.error(errorMsg),reject2(errorMsg)};let tic=performance.now();download.src=`${imageUrl}?salt=${tic}`})}function loadCss(cssId,cssPath){if(!document.getElementById(cssId)){let head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id=cssId,link.rel="stylesheet",link.type="text/css",link.href=cssPath,link.media="all",head.appendChild(link)}}function hasTouchScreen(){let hasTouchScreen2=!1;if("maxTouchPoints"in navigator)hasTouchScreen2=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)hasTouchScreen2=navigator.msMaxTouchPoints>0;else{let mQ=matchMedia==null?void 0:matchMedia("(pointer:coarse)");if((mQ==null?void 0:mQ.media)==="(pointer:coarse)")hasTouchScreen2=!!mQ.matches;else if("orientation"in window)hasTouchScreen2=!0;else{let UA=navigator.userAgent;hasTouchScreen2=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(UA)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(UA)}}return hasTouchScreen2}var TEXT_DIRECTION={LTR:"ltr",RTL:"rtl",Arabic:"rtl"};var EventEmitter=class{constructor(){this._listeners=new Map,this._onceUuids=new Map}on(name,listener){if(typeof listener!="function")throw new TypeError("listener must be a function");let uuid=makeUuid();return this._listeners.has(name)||this._listeners.set(name,[]),this._listeners.get(name).push({uuid,listener}),uuid}once(name,listener){let uuid=this.on(name,listener);return this._onceUuids.has(name)||this._onceUuids.set(name,[]),this._onceUuids.get(name).push(uuid),uuid}off(name,uuid){let relevantUuidListeners=this._listeners.get(name);return relevantUuidListeners&&relevantUuidListeners.length?(this._listeners.set(name,relevantUuidListeners.filter(uuidlistener=>uuidlistener.uuid!=uuid)),!0):!1}emit(name,data){let relevantUuidListeners=this._listeners.get(name);if(relevantUuidListeners&&relevantUuidListeners.length){let onceUuids=this._onceUuids.get(name),self2=this;return relevantUuidListeners.forEach(({uuid,listener})=>{listener(data),typeof onceUuids!="undefined"&&onceUuids.includes(uuid)&&self2.off(name,uuid)}),!0}return!1}};function finallyConstructor(callback){var constructor=this.constructor;return this.then(function(value){return constructor.resolve(callback()).then(function(){return value})},function(reason){return constructor.resolve(callback()).then(function(){return constructor.reject(reason)})})}var finally_default=finallyConstructor;function allSettled(arr){var P=this;return new P(function(resolve4,reject2){if(!(arr&&typeof arr.length!="undefined"))return reject2(new TypeError(typeof arr+" "+arr+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var args=Array.prototype.slice.call(arr);if(args.length===0)return resolve4([]);var remaining=args.length;function res(i2,val){if(val&&(typeof val=="object"||typeof val=="function")){var then=val.then;if(typeof then=="function"){then.call(val,function(val2){res(i2,val2)},function(e){args[i2]={status:"rejected",reason:e},--remaining==0&&resolve4(args)});return}}args[i2]={status:"fulfilled",value:val},--remaining==0&&resolve4(args)}for(var i=0;i<args.length;i++)res(i,args[i])})}var allSettled_default=allSettled;var setTimeoutFunc=setTimeout;function isArray(x){return Boolean(x&&typeof x.length!="undefined")}function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise2(fn){if(!(this instanceof Promise2))throw new TypeError("Promises must be constructed via new");if(typeof fn!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self2,deferred){for(;self2._state===3;)self2=self2._value;if(self2._state===0){self2._deferreds.push(deferred);return}self2._handled=!0,Promise2._immediateFn(function(){var cb=self2._state===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){(self2._state===1?resolve:reject)(deferred.promise,self2._value);return}var ret;try{ret=cb(self2._value)}catch(e){reject(deferred.promise,e);return}resolve(deferred.promise,ret)})}function resolve(self2,newValue){try{if(newValue===self2)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue=="object"||typeof newValue=="function")){var then=newValue.then;if(newValue instanceof Promise2){self2._state=3,self2._value=newValue,finale(self2);return}else if(typeof then=="function"){doResolve(bind(then,newValue),self2);return}}self2._state=1,self2._value=newValue,finale(self2)}catch(e){reject(self2,e)}}function reject(self2,newValue){self2._state=2,self2._value=newValue,finale(self2)}function finale(self2){self2._state===2&&self2._deferreds.length===0&&Promise2._immediateFn(function(){self2._handled||Promise2._unhandledRejectionFn(self2._value)});for(var i=0,len2=self2._deferreds.length;i<len2;i++)handle(self2,self2._deferreds[i]);self2._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled=="function"?onFulfilled:null,this.onRejected=typeof onRejected=="function"?onRejected:null,this.promise=promise}function doResolve(fn,self2){var done=!1;try{fn(function(value){done||(done=!0,resolve(self2,value))},function(reason){done||(done=!0,reject(self2,reason))})}catch(ex){if(done)return;done=!0,reject(self2,ex)}}Promise2.prototype.catch=function(onRejected){return this.then(null,onRejected)};Promise2.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom};Promise2.prototype.finally=finally_default;Promise2.all=function(arr){return new Promise2(function(resolve4,reject2){if(!isArray(arr))return reject2(new TypeError("Promise.all accepts an array"));var args=Array.prototype.slice.call(arr);if(args.length===0)return resolve4([]);var remaining=args.length;function res(i2,val){try{if(val&&(typeof val=="object"||typeof val=="function")){var then=val.then;if(typeof then=="function"){then.call(val,function(val2){res(i2,val2)},reject2);return}}args[i2]=val,--remaining==0&&resolve4(args)}catch(ex){reject2(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])})};Promise2.allSettled=allSettled_default;Promise2.resolve=function(value){return value&&typeof value=="object"&&value.constructor===Promise2?value:new Promise2(function(resolve4){resolve4(value)})};Promise2.reject=function(value){return new Promise2(function(resolve4,reject2){reject2(value)})};Promise2.race=function(arr){return new Promise2(function(resolve4,reject2){if(!isArray(arr))return reject2(new TypeError("Promise.race accepts an array"));for(var i=0,len2=arr.length;i<len2;i++)Promise2.resolve(arr[i]).then(resolve4,reject2)})};Promise2._immediateFn=typeof setImmediate=="function"&&function(fn){setImmediate(fn)}||function(fn){setTimeoutFunc(fn,0)};Promise2._unhandledRejectionFn=function(err){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",err)};var src_default=Promise2;var import_object_assign=__toModule(require_object_assign());self.Promise||(self.Promise=src_default);Object.assign||(Object.assign=import_object_assign.default);var ONE_FRAME_TIME=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});self.performance&&self.performance.now||(startTime_1=Date.now(),self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-startTime_1});var startTime_1,lastTime=Date.now(),vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!self.requestAnimationFrame;++x)p=vendors[x],self.requestAnimationFrame=self[p+"RequestAnimationFrame"],self.cancelAnimationFrame=self[p+"CancelAnimationFrame"]||self[p+"CancelRequestAnimationFrame"];var p;self.requestAnimationFrame||(self.requestAnimationFrame=function(callback){if(typeof callback!="function")throw new TypeError(callback+"is not a function");var currentTime=Date.now(),delay=ONE_FRAME_TIME+lastTime-currentTime;return delay<0&&(delay=0),lastTime=currentTime,self.setTimeout(function(){lastTime=Date.now(),callback(performance.now())},delay)});self.cancelAnimationFrame||(self.cancelAnimationFrame=function(id){return clearTimeout(id)});Math.sign||(Math.sign=function(x){return x=Number(x),x===0||isNaN(x)?x:x>0?1:-1});Number.isInteger||(Number.isInteger=function(value){return typeof value=="number"&&isFinite(value)&&Math.floor(value)===value});self.ArrayBuffer||(self.ArrayBuffer=Array);self.Float32Array||(self.Float32Array=Array);self.Uint32Array||(self.Uint32Array=Array);self.Uint16Array||(self.Uint16Array=Array);self.Uint8Array||(self.Uint8Array=Array);self.Int32Array||(self.Int32Array=Array);var utils_exports={};__export(utils_exports,{BaseTextureCache:()=>BaseTextureCache,CanvasRenderTarget:()=>CanvasRenderTarget,DATA_URI:()=>DATA_URI,EventEmitter:()=>import_eventemitter3.default,ProgramCache:()=>ProgramCache,TextureCache:()=>TextureCache,clearTextureCache:()=>clearTextureCache,correctBlendMode:()=>correctBlendMode,createIndicesForQuads:()=>createIndicesForQuads,decomposeDataUri:()=>decomposeDataUri,deprecation:()=>deprecation,destroyTextureCache:()=>destroyTextureCache,determineCrossOrigin:()=>determineCrossOrigin,earcut:()=>import_earcut.default,getBufferType:()=>getBufferType,getResolutionOfUrl:()=>getResolutionOfUrl,hex2rgb:()=>hex2rgb,hex2string:()=>hex2string,interleaveTypedArrays:()=>interleaveTypedArrays,isMobile:()=>isMobile2,isPow2:()=>isPow2,isWebGLSupported:()=>isWebGLSupported,log2:()=>log2,nextPow2:()=>nextPow2,premultiplyBlendMode:()=>premultiplyBlendMode,premultiplyRgba:()=>premultiplyRgba,premultiplyTint:()=>premultiplyTint,premultiplyTintToRgba:()=>premultiplyTintToRgba,removeItems:()=>removeItems,rgb2hex:()=>rgb2hex,sayHello:()=>sayHello,sign:()=>sign,skipHello:()=>skipHello,string2hex:()=>string2hex,trimCanvas:()=>trimCanvas,uid:()=>uid,url:()=>url});var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(navigator2){return typeof navigator2!="undefined"&&navigator2.platform==="MacIntel"&&typeof navigator2.maxTouchPoints=="number"&&navigator2.maxTouchPoints>1&&typeof MSStream=="undefined"};function createMatch(userAgent){return function(regex){return regex.test(userAgent)}}function isMobile(param){var nav={userAgent:"",platform:"",maxTouchPoints:0};!param&&typeof navigator!="undefined"?nav={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof param=="string"?nav.userAgent=param:param&&param.userAgent&&(nav={userAgent:param.userAgent,platform:param.platform,maxTouchPoints:param.maxTouchPoints||0});var userAgent=nav.userAgent,tmp=userAgent.split("[FBAN");typeof tmp[1]!="undefined"&&(userAgent=tmp[0]),tmp=userAgent.split("Twitter"),typeof tmp[1]!="undefined"&&(userAgent=tmp[0]);var match=createMatch(userAgent),result={apple:{phone:match(appleIphone)&&!match(windowsPhone),ipod:match(appleIpod),tablet:!match(appleIphone)&&(match(appleTablet)||isAppleTabletOnIos13(nav))&&!match(windowsPhone),universal:match(appleUniversal),device:(match(appleIphone)||match(appleIpod)||match(appleTablet)||match(appleUniversal)||isAppleTabletOnIos13(nav))&&!match(windowsPhone)},amazon:{phone:match(amazonPhone),tablet:!match(amazonPhone)&&match(amazonTablet),device:match(amazonPhone)||match(amazonTablet)},android:{phone:!match(windowsPhone)&&match(amazonPhone)||!match(windowsPhone)&&match(androidPhone),tablet:!match(windowsPhone)&&!match(amazonPhone)&&!match(androidPhone)&&(match(amazonTablet)||match(androidTablet)),device:!match(windowsPhone)&&(match(amazonPhone)||match(amazonTablet)||match(androidPhone)||match(androidTablet))||match(/\bokhttp\b/i)},windows:{phone:match(windowsPhone),tablet:match(windowsTablet),device:match(windowsPhone)||match(windowsTablet)},other:{blackberry:match(otherBlackBerry),blackberry10:match(otherBlackBerry10),opera:match(otherOpera),firefox:match(otherFirefox),chrome:match(otherChrome),device:match(otherBlackBerry)||match(otherBlackBerry10)||match(otherOpera)||match(otherFirefox)||match(otherChrome)},any:!1,phone:!1,tablet:!1};return result.any=result.apple.device||result.android.device||result.windows.device||result.other.device,result.phone=result.apple.phone||result.android.phone||result.windows.phone,result.tablet=result.apple.tablet||result.android.tablet||result.windows.tablet,result}var isMobile2=isMobile(self.navigator);function maxRecommendedTextures(max){var allowMax=!0;if(isMobile2.tablet||isMobile2.phone){if(isMobile2.apple.device){var match=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(match){var majorVersion=parseInt(match[1],10);majorVersion<11&&(allowMax=!1)}}if(isMobile2.android.device){var match=navigator.userAgent.match(/Android\s([0-9.]*)/);if(match){var majorVersion=parseInt(match[1],10);majorVersion<7&&(allowMax=!1)}}}return allowMax?max:4}function canUploadSameBuffer(){return!isMobile2.apple.device}var ENV;(function(ENV4){ENV4[ENV4.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV4[ENV4.WEBGL=1]="WEBGL",ENV4[ENV4.WEBGL2=2]="WEBGL2"})(ENV||(ENV={}));var RENDERER_TYPE;(function(RENDERER_TYPE4){RENDERER_TYPE4[RENDERER_TYPE4.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE4[RENDERER_TYPE4.WEBGL=1]="WEBGL",RENDERER_TYPE4[RENDERER_TYPE4.CANVAS=2]="CANVAS"})(RENDERER_TYPE||(RENDERER_TYPE={}));var BUFFER_BITS;(function(BUFFER_BITS4){BUFFER_BITS4[BUFFER_BITS4.COLOR=16384]="COLOR",BUFFER_BITS4[BUFFER_BITS4.DEPTH=256]="DEPTH",BUFFER_BITS4[BUFFER_BITS4.STENCIL=1024]="STENCIL"})(BUFFER_BITS||(BUFFER_BITS={}));var BLEND_MODES;(function(BLEND_MODES4){BLEND_MODES4[BLEND_MODES4.NORMAL=0]="NORMAL",BLEND_MODES4[BLEND_MODES4.ADD=1]="ADD",BLEND_MODES4[BLEND_MODES4.MULTIPLY=2]="MULTIPLY",BLEND_MODES4[BLEND_MODES4.SCREEN=3]="SCREEN",BLEND_MODES4[BLEND_MODES4.OVERLAY=4]="OVERLAY",BLEND_MODES4[BLEND_MODES4.DARKEN=5]="DARKEN",BLEND_MODES4[BLEND_MODES4.LIGHTEN=6]="LIGHTEN",BLEND_MODES4[BLEND_MODES4.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES4[BLEND_MODES4.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES4[BLEND_MODES4.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES4[BLEND_MODES4.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES4[BLEND_MODES4.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES4[BLEND_MODES4.EXCLUSION=12]="EXCLUSION",BLEND_MODES4[BLEND_MODES4.HUE=13]="HUE",BLEND_MODES4[BLEND_MODES4.SATURATION=14]="SATURATION",BLEND_MODES4[BLEND_MODES4.COLOR=15]="COLOR",BLEND_MODES4[BLEND_MODES4.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES4[BLEND_MODES4.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES4[BLEND_MODES4.ADD_NPM=18]="ADD_NPM",BLEND_MODES4[BLEND_MODES4.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES4[BLEND_MODES4.NONE=20]="NONE",BLEND_MODES4[BLEND_MODES4.SRC_OVER=0]="SRC_OVER",BLEND_MODES4[BLEND_MODES4.SRC_IN=21]="SRC_IN",BLEND_MODES4[BLEND_MODES4.SRC_OUT=22]="SRC_OUT",BLEND_MODES4[BLEND_MODES4.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES4[BLEND_MODES4.DST_OVER=24]="DST_OVER",BLEND_MODES4[BLEND_MODES4.DST_IN=25]="DST_IN",BLEND_MODES4[BLEND_MODES4.DST_OUT=26]="DST_OUT",BLEND_MODES4[BLEND_MODES4.DST_ATOP=27]="DST_ATOP",BLEND_MODES4[BLEND_MODES4.ERASE=26]="ERASE",BLEND_MODES4[BLEND_MODES4.SUBTRACT=28]="SUBTRACT",BLEND_MODES4[BLEND_MODES4.XOR=29]="XOR"})(BLEND_MODES||(BLEND_MODES={}));var DRAW_MODES;(function(DRAW_MODES4){DRAW_MODES4[DRAW_MODES4.POINTS=0]="POINTS",DRAW_MODES4[DRAW_MODES4.LINES=1]="LINES",DRAW_MODES4[DRAW_MODES4.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES4[DRAW_MODES4.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES4[DRAW_MODES4.TRIANGLES=4]="TRIANGLES",DRAW_MODES4[DRAW_MODES4.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES4[DRAW_MODES4.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(DRAW_MODES||(DRAW_MODES={}));var FORMATS;(function(FORMATS4){FORMATS4[FORMATS4.RGBA=6408]="RGBA",FORMATS4[FORMATS4.RGB=6407]="RGB",FORMATS4[FORMATS4.ALPHA=6406]="ALPHA",FORMATS4[FORMATS4.LUMINANCE=6409]="LUMINANCE",FORMATS4[FORMATS4.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS4[FORMATS4.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS4[FORMATS4.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(FORMATS||(FORMATS={}));var TARGETS;(function(TARGETS4){TARGETS4[TARGETS4.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS4[TARGETS4.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(TARGETS||(TARGETS={}));var TYPES;(function(TYPES4){TYPES4[TYPES4.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES4[TYPES4.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES4[TYPES4.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES4[TYPES4.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES4[TYPES4.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES4[TYPES4.FLOAT=5126]="FLOAT",TYPES4[TYPES4.HALF_FLOAT=36193]="HALF_FLOAT"})(TYPES||(TYPES={}));var SAMPLER_TYPES;(function(SAMPLER_TYPES4){SAMPLER_TYPES4[SAMPLER_TYPES4.FLOAT=0]="FLOAT",SAMPLER_TYPES4[SAMPLER_TYPES4.INT=1]="INT",SAMPLER_TYPES4[SAMPLER_TYPES4.UINT=2]="UINT"})(SAMPLER_TYPES||(SAMPLER_TYPES={}));var SCALE_MODES;(function(SCALE_MODES4){SCALE_MODES4[SCALE_MODES4.NEAREST=0]="NEAREST",SCALE_MODES4[SCALE_MODES4.LINEAR=1]="LINEAR"})(SCALE_MODES||(SCALE_MODES={}));var WRAP_MODES;(function(WRAP_MODES4){WRAP_MODES4[WRAP_MODES4.CLAMP=33071]="CLAMP",WRAP_MODES4[WRAP_MODES4.REPEAT=10497]="REPEAT",WRAP_MODES4[WRAP_MODES4.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(WRAP_MODES||(WRAP_MODES={}));var MIPMAP_MODES;(function(MIPMAP_MODES4){MIPMAP_MODES4[MIPMAP_MODES4.OFF=0]="OFF",MIPMAP_MODES4[MIPMAP_MODES4.POW2=1]="POW2",MIPMAP_MODES4[MIPMAP_MODES4.ON=2]="ON",MIPMAP_MODES4[MIPMAP_MODES4.ON_MANUAL=3]="ON_MANUAL"})(MIPMAP_MODES||(MIPMAP_MODES={}));var ALPHA_MODES;(function(ALPHA_MODES4){ALPHA_MODES4[ALPHA_MODES4.NPM=0]="NPM",ALPHA_MODES4[ALPHA_MODES4.UNPACK=1]="UNPACK",ALPHA_MODES4[ALPHA_MODES4.PMA=2]="PMA",ALPHA_MODES4[ALPHA_MODES4.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES4[ALPHA_MODES4.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES4[ALPHA_MODES4.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(ALPHA_MODES||(ALPHA_MODES={}));var CLEAR_MODES;(function(CLEAR_MODES4){CLEAR_MODES4[CLEAR_MODES4.NO=0]="NO",CLEAR_MODES4[CLEAR_MODES4.YES=1]="YES",CLEAR_MODES4[CLEAR_MODES4.AUTO=2]="AUTO",CLEAR_MODES4[CLEAR_MODES4.BLEND=0]="BLEND",CLEAR_MODES4[CLEAR_MODES4.CLEAR=1]="CLEAR",CLEAR_MODES4[CLEAR_MODES4.BLIT=2]="BLIT"})(CLEAR_MODES||(CLEAR_MODES={}));var GC_MODES;(function(GC_MODES4){GC_MODES4[GC_MODES4.AUTO=0]="AUTO",GC_MODES4[GC_MODES4.MANUAL=1]="MANUAL"})(GC_MODES||(GC_MODES={}));var PRECISION;(function(PRECISION4){PRECISION4.LOW="lowp",PRECISION4.MEDIUM="mediump",PRECISION4.HIGH="highp"})(PRECISION||(PRECISION={}));var MASK_TYPES;(function(MASK_TYPES4){MASK_TYPES4[MASK_TYPES4.NONE=0]="NONE",MASK_TYPES4[MASK_TYPES4.SCISSOR=1]="SCISSOR",MASK_TYPES4[MASK_TYPES4.STENCIL=2]="STENCIL",MASK_TYPES4[MASK_TYPES4.SPRITE=3]="SPRITE"})(MASK_TYPES||(MASK_TYPES={}));var MSAA_QUALITY;(function(MSAA_QUALITY4){MSAA_QUALITY4[MSAA_QUALITY4.NONE=0]="NONE",MSAA_QUALITY4[MSAA_QUALITY4.LOW=2]="LOW",MSAA_QUALITY4[MSAA_QUALITY4.MEDIUM=4]="MEDIUM",MSAA_QUALITY4[MSAA_QUALITY4.HIGH=8]="HIGH"})(MSAA_QUALITY||(MSAA_QUALITY={}));var settings={MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:isMobile2.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var import_eventemitter3=__toModule(require_eventemitter3()),import_earcut=__toModule(require_earcut()),import_url=__toModule(require_url());var ENV2;(function(ENV4){ENV4[ENV4.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV4[ENV4.WEBGL=1]="WEBGL",ENV4[ENV4.WEBGL2=2]="WEBGL2"})(ENV2||(ENV2={}));var RENDERER_TYPE2;(function(RENDERER_TYPE4){RENDERER_TYPE4[RENDERER_TYPE4.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE4[RENDERER_TYPE4.WEBGL=1]="WEBGL",RENDERER_TYPE4[RENDERER_TYPE4.CANVAS=2]="CANVAS"})(RENDERER_TYPE2||(RENDERER_TYPE2={}));var BUFFER_BITS2;(function(BUFFER_BITS4){BUFFER_BITS4[BUFFER_BITS4.COLOR=16384]="COLOR",BUFFER_BITS4[BUFFER_BITS4.DEPTH=256]="DEPTH",BUFFER_BITS4[BUFFER_BITS4.STENCIL=1024]="STENCIL"})(BUFFER_BITS2||(BUFFER_BITS2={}));var BLEND_MODES2;(function(BLEND_MODES4){BLEND_MODES4[BLEND_MODES4.NORMAL=0]="NORMAL",BLEND_MODES4[BLEND_MODES4.ADD=1]="ADD",BLEND_MODES4[BLEND_MODES4.MULTIPLY=2]="MULTIPLY",BLEND_MODES4[BLEND_MODES4.SCREEN=3]="SCREEN",BLEND_MODES4[BLEND_MODES4.OVERLAY=4]="OVERLAY",BLEND_MODES4[BLEND_MODES4.DARKEN=5]="DARKEN",BLEND_MODES4[BLEND_MODES4.LIGHTEN=6]="LIGHTEN",BLEND_MODES4[BLEND_MODES4.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES4[BLEND_MODES4.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES4[BLEND_MODES4.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES4[BLEND_MODES4.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES4[BLEND_MODES4.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES4[BLEND_MODES4.EXCLUSION=12]="EXCLUSION",BLEND_MODES4[BLEND_MODES4.HUE=13]="HUE",BLEND_MODES4[BLEND_MODES4.SATURATION=14]="SATURATION",BLEND_MODES4[BLEND_MODES4.COLOR=15]="COLOR",BLEND_MODES4[BLEND_MODES4.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES4[BLEND_MODES4.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES4[BLEND_MODES4.ADD_NPM=18]="ADD_NPM",BLEND_MODES4[BLEND_MODES4.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES4[BLEND_MODES4.NONE=20]="NONE",BLEND_MODES4[BLEND_MODES4.SRC_OVER=0]="SRC_OVER",BLEND_MODES4[BLEND_MODES4.SRC_IN=21]="SRC_IN",BLEND_MODES4[BLEND_MODES4.SRC_OUT=22]="SRC_OUT",BLEND_MODES4[BLEND_MODES4.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES4[BLEND_MODES4.DST_OVER=24]="DST_OVER",BLEND_MODES4[BLEND_MODES4.DST_IN=25]="DST_IN",BLEND_MODES4[BLEND_MODES4.DST_OUT=26]="DST_OUT",BLEND_MODES4[BLEND_MODES4.DST_ATOP=27]="DST_ATOP",BLEND_MODES4[BLEND_MODES4.ERASE=26]="ERASE",BLEND_MODES4[BLEND_MODES4.SUBTRACT=28]="SUBTRACT",BLEND_MODES4[BLEND_MODES4.XOR=29]="XOR"})(BLEND_MODES2||(BLEND_MODES2={}));var DRAW_MODES2;(function(DRAW_MODES4){DRAW_MODES4[DRAW_MODES4.POINTS=0]="POINTS",DRAW_MODES4[DRAW_MODES4.LINES=1]="LINES",DRAW_MODES4[DRAW_MODES4.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES4[DRAW_MODES4.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES4[DRAW_MODES4.TRIANGLES=4]="TRIANGLES",DRAW_MODES4[DRAW_MODES4.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES4[DRAW_MODES4.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(DRAW_MODES2||(DRAW_MODES2={}));var FORMATS2;(function(FORMATS4){FORMATS4[FORMATS4.RGBA=6408]="RGBA",FORMATS4[FORMATS4.RGB=6407]="RGB",FORMATS4[FORMATS4.ALPHA=6406]="ALPHA",FORMATS4[FORMATS4.LUMINANCE=6409]="LUMINANCE",FORMATS4[FORMATS4.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS4[FORMATS4.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS4[FORMATS4.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(FORMATS2||(FORMATS2={}));var TARGETS2;(function(TARGETS4){TARGETS4[TARGETS4.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS4[TARGETS4.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(TARGETS2||(TARGETS2={}));var TYPES2;(function(TYPES4){TYPES4[TYPES4.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES4[TYPES4.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES4[TYPES4.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES4[TYPES4.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES4[TYPES4.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES4[TYPES4.FLOAT=5126]="FLOAT",TYPES4[TYPES4.HALF_FLOAT=36193]="HALF_FLOAT"})(TYPES2||(TYPES2={}));var SAMPLER_TYPES2;(function(SAMPLER_TYPES4){SAMPLER_TYPES4[SAMPLER_TYPES4.FLOAT=0]="FLOAT",SAMPLER_TYPES4[SAMPLER_TYPES4.INT=1]="INT",SAMPLER_TYPES4[SAMPLER_TYPES4.UINT=2]="UINT"})(SAMPLER_TYPES2||(SAMPLER_TYPES2={}));var SCALE_MODES2;(function(SCALE_MODES4){SCALE_MODES4[SCALE_MODES4.NEAREST=0]="NEAREST",SCALE_MODES4[SCALE_MODES4.LINEAR=1]="LINEAR"})(SCALE_MODES2||(SCALE_MODES2={}));var WRAP_MODES2;(function(WRAP_MODES4){WRAP_MODES4[WRAP_MODES4.CLAMP=33071]="CLAMP",WRAP_MODES4[WRAP_MODES4.REPEAT=10497]="REPEAT",WRAP_MODES4[WRAP_MODES4.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(WRAP_MODES2||(WRAP_MODES2={}));var MIPMAP_MODES2;(function(MIPMAP_MODES4){MIPMAP_MODES4[MIPMAP_MODES4.OFF=0]="OFF",MIPMAP_MODES4[MIPMAP_MODES4.POW2=1]="POW2",MIPMAP_MODES4[MIPMAP_MODES4.ON=2]="ON",MIPMAP_MODES4[MIPMAP_MODES4.ON_MANUAL=3]="ON_MANUAL"})(MIPMAP_MODES2||(MIPMAP_MODES2={}));var ALPHA_MODES2;(function(ALPHA_MODES4){ALPHA_MODES4[ALPHA_MODES4.NPM=0]="NPM",ALPHA_MODES4[ALPHA_MODES4.UNPACK=1]="UNPACK",ALPHA_MODES4[ALPHA_MODES4.PMA=2]="PMA",ALPHA_MODES4[ALPHA_MODES4.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES4[ALPHA_MODES4.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES4[ALPHA_MODES4.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(ALPHA_MODES2||(ALPHA_MODES2={}));var CLEAR_MODES2;(function(CLEAR_MODES4){CLEAR_MODES4[CLEAR_MODES4.NO=0]="NO",CLEAR_MODES4[CLEAR_MODES4.YES=1]="YES",CLEAR_MODES4[CLEAR_MODES4.AUTO=2]="AUTO",CLEAR_MODES4[CLEAR_MODES4.BLEND=0]="BLEND",CLEAR_MODES4[CLEAR_MODES4.CLEAR=1]="CLEAR",CLEAR_MODES4[CLEAR_MODES4.BLIT=2]="BLIT"})(CLEAR_MODES2||(CLEAR_MODES2={}));var GC_MODES2;(function(GC_MODES4){GC_MODES4[GC_MODES4.AUTO=0]="AUTO",GC_MODES4[GC_MODES4.MANUAL=1]="MANUAL"})(GC_MODES2||(GC_MODES2={}));var PRECISION2;(function(PRECISION4){PRECISION4.LOW="lowp",PRECISION4.MEDIUM="mediump",PRECISION4.HIGH="highp"})(PRECISION2||(PRECISION2={}));var MASK_TYPES2;(function(MASK_TYPES4){MASK_TYPES4[MASK_TYPES4.NONE=0]="NONE",MASK_TYPES4[MASK_TYPES4.SCISSOR=1]="SCISSOR",MASK_TYPES4[MASK_TYPES4.STENCIL=2]="STENCIL",MASK_TYPES4[MASK_TYPES4.SPRITE=3]="SPRITE"})(MASK_TYPES2||(MASK_TYPES2={}));var MSAA_QUALITY2;(function(MSAA_QUALITY4){MSAA_QUALITY4[MSAA_QUALITY4.NONE=0]="NONE",MSAA_QUALITY4[MSAA_QUALITY4.LOW=2]="LOW",MSAA_QUALITY4[MSAA_QUALITY4.MEDIUM=4]="MEDIUM",MSAA_QUALITY4[MSAA_QUALITY4.HIGH=8]="HIGH"})(MSAA_QUALITY2||(MSAA_QUALITY2={}));var url={parse:import_url.parse,format:import_url.format,resolve:import_url.resolve};settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var saidHello=!1,VERSION="6.0.4";function skipHello(){saidHello=!0}function sayHello(type){var _a3;if(!saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=[`
 %c %c %c PixiJS `+VERSION+" - \u2730 "+type+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(_a3=self.console).log.apply(_a3,args)}else self.console&&self.console.log("PixiJS "+VERSION+" - "+type+" - http://www.pixijs.com/");saidHello=!0}}var supported;function isWebGLSupported(){return typeof supported=="undefined"&&(supported=function(){var contextOptions={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var canvas2=document.createElement("canvas"),gl=canvas2.getContext("webgl",contextOptions)||canvas2.getContext("experimental-webgl",contextOptions),success=!!(gl&&gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}return gl=null,success}catch(e){return!1}}()),supported}var aliceblue="#f0f8ff",antiquewhite="#faebd7",aqua="#00ffff",aquamarine="#7fffd4",azure="#f0ffff",beige="#f5f5dc",bisque="#ffe4c4",black="#000000",blanchedalmond="#ffebcd",blue="#0000ff",blueviolet="#8a2be2",brown="#a52a2a",burlywood="#deb887",cadetblue="#5f9ea0",chartreuse="#7fff00",chocolate="#d2691e",coral="#ff7f50",cornflowerblue="#6495ed",cornsilk="#fff8dc",crimson="#dc143c",cyan="#00ffff",darkblue="#00008b",darkcyan="#008b8b",darkgoldenrod="#b8860b",darkgray="#a9a9a9",darkgreen="#006400",darkgrey="#a9a9a9",darkkhaki="#bdb76b",darkmagenta="#8b008b",darkolivegreen="#556b2f",darkorange="#ff8c00",darkorchid="#9932cc",darkred="#8b0000",darksalmon="#e9967a",darkseagreen="#8fbc8f",darkslateblue="#483d8b",darkslategray="#2f4f4f",darkslategrey="#2f4f4f",darkturquoise="#00ced1",darkviolet="#9400d3",deeppink="#ff1493",deepskyblue="#00bfff",dimgray="#696969",dimgrey="#696969",dodgerblue="#1e90ff",firebrick="#b22222",floralwhite="#fffaf0",forestgreen="#228b22",fuchsia="#ff00ff",gainsboro="#dcdcdc",ghostwhite="#f8f8ff",goldenrod="#daa520",gold="#ffd700",gray="#808080",green="#008000",greenyellow="#adff2f",grey="#808080",honeydew="#f0fff0",hotpink="#ff69b4",indianred="#cd5c5c",indigo="#4b0082",ivory="#fffff0",khaki="#f0e68c",lavenderblush="#fff0f5",lavender="#e6e6fa",lawngreen="#7cfc00",lemonchiffon="#fffacd",lightblue="#add8e6",lightcoral="#f08080",lightcyan="#e0ffff",lightgoldenrodyellow="#fafad2",lightgray="#d3d3d3",lightgreen="#90ee90",lightgrey="#d3d3d3",lightpink="#ffb6c1",lightsalmon="#ffa07a",lightseagreen="#20b2aa",lightskyblue="#87cefa",lightslategray="#778899",lightslategrey="#778899",lightsteelblue="#b0c4de",lightyellow="#ffffe0",lime="#00ff00",limegreen="#32cd32",linen="#faf0e6",magenta="#ff00ff",maroon="#800000",mediumaquamarine="#66cdaa",mediumblue="#0000cd",mediumorchid="#ba55d3",mediumpurple="#9370db",mediumseagreen="#3cb371",mediumslateblue="#7b68ee",mediumspringgreen="#00fa9a",mediumturquoise="#48d1cc",mediumvioletred="#c71585",midnightblue="#191970",mintcream="#f5fffa",mistyrose="#ffe4e1",moccasin="#ffe4b5",navajowhite="#ffdead",navy="#000080",oldlace="#fdf5e6",olive="#808000",olivedrab="#6b8e23",orange="#ffa500",orangered="#ff4500",orchid="#da70d6",palegoldenrod="#eee8aa",palegreen="#98fb98",paleturquoise="#afeeee",palevioletred="#db7093",papayawhip="#ffefd5",peachpuff="#ffdab9",peru="#cd853f",pink="#ffc0cb",plum="#dda0dd",powderblue="#b0e0e6",purple="#800080",rebeccapurple="#663399",red="#ff0000",rosybrown="#bc8f8f",royalblue="#4169e1",saddlebrown="#8b4513",salmon="#fa8072",sandybrown="#f4a460",seagreen="#2e8b57",seashell="#fff5ee",sienna="#a0522d",silver="#c0c0c0",skyblue="#87ceeb",slateblue="#6a5acd",slategray="#708090",slategrey="#708090",snow="#fffafa",springgreen="#00ff7f",steelblue="#4682b4",tan="#d2b48c",teal="#008080",thistle="#d8bfd8",tomato="#ff6347",turquoise="#40e0d0",violet="#ee82ee",wheat="#f5deb3",white="#ffffff",whitesmoke="#f5f5f5",yellow="#ffff00",yellowgreen="#9acd32",cssColorNames={aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,goldenrod,gold,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavenderblush,lavender,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen};function hex2rgb(hex,out){return out===void 0&&(out=[]),out[0]=(hex>>16&255)/255,out[1]=(hex>>8&255)/255,out[2]=(hex&255)/255,out}function hex2string(hex){var hexString=hex.toString(16);return hexString="000000".substr(0,6-hexString.length)+hexString,"#"+hexString}function string2hex(string){return typeof string=="string"&&(string=cssColorNames[string.toLowerCase()]||string,string[0]==="#"&&(string=string.substr(1))),parseInt(string,16)}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+(rgb[2]*255|0)}function mapPremultipliedBlendModes(){for(var pm=[],npm=[],i=0;i<32;i++)pm[i]=i,npm[i]=i;pm[BLEND_MODES2.NORMAL_NPM]=BLEND_MODES2.NORMAL,pm[BLEND_MODES2.ADD_NPM]=BLEND_MODES2.ADD,pm[BLEND_MODES2.SCREEN_NPM]=BLEND_MODES2.SCREEN,npm[BLEND_MODES2.NORMAL]=BLEND_MODES2.NORMAL_NPM,npm[BLEND_MODES2.ADD]=BLEND_MODES2.ADD_NPM,npm[BLEND_MODES2.SCREEN]=BLEND_MODES2.SCREEN_NPM;var array=[];return array.push(npm),array.push(pm),array}var premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode]}function premultiplyRgba(rgb,alpha,out,premultiply){return out=out||new Float32Array(4),premultiply||premultiply===void 0?(out[0]=rgb[0]*alpha,out[1]=rgb[1]*alpha,out[2]=rgb[2]*alpha):(out[0]=rgb[0],out[1]=rgb[1],out[2]=rgb[2]),out[3]=alpha,out}function premultiplyTint(tint,alpha){if(alpha===1)return(alpha*255<<24)+tint;if(alpha===0)return 0;var R=tint>>16&255,G=tint>>8&255,B=tint&255;return R=R*alpha+.5|0,G=G*alpha+.5|0,B=B*alpha+.5|0,(alpha*255<<24)+(R<<16)+(G<<8)+B}function premultiplyTintToRgba(tint,alpha,out,premultiply){return out=out||new Float32Array(4),out[0]=(tint>>16&255)/255,out[1]=(tint>>8&255)/255,out[2]=(tint&255)/255,(premultiply||premultiply===void 0)&&(out[0]*=alpha,out[1]*=alpha,out[2]*=alpha),out[3]=alpha,out}function createIndicesForQuads(size,outBuffer){outBuffer===void 0&&(outBuffer=null);var totalIndices=size*6;if(outBuffer=outBuffer||new Uint16Array(totalIndices),outBuffer.length!==totalIndices)throw new Error("Out buffer length is incorrect, got "+outBuffer.length+" and expected "+totalIndices);for(var i=0,j=0;i<totalIndices;i+=6,j+=4)outBuffer[i+0]=j+0,outBuffer[i+1]=j+1,outBuffer[i+2]=j+2,outBuffer[i+3]=j+0,outBuffer[i+4]=j+2,outBuffer[i+5]=j+3;return outBuffer}function getBufferType(array){if(array.BYTES_PER_ELEMENT===4)return array instanceof Float32Array?"Float32Array":array instanceof Uint32Array?"Uint32Array":"Int32Array";if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array)return"Uint16Array"}else if(array.BYTES_PER_ELEMENT===1&&array instanceof Uint8Array)return"Uint8Array";return null}var map={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(arrays,sizes){for(var outSize=0,stride=0,views={},i=0;i<arrays.length;i++)stride+=sizes[i],outSize+=arrays[i].length;for(var buffer=new ArrayBuffer(outSize*4),out=null,littleOffset=0,i=0;i<arrays.length;i++){var size=sizes[i],array=arrays[i],type=getBufferType(array);views[type]||(views[type]=new map[type](buffer)),out=views[type];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset,index3=j%size;out[indexStart+index3]=array[j]}littleOffset+=size}return new Float32Array(buffer)}function nextPow2(v){return v+=v===0?1:0,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,v|=v>>>16,v+1}function isPow2(v){return!(v&v-1)&&!!v}function log2(v){var r=(v>65535?1:0)<<4;v>>>=r;var shift=(v>255?1:0)<<3;return v>>>=shift,r|=shift,shift=(v>15?1:0)<<2,v>>>=shift,r|=shift,shift=(v>3?1:0)<<1,v>>>=shift,r|=shift,r|v>>1}function removeItems(arr,startIdx,removeCount){var length=arr.length,i;if(!(startIdx>=length||removeCount===0)){removeCount=startIdx+removeCount>length?length-startIdx:removeCount;var len2=length-removeCount;for(i=startIdx;i<len2;++i)arr[i]=arr[i+removeCount];arr.length=len2}}function sign(n){return n===0?0:n<0?-1:1}var nextUid=0;function uid(){return++nextUid}var warnings={};function deprecation(version3,message,ignoreDepth){if(ignoreDepth===void 0&&(ignoreDepth=3),!warnings[message]){var stack=new Error().stack;typeof stack=="undefined"?console.warn("PixiJS Deprecation Warning: ",message+`
Deprecated since v`+version3):(stack=stack.split(`
`).splice(ignoreDepth).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",message+`
Deprecated since v`+version3),console.warn(stack),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",message+`
Deprecated since v`+version3),console.warn(stack))),warnings[message]=!0}}var ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);function destroyTextureCache(){var key;for(key in TextureCache)TextureCache[key].destroy();for(key in BaseTextureCache)BaseTextureCache[key].destroy()}function clearTextureCache(){var key;for(key in TextureCache)delete TextureCache[key];for(key in BaseTextureCache)delete BaseTextureCache[key]}var CanvasRenderTarget=function(){function CanvasRenderTarget3(width,height,resolution){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=resolution||settings.RESOLUTION,this.resize(width,height)}return CanvasRenderTarget3.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasRenderTarget3.prototype.resize=function(width,height){this.canvas.width=width*this.resolution,this.canvas.height=height*this.resolution},CanvasRenderTarget3.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(CanvasRenderTarget3.prototype,"width",{get:function(){return this.canvas.width},set:function(val){this.canvas.width=val},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasRenderTarget3.prototype,"height",{get:function(){return this.canvas.height},set:function(val){this.canvas.height=val},enumerable:!1,configurable:!0}),CanvasRenderTarget3}();function trimCanvas(canvas2){var width=canvas2.width,height=canvas2.height,context4=canvas2.getContext("2d"),imageData=context4.getImageData(0,0,width,height),pixels=imageData.data,len2=pixels.length,bound={top:null,left:null,right:null,bottom:null},data=null,i,x,y;for(i=0;i<len2;i+=4)pixels[i+3]!==0&&(x=i/4%width,y=~~(i/4/width),bound.top===null&&(bound.top=y),(bound.left===null||x<bound.left)&&(bound.left=x),(bound.right===null||bound.right<x)&&(bound.right=x+1),(bound.bottom===null||bound.bottom<y)&&(bound.bottom=y));return bound.top!==null&&(width=bound.right-bound.left,height=bound.bottom-bound.top+1,data=context4.getImageData(bound.left,bound.top,width,height)),{height,width,data}}var DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function decomposeDataUri(dataUri){var dataUriMatch=DATA_URI.exec(dataUri);if(dataUriMatch)return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():void 0,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():void 0,charset:dataUriMatch[3]?dataUriMatch[3].toLowerCase():void 0,encoding:dataUriMatch[4]?dataUriMatch[4].toLowerCase():void 0,data:dataUriMatch[5]}}var tempAnchor;function determineCrossOrigin(url$1,loc){if(loc===void 0&&(loc=self.location),url$1.indexOf("data:")===0)return"";loc=loc||self.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=url$1;var parsedUrl=url.parse(tempAnchor.href),samePort=!parsedUrl.port&&loc.port===""||parsedUrl.port===loc.port;return parsedUrl.hostname!==loc.hostname||!samePort||parsedUrl.protocol!==loc.protocol?"anonymous":""}function getResolutionOfUrl(url3,defaultValue3){var resolution=settings.RETINA_PREFIX.exec(url3);return resolution?parseFloat(resolution[1]):defaultValue3!==void 0?defaultValue3:1}var PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180,SHAPES;(function(SHAPES3){SHAPES3[SHAPES3.POLY=0]="POLY",SHAPES3[SHAPES3.RECT=1]="RECT",SHAPES3[SHAPES3.CIRC=2]="CIRC",SHAPES3[SHAPES3.ELIP=3]="ELIP",SHAPES3[SHAPES3.RREC=4]="RREC"})(SHAPES||(SHAPES={}));var Rectangle=function(){function Rectangle3(x,y,width,height){x===void 0&&(x=0),y===void 0&&(y=0),width===void 0&&(width=0),height===void 0&&(height=0),this.x=Number(x),this.y=Number(y),this.width=Number(width),this.height=Number(height),this.type=SHAPES.RECT}return Object.defineProperty(Rectangle3.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3,"EMPTY",{get:function(){return new Rectangle3(0,0,0,0)},enumerable:!1,configurable:!0}),Rectangle3.prototype.clone=function(){return new Rectangle3(this.x,this.y,this.width,this.height)},Rectangle3.prototype.copyFrom=function(rectangle){return this.x=rectangle.x,this.y=rectangle.y,this.width=rectangle.width,this.height=rectangle.height,this},Rectangle3.prototype.copyTo=function(rectangle){return rectangle.x=this.x,rectangle.y=this.y,rectangle.width=this.width,rectangle.height=this.height,rectangle},Rectangle3.prototype.contains=function(x,y){return this.width<=0||this.height<=0?!1:x>=this.x&&x<this.x+this.width&&y>=this.y&&y<this.y+this.height},Rectangle3.prototype.pad=function(paddingX,paddingY){return paddingX===void 0&&(paddingX=0),paddingY===void 0&&(paddingY=paddingX),this.x-=paddingX,this.y-=paddingY,this.width+=paddingX*2,this.height+=paddingY*2,this},Rectangle3.prototype.fit=function(rectangle){var x1=Math.max(this.x,rectangle.x),x2=Math.min(this.x+this.width,rectangle.x+rectangle.width),y1=Math.max(this.y,rectangle.y),y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=Math.max(x2-x1,0),this.y=y1,this.height=Math.max(y2-y1,0),this},Rectangle3.prototype.ceil=function(resolution,eps){resolution===void 0&&(resolution=1),eps===void 0&&(eps=.001);var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution,y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;return this.x=Math.floor((this.x+eps)*resolution)/resolution,this.y=Math.floor((this.y+eps)*resolution)/resolution,this.width=x2-this.x,this.height=y2-this.y,this},Rectangle3.prototype.enlarge=function(rectangle){var x1=Math.min(this.x,rectangle.x),x2=Math.max(this.x+this.width,rectangle.x+rectangle.width),y1=Math.min(this.y,rectangle.y),y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=x2-x1,this.y=y1,this.height=y2-y1,this},Rectangle3.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},Rectangle3}(),Circle=function(){function Circle2(x,y,radius){x===void 0&&(x=0),y===void 0&&(y=0),radius===void 0&&(radius=0),this.x=x,this.y=y,this.radius=radius,this.type=SHAPES.CIRC}return Circle2.prototype.clone=function(){return new Circle2(this.x,this.y,this.radius)},Circle2.prototype.contains=function(x,y){if(this.radius<=0)return!1;var r2=this.radius*this.radius,dx=this.x-x,dy=this.y-y;return dx*=dx,dy*=dy,dx+dy<=r2},Circle2.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},Circle2.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},Circle2}(),Ellipse=function(){function Ellipse2(x,y,halfWidth,halfHeight){x===void 0&&(x=0),y===void 0&&(y=0),halfWidth===void 0&&(halfWidth=0),halfHeight===void 0&&(halfHeight=0),this.x=x,this.y=y,this.width=halfWidth,this.height=halfHeight,this.type=SHAPES.ELIP}return Ellipse2.prototype.clone=function(){return new Ellipse2(this.x,this.y,this.width,this.height)},Ellipse2.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var normx=(x-this.x)/this.width,normy=(y-this.y)/this.height;return normx*=normx,normy*=normy,normx+normy<=1},Ellipse2.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},Ellipse2.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},Ellipse2}(),Polygon=function(){function Polygon3(){for(var arguments$1=arguments,points=[],_i=0;_i<arguments.length;_i++)points[_i]=arguments$1[_i];var flat=Array.isArray(points[0])?points[0]:points;if(typeof flat[0]!="number"){for(var p=[],i=0,il=flat.length;i<il;i++)p.push(flat[i].x,flat[i].y);flat=p}this.points=flat,this.type=SHAPES.POLY,this.closeStroke=!0}return Polygon3.prototype.clone=function(){var points=this.points.slice(),polygon=new Polygon3(points);return polygon.closeStroke=this.closeStroke,polygon},Polygon3.prototype.contains=function(x,y){for(var inside=!1,length=this.points.length/2,i=0,j=length-1;i<length;j=i++){var xi=this.points[i*2],yi=this.points[i*2+1],xj=this.points[j*2],yj=this.points[j*2+1],intersect=yi>y!=yj>y&&x<(xj-xi)*((y-yi)/(yj-yi))+xi;intersect&&(inside=!inside)}return inside},Polygon3.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(pointsDesc,currentPoint){return pointsDesc+", "+currentPoint},"")+"]")},Polygon3}(),RoundedRectangle=function(){function RoundedRectangle2(x,y,width,height,radius){x===void 0&&(x=0),y===void 0&&(y=0),width===void 0&&(width=0),height===void 0&&(height=0),radius===void 0&&(radius=20),this.x=x,this.y=y,this.width=width,this.height=height,this.radius=radius,this.type=SHAPES.RREC}return RoundedRectangle2.prototype.clone=function(){return new RoundedRectangle2(this.x,this.y,this.width,this.height,this.radius)},RoundedRectangle2.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;if(x>=this.x&&x<=this.x+this.width&&y>=this.y&&y<=this.y+this.height){if(y>=this.y+this.radius&&y<=this.y+this.height-this.radius||x>=this.x+this.radius&&x<=this.x+this.width-this.radius)return!0;var dx=x-(this.x+this.radius),dy=y-(this.y+this.radius),radius2=this.radius*this.radius;if(dx*dx+dy*dy<=radius2||(dx=x-(this.x+this.width-this.radius),dx*dx+dy*dy<=radius2)||(dy=y-(this.y+this.height-this.radius),dx*dx+dy*dy<=radius2)||(dx=x-(this.x+this.radius),dx*dx+dy*dy<=radius2))return!0}return!1},RoundedRectangle2.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},RoundedRectangle2}(),Point=function(){function Point3(x,y){x===void 0&&(x=0),y===void 0&&(y=0),this.x=0,this.y=0,this.x=x,this.y=y}return Point3.prototype.clone=function(){return new Point3(this.x,this.y)},Point3.prototype.copyFrom=function(p){return this.set(p.x,p.y),this},Point3.prototype.copyTo=function(p){return p.set(this.x,this.y),p},Point3.prototype.equals=function(p){return p.x===this.x&&p.y===this.y},Point3.prototype.set=function(x,y){return x===void 0&&(x=0),y===void 0&&(y=x),this.x=x,this.y=y,this},Point3.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},Point3}(),ObservablePoint=function(){function ObservablePoint3(cb,scope,x,y){x===void 0&&(x=0),y===void 0&&(y=0),this._x=x,this._y=y,this.cb=cb,this.scope=scope}return ObservablePoint3.prototype.clone=function(cb,scope){return cb===void 0&&(cb=this.cb),scope===void 0&&(scope=this.scope),new ObservablePoint3(cb,scope,this._x,this._y)},ObservablePoint3.prototype.set=function(x,y){return x===void 0&&(x=0),y===void 0&&(y=x),(this._x!==x||this._y!==y)&&(this._x=x,this._y=y,this.cb.call(this.scope)),this},ObservablePoint3.prototype.copyFrom=function(p){return(this._x!==p.x||this._y!==p.y)&&(this._x=p.x,this._y=p.y,this.cb.call(this.scope)),this},ObservablePoint3.prototype.copyTo=function(p){return p.set(this._x,this._y),p},ObservablePoint3.prototype.equals=function(p){return p.x===this._x&&p.y===this._y},ObservablePoint3.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(ObservablePoint3.prototype,"x",{get:function(){return this._x},set:function(value){this._x!==value&&(this._x=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(ObservablePoint3.prototype,"y",{get:function(){return this._y},set:function(value){this._y!==value&&(this._y=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),ObservablePoint3}(),Matrix=function(){function Matrix3(a,b,c,d,tx,ty){a===void 0&&(a=1),b===void 0&&(b=0),c===void 0&&(c=0),d===void 0&&(d=1),tx===void 0&&(tx=0),ty===void 0&&(ty=0),this.array=null,this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty}return Matrix3.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},Matrix3.prototype.set=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},Matrix3.prototype.toArray=function(transpose,out){this.array||(this.array=new Float32Array(9));var array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},Matrix3.prototype.apply=function(pos,newPos){newPos=newPos||new Point;var x=pos.x,y=pos.y;return newPos.x=this.a*x+this.c*y+this.tx,newPos.y=this.b*x+this.d*y+this.ty,newPos},Matrix3.prototype.applyInverse=function(pos,newPos){newPos=newPos||new Point;var id=1/(this.a*this.d+this.c*-this.b),x=pos.x,y=pos.y;return newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id,newPos},Matrix3.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},Matrix3.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},Matrix3.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},Matrix3.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},Matrix3.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){return this.a=Math.cos(rotation+skewY)*scaleX,this.b=Math.sin(rotation+skewY)*scaleX,this.c=-Math.sin(rotation-skewX)*scaleY,this.d=Math.cos(rotation-skewX)*scaleY,this.tx=x-(pivotX*this.a+pivotY*this.c),this.ty=y-(pivotX*this.b+pivotY*this.d),this},Matrix3.prototype.prepend=function(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this},Matrix3.prototype.decompose=function(transform){var a=this.a,b=this.b,c=this.c,d=this.d,pivot=transform.pivot,skewX=-Math.atan2(-c,d),skewY=Math.atan2(b,a),delta=Math.abs(skewX+skewY);return delta<1e-5||Math.abs(PI_2-delta)<1e-5?(transform.rotation=skewY,transform.skew.x=transform.skew.y=0):(transform.rotation=0,transform.skew.x=skewX,transform.skew.y=skewY),transform.scale.x=Math.sqrt(a*a+b*b),transform.scale.y=Math.sqrt(c*c+d*d),transform.position.x=this.tx+(pivot.x*a+pivot.y*c),transform.position.y=this.ty+(pivot.x*b+pivot.y*d),transform},Matrix3.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},Matrix3.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix3.prototype.clone=function(){var matrix=new Matrix3;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix3.prototype.copyTo=function(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix3.prototype.copyFrom=function(matrix){return this.a=matrix.a,this.b=matrix.b,this.c=matrix.c,this.d=matrix.d,this.tx=matrix.tx,this.ty=matrix.ty,this},Matrix3.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(Matrix3,"IDENTITY",{get:function(){return new Matrix3},enumerable:!1,configurable:!0}),Object.defineProperty(Matrix3,"TEMP_MATRIX",{get:function(){return new Matrix3},enumerable:!1,configurable:!0}),Matrix3}(),ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(var i=0;i<16;i++){var row=[];rotationCayley.push(row);for(var j=0;j<16;j++)for(var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]),_uy=signum(uy[i]*ux[j]+vy[i]*uy[j]),_vx=signum(ux[i]*vx[j]+vx[i]*vy[j]),_vy=signum(uy[i]*vx[j]+vy[i]*vy[j]),k=0;k<16;k++)if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}for(var i=0;i<16;i++){var mat=new Matrix;mat.set(ux[i],uy[i],vx[i],vy[i],0,0),rotationMatrices.push(mat)}}init();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(ind){return ux[ind]},uY:function(ind){return uy[ind]},vX:function(ind){return vx[ind]},vY:function(ind){return vy[ind]},inv:function(rotation){return rotation&8?rotation&15:-rotation&7},add:function(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][groupD8.inv(rotationFirst)]},rotate180:function(rotation){return rotation^4},isVertical:function(rotation){return(rotation&3)==2},byDirection:function(dx,dy){return Math.abs(dx)*2<=Math.abs(dy)?dy>=0?groupD8.S:groupD8.N:Math.abs(dy)*2<=Math.abs(dx)?dx>0?groupD8.E:groupD8.W:dy>0?dx>0?groupD8.SE:groupD8.SW:dx>0?groupD8.NE:groupD8.NW},matrixAppendRotationInv:function(matrix,rotation,tx,ty){tx===void 0&&(tx=0),ty===void 0&&(ty=0);var mat=rotationMatrices[groupD8.inv(rotation)];mat.tx=tx,mat.ty=ty,matrix.append(mat)}},Transform=function(){function Transform3(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return Transform3.prototype.onChange=function(){this._localID++},Transform3.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},Transform3.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},Transform3.prototype.updateLocalTransform=function(){var lt=this.localTransform;this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1)},Transform3.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._parentID=parentTransform._worldID,this._worldID++}},Transform3.prototype.setFromMatrix=function(matrix){matrix.decompose(this),this._localID++},Object.defineProperty(Transform3.prototype,"rotation",{get:function(){return this._rotation},set:function(value){this._rotation!==value&&(this._rotation=value,this.updateSkew())},enumerable:!1,configurable:!0}),Transform3.IDENTITY=new Transform3,Transform3}();settings.SORTABLE_CHILDREN=!1;var Bounds=function(){function Bounds2(){this.minX=Infinity,this.minY=Infinity,this.maxX=-Infinity,this.maxY=-Infinity,this.rect=null,this.updateID=-1}return Bounds2.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},Bounds2.prototype.clear=function(){this.minX=Infinity,this.minY=Infinity,this.maxX=-Infinity,this.maxY=-Infinity},Bounds2.prototype.getRectangle=function(rect){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(rect=rect||new Rectangle(0,0,1,1),rect.x=this.minX,rect.y=this.minY,rect.width=this.maxX-this.minX,rect.height=this.maxY-this.minY,rect)},Bounds2.prototype.addPoint=function(point){this.minX=Math.min(this.minX,point.x),this.maxX=Math.max(this.maxX,point.x),this.minY=Math.min(this.minY,point.y),this.maxY=Math.max(this.maxY,point.y)},Bounds2.prototype.addPointMatrix=function(matrix,point){var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,x=a*point.x+c*point.y+tx,y=b*point.x+d*point.y+ty;this.minX=Math.min(this.minX,x),this.maxX=Math.max(this.maxX,x),this.minY=Math.min(this.minY,y),this.maxY=Math.max(this.maxY,y)},Bounds2.prototype.addQuad=function(vertices){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x=vertices[0],y=vertices[1];minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=vertices[2],y=vertices[3],minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=vertices[4],y=vertices[5],minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=vertices[6],y=vertices[7],minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds2.prototype.addFrame=function(transform,x0,y0,x1,y1){this.addFrameMatrix(transform.worldTransform,x0,y0,x1,y1)},Bounds2.prototype.addFrameMatrix=function(matrix,x0,y0,x1,y1){var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x=a*x0+c*y0+tx,y=b*x0+d*y0+ty;minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=a*x1+c*y0+tx,y=b*x1+d*y0+ty,minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=a*x0+c*y1+tx,y=b*x0+d*y1+ty,minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=a*x1+c*y1+tx,y=b*x1+d*y1+ty,minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds2.prototype.addVertexData=function(vertexData,beginOffset,endOffset){for(var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,i=beginOffset;i<endOffset;i+=2){var x=vertexData[i],y=vertexData[i+1];minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds2.prototype.addVertices=function(transform,vertices,beginOffset,endOffset){this.addVerticesMatrix(transform.worldTransform,vertices,beginOffset,endOffset)},Bounds2.prototype.addVerticesMatrix=function(matrix,vertices,beginOffset,endOffset,padX,padY){padX===void 0&&(padX=0),padY===void 0&&(padY=padX);for(var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i],rawY=vertices[i+1],x=a*rawX+c*rawY+tx,y=d*rawY+b*rawX+ty;minX=Math.min(minX,x-padX),maxX=Math.max(maxX,x+padX),minY=Math.min(minY,y-padY),maxY=Math.max(maxY,y+padY)}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds2.prototype.addBounds=function(bounds){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX,this.minY=bounds.minY<minY?bounds.minY:minY,this.maxX=bounds.maxX>maxX?bounds.maxX:maxX,this.maxY=bounds.maxY>maxY?bounds.maxY:maxY},Bounds2.prototype.addBoundsMask=function(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX,_minY=bounds.minY>mask.minY?bounds.minY:mask.minY,_maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX,_maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}},Bounds2.prototype.addBoundsMatrix=function(bounds,matrix){this.addFrameMatrix(matrix,bounds.minX,bounds.minY,bounds.maxX,bounds.maxY)},Bounds2.prototype.addBoundsArea=function(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x,_minY=bounds.minY>area.y?bounds.minY:area.y,_maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width,_maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}},Bounds2.prototype.pad=function(paddingX,paddingY){paddingX===void 0&&(paddingX=0),paddingY===void 0&&(paddingY=paddingX),this.isEmpty()||(this.minX-=paddingX,this.maxX+=paddingX,this.minY-=paddingY,this.maxY+=paddingY)},Bounds2.prototype.addFramePad=function(x0,y0,x1,y1,padX,padY){x0-=padX,y0-=padY,x1+=padX,y1+=padY,this.minX=this.minX<x0?this.minX:x0,this.maxX=this.maxX>x1?this.maxX:x1,this.minY=this.minY<y0?this.minY:y0,this.maxY=this.maxY>y1?this.maxY:y1},Bounds2}();var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics(d,b)};function __extends(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var DisplayObject=function(_super){__extends(DisplayObject2,_super);function DisplayObject2(){var _this=_super.call(this)||this;return _this.tempDisplayObjectParent=null,_this.transform=new Transform,_this.alpha=1,_this.visible=!0,_this.renderable=!0,_this.parent=null,_this.worldAlpha=1,_this._lastSortedIndex=0,_this._zIndex=0,_this.filterArea=null,_this.filters=null,_this._enabledFilters=null,_this._bounds=new Bounds,_this._localBounds=null,_this._boundsID=0,_this._boundsRect=null,_this._localBoundsRect=null,_this._mask=null,_this._destroyed=!1,_this.isSprite=!1,_this.isMask=!1,_this}return DisplayObject2.mixin=function(source){for(var keys2=Object.keys(source),i=0;i<keys2.length;++i){var propertyName=keys2[i];Object.defineProperty(DisplayObject2.prototype,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}},DisplayObject2.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},DisplayObject2.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},DisplayObject2.prototype.getBounds=function(skipUpdate,rect){return skipUpdate||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),rect||(this._boundsRect||(this._boundsRect=new Rectangle),rect=this._boundsRect),this._bounds.getRectangle(rect)},DisplayObject2.prototype.getLocalBounds=function(rect){rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);var transformRef=this.transform,parentRef=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var worldBounds=this._bounds,worldBoundsID=this._boundsID;this._bounds=this._localBounds;var bounds=this.getBounds(!1,rect);return this.parent=parentRef,this.transform=transformRef,this._bounds=worldBounds,this._bounds.updateID+=this._boundsID-worldBoundsID,bounds},DisplayObject2.prototype.toGlobal=function(position,point,skipUpdate){return skipUpdate===void 0&&(skipUpdate=!1),skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(position,point)},DisplayObject2.prototype.toLocal=function(position,from,point,skipUpdate){return from&&(position=from.toGlobal(position,point,skipUpdate)),skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(position,point)},DisplayObject2.prototype.setParent=function(container){if(!container||!container.addChild)throw new Error("setParent: Argument must be a Container");return container.addChild(this),container},DisplayObject2.prototype.setTransform=function(x,y,scaleX,scaleY,rotation,skewX,skewY,pivotX,pivotY){return x===void 0&&(x=0),y===void 0&&(y=0),scaleX===void 0&&(scaleX=1),scaleY===void 0&&(scaleY=1),rotation===void 0&&(rotation=0),skewX===void 0&&(skewX=0),skewY===void 0&&(skewY=0),pivotX===void 0&&(pivotX=0),pivotY===void 0&&(pivotY=0),this.position.x=x,this.position.y=y,this.scale.x=scaleX||1,this.scale.y=scaleY||1,this.rotation=rotation,this.skew.x=skewX,this.skew.y=skewY,this.pivot.x=pivotX,this.pivot.y=pivotY,this},DisplayObject2.prototype.destroy=function(_options){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(DisplayObject2.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),DisplayObject2.prototype.enableTempParent=function(){var myParent=this.parent;return this.parent=this._tempDisplayObjectParent,myParent},DisplayObject2.prototype.disableTempParent=function(cacheParent){this.parent=cacheParent},Object.defineProperty(DisplayObject2.prototype,"x",{get:function(){return this.position.x},set:function(value){this.transform.position.x=value},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"y",{get:function(){return this.position.y},set:function(value){this.transform.position.y=value},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"position",{get:function(){return this.transform.position},set:function(value){this.transform.position.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"scale",{get:function(){return this.transform.scale},set:function(value){this.transform.scale.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(value){this.transform.pivot.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"skew",{get:function(){return this.transform.skew},set:function(value){this.transform.skew.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(value){this.transform.rotation=value},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"angle",{get:function(){return this.transform.rotation*RAD_TO_DEG},set:function(value){this.transform.rotation=value*DEG_TO_RAD},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"zIndex",{get:function(){return this._zIndex},set:function(value){this._zIndex=value,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"worldVisible",{get:function(){var item=this;do{if(!item.visible)return!1;item=item.parent}while(item);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject2.prototype,"mask",{get:function(){return this._mask},set:function(value){if(this._mask){var maskObject=this._mask.maskObject||this._mask;maskObject.renderable=!0,maskObject.isMask=!1}if(this._mask=value,this._mask){var maskObject=this._mask.maskObject||this._mask;maskObject.renderable=!1,maskObject.isMask=!0}},enumerable:!1,configurable:!0}),DisplayObject2}(import_eventemitter3.default),TemporaryDisplayObject=function(_super){__extends(TemporaryDisplayObject2,_super);function TemporaryDisplayObject2(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.sortDirty=null,_this}return TemporaryDisplayObject2}(DisplayObject);DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;function sortChildren(a,b){return a.zIndex===b.zIndex?a._lastSortedIndex-b._lastSortedIndex:a.zIndex-b.zIndex}var Container=function(_super){__extends(Container2,_super);function Container2(){var _this=_super.call(this)||this;return _this.children=[],_this.sortableChildren=settings.SORTABLE_CHILDREN,_this.sortDirty=!1,_this}return Container2.prototype.onChildrenChange=function(_length){},Container2.prototype.addChild=function(){for(var arguments$1=arguments,children=[],_i=0;_i<arguments.length;_i++)children[_i]=arguments$1[_i];if(children.length>1)for(var i=0;i<children.length;i++)this.addChild(children[i]);else{var child=children[0];child.parent&&child.parent.removeChild(child),child.parent=this,this.sortDirty=!0,child.transform._parentID=-1,this.children.push(child),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",child,this,this.children.length-1),child.emit("added",this)}return children[0]},Container2.prototype.addChildAt=function(child,index3){if(index3<0||index3>this.children.length)throw new Error(child+"addChildAt: The index "+index3+" supplied is out of bounds "+this.children.length);return child.parent&&child.parent.removeChild(child),child.parent=this,this.sortDirty=!0,child.transform._parentID=-1,this.children.splice(index3,0,child),this._boundsID++,this.onChildrenChange(index3),child.emit("added",this),this.emit("childAdded",child,this,index3),child},Container2.prototype.swapChildren=function(child,child2){if(child!==child2){var index1=this.getChildIndex(child),index22=this.getChildIndex(child2);this.children[index1]=child2,this.children[index22]=child,this.onChildrenChange(index1<index22?index1:index22)}},Container2.prototype.getChildIndex=function(child){var index3=this.children.indexOf(child);if(index3===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return index3},Container2.prototype.setChildIndex=function(child,index3){if(index3<0||index3>=this.children.length)throw new Error("The index "+index3+" supplied is out of bounds "+this.children.length);var currentIndex=this.getChildIndex(child);removeItems(this.children,currentIndex,1),this.children.splice(index3,0,child),this.onChildrenChange(index3)},Container2.prototype.getChildAt=function(index3){if(index3<0||index3>=this.children.length)throw new Error("getChildAt: Index ("+index3+") does not exist.");return this.children[index3]},Container2.prototype.removeChild=function(){for(var arguments$1=arguments,children=[],_i=0;_i<arguments.length;_i++)children[_i]=arguments$1[_i];if(children.length>1)for(var i=0;i<children.length;i++)this.removeChild(children[i]);else{var child=children[0],index3=this.children.indexOf(child);if(index3===-1)return null;child.parent=null,child.transform._parentID=-1,removeItems(this.children,index3,1),this._boundsID++,this.onChildrenChange(index3),child.emit("removed",this),this.emit("childRemoved",child,this,index3)}return children[0]},Container2.prototype.removeChildAt=function(index3){var child=this.getChildAt(index3);return child.parent=null,child.transform._parentID=-1,removeItems(this.children,index3,1),this._boundsID++,this.onChildrenChange(index3),child.emit("removed",this),this.emit("childRemoved",child,this,index3),child},Container2.prototype.removeChildren=function(beginIndex,endIndex){beginIndex===void 0&&(beginIndex=0),endIndex===void 0&&(endIndex=this.children.length);var begin=beginIndex,end=endIndex,range3=end-begin,removed;if(range3>0&&range3<=end){removed=this.children.splice(begin,range3);for(var i=0;i<removed.length;++i)removed[i].parent=null,removed[i].transform&&(removed[i].transform._parentID=-1);this._boundsID++,this.onChildrenChange(beginIndex);for(var i=0;i<removed.length;++i)removed[i].emit("removed",this),this.emit("childRemoved",removed[i],this,i);return removed}else if(range3===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},Container2.prototype.sortChildren=function(){for(var sortRequired=!1,i=0,j=this.children.length;i<j;++i){var child=this.children[i];child._lastSortedIndex=i,!sortRequired&&child.zIndex!==0&&(sortRequired=!0)}sortRequired&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1},Container2.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child.visible&&child.updateTransform()}},Container2.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];if(!(!child.visible||!child.renderable))if(child.calculateBounds(),child._mask){var maskObject=child._mask.maskObject||child._mask;maskObject.calculateBounds(),this._bounds.addBoundsMask(child._bounds,maskObject._bounds)}else child.filterArea?this._bounds.addBoundsArea(child._bounds,child.filterArea):this._bounds.addBounds(child._bounds)}this._bounds.updateID=this._boundsID},Container2.prototype.getLocalBounds=function(rect,skipChildrenUpdate){skipChildrenUpdate===void 0&&(skipChildrenUpdate=!1);var result=_super.prototype.getLocalBounds.call(this,rect);if(!skipChildrenUpdate)for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child.visible&&child.updateTransform()}return result},Container2.prototype._calculateBounds=function(){},Container2.prototype.render=function(renderer){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(renderer);else{this._render(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].render(renderer)}},Container2.prototype.renderAdvanced=function(renderer){renderer.batch.flush();var filters2=this.filters,mask=this._mask;if(filters2){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var i=0;i<filters2.length;i++)filters2[i].enabled&&this._enabledFilters.push(filters2[i]);this._enabledFilters.length&&renderer.filter.push(this,this._enabledFilters)}mask&&renderer.mask.push(this,this._mask),this._render(renderer);for(var i=0,j=this.children.length;i<j;i++)this.children[i].render(renderer);renderer.batch.flush(),mask&&renderer.mask.pop(this),filters2&&this._enabledFilters&&this._enabledFilters.length&&renderer.filter.pop()},Container2.prototype._render=function(_renderer){},Container2.prototype.destroy=function(options){_super.prototype.destroy.call(this),this.sortDirty=!1;var destroyChildren=typeof options=="boolean"?options:options&&options.children,oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren)for(var i=0;i<oldChildren.length;++i)oldChildren[i].destroy(options)},Object.defineProperty(Container2.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(value){var width=this.getLocalBounds().width;width!==0?this.scale.x=value/width:this.scale.x=1,this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(Container2.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(value){var height=this.getLocalBounds().height;height!==0?this.scale.y=value/height:this.scale.y=1,this._height=value},enumerable:!1,configurable:!0}),Container2}(DisplayObject);Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;var accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);var KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2,AccessibilityManager=function(){function AccessibilityManager2(renderer){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile2.tablet||isMobile2.phone)&&this.createTouchHook();var div=document.createElement("div");div.style.width=DIV_TOUCH_SIZE+"px",div.style.height=DIV_TOUCH_SIZE+"px",div.style.position="absolute",div.style.top=DIV_TOUCH_POS_X+"px",div.style.left=DIV_TOUCH_POS_Y+"px",div.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=div,this.renderer=renderer,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(AccessibilityManager2.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(AccessibilityManager2.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),AccessibilityManager2.prototype.createTouchHook=function(){var _this=this,hookDiv=document.createElement("button");hookDiv.style.width=DIV_HOOK_SIZE+"px",hookDiv.style.height=DIV_HOOK_SIZE+"px",hookDiv.style.position="absolute",hookDiv.style.top=DIV_HOOK_POS_X+"px",hookDiv.style.left=DIV_HOOK_POS_Y+"px",hookDiv.style.zIndex=DIV_HOOK_ZINDEX.toString(),hookDiv.style.backgroundColor="#FF0000",hookDiv.title="select to enable accessibility for this content",hookDiv.addEventListener("focus",function(){_this._isMobileAccessibility=!0,_this.activate(),_this.destroyTouchHook()}),document.body.appendChild(hookDiv),this._hookDiv=hookDiv},AccessibilityManager2.prototype.destroyTouchHook=function(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)},AccessibilityManager2.prototype.activate=function(){var _a3;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(_a3=this.renderer.view.parentNode)===null||_a3===void 0||_a3.appendChild(this.div))},AccessibilityManager2.prototype.deactivate=function(){var _a3;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(_a3=this.div.parentNode)===null||_a3===void 0||_a3.removeChild(this.div))},AccessibilityManager2.prototype.updateAccessibleObjects=function(displayObject){if(!(!displayObject.visible||!displayObject.accessibleChildren)){displayObject.accessible&&displayObject.interactive&&(displayObject._accessibleActive||this.addChild(displayObject),displayObject.renderId=this.renderId);for(var children=displayObject.children,i=0;i<children.length;i++)this.updateAccessibleObjects(children[i])}},AccessibilityManager2.prototype.update=function(){var now2=performance.now();if(!(isMobile2.android.device&&now2<this.androidUpdateCount)&&(this.androidUpdateCount=now2+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var _a3=this.renderer.view.getBoundingClientRect(),left=_a3.left,top=_a3.top,width=_a3.width,height=_a3.height,_b2=this.renderer,viewWidth=_b2.width,viewHeight=_b2.height,resolution=_b2.resolution,sx=width/viewWidth*resolution,sy=height/viewHeight*resolution,div=this.div;div.style.left=left+"px",div.style.top=top+"px",div.style.width=viewWidth+"px",div.style.height=viewHeight+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId)child._accessibleActive=!1,removeItems(this.children,i,1),this.div.removeChild(child._accessibleDiv),this.pool.push(child._accessibleDiv),child._accessibleDiv=null,i--;else{div=child._accessibleDiv;var hitArea=child.hitArea,wt=child.worldTransform;child.hitArea?(div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px",div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px",div.style.width=hitArea.width*wt.a*sx+"px",div.style.height=hitArea.height*wt.d*sy+"px"):(hitArea=child.getBounds(),this.capHitArea(hitArea),div.style.left=hitArea.x*sx+"px",div.style.top=hitArea.y*sy+"px",div.style.width=hitArea.width*sx+"px",div.style.height=hitArea.height*sy+"px",div.title!==child.accessibleTitle&&child.accessibleTitle!==null&&(div.title=child.accessibleTitle),div.getAttribute("aria-label")!==child.accessibleHint&&child.accessibleHint!==null&&div.setAttribute("aria-label",child.accessibleHint)),(child.accessibleTitle!==div.title||child.tabIndex!==div.tabIndex)&&(div.title=child.accessibleTitle,div.tabIndex=child.tabIndex,this.debug&&this.updateDebugHTML(div))}}this.renderId++}},AccessibilityManager2.prototype.updateDebugHTML=function(div){div.innerHTML="type: "+div.type+"</br> title : "+div.title+"</br> tabIndex: "+div.tabIndex},AccessibilityManager2.prototype.capHitArea=function(hitArea){hitArea.x<0&&(hitArea.width+=hitArea.x,hitArea.x=0),hitArea.y<0&&(hitArea.height+=hitArea.y,hitArea.y=0);var _a3=this.renderer,viewWidth=_a3.width,viewHeight=_a3.height;hitArea.x+hitArea.width>viewWidth&&(hitArea.width=viewWidth-hitArea.x),hitArea.y+hitArea.height>viewHeight&&(hitArea.height=viewHeight-hitArea.y)},AccessibilityManager2.prototype.addChild=function(displayObject){var div=this.pool.pop();div||(div=document.createElement("button"),div.style.width=DIV_TOUCH_SIZE+"px",div.style.height=DIV_TOUCH_SIZE+"px",div.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",div.style.position="absolute",div.style.zIndex=DIV_TOUCH_ZINDEX.toString(),div.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?div.setAttribute("aria-live","off"):div.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?div.setAttribute("aria-relevant","additions"):div.setAttribute("aria-relevant","text"),div.addEventListener("click",this._onClick.bind(this)),div.addEventListener("focus",this._onFocus.bind(this)),div.addEventListener("focusout",this._onFocusOut.bind(this))),div.style.pointerEvents=displayObject.accessiblePointerEvents,div.type=displayObject.accessibleType,displayObject.accessibleTitle&&displayObject.accessibleTitle!==null?div.title=displayObject.accessibleTitle:(!displayObject.accessibleHint||displayObject.accessibleHint===null)&&(div.title="displayObject "+displayObject.tabIndex),displayObject.accessibleHint&&displayObject.accessibleHint!==null&&div.setAttribute("aria-label",displayObject.accessibleHint),this.debug&&this.updateDebugHTML(div),displayObject._accessibleActive=!0,displayObject._accessibleDiv=div,div.displayObject=displayObject,this.children.push(displayObject),this.div.appendChild(displayObject._accessibleDiv),displayObject._accessibleDiv.tabIndex=displayObject.tabIndex},AccessibilityManager2.prototype._onClick=function(e){var interactionManager=this.renderer.plugins.interaction,displayObject=e.target.displayObject,eventData=interactionManager.eventData;interactionManager.dispatchEvent(displayObject,"click",eventData),interactionManager.dispatchEvent(displayObject,"pointertap",eventData),interactionManager.dispatchEvent(displayObject,"tap",eventData)},AccessibilityManager2.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var interactionManager=this.renderer.plugins.interaction,displayObject=e.target.displayObject,eventData=interactionManager.eventData;interactionManager.dispatchEvent(displayObject,"mouseover",eventData)},AccessibilityManager2.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var interactionManager=this.renderer.plugins.interaction,displayObject=e.target.displayObject,eventData=interactionManager.eventData;interactionManager.dispatchEvent(displayObject,"mouseout",eventData)},AccessibilityManager2.prototype._onKeyDown=function(e){e.keyCode===KEY_CODE_TAB&&this.activate()},AccessibilityManager2.prototype._onMouseMove=function(e){e.movementX===0&&e.movementY===0||this.deactivate()},AccessibilityManager2.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},AccessibilityManager2}();settings.TARGET_FPMS=.06;var UPDATE_PRIORITY;(function(UPDATE_PRIORITY3){UPDATE_PRIORITY3[UPDATE_PRIORITY3.INTERACTION=50]="INTERACTION",UPDATE_PRIORITY3[UPDATE_PRIORITY3.HIGH=25]="HIGH",UPDATE_PRIORITY3[UPDATE_PRIORITY3.NORMAL=0]="NORMAL",UPDATE_PRIORITY3[UPDATE_PRIORITY3.LOW=-25]="LOW",UPDATE_PRIORITY3[UPDATE_PRIORITY3.UTILITY=-50]="UTILITY"})(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=function(){function TickerListener3(fn,context4,priority,once){context4===void 0&&(context4=null),priority===void 0&&(priority=0),once===void 0&&(once=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=fn,this.context=context4,this.priority=priority,this.once=once}return TickerListener3.prototype.match=function(fn,context4){return context4===void 0&&(context4=null),this.fn===fn&&this.context===context4},TickerListener3.prototype.emit=function(deltaTime){this.fn&&(this.context?this.fn.call(this.context,deltaTime):this.fn(deltaTime));var redirect=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),redirect},TickerListener3.prototype.connect=function(previous){this.previous=previous,previous.next&&(previous.next.previous=this),this.next=previous.next,previous.next=this},TickerListener3.prototype.destroy=function(hard){hard===void 0&&(hard=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var redirect=this.next;return this.next=hard?null:redirect,this.previous=null,redirect},TickerListener3}(),Ticker=function(){function Ticker4(){var _this=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,Infinity),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(time){_this._requestId=null,_this.started&&(_this.update(time),_this.started&&_this._requestId===null&&_this._head.next&&(_this._requestId=requestAnimationFrame(_this._tick)))}}return Ticker4.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},Ticker4.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker4.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker4.prototype.add=function(fn,context4,priority){return priority===void 0&&(priority=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(fn,context4,priority))},Ticker4.prototype.addOnce=function(fn,context4,priority){return priority===void 0&&(priority=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(fn,context4,priority,!0))},Ticker4.prototype._addListener=function(listener){var current=this._head.next,previous=this._head;if(!current)listener.connect(previous);else{for(;current;){if(listener.priority>current.priority){listener.connect(previous);break}previous=current,current=current.next}listener.previous||listener.connect(previous)}return this._startIfPossible(),this},Ticker4.prototype.remove=function(fn,context4){for(var listener=this._head.next;listener;)listener.match(fn,context4)?listener=listener.destroy():listener=listener.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(Ticker4.prototype,"count",{get:function(){if(!this._head)return 0;for(var count2=0,current=this._head;current=current.next;)count2++;return count2},enumerable:!1,configurable:!0}),Ticker4.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker4.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker4.prototype.destroy=function(){if(!this._protected){this.stop();for(var listener=this._head.next;listener;)listener=listener.destroy(!0);this._head.destroy(),this._head=null}},Ticker4.prototype.update=function(currentTime){currentTime===void 0&&(currentTime=performance.now());var elapsedMS;if(currentTime>this.lastTime){if(elapsedMS=this.elapsedMS=currentTime-this.lastTime,elapsedMS>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),elapsedMS*=this.speed,this._minElapsedMS){var delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS)return;this._lastFrame=currentTime-delta%this._minElapsedMS}this.deltaMS=elapsedMS,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var head=this._head,listener=head.next;listener;)listener=listener.emit(this.deltaTime);head.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=currentTime},Object.defineProperty(Ticker4.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPS=Math.min(this.maxFPS,fps),minFPMS=Math.min(Math.max(0,minFPS)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/minFPMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(fps){if(fps===0)this._minElapsedMS=0;else{var maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4,"shared",{get:function(){if(!Ticker4._shared){var shared=Ticker4._shared=new Ticker4;shared.autoStart=!0,shared._protected=!0}return Ticker4._shared},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4,"system",{get:function(){if(!Ticker4._system){var system=Ticker4._system=new Ticker4;system.autoStart=!0,system._protected=!0}return Ticker4._system},enumerable:!1,configurable:!0}),Ticker4}(),TickerPlugin=function(){function TickerPlugin2(){}return TickerPlugin2.init=function(options){var _this=this;options=Object.assign({autoStart:!0,sharedTicker:!1},options),Object.defineProperty(this,"ticker",{set:function(ticker){this._ticker&&this._ticker.remove(this.render,this),this._ticker=ticker,ticker&&ticker.add(this.render,this,UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){_this._ticker.stop()},this.start=function(){_this._ticker.start()},this._ticker=null,this.ticker=options.sharedTicker?Ticker.shared:new Ticker,options.autoStart&&this.start()},TickerPlugin2.destroy=function(){if(this._ticker){var oldTicker=this._ticker;this.ticker=null,oldTicker.destroy()}},TickerPlugin2}();var InteractionData=function(){function InteractionData2(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(InteractionData2.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),InteractionData2.prototype.getLocalPosition=function(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)},InteractionData2.prototype.copyEvent=function(event){"isPrimary"in event&&event.isPrimary&&(this.isPrimary=!0),this.button="button"in event&&event.button;var buttons="buttons"in event&&event.buttons;this.buttons=Number.isInteger(buttons)?buttons:"which"in event&&event.which,this.width="width"in event&&event.width,this.height="height"in event&&event.height,this.tiltX="tiltX"in event&&event.tiltX,this.tiltY="tiltY"in event&&event.tiltY,this.pointerType="pointerType"in event&&event.pointerType,this.pressure="pressure"in event&&event.pressure,this.rotationAngle="rotationAngle"in event&&event.rotationAngle,this.twist="twist"in event&&event.twist||0,this.tangentialPressure="tangentialPressure"in event&&event.tangentialPressure||0},InteractionData2.prototype.reset=function(){this.isPrimary=!1},InteractionData2}();var extendStatics2=function(d,b){return extendStatics2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics2(d,b)};function __extends2(d,b){extendStatics2(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var InteractionEvent=function(){function InteractionEvent2(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return InteractionEvent2.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},InteractionEvent2.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},InteractionEvent2}(),InteractionTrackingData=function(){function InteractionTrackingData2(pointerId){this._pointerId=pointerId,this._flags=InteractionTrackingData2.FLAGS.NONE}return InteractionTrackingData2.prototype._doSet=function(flag,yn){yn?this._flags=this._flags|flag:this._flags=this._flags&~flag},Object.defineProperty(InteractionTrackingData2.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData2.prototype,"flags",{get:function(){return this._flags},set:function(flags){this._flags=flags},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData2.prototype,"none",{get:function(){return this._flags===InteractionTrackingData2.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData2.prototype,"over",{get:function(){return(this._flags&InteractionTrackingData2.FLAGS.OVER)!=0},set:function(yn){this._doSet(InteractionTrackingData2.FLAGS.OVER,yn)},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData2.prototype,"rightDown",{get:function(){return(this._flags&InteractionTrackingData2.FLAGS.RIGHT_DOWN)!=0},set:function(yn){this._doSet(InteractionTrackingData2.FLAGS.RIGHT_DOWN,yn)},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData2.prototype,"leftDown",{get:function(){return(this._flags&InteractionTrackingData2.FLAGS.LEFT_DOWN)!=0},set:function(yn){this._doSet(InteractionTrackingData2.FLAGS.LEFT_DOWN,yn)},enumerable:!1,configurable:!0}),InteractionTrackingData2.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2}),InteractionTrackingData2}(),TreeSearch=function(){function TreeSearch2(){this._tempPoint=new Point}return TreeSearch2.prototype.recursiveFindHit=function(interactionEvent,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible)return!1;var point=interactionEvent.data.global;interactive=displayObject.interactive||interactive;var hit=!1,interactiveParent=interactive,hitTestChildren=!0;if(displayObject.hitArea?(hitTest&&(displayObject.worldTransform.applyInverse(point,this._tempPoint),displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?hit=!0:(hitTest=!1,hitTestChildren=!1)),interactiveParent=!1):displayObject._mask&&hitTest&&(displayObject._mask.containsPoint&&displayObject._mask.containsPoint(point)||(hitTest=!1)),hitTestChildren&&displayObject.interactiveChildren&&displayObject.children)for(var children=displayObject.children,i=children.length-1;i>=0;i--){var child=children[i],childHit=this.recursiveFindHit(interactionEvent,child,func,hitTest,interactiveParent);if(childHit){if(!child.parent)continue;interactiveParent=!1,childHit&&(interactionEvent.target&&(hitTest=!1),hit=!0)}}return interactive&&(hitTest&&!interactionEvent.target&&!displayObject.hitArea&&displayObject.containsPoint&&displayObject.containsPoint(point)&&(hit=!0),displayObject.interactive&&(hit&&!interactionEvent.target&&(interactionEvent.target=displayObject),func&&func(interactionEvent,displayObject,!!hit))),hit},TreeSearch2.prototype.findHit=function(interactionEvent,displayObject,func,hitTest){this.recursiveFindHit(interactionEvent,displayObject,func,hitTest,!1)},TreeSearch2}(),interactiveTarget={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(value){value?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};DisplayObject.mixin(interactiveTarget);var MOUSE_POINTER_ID=1,hitTestEvent={target:null,data:{global:null}},InteractionManager=function(_super){__extends2(InteractionManager2,_super);function InteractionManager2(renderer,options){var _this=_super.call(this)||this;return options=options||{},_this.renderer=renderer,_this.autoPreventDefault=options.autoPreventDefault!==void 0?options.autoPreventDefault:!0,_this.interactionFrequency=options.interactionFrequency||10,_this.mouse=new InteractionData,_this.mouse.identifier=MOUSE_POINTER_ID,_this.mouse.global.set(-999999),_this.activeInteractionData={},_this.activeInteractionData[MOUSE_POINTER_ID]=_this.mouse,_this.interactionDataPool=[],_this.eventData=new InteractionEvent,_this.interactionDOMElement=null,_this.moveWhenInside=!1,_this.eventsAdded=!1,_this.tickerAdded=!1,_this.mouseOverRenderer=!("PointerEvent"in self),_this.supportsTouchEvents="ontouchstart"in self,_this.supportsPointerEvents=!!self.PointerEvent,_this.onPointerUp=_this.onPointerUp.bind(_this),_this.processPointerUp=_this.processPointerUp.bind(_this),_this.onPointerCancel=_this.onPointerCancel.bind(_this),_this.processPointerCancel=_this.processPointerCancel.bind(_this),_this.onPointerDown=_this.onPointerDown.bind(_this),_this.processPointerDown=_this.processPointerDown.bind(_this),_this.onPointerMove=_this.onPointerMove.bind(_this),_this.processPointerMove=_this.processPointerMove.bind(_this),_this.onPointerOut=_this.onPointerOut.bind(_this),_this.processPointerOverOut=_this.processPointerOverOut.bind(_this),_this.onPointerOver=_this.onPointerOver.bind(_this),_this.cursorStyles={default:"inherit",pointer:"pointer"},_this.currentCursorMode=null,_this.cursor=null,_this.resolution=1,_this.delayedEvents=[],_this.search=new TreeSearch,_this._tempDisplayObject=new TemporaryDisplayObject,_this._useSystemTicker=options.useSystemTicker!==void 0?options.useSystemTicker:!0,_this.setTargetElement(_this.renderer.view,_this.renderer.resolution),_this}return Object.defineProperty(InteractionManager2.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(useSystemTicker){this._useSystemTicker=useSystemTicker,useSystemTicker?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionManager2.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),InteractionManager2.prototype.hitTest=function(globalPoint,root){return hitTestEvent.target=null,hitTestEvent.data.global=globalPoint,root||(root=this.lastObjectRendered),this.processInteractive(hitTestEvent,root,null,!0),hitTestEvent.target},InteractionManager2.prototype.setTargetElement=function(element,resolution){resolution===void 0&&(resolution=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=element,this.resolution=resolution,this.addEvents(),this.addTickerListener()},InteractionManager2.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},InteractionManager2.prototype.removeTickerListener=function(){!this.tickerAdded||(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},InteractionManager2.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var style=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(style.msContentZooming="none",style.msTouchAction="none"):this.supportsPointerEvents&&(style.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),self.addEventListener("pointercancel",this.onPointerCancel,!0),self.addEventListener("pointerup",this.onPointerUp,!0)):(self.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),self.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},InteractionManager2.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var style=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(style.msContentZooming="",style.msTouchAction=""):this.supportsPointerEvents&&(style.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),self.removeEventListener("pointercancel",this.onPointerCancel,!0),self.removeEventListener("pointerup",this.onPointerUp,!0)):(self.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),self.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},InteractionManager2.prototype.tickerUpdate=function(deltaTime){this._deltaTime+=deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},InteractionManager2.prototype.update=function(){if(!!this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var k in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(k)){var interactionData=this.activeInteractionData[k];if(interactionData.originalEvent&&interactionData.pointerType!=="touch"){var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,interactionData.originalEvent,interactionData);this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},InteractionManager2.prototype.setCursorMode=function(mode){mode=mode||"default";var applyStyles=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(applyStyles=!1),this.currentCursorMode!==mode){this.currentCursorMode=mode;var style=this.cursorStyles[mode];if(style)switch(typeof style){case"string":applyStyles&&(this.interactionDOMElement.style.cursor=style);break;case"function":style(mode);break;case"object":applyStyles&&Object.assign(this.interactionDOMElement.style,style);break}else applyStyles&&typeof mode=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)&&(this.interactionDOMElement.style.cursor=mode)}},InteractionManager2.prototype.dispatchEvent=function(displayObject,eventString,eventData){(!eventData.stopPropagationHint||displayObject===eventData.stopsPropagatingAt)&&(eventData.currentTarget=displayObject,eventData.type=eventString,displayObject.emit(eventString,eventData),displayObject[eventString]&&displayObject[eventString](eventData))},InteractionManager2.prototype.delayDispatchEvent=function(displayObject,eventString,eventData){this.delayedEvents.push({displayObject,eventString,eventData})},InteractionManager2.prototype.mapPositionToPoint=function(point,x,y){var rect;this.interactionDOMElement.parentElement?rect=this.interactionDOMElement.getBoundingClientRect():rect={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var resolutionMultiplier=1/this.resolution;point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)*resolutionMultiplier,point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)*resolutionMultiplier},InteractionManager2.prototype.processInteractive=function(interactionEvent,displayObject,func,hitTest){var hit=this.search.findHit(interactionEvent,displayObject,func,hitTest),delayedEvents=this.delayedEvents;if(!delayedEvents.length)return hit;interactionEvent.stopPropagationHint=!1;var delayedLen=delayedEvents.length;this.delayedEvents=[];for(var i=0;i<delayedLen;i++){var _a3=delayedEvents[i],displayObject_1=_a3.displayObject,eventString=_a3.eventString,eventData=_a3.eventData;eventData.stopsPropagatingAt===displayObject_1&&(eventData.stopPropagationHint=!0),this.dispatchEvent(displayObject_1,eventString,eventData)}return hit},InteractionManager2.prototype.onPointerDown=function(originalEvent){if(!(this.supportsTouchEvents&&originalEvent.pointerType==="touch")){var events=this.normalizeToPointerData(originalEvent);if(this.autoPreventDefault&&events[0].isNormalized){var cancelable=originalEvent.cancelable||!("cancelable"in originalEvent);cancelable&&originalEvent.preventDefault()}for(var eventLen=events.length,i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);if(interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",interactionEvent),event.pointerType==="touch")this.emit("touchstart",interactionEvent);else if(event.pointerType==="mouse"||event.pointerType==="pen"){var isRightButton=event.button===2;this.emit(isRightButton?"rightdown":"mousedown",this.eventData)}}}},InteractionManager2.prototype.processPointerDown=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier;if(hit){if(displayObject.trackedPointers[id]||(displayObject.trackedPointers[id]=new InteractionTrackingData(id)),this.dispatchEvent(displayObject,"pointerdown",interactionEvent),data.pointerType==="touch")this.dispatchEvent(displayObject,"touchstart",interactionEvent);else if(data.pointerType==="mouse"||data.pointerType==="pen"){var isRightButton=data.button===2;isRightButton?displayObject.trackedPointers[id].rightDown=!0:displayObject.trackedPointers[id].leftDown=!0,this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",interactionEvent)}}},InteractionManager2.prototype.onPointerComplete=function(originalEvent,cancelled,func){for(var events=this.normalizeToPointerData(originalEvent),eventLen=events.length,eventAppend=originalEvent.target!==this.interactionDOMElement?"outside":"",i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);if(interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.lastObjectRendered,func,cancelled||!eventAppend),this.emit(cancelled?"pointercancel":"pointerup"+eventAppend,interactionEvent),event.pointerType==="mouse"||event.pointerType==="pen"){var isRightButton=event.button===2;this.emit(isRightButton?"rightup"+eventAppend:"mouseup"+eventAppend,interactionEvent)}else event.pointerType==="touch"&&(this.emit(cancelled?"touchcancel":"touchend"+eventAppend,interactionEvent),this.releaseInteractionDataForPointerId(event.pointerId))}},InteractionManager2.prototype.onPointerCancel=function(event){this.supportsTouchEvents&&event.pointerType==="touch"||this.onPointerComplete(event,!0,this.processPointerCancel)},InteractionManager2.prototype.processPointerCancel=function(interactionEvent,displayObject){var data=interactionEvent.data,id=interactionEvent.data.identifier;displayObject.trackedPointers[id]!==void 0&&(delete displayObject.trackedPointers[id],this.dispatchEvent(displayObject,"pointercancel",interactionEvent),data.pointerType==="touch"&&this.dispatchEvent(displayObject,"touchcancel",interactionEvent))},InteractionManager2.prototype.onPointerUp=function(event){this.supportsTouchEvents&&event.pointerType==="touch"||this.onPointerComplete(event,!1,this.processPointerUp)},InteractionManager2.prototype.processPointerUp=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier,trackingData=displayObject.trackedPointers[id],isTouch=data.pointerType==="touch",isMouse=data.pointerType==="mouse"||data.pointerType==="pen",isMouseTap=!1;if(isMouse){var isRightButton=data.button===2,flags=InteractionTrackingData.FLAGS,test=isRightButton?flags.RIGHT_DOWN:flags.LEFT_DOWN,isDown=trackingData!==void 0&&trackingData.flags&test;hit?(this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",interactionEvent),isDown&&(this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",interactionEvent),isMouseTap=!0)):isDown&&this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",interactionEvent),trackingData&&(isRightButton?trackingData.rightDown=!1:trackingData.leftDown=!1)}hit?(this.dispatchEvent(displayObject,"pointerup",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchend",interactionEvent),trackingData&&((!isMouse||isMouseTap)&&this.dispatchEvent(displayObject,"pointertap",interactionEvent),isTouch&&(this.dispatchEvent(displayObject,"tap",interactionEvent),trackingData.over=!1))):trackingData&&(this.dispatchEvent(displayObject,"pointerupoutside",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchendoutside",interactionEvent)),trackingData&&trackingData.none&&delete displayObject.trackedPointers[id]},InteractionManager2.prototype.onPointerMove=function(originalEvent){if(!(this.supportsTouchEvents&&originalEvent.pointerType==="touch")){var events=this.normalizeToPointerData(originalEvent);(events[0].pointerType==="mouse"||events[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var eventLen=events.length,i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",interactionEvent),event.pointerType==="touch"&&this.emit("touchmove",interactionEvent),(event.pointerType==="mouse"||event.pointerType==="pen")&&this.emit("mousemove",interactionEvent)}events[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},InteractionManager2.prototype.processPointerMove=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,isTouch=data.pointerType==="touch",isMouse=data.pointerType==="mouse"||data.pointerType==="pen";isMouse&&this.processPointerOverOut(interactionEvent,displayObject,hit),(!this.moveWhenInside||hit)&&(this.dispatchEvent(displayObject,"pointermove",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchmove",interactionEvent),isMouse&&this.dispatchEvent(displayObject,"mousemove",interactionEvent))},InteractionManager2.prototype.onPointerOut=function(originalEvent){if(!(this.supportsTouchEvents&&originalEvent.pointerType==="touch")){var events=this.normalizeToPointerData(originalEvent),event=events[0];event.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event,this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",interactionEvent),event.pointerType==="mouse"||event.pointerType==="pen"?this.emit("mouseout",interactionEvent):this.releaseInteractionDataForPointerId(interactionData.identifier)}},InteractionManager2.prototype.processPointerOverOut=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier,isMouse=data.pointerType==="mouse"||data.pointerType==="pen",trackingData=displayObject.trackedPointers[id];hit&&!trackingData&&(trackingData=displayObject.trackedPointers[id]=new InteractionTrackingData(id)),trackingData!==void 0&&(hit&&this.mouseOverRenderer?(trackingData.over||(trackingData.over=!0,this.delayDispatchEvent(displayObject,"pointerover",interactionEvent),isMouse&&this.delayDispatchEvent(displayObject,"mouseover",interactionEvent)),isMouse&&this.cursor===null&&(this.cursor=displayObject.cursor)):trackingData.over&&(trackingData.over=!1,this.dispatchEvent(displayObject,"pointerout",this.eventData),isMouse&&this.dispatchEvent(displayObject,"mouseout",interactionEvent),trackingData.none&&delete displayObject.trackedPointers[id]))},InteractionManager2.prototype.onPointerOver=function(originalEvent){var events=this.normalizeToPointerData(originalEvent),event=events[0],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event,event.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",interactionEvent),(event.pointerType==="mouse"||event.pointerType==="pen")&&this.emit("mouseover",interactionEvent)},InteractionManager2.prototype.getInteractionDataForPointerId=function(event){var pointerId=event.pointerId,interactionData;return pointerId===MOUSE_POINTER_ID||event.pointerType==="mouse"?interactionData=this.mouse:this.activeInteractionData[pointerId]?interactionData=this.activeInteractionData[pointerId]:(interactionData=this.interactionDataPool.pop()||new InteractionData,interactionData.identifier=pointerId,this.activeInteractionData[pointerId]=interactionData),interactionData.copyEvent(event),interactionData},InteractionManager2.prototype.releaseInteractionDataForPointerId=function(pointerId){var interactionData=this.activeInteractionData[pointerId];interactionData&&(delete this.activeInteractionData[pointerId],interactionData.reset(),this.interactionDataPool.push(interactionData))},InteractionManager2.prototype.configureInteractionEventForDOMEvent=function(interactionEvent,pointerEvent,interactionData){return interactionEvent.data=interactionData,this.mapPositionToPoint(interactionData.global,pointerEvent.clientX,pointerEvent.clientY),pointerEvent.pointerType==="touch"&&(pointerEvent.globalX=interactionData.global.x,pointerEvent.globalY=interactionData.global.y),interactionData.originalEvent=pointerEvent,interactionEvent.reset(),interactionEvent},InteractionManager2.prototype.normalizeToPointerData=function(event){var normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent)for(var i=0,li=event.changedTouches.length;i<li;i++){var touch=event.changedTouches[i];typeof touch.button=="undefined"&&(touch.button=event.touches.length?1:0),typeof touch.buttons=="undefined"&&(touch.buttons=event.touches.length?1:0),typeof touch.isPrimary=="undefined"&&(touch.isPrimary=event.touches.length===1&&event.type==="touchstart"),typeof touch.width=="undefined"&&(touch.width=touch.radiusX||1),typeof touch.height=="undefined"&&(touch.height=touch.radiusY||1),typeof touch.tiltX=="undefined"&&(touch.tiltX=0),typeof touch.tiltY=="undefined"&&(touch.tiltY=0),typeof touch.pointerType=="undefined"&&(touch.pointerType="touch"),typeof touch.pointerId=="undefined"&&(touch.pointerId=touch.identifier||0),typeof touch.pressure=="undefined"&&(touch.pressure=touch.force||.5),typeof touch.twist=="undefined"&&(touch.twist=0),typeof touch.tangentialPressure=="undefined"&&(touch.tangentialPressure=0),typeof touch.layerX=="undefined"&&(touch.layerX=touch.offsetX=touch.clientX),typeof touch.layerY=="undefined"&&(touch.layerY=touch.offsetY=touch.clientY),touch.isNormalized=!0,normalizedEvents.push(touch)}else if(!self.MouseEvent||event instanceof MouseEvent&&(!this.supportsPointerEvents||!(event instanceof self.PointerEvent))){var tempEvent=event;typeof tempEvent.isPrimary=="undefined"&&(tempEvent.isPrimary=!0),typeof tempEvent.width=="undefined"&&(tempEvent.width=1),typeof tempEvent.height=="undefined"&&(tempEvent.height=1),typeof tempEvent.tiltX=="undefined"&&(tempEvent.tiltX=0),typeof tempEvent.tiltY=="undefined"&&(tempEvent.tiltY=0),typeof tempEvent.pointerType=="undefined"&&(tempEvent.pointerType="mouse"),typeof tempEvent.pointerId=="undefined"&&(tempEvent.pointerId=MOUSE_POINTER_ID),typeof tempEvent.pressure=="undefined"&&(tempEvent.pressure=.5),typeof tempEvent.twist=="undefined"&&(tempEvent.twist=0),typeof tempEvent.tangentialPressure=="undefined"&&(tempEvent.tangentialPressure=0),tempEvent.isNormalized=!0,normalizedEvents.push(tempEvent)}else normalizedEvents.push(event);return normalizedEvents},InteractionManager2.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},InteractionManager2}(import_eventemitter3.default);var Runner=function(){function Runner3(name){this.items=[],this._name=name,this._aliasCount=0}return Runner3.prototype.emit=function(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8)throw new Error("max arguments reached");var _a3=this,name=_a3.name,items=_a3.items;this._aliasCount++;for(var i=0,len2=items.length;i<len2;i++)items[i][name](a0,a1,a2,a3,a4,a5,a6,a7);return items===this.items&&this._aliasCount--,this},Runner3.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},Runner3.prototype.add=function(item){return item[this._name]&&(this.ensureNonAliasedItems(),this.remove(item),this.items.push(item)),this},Runner3.prototype.remove=function(item){var index3=this.items.indexOf(item);return index3!==-1&&(this.ensureNonAliasedItems(),this.items.splice(index3,1)),this},Runner3.prototype.contains=function(item){return this.items.indexOf(item)!==-1},Runner3.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Runner3.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Runner3.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(Runner3.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Runner3}();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});settings.PREFER_ENV=isMobile2.any?ENV2.WEBGL:ENV2.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[];function autoDetectResource(source,options){if(!source)return null;var extension="";if(typeof source=="string"){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);result&&(extension=result[1].toLowerCase())}for(var i=INSTALLED.length-1;i>=0;--i){var ResourcePlugin=INSTALLED[i];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension))return new ResourcePlugin(source,options)}throw new Error("Unrecognized source type to auto-detect Resource")}var extendStatics3=function(d,b){return extendStatics3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics3(d,b)};function __extends3(d,b){extendStatics3(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var Resource=function(){function Resource4(width,height){width===void 0&&(width=0),height===void 0&&(height=0),this._width=width,this._height=height,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}return Resource4.prototype.bind=function(baseTexture){this.onResize.add(baseTexture),this.onUpdate.add(baseTexture),this.onError.add(baseTexture),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},Resource4.prototype.unbind=function(baseTexture){this.onResize.remove(baseTexture),this.onUpdate.remove(baseTexture),this.onError.remove(baseTexture)},Resource4.prototype.resize=function(width,height){(width!==this._width||height!==this._height)&&(this._width=width,this._height=height,this.onResize.emit(width,height))},Object.defineProperty(Resource4.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),Resource4.prototype.update=function(){this.destroyed||this.onUpdate.emit()},Resource4.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(Resource4.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(Resource4.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Resource4.prototype.style=function(_renderer,_baseTexture,_glTexture){return!1},Resource4.prototype.dispose=function(){},Resource4.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Resource4.test=function(_source,_extension){return!1},Resource4}(),BufferResource=function(_super){__extends3(BufferResource3,_super);function BufferResource3(source,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height;if(!width||!height)throw new Error("BufferResource width or height invalid");return _this=_super.call(this,width,height)||this,_this.data=source,_this}return BufferResource3.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES2.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,baseTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0},BufferResource3.prototype.dispose=function(){this.data=null},BufferResource3.test=function(source){return source instanceof Float32Array||source instanceof Uint8Array||source instanceof Uint32Array},BufferResource3}(Resource),defaultBufferOptions={scaleMode:SCALE_MODES2.NEAREST,format:FORMATS2.RGBA,alphaMode:ALPHA_MODES2.NPM},BaseTexture=function(_super){__extends3(BaseTexture3,_super);function BaseTexture3(resource,options){resource===void 0&&(resource=null),options===void 0&&(options=null);var _this=_super.call(this)||this;options=options||{};var alphaMode=options.alphaMode,mipmap=options.mipmap,anisotropicLevel=options.anisotropicLevel,scaleMode=options.scaleMode,width=options.width,height=options.height,wrapMode=options.wrapMode,format3=options.format,type=options.type,target=options.target,resolution=options.resolution,resourceOptions=options.resourceOptions;return resource&&!(resource instanceof Resource)&&(resource=autoDetectResource(resource,resourceOptions),resource.internal=!0),_this.width=width||0,_this.height=height||0,_this.resolution=resolution||settings.RESOLUTION,_this.mipmap=mipmap!==void 0?mipmap:settings.MIPMAP_TEXTURES,_this.anisotropicLevel=anisotropicLevel!==void 0?anisotropicLevel:settings.ANISOTROPIC_LEVEL,_this.wrapMode=wrapMode||settings.WRAP_MODE,_this.scaleMode=scaleMode!==void 0?scaleMode:settings.SCALE_MODE,_this.format=format3||FORMATS2.RGBA,_this.type=type||TYPES2.UNSIGNED_BYTE,_this.target=target||TARGETS2.TEXTURE_2D,_this.alphaMode=alphaMode!==void 0?alphaMode:ALPHA_MODES2.UNPACK,_this.uid=uid(),_this.touched=0,_this.isPowerOfTwo=!1,_this._refreshPOT(),_this._glTextures={},_this.dirtyId=0,_this.dirtyStyleId=0,_this.cacheId=null,_this.valid=width>0&&height>0,_this.textureCacheIds=[],_this.destroyed=!1,_this.resource=null,_this._batchEnabled=0,_this._batchLocation=0,_this.parentTextureArray=null,_this.setResource(resource),_this}return Object.defineProperty(BaseTexture3.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture3.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),BaseTexture3.prototype.setStyle=function(scaleMode,mipmap){var dirty;return scaleMode!==void 0&&scaleMode!==this.scaleMode&&(this.scaleMode=scaleMode,dirty=!0),mipmap!==void 0&&mipmap!==this.mipmap&&(this.mipmap=mipmap,dirty=!0),dirty&&this.dirtyStyleId++,this},BaseTexture3.prototype.setSize=function(width,height,resolution){return this.resolution=resolution||this.resolution,this.width=width,this.height=height,this._refreshPOT(),this.update(),this},BaseTexture3.prototype.setRealSize=function(realWidth,realHeight,resolution){return this.resolution=resolution||this.resolution,this.width=realWidth/this.resolution,this.height=realHeight/this.resolution,this._refreshPOT(),this.update(),this},BaseTexture3.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},BaseTexture3.prototype.setResolution=function(resolution){var oldResolution=this.resolution;return oldResolution===resolution?this:(this.resolution=resolution,this.valid&&(this.width=this.width*oldResolution/resolution,this.height=this.height*oldResolution/resolution,this.emit("update",this)),this._refreshPOT(),this)},BaseTexture3.prototype.setResource=function(resource){if(this.resource===resource)return this;if(this.resource)throw new Error("Resource can be set only once");return resource.bind(this),this.resource=resource,this},BaseTexture3.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},BaseTexture3.prototype.onError=function(event){this.emit("error",this,event)},BaseTexture3.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),BaseTexture3.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},BaseTexture3.prototype.dispose=function(){this.emit("dispose",this)},BaseTexture3.prototype.castToBaseTexture=function(){return this},BaseTexture3.from=function(source,options,strict){strict===void 0&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame=typeof source=="string",cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+uid()}cacheId=source._pixiId}var baseTexture=BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture)throw new Error('The cacheId "'+cacheId+'" does not exist in BaseTextureCache.');return baseTexture||(baseTexture=new BaseTexture3(source,options),baseTexture.cacheId=cacheId,BaseTexture3.addToCache(baseTexture,cacheId)),baseTexture},BaseTexture3.fromBuffer=function(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new BufferResource(buffer,{width,height}),type=buffer instanceof Float32Array?TYPES2.FLOAT:TYPES2.UNSIGNED_BYTE;return new BaseTexture3(resource,Object.assign(defaultBufferOptions,options||{width,height,type}))},BaseTexture3.addToCache=function(baseTexture,id){id&&(baseTexture.textureCacheIds.indexOf(id)===-1&&baseTexture.textureCacheIds.push(id),BaseTextureCache[id]&&console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry"),BaseTextureCache[id]=baseTexture)},BaseTexture3.removeFromCache=function(baseTexture){if(typeof baseTexture=="string"){var baseTextureFromCache=BaseTextureCache[baseTexture];if(baseTextureFromCache){var index3=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);return index3>-1&&baseTextureFromCache.textureCacheIds.splice(index3,1),delete BaseTextureCache[baseTexture],baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i)delete BaseTextureCache[baseTexture.textureCacheIds[i]];return baseTexture.textureCacheIds.length=0,baseTexture}return null},BaseTexture3._globalBatch=0,BaseTexture3}(import_eventemitter3.default),AbstractMultiResource=function(_super){__extends3(AbstractMultiResource3,_super);function AbstractMultiResource3(length,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height;_this=_super.call(this,width,height)||this,_this.items=[],_this.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new BaseTexture;_this.items.push(partTexture),_this.itemDirtyIds.push(-2)}return _this.length=length,_this._load=null,_this.baseTexture=null,_this}return AbstractMultiResource3.prototype.initFromArray=function(resources3,options){for(var i=0;i<this.length;i++)!resources3[i]||(resources3[i].castToBaseTexture?this.addBaseTextureAt(resources3[i].castToBaseTexture(),i):resources3[i]instanceof Resource?this.addResourceAt(resources3[i],i):this.addResourceAt(autoDetectResource(resources3[i],options),i))},AbstractMultiResource3.prototype.dispose=function(){for(var i=0,len2=this.length;i<len2;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},AbstractMultiResource3.prototype.addResourceAt=function(resource,index3){if(!this.items[index3])throw new Error("Index "+index3+" is out of bounds");return resource.valid&&!this.valid&&this.resize(resource.width,resource.height),this.items[index3].setResource(resource),this},AbstractMultiResource3.prototype.bind=function(baseTexture){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");_super.prototype.bind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=baseTexture,this.items[i].on("update",baseTexture.update,baseTexture)},AbstractMultiResource3.prototype.unbind=function(baseTexture){_super.prototype.unbind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",baseTexture.update,baseTexture)},AbstractMultiResource3.prototype.load=function(){var _this=this;if(this._load)return this._load;var resources3=this.items.map(function(item){return item.resource}).filter(function(item){return item}),promises=resources3.map(function(item){return item.load()});return this._load=Promise.all(promises).then(function(){var _a3=_this.items[0],realWidth=_a3.realWidth,realHeight=_a3.realHeight;return _this.resize(realWidth,realHeight),Promise.resolve(_this)}),this._load},AbstractMultiResource3}(Resource),ArrayResource=function(_super){__extends3(ArrayResource3,_super);function ArrayResource3(source,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height,urls,length;return Array.isArray(source)?(urls=source,length=source.length):length=source,_this=_super.call(this,length,{width,height})||this,urls&&_this.initFromArray(urls,options),_this}return ArrayResource3.prototype.addBaseTextureAt=function(baseTexture,index3){if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index3);else throw new Error("ArrayResource does not support RenderTexture");return this},ArrayResource3.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=TARGETS2.TEXTURE_2D_ARRAY},ArrayResource3.prototype.upload=function(renderer,texture,glTexture){var _a3=this,length=_a3.length,itemDirtyIds=_a3.itemDirtyIds,items=_a3.items,gl=renderer.gl;glTexture.dirtyId<0&&gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,texture.format,this._width,this._height,length,0,texture.format,texture.type,null);for(var i=0;i<length;i++){var item=items[i];itemDirtyIds[i]<item.dirtyId&&(itemDirtyIds[i]=item.dirtyId,item.valid&&gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,texture.type,item.resource.source))}return!0},ArrayResource3}(AbstractMultiResource),BaseImageResource=function(_super){__extends3(BaseImageResource3,_super);function BaseImageResource3(source){var _this=this,sourceAny=source,width=sourceAny.naturalWidth||sourceAny.videoWidth||sourceAny.width,height=sourceAny.naturalHeight||sourceAny.videoHeight||sourceAny.height;return _this=_super.call(this,width,height)||this,_this.source=source,_this.noSubImage=!1,_this}return BaseImageResource3.crossOrigin=function(element,url3,crossorigin){crossorigin===void 0&&url3.indexOf("data:")!==0?element.crossOrigin=determineCrossOrigin(url3):crossorigin!==!1&&(element.crossOrigin=typeof crossorigin=="string"?crossorigin:"anonymous")},BaseImageResource3.prototype.upload=function(renderer,baseTexture,glTexture,source){var gl=renderer.gl,width=baseTexture.realWidth,height=baseTexture.realHeight;return source=source||this.source,gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES2.UNPACK),!this.noSubImage&&baseTexture.target===gl.TEXTURE_2D&&glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,baseTexture.type,source):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,baseTexture.format,baseTexture.format,baseTexture.type,source)),!0},BaseImageResource3.prototype.update=function(){if(!this.destroyed){var source=this.source,width=source.naturalWidth||source.videoWidth||source.width,height=source.naturalHeight||source.videoHeight||source.height;this.resize(width,height),_super.prototype.update.call(this)}},BaseImageResource3.prototype.dispose=function(){this.source=null},BaseImageResource3}(Resource),CanvasResource=function(_super){__extends3(CanvasResource3,_super);function CanvasResource3(source){return _super.call(this,source)||this}return CanvasResource3.test=function(source){var OffscreenCanvas2=self.OffscreenCanvas;return OffscreenCanvas2&&source instanceof OffscreenCanvas2?!0:self.HTMLCanvasElement&&source instanceof HTMLCanvasElement},CanvasResource3}(BaseImageResource),CubeResource=function(_super){__extends3(CubeResource3,_super);function CubeResource3(source,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height,autoLoad=_a3.autoLoad,linkBaseTexture=_a3.linkBaseTexture;if(source&&source.length!==CubeResource3.SIDES)throw new Error("Invalid length. Got "+source.length+", expected 6");_this=_super.call(this,6,{width,height})||this;for(var i=0;i<CubeResource3.SIDES;i++)_this.items[i].target=TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_X+i;return _this.linkBaseTexture=linkBaseTexture!==!1,source&&_this.initFromArray(source,options),autoLoad!==!1&&_this.load(),_this}return CubeResource3.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=TARGETS2.TEXTURE_CUBE_MAP},CubeResource3.prototype.addBaseTextureAt=function(baseTexture,index3,linkBaseTexture){if(linkBaseTexture===void 0&&(linkBaseTexture=this.linkBaseTexture),!this.items[index3])throw new Error("Index "+index3+" is out of bounds");if(!this.linkBaseTexture||baseTexture.parentTextureArray||Object.keys(baseTexture._glTextures).length>0)if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index3);else throw new Error("CubeResource does not support copying of renderTexture.");else baseTexture.target=TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_X+index3,baseTexture.parentTextureArray=this.baseTexture,this.items[index3]=baseTexture;return baseTexture.valid&&!this.valid&&this.resize(baseTexture.realWidth,baseTexture.realHeight),this.items[index3]=baseTexture,this},CubeResource3.prototype.upload=function(renderer,_baseTexture,glTexture){for(var dirty=this.itemDirtyIds,i=0;i<CubeResource3.SIDES;i++){var side=this.items[i];dirty[i]<side.dirtyId&&(side.valid&&side.resource?(side.resource.upload(renderer,side,glTexture),dirty[i]=side.dirtyId):dirty[i]<-1&&(renderer.gl.texImage2D(side.target,0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null),dirty[i]=-1))}return!0},CubeResource3.test=function(source){return Array.isArray(source)&&source.length===CubeResource3.SIDES},CubeResource3.SIDES=6,CubeResource3}(AbstractMultiResource),ImageResource=function(_super){__extends3(ImageResource3,_super);function ImageResource3(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLImageElement)){var imageElement=new Image;BaseImageResource.crossOrigin(imageElement,source,options.crossorigin),imageElement.src=source,source=imageElement}return _this=_super.call(this,source)||this,!source.complete&&!!_this._width&&!!_this._height&&(_this._width=0,_this._height=0),_this.url=source.src,_this._process=null,_this.preserveBitmap=!1,_this.createBitmap=(options.createBitmap!==void 0?options.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,_this.alphaMode=typeof options.alphaMode=="number"?options.alphaMode:null,_this.bitmap=null,_this._load=null,options.autoLoad!==!1&&_this.load(),_this}return ImageResource3.prototype.load=function(createBitmap){var _this=this;return this._load?this._load:(createBitmap!==void 0&&(this.createBitmap=createBitmap),this._load=new Promise(function(resolve4,reject2){var source=_this.source;_this.url=source.src;var completed=function(){_this.destroyed||(source.onload=null,source.onerror=null,_this.resize(source.width,source.height),_this._load=null,_this.createBitmap?resolve4(_this.process()):resolve4(_this))};source.complete&&source.src?completed():(source.onload=completed,source.onerror=function(event){reject2(event),_this.onError.emit(event)})}),this._load)},ImageResource3.prototype.process=function(){var _this=this,source=this.source;return this._process!==null?this._process:this.bitmap!==null||!self.createImageBitmap?Promise.resolve(this):(this._process=self.createImageBitmap(source,0,0,source.width,source.height,{premultiplyAlpha:this.alphaMode===ALPHA_MODES2.UNPACK?"premultiply":"none"}).then(function(bitmap){return _this.destroyed?Promise.reject():(_this.bitmap=bitmap,_this.update(),_this._process=null,Promise.resolve(_this))}),this._process)},ImageResource3.prototype.upload=function(renderer,baseTexture,glTexture){if(typeof this.alphaMode=="number"&&(baseTexture.alphaMode=this.alphaMode),!this.createBitmap)return _super.prototype.upload.call(this,renderer,baseTexture,glTexture);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(_super.prototype.upload.call(this,renderer,baseTexture,glTexture,this.bitmap),!this.preserveBitmap){var flag=!0,glTextures=baseTexture._glTextures;for(var key in glTextures){var otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=!1;break}}flag&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},ImageResource3.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,_super.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},ImageResource3.test=function(source){return typeof source=="string"||source instanceof HTMLImageElement},ImageResource3}(BaseImageResource),SVGResource=function(_super){__extends3(SVGResource3,_super);function SVGResource3(sourceBase64,options){var _this=this;return options=options||{},_this=_super.call(this,document.createElement("canvas"))||this,_this._width=0,_this._height=0,_this.svg=sourceBase64,_this.scale=options.scale||1,_this._overrideWidth=options.width,_this._overrideHeight=options.height,_this._resolve=null,_this._crossorigin=options.crossorigin,_this._load=null,options.autoLoad!==!1&&_this.load(),_this}return SVGResource3.prototype.load=function(){var _this=this;return this._load?this._load:(this._load=new Promise(function(resolve4){if(_this._resolve=function(){_this.resize(_this.source.width,_this.source.height),resolve4(_this)},/^\<svg/.test(_this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");_this.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(_this.svg)))}_this._loadSvg()}),this._load)},SVGResource3.prototype._loadSvg=function(){var _this=this,tempImage=new Image;BaseImageResource.crossOrigin(tempImage,this.svg,this._crossorigin),tempImage.src=this.svg,tempImage.onerror=function(event){!_this._resolve||(tempImage.onerror=null,_this.onError.emit(event))},tempImage.onload=function(){if(!!_this._resolve){var svgWidth=tempImage.width,svgHeight=tempImage.height;if(!svgWidth||!svgHeight)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var width=svgWidth*_this.scale,height=svgHeight*_this.scale;(_this._overrideWidth||_this._overrideHeight)&&(width=_this._overrideWidth||_this._overrideHeight/svgHeight*svgWidth,height=_this._overrideHeight||_this._overrideWidth/svgWidth*svgHeight),width=Math.round(width),height=Math.round(height);var canvas2=_this.source;canvas2.width=width,canvas2.height=height,canvas2._pixiId="canvas_"+uid(),canvas2.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height),_this._resolve(),_this._resolve=null}}},SVGResource3.getSize=function(svgString){var sizeMatch=SVGResource3.SVG_SIZE.exec(svgString),size={};return sizeMatch&&(size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3])),size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))),size},SVGResource3.prototype.dispose=function(){_super.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},SVGResource3.test=function(source,extension){return extension==="svg"||typeof source=="string"&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(source)||typeof source=="string"&&source.indexOf("<svg")===0},SVGResource3.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,SVGResource3}(BaseImageResource),VideoResource=function(_super){__extends3(VideoResource3,_super);function VideoResource3(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");videoElement.setAttribute("preload","auto"),videoElement.setAttribute("webkit-playsinline",""),videoElement.setAttribute("playsinline",""),typeof source=="string"&&(source=[source]);var firstSrc=source[0].src||source[0];BaseImageResource.crossOrigin(videoElement,firstSrc,options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source"),_a3=source[i],src=_a3.src,mime=_a3.mime;src=src||source[i];var baseSrc=src.split("?").shift().toLowerCase(),ext=baseSrc.substr(baseSrc.lastIndexOf(".")+1);mime=mime||VideoResource3.MIME_TYPES[ext]||"video/"+ext,sourceElement.src=src,sourceElement.type=mime,videoElement.appendChild(sourceElement)}source=videoElement}return _this=_super.call(this,source)||this,_this.noSubImage=!0,_this._autoUpdate=!0,_this._isConnectedToTicker=!1,_this._updateFPS=options.updateFPS||0,_this._msToNextUpdate=0,_this.autoPlay=options.autoPlay!==!1,_this._load=null,_this._resolve=null,_this._onCanPlay=_this._onCanPlay.bind(_this),_this._onError=_this._onError.bind(_this),options.autoLoad!==!1&&_this.load(),_this}return VideoResource3.prototype.update=function(_deltaTime){if(!this.destroyed){var elapsedMS=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS),(!this._updateFPS||this._msToNextUpdate<=0)&&(_super.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},VideoResource3.prototype.load=function(){var _this=this;if(this._load)return this._load;var source=this.source;return(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),source.addEventListener("play",this._onPlayStart.bind(this)),source.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("error",this._onError,!0)),this._load=new Promise(function(resolve4){_this.valid?resolve4(_this):(_this._resolve=resolve4,source.load())}),this._load},VideoResource3.prototype._onError=function(event){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(event)},VideoResource3.prototype._isSourcePlaying=function(){var source=this.source;return source.currentTime>0&&source.paused===!1&&source.ended===!1&&source.readyState>2},VideoResource3.prototype._isSourceReady=function(){var source=this.source;return source.readyState===3||source.readyState===4},VideoResource3.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},VideoResource3.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},VideoResource3.prototype._onCanPlay=function(){var source=this.source;source.removeEventListener("canplay",this._onCanPlay),source.removeEventListener("canplaythrough",this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight),!valid&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&source.play()},VideoResource3.prototype.dispose=function(){this._isConnectedToTicker&&Ticker.shared.remove(this.update,this);var source=this.source;source&&(source.removeEventListener("error",this._onError,!0),source.pause(),source.src="",source.load()),_super.prototype.dispose.call(this)},Object.defineProperty(VideoResource3.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(VideoResource3.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(value){value!==this._updateFPS&&(this._updateFPS=value)},enumerable:!1,configurable:!0}),VideoResource3.test=function(source,extension){return self.HTMLVideoElement&&source instanceof HTMLVideoElement||VideoResource3.TYPES.indexOf(extension)>-1},VideoResource3.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],VideoResource3.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},VideoResource3}(BaseImageResource),ImageBitmapResource=function(_super){__extends3(ImageBitmapResource3,_super);function ImageBitmapResource3(source){return _super.call(this,source)||this}return ImageBitmapResource3.test=function(source){return!!self.createImageBitmap&&source instanceof ImageBitmap},ImageBitmapResource3}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var _resources={__proto__:null,Resource,BaseImageResource,INSTALLED,autoDetectResource,AbstractMultiResource,ArrayResource,BufferResource,CanvasResource,CubeResource,ImageResource,SVGResource,VideoResource,ImageBitmapResource},System=function(){function System3(renderer){this.renderer=renderer}return System3.prototype.destroy=function(){this.renderer=null},System3}(),DepthResource=function(_super){__extends3(DepthResource3,_super);function DepthResource3(){return _super!==null&&_super.apply(this,arguments)||this}return DepthResource3.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES2.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,baseTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,renderer.context.webGLVersion===1?gl.DEPTH_COMPONENT:gl.DEPTH_COMPONENT16,width,height,0,baseTexture.format,baseTexture.type,this.data)),!0},DepthResource3}(BufferResource),Framebuffer=function(){function Framebuffer3(width,height){this.width=Math.ceil(width||100),this.height=Math.ceil(height||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY2.NONE}return Object.defineProperty(Framebuffer3.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),Framebuffer3.prototype.addColorTexture=function(index3,texture){return index3===void 0&&(index3=0),this.colorTextures[index3]=texture||new BaseTexture(null,{scaleMode:SCALE_MODES2.NEAREST,resolution:1,mipmap:MIPMAP_MODES2.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.addDepthTexture=function(texture){return this.depthTexture=texture||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES2.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES2.OFF,format:FORMATS2.DEPTH_COMPONENT,type:TYPES2.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.resize=function(width,height){if(width=Math.ceil(width),height=Math.ceil(height),!(width===this.width&&height===this.height)){this.width=width,this.height=height,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i],resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}if(this.depthTexture){var resolution=this.depthTexture.resolution;this.depthTexture.setSize(width/resolution,height/resolution)}}},Framebuffer3.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Framebuffer3.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},Framebuffer3}(),BaseRenderTexture=function(_super){__extends3(BaseRenderTexture3,_super);function BaseRenderTexture3(options){var _this=this;if(typeof options=="number"){var width_1=arguments[0],height_1=arguments[1],scaleMode=arguments[2],resolution=arguments[3];options={width:width_1,height:height_1,scaleMode,resolution}}_this=_super.call(this,null,options)||this;var _a3=options||{},width=_a3.width,height=_a3.height;return _this.mipmap=MIPMAP_MODES2.OFF,_this.width=Math.ceil(width)||100,_this.height=Math.ceil(height)||100,_this.valid=!0,_this.clearColor=[0,0,0,0],_this.framebuffer=new Framebuffer(_this.width*_this.resolution,_this.height*_this.resolution).addColorTexture(0,_this),_this.maskStack=[],_this.filterStack=[{}],_this}return BaseRenderTexture3.prototype.resize=function(width,height){width=Math.ceil(width),height=Math.ceil(height),this.framebuffer.resize(width*this.resolution,height*this.resolution)},BaseRenderTexture3.prototype.dispose=function(){this.framebuffer.dispose(),_super.prototype.dispose.call(this)},BaseRenderTexture3.prototype.destroy=function(){_super.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},BaseRenderTexture3}(BaseTexture),TextureUvs=function(){function TextureUvs3(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return TextureUvs3.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){var w2=frame.width/2/tw,h2=frame.height/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=groupD8.add(rotate,groupD8.NW),this.x0=cX+w2*groupD8.uX(rotate),this.y0=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x1=cX+w2*groupD8.uX(rotate),this.y1=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x2=cX+w2*groupD8.uX(rotate),this.y2=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x3=cX+w2*groupD8.uX(rotate),this.y3=cY+h2*groupD8.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},TextureUvs3.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},TextureUvs3}(),DEFAULT_UVS=new TextureUvs,Texture=function(_super){__extends3(Texture3,_super);function Texture3(baseTexture,frame,orig,trim,rotate,anchor){var _this=_super.call(this)||this;if(_this.noFrame=!1,frame||(_this.noFrame=!0,frame=new Rectangle(0,0,1,1)),baseTexture instanceof Texture3&&(baseTexture=baseTexture.baseTexture),_this.baseTexture=baseTexture,_this._frame=frame,_this.trim=trim,_this.valid=!1,_this._uvs=DEFAULT_UVS,_this.uvMatrix=null,_this.orig=orig||frame,_this._rotate=Number(rotate||0),rotate===!0)_this._rotate=2;else if(_this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return _this.defaultAnchor=anchor?new Point(anchor.x,anchor.y):new Point(0,0),_this._updateID=0,_this.textureCacheIds=[],baseTexture.valid?_this.noFrame?baseTexture.valid&&_this.onBaseTextureUpdated(baseTexture):_this.frame=frame:baseTexture.once("loaded",_this.onBaseTextureUpdated,_this),_this.noFrame&&baseTexture.on("update",_this.onBaseTextureUpdated,_this),_this}return Texture3.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},Texture3.prototype.onBaseTextureUpdated=function(baseTexture){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},Texture3.prototype.destroy=function(destroyBase){if(this.baseTexture){if(destroyBase){var resource=this.baseTexture.resource;resource&&resource.url&&TextureCache[resource.url]&&Texture3.removeFromCache(resource.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture3.removeFromCache(this),this.textureCacheIds=null},Texture3.prototype.clone=function(){var clonedFrame=this._frame.clone(),clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone(),clonedTexture=new Texture3(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(clonedTexture._frame=clonedFrame),clonedTexture},Texture3.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Texture3.from=function(source,options,strict){options===void 0&&(options={}),strict===void 0&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame=typeof source=="string",cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+uid()}cacheId=source._pixiId}var texture=TextureCache[cacheId];if(isFrame&&strict&&!texture)throw new Error('The cacheId "'+cacheId+'" does not exist in TextureCache.');return texture||(options.resolution||(options.resolution=getResolutionOfUrl(source)),texture=new Texture3(new BaseTexture(source,options)),texture.baseTexture.cacheId=cacheId,BaseTexture.addToCache(texture.baseTexture,cacheId),Texture3.addToCache(texture,cacheId)),texture},Texture3.fromURL=function(url3,options){var resourceOptions=Object.assign({autoLoad:!1},options==null?void 0:options.resourceOptions),texture=Texture3.from(url3,Object.assign({resourceOptions},options),!1),resource=texture.baseTexture.resource;return texture.baseTexture.valid?Promise.resolve(texture):resource.load().then(function(){return Promise.resolve(texture)})},Texture3.fromBuffer=function(buffer,width,height,options){return new Texture3(BaseTexture.fromBuffer(buffer,width,height,options))},Texture3.fromLoader=function(source,imageUrl,name,options){var baseTexture=new BaseTexture(source,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(imageUrl)},options)),resource=baseTexture.resource;resource instanceof ImageResource&&(resource.url=imageUrl);var texture=new Texture3(baseTexture);return name||(name=imageUrl),BaseTexture.addToCache(texture.baseTexture,name),Texture3.addToCache(texture,name),name!==imageUrl&&(BaseTexture.addToCache(texture.baseTexture,imageUrl),Texture3.addToCache(texture,imageUrl)),texture.baseTexture.valid?Promise.resolve(texture):new Promise(function(resolve4){texture.baseTexture.once("loaded",function(){return resolve4(texture)})})},Texture3.addToCache=function(texture,id){id&&(texture.textureCacheIds.indexOf(id)===-1&&texture.textureCacheIds.push(id),TextureCache[id]&&console.warn("Texture added to the cache with an id ["+id+"] that already had an entry"),TextureCache[id]=texture)},Texture3.removeFromCache=function(texture){if(typeof texture=="string"){var textureFromCache=TextureCache[texture];if(textureFromCache){var index3=textureFromCache.textureCacheIds.indexOf(texture);return index3>-1&&textureFromCache.textureCacheIds.splice(index3,1),delete TextureCache[texture],textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i)TextureCache[texture.textureCacheIds[i]]===texture&&delete TextureCache[texture.textureCacheIds[i]];return texture.textureCacheIds.length=0,texture}return null},Object.defineProperty(Texture3.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"frame",{get:function(){return this._frame},set:function(frame){this._frame=frame,this.noFrame=!1;var x=frame.x,y=frame.y,width=frame.width,height=frame.height,xNotFit=x+width>this.baseTexture.width,yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or",errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width,errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(errorX+" "+relationship+" "+errorY))}this.valid=width&&height&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=frame),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"rotate",{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),Texture3.prototype.castToBaseTexture=function(){return this.baseTexture},Texture3}(import_eventemitter3.default);function createWhiteTexture(){var canvas2=document.createElement("canvas");canvas2.width=16,canvas2.height=16;var context4=canvas2.getContext("2d");return context4.fillStyle="white",context4.fillRect(0,0,16,16),new Texture(new BaseTexture(new CanvasResource(canvas2)))}function removeAllHandlers(tex){tex.destroy=function(){},tex.on=function(){},tex.once=function(){},tex.emit=function(){}}Texture.EMPTY=new Texture(new BaseTexture);removeAllHandlers(Texture.EMPTY);removeAllHandlers(Texture.EMPTY.baseTexture);Texture.WHITE=createWhiteTexture();removeAllHandlers(Texture.WHITE);removeAllHandlers(Texture.WHITE.baseTexture);var RenderTexture=function(_super){__extends3(RenderTexture3,_super);function RenderTexture3(baseRenderTexture,frame){var _this=_super.call(this,baseRenderTexture,frame)||this;return _this.valid=!0,_this.filterFrame=null,_this.filterPoolKey=null,_this.updateUvs(),_this}return Object.defineProperty(RenderTexture3.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),RenderTexture3.prototype.resize=function(width,height,resizeBaseTexture){resizeBaseTexture===void 0&&(resizeBaseTexture=!0),width=Math.ceil(width),height=Math.ceil(height),this.valid=width>0&&height>0,this._frame.width=this.orig.width=width,this._frame.height=this.orig.height=height,resizeBaseTexture&&this.baseTexture.resize(width,height),this.updateUvs()},RenderTexture3.prototype.setResolution=function(resolution){var baseTexture=this.baseTexture;baseTexture.resolution!==resolution&&(baseTexture.setResolution(resolution),this.resize(baseTexture.width,baseTexture.height,!1))},RenderTexture3.create=function(options){for(var arguments$1=arguments,rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments$1[_i];return typeof options=="number"&&(deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),options={width:options,height:rest[0],scaleMode:rest[1],resolution:rest[2]}),new RenderTexture3(new BaseRenderTexture(options))},RenderTexture3}(Texture),RenderTexturePool=function(){function RenderTexturePool3(textureOptions){this.texturePool={},this.textureOptions=textureOptions||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return RenderTexturePool3.prototype.createTexture=function(realWidth,realHeight){var baseRenderTexture=new BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1},this.textureOptions));return new RenderTexture(baseRenderTexture)},RenderTexturePool3.prototype.getOptimalTexture=function(minWidth,minHeight,resolution){resolution===void 0&&(resolution=1);var key=RenderTexturePool3.SCREEN_KEY;minWidth*=resolution,minHeight*=resolution,(!this.enableFullScreen||minWidth!==this._pixelsWidth||minHeight!==this._pixelsHeight)&&(minWidth=nextPow2(minWidth),minHeight=nextPow2(minHeight),key=(minWidth&65535)<<16|minHeight&65535),this.texturePool[key]||(this.texturePool[key]=[]);var renderTexture=this.texturePool[key].pop();return renderTexture||(renderTexture=this.createTexture(minWidth,minHeight)),renderTexture.filterPoolKey=key,renderTexture.setResolution(resolution),renderTexture},RenderTexturePool3.prototype.getFilterTexture=function(input,resolution){var filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution);return filterTexture.filterFrame=input.filterFrame,filterTexture},RenderTexturePool3.prototype.returnTexture=function(renderTexture){var key=renderTexture.filterPoolKey;renderTexture.filterFrame=null,this.texturePool[key].push(renderTexture)},RenderTexturePool3.prototype.returnFilterTexture=function(renderTexture){this.returnTexture(renderTexture)},RenderTexturePool3.prototype.clear=function(destroyTextures){if(destroyTextures=destroyTextures!==!1,destroyTextures)for(var i in this.texturePool){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0)}this.texturePool={}},RenderTexturePool3.prototype.setScreenSize=function(size){if(!(size.width===this._pixelsWidth&&size.height===this._pixelsHeight)){var screenKey=RenderTexturePool3.SCREEN_KEY,textures=this.texturePool[screenKey];if(this.enableFullScreen=size.width>0&&size.height>0,textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0);this.texturePool[screenKey]=[],this._pixelsWidth=size.width,this._pixelsHeight=size.height}},RenderTexturePool3.SCREEN_KEY="screen",RenderTexturePool3}(),Attribute=function(){function Attribute3(buffer,size,normalized,type,stride,start2,instance){size===void 0&&(size=0),normalized===void 0&&(normalized=!1),type===void 0&&(type=TYPES2.FLOAT),this.buffer=buffer,this.size=size,this.normalized=normalized,this.type=type,this.stride=stride,this.start=start2,this.instance=instance}return Attribute3.prototype.destroy=function(){this.buffer=null},Attribute3.from=function(buffer,size,normalized,type,stride){return new Attribute3(buffer,size,normalized,type,stride)},Attribute3}(),UID=0,Buffer2=function(){function Buffer5(data,_static,index3){_static===void 0&&(_static=!0),index3===void 0&&(index3=!1),this.data=data||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=index3,this.static=_static,this.id=UID++,this.disposeRunner=new Runner("disposeBuffer")}return Buffer5.prototype.update=function(data){this.data=data||this.data,this._updateID++},Buffer5.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Buffer5.prototype.destroy=function(){this.dispose(),this.data=null},Buffer5.from=function(data){return data instanceof Array&&(data=new Float32Array(data)),new Buffer5(data)},Buffer5}();function getBufferType2(array){if(array.BYTES_PER_ELEMENT===4)return array instanceof Float32Array?"Float32Array":array instanceof Uint32Array?"Uint32Array":"Int32Array";if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array)return"Uint16Array"}else if(array.BYTES_PER_ELEMENT===1&&array instanceof Uint8Array)return"Uint8Array";return null}var map2={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays2(arrays,sizes){for(var outSize=0,stride=0,views={},i=0;i<arrays.length;i++)stride+=sizes[i],outSize+=arrays[i].length;for(var buffer=new ArrayBuffer(outSize*4),out=null,littleOffset=0,i=0;i<arrays.length;i++){var size=sizes[i],array=arrays[i],type=getBufferType2(array);views[type]||(views[type]=new map2[type](buffer)),out=views[type];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset,index3=j%size;out[indexStart+index3]=array[j]}littleOffset+=size}return new Float32Array(buffer)}var byteSizeMap={5126:4,5123:2,5121:1},UID$1=0,map$1={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Geometry=function(){function Geometry3(buffers,attributes){buffers===void 0&&(buffers=[]),attributes===void 0&&(attributes={}),this.buffers=buffers,this.indexBuffer=null,this.attributes=attributes,this.glVertexArrayObjects={},this.id=UID$1++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}return Geometry3.prototype.addAttribute=function(id,buffer,size,normalized,type,stride,start2,instance){if(size===void 0&&(size=0),normalized===void 0&&(normalized=!1),instance===void 0&&(instance=!1),!buffer)throw new Error("You must pass a buffer when creating an attribute");buffer instanceof Buffer2||(buffer instanceof Array&&(buffer=new Float32Array(buffer)),buffer=new Buffer2(buffer));var ids=id.split("|");if(ids.length>1){for(var i=0;i<ids.length;i++)this.addAttribute(ids[i],buffer,size,normalized,type);return this}var bufferIndex=this.buffers.indexOf(buffer);return bufferIndex===-1&&(this.buffers.push(buffer),bufferIndex=this.buffers.length-1),this.attributes[id]=new Attribute(bufferIndex,size,normalized,type,stride,start2,instance),this.instanced=this.instanced||instance,this},Geometry3.prototype.getAttribute=function(id){return this.attributes[id]},Geometry3.prototype.getBuffer=function(id){return this.buffers[this.getAttribute(id).buffer]},Geometry3.prototype.addIndex=function(buffer){return buffer instanceof Buffer2||(buffer instanceof Array&&(buffer=new Uint16Array(buffer)),buffer=new Buffer2(buffer)),buffer.index=!0,this.indexBuffer=buffer,this.buffers.indexOf(buffer)===-1&&this.buffers.push(buffer),this},Geometry3.prototype.getIndex=function(){return this.indexBuffer},Geometry3.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var arrays=[],sizes=[],interleavedBuffer=new Buffer2,i;for(i in this.attributes){var attribute=this.attributes[i],buffer=this.buffers[attribute.buffer];arrays.push(buffer.data),sizes.push(attribute.size*byteSizeMap[attribute.type]/4),attribute.buffer=0}for(interleavedBuffer.data=interleaveTypedArrays2(arrays,sizes),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[interleavedBuffer],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Geometry3.prototype.getSize=function(){for(var i in this.attributes){var attribute=this.attributes[i],buffer=this.buffers[attribute.buffer];return buffer.data.length/(attribute.stride/4||attribute.size)}return 0},Geometry3.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Geometry3.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Geometry3.prototype.clone=function(){for(var geometry=new Geometry3,i=0;i<this.buffers.length;i++)geometry.buffers[i]=new Buffer2(this.buffers[i].data.slice(0));for(var i in this.attributes){var attrib=this.attributes[i];geometry.attributes[i]=new Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}return this.indexBuffer&&(geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)],geometry.indexBuffer.index=!0),geometry},Geometry3.merge=function(geometries){for(var geometryOut=new Geometry3,arrays=[],sizes=[],offsets=[],geometry,i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)sizes[j]=sizes[j]||0,sizes[j]+=geometry.buffers[j].data.length,offsets[j]=0}for(var i=0;i<geometry.buffers.length;i++)arrays[i]=new map$1[getBufferType2(geometry.buffers[i].data)](sizes[i]),geometryOut.buffers[i]=new Buffer2(arrays[i]);for(var i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)arrays[j].set(geometry.buffers[j].data,offsets[j]),offsets[j]+=geometry.buffers[j].data.length}if(geometryOut.attributes=geometry.attributes,geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)],geometryOut.indexBuffer.index=!0;for(var offset=0,stride=0,offset2=0,bufferIndexToCount=0,i=0;i<geometry.buffers.length;i++)if(geometry.buffers[i]!==geometry.indexBuffer){bufferIndexToCount=i;break}for(var i in geometry.attributes){var attribute=geometry.attributes[i];(attribute.buffer|0)===bufferIndexToCount&&(stride+=attribute.size*byteSizeMap[attribute.type]/4)}for(var i=0;i<geometries.length;i++){for(var indexBufferData=geometries[i].indexBuffer.data,j=0;j<indexBufferData.length;j++)geometryOut.indexBuffer.data[j+offset2]+=offset;offset+=geometry.buffers[bufferIndexToCount].data.length/stride,offset2+=indexBufferData.length}}return geometryOut},Geometry3}(),Quad=function(_super){__extends3(Quad3,_super);function Quad3(){var _this=_super.call(this)||this;return _this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),_this}return Quad3}(Geometry),QuadUv=function(_super){__extends3(QuadUv3,_super);function QuadUv3(){var _this=_super.call(this)||this;return _this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),_this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),_this.vertexBuffer=new Buffer2(_this.vertices),_this.uvBuffer=new Buffer2(_this.uvs),_this.addAttribute("aVertexPosition",_this.vertexBuffer).addAttribute("aTextureCoord",_this.uvBuffer).addIndex([0,1,2,0,2,3]),_this}return QuadUv3.prototype.map=function(targetTextureFrame,destinationFrame){var x=0,y=0;return this.uvs[0]=x,this.uvs[1]=y,this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[3]=y,this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height,this.uvs[6]=x,this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height,x=destinationFrame.x,y=destinationFrame.y,this.vertices[0]=x,this.vertices[1]=y,this.vertices[2]=x+destinationFrame.width,this.vertices[3]=y,this.vertices[4]=x+destinationFrame.width,this.vertices[5]=y+destinationFrame.height,this.vertices[6]=x,this.vertices[7]=y+destinationFrame.height,this.invalidate(),this},QuadUv3.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},QuadUv3}(Geometry),UID$2=0,UniformGroup=function(){function UniformGroup3(uniforms,_static){this.uniforms=uniforms,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!_static}return UniformGroup3.prototype.update=function(){this.dirtyId++},UniformGroup3.prototype.add=function(name,uniforms,_static){this.uniforms[name]=new UniformGroup3(uniforms,_static)},UniformGroup3.from=function(uniforms,_static){return new UniformGroup3(uniforms,_static)},UniformGroup3}(),FilterState=function(){function FilterState3(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}return FilterState3.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},FilterState3}(),tempPoints=[new Point,new Point,new Point,new Point],tempMatrix=new Matrix,FilterSystem=function(_super){__extends3(FilterSystem3,_super);function FilterSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.defaultFilterStack=[{}],_this.texturePool=new RenderTexturePool,_this.texturePool.setScreenSize(renderer.view),_this.statePool=[],_this.quad=new Quad,_this.quadUv=new QuadUv,_this.tempRect=new Rectangle,_this.activeState={},_this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),_this.forceClear=!1,_this.useMaxPadding=!1,_this}return FilterSystem3.prototype.push=function(target,filters2){for(var renderer=this.renderer,filterStack=this.defaultFilterStack,state=this.statePool.pop()||new FilterState,renderTextureSystem=this.renderer.renderTexture,resolution=filters2[0].resolution,padding=filters2[0].padding,autoFit=filters2[0].autoFit,legacy=filters2[0].legacy,i=1;i<filters2.length;i++){var filter=filters2[i];resolution=Math.min(resolution,filter.resolution),padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding,autoFit=autoFit&&filter.autoFit,legacy=legacy||filter.legacy}if(filterStack.length===1&&(this.defaultFilterStack[0].renderTexture=renderTextureSystem.current),filterStack.push(state),state.resolution=resolution,state.legacy=legacy,state.target=target,state.sourceFrame.copyFrom(target.filterArea||target.getBounds(!0)),state.sourceFrame.pad(padding),autoFit){var sourceFrameProjected=this.tempRect.copyFrom(renderTextureSystem.sourceFrame);renderer.projection.transform&&this.transformAABB(tempMatrix.copyFrom(renderer.projection.transform).invert(),sourceFrameProjected),state.sourceFrame.fit(sourceFrameProjected)}this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform),state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution),state.filters=filters2,state.destinationFrame.width=state.renderTexture.width,state.destinationFrame.height=state.renderTexture.height;var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=state.sourceFrame.width,destinationFrame.height=state.sourceFrame.height,state.renderTexture.filterFrame=state.sourceFrame,state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame),state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame),state.transform=renderer.projection.transform,renderer.projection.transform=null,renderTextureSystem.bind(state.renderTexture,state.sourceFrame,destinationFrame),renderer.framebuffer.clear(0,0,0,0)},FilterSystem3.prototype.pop=function(){var filterStack=this.defaultFilterStack,state=filterStack.pop(),filters2=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame,globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize,inputPixel=globalUniforms.inputPixel,inputClamp=globalUniforms.inputClamp;if(inputSize[0]=state.destinationFrame.width,inputSize[1]=state.destinationFrame.height,inputSize[2]=1/inputSize[0],inputSize[3]=1/inputSize[1],inputPixel[0]=inputSize[0]*state.resolution,inputPixel[1]=inputSize[1]*state.resolution,inputPixel[2]=1/inputPixel[0],inputPixel[3]=1/inputPixel[1],inputClamp[0]=.5*inputPixel[2],inputClamp[1]=.5*inputPixel[3],inputClamp[2]=state.sourceFrame.width*inputSize[2]-.5*inputPixel[2],inputClamp[3]=state.sourceFrame.height*inputSize[3]-.5*inputPixel[3],state.legacy){var filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width,filterArea[1]=state.destinationFrame.height,filterArea[2]=state.sourceFrame.x,filterArea[3]=state.sourceFrame.y,globalUniforms.filterClamp=globalUniforms.inputClamp}this.globalUniforms.update();var lastState=filterStack[filterStack.length-1];if(state.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),filters2.length===1)filters2[0].apply(this,state.renderTexture,lastState.renderTexture,CLEAR_MODES2.BLEND,state),this.returnFilterTexture(state.renderTexture);else{var flip=state.renderTexture,flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;var i=0;for(i=0;i<filters2.length-1;++i){filters2[i].apply(this,flip,flop,CLEAR_MODES2.CLEAR,state);var t=flip;flip=flop,flop=t}filters2[i].apply(this,flip,lastState.renderTexture,CLEAR_MODES2.BLEND,state),this.returnFilterTexture(flip),this.returnFilterTexture(flop)}state.clear(),this.statePool.push(state)},FilterSystem3.prototype.bindAndClear=function(filterTexture,clearMode){clearMode===void 0&&(clearMode=CLEAR_MODES2.CLEAR);var _a3=this.renderer,renderTextureSystem=_a3.renderTexture,stateSystem=_a3.state;if(filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,filterTexture&&filterTexture.filterFrame){var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=filterTexture.filterFrame.width,destinationFrame.height=filterTexture.filterFrame.height,renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame)}else filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?renderTextureSystem.bind(filterTexture):this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var autoClear=stateSystem.stateId&1||this.forceClear;(clearMode===CLEAR_MODES2.CLEAR||clearMode===CLEAR_MODES2.BLIT&&autoClear)&&this.renderer.framebuffer.clear(0,0,0,0)},FilterSystem3.prototype.applyFilter=function(filter,input,output,clearMode){var renderer=this.renderer;renderer.state.set(filter.state),this.bindAndClear(output,clearMode),filter.uniforms.uSampler=input,filter.uniforms.filterGlobals=this.globalUniforms,renderer.shader.bind(filter),filter.legacy?(this.quadUv.map(input._frame,input.filterFrame),renderer.geometry.bind(this.quadUv),renderer.geometry.draw(DRAW_MODES2.TRIANGLES)):(renderer.geometry.bind(this.quad),renderer.geometry.draw(DRAW_MODES2.TRIANGLE_STRIP))},FilterSystem3.prototype.calculateSpriteMatrix=function(outputMatrix,sprite){var _a3=this.activeState,sourceFrame=_a3.sourceFrame,destinationFrame=_a3.destinationFrame,orig=sprite._texture.orig,mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y),worldTransform=sprite.worldTransform.copyTo(Matrix.TEMP_MATRIX);return worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1/orig.width,1/orig.height),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix},FilterSystem3.prototype.destroy=function(){this.texturePool.clear(!1)},FilterSystem3.prototype.getOptimalFilterTexture=function(minWidth,minHeight,resolution){return resolution===void 0&&(resolution=1),this.texturePool.getOptimalTexture(minWidth,minHeight,resolution)},FilterSystem3.prototype.getFilterTexture=function(input,resolution){if(typeof input=="number"){var swap=input;input=resolution,resolution=swap}input=input||this.activeState.renderTexture;var filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution);return filterTexture.filterFrame=input.filterFrame,filterTexture},FilterSystem3.prototype.returnFilterTexture=function(renderTexture){this.texturePool.returnTexture(renderTexture)},FilterSystem3.prototype.emptyPool=function(){this.texturePool.clear(!0)},FilterSystem3.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},FilterSystem3.prototype.transformAABB=function(matrix,rect){var lt=tempPoints[0],lb=tempPoints[1],rt=tempPoints[2],rb=tempPoints[3];lt.set(rect.left,rect.top),lb.set(rect.left,rect.bottom),rt.set(rect.right,rect.top),rb.set(rect.right,rect.bottom),matrix.apply(lt,lt),matrix.apply(lb,lb),matrix.apply(rt,rt),matrix.apply(rb,rb);var x0=Math.min(lt.x,lb.x,rt.x,rb.x),y0=Math.min(lt.y,lb.y,rt.y,rb.y),x1=Math.max(lt.x,lb.x,rt.x,rb.x),y1=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=x0,rect.y=y0,rect.width=x1-x0,rect.height=y1-y0},FilterSystem3.prototype.roundFrame=function(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(transform){var a=transform.a,b=transform.b,c=transform.c,d=transform.d;if((b!==0||c!==0)&&(a!==0||d!==0))return}transform=transform?tempMatrix.copyFrom(transform):tempMatrix.identity(),transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.transformAABB(transform,frame),frame.ceil(resolution),this.transformAABB(transform.invert(),frame)},FilterSystem3}(System),ObjectRenderer=function(){function ObjectRenderer3(renderer){this.renderer=renderer}return ObjectRenderer3.prototype.flush=function(){},ObjectRenderer3.prototype.destroy=function(){this.renderer=null},ObjectRenderer3.prototype.start=function(){},ObjectRenderer3.prototype.stop=function(){this.flush()},ObjectRenderer3.prototype.render=function(_object){},ObjectRenderer3}(),BatchSystem=function(_super){__extends3(BatchSystem3,_super);function BatchSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.emptyRenderer=new ObjectRenderer(renderer),_this.currentRenderer=_this.emptyRenderer,_this}return BatchSystem3.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())},BatchSystem3.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem3.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem3.prototype.copyBoundTextures=function(arr,maxTextures){for(var boundTextures=this.renderer.texture.boundTextures,i=maxTextures-1;i>=0;--i)arr[i]=boundTextures[i]||null,arr[i]&&(arr[i]._batchLocation=i)},BatchSystem3.prototype.boundArray=function(texArray,boundTextures,batchId,maxTextures){for(var elements=texArray.elements,ids=texArray.ids,count2=texArray.count,j=0,i=0;i<count2;i++){var tex=elements[i],loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex){ids[i]=loc;continue}for(;j<maxTextures;){var bound=boundTextures[j];if(bound&&bound._batchEnabled===batchId&&bound._batchLocation===j){j++;continue}ids[i]=j,tex._batchLocation=j,boundTextures[j]=tex;break}}},BatchSystem3}(System),CONTEXT_UID_COUNTER=0,ContextSystem=function(_super){__extends3(ContextSystem3,_super);function ContextSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.webGLVersion=1,_this.extensions={},_this.supports={uint32Indices:!1},_this.handleContextLost=_this.handleContextLost.bind(_this),_this.handleContextRestored=_this.handleContextRestored.bind(_this),renderer.view.addEventListener("webglcontextlost",_this.handleContextLost,!1),renderer.view.addEventListener("webglcontextrestored",_this.handleContextRestored,!1),_this}return Object.defineProperty(ContextSystem3.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),ContextSystem3.prototype.contextChange=function(gl){this.gl=gl,this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").restoreContext()},ContextSystem3.prototype.initFromContext=function(gl){this.gl=gl,this.validateContext(gl),this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(gl)},ContextSystem3.prototype.initFromOptions=function(options){var gl=this.createContext(this.renderer.view,options);this.initFromContext(gl)},ContextSystem3.prototype.createContext=function(canvas2,options){var gl;if(settings.PREFER_ENV>=ENV2.WEBGL2&&(gl=canvas2.getContext("webgl2",options)),gl)this.webGLVersion=2;else if(this.webGLVersion=1,gl=canvas2.getContext("webgl",options)||canvas2.getContext("experimental-webgl",options),!gl)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=gl,this.getExtensions(),this.gl},ContextSystem3.prototype.getExtensions=function(){var gl=this.gl,common={anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),loseContext:gl.getExtension("WEBGL_lose_context"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")})},ContextSystem3.prototype.handleContextLost=function(event){event.preventDefault()},ContextSystem3.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},ContextSystem3.prototype.destroy=function(){var view=this.renderer.view;view.removeEventListener("webglcontextlost",this.handleContextLost),view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},ContextSystem3.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},ContextSystem3.prototype.validateContext=function(gl){var attributes=gl.getContextAttributes(),isWebGl2="WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext;isWebGl2&&(this.webGLVersion=2),attributes.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var hasuint32=isWebGl2||!!gl.getExtension("OES_element_index_uint");this.supports.uint32Indices=hasuint32,hasuint32||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},ContextSystem3}(System),GLFramebuffer=function(){function GLFramebuffer3(framebuffer){this.framebuffer=framebuffer,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=MSAA_QUALITY2.NONE,this.msaaBuffer=null,this.blitFramebuffer=null}return GLFramebuffer3}(),tempRectangle=new Rectangle,FramebufferSystem=function(_super){__extends3(FramebufferSystem3,_super);function FramebufferSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.managedFramebuffers=[],_this.unknownFramebuffer=new Framebuffer(10,10),_this.msaaSamples=null,_this}return FramebufferSystem3.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){var nativeDrawBuffersExtension_1=this.renderer.context.extensions.drawBuffers,nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV2.WEBGL_LEGACY&&(nativeDrawBuffersExtension_1=null,nativeDepthTextureExtension=null),nativeDrawBuffersExtension_1?gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension_1.drawBuffersWEBGL(activeTextures)}:(this.hasMRT=!1,gl.drawBuffers=function(){}),nativeDepthTextureExtension||(this.writeDepthTexture=!1)}else this.msaaSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES)},FramebufferSystem3.prototype.bind=function(framebuffer,frame){var gl=this.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);this.current!==framebuffer&&(this.current=framebuffer,gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer)),fbo.dirtyId!==framebuffer.dirtyId&&(fbo.dirtyId=framebuffer.dirtyId,fbo.dirtyFormat!==framebuffer.dirtyFormat?(fbo.dirtyFormat=framebuffer.dirtyFormat,this.updateFramebuffer(framebuffer)):fbo.dirtySize!==framebuffer.dirtySize&&(fbo.dirtySize=framebuffer.dirtySize,this.resizeFramebuffer(framebuffer)));for(var i=0;i<framebuffer.colorTextures.length;i++){var tex=framebuffer.colorTextures[i];this.renderer.texture.unbind(tex.parentTextureArray||tex)}framebuffer.depthTexture&&this.renderer.texture.unbind(framebuffer.depthTexture),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,framebuffer.width,framebuffer.height)}else this.current&&(this.current=null,gl.bindFramebuffer(gl.FRAMEBUFFER,null)),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},FramebufferSystem3.prototype.setViewport=function(x,y,width,height){var v=this.viewport;(v.width!==width||v.height!==height||v.x!==x||v.y!==y)&&(v.x=x,v.y=y,v.width=width,v.height=height,this.gl.viewport(x,y,width,height))},Object.defineProperty(FramebufferSystem3.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),FramebufferSystem3.prototype.clear=function(r,g,b,a,mask){mask===void 0&&(mask=BUFFER_BITS2.COLOR|BUFFER_BITS2.DEPTH);var gl=this.gl;gl.clearColor(r,g,b,a),gl.clear(mask)},FramebufferSystem3.prototype.initFramebuffer=function(framebuffer){var gl=this.gl,fbo=new GLFramebuffer(gl.createFramebuffer());return fbo.multisample=this.detectSamples(framebuffer.multisample),framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo,this.managedFramebuffers.push(framebuffer),framebuffer.disposeRunner.add(this),fbo},FramebufferSystem3.prototype.resizeFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];fbo.stencil&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height));for(var colorTextures=framebuffer.colorTextures,i=0;i<colorTextures.length;i++)this.renderer.texture.bind(colorTextures[i],0);framebuffer.depthTexture&&this.renderer.texture.bind(framebuffer.depthTexture,0)},FramebufferSystem3.prototype.updateFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],colorTextures=framebuffer.colorTextures,count2=colorTextures.length;gl.drawBuffers||(count2=Math.min(count2,1)),fbo.multisample>1&&(fbo.msaaBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer));for(var activeTextures=[],i=0;i<count2;i++)if(!(i===0&&fbo.multisample>1)){var texture=framebuffer.colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,0),activeTextures.push(gl.COLOR_ATTACHMENT0+i)}if(activeTextures.length>1&&gl.drawBuffers(activeTextures),framebuffer.depthTexture){var writeDepthTexture=this.writeDepthTexture;if(writeDepthTexture){var depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,0)}}!fbo.stencil&&(framebuffer.stencil||framebuffer.depth)&&(fbo.stencil=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height),framebuffer.depthTexture||gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil))},FramebufferSystem3.prototype.detectSamples=function(samples){var msaaSamples=this.msaaSamples,res=MSAA_QUALITY2.NONE;if(samples<=1||msaaSamples===null)return res;for(var i=0;i<msaaSamples.length;i++)if(msaaSamples[i]<=samples){res=msaaSamples[i];break}return res===1&&(res=MSAA_QUALITY2.NONE),res},FramebufferSystem3.prototype.blit=function(framebuffer,sourcePixels,destPixels){var _a3=this,current=_a3.current,renderer=_a3.renderer,gl=_a3.gl,CONTEXT_UID=_a3.CONTEXT_UID;if(renderer.context.webGLVersion===2&&!!current){var fbo=current.glFramebuffers[CONTEXT_UID];if(!!fbo){if(!framebuffer){if(fbo.multisample<=1)return;fbo.blitFramebuffer||(fbo.blitFramebuffer=new Framebuffer(current.width,current.height),fbo.blitFramebuffer.addColorTexture(0,current.colorTextures[0])),framebuffer=fbo.blitFramebuffer,framebuffer.width=current.width,framebuffer.height=current.height}sourcePixels||(sourcePixels=tempRectangle,sourcePixels.width=current.width,sourcePixels.height=current.height),destPixels||(destPixels=sourcePixels);var sameSize=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,fbo.framebuffer),gl.blitFramebuffer(sourcePixels.x,sourcePixels.y,sourcePixels.width,sourcePixels.height,destPixels.x,destPixels.y,destPixels.width,destPixels.height,gl.COLOR_BUFFER_BIT,sameSize?gl.NEAREST:gl.LINEAR)}}},FramebufferSystem3.prototype.disposeFramebuffer=function(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],gl=this.gl;if(!!fbo){delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index3=this.managedFramebuffers.indexOf(framebuffer);index3>=0&&this.managedFramebuffers.splice(index3,1),framebuffer.disposeRunner.remove(this),contextLost||(gl.deleteFramebuffer(fbo.framebuffer),fbo.stencil&&gl.deleteRenderbuffer(fbo.stencil))}},FramebufferSystem3.prototype.disposeAll=function(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++)this.disposeFramebuffer(list[i],contextLost)},FramebufferSystem3.prototype.forceStencil=function(){var framebuffer=this.current;if(!!framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(!(!fbo||fbo.stencil)){framebuffer.enableStencil();var w=framebuffer.width,h=framebuffer.height,gl=this.gl,stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,h),fbo.stencil=stencil,gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil)}}},FramebufferSystem3.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle},FramebufferSystem3}(System),GLBuffer=function(){function GLBuffer3(buffer){this.buffer=buffer||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return GLBuffer3}(),byteSizeMap$1={5126:4,5123:2,5121:1},GeometrySystem=function(_super){__extends3(GeometrySystem3,_super);function GeometrySystem3(renderer){var _this=_super.call(this,renderer)||this;return _this._activeGeometry=null,_this._activeVao=null,_this.hasVao=!0,_this.hasInstance=!0,_this.canUseUInt32ElementIndex=!1,_this.managedGeometries={},_this.managedBuffers={},_this}return GeometrySystem3.prototype.contextChange=function(){this.disposeAll(!0);var gl=this.gl=this.renderer.gl,context4=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,context4.webGLVersion!==2){var nativeVaoExtension_1=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV2.WEBGL_LEGACY&&(nativeVaoExtension_1=null),nativeVaoExtension_1?(gl.createVertexArray=function(){return nativeVaoExtension_1.createVertexArrayOES()},gl.bindVertexArray=function(vao){return nativeVaoExtension_1.bindVertexArrayOES(vao)},gl.deleteVertexArray=function(vao){return nativeVaoExtension_1.deleteVertexArrayOES(vao)}):(this.hasVao=!1,gl.createVertexArray=function(){return null},gl.bindVertexArray=function(){return null},gl.deleteVertexArray=function(){return null})}if(context4.webGLVersion!==2){var instanceExt_1=gl.getExtension("ANGLE_instanced_arrays");instanceExt_1?(gl.vertexAttribDivisor=function(a,b){return instanceExt_1.vertexAttribDivisorANGLE(a,b)},gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt_1.drawElementsInstancedANGLE(a,b,c,d,e)},gl.drawArraysInstanced=function(a,b,c,d){return instanceExt_1.drawArraysInstancedANGLE(a,b,c,d)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=context4.webGLVersion===2||!!context4.extensions.uint32ElementIndex},GeometrySystem3.prototype.bind=function(geometry,shader){shader=shader||this.renderer.shader.shader;var gl=this.gl,vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],incRefCount=!1;vaos||(this.managedGeometries[geometry.id]=geometry,geometry.disposeRunner.add(this),geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={},incRefCount=!0);var vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader.program,incRefCount);this._activeGeometry=geometry,this._activeVao!==vao&&(this._activeVao=vao,this.hasVao?gl.bindVertexArray(vao):this.activateVao(geometry,shader.program)),this.updateBuffers()},GeometrySystem3.prototype.reset=function(){this.unbind()},GeometrySystem3.prototype.updateBuffers=function(){for(var geometry=this._activeGeometry,gl=this.gl,i=0;i<geometry.buffers.length;i++){var buffer=geometry.buffers[i],glBuffer=buffer._glBuffers[this.CONTEXT_UID];if(buffer._updateID!==glBuffer.updateID){glBuffer.updateID=buffer._updateID;var type=buffer.index?gl.ELEMENT_ARRAY_BUFFER:gl.ARRAY_BUFFER;if(gl.bindBuffer(type,glBuffer.buffer),this._boundBuffer=glBuffer,glBuffer.byteLength>=buffer.data.byteLength)gl.bufferSubData(type,0,buffer.data);else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength,gl.bufferData(type,buffer.data,drawType)}}}},GeometrySystem3.prototype.checkCompatibility=function(geometry,program){var geometryAttributes=geometry.attributes,shaderAttributes=program.attributeData;for(var j in shaderAttributes)if(!geometryAttributes[j])throw new Error('shader and geometry incompatible, geometry missing the "'+j+'" attribute')},GeometrySystem3.prototype.getSignature=function(geometry,program){var attribs=geometry.attributes,shaderAttributes=program.attributeData,strings=["g",geometry.id];for(var i in attribs)shaderAttributes[i]&&strings.push(i);return strings.join("-")},GeometrySystem3.prototype.initGeometryVao=function(geometry,program,incRefCount){incRefCount===void 0&&(incRefCount=!0),this.checkCompatibility(geometry,program);var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,signature=this.getSignature(geometry,program),vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID],vao=vaoObjectHash[signature];if(vao)return vaoObjectHash[program.id]=vao,vao;var buffers=geometry.buffers,attributes=geometry.attributes,tempStride={},tempStart={};for(var j in buffers)tempStride[j]=0,tempStart[j]=0;for(var j in attributes)!attributes[j].size&&program.attributeData[j]?attributes[j].size=program.attributeData[j].size:attributes[j].size||console.warn("PIXI Geometry attribute '"+j+"' size cannot be determined (likely the bound shader does not have the attribute)"),tempStride[attributes[j].buffer]+=attributes[j].size*byteSizeMap$1[attributes[j].type];for(var j in attributes){var attribute=attributes[j],attribSize=attribute.size;attribute.stride===void 0&&(tempStride[attribute.buffer]===attribSize*byteSizeMap$1[attribute.type]?attribute.stride=0:attribute.stride=tempStride[attribute.buffer]),attribute.start===void 0&&(attribute.start=tempStart[attribute.buffer],tempStart[attribute.buffer]+=attribSize*byteSizeMap$1[attribute.type])}vao=gl.createVertexArray(),gl.bindVertexArray(vao);for(var i=0;i<buffers.length;i++){var buffer=buffers[i];buffer._glBuffers[CONTEXT_UID]||(buffer._glBuffers[CONTEXT_UID]=new GLBuffer(gl.createBuffer()),this.managedBuffers[buffer.id]=buffer,buffer.disposeRunner.add(this)),incRefCount&&buffer._glBuffers[CONTEXT_UID].refCount++}return this.activateVao(geometry,program),this._activeVao=vao,vaoObjectHash[program.id]=vao,vaoObjectHash[signature]=vao,vao},GeometrySystem3.prototype.disposeBuffer=function(buffer,contextLost){if(!!this.managedBuffers[buffer.id]){delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID],gl=this.gl;buffer.disposeRunner.remove(this),!!glBuffer&&(contextLost||gl.deleteBuffer(glBuffer.buffer),delete buffer._glBuffers[this.CONTEXT_UID])}},GeometrySystem3.prototype.disposeGeometry=function(geometry,contextLost){if(!!this.managedGeometries[geometry.id]){delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],gl=this.gl,buffers=geometry.buffers;if(geometry.disposeRunner.remove(this),!!vaos){for(var i=0;i<buffers.length;i++){var buf=buffers[i]._glBuffers[this.CONTEXT_UID];buf.refCount--,buf.refCount===0&&!contextLost&&this.disposeBuffer(buffers[i],contextLost)}if(!contextLost){for(var vaoId in vaos)if(vaoId[0]==="g"){var vao=vaos[vaoId];this._activeVao===vao&&this.unbind(),gl.deleteVertexArray(vao)}}delete geometry.glVertexArrayObjects[this.CONTEXT_UID]}}},GeometrySystem3.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedGeometries),i=0;i<all.length;i++)this.disposeGeometry(this.managedGeometries[all[i]],contextLost);all=Object.keys(this.managedBuffers);for(var i=0;i<all.length;i++)this.disposeBuffer(this.managedBuffers[all[i]],contextLost)},GeometrySystem3.prototype.activateVao=function(geometry,program){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,buffers=geometry.buffers,attributes=geometry.attributes;geometry.indexBuffer&&gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,geometry.indexBuffer._glBuffers[CONTEXT_UID].buffer);var lastBuffer=null;for(var j in attributes){var attribute=attributes[j],buffer=buffers[attribute.buffer],glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j]){lastBuffer!==glBuffer&&(gl.bindBuffer(gl.ARRAY_BUFFER,glBuffer.buffer),lastBuffer=glBuffer);var location2=program.attributeData[j].location;if(gl.enableVertexAttribArray(location2),gl.vertexAttribPointer(location2,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start),attribute.instance)if(this.hasInstance)gl.vertexAttribDivisor(location2,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},GeometrySystem3.prototype.draw=function(type,size,start2,instanceCount){var gl=this.gl,geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT,glType=byteSize===2?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;byteSize===2||byteSize===4&&this.canUseUInt32ElementIndex?geometry.instanced?gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start2||0)*byteSize,instanceCount||1):gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start2||0)*byteSize):console.warn("unsupported index buffer type: uint32")}else geometry.instanced?gl.drawArraysInstanced(type,start2,size||geometry.getSize(),instanceCount||1):gl.drawArrays(type,start2,size||geometry.getSize());return this},GeometrySystem3.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},GeometrySystem3}(System),MaskData=function(){function MaskData3(maskObject){maskObject===void 0&&(maskObject=null),this.type=MASK_TYPES2.NONE,this.autoDetect=!0,this.maskObject=maskObject||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return MaskData3.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES2.NONE,this.autoDetect=!0),this._target=null},MaskData3.prototype.copyCountersOrReset=function(maskAbove){maskAbove?(this._stencilCounter=maskAbove._stencilCounter,this._scissorCounter=maskAbove._scissorCounter,this._scissorRect=maskAbove._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},MaskData3}();function compileShader(gl,type,src){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function compileProgram(gl,vertexSrc,fragmentSrc,attributeLocations){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,vertexSrc),glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,fragmentSrc),program=gl.createProgram();if(gl.attachShader(program,glVertShader),gl.attachShader(program,glFragShader),attributeLocations)for(var i in attributeLocations)gl.bindAttribLocation(program,attributeLocations[i],i);return gl.linkProgram(program),gl.getProgramParameter(program,gl.LINK_STATUS)||(gl.getShaderParameter(glVertShader,gl.COMPILE_STATUS)||(console.warn(vertexSrc),console.error(gl.getShaderInfoLog(glVertShader))),gl.getShaderParameter(glFragShader,gl.COMPILE_STATUS)||(console.warn(fragmentSrc),console.error(gl.getShaderInfoLog(glFragShader))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS)),console.error("gl.getError()",gl.getError()),gl.getProgramInfoLog(program)!==""&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)),gl.deleteProgram(program),program=null),gl.deleteShader(glVertShader),gl.deleteShader(glFragShader),program}function booleanArray(size){for(var array=new Array(size),i=0;i<array.length;i++)array[i]=!1;return array}function defaultValue(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"uvec2":return new Uint32Array(2*size);case"uvec3":return new Uint32Array(3*size);case"uvec4":return new Uint32Array(4*size);case"bool":return!1;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var unknownContext={},context=unknownContext;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var canvas2=document.createElement("canvas"),gl=void 0;settings.PREFER_ENV>=ENV2.WEBGL2&&(gl=canvas2.getContext("webgl2",{})),gl||(gl=canvas2.getContext("webgl",{})||canvas2.getContext("experimental-webgl",{}),gl?gl.getExtension("WEBGL_draw_buffers"):gl=null),context=gl}return context}var maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION2.MEDIUM;var gl=getTestContext();if(gl&&gl.getShaderPrecisionFormat){var shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);maxFragmentPrecision=shaderFragment.precision?PRECISION2.HIGH:PRECISION2.MEDIUM}}return maxFragmentPrecision}function setPrecision(src,requestedPrecision,maxSupportedPrecision){if(src.substring(0,9)!=="precision"){var precision=requestedPrecision;return requestedPrecision===PRECISION2.HIGH&&maxSupportedPrecision!==PRECISION2.HIGH&&(precision=PRECISION2.MEDIUM),"precision "+precision+` float;
`+src}else if(maxSupportedPrecision!==PRECISION2.HIGH&&src.substring(0,15)==="precision highp")return src.replace("precision highp","precision mediump");return src}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(type){return GLSL_TO_SIZE[type]}var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}var uniformParsers=[{test:function(data){return data.type==="float"&&data.size===1},code:function(name){return`
            if(uv["`+name+'"] !== ud["'+name+`"].value)
            {
                ud["`+name+'"].value = uv["'+name+`"]
                gl.uniform1f(ud["`+name+'"].location, uv["'+name+`"])
            }
            `}},{test:function(data){return(data.type==="sampler2D"||data.type==="samplerCube"||data.type==="sampler2DArray")&&data.size===1&&!data.isArray},code:function(name){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+name+`"], t);

            if(ud["`+name+`"].value !== t)
            {
                ud["`+name+`"].value = t;
                gl.uniform1i(ud["`+name+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(data,uniform){return data.type==="mat3"&&data.size===1&&uniform.a!==void 0},code:function(name){return`
            gl.uniformMatrix3fv(ud["`+name+'"].location, false, uv["'+name+`"].toArray(true));
            `}},{test:function(data,uniform){return data.type==="vec2"&&data.size===1&&uniform.x!==void 0},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+name+`"].location, v.x, v.y);
                }`}},{test:function(data){return data.type==="vec2"&&data.size===1},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+name+`"].location, v[0], v[1]);
                }
            `}},{test:function(data,uniform){return data.type==="vec4"&&data.size===1&&uniform.width!==void 0},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+name+`"].location, v.x, v.y, v.width, v.height)
                }`}},{test:function(data){return data.type==="vec4"&&data.size===1},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+name+`"].location, v[0], v[1], v[2], v[3])
                }`}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if(cv !== v)
    {
        cv.v = v;
        gl.uniform1f(location, v)
    }`,vec2:`
    if(cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(group,uniformData){var funcFragments=[`
        var v = null;
        var cv = null
        var t = 0;
        var gl = renderer.gl
    `];for(var i in group.uniforms){var data=uniformData[i];if(!data){group.uniforms[i].group&&funcFragments.push(`
                    renderer.shader.syncUniformGroup(uv["`+i+`"], syncData);
                `);continue}for(var uniform=group.uniforms[i],parsed=!1,j=0;j<uniformParsers.length;j++)if(uniformParsers[j].test(data,uniform)){funcFragments.push(uniformParsers[j].code(i,uniform)),parsed=!0;break}if(!parsed){var templateType=data.size===1?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS,template=templateType[data.type].replace("location",'ud["'+i+'"].location');funcFragments.push(`
            cv = ud["`+i+`"].value;
            v = uv["`+i+`"];
            `+template+";")}}return new Function("ud","uv","renderer","syncData",funcFragments.join(`
`))}var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(maxIfs){for(var src="",i=0;i<maxIfs;++i)i>0&&(src+=`
else `),i<maxIfs-1&&(src+="if(test == "+i+".0){}");return src}function checkMaxIfStatementsInShader(maxIfs,gl){if(maxIfs===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var shader=gl.createShader(gl.FRAGMENT_SHADER);;){var fragmentSrc=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));if(gl.shaderSource(shader,fragmentSrc),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS))maxIfs=maxIfs/2|0;else break}return maxIfs}var unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{var func=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=func({a:"b"},"a","b")===!0}catch(e){unsafeEval=!1}return unsafeEval}var defaultFragment=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,UID$3=0,nameCache={},Program=function(){function Program3(vertexSrc,fragmentSrc,name){name===void 0&&(name="pixi-shader"),this.id=UID$3++,this.vertexSrc=vertexSrc||Program3.defaultVertexSrc,this.fragmentSrc=fragmentSrc||Program3.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(name=name.replace(/\s+/g,"-"),nameCache[name]?(nameCache[name]++,name+="-"+nameCache[name]):nameCache[name]=1,this.vertexSrc="#define SHADER_NAME "+name+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+name+`
`+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION2.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return Program3.prototype.extractData=function(vertexSrc,fragmentSrc){var gl=getTestContext();if(gl){var program=compileProgram(gl,vertexSrc,fragmentSrc);this.attributeData=this.getAttributeData(program,gl),this.uniformData=this.getUniformData(program,gl),gl.deleteProgram(program)}else this.uniformData={},this.attributeData={}},Program3.prototype.getAttributeData=function(program,gl){for(var attributes={},attributesArray=[],totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i),type=mapType(gl,attribData.type),data={type,name:attribData.name,size:mapSize(type),location:0};attributes[attribData.name]=data,attributesArray.push(data)}attributesArray.sort(function(a,b){return a.name>b.name?1:-1});for(var i=0;i<attributesArray.length;i++)attributesArray[i].location=i;return attributes},Program3.prototype.getUniformData=function(program,gl){for(var uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i),name=uniformData.name.replace(/\[.*?\]$/,""),isArray3=uniformData.name.match(/\[.*?\]$/),type=mapType(gl,uniformData.type);uniforms[name]={type,size:uniformData.size,isArray:isArray3,value:defaultValue(type,uniformData.size)}}return uniforms},Object.defineProperty(Program3,"defaultVertexSrc",{get:function(){return defaultVertex},enumerable:!1,configurable:!0}),Object.defineProperty(Program3,"defaultFragmentSrc",{get:function(){return defaultFragment},enumerable:!1,configurable:!0}),Program3.from=function(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc,program=ProgramCache[key];return program||(ProgramCache[key]=program=new Program3(vertexSrc,fragmentSrc,name)),program},Program3}(),Shader=function(){function Shader3(program,uniforms){this.program=program,uniforms?uniforms instanceof UniformGroup?this.uniformGroup=uniforms:this.uniformGroup=new UniformGroup(uniforms):this.uniformGroup=new UniformGroup({});for(var i in program.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))}return Shader3.prototype.checkUniformExists=function(name,group){if(group.uniforms[name])return!0;for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group&&this.checkUniformExists(name,uniform))return!0}return!1},Shader3.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(Shader3.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),Shader3.from=function(vertexSrc,fragmentSrc,uniforms){var program=Program.from(vertexSrc,fragmentSrc);return new Shader3(program,uniforms)},Shader3}(),BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,State=function(){function State3(){this.data=0,this.blendMode=BLEND_MODES2.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(State3.prototype,"blend",{get:function(){return!!(this.data&1<<BLEND)},set:function(value){!!(this.data&1<<BLEND)!==value&&(this.data^=1<<BLEND)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"offsets",{get:function(){return!!(this.data&1<<OFFSET)},set:function(value){!!(this.data&1<<OFFSET)!==value&&(this.data^=1<<OFFSET)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"culling",{get:function(){return!!(this.data&1<<CULLING)},set:function(value){!!(this.data&1<<CULLING)!==value&&(this.data^=1<<CULLING)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"depthTest",{get:function(){return!!(this.data&1<<DEPTH_TEST)},set:function(value){!!(this.data&1<<DEPTH_TEST)!==value&&(this.data^=1<<DEPTH_TEST)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"depthMask",{get:function(){return!!(this.data&1<<DEPTH_MASK)},set:function(value){!!(this.data&1<<DEPTH_MASK)!==value&&(this.data^=1<<DEPTH_MASK)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<WINDING)},set:function(value){!!(this.data&1<<WINDING)!==value&&(this.data^=1<<WINDING)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"blendMode",{get:function(){return this._blendMode},set:function(value){this.blend=value!==BLEND_MODES2.NONE,this._blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(value){this.offsets=!!value,this._polygonOffset=value},enumerable:!1,configurable:!0}),State3.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},State3.for2d=function(){var state=new State3;return state.depthTest=!1,state.blend=!0,state},State3}(),defaultVertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,defaultFragment$1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Filter=function(_super){__extends3(Filter4,_super);function Filter4(vertexSrc,fragmentSrc,uniforms){var _this=this,program=Program.from(vertexSrc||Filter4.defaultVertexSrc,fragmentSrc||Filter4.defaultFragmentSrc);return _this=_super.call(this,program,uniforms)||this,_this.padding=0,_this.resolution=settings.FILTER_RESOLUTION,_this.enabled=!0,_this.autoFit=!0,_this.legacy=!!_this.program.attributeData.aTextureCoord,_this.state=new State,_this}return Filter4.prototype.apply=function(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode)},Object.defineProperty(Filter4.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Filter4,"defaultVertexSrc",{get:function(){return defaultVertex$1},enumerable:!1,configurable:!0}),Object.defineProperty(Filter4,"defaultFragmentSrc",{get:function(){return defaultFragment$1},enumerable:!1,configurable:!0}),Filter4}(Shader),vertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,fragment=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,tempMat=new Matrix,TextureMatrix=function(){function TextureMatrix3(texture,clampMargin){this._texture=texture,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof clampMargin=="undefined"?.5:clampMargin,this.isSimple=!1}return Object.defineProperty(TextureMatrix3.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture=value,this._textureID=-1},enumerable:!1,configurable:!0}),TextureMatrix3.prototype.multiplyUvs=function(uvs,out){out===void 0&&(out=uvs);for(var mat=this.mapCoord,i=0;i<uvs.length;i+=2){var x=uvs[i],y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx,out[i+1]=x*mat.b+y*mat.d+mat.ty}return out},TextureMatrix3.prototype.update=function(forceUpdate){var tex=this._texture;if(!tex||!tex.valid||!forceUpdate&&this._textureID===tex._updateID)return!1;this._textureID=tex._updateID,this._updateID++;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig,trim=tex.trim;trim&&(tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(tempMat));var texBase=tex.baseTexture,frame=this.uClampFrame,margin=this.clampMargin/texBase.resolution,offset=this.clampOffset;return frame[0]=(tex._frame.x+margin+offset)/texBase.width,frame[1]=(tex._frame.y+margin+offset)/texBase.height,frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width,frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height,this.uClampOffset[0]=offset/texBase.realWidth,this.uClampOffset[1]=offset/texBase.realHeight,this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&tex.rotate===0,!0},TextureMatrix3}(),SpriteMaskFilter=function(_super){__extends3(SpriteMaskFilter3,_super);function SpriteMaskFilter3(sprite){var _this=this,maskMatrix=new Matrix;return _this=_super.call(this,vertex,fragment)||this,sprite.renderable=!1,_this.maskSprite=sprite,_this.maskMatrix=maskMatrix,_this}return SpriteMaskFilter3.prototype.apply=function(filterManager,input,output,clearMode){var maskSprite=this.maskSprite,tex=maskSprite._texture;!tex.valid||(tex.uvMatrix||(tex.uvMatrix=new TextureMatrix(tex,0)),tex.uvMatrix.update(),this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1,this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.uvMatrix.uClampFrame,filterManager.applyFilter(this,input,output,clearMode))},SpriteMaskFilter3}(Filter),MaskSystem=function(_super){__extends3(MaskSystem3,_super);function MaskSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.enableScissor=!0,_this.alphaMaskPool=[],_this.maskDataPool=[],_this.maskStack=[],_this.alphaMaskIndex=0,_this}return MaskSystem3.prototype.setMaskStack=function(maskStack){this.maskStack=maskStack,this.renderer.scissor.setMaskStack(maskStack),this.renderer.stencil.setMaskStack(maskStack)},MaskSystem3.prototype.push=function(target,maskDataOrTarget){var maskData=maskDataOrTarget;if(!maskData.isMaskData){var d=this.maskDataPool.pop()||new MaskData;d.pooled=!0,d.maskObject=maskDataOrTarget,maskData=d}switch(maskData.autoDetect&&this.detect(maskData),maskData.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),maskData._target=target,maskData.type){case MASK_TYPES2.SCISSOR:this.maskStack.push(maskData),this.renderer.scissor.push(maskData);break;case MASK_TYPES2.STENCIL:this.maskStack.push(maskData),this.renderer.stencil.push(maskData);break;case MASK_TYPES2.SPRITE:maskData.copyCountersOrReset(null),this.pushSpriteMask(maskData),this.maskStack.push(maskData);break}},MaskSystem3.prototype.pop=function(target){var maskData=this.maskStack.pop();if(!(!maskData||maskData._target!==target)){switch(maskData.type){case MASK_TYPES2.SCISSOR:this.renderer.scissor.pop();break;case MASK_TYPES2.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case MASK_TYPES2.SPRITE:this.popSpriteMask();break}maskData.reset(),maskData.pooled&&this.maskDataPool.push(maskData)}},MaskSystem3.prototype.detect=function(maskData){var maskObject=maskData.maskObject;if(maskObject.isSprite){maskData.type=MASK_TYPES2.SPRITE;return}if(maskData.type=MASK_TYPES2.STENCIL,this.enableScissor&&maskObject.isFastRect&&maskObject.isFastRect()){var matrix=maskObject.worldTransform,rotX=Math.atan2(matrix.b,matrix.a),rotXY=Math.atan2(matrix.d,matrix.c);rotX=Math.round(rotX*(180/Math.PI)*100),rotXY=Math.round(rotXY*(180/Math.PI)*100)-rotX,rotX=(rotX%9e3+9e3)%9e3,rotXY=(rotXY%18e3+18e3)%18e3,rotX===0&&rotXY===9e3&&(maskData.type=MASK_TYPES2.SCISSOR)}},MaskSystem3.prototype.pushSpriteMask=function(maskData){var maskObject=maskData.maskObject,target=maskData._target,alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter(maskObject)]),alphaMaskFilter[0].resolution=this.renderer.resolution,alphaMaskFilter[0].maskSprite=maskObject;var stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(!0),this.renderer.filter.push(target,alphaMaskFilter),target.filterArea=stashFilterArea,this.alphaMaskIndex++},MaskSystem3.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},MaskSystem3}(System),AbstractMaskSystem=function(_super){__extends3(AbstractMaskSystem3,_super);function AbstractMaskSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.maskStack=[],_this.glConst=0,_this}return AbstractMaskSystem3.prototype.getStackLength=function(){return this.maskStack.length},AbstractMaskSystem3.prototype.setMaskStack=function(maskStack){var gl=this.renderer.gl,curStackLen=this.getStackLength();this.maskStack=maskStack;var newStackLen=this.getStackLength();newStackLen!==curStackLen&&(newStackLen===0?gl.disable(this.glConst):(gl.enable(this.glConst),this._useCurrent()))},AbstractMaskSystem3.prototype._useCurrent=function(){},AbstractMaskSystem3.prototype.destroy=function(){_super.prototype.destroy.call(this),this.maskStack=null},AbstractMaskSystem3}(System),ScissorSystem=function(_super){__extends3(ScissorSystem3,_super);function ScissorSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.SCISSOR_TEST,_this}return ScissorSystem3.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._scissorCounter:0},ScissorSystem3.prototype.push=function(maskData){var maskObject=maskData.maskObject;maskObject.renderable=!0;var prevData=maskData._scissorRect,bounds=maskObject.getBounds(!0),gl=this.renderer.gl;maskObject.renderable=!1,prevData?bounds.fit(prevData):gl.enable(gl.SCISSOR_TEST),maskData._scissorCounter++,maskData._scissorRect=bounds,this._useCurrent()},ScissorSystem3.prototype.pop=function(){var gl=this.renderer.gl;this.getStackLength()>0?this._useCurrent():gl.disable(gl.SCISSOR_TEST)},ScissorSystem3.prototype._useCurrent=function(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect,rt=this.renderer.renderTexture.current,_a3=this.renderer.projection,transform=_a3.transform,sourceFrame=_a3.sourceFrame,destinationFrame=_a3.destinationFrame,resolution=rt?rt.resolution:this.renderer.resolution,sx=destinationFrame.width/sourceFrame.width,sy=destinationFrame.height/sourceFrame.height,x=((rect.x-sourceFrame.x)*sx+destinationFrame.x)*resolution,y=((rect.y-sourceFrame.y)*sy+destinationFrame.y)*resolution,width=rect.width*sx*resolution,height=rect.height*sy*resolution;transform&&(x+=transform.tx*resolution,y+=transform.ty*resolution),rt||(y=this.renderer.height-height-y),this.renderer.gl.scissor(x,y,width,height)},ScissorSystem3}(AbstractMaskSystem),StencilSystem=function(_super){__extends3(StencilSystem3,_super);function StencilSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.STENCIL_TEST,_this}return StencilSystem3.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._stencilCounter:0},StencilSystem3.prototype.push=function(maskData){var maskObject=maskData.maskObject,gl=this.renderer.gl,prevMaskCount=maskData._stencilCounter;prevMaskCount===0&&(this.renderer.framebuffer.forceStencil(),gl.enable(gl.STENCIL_TEST)),maskData._stencilCounter++,gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),this.renderer.framebuffer.blit(),maskObject.renderable=!1,this._useCurrent()},StencilSystem3.prototype.pop=function(maskObject){var gl=this.renderer.gl;this.getStackLength()===0?(gl.disable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.clearStencil(0)):(gl.colorMask(!1,!1,!1,!1),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,this._useCurrent())},StencilSystem3.prototype._useCurrent=function(){var gl=this.renderer.gl;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.getStackLength(),this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},StencilSystem3.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},StencilSystem3}(AbstractMaskSystem),ProjectionSystem=function(_super){__extends3(ProjectionSystem3,_super);function ProjectionSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.destinationFrame=null,_this.sourceFrame=null,_this.defaultFrame=null,_this.projectionMatrix=new Matrix,_this.transform=null,_this}return ProjectionSystem3.prototype.update=function(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame,this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame,this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root),this.transform&&this.projectionMatrix.append(this.transform);var renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,renderer.globalUniforms.update(),renderer.shader.shader&&renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals)},ProjectionSystem3.prototype.calculateProjection=function(_destinationFrame,sourceFrame,_resolution,root){var pm=this.projectionMatrix,sign2=root?-1:1;pm.identity(),pm.a=1/sourceFrame.width*2,pm.d=sign2*(1/sourceFrame.height*2),pm.tx=-1-sourceFrame.x*pm.a,pm.ty=-sign2-sourceFrame.y*pm.d},ProjectionSystem3.prototype.setTransform=function(_matrix){},ProjectionSystem3}(System),tempRect=new Rectangle,tempRect2=new Rectangle,RenderTextureSystem=function(_super){__extends3(RenderTextureSystem3,_super);function RenderTextureSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.clearColor=renderer._backgroundColorRgba,_this.defaultMaskStack=[],_this.current=null,_this.sourceFrame=new Rectangle,_this.destinationFrame=new Rectangle,_this.viewportFrame=new Rectangle,_this}return RenderTextureSystem3.prototype.bind=function(renderTexture,sourceFrame,destinationFrame){renderTexture===void 0&&(renderTexture=null);var renderer=this.renderer;this.current=renderTexture;var baseTexture,framebuffer,resolution;renderTexture?(baseTexture=renderTexture.baseTexture,resolution=baseTexture.resolution,sourceFrame||(tempRect.width=renderTexture.frame.width,tempRect.height=renderTexture.frame.height,sourceFrame=tempRect),destinationFrame||(tempRect2.x=renderTexture.frame.x,tempRect2.y=renderTexture.frame.y,tempRect2.width=sourceFrame.width,tempRect2.height=sourceFrame.height,destinationFrame=tempRect2),framebuffer=baseTexture.framebuffer):(resolution=renderer.resolution,sourceFrame||(tempRect.width=renderer.screen.width,tempRect.height=renderer.screen.height,sourceFrame=tempRect),destinationFrame||(destinationFrame=tempRect,destinationFrame.width=sourceFrame.width,destinationFrame.height=sourceFrame.height));var viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution,viewportFrame.y=destinationFrame.y*resolution,viewportFrame.width=destinationFrame.width*resolution,viewportFrame.height=destinationFrame.height*resolution,renderTexture||(viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height)),this.renderer.framebuffer.bind(framebuffer,viewportFrame),this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer),renderTexture?this.renderer.mask.setMaskStack(baseTexture.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(sourceFrame),this.destinationFrame.copyFrom(destinationFrame)},RenderTextureSystem3.prototype.clear=function(clearColor,mask){this.current?clearColor=clearColor||this.current.baseTexture.clearColor:clearColor=clearColor||this.clearColor;var destinationFrame=this.destinationFrame,baseFrame=this.current?this.current.baseTexture:this.renderer.screen,clearMask=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height;if(clearMask){var _a3=this.viewportFrame,x=_a3.x,y=_a3.y,width=_a3.width,height=_a3.height;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(x,y,width,height)}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3],mask),clearMask&&this.renderer.scissor.pop()},RenderTextureSystem3.prototype.resize=function(){this.bind(null)},RenderTextureSystem3.prototype.reset=function(){this.bind(null)},RenderTextureSystem3}(System),IGLUniformData=function(){function IGLUniformData2(){}return IGLUniformData2}(),GLProgram=function(){function GLProgram3(program,uniformData){this.program=program,this.uniformData=uniformData,this.uniformGroups={}}return GLProgram3.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},GLProgram3}(),UID$4=0,defaultSyncData={textureCount:0},ShaderSystem=function(_super){__extends3(ShaderSystem3,_super);function ShaderSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.destroyed=!1,_this.systemCheck(),_this.gl=null,_this.shader=null,_this.program=null,_this.cache={},_this.id=UID$4++,_this}return ShaderSystem3.prototype.systemCheck=function(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},ShaderSystem3.prototype.contextChange=function(gl){this.gl=gl,this.reset()},ShaderSystem3.prototype.bind=function(shader,dontSync){shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program,glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(shader);return this.shader=shader,this.program!==program&&(this.program=program,this.gl.useProgram(glProgram.program)),dontSync||(defaultSyncData.textureCount=0,this.syncUniformGroup(shader.uniformGroup,defaultSyncData)),glProgram},ShaderSystem3.prototype.setUniforms=function(uniforms){var shader=this.shader.program,glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer)},ShaderSystem3.prototype.syncUniformGroup=function(group,syncData){var glProgram=this.getglProgram();(!group.static||group.dirtyId!==glProgram.uniformGroups[group.id])&&(glProgram.uniformGroups[group.id]=group.dirtyId,this.syncUniforms(group,glProgram,syncData))},ShaderSystem3.prototype.syncUniforms=function(group,glProgram,syncData){var syncFunc=group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group);syncFunc(glProgram.uniformData,group.uniforms,this.renderer,syncData)},ShaderSystem3.prototype.createSyncGroups=function(group){var id=this.getSignature(group,this.shader.program.uniformData);return this.cache[id]||(this.cache[id]=generateUniformsSync(group,this.shader.program.uniformData)),group.syncUniforms[this.shader.program.id]=this.cache[id],group.syncUniforms[this.shader.program.id]},ShaderSystem3.prototype.getSignature=function(group,uniformData){var uniforms=group.uniforms,strings=[];for(var i in uniforms)strings.push(i),uniformData[i]&&strings.push(uniformData[i].type);return strings.join("-")},ShaderSystem3.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},ShaderSystem3.prototype.generateShader=function(shader){var gl=this.gl,program=shader.program,attribMap={};for(var i in program.attributeData)attribMap[i]=program.attributeData[i].location;var shaderProgram=compileProgram(gl,program.vertexSrc,program.fragmentSrc,attribMap),uniformData={};for(var i in program.uniformData){var data=program.uniformData[i];uniformData[i]={location:gl.getUniformLocation(shaderProgram,i),value:defaultValue(data.type,data.size)}}var glProgram=new GLProgram(shaderProgram,uniformData);return program.glPrograms[this.renderer.CONTEXT_UID]=glProgram,glProgram},ShaderSystem3.prototype.reset=function(){this.program=null,this.shader=null},ShaderSystem3.prototype.destroy=function(){this.destroyed=!0},ShaderSystem3}(System);function mapWebGLBlendModesToPixi(gl,array){return array===void 0&&(array=[]),array[BLEND_MODES2.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.ADD]=[gl.ONE,gl.ONE],array[BLEND_MODES2.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.NONE]=[0,0],array[BLEND_MODES2.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE],array[BLEND_MODES2.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SRC_IN]=[gl.DST_ALPHA,gl.ZERO],array[BLEND_MODES2.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO],array[BLEND_MODES2.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE],array[BLEND_MODES2.DST_IN]=[gl.ZERO,gl.SRC_ALPHA],array[BLEND_MODES2.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA],array[BLEND_MODES2.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD],array}var BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5,StateSystem=function(_super){__extends3(StateSystem3,_super);function StateSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.gl=null,_this.stateId=0,_this.polygonOffset=0,_this.blendMode=BLEND_MODES2.NONE,_this._blendEq=!1,_this.map=[],_this.map[BLEND$1]=_this.setBlend,_this.map[OFFSET$1]=_this.setOffset,_this.map[CULLING$1]=_this.setCullFace,_this.map[DEPTH_TEST$1]=_this.setDepthTest,_this.map[WINDING$1]=_this.setFrontFace,_this.map[DEPTH_MASK$1]=_this.setDepthMask,_this.checks=[],_this.defaultState=new State,_this.defaultState.blend=!0,_this}return StateSystem3.prototype.contextChange=function(gl){this.gl=gl,this.blendModes=mapWebGLBlendModesToPixi(gl),this.set(this.defaultState),this.reset()},StateSystem3.prototype.set=function(state){if(state=state||this.defaultState,this.stateId!==state.data){for(var diff=this.stateId^state.data,i=0;diff;)diff&1&&this.map[i].call(this,!!(state.data&1<<i)),diff=diff>>1,i++;this.stateId=state.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,state)},StateSystem3.prototype.forceState=function(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(state.data&1<<i));for(var i=0;i<this.checks.length;i++)this.checks[i](this,state);this.stateId=state.data},StateSystem3.prototype.setBlend=function(value){this.updateCheck(StateSystem3.checkBlendMode,value),this.gl[value?"enable":"disable"](this.gl.BLEND)},StateSystem3.prototype.setOffset=function(value){this.updateCheck(StateSystem3.checkPolygonOffset,value),this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},StateSystem3.prototype.setDepthTest=function(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)},StateSystem3.prototype.setDepthMask=function(value){this.gl.depthMask(value)},StateSystem3.prototype.setCullFace=function(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)},StateSystem3.prototype.setFrontFace=function(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])},StateSystem3.prototype.setBlendMode=function(value){if(value!==this.blendMode){this.blendMode=value;var mode=this.blendModes[value],gl=this.gl;mode.length===2?gl.blendFunc(mode[0],mode[1]):gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3]),mode.length===6?(this._blendEq=!0,gl.blendEquationSeparate(mode[4],mode[5])):this._blendEq&&(this._blendEq=!1,gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD))}},StateSystem3.prototype.setPolygonOffset=function(value,scale){this.gl.polygonOffset(value,scale)},StateSystem3.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},StateSystem3.prototype.updateCheck=function(func,value){var index3=this.checks.indexOf(func);value&&index3===-1?this.checks.push(func):!value&&index3!==-1&&this.checks.splice(index3,1)},StateSystem3.checkBlendMode=function(system,state){system.setBlendMode(state.blendMode)},StateSystem3.checkPolygonOffset=function(system,state){system.setPolygonOffset(1,state.polygonOffset)},StateSystem3}(System),TextureGCSystem=function(_super){__extends3(TextureGCSystem3,_super);function TextureGCSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.count=0,_this.checkCount=0,_this.maxIdle=settings.GC_MAX_IDLE,_this.checkCountMax=settings.GC_MAX_CHECK_COUNT,_this.mode=settings.GC_MODE,_this}return TextureGCSystem3.prototype.postrender=function(){!this.renderer.renderingToScreen||(this.count++,this.mode!==GC_MODES2.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},TextureGCSystem3.prototype.run=function(){for(var tm=this.renderer.texture,managedTextures=tm.managedTextures,wasRemoved=!1,i=0;i<managedTextures.length;i++){var texture=managedTextures[i];!texture.framebuffer&&this.count-texture.touched>this.maxIdle&&(tm.destroyTexture(texture,!0),managedTextures[i]=null,wasRemoved=!0)}if(wasRemoved){for(var j=0,i=0;i<managedTextures.length;i++)managedTextures[i]!==null&&(managedTextures[j++]=managedTextures[i]);managedTextures.length=j}},TextureGCSystem3.prototype.unload=function(displayObject){var tm=this.renderer.texture,texture=displayObject._texture;texture&&!texture.framebuffer&&tm.destroyTexture(texture);for(var i=displayObject.children.length-1;i>=0;i--)this.unload(displayObject.children[i])},TextureGCSystem3}(System),GLTexture=function(){function GLTexture3(texture){this.texture=texture,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121,this.samplerType=0}return GLTexture3}(),TextureSystem=function(_super){__extends3(TextureSystem3,_super);function TextureSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.boundTextures=[],_this.currentLocation=-1,_this.managedTextures=[],_this._unknownBoundTextures=!1,_this.unknownTexture=new BaseTexture,_this.hasIntegerTextures=!1,_this}return TextureSystem3.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(var i=0;i<maxTextures;i++)this.boundTextures[i]=null;this.emptyTextures={};var emptyTexture2D=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D,this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture(gl.createTexture()),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(var i=0;i<this.boundTextures.length;i++)this.bind(null,i)},TextureSystem3.prototype.bind=function(texture,location2){location2===void 0&&(location2=0);var gl=this.gl;if(texture){if(texture=texture.castToBaseTexture(),texture.parentTextureArray)return;if(texture.valid){texture.touched=this.renderer.textureGC.count;var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);this.boundTextures[location2]!==texture&&(this.currentLocation!==location2&&(this.currentLocation=location2,gl.activeTexture(gl.TEXTURE0+location2)),gl.bindTexture(texture.target,glTexture.texture)),glTexture.dirtyId!==texture.dirtyId&&(this.currentLocation!==location2&&(this.currentLocation=location2,gl.activeTexture(gl.TEXTURE0+location2)),this.updateTexture(texture)),this.boundTextures[location2]=texture}}else this.currentLocation!==location2&&(this.currentLocation=location2,gl.activeTexture(gl.TEXTURE0+location2)),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture),this.boundTextures[location2]=null},TextureSystem3.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]=this.unknownTexture},TextureSystem3.prototype.unbind=function(texture){var _a3=this,gl=_a3.gl,boundTextures=_a3.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<boundTextures.length;i++)boundTextures[i]===this.unknownTexture&&this.bind(null,i)}for(var i=0;i<boundTextures.length;i++)boundTextures[i]===texture&&(this.currentLocation!==i&&(gl.activeTexture(gl.TEXTURE0+i),this.currentLocation=i),gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture),boundTextures[i]=null)},TextureSystem3.prototype.ensureSamplerType=function(maxTextures){var _a3=this,boundTextures=_a3.boundTextures,hasIntegerTextures=_a3.hasIntegerTextures,CONTEXT_UID=_a3.CONTEXT_UID;if(!!hasIntegerTextures)for(var i=maxTextures-1;i>=0;--i){var tex=boundTextures[i];if(tex){var glTexture=tex._glTextures[CONTEXT_UID];glTexture.samplerType!==SAMPLER_TYPES2.FLOAT&&this.renderer.texture.unbind(tex)}}},TextureSystem3.prototype.initTexture=function(texture){var glTexture=new GLTexture(this.gl.createTexture());return glTexture.dirtyId=-1,texture._glTextures[this.CONTEXT_UID]=glTexture,this.managedTextures.push(texture),texture.on("dispose",this.destroyTexture,this),glTexture},TextureSystem3.prototype.initTextureType=function(texture,glTexture){if(glTexture.internalFormat=texture.format,glTexture.type=texture.type,this.webGLVersion===2){var gl=this.renderer.gl;texture.type===gl.FLOAT&&texture.format===gl.RGBA&&(glTexture.internalFormat=gl.RGBA32F),texture.type===TYPES2.HALF_FLOAT&&(glTexture.type=gl.HALF_FLOAT),glTexture.type===gl.HALF_FLOAT&&texture.format===gl.RGBA&&(glTexture.internalFormat=gl.RGBA16F)}},TextureSystem3.prototype.updateTexture=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(!!glTexture){var renderer=this.renderer;if(this.initTextureType(texture,glTexture),texture.resource&&texture.resource.upload(renderer,texture,glTexture))glTexture.samplerType!==SAMPLER_TYPES2.FLOAT&&(this.hasIntegerTextures=!0);else{var width=texture.realWidth,height=texture.realHeight,gl=renderer.gl;(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0)&&(glTexture.width=width,glTexture.height=height,gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null))}texture.dirtyStyleId!==glTexture.dirtyStyleId&&this.updateTextureStyle(texture),glTexture.dirtyId=texture.dirtyId}},TextureSystem3.prototype.destroyTexture=function(texture,skipRemove){var gl=this.gl;if(texture=texture.castToBaseTexture(),texture._glTextures[this.CONTEXT_UID]&&(this.unbind(texture),gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture),texture.off("dispose",this.destroyTexture,this),delete texture._glTextures[this.CONTEXT_UID],!skipRemove)){var i=this.managedTextures.indexOf(texture);i!==-1&&removeItems(this.managedTextures,i,1)}},TextureSystem3.prototype.updateTextureStyle=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];!glTexture||((texture.mipmap===MIPMAP_MODES2.POW2||this.webGLVersion!==2)&&!texture.isPowerOfTwo?glTexture.mipmap=!1:glTexture.mipmap=texture.mipmap>=1,this.webGLVersion!==2&&!texture.isPowerOfTwo?glTexture.wrapMode=WRAP_MODES2.CLAMP:glTexture.wrapMode=texture.wrapMode,texture.resource&&texture.resource.style(this.renderer,texture,glTexture)||this.setStyle(texture,glTexture),glTexture.dirtyStyleId=texture.dirtyStyleId)},TextureSystem3.prototype.setStyle=function(texture,glTexture){var gl=this.gl;if(glTexture.mipmap&&texture.mipmap!==MIPMAP_MODES2.ON_MANUAL&&gl.generateMipmap(texture.target),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode),glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES2.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);var anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===SCALE_MODES2.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES2.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===SCALE_MODES2.LINEAR?gl.LINEAR:gl.NEAREST)},TextureSystem3}(System),_systems={__proto__:null,FilterSystem,BatchSystem,ContextSystem,FramebufferSystem,GeometrySystem,MaskSystem,ScissorSystem,StencilSystem,ProjectionSystem,RenderTextureSystem,ShaderSystem,StateSystem,TextureGCSystem,TextureSystem},tempMatrix$1=new Matrix,AbstractRenderer=function(_super){__extends3(AbstractRenderer3,_super);function AbstractRenderer3(type,options){type===void 0&&(type=RENDERER_TYPE2.UNKNOWN);var _this=_super.call(this)||this;return options=Object.assign({},settings.RENDER_OPTIONS,options),_this.options=options,_this.type=type,_this.screen=new Rectangle(0,0,options.width,options.height),_this.view=options.view||document.createElement("canvas"),_this.resolution=options.resolution||settings.RESOLUTION,_this.useContextAlpha=options.useContextAlpha,_this.autoDensity=!!options.autoDensity,_this.preserveDrawingBuffer=options.preserveDrawingBuffer,_this.clearBeforeRender=options.clearBeforeRender,_this._backgroundColor=0,_this._backgroundColorRgba=[0,0,0,1],_this._backgroundColorString="#000000",_this.backgroundColor=options.backgroundColor||_this._backgroundColor,_this.backgroundAlpha=options.backgroundAlpha,options.transparent!==void 0&&(deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),_this.useContextAlpha=options.transparent,_this.backgroundAlpha=options.transparent?0:1),_this._lastObjectRendered=null,_this.plugins={},_this}return AbstractRenderer3.prototype.initPlugins=function(staticMap){for(var o in staticMap)this.plugins[o]=new staticMap[o](this)},Object.defineProperty(AbstractRenderer3.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer3.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),AbstractRenderer3.prototype.resize=function(screenWidth,screenHeight){this.screen.width=screenWidth,this.screen.height=screenHeight,this.view.width=screenWidth*this.resolution,this.view.height=screenHeight*this.resolution,this.autoDensity&&(this.view.style.width=screenWidth+"px",this.view.style.height=screenHeight+"px"),this.emit("resize",screenWidth,screenHeight)},AbstractRenderer3.prototype.generateTexture=function(displayObject,scaleMode,resolution,region){region=region||displayObject.getLocalBounds(null,!0),region.width===0&&(region.width=1),region.height===0&&(region.height=1);var renderTexture=RenderTexture.create({width:region.width|0,height:region.height|0,scaleMode,resolution});return tempMatrix$1.tx=-region.x,tempMatrix$1.ty=-region.y,this.render(displayObject,{renderTexture,clear:!1,transform:tempMatrix$1,skipUpdateTransform:!!displayObject.parent}),renderTexture},AbstractRenderer3.prototype.destroy=function(removeView){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var thisAny=this;thisAny.plugins=null,thisAny.type=RENDERER_TYPE2.UNKNOWN,thisAny.view=null,thisAny.screen=null,thisAny._tempDisplayObjectParent=null,thisAny.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(AbstractRenderer3.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(value){this._backgroundColor=value,this._backgroundColorString=hex2string(value),hex2rgb(value,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer3.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(value){this._backgroundColorRgba[3]=value},enumerable:!1,configurable:!0}),AbstractRenderer3}(import_eventemitter3.default),Renderer=function(_super){__extends3(Renderer3,_super);function Renderer3(options){var _this=_super.call(this,RENDERER_TYPE2.WEBGL,options)||this;return options=_this.options,_this.gl=null,_this.CONTEXT_UID=0,_this.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange"),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize")},_this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0),_this.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch"),_this.initPlugins(Renderer3.__plugins),options.context?_this.context.initFromContext(options.context):_this.context.initFromOptions({alpha:!!_this.useContextAlpha,antialias:options.antialias,premultipliedAlpha:_this.useContextAlpha&&_this.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference}),_this.renderingToScreen=!0,sayHello(_this.context.webGLVersion===2?"WebGL 2":"WebGL 1"),_this.resize(_this.options.width,_this.options.height),_this}return Renderer3.create=function(options){if(isWebGLSupported())return new Renderer3(options);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Renderer3.prototype.addSystem=function(ClassRef,name){name||(name=ClassRef.name);var system=new ClassRef(this);if(this[name])throw new Error('Whoops! The name "'+name+'" is already in use');this[name]=system;for(var i in this.runners)this.runners[i].add(system);return this},Renderer3.prototype.render=function(displayObject,options){var renderTexture,clear,transform,skipUpdateTransform;if(options&&(options instanceof RenderTexture?(deprecation("6.0.0","Renderer#render arguments changed, use options instead."),renderTexture=options,clear=arguments[2],transform=arguments[3],skipUpdateTransform=arguments[4]):(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform)),this.renderingToScreen=!renderTexture,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=transform,!this.context.isLost){if(renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}this.renderTexture.bind(renderTexture),this.batch.currentRenderer.start(),(clear!==void 0?clear:this.clearBeforeRender)&&this.renderTexture.clear(),displayObject.render(this),this.batch.currentRenderer.flush(),renderTexture&&renderTexture.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},Renderer3.prototype.resize=function(screenWidth,screenHeight){_super.prototype.resize.call(this,screenWidth,screenHeight),this.runners.resize.emit(screenWidth,screenHeight)},Renderer3.prototype.reset=function(){return this.runners.reset.emit(),this},Renderer3.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},Renderer3.prototype.destroy=function(removeView){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();_super.prototype.destroy.call(this,removeView),this.gl=null},Object.defineProperty(Renderer3.prototype,"extract",{get:function(){return deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),Renderer3.registerPlugin=function(pluginName,ctor){Renderer3.__plugins=Renderer3.__plugins||{},Renderer3.__plugins[pluginName]=ctor},Renderer3}(AbstractRenderer);function autoDetectRenderer(options){return Renderer.create(options)}var $defaultVertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,$defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,defaultVertex$2=$defaultVertex,defaultFilterVertex=$defaultFilterVertex,BatchDrawCall=function(){function BatchDrawCall3(){this.texArray=null,this.blend=0,this.type=DRAW_MODES2.TRIANGLES,this.start=0,this.size=0,this.data=null}return BatchDrawCall3}(),BatchTextureArray=function(){function BatchTextureArray3(){this.elements=[],this.ids=[],this.count=0}return BatchTextureArray3.prototype.clear=function(){for(var i=0;i<this.count;i++)this.elements[i]=null;this.count=0},BatchTextureArray3}(),ViewableBuffer=function(){function ViewableBuffer3(sizeOrBuffer){typeof sizeOrBuffer=="number"?this.rawBinaryData=new ArrayBuffer(sizeOrBuffer):sizeOrBuffer instanceof Uint8Array?this.rawBinaryData=sizeOrBuffer.buffer:this.rawBinaryData=sizeOrBuffer,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(ViewableBuffer3.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),ViewableBuffer3.prototype.view=function(type){return this[type+"View"]},ViewableBuffer3.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},ViewableBuffer3.sizeOf=function(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(type+" isn't a valid view type")}},ViewableBuffer3}(),AbstractBatchRenderer=function(_super){__extends3(AbstractBatchRenderer3,_super);function AbstractBatchRenderer3(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=null,_this.geometryClass=null,_this.vertexSize=null,_this.state=State.for2d(),_this.size=settings.SPRITE_BATCH_SIZE*4,_this._vertexCount=0,_this._indexCount=0,_this._bufferedElements=[],_this._bufferedTextures=[],_this._bufferSize=0,_this._shader=null,_this._packedGeometries=[],_this._packedGeometryPoolSize=2,_this._flushId=0,_this._aBuffers={},_this._iBuffers={},_this.MAX_TEXTURES=1,_this.renderer.on("prerender",_this.onPrerender,_this),renderer.runners.contextChange.add(_this),_this._dcIndex=0,_this._aIndex=0,_this._iIndex=0,_this._attributeBuffer=null,_this._indexBuffer=null,_this._tempBoundTextures=[],_this}return AbstractBatchRenderer3.prototype.contextChange=function(){var gl=this.renderer.gl;settings.PREFER_ENV===ENV2.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,gl)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},AbstractBatchRenderer3.prototype.initFlushBuffers=function(){for(var _drawCallPool=AbstractBatchRenderer3._drawCallPool,_textureArrayPool=AbstractBatchRenderer3._textureArrayPool,MAX_SPRITES=this.size/4,MAX_TA=Math.floor(MAX_SPRITES/this.MAX_TEXTURES)+1;_drawCallPool.length<MAX_SPRITES;)_drawCallPool.push(new BatchDrawCall);for(;_textureArrayPool.length<MAX_TA;)_textureArrayPool.push(new BatchTextureArray);for(var i=0;i<this.MAX_TEXTURES;i++)this._tempBoundTextures[i]=null},AbstractBatchRenderer3.prototype.onPrerender=function(){this._flushId=0},AbstractBatchRenderer3.prototype.render=function(element){!element._texture.valid||(this._vertexCount+element.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=element.vertexData.length/2,this._indexCount+=element.indices.length,this._bufferedTextures[this._bufferSize]=element._texture.baseTexture,this._bufferedElements[this._bufferSize++]=element)},AbstractBatchRenderer3.prototype.buildTexturesAndDrawCalls=function(){var _a3=this,textures=_a3._bufferedTextures,MAX_TEXTURES=_a3.MAX_TEXTURES,textureArrays=AbstractBatchRenderer3._textureArrayPool,batch=this.renderer.batch,boundTextures=this._tempBoundTextures,touch=this.renderer.textureGC.count,TICK=++BaseTexture._globalBatch,countTexArrays=0,texArray=textureArrays[0],start2=0;batch.copyBoundTextures(boundTextures,MAX_TEXTURES);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null,tex._batchEnabled!==TICK&&(texArray.count>=MAX_TEXTURES&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start2,i),start2=i,texArray=textureArrays[++countTexArrays],++TICK),tex._batchEnabled=TICK,tex.touched=touch,texArray.elements[texArray.count++]=tex)}texArray.count>0&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start2,this._bufferSize),++countTexArrays,++TICK);for(var i=0;i<boundTextures.length;i++)boundTextures[i]=null;BaseTexture._globalBatch=TICK},AbstractBatchRenderer3.prototype.buildDrawCalls=function(texArray,start2,finish){var _a3=this,elements=_a3._bufferedElements,_attributeBuffer=_a3._attributeBuffer,_indexBuffer=_a3._indexBuffer,vertexSize=_a3.vertexSize,drawCalls=AbstractBatchRenderer3._drawCallPool,dcIndex=this._dcIndex,aIndex=this._aIndex,iIndex=this._iIndex,drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex,drawCall.texArray=texArray;for(var i=start2;i<finish;++i){var sprite=elements[i],tex=sprite._texture.baseTexture,spriteBlendMode=premultiplyBlendMode[tex.alphaMode?1:0][sprite.blendMode];elements[i]=null,start2<i&&drawCall.blend!==spriteBlendMode&&(drawCall.size=iIndex-drawCall.start,start2=i,drawCall=drawCalls[++dcIndex],drawCall.texArray=texArray,drawCall.start=iIndex),this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex),aIndex+=sprite.vertexData.length/2*vertexSize,iIndex+=sprite.indices.length,drawCall.blend=spriteBlendMode}start2<finish&&(drawCall.size=iIndex-drawCall.start,++dcIndex),this._dcIndex=dcIndex,this._aIndex=aIndex,this._iIndex=iIndex},AbstractBatchRenderer3.prototype.bindAndClearTexArray=function(texArray){for(var textureSystem=this.renderer.texture,j=0;j<texArray.count;j++)textureSystem.bind(texArray.elements[j],texArray.ids[j]),texArray.elements[j]=null;texArray.count=0},AbstractBatchRenderer3.prototype.updateGeometry=function(){var _a3=this,packedGeometries=_a3._packedGeometries,attributeBuffer=_a3._attributeBuffer,indexBuffer=_a3._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,packedGeometries[this._flushId]=new this.geometryClass),packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.bind(packedGeometries[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},AbstractBatchRenderer3.prototype.drawBatches=function(){for(var dcCount=this._dcIndex,_a3=this.renderer,gl=_a3.gl,stateSystem=_a3.state,drawCalls=AbstractBatchRenderer3._drawCallPool,curTexArray=null,i=0;i<dcCount;i++){var _b2=drawCalls[i],texArray=_b2.texArray,type=_b2.type,size=_b2.size,start2=_b2.start,blend=_b2.blend;curTexArray!==texArray&&(curTexArray=texArray,this.bindAndClearTexArray(texArray)),this.state.blendMode=blend,stateSystem.set(this.state),gl.drawElements(type,size,gl.UNSIGNED_SHORT,start2*2)}},AbstractBatchRenderer3.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},AbstractBatchRenderer3.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},AbstractBatchRenderer3.prototype.stop=function(){this.flush()},AbstractBatchRenderer3.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),_super.prototype.destroy.call(this)},AbstractBatchRenderer3.prototype.getAttributeBuffer=function(size){var roundedP2=nextPow2(Math.ceil(size/8)),roundedSizeIndex=log2(roundedP2),roundedSize=roundedP2*8;this._aBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._aBuffers[roundedSize];return buffer||(this._aBuffers[roundedSize]=buffer=new ViewableBuffer(roundedSize*this.vertexSize*4)),buffer},AbstractBatchRenderer3.prototype.getIndexBuffer=function(size){var roundedP2=nextPow2(Math.ceil(size/12)),roundedSizeIndex=log2(roundedP2),roundedSize=roundedP2*12;this._iBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._iBuffers[roundedSizeIndex];return buffer||(this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize)),buffer},AbstractBatchRenderer3.prototype.packInterleavedGeometry=function(element,attributeBuffer,indexBuffer,aIndex,iIndex){for(var uint32View=attributeBuffer.uint32View,float32View=attributeBuffer.float32View,packedVertices=aIndex/this.vertexSize,uvs=element.uvs,indicies=element.indices,vertexData=element.vertexData,textureId=element._texture.baseTexture._batchLocation,alpha=Math.min(element.worldAlpha,1),argb=alpha<1&&element._texture.baseTexture.alphaMode?premultiplyTint(element._tintRGB,alpha):element._tintRGB+(alpha*255<<24),i=0;i<vertexData.length;i+=2)float32View[aIndex++]=vertexData[i],float32View[aIndex++]=vertexData[i+1],float32View[aIndex++]=uvs[i],float32View[aIndex++]=uvs[i+1],uint32View[aIndex++]=argb,float32View[aIndex++]=textureId;for(var i=0;i<indicies.length;i++)indexBuffer[iIndex++]=packedVertices+indicies[i]},AbstractBatchRenderer3._drawCallPool=[],AbstractBatchRenderer3._textureArrayPool=[],AbstractBatchRenderer3}(ObjectRenderer),BatchShaderGenerator=function(){function BatchShaderGenerator3(vertexSrc,fragTemplate4){if(this.vertexSrc=vertexSrc,this.fragTemplate=fragTemplate4,this.programCache={},this.defaultGroupCache={},fragTemplate4.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(fragTemplate4.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return BatchShaderGenerator3.prototype.generateShader=function(maxTextures){if(!this.programCache[maxTextures]){for(var sampleValues=new Int32Array(maxTextures),i=0;i<maxTextures;i++)sampleValues[i]=i;this.defaultGroupCache[maxTextures]=UniformGroup.from({uSamplers:sampleValues},!0);var fragmentSrc=this.fragTemplate;fragmentSrc=fragmentSrc.replace(/%count%/gi,""+maxTextures),fragmentSrc=fragmentSrc.replace(/%forloop%/gi,this.generateSampleSrc(maxTextures)),this.programCache[maxTextures]=new Program(this.vertexSrc,fragmentSrc)}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[maxTextures]};return new Shader(this.programCache[maxTextures],uniforms)},BatchShaderGenerator3.prototype.generateSampleSrc=function(maxTextures){var src="";src+=`
`,src+=`
`;for(var i=0;i<maxTextures;i++)i>0&&(src+=`
else `),i<maxTextures-1&&(src+="if(vTextureId < "+i+".5)"),src+=`
{`,src+=`
	color = texture2D(uSamplers[`+i+"], vTextureCoord);",src+=`
}`;return src+=`
`,src+=`
`,src},BatchShaderGenerator3}(),BatchGeometry=function(_super){__extends3(BatchGeometry3,_super);function BatchGeometry3(_static){_static===void 0&&(_static=!1);var _this=_super.call(this)||this;return _this._buffer=new Buffer2(null,_static,!1),_this._indexBuffer=new Buffer2(null,_static,!0),_this.addAttribute("aVertexPosition",_this._buffer,2,!1,TYPES2.FLOAT).addAttribute("aTextureCoord",_this._buffer,2,!1,TYPES2.FLOAT).addAttribute("aColor",_this._buffer,4,!0,TYPES2.UNSIGNED_BYTE).addAttribute("aTextureId",_this._buffer,1,!0,TYPES2.FLOAT).addIndex(_this._indexBuffer),_this}return BatchGeometry3}(Geometry),defaultVertex$3=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,defaultFragment$2=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,BatchPluginFactory=function(){function BatchPluginFactory3(){}return BatchPluginFactory3.create=function(options){var _a3=Object.assign({vertex:defaultVertex$3,fragment:defaultFragment$2,geometryClass:BatchGeometry,vertexSize:6},options),vertex9=_a3.vertex,fragment12=_a3.fragment,vertexSize=_a3.vertexSize,geometryClass=_a3.geometryClass;return function(_super){__extends3(BatchPlugin,_super);function BatchPlugin(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=new BatchShaderGenerator(vertex9,fragment12),_this.geometryClass=geometryClass,_this.vertexSize=vertexSize,_this}return BatchPlugin}(AbstractBatchRenderer)},Object.defineProperty(BatchPluginFactory3,"defaultVertexSrc",{get:function(){return defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(BatchPluginFactory3,"defaultFragmentTemplate",{get:function(){return defaultFragment$2},enumerable:!1,configurable:!0}),BatchPluginFactory3}(),BatchRenderer=BatchPluginFactory.create(),resources={},_loop_1=function(name){Object.defineProperty(resources,name,{get:function(){return deprecation("6.0.0","PIXI.systems."+name+" has moved to PIXI."+name),_resources[name]}})};for(var name in _resources)_loop_1(name);var systems={},_loop_2=function(name){Object.defineProperty(systems,name,{get:function(){return deprecation("6.0.0","PIXI.resources."+name+" has moved to PIXI."+name),_systems[name]}})};for(var name in _systems)_loop_2(name);var Application=function(){function Application2(options){var _this=this;this.stage=new Container,options=Object.assign({forceCanvas:!1},options),this.renderer=autoDetectRenderer(options),Application2._plugins.forEach(function(plugin){plugin.init.call(_this,options)})}return Application2.registerPlugin=function(plugin){Application2._plugins.push(plugin)},Application2.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(Application2.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(Application2.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),Application2.prototype.destroy=function(removeView,stageOptions){var _this=this,plugins=Application2._plugins.slice(0);plugins.reverse(),plugins.forEach(function(plugin){plugin.destroy.call(_this)}),this.stage.destroy(stageOptions),this.stage=null,this.renderer.destroy(removeView),this.renderer=null},Application2._plugins=[],Application2}(),ResizePlugin=function(){function ResizePlugin2(){}return ResizePlugin2.init=function(options){var _this=this;Object.defineProperty(this,"resizeTo",{set:function(dom){self.removeEventListener("resize",this.queueResize),this._resizeTo=dom,dom&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){!_this._resizeTo||(_this.cancelResize(),_this._resizeId=requestAnimationFrame(function(){return _this.resize()}))},this.cancelResize=function(){_this._resizeId&&(cancelAnimationFrame(_this._resizeId),_this._resizeId=null)},this.resize=function(){if(!!_this._resizeTo){_this.cancelResize();var width,height;if(_this._resizeTo===self)width=self.innerWidth,height=self.innerHeight;else{var _a3=_this._resizeTo,clientWidth=_a3.clientWidth,clientHeight=_a3.clientHeight;width=clientWidth,height=clientHeight}_this.renderer.resize(width,height)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=options.resizeTo||null},ResizePlugin2.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},ResizePlugin2}();Application.registerPlugin(ResizePlugin);var TEMP_RECT=new Rectangle,BYTES_PER_PIXEL=4,Extract=function(){function Extract2(renderer){this.renderer=renderer}return Extract2.prototype.image=function(target,format3,quality){var image=new Image;return image.src=this.base64(target,format3,quality),image},Extract2.prototype.base64=function(target,format3,quality){return this.canvas(target).toDataURL(format3,quality)},Extract2.prototype.canvas=function(target){var renderer=this.renderer,resolution,frame,flipY=!1,renderTexture,generated=!1;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=this.renderer.generateTexture(target),generated=!0)),renderTexture?(resolution=renderTexture.baseTexture.resolution,frame=renderTexture.frame,flipY=!1,renderer.renderTexture.bind(renderTexture)):(resolution=this.renderer.resolution,flipY=!0,frame=TEMP_RECT,frame.width=this.renderer.width,frame.height=this.renderer.height,renderer.renderTexture.bind(null));var width=Math.floor(frame.width*resolution+1e-4),height=Math.floor(frame.height*resolution+1e-4),canvasBuffer=new CanvasRenderTarget(width,height,1),webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height),gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);if(Extract2.arrayPostDivide(webglPixels,canvasData.data),canvasBuffer.context.putImageData(canvasData,0,0),flipY){var target_1=new CanvasRenderTarget(canvasBuffer.width,canvasBuffer.height,1);target_1.context.scale(1,-1),target_1.context.drawImage(canvasBuffer.canvas,0,-height),canvasBuffer.destroy(),canvasBuffer=target_1}return generated&&renderTexture.destroy(!0),canvasBuffer.canvas},Extract2.prototype.pixels=function(target){var renderer=this.renderer,resolution,frame,renderTexture,generated=!1;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=this.renderer.generateTexture(target),generated=!0)),renderTexture?(resolution=renderTexture.baseTexture.resolution,frame=renderTexture.frame,renderer.renderTexture.bind(renderTexture)):(resolution=renderer.resolution,frame=TEMP_RECT,frame.width=renderer.width,frame.height=renderer.height,renderer.renderTexture.bind(null));var width=frame.width*resolution,height=frame.height*resolution,webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height),gl=renderer.gl;return gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels),generated&&renderTexture.destroy(!0),Extract2.arrayPostDivide(webglPixels,webglPixels),webglPixels},Extract2.prototype.destroy=function(){this.renderer=null},Extract2.arrayPostDivide=function(pixels,out){for(var i=0;i<pixels.length;i+=4){var alpha=out[i+3]=pixels[i+3];alpha!==0?(out[i]=Math.round(Math.min(pixels[i]*255/alpha,255)),out[i+1]=Math.round(Math.min(pixels[i+1]*255/alpha,255)),out[i+2]=Math.round(Math.min(pixels[i+2]*255/alpha,255))):(out[i]=pixels[i],out[i+1]=pixels[i+1],out[i+2]=pixels[i+2])}},Extract2}();var import_parse_uri=__toModule(require_parse_uri()),import_mini_signals=__toModule(require_mini_signals());function _noop(){}function eachSeries(array,iterator,callback,deferNext){var i=0,len2=array.length;(function next(err){if(err||i===len2){callback&&callback(err);return}deferNext?setTimeout(function(){iterator(array[i++],next)},1):iterator(array[i++],next)})()}function onlyOnce(fn){return function(){if(fn===null)throw new Error("Callback was already called.");var callFn=fn;fn=null,callFn.apply(this,arguments)}}function queue(worker,concurrency){if(concurrency==null)concurrency=1;else if(concurrency===0)throw new Error("Concurrency must not be zero");var workers=0,q={_tasks:[],concurrency,saturated:_noop,unsaturated:_noop,buffer:concurrency/4,empty:_noop,drain:_noop,error:_noop,started:!1,paused:!1,push:function(data,callback){_insert(data,!1,callback)},kill:function(){workers=0,q.drain=_noop,q.started=!1,q._tasks=[]},unshift:function(data,callback){_insert(data,!0,callback)},process:function(){for(;!q.paused&&workers<q.concurrency&&q._tasks.length;){var task=q._tasks.shift();q._tasks.length===0&&q.empty(),workers+=1,workers===q.concurrency&&q.saturated(),worker(task.data,onlyOnce(_next(task)))}},length:function(){return q._tasks.length},running:function(){return workers},idle:function(){return q._tasks.length+workers===0},pause:function(){q.paused!==!0&&(q.paused=!0)},resume:function(){if(q.paused!==!1){q.paused=!1;for(var w=1;w<=q.concurrency;w++)q.process()}}};function _insert(data,insertAtFront,callback){if(callback!=null&&typeof callback!="function")throw new Error("task callback must be a function");if(q.started=!0,data==null&&q.idle()){setTimeout(function(){return q.drain()},1);return}var item={data,callback:typeof callback=="function"?callback:_noop};insertAtFront?q._tasks.unshift(item):q._tasks.push(item),setTimeout(function(){return q.process()},1)}function _next(task){return function(){workers-=1,task.callback.apply(task,arguments),arguments[0]!=null&&q.error(arguments[0],task.data),workers<=q.concurrency-q.buffer&&q.unsaturated(),q.idle()&&q.drain(),q.process()}}return q}var cache={};function caching(resource,next){var _this=this;cache[resource.url]?(resource.data=cache[resource.url],resource.complete()):resource.onComplete.once(function(){return cache[_this.url]=_this.data}),next()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var useXdr=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest)),tempAnchor2=null,STATUS_NONE=0,STATUS_OK=200,STATUS_EMPTY=204,STATUS_IE_BUG_EMPTY=1223,STATUS_TYPE_OK=2;function _noop$1(){}var Resource2=function(){Resource4.setExtensionLoadType=function(extname,loadType){setExtMap(Resource4._loadTypeMap,extname,loadType)},Resource4.setExtensionXhrType=function(extname,xhrType){setExtMap(Resource4._xhrTypeMap,extname,xhrType)};function Resource4(name,url3,options){if(typeof name!="string"||typeof url3!="string")throw new Error("Both name and url are required for constructing a resource.");options=options||{},this._flags=0,this._setFlag(Resource4.STATUS_FLAGS.DATA_URL,url3.indexOf("data:")===0),this.name=name,this.url=url3,this.extension=this._getExtension(),this.data=null,this.crossOrigin=options.crossOrigin===!0?"anonymous":options.crossOrigin,this.timeout=options.timeout||0,this.loadType=options.loadType||this._determineLoadType(),this.xhrType=options.xhrType,this.metadata=options.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=Resource4.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new import_mini_signals.default,this.onProgress=new import_mini_signals.default,this.onComplete=new import_mini_signals.default,this.onAfterMiddleware=new import_mini_signals.default}var _proto=Resource4.prototype;return _proto.complete=function(){this._clearEvents(),this._finish()},_proto.abort=function(message){if(!this.error){if(this.error=new Error(message),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=Resource4.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},_proto.load=function(cb){var _this=this;if(!this.isLoading){if(this.isComplete){cb&&setTimeout(function(){return cb(_this)},1);return}else cb&&this.onComplete.once(cb);switch(this._setFlag(Resource4.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case Resource4.LOAD_TYPE.IMAGE:this.type=Resource4.TYPE.IMAGE,this._loadElement("image");break;case Resource4.LOAD_TYPE.AUDIO:this.type=Resource4.TYPE.AUDIO,this._loadSourceElement("audio");break;case Resource4.LOAD_TYPE.VIDEO:this.type=Resource4.TYPE.VIDEO,this._loadSourceElement("video");break;case Resource4.LOAD_TYPE.XHR:default:useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},_proto._hasFlag=function(flag){return(this._flags&flag)!=0},_proto._setFlag=function(flag,value){this._flags=value?this._flags|flag:this._flags&~flag},_proto._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},_proto._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(Resource4.STATUS_FLAGS.COMPLETE,!0),this._setFlag(Resource4.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},_proto._loadElement=function(type){this.metadata.loadElement?this.data=this.metadata.loadElement:type==="image"&&typeof window.Image!="undefined"?this.data=new Image:this.data=document.createElement(type),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},_proto._loadSourceElement=function(type){if(this.metadata.loadElement?this.data=this.metadata.loadElement:type==="audio"&&typeof window.Audio!="undefined"?this.data=new Audio:this.data=document.createElement(type),this.data===null){this.abort("Unsupported element: "+type);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var mimeTypes=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes));else{var _mimeTypes=this.metadata.mimeType;this.data.appendChild(this._createSource(type,this.url,Array.isArray(_mimeTypes)?_mimeTypes[0]:_mimeTypes))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},_proto._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,!0),xhr.timeout=this.timeout,this.xhrType===Resource4.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource4.XHR_RESPONSE_TYPE.DOCUMENT?xhr.responseType=Resource4.XHR_RESPONSE_TYPE.TEXT:xhr.responseType=this.xhrType,xhr.addEventListener("error",this._boundXhrOnError,!1),xhr.addEventListener("timeout",this._boundXhrOnTimeout,!1),xhr.addEventListener("abort",this._boundXhrOnAbort,!1),xhr.addEventListener("progress",this._boundOnProgress,!1),xhr.addEventListener("load",this._boundXhrOnLoad,!1),xhr.send()},_proto._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var xdr=this.xhr=new XDomainRequest;xdr.timeout=this.timeout||5e3,xdr.onerror=this._boundXhrOnError,xdr.ontimeout=this._boundXhrOnTimeout,xdr.onprogress=this._boundOnProgress,xdr.onload=this._boundXhrOnLoad,xdr.open("GET",this.url,!0),setTimeout(function(){return xdr.send()},1)},_proto._createSource=function(type,url3,mime){mime||(mime=type+"/"+this._getExtension(url3));var source=document.createElement("source");return source.src=url3,source.type=mime,source},_proto._onError=function(event){this.abort("Failed to load element using: "+event.target.nodeName)},_proto._onProgress=function(event){event&&event.lengthComputable&&this.onProgress.dispatch(this,event.loaded/event.total)},_proto._onTimeout=function(){this.abort("Load timed out.")},_proto._xhrOnError=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+', text: "'+xhr.statusText+'"')},_proto._xhrOnTimeout=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request timed out.")},_proto._xhrOnAbort=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request was aborted by the user.")},_proto._xhrOnLoad=function(){var xhr=this.xhr,text="",status=typeof xhr.status=="undefined"?STATUS_OK:xhr.status;(xhr.responseType===""||xhr.responseType==="text"||typeof xhr.responseType=="undefined")&&(text=xhr.responseText),status===STATUS_NONE&&(text.length>0||xhr.responseType===Resource4.XHR_RESPONSE_TYPE.BUFFER)?status=STATUS_OK:status===STATUS_IE_BUG_EMPTY&&(status=STATUS_EMPTY);var statusType=status/100|0;if(statusType===STATUS_TYPE_OK)if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.TEXT)this.data=text,this.type=Resource4.TYPE.TEXT;else if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(text),this.type=Resource4.TYPE.JSON}catch(e){this.abort("Error trying to parse loaded json: "+e);return}else if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(text,"text/xml")}else{var div=document.createElement("div");div.innerHTML=text,this.data=div}this.type=Resource4.TYPE.XML}catch(e){this.abort("Error trying to parse loaded xml: "+e);return}else this.data=xhr.response||text;else{this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL);return}this.complete()},_proto._determineCrossOrigin=function(url3,loc){if(url3.indexOf("data:")===0)return"";if(window.origin!==window.location.origin)return"anonymous";loc=loc||window.location,tempAnchor2||(tempAnchor2=document.createElement("a")),tempAnchor2.href=url3,url3=(0,import_parse_uri.default)(tempAnchor2.href,{strictMode:!0});var samePort=!url3.port&&loc.port===""||url3.port===loc.port,protocol=url3.protocol?url3.protocol+":":"";return url3.host!==loc.hostname||!samePort||protocol!==loc.protocol?"anonymous":""},_proto._determineXhrType=function(){return Resource4._xhrTypeMap[this.extension]||Resource4.XHR_RESPONSE_TYPE.TEXT},_proto._determineLoadType=function(){return Resource4._loadTypeMap[this.extension]||Resource4.LOAD_TYPE.XHR},_proto._getExtension=function(){var url3=this.url,ext="";if(this.isDataUrl){var slashIndex=url3.indexOf("/");ext=url3.substring(slashIndex+1,url3.indexOf(";",slashIndex))}else{var queryStart=url3.indexOf("?"),hashStart=url3.indexOf("#"),index3=Math.min(queryStart>-1?queryStart:url3.length,hashStart>-1?hashStart:url3.length);url3=url3.substring(0,index3),ext=url3.substring(url3.lastIndexOf(".")+1)}return ext.toLowerCase()},_proto._getMimeFromXhrType=function(type){switch(type){case Resource4.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource4.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource4.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource4.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource4.XHR_RESPONSE_TYPE.DEFAULT:case Resource4.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},_createClass(Resource4,[{key:"isDataUrl",get:function(){return this._hasFlag(Resource4.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(Resource4.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(Resource4.STATUS_FLAGS.LOADING)}}]),Resource4}();Resource2.STATUS_FLAGS={NONE:0,DATA_URL:1<<0,COMPLETE:1<<1,LOADING:1<<2};Resource2.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};Resource2.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};Resource2.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};Resource2._loadTypeMap={gif:Resource2.LOAD_TYPE.IMAGE,png:Resource2.LOAD_TYPE.IMAGE,bmp:Resource2.LOAD_TYPE.IMAGE,jpg:Resource2.LOAD_TYPE.IMAGE,jpeg:Resource2.LOAD_TYPE.IMAGE,tif:Resource2.LOAD_TYPE.IMAGE,tiff:Resource2.LOAD_TYPE.IMAGE,webp:Resource2.LOAD_TYPE.IMAGE,tga:Resource2.LOAD_TYPE.IMAGE,svg:Resource2.LOAD_TYPE.IMAGE,"svg+xml":Resource2.LOAD_TYPE.IMAGE,mp3:Resource2.LOAD_TYPE.AUDIO,ogg:Resource2.LOAD_TYPE.AUDIO,wav:Resource2.LOAD_TYPE.AUDIO,mp4:Resource2.LOAD_TYPE.VIDEO,webm:Resource2.LOAD_TYPE.VIDEO};Resource2._xhrTypeMap={xhtml:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource2.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource2.XHR_RESPONSE_TYPE.BLOB,png:Resource2.XHR_RESPONSE_TYPE.BLOB,bmp:Resource2.XHR_RESPONSE_TYPE.BLOB,jpg:Resource2.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource2.XHR_RESPONSE_TYPE.BLOB,tif:Resource2.XHR_RESPONSE_TYPE.BLOB,tiff:Resource2.XHR_RESPONSE_TYPE.BLOB,webp:Resource2.XHR_RESPONSE_TYPE.BLOB,tga:Resource2.XHR_RESPONSE_TYPE.BLOB,json:Resource2.XHR_RESPONSE_TYPE.JSON,text:Resource2.XHR_RESPONSE_TYPE.TEXT,txt:Resource2.XHR_RESPONSE_TYPE.TEXT,ttf:Resource2.XHR_RESPONSE_TYPE.BUFFER,otf:Resource2.XHR_RESPONSE_TYPE.BUFFER};Resource2.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function setExtMap(map4,extname,val){extname&&extname.indexOf(".")===0&&(extname=extname.substring(1)),!!extname&&(map4[extname]=val)}function reqType(xhr){return xhr.toString().replace("object ","")}var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(input){for(var output="",inx=0;inx<input.length;){for(var bytebuffer=[0,0,0],encodedCharIndexes=[0,0,0,0],jnx=0;jnx<bytebuffer.length;++jnx)inx<input.length?bytebuffer[jnx]=input.charCodeAt(inx++)&255:bytebuffer[jnx]=0;encodedCharIndexes[0]=bytebuffer[0]>>2,encodedCharIndexes[1]=(bytebuffer[0]&3)<<4|bytebuffer[1]>>4,encodedCharIndexes[2]=(bytebuffer[1]&15)<<2|bytebuffer[2]>>6,encodedCharIndexes[3]=bytebuffer[2]&63;var paddingBytes=inx-(input.length-1);switch(paddingBytes){case 2:encodedCharIndexes[3]=64,encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64;break;default:break}for(var _jnx=0;_jnx<encodedCharIndexes.length;++_jnx)output+=_keyStr.charAt(encodedCharIndexes[_jnx])}return output}var Url=window.URL||window.webkitURL;function parsing(resource,next){if(!resource.data){next();return}if(resource.xhr&&resource.xhrType===Resource2.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof resource.data=="string"){var type=resource.xhr.getResponseHeader("content-type");if(type&&type.indexOf("image")===0){resource.data=new Image,resource.data.src="data:"+type+";base64,"+encodeBinary(resource.xhr.responseText),resource.type=Resource2.TYPE.IMAGE,resource.data.onload=function(){resource.data.onload=null,next()};return}}else if(resource.data.type.indexOf("image")===0){var src=Url.createObjectURL(resource.data);resource.blob=resource.data,resource.data=new Image,resource.data.src=src,resource.type=Resource2.TYPE.IMAGE,resource.data.onload=function(){Url.revokeObjectURL(src),resource.data.onload=null,next()};return}}next()}var index2={caching,parsing},MAX_PROGRESS=100,rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=function(){function Loader3(baseUrl,concurrency){var _this=this;baseUrl===void 0&&(baseUrl=""),concurrency===void 0&&(concurrency=10),this.baseUrl=baseUrl,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(r,d){return _this._loadResource(r,d)},this._queue=queue(this._boundLoadResource,concurrency),this._queue.pause(),this.resources={},this.onProgress=new import_mini_signals.default,this.onError=new import_mini_signals.default,this.onLoad=new import_mini_signals.default,this.onStart=new import_mini_signals.default,this.onComplete=new import_mini_signals.default;for(var i=0;i<Loader3._defaultBeforeMiddleware.length;++i)this.pre(Loader3._defaultBeforeMiddleware[i]);for(var _i=0;_i<Loader3._defaultAfterMiddleware.length;++_i)this.use(Loader3._defaultAfterMiddleware[_i])}var _proto=Loader3.prototype;return _proto.add=function(name,url3,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i)this.add(name[i]);return this}if(typeof name=="object"&&(cb=url3||name.callback||name.onComplete,options=name,url3=name.url,name=name.name||name.key||name.url),typeof url3!="string"&&(cb=options,options=url3,url3=name),typeof url3!="string")throw new Error("No url passed to add resource to loader.");if(typeof options=="function"&&(cb=options,options=null),this.loading&&(!options||!options.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[name])throw new Error('Resource named "'+name+'" already exists.');if(url3=this._prepareUrl(url3),this.resources[name]=new Resource2(name,url3,options),typeof cb=="function"&&this.resources[name].onAfterMiddleware.once(cb),this.loading){for(var parent=options.parentResource,incompleteChildren=[],_i2=0;_i2<parent.children.length;++_i2)parent.children[_i2].isComplete||incompleteChildren.push(parent.children[_i2]);var fullChunk=parent.progressChunk*(incompleteChildren.length+1),eachChunk=fullChunk/(incompleteChildren.length+2);parent.children.push(this.resources[name]),parent.progressChunk=eachChunk;for(var _i3=0;_i3<incompleteChildren.length;++_i3)incompleteChildren[_i3].progressChunk=eachChunk;this.resources[name].progressChunk=eachChunk}return this._queue.push(this.resources[name]),this},_proto.pre=function(fn){return this._beforeMiddleware.push(fn),this},_proto.use=function(fn){return this._afterMiddleware.push(fn),this},_proto.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var k in this.resources){var res=this.resources[k];res._onLoadBinding&&res._onLoadBinding.detach(),res.isLoading&&res.abort()}return this.resources={},this},_proto.load=function(cb){if(typeof cb=="function"&&this.onComplete.once(cb),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var numTasks=this._queue._tasks.length,chunk=MAX_PROGRESS/numTasks,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=chunk;this._onStart(),this._queue.resume()}return this},_proto._prepareUrl=function(url3){var parsedUrl=(0,import_parse_uri.default)(url3,{strictMode:!0}),result;if(parsedUrl.protocol||!parsedUrl.path||url3.indexOf("//")===0?result=url3:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&url3.charAt(0)!=="/"?result=this.baseUrl+"/"+url3:result=this.baseUrl+url3,this.defaultQueryString){var hash=rgxExtractUrlHash.exec(result)[0];result=result.substr(0,result.length-hash.length),result.indexOf("?")!==-1?result+="&"+this.defaultQueryString:result+="?"+this.defaultQueryString,result+=hash}return result},_proto._loadResource=function(resource,dequeue){var _this2=this;resource._dequeue=dequeue,eachSeries(this._beforeMiddleware,function(fn,next){fn.call(_this2,resource,function(){next(resource.isComplete?{}:null)})},function(){resource.isComplete?_this2._onLoad(resource):(resource._onLoadBinding=resource.onComplete.once(_this2._onLoad,_this2),resource.load())},!0)},_proto._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},_proto._onComplete=function(){this.progress=MAX_PROGRESS,this.loading=!1,this.onComplete.dispatch(this,this.resources)},_proto._onLoad=function(resource){var _this3=this;resource._onLoadBinding=null,this._resourcesParsing.push(resource),resource._dequeue(),eachSeries(this._afterMiddleware,function(fn,next){fn.call(_this3,resource,next)},function(){resource.onAfterMiddleware.dispatch(resource),_this3.progress=Math.min(MAX_PROGRESS,_this3.progress+resource.progressChunk),_this3.onProgress.dispatch(_this3,resource),resource.error?_this3.onError.dispatch(resource.error,_this3,resource):_this3.onLoad.dispatch(_this3,resource),_this3._resourcesParsing.splice(_this3._resourcesParsing.indexOf(resource),1),_this3._queue.idle()&&_this3._resourcesParsing.length===0&&_this3._onComplete()},!0)},_createClass(Loader3,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(concurrency){this._queue.concurrency=concurrency}}]),Loader3}();Loader._defaultBeforeMiddleware=[];Loader._defaultAfterMiddleware=[];Loader.pre=function(fn){return Loader._defaultBeforeMiddleware.push(fn),Loader};Loader.use=function(fn){return Loader._defaultAfterMiddleware.push(fn),Loader};var extendStatics4=function(d,b){return extendStatics4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics4(d,b)};function __extends4(d,b){extendStatics4(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var TextureLoader=function(){function TextureLoader2(){}return TextureLoader2.add=function(){Resource2.setExtensionLoadType("svg",Resource2.LOAD_TYPE.XHR),Resource2.setExtensionXhrType("svg",Resource2.XHR_RESPONSE_TYPE.TEXT)},TextureLoader2.use=function(resource,next){if(resource.data&&(resource.type===Resource2.TYPE.IMAGE||resource.extension==="svg")){var data=resource.data,url3=resource.url,name=resource.name,metadata=resource.metadata;Texture.fromLoader(data,url3,name,metadata).then(function(texture){resource.texture=texture,next()}).catch(next)}else next()},TextureLoader2}(),Loader2=function(_super){__extends4(Loader3,_super);function Loader3(baseUrl,concurrency){for(var _this=_super.call(this,baseUrl,concurrency)||this,i=0;i<Loader3._plugins.length;++i){var plugin=Loader3._plugins[i],pre=plugin.pre,use=plugin.use;pre&&_this.pre(pre),use&&_this.use(use)}return _this._protected=!1,_this}return Loader3.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(Loader3,"shared",{get:function(){var shared=Loader3._shared;return shared||(shared=new Loader3,shared._protected=!0,Loader3._shared=shared),shared},enumerable:!1,configurable:!0}),Loader3.registerPlugin=function(plugin){return Loader3._plugins.push(plugin),plugin.add&&plugin.add(),Loader3},Loader3._plugins=[],Loader3}(Loader);Loader2.registerPlugin({use:index2.parsing});Loader2.registerPlugin(TextureLoader);var AppLoaderPlugin=function(){function AppLoaderPlugin2(){}return AppLoaderPlugin2.init=function(options){options=Object.assign({sharedLoader:!1},options),this.loader=options.sharedLoader?Loader2.shared:new Loader2},AppLoaderPlugin2.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},AppLoaderPlugin2}(),LoaderResource=Resource2;var _a,INTERNAL_FORMATS;(function(INTERNAL_FORMATS2){INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"})(INTERNAL_FORMATS||(INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=(_a={},_a[INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a[INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a);var extendStatics5=function(d,b){return extendStatics5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics5(d,b)};function __extends5(d,b){extendStatics5(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve4,reject2){function fulfilled(value){try{step(generator.next(value))}catch(e){reject2(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject2(e)}}function step(result){result.done?resolve4(result.value):new P(function(resolve5){resolve5(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}}var BlobResource=function(_super){__extends5(BlobResource2,_super);function BlobResource2(source,options){options===void 0&&(options={width:1,height:1,autoLoad:!0});var _this=this,origin,data;return typeof source=="string"?(origin=source,data=new Uint8Array):(origin=null,data=source),_this=_super.call(this,data,options)||this,_this.origin=origin,_this.buffer=data?new ViewableBuffer(data):null,_this.origin&&options.autoLoad!==!1&&_this.load(),data&&data.length&&(_this.loaded=!0,_this.onBlobLoaded(_this.buffer.rawBinaryData)),_this}return BlobResource2.prototype.onBlobLoaded=function(_data){},BlobResource2.prototype.load=function(){return __awaiter(this,void 0,Promise,function(){var response2,blob,arrayBuffer;return __generator(this,function(_a3){switch(_a3.label){case 0:return[4,fetch(this.origin)];case 1:return response2=_a3.sent(),[4,response2.blob()];case 2:return blob=_a3.sent(),[4,blob.arrayBuffer()];case 3:return arrayBuffer=_a3.sent(),this.data=new Uint32Array(arrayBuffer),this.buffer=new ViewableBuffer(arrayBuffer),this.loaded=!0,this.onBlobLoaded(arrayBuffer),this.update(),[2,this]}})})},BlobResource2}(BufferResource),CompressedTextureResource=function(_super){__extends5(CompressedTextureResource2,_super);function CompressedTextureResource2(source,options){var _this=_super.call(this,source,options)||this;return _this.format=options.format,_this.levels=options.levels||1,_this._width=options.width,_this._height=options.height,_this._extension=CompressedTextureResource2._formatToExtension(_this.format),(options.levelBuffers||_this.buffer)&&(_this._levelBuffers=options.levelBuffers||CompressedTextureResource2._createLevelBuffers(source instanceof Uint8Array?source:_this.buffer.uint8View,_this.format,_this.levels,4,4,_this.width,_this.height)),_this}return CompressedTextureResource2.prototype.upload=function(renderer,_texture,_glTexture){var gl=renderer.gl,extension=renderer.context.extensions[this._extension];if(!extension)throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var i=0,j=this.levels;i<j;i++){var _a3=this._levelBuffers[i],levelID=_a3.levelID,levelWidth=_a3.levelWidth,levelHeight=_a3.levelHeight,levelBuffer=_a3.levelBuffer;gl.compressedTexImage2D(gl.TEXTURE_2D,levelID,this.format,levelWidth,levelHeight,0,levelBuffer)}return!0},CompressedTextureResource2.prototype.onBlobLoaded=function(){this._levelBuffers=CompressedTextureResource2._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},CompressedTextureResource2._formatToExtension=function(format3){if(format3>=33776&&format3<=33779)return"s3tc";if(format3>=37488&&format3<=37497)return"etc";if(format3>=35840&&format3<=35843)return"pvrtc";if(format3>=36196)return"etc1";if(format3>=35986&&format3<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},CompressedTextureResource2._createLevelBuffers=function(buffer,format3,levels,blockWidth,blockHeight,imageWidth,imageHeight){for(var buffers=new Array(levels),offset=buffer.byteOffset,levelWidth=imageWidth,levelHeight=imageHeight,alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1),alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1),levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format3],i=0;i<levels;i++)buffers[i]={levelID:i,levelWidth:levels>1?levelWidth:alignedLevelWidth,levelHeight:levels>1?levelHeight:alignedLevelHeight,levelBuffer:new Uint8Array(buffer.buffer,offset,levelSize)},offset+=levelSize,levelWidth=levelWidth>>1||1,levelHeight=levelHeight>>1||1,alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1),alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1),levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format3];return buffers},CompressedTextureResource2}(BlobResource),CompressedTextureLoader=function(){function CompressedTextureLoader2(){}return CompressedTextureLoader2.use=function(resource,next){var data=resource.data,loader=this;if(resource.type===LoaderResource.TYPE.JSON&&data&&data.cacheID&&data.textures){for(var textures=data.textures,textureURL=void 0,fallbackURL=void 0,i=0,j=textures.length;i<j;i++){var texture=textures[i],url_1=texture.src,format3=texture.format;if(format3||(fallbackURL=url_1),CompressedTextureLoader2.textureFormats[format3]){textureURL=url_1;break}}if(textureURL=textureURL||fallbackURL,!textureURL){next(new Error("Cannot load compressed-textures in "+resource.url+", make sure you provide a fallback"));return}if(textureURL===resource.url){next(new Error("URL of compressed texture cannot be the same as the manifest's URL"));return}var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource},resourcePath=url.resolve(resource.url.replace(loader.baseUrl,""),textureURL),resourceName=data.cacheID;loader.add(resourceName,resourcePath,loadOptions,function(res){if(res.error){next(res.error);return}var _a3=res.texture,texture2=_a3===void 0?null:_a3,_b2=res.textures,textures2=_b2===void 0?{}:_b2;Object.assign(resource,{texture:texture2,textures:textures2}),next()})}else next()},CompressedTextureLoader2.add=function(){var canvas2=document.createElement("canvas"),gl=canvas2.getContext("webgl");if(!gl){console.error("WebGL not available for compressed textures. Silently failing.");return}var extensions={s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};CompressedTextureLoader2.textureExtensions=extensions,CompressedTextureLoader2.textureFormats={};for(var extensionName in extensions){var extension=extensions[extensionName];!extension||Object.assign(CompressedTextureLoader2.textureFormats,Object.getPrototypeOf(extension))}},CompressedTextureLoader2}();function registerCompressedTextures(url3,resources3,metadata){var result={textures:{},texture:null};if(!resources3)return result;var textures=resources3.map(function(resource){return new Texture(new BaseTexture(resource,Object.assign({mipmap:MIPMAP_MODES2.OFF,alphaMode:ALPHA_MODES2.NO_PREMULTIPLIED_ALPHA},metadata)))});return textures.forEach(function(texture,i){var baseTexture=texture.baseTexture,cacheID=url3+"-"+(i+1);BaseTexture.addToCache(baseTexture,cacheID),Texture.addToCache(texture,cacheID),i===0&&(BaseTexture.addToCache(baseTexture,url3),Texture.addToCache(texture,url3),result.texture=texture),result.textures[cacheID]=texture}),result}var _a$1,_b;LoaderResource.setExtensionXhrType("dds",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},DXGI_FORMAT;(function(DXGI_FORMAT2){DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",DXGI_FORMAT2[DXGI_FORMAT2.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"})(DXGI_FORMAT||(DXGI_FORMAT={}));var D3D10_RESOURCE_DIMENSION;(function(D3D10_RESOURCE_DIMENSION2){D3D10_RESOURCE_DIMENSION2[D3D10_RESOURCE_DIMENSION2.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",D3D10_RESOURCE_DIMENSION2[D3D10_RESOURCE_DIMENSION2.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",D3D10_RESOURCE_DIMENSION2[D3D10_RESOURCE_DIMENSION2.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"})(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT=(_a$1={},_a$1[FOURCC_DXT1]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[FOURCC_DXT3]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[FOURCC_DXT5]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=(_b={},_b[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b),DDSLoader=function(){function DDSLoader2(){}return DDSLoader2.use=function(resource,next){if(resource.extension==="dds"&&resource.data)try{Object.assign(resource,registerCompressedTextures(resource.name||resource.url,DDSLoader2.parse(resource.data),resource.metadata))}catch(err){next(err);return}next()},DDSLoader2.parse=function(arrayBuffer){var data=new Uint32Array(arrayBuffer),magicWord=data[0];if(magicWord!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");var header=new Uint32Array(arrayBuffer,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),height=header[DDS_FIELDS.HEIGHT],width=header[DDS_FIELDS.WIDTH],mipmapCount=header[DDS_FIELDS.MIPMAP_COUNT],pixelFormat=new Uint32Array(arrayBuffer,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),formatFlags=pixelFormat[PF_FLAGS];if(formatFlags&DDPF_FOURCC){var fourCC=pixelFormat[DDS_PF_FIELDS.FOURCC];if(fourCC!==FOURCC_DX10){var internalFormat_1=FOURCC_TO_FORMAT[fourCC],dataOffset_1=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,texData=new Uint8Array(arrayBuffer,dataOffset_1),resource=new CompressedTextureResource(texData,{format:internalFormat_1,width,height,levels:mipmapCount});return[resource]}var dx10Offset=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,dx10Header=new Uint32Array(data.buffer,dx10Offset,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),dxgiFormat=dx10Header[DDS_DX10_FIELDS.DXGI_FORMAT],resourceDimension=dx10Header[DDS_DX10_FIELDS.RESOURCE_DIMENSION],miscFlag=dx10Header[DDS_DX10_FIELDS.MISC_FLAG],arraySize=dx10Header[DDS_DX10_FIELDS.ARRAY_SIZE],internalFormat_2=DXGI_TO_FORMAT[dxgiFormat];if(internalFormat_2===void 0)throw new Error("DDSLoader cannot parse texture data with DXGI format "+dxgiFormat);if(miscFlag===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSLoader does not support cubemap textures");if(resourceDimension===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var imageBuffers=new Array,dataOffset=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(arraySize===1)imageBuffers.push(new Uint8Array(arrayBuffer,dataOffset));else{for(var pixelSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[internalFormat_2],imageSize=0,levelWidth=width,levelHeight=height,i=0;i<mipmapCount;i++){var alignedLevelWidth=Math.max(1,levelWidth+3&~3),alignedLevelHeight=Math.max(1,levelHeight+3&~3),levelSize=alignedLevelWidth*alignedLevelHeight*pixelSize;imageSize+=levelSize,levelWidth=levelWidth>>>1,levelHeight=levelHeight>>>1}for(var imageOffset=dataOffset,i=0;i<arraySize;i++)imageBuffers.push(new Uint8Array(arrayBuffer,imageOffset,imageSize)),imageOffset+=imageSize}return imageBuffers.map(function(buffer){return new CompressedTextureResource(buffer,{format:internalFormat_2,width,height,levels:mipmapCount})})}throw formatFlags&DDPF_RGB?new Error("DDSLoader does not support uncompressed texture data."):formatFlags&DDPF_YUV?new Error("DDSLoader does not supported YUV uncompressed texture data."):formatFlags&DDPF_LUMINANCE?new Error("DDSLoader does not support single-channel (lumninance) texture data!"):formatFlags&DDPF_ALPHA?new Error("DDSLoader does not support single-channel (alpha) texture data!"):new Error("DDSLoader failed to load a texture file due to an unknown reason!")},DDSLoader2}(),_a$2,_b$1,_c;LoaderResource.setExtensionXhrType("ktx",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT=(_a$2={},_a$2[TYPES2.UNSIGNED_BYTE]=1,_a$2[TYPES2.UNSIGNED_SHORT]=2,_a$2[TYPES2.FLOAT]=4,_a$2[TYPES2.HALF_FLOAT]=8,_a$2),FORMATS_TO_COMPONENTS=(_b$1={},_b$1[FORMATS2.RGBA]=4,_b$1[FORMATS2.RGB]=3,_b$1[FORMATS2.LUMINANCE]=1,_b$1[FORMATS2.LUMINANCE_ALPHA]=2,_b$1[FORMATS2.ALPHA]=1,_b$1),TYPES_TO_BYTES_PER_PIXEL=(_c={},_c[TYPES2.UNSIGNED_SHORT_4_4_4_4]=2,_c[TYPES2.UNSIGNED_SHORT_5_5_5_1]=2,_c[TYPES2.UNSIGNED_SHORT_5_6_5]=2,_c),KTXLoader=function(){function KTXLoader2(){}return KTXLoader2.use=function(resource,next){if(resource.extension==="ktx"&&resource.data)try{var url3=resource.name||resource.url;Object.assign(resource,registerCompressedTextures(url3,KTXLoader2.parse(url3,resource.data),resource.metadata))}catch(err){next(err);return}next()},KTXLoader2.parse=function(url3,arrayBuffer){var dataView=new DataView(arrayBuffer);if(!KTXLoader2.validate(url3,dataView))return null;var littleEndian=dataView.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,glType=dataView.getUint32(KTX_FIELDS.GL_TYPE,littleEndian),glFormat=dataView.getUint32(KTX_FIELDS.GL_FORMAT,littleEndian),glInternalFormat=dataView.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,littleEndian),pixelWidth=dataView.getUint32(KTX_FIELDS.PIXEL_WIDTH,littleEndian),pixelHeight=dataView.getUint32(KTX_FIELDS.PIXEL_HEIGHT,littleEndian)||1,pixelDepth=dataView.getUint32(KTX_FIELDS.PIXEL_DEPTH,littleEndian)||1,numberOfArrayElements=dataView.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,littleEndian)||1,numberOfFaces=dataView.getUint32(KTX_FIELDS.NUMBER_OF_FACES,littleEndian),numberOfMipmapLevels=dataView.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,littleEndian),bytesOfKeyValueData=dataView.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,littleEndian);if(pixelHeight===0||pixelDepth!==1)throw new Error("Only 2D textures are supported");if(numberOfFaces!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(numberOfArrayElements!==1)throw new Error("WebGL does not support array textures");var blockWidth=4,blockHeight=4,alignedWidth=pixelWidth+3&~3,alignedHeight=pixelHeight+3&~3,imageBuffers=new Array(numberOfArrayElements),imagePixels=pixelWidth*pixelHeight;glType===0&&(imagePixels=alignedWidth*alignedHeight);var imagePixelByteSize;if(glType!==0?TYPES_TO_BYTES_PER_COMPONENT[glType]?imagePixelByteSize=TYPES_TO_BYTES_PER_COMPONENT[glType]*FORMATS_TO_COMPONENTS[glFormat]:imagePixelByteSize=TYPES_TO_BYTES_PER_PIXEL[glType]:imagePixelByteSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[glInternalFormat],imagePixelByteSize===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var imageByteSize=imagePixels*imagePixelByteSize,mipByteSize=imageByteSize,mipWidth=pixelWidth,mipHeight=pixelHeight,alignedMipWidth=alignedWidth,alignedMipHeight=alignedHeight,imageOffset=FILE_HEADER_SIZE+bytesOfKeyValueData,mipmapLevel=0;mipmapLevel<numberOfMipmapLevels;mipmapLevel++){for(var imageSize=dataView.getUint32(imageOffset,littleEndian),elementOffset=imageOffset+4,arrayElement=0;arrayElement<numberOfArrayElements;arrayElement++){var mips=imageBuffers[arrayElement];mips||(mips=imageBuffers[arrayElement]=new Array(numberOfMipmapLevels)),mips[mipmapLevel]={levelID:mipmapLevel,levelWidth:numberOfMipmapLevels>1?mipWidth:alignedMipWidth,levelHeight:numberOfMipmapLevels>1?mipHeight:alignedMipHeight,levelBuffer:new Uint8Array(arrayBuffer,elementOffset,mipByteSize)},elementOffset+=mipByteSize}imageOffset+=imageSize+4,imageOffset=imageOffset%4!=0?imageOffset+4-imageOffset%4:imageOffset,mipWidth=mipWidth>>1||1,mipHeight=mipHeight>>1||1,alignedMipWidth=mipWidth+blockWidth-1&~(blockWidth-1),alignedMipHeight=mipHeight+blockHeight-1&~(blockHeight-1),mipByteSize=alignedMipWidth*alignedMipHeight*imagePixelByteSize}if(glType!==0)throw new Error("TODO: Uncompressed");return imageBuffers.map(function(levelBuffers){return new CompressedTextureResource(null,{format:glInternalFormat,width:pixelWidth,height:pixelHeight,levels:numberOfMipmapLevels,levelBuffers})})},KTXLoader2.validate=function(url3,dataView){for(var i=0;i<FILE_IDENTIFIER.length;i++)if(dataView.getUint8(i)!==FILE_IDENTIFIER[i])return console.error(url3+" is not a valid *.ktx file!"),!1;return!0},KTXLoader2}();var extendStatics6=function(d,b){return extendStatics6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics6(d,b)};function __extends6(d,b){extendStatics6(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var ParticleContainer=function(_super){__extends6(ParticleContainer2,_super);function ParticleContainer2(maxSize,properties,batchSize,autoResize){maxSize===void 0&&(maxSize=1500),batchSize===void 0&&(batchSize=16384),autoResize===void 0&&(autoResize=!1);var _this=_super.call(this)||this,maxBatchSize=16384;return batchSize>maxBatchSize&&(batchSize=maxBatchSize),_this._properties=[!1,!0,!1,!1,!1],_this._maxSize=maxSize,_this._batchSize=batchSize,_this._buffers=null,_this._bufferUpdateIDs=[],_this._updateID=0,_this.interactiveChildren=!1,_this.blendMode=BLEND_MODES2.NORMAL,_this.autoResize=autoResize,_this.roundPixels=!0,_this.baseTexture=null,_this.setProperties(properties),_this._tint=0,_this.tintRgb=new Float32Array(4),_this.tint=16777215,_this}return ParticleContainer2.prototype.setProperties=function(properties){properties&&(this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0],this._properties[1]="position"in properties?!!properties.position:this._properties[1],this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2],this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3],this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4])},ParticleContainer2.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(ParticleContainer2.prototype,"tint",{get:function(){return this._tint},set:function(value){this._tint=value,hex2rgb(value,this.tintRgb)},enumerable:!1,configurable:!0}),ParticleContainer2.prototype.render=function(renderer){var _this=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return _this.onChildrenChange(0)})),renderer.batch.setObjectRenderer(renderer.plugins.particle),renderer.plugins.particle.render(this))},ParticleContainer2.prototype.onChildrenChange=function(smallestChildIndex){for(var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);this._bufferUpdateIDs.length<bufferIndex;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[bufferIndex]=++this._updateID},ParticleContainer2.prototype.dispose=function(){if(this._buffers){for(var i=0;i<this._buffers.length;++i)this._buffers[i].destroy();this._buffers=null}},ParticleContainer2.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},ParticleContainer2}(Container),ParticleBuffer=function(){function ParticleBuffer2(properties,dynamicPropertyFlags,size){this.geometry=new Geometry,this.indexBuffer=null,this.size=size,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attributeName:property.attributeName,size:property.size,uploadFunction:property.uploadFunction,type:property.type||TYPES2.FLOAT,offset:property.offset},dynamicPropertyFlags[i]?this.dynamicProperties.push(property):this.staticProperties.push(property)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return ParticleBuffer2.prototype.initBuffers=function(){var geometry=this.geometry,dynamicOffset=0;this.indexBuffer=new Buffer2(createIndicesForQuads(this.size),!0,!0),geometry.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];property.offset=dynamicOffset,dynamicOffset+=property.size,this.dynamicStride+=property.size}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer),this.dynamicDataUint32=new Uint32Array(dynBuffer),this.dynamicBuffer=new Buffer2(this.dynamicData,!1,!1);var staticOffset=0;this.staticStride=0;for(var i=0;i<this.staticProperties.length;++i){var property=this.staticProperties[i];property.offset=staticOffset,staticOffset+=property.size,this.staticStride+=property.size}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer),this.staticDataUint32=new Uint32Array(statBuffer),this.staticBuffer=new Buffer2(this.staticData,!0,!1);for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];geometry.addAttribute(property.attributeName,this.dynamicBuffer,0,property.type===TYPES2.UNSIGNED_BYTE,property.type,this.dynamicStride*4,property.offset*4)}for(var i=0;i<this.staticProperties.length;++i){var property=this.staticProperties[i];geometry.addAttribute(property.attributeName,this.staticBuffer,0,property.type===TYPES2.UNSIGNED_BYTE,property.type,this.staticStride*4,property.offset*4)}},ParticleBuffer2.prototype.uploadDynamic=function(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.type===TYPES2.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer._updateID++},ParticleBuffer2.prototype.uploadStatic=function(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.type===TYPES2.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer._updateID++},ParticleBuffer2.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},ParticleBuffer2}(),fragment2=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,ParticleRenderer=function(_super){__extends6(ParticleRenderer2,_super);function ParticleRenderer2(renderer){var _this=_super.call(this,renderer)||this;return _this.shader=null,_this.properties=null,_this.tempMatrix=new Matrix,_this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:_this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:_this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:_this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:_this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES2.UNSIGNED_BYTE,uploadFunction:_this.uploadTint,offset:0}],_this.shader=Shader.from(vertex2,fragment2,{}),_this.state=State.for2d(),_this}return ParticleRenderer2.prototype.render=function(container){var children=container.children,maxSize=container._maxSize,batchSize=container._batchSize,renderer=this.renderer,totalChildren=children.length;if(totalChildren!==0){totalChildren>maxSize&&!container.autoResize&&(totalChildren=maxSize);var buffers=container._buffers;buffers||(buffers=container._buffers=this.generateBuffers(container));var baseTexture=children[0]._texture.baseTexture;this.state.blendMode=correctBlendMode(container.blendMode,baseTexture.alphaMode),renderer.state.set(this.state);var gl=renderer.gl,m=container.worldTransform.copyTo(this.tempMatrix);m.prepend(renderer.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=m.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,baseTexture.alphaMode),this.shader.uniforms.uSampler=baseTexture,this.renderer.shader.bind(this.shader);for(var updateStatic=!1,i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;amount>batchSize&&(amount=batchSize),j>=buffers.length&&buffers.push(this._generateOneMoreBuffer(container));var buffer=buffers[j];buffer.uploadDynamic(children,i,amount);var bid=container._bufferUpdateIDs[j]||0;updateStatic=updateStatic||buffer._updateID<bid,updateStatic&&(buffer._updateID=container._updateID,buffer.uploadStatic(children,i,amount)),renderer.geometry.bind(buffer.geometry),gl.drawElements(gl.TRIANGLES,amount*6,gl.UNSIGNED_SHORT,0)}}},ParticleRenderer2.prototype.generateBuffers=function(container){for(var buffers=[],size=container._maxSize,batchSize=container._batchSize,dynamicPropertyFlags=container._properties,i=0;i<size;i+=batchSize)buffers.push(new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize));return buffers},ParticleRenderer2.prototype._generateOneMoreBuffer=function(container){var batchSize=container._batchSize,dynamicPropertyFlags=container._properties;return new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize)},ParticleRenderer2.prototype.uploadVertices=function(children,startIndex,amount,array,stride,offset){for(var w0=0,w1=0,h0=0,h1=0,i=0;i<amount;++i){var sprite=children[startIndex+i],texture=sprite._texture,sx=sprite.scale.x,sy=sprite.scale.y,trim=texture.trim,orig=texture.orig;trim?(w1=trim.x-sprite.anchor.x*orig.width,w0=w1+trim.width,h1=trim.y-sprite.anchor.y*orig.height,h0=h1+trim.height):(w0=orig.width*(1-sprite.anchor.x),w1=orig.width*-sprite.anchor.x,h0=orig.height*(1-sprite.anchor.y),h1=orig.height*-sprite.anchor.y),array[offset]=w1*sx,array[offset+1]=h1*sy,array[offset+stride]=w0*sx,array[offset+stride+1]=h1*sy,array[offset+stride*2]=w0*sx,array[offset+stride*2+1]=h0*sy,array[offset+stride*3]=w1*sx,array[offset+stride*3+1]=h0*sy,offset+=stride*4}},ParticleRenderer2.prototype.uploadPosition=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x,array[offset+1]=spritePosition.y,array[offset+stride]=spritePosition.x,array[offset+stride+1]=spritePosition.y,array[offset+stride*2]=spritePosition.x,array[offset+stride*2+1]=spritePosition.y,array[offset+stride*3]=spritePosition.x,array[offset+stride*3+1]=spritePosition.y,offset+=stride*4}},ParticleRenderer2.prototype.uploadRotation=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation,array[offset+stride]=spriteRotation,array[offset+stride*2]=spriteRotation,array[offset+stride*3]=spriteRotation,offset+=stride*4}},ParticleRenderer2.prototype.uploadUvs=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;textureUvs?(array[offset]=textureUvs.x0,array[offset+1]=textureUvs.y0,array[offset+stride]=textureUvs.x1,array[offset+stride+1]=textureUvs.y1,array[offset+stride*2]=textureUvs.x2,array[offset+stride*2+1]=textureUvs.y2,array[offset+stride*3]=textureUvs.x3,array[offset+stride*3+1]=textureUvs.y3,offset+=stride*4):(array[offset]=0,array[offset+1]=0,array[offset+stride]=0,array[offset+stride+1]=0,array[offset+stride*2]=0,array[offset+stride*2+1]=0,array[offset+stride*3]=0,array[offset+stride*3+1]=0,offset+=stride*4)}},ParticleRenderer2.prototype.uploadTint=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i],premultiplied=sprite._texture.baseTexture.alphaMode>0,alpha=sprite.alpha,argb=alpha<1&&premultiplied?premultiplyTint(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);array[offset]=argb,array[offset+stride]=argb,array[offset+stride*2]=argb,array[offset+stride*3]=argb,offset+=stride*4}},ParticleRenderer2.prototype.destroy=function(){_super.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},ParticleRenderer2}(ObjectRenderer);var LINE_JOIN;(function(LINE_JOIN2){LINE_JOIN2.MITER="miter",LINE_JOIN2.BEVEL="bevel",LINE_JOIN2.ROUND="round"})(LINE_JOIN||(LINE_JOIN={}));var LINE_CAP;(function(LINE_CAP2){LINE_CAP2.BUTT="butt",LINE_CAP2.ROUND="round",LINE_CAP2.SQUARE="square"})(LINE_CAP||(LINE_CAP={}));var GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(length,defaultSegments){if(defaultSegments===void 0&&(defaultSegments=20),!this.adaptive||!length||isNaN(length))return defaultSegments;var result=Math.ceil(length/this.maxLength);return result<this.minSegments?result=this.minSegments:result>this.maxSegments&&(result=this.maxSegments),result}},FillStyle=function(){function FillStyle2(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}return FillStyle2.prototype.clone=function(){var obj=new FillStyle2;return obj.color=this.color,obj.alpha=this.alpha,obj.texture=this.texture,obj.matrix=this.matrix,obj.visible=this.visible,obj},FillStyle2.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1},FillStyle2.prototype.destroy=function(){this.texture=null,this.matrix=null},FillStyle2}();var extendStatics7=function(d,b){return extendStatics7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics7(d,b)};function __extends7(d,b){extendStatics7(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var buildPoly={build:function(graphicsData){graphicsData.points=graphicsData.shape.points.slice()},triangulate:function(graphicsData,graphicsGeometry){var points=graphicsData.points,holes=graphicsData.holes,verts=graphicsGeometry.points,indices2=graphicsGeometry.indices;if(points.length>=6){for(var holeArray=[],i=0;i<holes.length;i++){var hole=holes[i];holeArray.push(points.length/2),points=points.concat(hole.points)}var triangles=(0,import_earcut.default)(points,holeArray,2);if(!triangles)return;for(var vertPos=verts.length/2,i=0;i<triangles.length;i+=3)indices2.push(triangles[i]+vertPos),indices2.push(triangles[i+1]+vertPos),indices2.push(triangles[i+2]+vertPos);for(var i=0;i<points.length;i++)verts.push(points[i])}}},buildCircle={build:function(graphicsData){var circleData=graphicsData.shape,points=graphicsData.points,x=circleData.x,y=circleData.y,width,height;if(points.length=0,graphicsData.type===SHAPES.CIRC)width=circleData.radius,height=circleData.radius;else{var ellipseData=graphicsData.shape;width=ellipseData.width,height=ellipseData.height}if(!(width===0||height===0)){var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(width+height));totalSegs/=2.3;for(var seg=Math.PI*2/totalSegs,i=0;i<totalSegs-.5;i++)points.push(x+Math.sin(-seg*i)*width,y+Math.cos(-seg*i)*height);points.push(points[0],points[1])}},triangulate:function(graphicsData,graphicsGeometry){var points=graphicsData.points,verts=graphicsGeometry.points,indices2=graphicsGeometry.indices,vertPos=verts.length/2,center=vertPos,circle=graphicsData.shape,matrix=graphicsData.matrix,x=circle.x,y=circle.y;verts.push(graphicsData.matrix?matrix.a*x+matrix.c*y+matrix.tx:x,graphicsData.matrix?matrix.b*x+matrix.d*y+matrix.ty:y);for(var i=0;i<points.length;i+=2)verts.push(points[i],points[i+1]),indices2.push(vertPos++,center,vertPos)}},buildRectangle={build:function(graphicsData){var rectData=graphicsData.shape,x=rectData.x,y=rectData.y,width=rectData.width,height=rectData.height,points=graphicsData.points;points.length=0,points.push(x,y,x+width,y,x+width,y+height,x,y+height)},triangulate:function(graphicsData,graphicsGeometry){var points=graphicsData.points,verts=graphicsGeometry.points,vertPos=verts.length/2;verts.push(points[0],points[1],points[2],points[3],points[6],points[7],points[4],points[5]),graphicsGeometry.indices.push(vertPos,vertPos+1,vertPos+2,vertPos+1,vertPos+2,vertPos+3)}};function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}function quadraticBezierCurve(fromX,fromY,cpX,cpY,toX,toY,out){out===void 0&&(out=[]);for(var n=20,points=out,xa=0,ya=0,xb=0,yb=0,x=0,y=0,i=0,j=0;i<=n;++i)j=i/n,xa=getPt(fromX,cpX,j),ya=getPt(fromY,cpY,j),xb=getPt(cpX,toX,j),yb=getPt(cpY,toY,j),x=getPt(xa,xb,j),y=getPt(ya,yb,j),points.push(x,y);return points}var buildRoundedRectangle={build:function(graphicsData){var rrectData=graphicsData.shape,points=graphicsData.points,x=rrectData.x,y=rrectData.y,width=rrectData.width,height=rrectData.height,radius=Math.max(0,Math.min(rrectData.radius,Math.min(width,height)/2));points.length=0,radius?(quadraticBezierCurve(x,y+radius,x,y,x+radius,y,points),quadraticBezierCurve(x+width-radius,y,x+width,y,x+width,y+radius,points),quadraticBezierCurve(x+width,y+height-radius,x+width,y+height,x+width-radius,y+height,points),quadraticBezierCurve(x+radius,y+height,x,y+height,x,y+height-radius,points)):points.push(x,y,x+width,y,x+width,y+height,x,y+height)},triangulate:function(graphicsData,graphicsGeometry){for(var points=graphicsData.points,verts=graphicsGeometry.points,indices2=graphicsGeometry.indices,vecPos=verts.length/2,triangles=(0,import_earcut.default)(points,null,2),i=0,j=triangles.length;i<j;i+=3)indices2.push(triangles[i]+vecPos),indices2.push(triangles[i+1]+vecPos),indices2.push(triangles[i+2]+vecPos);for(var i=0,j=points.length;i<j;i++)verts.push(points[i],points[++i])}};function square(x,y,nx,ny,innerWeight,outerWeight,clockwise,verts){var ix=x-nx*innerWeight,iy=y-ny*innerWeight,ox=x+nx*outerWeight,oy=y+ny*outerWeight,exx,eyy;clockwise?(exx=ny,eyy=-nx):(exx=-ny,eyy=nx);var eix=ix+exx,eiy=iy+eyy,eox=ox+exx,eoy=oy+eyy;return verts.push(eix,eiy),verts.push(eox,eoy),2}function round2(cx,cy,sx,sy,ex,ey,verts,clockwise){var cx2p0x=sx-cx,cy2p0y=sy-cy,angle0=Math.atan2(cx2p0x,cy2p0y),angle1=Math.atan2(ex-cx,ey-cy);clockwise&&angle0<angle1?angle0+=Math.PI*2:!clockwise&&angle0>angle1&&(angle1+=Math.PI*2);var startAngle=angle0,angleDiff=angle1-angle0,absAngleDiff=Math.abs(angleDiff),radius=Math.sqrt(cx2p0x*cx2p0x+cy2p0y*cy2p0y),segCount=(15*absAngleDiff*Math.sqrt(radius)/Math.PI>>0)+1,angleInc=angleDiff/segCount;if(startAngle+=angleInc,clockwise){verts.push(cx,cy),verts.push(sx,sy);for(var i=1,angle=startAngle;i<segCount;i++,angle+=angleInc)verts.push(cx,cy),verts.push(cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius);verts.push(cx,cy),verts.push(ex,ey)}else{verts.push(sx,sy),verts.push(cx,cy);for(var i=1,angle=startAngle;i<segCount;i++,angle+=angleInc)verts.push(cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius),verts.push(cx,cy);verts.push(ex,ey),verts.push(cx,cy)}return segCount*2}function buildNonNativeLine(graphicsData,graphicsGeometry){var shape=graphicsData.shape,points=graphicsData.points||shape.points.slice(),eps=graphicsGeometry.closePointEps;if(points.length!==0){var style=graphicsData.lineStyle,firstPoint=new Point(points[0],points[1]),lastPoint=new Point(points[points.length-2],points[points.length-1]),closedShape=shape.type!==SHAPES.POLY||shape.closeStroke,closedPath=Math.abs(firstPoint.x-lastPoint.x)<eps&&Math.abs(firstPoint.y-lastPoint.y)<eps;if(closedShape){points=points.slice(),closedPath&&(points.pop(),points.pop(),lastPoint.set(points[points.length-2],points[points.length-1]));var midPointX=(firstPoint.x+lastPoint.x)*.5,midPointY=(lastPoint.y+firstPoint.y)*.5;points.unshift(midPointX,midPointY),points.push(midPointX,midPointY)}var verts=graphicsGeometry.points,length=points.length/2,indexCount=points.length,indexStart=verts.length/2,width=style.width/2,widthSquared=width*width,miterLimitSquared=style.miterLimit*style.miterLimit,x0=points[0],y0=points[1],x1=points[2],y1=points[3],x2=0,y2=0,perpx=-(y0-y1),perpy=x0-x1,perp1x=0,perp1y=0,dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist,perpy/=dist,perpx*=width,perpy*=width;var ratio=style.alignment,innerWeight=(1-ratio)*2,outerWeight=ratio*2;closedShape||(style.cap===LINE_CAP.ROUND?indexCount+=round2(x0-perpx*(innerWeight-outerWeight)*.5,y0-perpy*(innerWeight-outerWeight)*.5,x0-perpx*innerWeight,y0-perpy*innerWeight,x0+perpx*outerWeight,y0+perpy*outerWeight,verts,!0)+2:style.cap===LINE_CAP.SQUARE&&(indexCount+=square(x0,y0,perpx,perpy,innerWeight,outerWeight,!0,verts))),verts.push(x0-perpx*innerWeight,y0-perpy*innerWeight),verts.push(x0+perpx*outerWeight,y0+perpy*outerWeight);for(var i=1;i<length-1;++i){x0=points[(i-1)*2],y0=points[(i-1)*2+1],x1=points[i*2],y1=points[i*2+1],x2=points[(i+1)*2],y2=points[(i+1)*2+1],perpx=-(y0-y1),perpy=x0-x1,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,perp1x=-(y1-y2),perp1y=x1-x2,dist=Math.sqrt(perp1x*perp1x+perp1y*perp1y),perp1x/=dist,perp1y/=dist,perp1x*=width,perp1y*=width;var dx0=x1-x0,dy0=y0-y1,dx1=x1-x2,dy1=y2-y1,cross=dy0*dx1-dy1*dx0,clockwise=cross<0;if(Math.abs(cross)<.1){verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight);continue}var c1=(-perpx+x0)*(-perpy+y1)-(-perpx+x1)*(-perpy+y0),c2=(-perp1x+x2)*(-perp1y+y1)-(-perp1x+x1)*(-perp1y+y2),px=(dx0*c2-dx1*c1)/cross,py=(dy1*c1-dy0*c2)/cross,pdist=(px-x1)*(px-x1)+(py-y1)*(py-y1),imx=x1+(px-x1)*innerWeight,imy=y1+(py-y1)*innerWeight,omx=x1-(px-x1)*outerWeight,omy=y1-(py-y1)*outerWeight,smallerInsideSegmentSq=Math.min(dx0*dx0+dy0*dy0,dx1*dx1+dy1*dy1),insideWeight=clockwise?innerWeight:outerWeight,smallerInsideDiagonalSq=smallerInsideSegmentSq+insideWeight*insideWeight*widthSquared,insideMiterOk=pdist<=smallerInsideDiagonalSq;insideMiterOk?style.join===LINE_JOIN.BEVEL||pdist/widthSquared>miterLimitSquared?(clockwise?(verts.push(imx,imy),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),verts.push(imx,imy),verts.push(x1+perp1x*outerWeight,y1+perp1y*outerWeight)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(omx,omy),verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight),verts.push(omx,omy)),indexCount+=2):style.join===LINE_JOIN.ROUND?clockwise?(verts.push(imx,imy),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),indexCount+=round2(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,!0)+4,verts.push(imx,imy),verts.push(x1+perp1x*outerWeight,y1+perp1y*outerWeight)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(omx,omy),indexCount+=round2(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+4,verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight),verts.push(omx,omy)):(verts.push(imx,imy),verts.push(omx,omy)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),style.join===LINE_JOIN.BEVEL||pdist/widthSquared>miterLimitSquared||(style.join===LINE_JOIN.ROUND?clockwise?indexCount+=round2(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,!0)+2:indexCount+=round2(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+2:(clockwise?(verts.push(omx,omy),verts.push(omx,omy)):(verts.push(imx,imy),verts.push(imx,imy)),indexCount+=2)),verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight),verts.push(x1+perp1x*outerWeight,y1+perp1y*outerWeight),indexCount+=2)}x0=points[(length-2)*2],y0=points[(length-2)*2+1],x1=points[(length-1)*2],y1=points[(length-1)*2+1],perpx=-(y0-y1),perpy=x0-x1,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),closedShape||(style.cap===LINE_CAP.ROUND?indexCount+=round2(x1-perpx*(innerWeight-outerWeight)*.5,y1-perpy*(innerWeight-outerWeight)*.5,x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight,verts,!1)+2:style.cap===LINE_CAP.SQUARE&&(indexCount+=square(x1,y1,perpx,perpy,innerWeight,outerWeight,!1,verts)));for(var indices2=graphicsGeometry.indices,eps2=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon,i=indexStart;i<indexCount+indexStart-2;++i)x0=verts[i*2],y0=verts[i*2+1],x1=verts[(i+1)*2],y1=verts[(i+1)*2+1],x2=verts[(i+2)*2],y2=verts[(i+2)*2+1],!(Math.abs(x0*(y1-y2)+x1*(y2-y0)+x2*(y0-y1))<eps2)&&indices2.push(i,i+1,i+2)}}function buildNativeLine(graphicsData,graphicsGeometry){var i=0,shape=graphicsData.shape,points=graphicsData.points||shape.points,closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;if(points.length!==0){var verts=graphicsGeometry.points,indices2=graphicsGeometry.indices,length=points.length/2,startIndex=verts.length/2,currentIndex=startIndex;for(verts.push(points[0],points[1]),i=1;i<length;i++)verts.push(points[i*2],points[i*2+1]),indices2.push(currentIndex,currentIndex+1),currentIndex++;closedShape&&indices2.push(currentIndex,startIndex)}}function buildLine(graphicsData,graphicsGeometry){graphicsData.lineStyle.native?buildNativeLine(graphicsData,graphicsGeometry):buildNonNativeLine(graphicsData,graphicsGeometry)}var ArcUtils=function(){function ArcUtils2(){}return ArcUtils2.curveTo=function(x1,y1,x2,y2,radius,points){var fromX=points[points.length-2],fromY=points[points.length-1],a1=fromY-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0)return(points[points.length-2]!==x1||points[points.length-1]!==y1)&&points.push(x1,y1),null;var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);return{cx:cx+x1,cy:cy+y1,radius,startAngle,endAngle,anticlockwise:b1*a2>b2*a1}},ArcUtils2.arc=function(_startX,_startY,cx,cy,radius,startAngle,endAngle,_anticlockwise,points){for(var sweep=endAngle-startAngle,n=GRAPHICS_CURVES._segmentsCount(Math.abs(sweep)*radius,Math.ceil(Math.abs(sweep)/PI_2)*40),theta=sweep/(n*2),theta2=theta*2,cTheta=Math.cos(theta),sTheta=Math.sin(theta),segMinus=n-1,remainder=segMinus%1/segMinus,i=0;i<=segMinus;++i){var real=i+remainder*i,angle=theta+startAngle+theta2*real,c=Math.cos(angle),s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}},ArcUtils2}(),BezierUtils=function(){function BezierUtils2(){}return BezierUtils2.curveLength=function(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){for(var n=10,result=0,t=0,t2=0,t3=0,nt=0,nt2=0,nt3=0,x=0,y=0,dx=0,dy=0,prevX=fromX,prevY=fromY,i=1;i<=n;++i)t=i/n,t2=t*t,t3=t2*t,nt=1-t,nt2=nt*nt,nt3=nt2*nt,x=nt3*fromX+3*nt2*t*cpX+3*nt*t2*cpX2+t3*toX,y=nt3*fromY+3*nt2*t*cpY+3*nt*t2*cpY2+t3*toY,dx=prevX-x,dy=prevY-y,prevX=x,prevY=y,result+=Math.sqrt(dx*dx+dy*dy);return result},BezierUtils2.curveTo=function(cpX,cpY,cpX2,cpY2,toX,toY,points){var fromX=points[points.length-2],fromY=points[points.length-1];points.length-=2;var n=GRAPHICS_CURVES._segmentsCount(BezierUtils2.curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY)),dt=0,dt2=0,dt3=0,t2=0,t3=0;points.push(fromX,fromY);for(var i=1,j=0;i<=n;++i)j=i/n,dt=1-j,dt2=dt*dt,dt3=dt2*dt,t2=j*j,t3=t2*j,points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY)},BezierUtils2}(),QuadraticUtils=function(){function QuadraticUtils2(){}return QuadraticUtils2.curveLength=function(fromX,fromY,cpX,cpY,toX,toY){var ax=fromX-2*cpX+toX,ay=fromY-2*cpY+toY,bx=2*cpX-2*fromX,by=2*cpY-2*fromY,a=4*(ax*ax+ay*ay),b=4*(ax*bx+ay*by),c=bx*bx+by*by,s=2*Math.sqrt(a+b+c),a2=Math.sqrt(a),a32=2*a*a2,c2=2*Math.sqrt(c),ba=b/a2;return(a32*s+a2*b*(s-c2)+(4*c*a-b*b)*Math.log((2*a2+ba+s)/(ba+c2)))/(4*a32)},QuadraticUtils2.curveTo=function(cpX,cpY,toX,toY,points){for(var fromX=points[points.length-2],fromY=points[points.length-1],n=GRAPHICS_CURVES._segmentsCount(QuadraticUtils2.curveLength(fromX,fromY,cpX,cpY,toX,toY)),xa=0,ya=0,i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j,ya=fromY+(cpY-fromY)*j,points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}},QuadraticUtils2}(),BatchPart=function(){function BatchPart2(){this.reset()}return BatchPart2.prototype.begin=function(style,startIndex,attribStart){this.reset(),this.style=style,this.start=startIndex,this.attribStart=attribStart},BatchPart2.prototype.end=function(endIndex,endAttrib){this.attribSize=endAttrib-this.attribStart,this.size=endIndex-this.start},BatchPart2.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},BatchPart2}(),_a2,FILL_COMMANDS=(_a2={},_a2[SHAPES.POLY]=buildPoly,_a2[SHAPES.CIRC]=buildCircle,_a2[SHAPES.ELIP]=buildCircle,_a2[SHAPES.RECT]=buildRectangle,_a2[SHAPES.RREC]=buildRoundedRectangle,_a2),BATCH_POOL=[],DRAW_CALL_POOL=[],GraphicsData=function(){function GraphicsData2(shape,fillStyle,lineStyle,matrix){fillStyle===void 0&&(fillStyle=null),lineStyle===void 0&&(lineStyle=null),matrix===void 0&&(matrix=null),this.shape=shape,this.lineStyle=lineStyle,this.fillStyle=fillStyle,this.matrix=matrix,this.type=shape.type,this.points=[],this.holes=[]}return GraphicsData2.prototype.clone=function(){return new GraphicsData2(this.shape,this.fillStyle,this.lineStyle,this.matrix)},GraphicsData2.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},GraphicsData2}(),tmpPoint=new Point,tmpBounds=new Bounds,GraphicsGeometry=function(_super){__extends7(GraphicsGeometry2,_super);function GraphicsGeometry2(){var _this=_super.call(this)||this;return _this.uvsFloat32=null,_this.indicesUint16=null,_this.points=[],_this.colors=[],_this.uvs=[],_this.indices=[],_this.textureIds=[],_this.graphicsData=[],_this.dirty=0,_this.batchDirty=-1,_this.cacheDirty=-1,_this.clearDirty=0,_this.drawCalls=[],_this.batches=[],_this.shapeIndex=0,_this._bounds=new Bounds,_this.boundsDirty=-1,_this.boundsPadding=0,_this.batchable=!1,_this.indicesUint16=null,_this.uvsFloat32=null,_this.closePointEps=1e-4,_this}return Object.defineProperty(GraphicsGeometry2.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),GraphicsGeometry2.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i]);this.drawCalls.length=0;for(var i=0;i<this.batches.length;i++){var batchPart=this.batches[i];batchPart.reset(),BATCH_POOL.push(batchPart)}this.batches.length=0},GraphicsGeometry2.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},GraphicsGeometry2.prototype.drawShape=function(shape,fillStyle,lineStyle,matrix){fillStyle===void 0&&(fillStyle=null),lineStyle===void 0&&(lineStyle=null),matrix===void 0&&(matrix=null);var data=new GraphicsData(shape,fillStyle,lineStyle,matrix);return this.graphicsData.push(data),this.dirty++,this},GraphicsGeometry2.prototype.drawHole=function(shape,matrix){if(matrix===void 0&&(matrix=null),!this.graphicsData.length)return null;var data=new GraphicsData(shape,null,null,matrix),lastShape=this.graphicsData[this.graphicsData.length-1];return data.lineStyle=lastShape.lineStyle,lastShape.holes.push(data),this.dirty++,this},GraphicsGeometry2.prototype.destroy=function(){_super.prototype.destroy.call(this);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},GraphicsGeometry2.prototype.containsPoint=function(point){for(var graphicsData=this.graphicsData,i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(!!data.fillStyle.visible&&data.shape&&(data.matrix?data.matrix.applyInverse(point,tmpPoint):tmpPoint.copyFrom(point),data.shape.contains(tmpPoint.x,tmpPoint.y))){var hitHole=!1;if(data.holes)for(var i_1=0;i_1<data.holes.length;i_1++){var hole=data.holes[i_1];if(hole.shape.contains(tmpPoint.x,tmpPoint.y)){hitHole=!0;break}}if(!hitHole)return!0}}return!1},GraphicsGeometry2.prototype.updateBatches=function(allow32Indices){if(!this.graphicsData.length){this.batchable=!0;return}if(!!this.validateBatching()){this.cacheDirty=this.dirty;var uvs=this.uvs,graphicsData=this.graphicsData,batchPart=null,currentStyle=null;this.batches.length>0&&(batchPart=this.batches[this.batches.length-1],currentStyle=batchPart.style);for(var i=this.shapeIndex;i<graphicsData.length;i++){this.shapeIndex++;var data=graphicsData[i],fillStyle=data.fillStyle,lineStyle=data.lineStyle,command=FILL_COMMANDS[data.type];command.build(data),data.matrix&&this.transformPoints(data.points,data.matrix);for(var j=0;j<2;j++){var style=j===0?fillStyle:lineStyle;if(!!style.visible){var nextTexture=style.texture.baseTexture,index_1=this.indices.length,attribIndex=this.points.length/2;nextTexture.wrapMode=WRAP_MODES2.REPEAT,j===0?this.processFill(data):this.processLine(data);var size=this.points.length/2-attribIndex;size!==0&&(batchPart&&!this._compareStyles(currentStyle,style)&&(batchPart.end(index_1,attribIndex),batchPart=null),batchPart||(batchPart=BATCH_POOL.pop()||new BatchPart,batchPart.begin(style,index_1,attribIndex),this.batches.push(batchPart),currentStyle=style),this.addUvs(this.points,uvs,style.texture,attribIndex,size,style.matrix))}}}var index3=this.indices.length,attrib=this.points.length/2;if(batchPart&&batchPart.end(index3,attrib),this.batches.length===0){this.batchable=!0;return}if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var need32=attrib>65535&&allow32Indices;this.indicesUint16=need32?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},GraphicsGeometry2.prototype._compareStyles=function(styleA,styleB){return!(!styleA||!styleB||styleA.texture.baseTexture!==styleB.texture.baseTexture||styleA.color+styleA.alpha!==styleB.color+styleB.alpha||!!styleA.native!=!!styleB.native)},GraphicsGeometry2.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var i=0,l=this.graphicsData.length;i<l;i++){var data=this.graphicsData[i],fill2=data.fillStyle,line=data.lineStyle;if(fill2&&!fill2.texture.baseTexture.valid||line&&!line.texture.baseTexture.valid)return!1}return!0},GraphicsGeometry2.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var batches=this.batches,i=0,l=batches.length;i<l;i++)for(var batch=batches[i],j=0;j<batch.size;j++){var index3=batch.start+j;this.indicesUint16[index3]=this.indicesUint16[index3]-batch.attribStart}},GraphicsGeometry2.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var batches=this.batches,i=0;i<batches.length;i++)if(batches[i].style.native)return!1;return this.points.length<GraphicsGeometry2.BATCHABLE_SIZE*2},GraphicsGeometry2.prototype.buildDrawCalls=function(){for(var TICK=++BaseTexture._globalBatch,i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i]);this.drawCalls.length=0;var colors=this.colors,textureIds=this.textureIds,currentGroup=DRAW_CALL_POOL.pop();currentGroup||(currentGroup=new BatchDrawCall,currentGroup.texArray=new BatchTextureArray),currentGroup.texArray.count=0,currentGroup.start=0,currentGroup.size=0,currentGroup.type=DRAW_MODES2.TRIANGLES;var textureCount=0,currentTexture=null,textureId=0,native=!1,drawMode=DRAW_MODES2.TRIANGLES,index3=0;this.drawCalls.push(currentGroup);for(var i=0;i<this.batches.length;i++){var data=this.batches[i],MAX_TEXTURES=8,style=data.style,nextTexture=style.texture.baseTexture;native!==!!style.native&&(native=!!style.native,drawMode=native?DRAW_MODES2.LINES:DRAW_MODES2.TRIANGLES,currentTexture=null,textureCount=MAX_TEXTURES,TICK++),currentTexture!==nextTexture&&(currentTexture=nextTexture,nextTexture._batchEnabled!==TICK&&(textureCount===MAX_TEXTURES&&(TICK++,textureCount=0,currentGroup.size>0&&(currentGroup=DRAW_CALL_POOL.pop(),currentGroup||(currentGroup=new BatchDrawCall,currentGroup.texArray=new BatchTextureArray),this.drawCalls.push(currentGroup)),currentGroup.start=index3,currentGroup.size=0,currentGroup.texArray.count=0,currentGroup.type=drawMode),nextTexture.touched=1,nextTexture._batchEnabled=TICK,nextTexture._batchLocation=textureCount,nextTexture.wrapMode=WRAP_MODES2.REPEAT,currentGroup.texArray.elements[currentGroup.texArray.count++]=nextTexture,textureCount++)),currentGroup.size+=data.size,index3+=data.size,textureId=nextTexture._batchLocation,this.addColors(colors,style.color,style.alpha,data.attribSize),this.addTextureIds(textureIds,textureId,data.attribSize)}BaseTexture._globalBatch=TICK,this.packAttributes()},GraphicsGeometry2.prototype.packAttributes=function(){for(var verts=this.points,uvs=this.uvs,colors=this.colors,textureIds=this.textureIds,glPoints=new ArrayBuffer(verts.length*3*4),f32=new Float32Array(glPoints),u32=new Uint32Array(glPoints),p=0,i=0;i<verts.length/2;i++)f32[p++]=verts[i*2],f32[p++]=verts[i*2+1],f32[p++]=uvs[i*2],f32[p++]=uvs[i*2+1],u32[p++]=colors[i],f32[p++]=textureIds[i];this._buffer.update(glPoints),this._indexBuffer.update(this.indicesUint16)},GraphicsGeometry2.prototype.processFill=function(data){if(data.holes.length)this.processHoles(data.holes),buildPoly.triangulate(data,this);else{var command=FILL_COMMANDS[data.type];command.triangulate(data,this)}},GraphicsGeometry2.prototype.processLine=function(data){buildLine(data,this);for(var i=0;i<data.holes.length;i++)buildLine(data.holes[i],this)},GraphicsGeometry2.prototype.processHoles=function(holes){for(var i=0;i<holes.length;i++){var hole=holes[i],command=FILL_COMMANDS[hole.type];command.build(hole),hole.matrix&&this.transformPoints(hole.points,hole.matrix)}},GraphicsGeometry2.prototype.calculateBounds=function(){var bounds=this._bounds,sequenceBounds=tmpBounds,curMatrix=Matrix.IDENTITY;this._bounds.clear(),sequenceBounds.clear();for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i],shape=data.shape,type=data.type,lineStyle=data.lineStyle,nextMatrix=data.matrix||Matrix.IDENTITY,lineWidth=0;if(lineStyle&&lineStyle.visible){var alignment=lineStyle.alignment;lineWidth=lineStyle.width,type===SHAPES.POLY?lineWidth=lineWidth*(.5+Math.abs(.5-alignment)):lineWidth=lineWidth*Math.max(0,alignment)}if(curMatrix!==nextMatrix&&(sequenceBounds.isEmpty()||(bounds.addBoundsMatrix(sequenceBounds,curMatrix),sequenceBounds.clear()),curMatrix=nextMatrix),type===SHAPES.RECT||type===SHAPES.RREC){var rect=shape;sequenceBounds.addFramePad(rect.x,rect.y,rect.x+rect.width,rect.y+rect.height,lineWidth,lineWidth)}else if(type===SHAPES.CIRC){var circle=shape;sequenceBounds.addFramePad(circle.x,circle.y,circle.x,circle.y,circle.radius+lineWidth,circle.radius+lineWidth)}else if(type===SHAPES.ELIP){var ellipse=shape;sequenceBounds.addFramePad(ellipse.x,ellipse.y,ellipse.x,ellipse.y,ellipse.width+lineWidth,ellipse.height+lineWidth)}else{var poly=shape;bounds.addVerticesMatrix(curMatrix,poly.points,0,poly.points.length,lineWidth,lineWidth)}}sequenceBounds.isEmpty()||bounds.addBoundsMatrix(sequenceBounds,curMatrix),bounds.pad(this.boundsPadding,this.boundsPadding)},GraphicsGeometry2.prototype.transformPoints=function(points,matrix){for(var i=0;i<points.length/2;i++){var x=points[i*2],y=points[i*2+1];points[i*2]=matrix.a*x+matrix.c*y+matrix.tx,points[i*2+1]=matrix.b*x+matrix.d*y+matrix.ty}},GraphicsGeometry2.prototype.addColors=function(colors,color,alpha,size){for(var rgb=(color>>16)+(color&65280)+((color&255)<<16),rgba=premultiplyTint(rgb,alpha);size-- >0;)colors.push(rgba)},GraphicsGeometry2.prototype.addTextureIds=function(textureIds,id,size){for(;size-- >0;)textureIds.push(id)},GraphicsGeometry2.prototype.addUvs=function(verts,uvs,texture,start2,size,matrix){matrix===void 0&&(matrix=null);for(var index3=0,uvsStart=uvs.length,frame=texture.frame;index3<size;){var x=verts[(start2+index3)*2],y=verts[(start2+index3)*2+1];if(matrix){var nx=matrix.a*x+matrix.c*y+matrix.tx;y=matrix.b*x+matrix.d*y+matrix.ty,x=nx}index3++,uvs.push(x/frame.width,y/frame.height)}var baseTexture=texture.baseTexture;(frame.width<baseTexture.width||frame.height<baseTexture.height)&&this.adjustUvs(uvs,texture,uvsStart,size)},GraphicsGeometry2.prototype.adjustUvs=function(uvs,texture,start2,size){for(var baseTexture=texture.baseTexture,eps=1e-6,finish=start2+size*2,frame=texture.frame,scaleX=frame.width/baseTexture.width,scaleY=frame.height/baseTexture.height,offsetX=frame.x/frame.width,offsetY=frame.y/frame.height,minX=Math.floor(uvs[start2]+eps),minY=Math.floor(uvs[start2+1]+eps),i=start2+2;i<finish;i+=2)minX=Math.min(minX,Math.floor(uvs[i]+eps)),minY=Math.min(minY,Math.floor(uvs[i+1]+eps));offsetX-=minX,offsetY-=minY;for(var i=start2;i<finish;i+=2)uvs[i]=(uvs[i]+offsetX)*scaleX,uvs[i+1]=(uvs[i+1]+offsetY)*scaleY},GraphicsGeometry2.BATCHABLE_SIZE=100,GraphicsGeometry2}(BatchGeometry),LineStyle=function(_super){__extends7(LineStyle2,_super);function LineStyle2(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.width=0,_this.alignment=.5,_this.native=!1,_this.cap=LINE_CAP.BUTT,_this.join=LINE_JOIN.MITER,_this.miterLimit=10,_this}return LineStyle2.prototype.clone=function(){var obj=new LineStyle2;return obj.color=this.color,obj.alpha=this.alpha,obj.texture=this.texture,obj.matrix=this.matrix,obj.visible=this.visible,obj.width=this.width,obj.alignment=this.alignment,obj.native=this.native,obj.cap=this.cap,obj.join=this.join,obj.miterLimit=this.miterLimit,obj},LineStyle2.prototype.reset=function(){_super.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},LineStyle2}(FillStyle),temp=new Float32Array(3),DEFAULT_SHADERS={},Graphics=function(_super){__extends7(Graphics2,_super);function Graphics2(geometry){geometry===void 0&&(geometry=null);var _this=_super.call(this)||this;return _this._geometry=geometry||new GraphicsGeometry,_this._geometry.refCount++,_this.shader=null,_this.state=State.for2d(),_this._fillStyle=new FillStyle,_this._lineStyle=new LineStyle,_this._matrix=null,_this._holeMode=!1,_this.currentPath=null,_this.batches=[],_this.batchTint=-1,_this.batchDirty=-1,_this.vertexData=null,_this.pluginName="batch",_this._transformID=-1,_this.tint=16777215,_this.blendMode=BLEND_MODES2.NORMAL,_this}return Object.defineProperty(Graphics2.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),Graphics2.prototype.clone=function(){return this.finishPoly(),new Graphics2(this._geometry)},Object.defineProperty(Graphics2.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Graphics2.prototype,"tint",{get:function(){return this._tint},set:function(value){this._tint=value},enumerable:!1,configurable:!0}),Object.defineProperty(Graphics2.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(Graphics2.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),Graphics2.prototype.lineStyle=function(options,color,alpha,alignment,native){return options===void 0&&(options=null),color===void 0&&(color=0),alpha===void 0&&(alpha=1),alignment===void 0&&(alignment=.5),native===void 0&&(native=!1),typeof options=="number"&&(options={width:options,color,alpha,alignment,native}),this.lineTextureStyle(options)},Graphics2.prototype.lineTextureStyle=function(options){options=Object.assign({width:0,texture:Texture.WHITE,color:options&&options.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},options),this.currentPath&&this.startPoly();var visible=options.width>0&&options.alpha>0;return visible?(options.matrix&&(options.matrix=options.matrix.clone(),options.matrix.invert()),Object.assign(this._lineStyle,{visible},options)):this._lineStyle.reset(),this},Graphics2.prototype.startPoly=function(){if(this.currentPath){var points=this.currentPath.points,len2=this.currentPath.points.length;len2>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(points[len2-2],points[len2-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1},Graphics2.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},Graphics2.prototype.moveTo=function(x,y){return this.startPoly(),this.currentPath.points[0]=x,this.currentPath.points[1]=y,this},Graphics2.prototype.lineTo=function(x,y){this.currentPath||this.moveTo(0,0);var points=this.currentPath.points,fromX=points[points.length-2],fromY=points[points.length-1];return(fromX!==x||fromY!==y)&&points.push(x,y),this},Graphics2.prototype._initCurve=function(x,y){x===void 0&&(x=0),y===void 0&&(y=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[x,y]):this.moveTo(x,y)},Graphics2.prototype.quadraticCurveTo=function(cpX,cpY,toX,toY){this._initCurve();var points=this.currentPath.points;return points.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(cpX,cpY,toX,toY,points),this},Graphics2.prototype.bezierCurveTo=function(cpX,cpY,cpX2,cpY2,toX,toY){return this._initCurve(),BezierUtils.curveTo(cpX,cpY,cpX2,cpY2,toX,toY,this.currentPath.points),this},Graphics2.prototype.arcTo=function(x1,y1,x2,y2,radius){this._initCurve(x1,y1);var points=this.currentPath.points,result=ArcUtils.curveTo(x1,y1,x2,y2,radius,points);if(result){var cx=result.cx,cy=result.cy,radius_1=result.radius,startAngle=result.startAngle,endAngle=result.endAngle,anticlockwise=result.anticlockwise;this.arc(cx,cy,radius_1,startAngle,endAngle,anticlockwise)}return this},Graphics2.prototype.arc=function(cx,cy,radius,startAngle,endAngle,anticlockwise){if(anticlockwise===void 0&&(anticlockwise=!1),startAngle===endAngle)return this;!anticlockwise&&endAngle<=startAngle?endAngle+=PI_2:anticlockwise&&startAngle<=endAngle&&(startAngle+=PI_2);var sweep=endAngle-startAngle;if(sweep===0)return this;var startX=cx+Math.cos(startAngle)*radius,startY=cy+Math.sin(startAngle)*radius,eps=this._geometry.closePointEps,points=this.currentPath?this.currentPath.points:null;if(points){var xDiff=Math.abs(points[points.length-2]-startX),yDiff=Math.abs(points[points.length-1]-startY);xDiff<eps&&yDiff<eps||points.push(startX,startY)}else this.moveTo(startX,startY),points=this.currentPath.points;return ArcUtils.arc(startX,startY,cx,cy,radius,startAngle,endAngle,anticlockwise,points),this},Graphics2.prototype.beginFill=function(color,alpha){return color===void 0&&(color=0),alpha===void 0&&(alpha=1),this.beginTextureFill({texture:Texture.WHITE,color,alpha})},Graphics2.prototype.beginTextureFill=function(options){options=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},options),this.currentPath&&this.startPoly();var visible=options.alpha>0;return visible?(options.matrix&&(options.matrix=options.matrix.clone(),options.matrix.invert()),Object.assign(this._fillStyle,{visible},options)):this._fillStyle.reset(),this},Graphics2.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},Graphics2.prototype.drawRect=function(x,y,width,height){return this.drawShape(new Rectangle(x,y,width,height))},Graphics2.prototype.drawRoundedRect=function(x,y,width,height,radius){return this.drawShape(new RoundedRectangle(x,y,width,height,radius))},Graphics2.prototype.drawCircle=function(x,y,radius){return this.drawShape(new Circle(x,y,radius))},Graphics2.prototype.drawEllipse=function(x,y,width,height){return this.drawShape(new Ellipse(x,y,width,height))},Graphics2.prototype.drawPolygon=function(){for(var arguments$1=arguments,path=[],_i=0;_i<arguments.length;_i++)path[_i]=arguments$1[_i];var points,closeStroke=!0,poly=path[0];poly.points?(closeStroke=poly.closeStroke,points=poly.points):Array.isArray(path[0])?points=path[0]:points=path;var shape=new Polygon(points);return shape.closeStroke=closeStroke,this.drawShape(shape),this},Graphics2.prototype.drawShape=function(shape){return this._holeMode?this._geometry.drawHole(shape,this._matrix):this._geometry.drawShape(shape,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},Graphics2.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},Graphics2.prototype.isFastRect=function(){var data=this._geometry.graphicsData;return data.length===1&&data[0].shape.type===SHAPES.RECT&&!data[0].holes.length&&!(data[0].lineStyle.visible&&data[0].lineStyle.width)},Graphics2.prototype._render=function(renderer){this.finishPoly();var geometry=this._geometry,hasuint32=renderer.context.supports.uint32Indices;geometry.updateBatches(hasuint32),geometry.batchable?(this.batchDirty!==geometry.batchDirty&&this._populateBatches(),this._renderBatched(renderer)):(renderer.batch.flush(),this._renderDirect(renderer))},Graphics2.prototype._populateBatches=function(){var geometry=this._geometry,blendMode=this.blendMode,len2=geometry.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=geometry.batchDirty,this.batches.length=len2,this.vertexData=new Float32Array(geometry.points);for(var i=0;i<len2;i++){var gI=geometry.batches[i],color=gI.style.color,vertexData=new Float32Array(this.vertexData.buffer,gI.attribStart*4*2,gI.attribSize*2),uvs=new Float32Array(geometry.uvsFloat32.buffer,gI.attribStart*4*2,gI.attribSize*2),indices2=new Uint16Array(geometry.indicesUint16.buffer,gI.start*2,gI.size),batch={vertexData,blendMode,indices:indices2,uvs,_batchRGB:hex2rgb(color),_tintRGB:color,_texture:gI.style.texture,alpha:gI.style.alpha,worldAlpha:1};this.batches[i]=batch}},Graphics2.prototype._renderBatched=function(renderer){if(!!this.batches.length){renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var i=0,l=this.batches.length;i<l;i++){var batch=this.batches[i];batch.worldAlpha=this.worldAlpha*batch.alpha,renderer.plugins[this.pluginName].render(batch)}}},Graphics2.prototype._renderDirect=function(renderer){var shader=this._resolveDirectShader(renderer),geometry=this._geometry,tint=this.tint,worldAlpha=this.worldAlpha,uniforms=shader.uniforms,drawCalls=geometry.drawCalls;uniforms.translationMatrix=this.transform.worldTransform,uniforms.tint[0]=(tint>>16&255)/255*worldAlpha,uniforms.tint[1]=(tint>>8&255)/255*worldAlpha,uniforms.tint[2]=(tint&255)/255*worldAlpha,uniforms.tint[3]=worldAlpha,renderer.shader.bind(shader),renderer.geometry.bind(geometry,shader),renderer.state.set(this.state);for(var i=0,l=drawCalls.length;i<l;i++)this._renderDrawCallDirect(renderer,geometry.drawCalls[i])},Graphics2.prototype._renderDrawCallDirect=function(renderer,drawCall){for(var texArray=drawCall.texArray,type=drawCall.type,size=drawCall.size,start2=drawCall.start,groupTextureCount=texArray.count,j=0;j<groupTextureCount;j++)renderer.texture.bind(texArray.elements[j],j);renderer.geometry.draw(type,size,start2)},Graphics2.prototype._resolveDirectShader=function(renderer){var shader=this.shader,pluginName=this.pluginName;if(!shader){if(!DEFAULT_SHADERS[pluginName]){for(var MAX_TEXTURES=renderer.plugins.batch.MAX_TEXTURES,sampleValues=new Int32Array(MAX_TEXTURES),i=0;i<MAX_TEXTURES;i++)sampleValues[i]=i;var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:sampleValues},!0)},program=renderer.plugins[pluginName]._shader.program;DEFAULT_SHADERS[pluginName]=new Shader(program,uniforms)}shader=DEFAULT_SHADERS[pluginName]}return shader},Graphics2.prototype._calculateBounds=function(){this.finishPoly();var geometry=this._geometry;if(!!geometry.graphicsData.length){var _a3=geometry.bounds,minX=_a3.minX,minY=_a3.minY,maxX=_a3.maxX,maxY=_a3.maxY;this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)}},Graphics2.prototype.containsPoint=function(point){return this.worldTransform.applyInverse(point,Graphics2._TEMP_POINT),this._geometry.containsPoint(Graphics2._TEMP_POINT)},Graphics2.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var tintRGB=hex2rgb(this.tint,temp),i=0;i<this.batches.length;i++){var batch=this.batches[i],batchTint=batch._batchRGB,r=tintRGB[0]*batchTint[0]*255,g=tintRGB[1]*batchTint[1]*255,b=tintRGB[2]*batchTint[2]*255,color=(r<<16)+(g<<8)+(b|0);batch._tintRGB=(color>>16)+(color&65280)+((color&255)<<16)}}},Graphics2.prototype.calculateVertices=function(){var wtID=this.transform._worldID;if(this._transformID!==wtID){this._transformID=wtID;for(var wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,data=this._geometry.points,vertexData=this.vertexData,count2=0,i=0;i<data.length;i+=2){var x=data[i],y=data[i+1];vertexData[count2++]=a*x+c*y+tx,vertexData[count2++]=d*y+b*x+ty}}},Graphics2.prototype.closePath=function(){var currentPath=this.currentPath;return currentPath&&(currentPath.closeStroke=!0),this},Graphics2.prototype.setMatrix=function(matrix){return this._matrix=matrix,this},Graphics2.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},Graphics2.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},Graphics2.prototype.destroy=function(options){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,_super.prototype.destroy.call(this,options)},Graphics2._TEMP_POINT=new Point,Graphics2}(Container);var extendStatics8=function(d,b){return extendStatics8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics8(d,b)};function __extends8(d,b){extendStatics8(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var tempPoint=new Point,indices=new Uint16Array([0,1,2,0,2,3]),Sprite=function(_super){__extends8(Sprite2,_super);function Sprite2(texture){var _this=_super.call(this)||this;return _this._anchor=new ObservablePoint(_this._onAnchorUpdate,_this,texture?texture.defaultAnchor.x:0,texture?texture.defaultAnchor.y:0),_this._texture=null,_this._width=0,_this._height=0,_this._tint=null,_this._tintRGB=null,_this.tint=16777215,_this.blendMode=BLEND_MODES2.NORMAL,_this._cachedTint=16777215,_this.uvs=null,_this.texture=texture||Texture.EMPTY,_this.vertexData=new Float32Array(8),_this.vertexTrimmedData=null,_this._transformID=-1,_this._textureID=-1,_this._transformTrimmedID=-1,_this._textureTrimmedID=-1,_this.indices=indices,_this.pluginName="batch",_this.isSprite=!0,_this._roundPixels=settings.ROUND_PIXELS,_this}return Sprite2.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)},Sprite2.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},Sprite2.prototype.calculateVertices=function(){var texture=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===texture._updateID)){this._textureID!==texture._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=texture._updateID;var wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData,trim=texture.trim,orig=texture.orig,anchor=this._anchor,w0=0,w1=0,h0=0,h1=0;if(trim?(w1=trim.x-anchor._x*orig.width,w0=w1+trim.width,h1=trim.y-anchor._y*orig.height,h0=h1+trim.height):(w1=-anchor._x*orig.width,w0=w1+orig.width,h1=-anchor._y*orig.height,h0=h1+orig.height),vertexData[0]=a*w1+c*h1+tx,vertexData[1]=d*h1+b*w1+ty,vertexData[2]=a*w0+c*h1+tx,vertexData[3]=d*h1+b*w0+ty,vertexData[4]=a*w0+c*h0+tx,vertexData[5]=d*h0+b*w0+ty,vertexData[6]=a*w1+c*h0+tx,vertexData[7]=d*h0+b*w1+ty,this._roundPixels)for(var resolution=settings.RESOLUTION,i=0;i<vertexData.length;++i)vertexData[i]=Math.round((vertexData[i]*resolution|0)/resolution)}},Sprite2.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var texture=this._texture,vertexData=this.vertexTrimmedData,orig=texture.orig,anchor=this._anchor,wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,w1=-anchor._x*orig.width,w0=w1+orig.width,h1=-anchor._y*orig.height,h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx,vertexData[1]=d*h1+b*w1+ty,vertexData[2]=a*w0+c*h1+tx,vertexData[3]=d*h1+b*w0+ty,vertexData[4]=a*w0+c*h0+tx,vertexData[5]=d*h0+b*w0+ty,vertexData[6]=a*w1+c*h0+tx,vertexData[7]=d*h0+b*w1+ty},Sprite2.prototype._render=function(renderer){this.calculateVertices(),renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this)},Sprite2.prototype._calculateBounds=function(){var trim=this._texture.trim,orig=this._texture.orig;!trim||trim.width===orig.width&&trim.height===orig.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},Sprite2.prototype.getLocalBounds=function(rect){return this.children.length===0?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):_super.prototype.getLocalBounds.call(this,rect)},Sprite2.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture.orig.width,height=this._texture.orig.height,x1=-width*this.anchor.x,y1=0;return!!(tempPoint.x>=x1&&tempPoint.x<x1+width&&(y1=-height*this.anchor.y,tempPoint.y>=y1&&tempPoint.y<y1+height))},Sprite2.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var destroyTexture=typeof options=="boolean"?options:options&&options.texture;if(destroyTexture){var destroyBaseTexture=typeof options=="boolean"?options:options&&options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null},Sprite2.from=function(source,options){var texture=source instanceof Texture?source:Texture.from(source,options);return new Sprite2(texture)},Object.defineProperty(Sprite2.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(value){this._roundPixels!==value&&(this._transformID=-1),this._roundPixels=value},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite2.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(value){var s=sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width,this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite2.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(value){var s=sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height,this._height=value},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite2.prototype,"anchor",{get:function(){return this._anchor},set:function(value){this._anchor.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite2.prototype,"tint",{get:function(){return this._tint},set:function(value){this._tint=value,this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite2.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture!==value&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=value||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,value&&(value.baseTexture.valid?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),Sprite2}(Container);var extendStatics9=function(d,b){return extendStatics9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics9(d,b)};function __extends9(d,b){extendStatics9(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var TEXT_GRADIENT;(function(TEXT_GRADIENT2){TEXT_GRADIENT2[TEXT_GRADIENT2.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",TEXT_GRADIENT2[TEXT_GRADIENT2.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(TEXT_GRADIENT||(TEXT_GRADIENT={}));var defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],TextStyle=function(){function TextStyle2(style){this.styleID=0,this.reset(),deepCopyProperties(this,style,style)}return TextStyle2.prototype.clone=function(){var clonedProperties={};return deepCopyProperties(clonedProperties,this,defaultStyle),new TextStyle2(clonedProperties)},TextStyle2.prototype.reset=function(){deepCopyProperties(this,defaultStyle,defaultStyle)},Object.defineProperty(TextStyle2.prototype,"align",{get:function(){return this._align},set:function(align){this._align!==align&&(this._align=align,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"breakWords",{get:function(){return this._breakWords},set:function(breakWords){this._breakWords!==breakWords&&(this._breakWords=breakWords,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(dropShadow){this._dropShadow!==dropShadow&&(this._dropShadow=dropShadow,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(dropShadowAlpha){this._dropShadowAlpha!==dropShadowAlpha&&(this._dropShadowAlpha=dropShadowAlpha,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(dropShadowAngle){this._dropShadowAngle!==dropShadowAngle&&(this._dropShadowAngle=dropShadowAngle,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(dropShadowBlur){this._dropShadowBlur!==dropShadowBlur&&(this._dropShadowBlur=dropShadowBlur,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(dropShadowColor){var outputColor=getColor(dropShadowColor);this._dropShadowColor!==outputColor&&(this._dropShadowColor=outputColor,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(dropShadowDistance){this._dropShadowDistance!==dropShadowDistance&&(this._dropShadowDistance=dropShadowDistance,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fill",{get:function(){return this._fill},set:function(fill2){var outputColor=getColor(fill2);this._fill!==outputColor&&(this._fill=outputColor,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(fillGradientType){this._fillGradientType!==fillGradientType&&(this._fillGradientType=fillGradientType,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(fillGradientStops){areArraysEqual(this._fillGradientStops,fillGradientStops)||(this._fillGradientStops=fillGradientStops,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(fontFamily){this.fontFamily!==fontFamily&&(this._fontFamily=fontFamily,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fontSize",{get:function(){return this._fontSize},set:function(fontSize){this._fontSize!==fontSize&&(this._fontSize=fontSize,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(fontStyle){this._fontStyle!==fontStyle&&(this._fontStyle=fontStyle,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(fontVariant){this._fontVariant!==fontVariant&&(this._fontVariant=fontVariant,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(fontWeight){this._fontWeight!==fontWeight&&(this._fontWeight=fontWeight,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(letterSpacing){this._letterSpacing!==letterSpacing&&(this._letterSpacing=letterSpacing,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(lineHeight){this._lineHeight!==lineHeight&&(this._lineHeight=lineHeight,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"leading",{get:function(){return this._leading},set:function(leading){this._leading!==leading&&(this._leading=leading,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(lineJoin){this._lineJoin!==lineJoin&&(this._lineJoin=lineJoin,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(miterLimit){this._miterLimit!==miterLimit&&(this._miterLimit=miterLimit,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"padding",{get:function(){return this._padding},set:function(padding){this._padding!==padding&&(this._padding=padding,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"stroke",{get:function(){return this._stroke},set:function(stroke){var outputColor=getColor(stroke);this._stroke!==outputColor&&(this._stroke=outputColor,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(strokeThickness){this._strokeThickness!==strokeThickness&&(this._strokeThickness=strokeThickness,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(textBaseline){this._textBaseline!==textBaseline&&(this._textBaseline=textBaseline,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"trim",{get:function(){return this._trim},set:function(trim){this._trim!==trim&&(this._trim=trim,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(whiteSpace){this._whiteSpace!==whiteSpace&&(this._whiteSpace=whiteSpace,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(wordWrap){this._wordWrap!==wordWrap&&(this._wordWrap=wordWrap,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle2.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(wordWrapWidth){this._wordWrapWidth!==wordWrapWidth&&(this._wordWrapWidth=wordWrapWidth,this.styleID++)},enumerable:!1,configurable:!0}),TextStyle2.prototype.toFontString=function(){var fontSizeString=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,fontFamilies=this.fontFamily;Array.isArray(this.fontFamily)||(fontFamilies=this.fontFamily.split(","));for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();!/([\"\'])[^\'\"]+\1/.test(fontFamily)&&genericFontFamilies.indexOf(fontFamily)<0&&(fontFamily='"'+fontFamily+'"'),fontFamilies[i]=fontFamily}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+fontSizeString+" "+fontFamilies.join(",")},TextStyle2}();function getSingleColor(color){return typeof color=="number"?hex2string(color):(typeof color=="string"&&color.indexOf("0x")===0&&(color=color.replace("0x","#")),color)}function getColor(color){if(Array.isArray(color)){for(var i=0;i<color.length;++i)color[i]=getSingleColor(color[i]);return color}else return getSingleColor(color)}function areArraysEqual(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2)||array1.length!==array2.length)return!1;for(var i=0;i<array1.length;++i)if(array1[i]!==array2[i])return!1;return!0}function deepCopyProperties(target,source,propertyObj){for(var prop in propertyObj)Array.isArray(source[prop])?target[prop]=source[prop].slice():target[prop]=source[prop]}var TextMetrics=function(){function TextMetrics2(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){this.text=text,this.style=style,this.width=width,this.height=height,this.lines=lines,this.lineWidths=lineWidths,this.lineHeight=lineHeight,this.maxLineWidth=maxLineWidth,this.fontProperties=fontProperties}return TextMetrics2.measureText=function(text,style,wordWrap,canvas2){canvas2===void 0&&(canvas2=TextMetrics2._canvas),wordWrap=wordWrap==null?style.wordWrap:wordWrap;var font=style.toFontString(),fontProperties=TextMetrics2.measureFont(font);fontProperties.fontSize===0&&(fontProperties.fontSize=style.fontSize,fontProperties.ascent=style.fontSize);var context4=canvas2.getContext("2d");context4.font=font;for(var outputText=wordWrap?TextMetrics2.wordWrap(text,style,canvas2):text,lines=outputText.split(/(?:\r\n|\r|\n)/),lineWidths=new Array(lines.length),maxLineWidth=0,i=0;i<lines.length;i++){var lineWidth=context4.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth,maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;style.dropShadow&&(width+=style.dropShadowDistance);var lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness,height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness)+(lines.length-1)*(lineHeight+style.leading);return style.dropShadow&&(height+=style.dropShadowDistance),new TextMetrics2(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties)},TextMetrics2.wordWrap=function(text,style,canvas2){canvas2===void 0&&(canvas2=TextMetrics2._canvas);for(var context4=canvas2.getContext("2d"),width=0,line="",lines="",cache2=Object.create(null),letterSpacing=style.letterSpacing,whiteSpace=style.whiteSpace,collapseSpaces=TextMetrics2.collapseSpaces(whiteSpace),collapseNewlines=TextMetrics2.collapseNewlines(whiteSpace),canPrependSpaces=!collapseSpaces,wordWrapWidth=style.wordWrapWidth+letterSpacing,tokens=TextMetrics2.tokenize(text),i=0;i<tokens.length;i++){var token=tokens[i];if(TextMetrics2.isNewline(token)){if(!collapseNewlines){lines+=TextMetrics2.addLine(line),canPrependSpaces=!collapseSpaces,line="",width=0;continue}token=" "}if(collapseSpaces){var currIsBreakingSpace=TextMetrics2.isBreakingSpace(token),lastIsBreakingSpace=TextMetrics2.isBreakingSpace(line[line.length-1]);if(currIsBreakingSpace&&lastIsBreakingSpace)continue}var tokenWidth=TextMetrics2.getFromCache(token,letterSpacing,cache2,context4);if(tokenWidth>wordWrapWidth)if(line!==""&&(lines+=TextMetrics2.addLine(line),line="",width=0),TextMetrics2.canBreakWords(token,style.breakWords))for(var characters=TextMetrics2.wordWrapSplit(token),j=0;j<characters.length;j++){for(var char=characters[j],k=1;characters[j+k];){var nextChar=characters[j+k],lastChar=char[char.length-1];if(!TextMetrics2.canBreakChars(lastChar,nextChar,token,j,style.breakWords))char+=nextChar;else break;k++}j+=char.length-1;var characterWidth=TextMetrics2.getFromCache(char,letterSpacing,cache2,context4);characterWidth+width>wordWrapWidth&&(lines+=TextMetrics2.addLine(line),canPrependSpaces=!1,line="",width=0),line+=char,width+=characterWidth}else{line.length>0&&(lines+=TextMetrics2.addLine(line),line="",width=0);var isLastToken=i===tokens.length-1;lines+=TextMetrics2.addLine(token,!isLastToken),canPrependSpaces=!1,line="",width=0}else tokenWidth+width>wordWrapWidth&&(canPrependSpaces=!1,lines+=TextMetrics2.addLine(line),line="",width=0),(line.length>0||!TextMetrics2.isBreakingSpace(token)||canPrependSpaces)&&(line+=token,width+=tokenWidth)}return lines+=TextMetrics2.addLine(line,!1),lines},TextMetrics2.addLine=function(line,newLine){return newLine===void 0&&(newLine=!0),line=TextMetrics2.trimRight(line),line=newLine?line+`
`:line,line},TextMetrics2.getFromCache=function(key,letterSpacing,cache2,context4){var width=cache2[key];if(typeof width!="number"){var spacing=key.length*letterSpacing;width=context4.measureText(key).width+spacing,cache2[key]=width}return width},TextMetrics2.collapseSpaces=function(whiteSpace){return whiteSpace==="normal"||whiteSpace==="pre-line"},TextMetrics2.collapseNewlines=function(whiteSpace){return whiteSpace==="normal"},TextMetrics2.trimRight=function(text){if(typeof text!="string")return"";for(var i=text.length-1;i>=0;i--){var char=text[i];if(!TextMetrics2.isBreakingSpace(char))break;text=text.slice(0,-1)}return text},TextMetrics2.isNewline=function(char){return typeof char!="string"?!1:TextMetrics2._newlines.indexOf(char.charCodeAt(0))>=0},TextMetrics2.isBreakingSpace=function(char,_nextChar){return typeof char!="string"?!1:TextMetrics2._breakingSpaces.indexOf(char.charCodeAt(0))>=0},TextMetrics2.tokenize=function(text){var tokens=[],token="";if(typeof text!="string")return tokens;for(var i=0;i<text.length;i++){var char=text[i],nextChar=text[i+1];if(TextMetrics2.isBreakingSpace(char,nextChar)||TextMetrics2.isNewline(char)){token!==""&&(tokens.push(token),token=""),tokens.push(char);continue}token+=char}return token!==""&&tokens.push(token),tokens},TextMetrics2.canBreakWords=function(_token,breakWords){return breakWords},TextMetrics2.canBreakChars=function(_char,_nextChar,_token,_index,_breakWords){return!0},TextMetrics2.wordWrapSplit=function(token){return token.split("")},TextMetrics2.measureFont=function(font){if(TextMetrics2._fonts[font])return TextMetrics2._fonts[font];var properties={ascent:0,descent:0,fontSize:0},canvas2=TextMetrics2._canvas,context4=TextMetrics2._context;context4.font=font;var metricsString=TextMetrics2.METRICS_STRING+TextMetrics2.BASELINE_SYMBOL,width=Math.ceil(context4.measureText(metricsString).width),baseline=Math.ceil(context4.measureText(TextMetrics2.BASELINE_SYMBOL).width),height=Math.ceil(TextMetrics2.HEIGHT_MULTIPLIER*baseline);baseline=baseline*TextMetrics2.BASELINE_MULTIPLIER|0,canvas2.width=width,canvas2.height=height,context4.fillStyle="#f00",context4.fillRect(0,0,width,height),context4.font=font,context4.textBaseline="alphabetic",context4.fillStyle="#000",context4.fillText(metricsString,0,baseline);var imagedata=context4.getImageData(0,0,width,height).data,pixels=imagedata.length,line=width*4,i=0,idx=0,stop=!1;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4)if(imagedata[idx+j]!==255){stop=!0;break}if(!stop)idx+=line;else break}for(properties.ascent=baseline-i,idx=pixels-line,stop=!1,i=height;i>baseline;--i){for(var j=0;j<line;j+=4)if(imagedata[idx+j]!==255){stop=!0;break}if(!stop)idx-=line;else break}return properties.descent=i-baseline,properties.fontSize=properties.ascent+properties.descent,TextMetrics2._fonts[font]=properties,properties},TextMetrics2.clearMetrics=function(font){font===void 0&&(font=""),font?delete TextMetrics2._fonts[font]:TextMetrics2._fonts={}},TextMetrics2}(),canvas=function(){try{var c=new OffscreenCanvas(0,0),context4=c.getContext("2d");return context4&&context4.measureText?c:document.createElement("canvas")}catch(ex){return document.createElement("canvas")}}();canvas.width=canvas.height=10;TextMetrics._canvas=canvas;TextMetrics._context=canvas.getContext("2d");TextMetrics._fonts={};TextMetrics.METRICS_STRING="|\xC9q\xC5";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics.HEIGHT_MULTIPLIER=2;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Text=function(_super){__extends9(Text2,_super);function Text2(text,style,canvas2){var _this=this,ownCanvas=!1;canvas2||(canvas2=document.createElement("canvas"),ownCanvas=!0),canvas2.width=3,canvas2.height=3;var texture=Texture.from(canvas2);return texture.orig=new Rectangle,texture.trim=new Rectangle,_this=_super.call(this,texture)||this,_this._ownCanvas=ownCanvas,_this.canvas=canvas2,_this.context=_this.canvas.getContext("2d"),_this._resolution=settings.RESOLUTION,_this._autoResolution=!0,_this._text=null,_this._style=null,_this._styleListener=null,_this._font="",_this.text=text,_this.style=style,_this.localStyleID=-1,_this}return Text2.prototype.updateText=function(respectDirty){var style=this._style;if(this.localStyleID!==style.styleID&&(this.dirty=!0,this.localStyleID=style.styleID),!(!this.dirty&&respectDirty)){this._font=this._style.toFontString();var context4=this.context,measured=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),width=measured.width,height=measured.height,lines=measured.lines,lineHeight=measured.lineHeight,lineWidths=measured.lineWidths,maxLineWidth=measured.maxLineWidth,fontProperties=measured.fontProperties;this.canvas.width=Math.ceil((Math.max(1,width)+style.padding*2)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,height)+style.padding*2)*this._resolution),context4.scale(this._resolution,this._resolution),context4.clearRect(0,0,this.canvas.width,this.canvas.height),context4.font=this._font,context4.lineWidth=style.strokeThickness,context4.textBaseline=style.textBaseline,context4.lineJoin=style.lineJoin,context4.miterLimit=style.miterLimit;for(var linePositionX,linePositionY,passesCount=style.dropShadow?2:1,i=0;i<passesCount;++i){var isShadowPass=style.dropShadow&&i===0,dsOffsetText=isShadowPass?Math.ceil(Math.max(1,height)+style.padding*2):0,dsOffsetShadow=dsOffsetText*this._resolution;if(isShadowPass){context4.fillStyle="black",context4.strokeStyle="black";var dropShadowColor=style.dropShadowColor,rgb=hex2rgb(typeof dropShadowColor=="number"?dropShadowColor:string2hex(dropShadowColor));context4.shadowColor="rgba("+rgb[0]*255+","+rgb[1]*255+","+rgb[2]*255+","+style.dropShadowAlpha+")",context4.shadowBlur=style.dropShadowBlur,context4.shadowOffsetX=Math.cos(style.dropShadowAngle)*style.dropShadowDistance,context4.shadowOffsetY=Math.sin(style.dropShadowAngle)*style.dropShadowDistance+dsOffsetShadow}else context4.fillStyle=this._generateFillStyle(style,lines,measured),context4.strokeStyle=style.stroke,context4.shadowColor="black",context4.shadowBlur=0,context4.shadowOffsetX=0,context4.shadowOffsetY=0;var linePositionYShift=(lineHeight-fontProperties.fontSize)/2;(!Text2.nextLineHeightBehavior||lineHeight-fontProperties.fontSize<0)&&(linePositionYShift=0);for(var i_1=0;i_1<lines.length;i_1++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+i_1*lineHeight+fontProperties.ascent+linePositionYShift,style.align==="right"?linePositionX+=maxLineWidth-lineWidths[i_1]:style.align==="center"&&(linePositionX+=(maxLineWidth-lineWidths[i_1])/2),style.stroke&&style.strokeThickness&&this.drawLetterSpacing(lines[i_1],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText,!0),style.fill&&this.drawLetterSpacing(lines[i_1],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText)}this.updateTexture()}},Text2.prototype.drawLetterSpacing=function(text,x,y,isStroke){isStroke===void 0&&(isStroke=!1);var style=this._style,letterSpacing=style.letterSpacing;if(letterSpacing===0){isStroke?this.context.strokeText(text,x,y):this.context.fillText(text,x,y);return}for(var currentPosition=x,stringArray=Array.from?Array.from(text):text.split(""),previousWidth=this.context.measureText(text).width,currentWidth=0,i=0;i<stringArray.length;++i){var currentChar=stringArray[i];isStroke?this.context.strokeText(currentChar,currentPosition,y):this.context.fillText(currentChar,currentPosition,y),currentWidth=this.context.measureText(text.substring(i+1)).width,currentPosition+=previousWidth-currentWidth+letterSpacing,previousWidth=currentWidth}},Text2.prototype.updateTexture=function(){var canvas2=this.canvas;if(this._style.trim){var trimmed=trimCanvas(canvas2);trimmed.data&&(canvas2.width=trimmed.width,canvas2.height=trimmed.height,this.context.putImageData(trimmed.data,0,0))}var texture=this._texture,style=this._style,padding=style.trim?0:style.padding,baseTexture=texture.baseTexture;texture.trim.width=texture._frame.width=Math.ceil(canvas2.width/this._resolution),texture.trim.height=texture._frame.height=Math.ceil(canvas2.height/this._resolution),texture.trim.x=-padding,texture.trim.y=-padding,texture.orig.width=texture._frame.width-padding*2,texture.orig.height=texture._frame.height-padding*2,this._onTextureUpdate(),baseTexture.setRealSize(canvas2.width,canvas2.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},Text2.prototype._render=function(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),_super.prototype._render.call(this,renderer)},Text2.prototype.getLocalBounds=function(rect){return this.updateText(!0),_super.prototype.getLocalBounds.call(this,rect)},Text2.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},Text2.prototype._generateFillStyle=function(style,lines,metrics){var fillStyle=style.fill;if(Array.isArray(fillStyle)){if(fillStyle.length===1)return fillStyle[0]}else return fillStyle;var gradient,dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0,padding=style.padding||0,width=Math.ceil(this.canvas.width/this._resolution)-dropShadowCorrection-padding*2,height=Math.ceil(this.canvas.height/this._resolution)-dropShadowCorrection-padding*2,fill2=fillStyle.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length)for(var lengthPlus1=fill2.length+1,i=1;i<lengthPlus1;++i)fillGradientStops.push(i/lengthPlus1);if(fill2.unshift(fillStyle[0]),fillGradientStops.unshift(0),fill2.push(fillStyle[fillStyle.length-1]),fillGradientStops.push(1),style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,padding,width/2,height+padding);for(var textHeight=metrics.fontProperties.fontSize+style.strokeThickness,gradStopLineHeight=textHeight/height,i=0;i<lines.length;i++)for(var thisLineTop=metrics.lineHeight*i,j=0;j<fill2.length;j++){var lineStop=0;typeof fillGradientStops[j]=="number"?lineStop=fillGradientStops[j]:lineStop=j/fill2.length;var globalStop=Math.min(1,Math.max(0,thisLineTop/height+lineStop*gradStopLineHeight));globalStop=Number(globalStop.toFixed(5)),gradient.addColorStop(globalStop,fill2[j])}}else{gradient=this.context.createLinearGradient(padding,height/2,width+padding,height/2);for(var totalIterations=fill2.length+1,currentIteration=1,i=0;i<fill2.length;i++){var stop=void 0;typeof fillGradientStops[i]=="number"?stop=fillGradientStops[i]:stop=currentIteration/totalIterations,gradient.addColorStop(stop,fill2[i]),currentIteration++}}return gradient},Text2.prototype.destroy=function(options){typeof options=="boolean"&&(options={children:options}),options=Object.assign({},defaultDestroyOptions,options),_super.prototype.destroy.call(this,options),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(Text2.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(value){this.updateText(!0);var s=sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width,this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(Text2.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(value){this.updateText(!0);var s=sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height,this._height=value},enumerable:!1,configurable:!0}),Object.defineProperty(Text2.prototype,"style",{get:function(){return this._style},set:function(style){style=style||{},style instanceof TextStyle?this._style=style:this._style=new TextStyle(style),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Text2.prototype,"text",{get:function(){return this._text},set:function(text){text=String(text==null?"":text),this._text!==text&&(this._text=text,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Text2.prototype,"resolution",{get:function(){return this._resolution},set:function(value){this._autoResolution=!1,this._resolution!==value&&(this._resolution=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Text2.nextLineHeightBehavior=!1,Text2}(Sprite);settings.UPLOADS_PER_FRAME=4;var extendStatics10=function(d,b){return extendStatics10=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics10(d,b)};function __extends10(d,b){extendStatics10(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var CountLimiter=function(){function CountLimiter2(maxItemsPerFrame){this.maxItemsPerFrame=maxItemsPerFrame,this.itemsLeft=0}return CountLimiter2.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},CountLimiter2.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},CountLimiter2}();function findMultipleBaseTextures(item,queue2){var result=!1;if(item&&item._textures&&item._textures.length){for(var i=0;i<item._textures.length;i++)if(item._textures[i]instanceof Texture){var baseTexture=item._textures[i].baseTexture;queue2.indexOf(baseTexture)===-1&&(queue2.push(baseTexture),result=!0)}}return result}function findBaseTexture(item,queue2){if(item.baseTexture instanceof BaseTexture){var texture=item.baseTexture;return queue2.indexOf(texture)===-1&&queue2.push(texture),!0}return!1}function findTexture(item,queue2){if(item._texture&&item._texture instanceof Texture){var texture=item._texture.baseTexture;return queue2.indexOf(texture)===-1&&queue2.push(texture),!0}return!1}function drawText(_helper,item){return item instanceof Text?(item.updateText(!0),!0):!1}function calculateTextStyle(_helper,item){if(item instanceof TextStyle){var font=item.toFontString();return TextMetrics.measureFont(font),!0}return!1}function findText(item,queue2){if(item instanceof Text){queue2.indexOf(item.style)===-1&&queue2.push(item.style),queue2.indexOf(item)===-1&&queue2.push(item);var texture=item._texture.baseTexture;return queue2.indexOf(texture)===-1&&queue2.push(texture),!0}return!1}function findTextStyle(item,queue2){return item instanceof TextStyle?(queue2.indexOf(item)===-1&&queue2.push(item),!0):!1}var BasePrepare=function(){function BasePrepare2(renderer){var _this=this;this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=renderer,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){!_this.queue||_this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}return BasePrepare2.prototype.upload=function(item,done){typeof item=="function"&&(done=item,item=null),item&&this.add(item),this.queue.length?(done&&this.completes.push(done),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):done&&done()},BasePrepare2.prototype.tick=function(){setTimeout(this.delayedTick,0)},BasePrepare2.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var item=this.queue[0],uploaded=!1;if(item&&!item._destroyed){for(var i=0,len2=this.uploadHooks.length;i<len2;i++)if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift(),uploaded=!0;break}}uploaded||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var completes=this.completes.slice(0);this.completes.length=0;for(var i=0,len2=completes.length;i<len2;i++)completes[i]()}},BasePrepare2.prototype.registerFindHook=function(addHook){return addHook&&this.addHooks.push(addHook),this},BasePrepare2.prototype.registerUploadHook=function(uploadHook){return uploadHook&&this.uploadHooks.push(uploadHook),this},BasePrepare2.prototype.add=function(item){for(var i=0,len2=this.addHooks.length;i<len2&&!this.addHooks[i](item,this.queue);i++);if(item instanceof Container)for(var i=item.children.length-1;i>=0;i--)this.add(item.children[i]);return this},BasePrepare2.prototype.destroy=function(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},BasePrepare2}();function uploadBaseTextures(renderer,item){return item instanceof BaseTexture?(item._glTextures[renderer.CONTEXT_UID]||renderer.texture.bind(item),!0):!1}function uploadGraphics(renderer,item){if(!(item instanceof Graphics))return!1;var geometry=item.geometry;item.finishPoly(),geometry.updateBatches();for(var batches=geometry.batches,i=0;i<batches.length;i++){var texture=batches[i].style.texture;texture&&uploadBaseTextures(renderer,texture.baseTexture)}return geometry.batchable||renderer.geometry.bind(geometry,item._resolveDirectShader(renderer)),!0}function findGraphics(item,queue2){return item instanceof Graphics?(queue2.push(item),!0):!1}var Prepare=function(_super){__extends10(Prepare2,_super);function Prepare2(renderer){var _this=_super.call(this,renderer)||this;return _this.uploadHookHelper=_this.renderer,_this.registerFindHook(findGraphics),_this.registerUploadHook(uploadBaseTextures),_this.registerUploadHook(uploadGraphics),_this}return Prepare2}(BasePrepare),TimeLimiter=function(){function TimeLimiter2(maxMilliseconds){this.maxMilliseconds=maxMilliseconds,this.frameStart=0}return TimeLimiter2.prototype.beginFrame=function(){this.frameStart=Date.now()},TimeLimiter2.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},TimeLimiter2}();var Spritesheet=function(){function Spritesheet2(texture,data,resolutionFilename){resolutionFilename===void 0&&(resolutionFilename=null),this._texture=texture instanceof Texture?texture:null,this.baseTexture=texture instanceof BaseTexture?texture:this._texture.baseTexture,this.textures={},this.animations={},this.data=data;var resource=this.baseTexture.resource;this.resolution=this._updateResolution(resolutionFilename||(resource?resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return Spritesheet2.prototype._updateResolution=function(resolutionFilename){resolutionFilename===void 0&&(resolutionFilename=null);var scale=this.data.meta.scale,resolution=getResolutionOfUrl(resolutionFilename,null);return resolution===null&&(resolution=scale!==void 0?parseFloat(scale):1),resolution!==1&&this.baseTexture.setResolution(resolution),resolution},Spritesheet2.prototype.parse=function(callback){this._batchIndex=0,this._callback=callback,this._frameKeys.length<=Spritesheet2.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},Spritesheet2.prototype._processFrames=function(initialFrameIndex){for(var frameIndex=initialFrameIndex,maxFrames=Spritesheet2.BATCH_SIZE;frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length;){var i=this._frameKeys[frameIndex],data=this._frames[i],rect=data.frame;if(rect){var frame=null,trim=null,sourceSize=data.trimmed!==!1&&data.sourceSize?data.sourceSize:data.frame,orig=new Rectangle(0,0,Math.floor(sourceSize.w)/this.resolution,Math.floor(sourceSize.h)/this.resolution);data.rotated?frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.h)/this.resolution,Math.floor(rect.w)/this.resolution):frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution),data.trimmed!==!1&&data.spriteSourceSize&&(trim=new Rectangle(Math.floor(data.spriteSourceSize.x)/this.resolution,Math.floor(data.spriteSourceSize.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution)),this.textures[i]=new Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor),Texture.addToCache(this.textures[i],i)}frameIndex++}},Spritesheet2.prototype._processAnimations=function(){var animations=this.data.animations||{};for(var animName in animations){this.animations[animName]=[];for(var i=0;i<animations[animName].length;i++){var frameName=animations[animName][i];this.animations[animName].push(this.textures[frameName])}}},Spritesheet2.prototype._parseComplete=function(){var callback=this._callback;this._callback=null,this._batchIndex=0,callback.call(this,this.textures)},Spritesheet2.prototype._nextBatch=function(){var _this=this;this._processFrames(this._batchIndex*Spritesheet2.BATCH_SIZE),this._batchIndex++,setTimeout(function(){_this._batchIndex*Spritesheet2.BATCH_SIZE<_this._frameKeys.length?_this._nextBatch():(_this._processAnimations(),_this._parseComplete())},0)},Spritesheet2.prototype.destroy=function(destroyBase){var _a3;destroyBase===void 0&&(destroyBase=!1);for(var i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,destroyBase&&((_a3=this._texture)===null||_a3===void 0||_a3.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},Spritesheet2.BATCH_SIZE=1e3,Spritesheet2}(),SpritesheetLoader=function(){function SpritesheetLoader2(){}return SpritesheetLoader2.use=function(resource,next){var _a3,_b2,loader=this,imageResourceName=resource.name+"_image";if(!resource.data||resource.type!==LoaderResource.TYPE.JSON||!resource.data.frames||loader.resources[imageResourceName]){next();return}var multiPacks=(_b2=(_a3=resource.data)===null||_a3===void 0?void 0:_a3.meta)===null||_b2===void 0?void 0:_b2.related_multi_packs;if(Array.isArray(multiPacks))for(var _loop_13=function(item2){if(typeof item2!="string")return"continue";var itemName=item2.replace(".json",""),itemUrl=url.resolve(resource.url.replace(loader.baseUrl,""),item2);if(loader.resources[itemName]||Object.values(loader.resources).some(function(r){return url.format(url.parse(r.url))===itemUrl}))return"continue";var options={crossOrigin:resource.crossOrigin,loadType:LoaderResource.LOAD_TYPE.XHR,xhrType:LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:resource};loader.add(itemName,itemUrl,options)},_i=0,multiPacks_1=multiPacks;_i<multiPacks_1.length;_i++){var item=multiPacks_1[_i];_loop_13(item)}var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource},resourcePath=SpritesheetLoader2.getResourcePath(resource,loader.baseUrl);loader.add(imageResourceName,resourcePath,loadOptions,function(res){if(res.error){next(res.error);return}var spritesheet=new Spritesheet(res.texture,resource.data,resource.url);spritesheet.parse(function(){resource.spritesheet=spritesheet,resource.textures=spritesheet.textures,next()})})},SpritesheetLoader2.getResourcePath=function(resource,baseUrl){return resource.isDataUrl?resource.data.meta.image:url.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)},SpritesheetLoader2}();var extendStatics11=function(d,b){return extendStatics11=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics11(d,b)};function __extends11(d,b){extendStatics11(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var tempPoint2=new Point,TilingSprite=function(_super){__extends11(TilingSprite2,_super);function TilingSprite2(texture,width,height){width===void 0&&(width=100),height===void 0&&(height=100);var _this=_super.call(this,texture)||this;return _this.tileTransform=new Transform,_this._width=width,_this._height=height,_this.uvMatrix=_this.texture.uvMatrix||new TextureMatrix(texture),_this.pluginName="tilingSprite",_this.uvRespectAnchor=!1,_this}return Object.defineProperty(TilingSprite2.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(value){this.uvMatrix.clampMargin=value,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(TilingSprite2.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(value){this.tileTransform.scale.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(TilingSprite2.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(value){this.tileTransform.position.copyFrom(value)},enumerable:!1,configurable:!0}),TilingSprite2.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},TilingSprite2.prototype._render=function(renderer){var texture=this._texture;!texture||!texture.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this))},TilingSprite2.prototype._calculateBounds=function(){var minX=this._width*-this._anchor._x,minY=this._height*-this._anchor._y,maxX=this._width*(1-this._anchor._x),maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)},TilingSprite2.prototype.getLocalBounds=function(rect){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):_super.prototype.getLocalBounds.call(this,rect)},TilingSprite2.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint2);var width=this._width,height=this._height,x1=-width*this.anchor._x;if(tempPoint2.x>=x1&&tempPoint2.x<x1+width){var y1=-height*this.anchor._y;if(tempPoint2.y>=y1&&tempPoint2.y<y1+height)return!0}return!1},TilingSprite2.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this.tileTransform=null,this.uvMatrix=null},TilingSprite2.from=function(source,options){var texture=source instanceof Texture?source:Texture.from(source,options);return new TilingSprite2(texture,options.width,options.height)},Object.defineProperty(TilingSprite2.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(TilingSprite2.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value},enumerable:!1,configurable:!0}),TilingSprite2}(Sprite),vertex3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,fragment3=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture2D(uSampler, coord);
    gl_FragColor = texSample * uColor;
}
`,fragmentSimple=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 sample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = sample * uColor;
}
`,tempMat2=new Matrix,TilingSpriteRenderer=function(_super){__extends11(TilingSpriteRenderer2,_super);function TilingSpriteRenderer2(renderer){var _this=_super.call(this,renderer)||this,uniforms={globals:_this.renderer.globalUniforms};return _this.shader=Shader.from(vertex3,fragment3,uniforms),_this.simpleShader=Shader.from(vertex3,fragmentSimple,uniforms),_this.quad=new QuadUv,_this.state=State.for2d(),_this}return TilingSpriteRenderer2.prototype.render=function(ts){var renderer=this.renderer,quad=this.quad,vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x,vertices[1]=vertices[3]=ts._height*-ts.anchor.y,vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x),vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);var anchorX=ts.uvRespectAnchor?ts.anchor.x:0,anchorY=ts.uvRespectAnchor?ts.anchor.y:0;vertices=quad.uvs,vertices[0]=vertices[6]=-anchorX,vertices[1]=vertices[3]=-anchorY,vertices[2]=vertices[4]=1-anchorX,vertices[5]=vertices[7]=1-anchorY,quad.invalidate();var tex=ts._texture,baseTex=tex.baseTexture,lt=ts.tileTransform.localTransform,uv=ts.uvMatrix,isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;isSimple&&(baseTex._glTextures[renderer.CONTEXT_UID]?isSimple=baseTex.wrapMode!==WRAP_MODES2.CLAMP:baseTex.wrapMode===WRAP_MODES2.CLAMP&&(baseTex.wrapMode=WRAP_MODES2.REPEAT));var shader=isSimple?this.simpleShader:this.shader,w=tex.width,h=tex.height,W=ts._width,H=ts._height;tempMat2.set(lt.a*w/W,lt.b*w/H,lt.c*h/W,lt.d*h/H,lt.tx/W,lt.ty/H),tempMat2.invert(),isSimple?tempMat2.prepend(uv.mapCoord):(shader.uniforms.uMapCoord=uv.mapCoord.toArray(!0),shader.uniforms.uClampFrame=uv.uClampFrame,shader.uniforms.uClampOffset=uv.uClampOffset),shader.uniforms.uTransform=tempMat2.toArray(!0),shader.uniforms.uColor=premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,baseTex.alphaMode),shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(!0),shader.uniforms.uSampler=tex,renderer.shader.bind(shader),renderer.geometry.bind(quad),this.state.blendMode=correctBlendMode(ts.blendMode,baseTex.alphaMode),renderer.state.set(this.state),renderer.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},TilingSpriteRenderer2}(ObjectRenderer);var extendStatics12=function(d,b){return extendStatics12=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics12(d,b)};function __extends12(d,b){extendStatics12(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var MeshBatchUvs=function(){function MeshBatchUvs2(uvBuffer,uvMatrix){this.uvBuffer=uvBuffer,this.uvMatrix=uvMatrix,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return MeshBatchUvs2.prototype.update=function(forceUpdate){if(!(!forceUpdate&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var data=this.uvBuffer.data;(!this.data||this.data.length!==data.length)&&(this.data=new Float32Array(data.length)),this.uvMatrix.multiplyUvs(data,this.data),this._updateID++}},MeshBatchUvs2}(),tempPoint3=new Point,tempPolygon=new Polygon,Mesh=function(_super){__extends12(Mesh2,_super);function Mesh2(geometry,shader,state,drawMode){drawMode===void 0&&(drawMode=DRAW_MODES2.TRIANGLES);var _this=_super.call(this)||this;return _this.geometry=geometry,geometry.refCount++,_this.shader=shader,_this.state=state||State.for2d(),_this.drawMode=drawMode,_this.start=0,_this.size=0,_this.uvs=null,_this.indices=null,_this.vertexData=new Float32Array(1),_this.vertexDirty=-1,_this._transformID=-1,_this._roundPixels=settings.ROUND_PIXELS,_this.batchUvs=null,_this}return Object.defineProperty(Mesh2.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh2.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh2.prototype,"material",{get:function(){return this.shader},set:function(value){this.shader=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh2.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh2.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(value){this._roundPixels!==value&&(this._transformID=-1),this._roundPixels=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh2.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(value){this.shader.tint=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh2.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(value){this.shader.texture=value},enumerable:!1,configurable:!0}),Mesh2.prototype._render=function(renderer){var vertices=this.geometry.buffers[0].data,shader=this.shader;shader.batchable&&this.drawMode===DRAW_MODES2.TRIANGLES&&vertices.length<Mesh2.BATCHABLE_SIZE*2?this._renderToBatch(renderer):this._renderDefault(renderer)},Mesh2.prototype._renderDefault=function(renderer){var shader=this.shader;shader.alpha=this.worldAlpha,shader.update&&shader.update(),renderer.batch.flush(),shader.program.uniformData.translationMatrix&&(shader.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),renderer.shader.bind(shader),renderer.state.set(this.state),renderer.geometry.bind(this.geometry,shader),renderer.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},Mesh2.prototype._renderToBatch=function(renderer){var geometry=this.geometry,shader=this.shader;shader.uvMatrix&&(shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=geometry.indexBuffer.data,this._tintRGB=shader._tintRGB,this._texture=shader.texture;var pluginName=this.material.pluginName;renderer.batch.setObjectRenderer(renderer.plugins[pluginName]),renderer.plugins[pluginName].render(this)},Mesh2.prototype.calculateVertices=function(){var geometry=this.geometry,verticesBuffer=geometry.buffers[0],vertices=verticesBuffer.data,vertexDirtyId=verticesBuffer._updateID;if(!(vertexDirtyId===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==vertices.length&&(this.vertexData=new Float32Array(vertices.length));for(var wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData,i=0;i<vertexData.length/2;i++){var x=vertices[i*2],y=vertices[i*2+1];vertexData[i*2]=a*x+c*y+tx,vertexData[i*2+1]=b*x+d*y+ty}if(this._roundPixels)for(var resolution=settings.RESOLUTION,i=0;i<vertexData.length;++i)vertexData[i]=Math.round((vertexData[i]*resolution|0)/resolution);this.vertexDirty=vertexDirtyId}},Mesh2.prototype.calculateUvs=function(){var geomUvs=this.geometry.buffers[1],shader=this.shader;shader.uvMatrix.isSimple?this.uvs=geomUvs.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(geomUvs,shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},Mesh2.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},Mesh2.prototype.containsPoint=function(point){if(!this.getBounds().contains(point.x,point.y))return!1;this.worldTransform.applyInverse(point,tempPoint3);for(var vertices=this.geometry.getBuffer("aVertexPosition").data,points=tempPolygon.points,indices2=this.geometry.getIndex().data,len2=indices2.length,step=this.drawMode===4?3:1,i=0;i+2<len2;i+=step){var ind0=indices2[i]*2,ind1=indices2[i+1]*2,ind2=indices2[i+2]*2;if(points[0]=vertices[ind0],points[1]=vertices[ind0+1],points[2]=vertices[ind1],points[3]=vertices[ind1+1],points[4]=vertices[ind2],points[5]=vertices[ind2+1],tempPolygon.contains(tempPoint3.x,tempPoint3.y))return!0}return!1},Mesh2.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this.geometry.refCount--,this.geometry.refCount===0&&this.geometry.dispose(),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Mesh2.BATCHABLE_SIZE=100,Mesh2}(Container),fragment4=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,MeshMaterial=function(_super){__extends12(MeshMaterial2,_super);function MeshMaterial2(uSampler,options){var _this=this,uniforms={uSampler,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};return options=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},options),options.uniforms&&Object.assign(uniforms,options.uniforms),_this=_super.call(this,options.program||Program.from(vertex4,fragment4),uniforms)||this,_this._colorDirty=!1,_this.uvMatrix=new TextureMatrix(uSampler),_this.batchable=options.program===void 0,_this.pluginName=options.pluginName,_this.tint=options.tint,_this.alpha=options.alpha,_this}return Object.defineProperty(MeshMaterial2.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(value){this.uniforms.uSampler!==value&&(this.uniforms.uSampler=value,this.uvMatrix.texture=value)},enumerable:!1,configurable:!0}),Object.defineProperty(MeshMaterial2.prototype,"alpha",{get:function(){return this._alpha},set:function(value){value!==this._alpha&&(this._alpha=value,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(MeshMaterial2.prototype,"tint",{get:function(){return this._tint},set:function(value){value!==this._tint&&(this._tint=value,this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),MeshMaterial2.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var baseTexture=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,baseTexture.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},MeshMaterial2}(Shader),MeshGeometry=function(_super){__extends12(MeshGeometry2,_super);function MeshGeometry2(vertices,uvs,index3){var _this=_super.call(this)||this,verticesBuffer=new Buffer2(vertices),uvsBuffer=new Buffer2(uvs,!0),indexBuffer=new Buffer2(index3,!0,!0);return _this.addAttribute("aVertexPosition",verticesBuffer,2,!1,TYPES2.FLOAT).addAttribute("aTextureCoord",uvsBuffer,2,!1,TYPES2.FLOAT).addIndex(indexBuffer),_this._updateId=-1,_this}return Object.defineProperty(MeshGeometry2.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),MeshGeometry2}(Geometry);var extendStatics13=function(d,b){return extendStatics13=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics13(d,b)};function __extends13(d,b){extendStatics13(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var BitmapFontData=function(){function BitmapFontData2(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]}return BitmapFontData2}(),TextFormat=function(){function TextFormat2(){}return TextFormat2.test=function(data){return typeof data=="string"&&data.indexOf("info face=")===0},TextFormat2.parse=function(txt){var items=txt.match(/^[a-z]+\s+.+$/gm),rawData={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var i in items){var name=items[i].match(/^[a-z]+/gm)[0],attributeList=items[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),itemData={};for(var i_1 in attributeList){var split=attributeList[i_1].split("="),key=split[0],strValue=split[1].replace(/"/gm,""),floatValue=parseFloat(strValue),value=isNaN(floatValue)?strValue:floatValue;itemData[key]=value}rawData[name].push(itemData)}var font=new BitmapFontData;return rawData.info.forEach(function(info){return font.info.push({face:info.face,size:parseInt(info.size,10)})}),rawData.common.forEach(function(common){return font.common.push({lineHeight:parseInt(common.lineHeight,10)})}),rawData.page.forEach(function(page){return font.page.push({id:parseInt(page.id,10),file:page.file})}),rawData.char.forEach(function(char){return font.char.push({id:parseInt(char.id,10),page:parseInt(char.page,10),x:parseInt(char.x,10),y:parseInt(char.y,10),width:parseInt(char.width,10),height:parseInt(char.height,10),xoffset:parseInt(char.xoffset,10),yoffset:parseInt(char.yoffset,10),xadvance:parseInt(char.xadvance,10)})}),rawData.kerning.forEach(function(kerning){return font.kerning.push({first:parseInt(kerning.first,10),second:parseInt(kerning.second,10),amount:parseInt(kerning.amount,10)})}),font},TextFormat2}(),XMLFormat=function(){function XMLFormat2(){}return XMLFormat2.test=function(data){return data instanceof XMLDocument&&data.getElementsByTagName("page").length&&data.getElementsByTagName("info")[0].getAttribute("face")!==null},XMLFormat2.parse=function(xml){for(var data=new BitmapFontData,info=xml.getElementsByTagName("info"),common=xml.getElementsByTagName("common"),page=xml.getElementsByTagName("page"),char=xml.getElementsByTagName("char"),kerning=xml.getElementsByTagName("kerning"),i=0;i<info.length;i++)data.info.push({face:info[i].getAttribute("face"),size:parseInt(info[i].getAttribute("size"),10)});for(var i=0;i<common.length;i++)data.common.push({lineHeight:parseInt(common[i].getAttribute("lineHeight"),10)});for(var i=0;i<page.length;i++)data.page.push({id:parseInt(page[i].getAttribute("id"),10)||0,file:page[i].getAttribute("file")});for(var i=0;i<char.length;i++){var letter=char[i];data.char.push({id:parseInt(letter.getAttribute("id"),10),page:parseInt(letter.getAttribute("page"),10)||0,x:parseInt(letter.getAttribute("x"),10),y:parseInt(letter.getAttribute("y"),10),width:parseInt(letter.getAttribute("width"),10),height:parseInt(letter.getAttribute("height"),10),xoffset:parseInt(letter.getAttribute("xoffset"),10),yoffset:parseInt(letter.getAttribute("yoffset"),10),xadvance:parseInt(letter.getAttribute("xadvance"),10)})}for(var i=0;i<kerning.length;i++)data.kerning.push({first:parseInt(kerning[i].getAttribute("first"),10),second:parseInt(kerning[i].getAttribute("second"),10),amount:parseInt(kerning[i].getAttribute("amount"),10)});return data},XMLFormat2}(),XMLStringFormat=function(){function XMLStringFormat2(){}return XMLStringFormat2.test=function(data){if(typeof data=="string"&&data.indexOf("<font>")>-1){var xml=new self.DOMParser().parseFromString(data,"text/xml");return XMLFormat.test(xml)}return!1},XMLStringFormat2.parse=function(xmlTxt){var xml=new self.DOMParser().parseFromString(xmlTxt,"text/xml");return XMLFormat.parse(xml)},XMLStringFormat2}(),formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(data){for(var i=0;i<formats.length;i++)if(formats[i].test(data))return formats[i];return null}function generateFillStyle(canvas2,context4,style,resolution,lines,metrics){var fillStyle=style.fill;if(Array.isArray(fillStyle)){if(fillStyle.length===1)return fillStyle[0]}else return fillStyle;var gradient,dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0,padding=style.padding||0,width=Math.ceil(canvas2.width/resolution)-dropShadowCorrection-padding*2,height=Math.ceil(canvas2.height/resolution)-dropShadowCorrection-padding*2,fill2=fillStyle.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length)for(var lengthPlus1=fill2.length+1,i=1;i<lengthPlus1;++i)fillGradientStops.push(i/lengthPlus1);if(fill2.unshift(fillStyle[0]),fillGradientStops.unshift(0),fill2.push(fillStyle[fillStyle.length-1]),fillGradientStops.push(1),style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=context4.createLinearGradient(width/2,padding,width/2,height+padding);for(var lastIterationStop=0,textHeight=metrics.fontProperties.fontSize+style.strokeThickness,gradStopLineHeight=textHeight/height,i=0;i<lines.length;i++)for(var thisLineTop=metrics.lineHeight*i,j=0;j<fill2.length;j++){var lineStop=0;typeof fillGradientStops[j]=="number"?lineStop=fillGradientStops[j]:lineStop=j/fill2.length;var globalStop=thisLineTop/height+lineStop*gradStopLineHeight,clampedStop=Math.max(lastIterationStop,globalStop);clampedStop=Math.min(clampedStop,1),gradient.addColorStop(clampedStop,fill2[j]),lastIterationStop=clampedStop}}else{gradient=context4.createLinearGradient(padding,height/2,width+padding,height/2);for(var totalIterations=fill2.length+1,currentIteration=1,i=0;i<fill2.length;i++){var stop=void 0;typeof fillGradientStops[i]=="number"?stop=fillGradientStops[i]:stop=currentIteration/totalIterations,gradient.addColorStop(stop,fill2[i]),currentIteration++}}return gradient}function drawGlyph(canvas2,context4,metrics,x,y,resolution,style){var char=metrics.text,fontProperties=metrics.fontProperties;context4.translate(x,y),context4.scale(resolution,resolution);var tx=style.strokeThickness/2,ty=-(style.strokeThickness/2);context4.font=style.toFontString(),context4.lineWidth=style.strokeThickness,context4.textBaseline=style.textBaseline,context4.lineJoin=style.lineJoin,context4.miterLimit=style.miterLimit,context4.fillStyle=generateFillStyle(canvas2,context4,style,resolution,[char],metrics),context4.strokeStyle=style.stroke,context4.font=style.toFontString(),context4.lineWidth=style.strokeThickness,context4.textBaseline=style.textBaseline,context4.lineJoin=style.lineJoin,context4.miterLimit=style.miterLimit,context4.fillStyle=generateFillStyle(canvas2,context4,style,resolution,[char],metrics),context4.strokeStyle=style.stroke;var dropShadowColor=style.dropShadowColor,rgb=hex2rgb(typeof dropShadowColor=="number"?dropShadowColor:string2hex(dropShadowColor));style.dropShadow?(context4.shadowColor="rgba("+rgb[0]*255+","+rgb[1]*255+","+rgb[2]*255+","+style.dropShadowAlpha+")",context4.shadowBlur=style.dropShadowBlur,context4.shadowOffsetX=Math.cos(style.dropShadowAngle)*style.dropShadowDistance,context4.shadowOffsetY=Math.sin(style.dropShadowAngle)*style.dropShadowDistance):(context4.shadowColor="black",context4.shadowBlur=0,context4.shadowOffsetX=0,context4.shadowOffsetY=0),style.stroke&&style.strokeThickness&&context4.strokeText(char,tx,ty+metrics.lineHeight-fontProperties.descent),style.fill&&context4.fillText(char,tx,ty+metrics.lineHeight-fontProperties.descent),context4.setTransform(1,0,0,1,0,0),context4.fillStyle="rgba(0, 0, 0, 0)"}function resolveCharacters(chars){typeof chars=="string"&&(chars=[chars]);for(var result=[],i=0,j=chars.length;i<j;i++){var item=chars[i];if(Array.isArray(item)){if(item.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+item.length+".");var startCode=item[0].charCodeAt(0),endCode=item[1].charCodeAt(0);if(endCode<startCode)throw new Error("[BitmapFont]: Invalid character range.");for(var i_1=startCode,j_1=endCode;i_1<=j_1;i_1++)result.push(String.fromCharCode(i_1))}else result.push.apply(result,item.split(""))}if(result.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return result}var BitmapFont=function(){function BitmapFont2(data,textures,ownsTextures){var info=data.info[0],common=data.common[0],page=data.page[0],res=getResolutionOfUrl(page.file),pageTextures={};this._ownsTextures=ownsTextures,this.font=info.face,this.size=info.size,this.lineHeight=common.lineHeight/res,this.chars={},this.pageTextures=pageTextures;for(var i=0;i<data.page.length;i++){var _a3=data.page[i],id=_a3.id,file=_a3.file;pageTextures[id]=textures instanceof Array?textures[i]:textures[file]}for(var i=0;i<data.char.length;i++){var _b2=data.char[i],id=_b2.id,page_1=_b2.page,_c2=data.char[i],x=_c2.x,y=_c2.y,width=_c2.width,height=_c2.height,xoffset=_c2.xoffset,yoffset=_c2.yoffset,xadvance=_c2.xadvance;x/=res,y/=res,width/=res,height/=res,xoffset/=res,yoffset/=res,xadvance/=res;var rect=new Rectangle(x+pageTextures[page_1].frame.x/res,y+pageTextures[page_1].frame.y/res,width,height);this.chars[id]={xOffset:xoffset,yOffset:yoffset,xAdvance:xadvance,kerning:{},texture:new Texture(pageTextures[page_1].baseTexture,rect),page:page_1}}for(var i=0;i<data.kerning.length;i++){var _d=data.kerning[i],first=_d.first,second=_d.second,amount=_d.amount;first/=res,second/=res,amount/=res,this.chars[second]&&(this.chars[second].kerning[first]=amount)}}return BitmapFont2.prototype.destroy=function(){for(var id in this.chars)this.chars[id].texture.destroy(),this.chars[id].texture=null;for(var id in this.pageTextures)this._ownsTextures&&this.pageTextures[id].destroy(!0),this.pageTextures[id]=null;this.chars=null,this.pageTextures=null},BitmapFont2.install=function(data,textures,ownsTextures){var fontData;if(data instanceof BitmapFontData)fontData=data;else{var format3=autoDetectFormat(data);if(!format3)throw new Error("Unrecognized data format for font.");fontData=format3.parse(data)}textures instanceof Texture&&(textures=[textures]);var font=new BitmapFont2(fontData,textures,ownsTextures);return BitmapFont2.available[font.font]=font,font},BitmapFont2.uninstall=function(name){var font=BitmapFont2.available[name];if(!font)throw new Error("No font found named '"+name+"'");font.destroy(),delete BitmapFont2.available[name]},BitmapFont2.from=function(name,textStyle,options){if(!name)throw new Error("[BitmapFont] Property `name` is required.");var _a3=Object.assign({},BitmapFont2.defaultOptions,options),chars=_a3.chars,padding=_a3.padding,resolution=_a3.resolution,textureWidth=_a3.textureWidth,textureHeight=_a3.textureHeight,charsList=resolveCharacters(chars),style=textStyle instanceof TextStyle?textStyle:new TextStyle(textStyle),lineWidth=textureWidth,fontData=new BitmapFontData;fontData.info[0]={face:style.fontFamily,size:style.fontSize},fontData.common[0]={lineHeight:style.fontSize};for(var positionX=0,positionY=0,canvas2,context4,baseTexture,maxCharHeight=0,textures=[],i=0;i<charsList.length;i++){canvas2||(canvas2=document.createElement("canvas"),canvas2.width=textureWidth,canvas2.height=textureHeight,context4=canvas2.getContext("2d"),baseTexture=new BaseTexture(canvas2,{resolution}),textures.push(new Texture(baseTexture)),fontData.page.push({id:textures.length-1,file:""}));var metrics=TextMetrics.measureText(charsList[i],style,!1,canvas2),width=metrics.width,height=Math.ceil(metrics.height),textureGlyphWidth=Math.ceil((style.fontStyle==="italic"?2:1)*width);if(positionY>=textureHeight-height*resolution){if(positionY===0)throw new Error("[BitmapFont] textureHeight "+textureHeight+"px is "+("too small for "+style.fontSize+"px fonts"));--i,canvas2=null,context4=null,baseTexture=null,positionY=0,positionX=0,maxCharHeight=0;continue}if(maxCharHeight=Math.max(height+metrics.fontProperties.descent,maxCharHeight),textureGlyphWidth*resolution+positionX>=lineWidth){--i,positionY+=maxCharHeight*resolution,positionY=Math.ceil(positionY),positionX=0,maxCharHeight=0;continue}drawGlyph(canvas2,context4,metrics,positionX,positionY,resolution,style);var id=metrics.text.charCodeAt(0);fontData.char.push({id,page:textures.length-1,x:positionX/resolution,y:positionY/resolution,width:textureGlyphWidth,height,xoffset:0,yoffset:0,xadvance:Math.ceil(width-(style.dropShadow?style.dropShadowDistance:0)-(style.stroke?style.strokeThickness:0))}),positionX+=(textureGlyphWidth+2*padding)*resolution,positionX=Math.ceil(positionX)}for(var i=0,len2=charsList.length;i<len2;i++)for(var first=charsList[i],j=0;j<len2;j++){var second=charsList[j],c1=context4.measureText(first).width,c2=context4.measureText(second).width,total=context4.measureText(first+second).width,amount=total-(c1+c2);amount&&fontData.kerning.push({first:first.charCodeAt(0),second:second.charCodeAt(0),amount})}var font=new BitmapFont2(fontData,textures,!0);return BitmapFont2.available[name]!==void 0&&BitmapFont2.uninstall(name),BitmapFont2.available[name]=font,font},BitmapFont2.ALPHA=[["a","z"],["A","Z"]," "],BitmapFont2.NUMERIC=[["0","9"]],BitmapFont2.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],BitmapFont2.ASCII=[[" ","~"]],BitmapFont2.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:BitmapFont2.ALPHANUMERIC},BitmapFont2.available={},BitmapFont2}(),pageMeshDataPool=[],charRenderDataPool=[],BitmapText=function(_super){__extends13(BitmapText2,_super);function BitmapText2(text,style){style===void 0&&(style={});var _this=_super.call(this)||this;_this._tint=16777215;var _a3=Object.assign({},BitmapText2.styleDefaults,style),align=_a3.align,tint=_a3.tint,maxWidth=_a3.maxWidth,letterSpacing=_a3.letterSpacing,fontName=_a3.fontName,fontSize=_a3.fontSize;if(!BitmapFont.available[fontName])throw new Error('Missing BitmapFont "'+fontName+'"');return _this._activePagesMeshData=[],_this._textWidth=0,_this._textHeight=0,_this._align=align,_this._tint=tint,_this._fontName=fontName,_this._fontSize=fontSize||BitmapFont.available[fontName].size,_this._text=text,_this._maxWidth=maxWidth,_this._maxLineHeight=0,_this._letterSpacing=letterSpacing,_this._anchor=new ObservablePoint(function(){_this.dirty=!0},_this,0,0),_this._roundPixels=settings.ROUND_PIXELS,_this.dirty=!0,_this._textureCache={},_this}return BitmapText2.prototype.updateText=function(){for(var _a3,data=BitmapFont.available[this._fontName],scale=this._fontSize/data.size,pos=new Point,chars=[],lineWidths=[],lineSpaces=[],text=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",textLength=text.length,maxWidth=this._maxWidth*data.size/this._fontSize,prevCharCode=null,lastLineWidth=0,maxLineWidth=0,line=0,lastBreakPos=-1,lastBreakWidth=0,spacesRemoved=0,maxLineHeight=0,spaceCount=0,i=0;i<textLength;i++){var charCode=text.charCodeAt(i),char=text.charAt(i);if(/(?:\s)/.test(char)&&(lastBreakPos=i,lastBreakWidth=lastLineWidth,spaceCount++),char==="\r"||char===`
`){lineWidths.push(lastLineWidth),lineSpaces.push(-1),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),++line,++spacesRemoved,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null,spaceCount=0;continue}var charData=data.chars[charCode];if(!!charData){prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]);var charRenderData=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};charRenderData.texture=charData.texture,charRenderData.line=line,charRenderData.charCode=charCode,charRenderData.position.x=pos.x+charData.xOffset+this._letterSpacing/2,charRenderData.position.y=pos.y+charData.yOffset,charRenderData.prevSpaces=spaceCount,chars.push(charRenderData),pos.x+=charData.xAdvance+this._letterSpacing,lastLineWidth=pos.x,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode,lastBreakPos!==-1&&maxWidth>0&&pos.x>maxWidth&&(++spacesRemoved,removeItems(chars,1+lastBreakPos-spacesRemoved,1+i-lastBreakPos),i=lastBreakPos,lastBreakPos=-1,lineWidths.push(lastBreakWidth),lineSpaces.push(chars.length>0?chars[chars.length-1].prevSpaces:0),maxLineWidth=Math.max(maxLineWidth,lastBreakWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null,spaceCount=0)}}var lastChar=text.charAt(text.length-1);lastChar!=="\r"&&lastChar!==`
`&&(/(?:\s)/.test(lastChar)&&(lastLineWidth=lastBreakWidth),lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),lineSpaces.push(-1));for(var lineAlignOffsets=[],i=0;i<=line;i++){var alignOffset=0;this._align==="right"?alignOffset=maxLineWidth-lineWidths[i]:this._align==="center"?alignOffset=(maxLineWidth-lineWidths[i])/2:this._align==="justify"&&(alignOffset=lineSpaces[i]<0?0:(maxLineWidth-lineWidths[i])/lineSpaces[i]),lineAlignOffsets.push(alignOffset)}for(var lenChars=chars.length,pagesMeshData={},newPagesMeshData=[],activePagesMeshData=this._activePagesMeshData,i=0;i<activePagesMeshData.length;i++)pageMeshDataPool.push(activePagesMeshData[i]);for(var i=0;i<lenChars;i++){var texture=chars[i].texture,baseTextureUid=texture.baseTexture.uid;if(!pagesMeshData[baseTextureUid]){var pageMeshData=pageMeshDataPool.pop();if(!pageMeshData){var geometry=new MeshGeometry,material=new MeshMaterial(Texture.EMPTY),mesh=new Mesh(geometry,material);pageMeshData={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh,vertices:null,uvs:null,indices:null}}pageMeshData.index=0,pageMeshData.indexCount=0,pageMeshData.vertexCount=0,pageMeshData.uvsCount=0,pageMeshData.total=0;var _textureCache=this._textureCache;_textureCache[baseTextureUid]=_textureCache[baseTextureUid]||new Texture(texture.baseTexture),pageMeshData.mesh.texture=_textureCache[baseTextureUid],pageMeshData.mesh.tint=this._tint,newPagesMeshData.push(pageMeshData),pagesMeshData[baseTextureUid]=pageMeshData}pagesMeshData[baseTextureUid].total++}for(var i=0;i<activePagesMeshData.length;i++)newPagesMeshData.indexOf(activePagesMeshData[i])===-1&&this.removeChild(activePagesMeshData[i].mesh);for(var i=0;i<newPagesMeshData.length;i++)newPagesMeshData[i].mesh.parent!==this&&this.addChild(newPagesMeshData[i].mesh);this._activePagesMeshData=newPagesMeshData;for(var i in pagesMeshData){var pageMeshData=pagesMeshData[i],total=pageMeshData.total;if(!(((_a3=pageMeshData.indices)===null||_a3===void 0?void 0:_a3.length)>6*total)||pageMeshData.vertices.length<Mesh.BATCHABLE_SIZE*2)pageMeshData.vertices=new Float32Array(4*2*total),pageMeshData.uvs=new Float32Array(4*2*total),pageMeshData.indices=new Uint16Array(6*total);else for(var total_1=pageMeshData.total,vertices=pageMeshData.vertices,i_1=total_1*4*2;i_1<vertices.length;i_1++)vertices[i_1]=0;pageMeshData.mesh.size=6*total}for(var i=0;i<lenChars;i++){var char=chars[i],offset=char.position.x+lineAlignOffsets[char.line]*(this._align==="justify"?char.prevSpaces:1);this._roundPixels&&(offset=Math.round(offset));var xPos=offset*scale,yPos=char.position.y*scale,texture=char.texture,pageMesh=pagesMeshData[texture.baseTexture.uid],textureFrame=texture.frame,textureUvs=texture._uvs,index3=pageMesh.index++;pageMesh.indices[index3*6+0]=0+index3*4,pageMesh.indices[index3*6+1]=1+index3*4,pageMesh.indices[index3*6+2]=2+index3*4,pageMesh.indices[index3*6+3]=0+index3*4,pageMesh.indices[index3*6+4]=2+index3*4,pageMesh.indices[index3*6+5]=3+index3*4,pageMesh.vertices[index3*8+0]=xPos,pageMesh.vertices[index3*8+1]=yPos,pageMesh.vertices[index3*8+2]=xPos+textureFrame.width*scale,pageMesh.vertices[index3*8+3]=yPos,pageMesh.vertices[index3*8+4]=xPos+textureFrame.width*scale,pageMesh.vertices[index3*8+5]=yPos+textureFrame.height*scale,pageMesh.vertices[index3*8+6]=xPos,pageMesh.vertices[index3*8+7]=yPos+textureFrame.height*scale,pageMesh.uvs[index3*8+0]=textureUvs.x0,pageMesh.uvs[index3*8+1]=textureUvs.y0,pageMesh.uvs[index3*8+2]=textureUvs.x1,pageMesh.uvs[index3*8+3]=textureUvs.y1,pageMesh.uvs[index3*8+4]=textureUvs.x2,pageMesh.uvs[index3*8+5]=textureUvs.y2,pageMesh.uvs[index3*8+6]=textureUvs.x3,pageMesh.uvs[index3*8+7]=textureUvs.y3}this._textWidth=maxLineWidth*scale,this._textHeight=(pos.y+data.lineHeight)*scale;for(var i in pagesMeshData){var pageMeshData=pagesMeshData[i];if(this.anchor.x!==0||this.anchor.y!==0)for(var vertexCount=0,anchorOffsetX=this._textWidth*this.anchor.x,anchorOffsetY=this._textHeight*this.anchor.y,i_2=0;i_2<pageMeshData.total;i_2++)pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY;this._maxLineHeight=maxLineHeight*scale;var vertexBuffer=pageMeshData.mesh.geometry.getBuffer("aVertexPosition"),textureBuffer=pageMeshData.mesh.geometry.getBuffer("aTextureCoord"),indexBuffer=pageMeshData.mesh.geometry.getIndex();vertexBuffer.data=pageMeshData.vertices,textureBuffer.data=pageMeshData.uvs,indexBuffer.data=pageMeshData.indices,vertexBuffer.update(),textureBuffer.update(),indexBuffer.update()}for(var i=0;i<chars.length;i++)charRenderDataPool.push(chars[i])},BitmapText2.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},BitmapText2.prototype.getLocalBounds=function(){return this.validate(),_super.prototype.getLocalBounds.call(this)},BitmapText2.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(BitmapText2.prototype,"tint",{get:function(){return this._tint},set:function(value){if(this._tint!==value){this._tint=value;for(var i=0;i<this._activePagesMeshData.length;i++)this._activePagesMeshData[i].mesh.tint=value}},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"align",{get:function(){return this._align},set:function(value){this._align!==value&&(this._align=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"fontName",{get:function(){return this._fontName},set:function(value){if(!BitmapFont.available[value])throw new Error('Missing BitmapFont "'+value+'"');this._fontName!==value&&(this._fontName=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"fontSize",{get:function(){return this._fontSize},set:function(value){this._fontSize!==value&&(this._fontSize=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"anchor",{get:function(){return this._anchor},set:function(value){typeof value=="number"?this._anchor.set(value):this._anchor.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"text",{get:function(){return this._text},set:function(text){text=String(text==null?"":text),this._text!==text&&(this._text=text,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(value){this._maxWidth!==value&&(this._maxWidth=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(value){this._letterSpacing!==value&&(this._letterSpacing=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(value){value!==this._roundPixels&&(this._roundPixels=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText2.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),BitmapText2.prototype.destroy=function(options){var _textureCache=this._textureCache;for(var id in _textureCache){var texture=_textureCache[id];texture.destroy(),delete _textureCache[id]}this._textureCache=null,_super.prototype.destroy.call(this,options)},BitmapText2.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},BitmapText2}(Container),BitmapFontLoader=function(){function BitmapFontLoader2(){}return BitmapFontLoader2.add=function(){LoaderResource.setExtensionXhrType("fnt",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},BitmapFontLoader2.use=function(resource,next){var format3=autoDetectFormat(resource.data);if(!format3){next();return}for(var baseUrl=BitmapFontLoader2.getBaseUrl(this,resource),data=format3.parse(resource.data),textures={},completed=function(page){textures[page.metadata.pageFile]=page.texture,Object.keys(textures).length===data.page.length&&(resource.bitmapFont=BitmapFont.install(data,textures,!0),next())},i=0;i<data.page.length;++i){var pageFile=data.page[i].file,url3=baseUrl+pageFile,exists=!1;for(var name in this.resources){var bitmapResource=this.resources[name];if(bitmapResource.url===url3){bitmapResource.metadata.pageFile=pageFile,bitmapResource.texture?completed(bitmapResource):bitmapResource.onAfterMiddleware.add(completed),exists=!0;break}}if(!exists){var options={crossOrigin:resource.crossOrigin,loadType:LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile},resource.metadata.imageMetadata),parentResource:resource};this.add(url3,options,completed)}}},BitmapFontLoader2.getBaseUrl=function(loader,resource){var resUrl=resource.isDataUrl?"":BitmapFontLoader2.dirname(resource.url);return resource.isDataUrl&&(resUrl==="."&&(resUrl=""),loader.baseUrl&&resUrl&&loader.baseUrl.charAt(loader.baseUrl.length-1)==="/"&&(resUrl+="/")),resUrl=resUrl.replace(loader.baseUrl,""),resUrl&&resUrl.charAt(resUrl.length-1)!=="/"&&(resUrl+="/"),resUrl},BitmapFontLoader2.dirname=function(url3){var dir=url3.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return dir===url3?".":dir===""?"/":dir},BitmapFontLoader2}();var extendStatics14=function(d,b){return extendStatics14=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics14(d,b)};function __extends14(d,b){extendStatics14(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var fragment5=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,AlphaFilter=function(_super){__extends14(AlphaFilter2,_super);function AlphaFilter2(alpha){alpha===void 0&&(alpha=1);var _this=_super.call(this,defaultVertex$2,fragment5,{uAlpha:1})||this;return _this.alpha=alpha,_this}return Object.defineProperty(AlphaFilter2.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(value){this.uniforms.uAlpha=value},enumerable:!1,configurable:!0}),AlphaFilter2}(Filter);var extendStatics15=function(d,b){return extendStatics15=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics15(d,b)};function __extends15(d,b){extendStatics15(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var vertTemplate=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function generateBlurVertSource(kernelSize,x){var halfLength=Math.ceil(kernelSize/2),vertSource=vertTemplate,blurLoop="",template;x?template="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":template="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i.toString());blur=blur.replace("%sampleIndex%",i-(halfLength-1)+".0"),blurLoop+=blur,blurLoop+=`
`}return vertSource=vertSource.replace("%blur%",blurLoop),vertSource=vertSource.replace("%size%",kernelSize.toString()),vertSource}var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fragTemplate2=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function generateBlurFragSource(kernelSize){for(var kernel=GAUSSIAN_VALUES[kernelSize],halfLength=kernel.length,fragSource=fragTemplate2,blurLoop="",template="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",value,i=0;i<kernelSize;i++){var blur=template.replace("%index%",i.toString());value=i,i>=halfLength&&(value=kernelSize-i-1),blur=blur.replace("%value%",kernel[value].toString()),blurLoop+=blur,blurLoop+=`
`}return fragSource=fragSource.replace("%blur%",blurLoop),fragSource=fragSource.replace("%size%",kernelSize.toString()),fragSource}var ENV3;(function(ENV4){ENV4[ENV4.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV4[ENV4.WEBGL=1]="WEBGL",ENV4[ENV4.WEBGL2=2]="WEBGL2"})(ENV3||(ENV3={}));var RENDERER_TYPE3;(function(RENDERER_TYPE4){RENDERER_TYPE4[RENDERER_TYPE4.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE4[RENDERER_TYPE4.WEBGL=1]="WEBGL",RENDERER_TYPE4[RENDERER_TYPE4.CANVAS=2]="CANVAS"})(RENDERER_TYPE3||(RENDERER_TYPE3={}));var BUFFER_BITS3;(function(BUFFER_BITS4){BUFFER_BITS4[BUFFER_BITS4.COLOR=16384]="COLOR",BUFFER_BITS4[BUFFER_BITS4.DEPTH=256]="DEPTH",BUFFER_BITS4[BUFFER_BITS4.STENCIL=1024]="STENCIL"})(BUFFER_BITS3||(BUFFER_BITS3={}));var BLEND_MODES3;(function(BLEND_MODES4){BLEND_MODES4[BLEND_MODES4.NORMAL=0]="NORMAL",BLEND_MODES4[BLEND_MODES4.ADD=1]="ADD",BLEND_MODES4[BLEND_MODES4.MULTIPLY=2]="MULTIPLY",BLEND_MODES4[BLEND_MODES4.SCREEN=3]="SCREEN",BLEND_MODES4[BLEND_MODES4.OVERLAY=4]="OVERLAY",BLEND_MODES4[BLEND_MODES4.DARKEN=5]="DARKEN",BLEND_MODES4[BLEND_MODES4.LIGHTEN=6]="LIGHTEN",BLEND_MODES4[BLEND_MODES4.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES4[BLEND_MODES4.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES4[BLEND_MODES4.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES4[BLEND_MODES4.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES4[BLEND_MODES4.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES4[BLEND_MODES4.EXCLUSION=12]="EXCLUSION",BLEND_MODES4[BLEND_MODES4.HUE=13]="HUE",BLEND_MODES4[BLEND_MODES4.SATURATION=14]="SATURATION",BLEND_MODES4[BLEND_MODES4.COLOR=15]="COLOR",BLEND_MODES4[BLEND_MODES4.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES4[BLEND_MODES4.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES4[BLEND_MODES4.ADD_NPM=18]="ADD_NPM",BLEND_MODES4[BLEND_MODES4.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES4[BLEND_MODES4.NONE=20]="NONE",BLEND_MODES4[BLEND_MODES4.SRC_OVER=0]="SRC_OVER",BLEND_MODES4[BLEND_MODES4.SRC_IN=21]="SRC_IN",BLEND_MODES4[BLEND_MODES4.SRC_OUT=22]="SRC_OUT",BLEND_MODES4[BLEND_MODES4.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES4[BLEND_MODES4.DST_OVER=24]="DST_OVER",BLEND_MODES4[BLEND_MODES4.DST_IN=25]="DST_IN",BLEND_MODES4[BLEND_MODES4.DST_OUT=26]="DST_OUT",BLEND_MODES4[BLEND_MODES4.DST_ATOP=27]="DST_ATOP",BLEND_MODES4[BLEND_MODES4.ERASE=26]="ERASE",BLEND_MODES4[BLEND_MODES4.SUBTRACT=28]="SUBTRACT",BLEND_MODES4[BLEND_MODES4.XOR=29]="XOR"})(BLEND_MODES3||(BLEND_MODES3={}));var DRAW_MODES3;(function(DRAW_MODES4){DRAW_MODES4[DRAW_MODES4.POINTS=0]="POINTS",DRAW_MODES4[DRAW_MODES4.LINES=1]="LINES",DRAW_MODES4[DRAW_MODES4.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES4[DRAW_MODES4.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES4[DRAW_MODES4.TRIANGLES=4]="TRIANGLES",DRAW_MODES4[DRAW_MODES4.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES4[DRAW_MODES4.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(DRAW_MODES3||(DRAW_MODES3={}));var FORMATS3;(function(FORMATS4){FORMATS4[FORMATS4.RGBA=6408]="RGBA",FORMATS4[FORMATS4.RGB=6407]="RGB",FORMATS4[FORMATS4.ALPHA=6406]="ALPHA",FORMATS4[FORMATS4.LUMINANCE=6409]="LUMINANCE",FORMATS4[FORMATS4.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS4[FORMATS4.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS4[FORMATS4.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(FORMATS3||(FORMATS3={}));var TARGETS3;(function(TARGETS4){TARGETS4[TARGETS4.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS4[TARGETS4.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS4[TARGETS4.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(TARGETS3||(TARGETS3={}));var TYPES3;(function(TYPES4){TYPES4[TYPES4.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES4[TYPES4.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES4[TYPES4.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES4[TYPES4.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES4[TYPES4.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES4[TYPES4.FLOAT=5126]="FLOAT",TYPES4[TYPES4.HALF_FLOAT=36193]="HALF_FLOAT"})(TYPES3||(TYPES3={}));var SAMPLER_TYPES3;(function(SAMPLER_TYPES4){SAMPLER_TYPES4[SAMPLER_TYPES4.FLOAT=0]="FLOAT",SAMPLER_TYPES4[SAMPLER_TYPES4.INT=1]="INT",SAMPLER_TYPES4[SAMPLER_TYPES4.UINT=2]="UINT"})(SAMPLER_TYPES3||(SAMPLER_TYPES3={}));var SCALE_MODES3;(function(SCALE_MODES4){SCALE_MODES4[SCALE_MODES4.NEAREST=0]="NEAREST",SCALE_MODES4[SCALE_MODES4.LINEAR=1]="LINEAR"})(SCALE_MODES3||(SCALE_MODES3={}));var WRAP_MODES3;(function(WRAP_MODES4){WRAP_MODES4[WRAP_MODES4.CLAMP=33071]="CLAMP",WRAP_MODES4[WRAP_MODES4.REPEAT=10497]="REPEAT",WRAP_MODES4[WRAP_MODES4.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(WRAP_MODES3||(WRAP_MODES3={}));var MIPMAP_MODES3;(function(MIPMAP_MODES4){MIPMAP_MODES4[MIPMAP_MODES4.OFF=0]="OFF",MIPMAP_MODES4[MIPMAP_MODES4.POW2=1]="POW2",MIPMAP_MODES4[MIPMAP_MODES4.ON=2]="ON",MIPMAP_MODES4[MIPMAP_MODES4.ON_MANUAL=3]="ON_MANUAL"})(MIPMAP_MODES3||(MIPMAP_MODES3={}));var ALPHA_MODES3;(function(ALPHA_MODES4){ALPHA_MODES4[ALPHA_MODES4.NPM=0]="NPM",ALPHA_MODES4[ALPHA_MODES4.UNPACK=1]="UNPACK",ALPHA_MODES4[ALPHA_MODES4.PMA=2]="PMA",ALPHA_MODES4[ALPHA_MODES4.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES4[ALPHA_MODES4.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES4[ALPHA_MODES4.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(ALPHA_MODES3||(ALPHA_MODES3={}));var CLEAR_MODES3;(function(CLEAR_MODES4){CLEAR_MODES4[CLEAR_MODES4.NO=0]="NO",CLEAR_MODES4[CLEAR_MODES4.YES=1]="YES",CLEAR_MODES4[CLEAR_MODES4.AUTO=2]="AUTO",CLEAR_MODES4[CLEAR_MODES4.BLEND=0]="BLEND",CLEAR_MODES4[CLEAR_MODES4.CLEAR=1]="CLEAR",CLEAR_MODES4[CLEAR_MODES4.BLIT=2]="BLIT"})(CLEAR_MODES3||(CLEAR_MODES3={}));var GC_MODES3;(function(GC_MODES4){GC_MODES4[GC_MODES4.AUTO=0]="AUTO",GC_MODES4[GC_MODES4.MANUAL=1]="MANUAL"})(GC_MODES3||(GC_MODES3={}));var PRECISION3;(function(PRECISION4){PRECISION4.LOW="lowp",PRECISION4.MEDIUM="mediump",PRECISION4.HIGH="highp"})(PRECISION3||(PRECISION3={}));var MASK_TYPES3;(function(MASK_TYPES4){MASK_TYPES4[MASK_TYPES4.NONE=0]="NONE",MASK_TYPES4[MASK_TYPES4.SCISSOR=1]="SCISSOR",MASK_TYPES4[MASK_TYPES4.STENCIL=2]="STENCIL",MASK_TYPES4[MASK_TYPES4.SPRITE=3]="SPRITE"})(MASK_TYPES3||(MASK_TYPES3={}));var MSAA_QUALITY3;(function(MSAA_QUALITY4){MSAA_QUALITY4[MSAA_QUALITY4.NONE=0]="NONE",MSAA_QUALITY4[MSAA_QUALITY4.LOW=2]="LOW",MSAA_QUALITY4[MSAA_QUALITY4.MEDIUM=4]="MEDIUM",MSAA_QUALITY4[MSAA_QUALITY4.HIGH=8]="HIGH"})(MSAA_QUALITY3||(MSAA_QUALITY3={}));var BlurFilterPass=function(_super){__extends15(BlurFilterPass2,_super);function BlurFilterPass2(horizontal,strength,quality,resolution,kernelSize){strength===void 0&&(strength=8),quality===void 0&&(quality=4),resolution===void 0&&(resolution=settings.FILTER_RESOLUTION),kernelSize===void 0&&(kernelSize=5);var _this=this,vertSrc=generateBlurVertSource(kernelSize,horizontal),fragSrc=generateBlurFragSource(kernelSize);return _this=_super.call(this,vertSrc,fragSrc)||this,_this.horizontal=horizontal,_this.resolution=resolution,_this._quality=0,_this.quality=quality,_this.blur=strength,_this}return BlurFilterPass2.prototype.apply=function(filterManager,input,output,clearMode){if(output?this.horizontal?this.uniforms.strength=1/output.width*(output.width/input.width):this.uniforms.strength=1/output.height*(output.height/input.height):this.horizontal?this.uniforms.strength=1/filterManager.renderer.width*(filterManager.renderer.width/input.width):this.uniforms.strength=1/filterManager.renderer.height*(filterManager.renderer.height/input.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)filterManager.applyFilter(this,input,output,clearMode);else{var renderTarget=filterManager.getFilterTexture(),renderer=filterManager.renderer,flip=input,flop=renderTarget;this.state.blend=!1,filterManager.applyFilter(this,flip,flop,CLEAR_MODES3.CLEAR);for(var i=1;i<this.passes-1;i++){filterManager.bindAndClear(flip,CLEAR_MODES3.BLIT),this.uniforms.uSampler=flop;var temp2=flop;flop=flip,flip=temp2,renderer.shader.bind(this),renderer.geometry.draw(5)}this.state.blend=!0,filterManager.applyFilter(this,flop,output,clearMode),filterManager.returnFilterTexture(renderTarget)}},Object.defineProperty(BlurFilterPass2.prototype,"blur",{get:function(){return this.strength},set:function(value){this.padding=1+Math.abs(value)*2,this.strength=value},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilterPass2.prototype,"quality",{get:function(){return this._quality},set:function(value){this._quality=value,this.passes=value},enumerable:!1,configurable:!0}),BlurFilterPass2}(Filter),BlurFilter=function(_super){__extends15(BlurFilter2,_super);function BlurFilter2(strength,quality,resolution,kernelSize){strength===void 0&&(strength=8),quality===void 0&&(quality=4),resolution===void 0&&(resolution=settings.FILTER_RESOLUTION),kernelSize===void 0&&(kernelSize=5);var _this=_super.call(this)||this;return _this.blurXFilter=new BlurFilterPass(!0,strength,quality,resolution,kernelSize),_this.blurYFilter=new BlurFilterPass(!1,strength,quality,resolution,kernelSize),_this.resolution=resolution,_this.quality=quality,_this.blur=strength,_this.repeatEdgePixels=!1,_this}return BlurFilter2.prototype.apply=function(filterManager,input,output,clearMode){var xStrength=Math.abs(this.blurXFilter.strength),yStrength=Math.abs(this.blurYFilter.strength);if(xStrength&&yStrength){var renderTarget=filterManager.getFilterTexture();this.blurXFilter.apply(filterManager,input,renderTarget,CLEAR_MODES3.CLEAR),this.blurYFilter.apply(filterManager,renderTarget,output,clearMode),filterManager.returnFilterTexture(renderTarget)}else yStrength?this.blurYFilter.apply(filterManager,input,output,clearMode):this.blurXFilter.apply(filterManager,input,output,clearMode)},BlurFilter2.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(BlurFilter2.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYFilter.blur=value,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter2.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(value){this.blurXFilter.quality=this.blurYFilter.quality=value},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter2.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter2.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter2.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(value){this.blurYFilter.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter2.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(value){this._repeatEdgePixels=value,this.updatePadding()},enumerable:!1,configurable:!0}),BlurFilter2}(Filter);var extendStatics16=function(d,b){return extendStatics16=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics16(d,b)};function __extends16(d,b){extendStatics16(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var fragment6=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,ColorMatrixFilter=function(_super){__extends16(ColorMatrixFilter2,_super);function ColorMatrixFilter2(){var _this=this,uniforms={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return _this=_super.call(this,defaultFilterVertex,fragment6,uniforms)||this,_this.alpha=1,_this}return ColorMatrixFilter2.prototype._loadMatrix=function(matrix,multiply2){multiply2===void 0&&(multiply2=!1);var newMatrix=matrix;multiply2&&(this._multiply(newMatrix,this.uniforms.m,matrix),newMatrix=this._colorMatrix(newMatrix)),this.uniforms.m=newMatrix},ColorMatrixFilter2.prototype._multiply=function(out,a,b){return out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15],out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16],out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17],out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18],out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4],out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15],out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16],out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17],out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18],out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9],out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15],out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16],out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17],out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18],out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14],out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15],out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16],out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17],out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18],out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19],out},ColorMatrixFilter2.prototype._colorMatrix=function(matrix){var m=new Float32Array(matrix);return m[4]/=255,m[9]/=255,m[14]/=255,m[19]/=255,m},ColorMatrixFilter2.prototype.brightness=function(b,multiply2){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.greyscale=function(scale,multiply2){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.blackAndWhite=function(multiply2){var matrix=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.hue=function(rotation,multiply2){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation),sinR=Math.sin(rotation),sqrt=Math.sqrt,w=1/3,sqrW=sqrt(w),a00=cosR+(1-cosR)*w,a01=w*(1-cosR)-sqrW*sinR,a02=w*(1-cosR)+sqrW*sinR,a10=w*(1-cosR)+sqrW*sinR,a11=cosR+w*(1-cosR),a12=w*(1-cosR)-sqrW*sinR,a20=w*(1-cosR)-sqrW*sinR,a21=w*(1-cosR)+sqrW*sinR,a22=cosR+w*(1-cosR),matrix=[a00,a01,a02,0,0,a10,a11,a12,0,0,a20,a21,a22,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.contrast=function(amount,multiply2){var v=(amount||0)+1,o=-.5*(v-1),matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.saturate=function(amount,multiply2){amount===void 0&&(amount=0);var x=amount*2/3+1,y=(x-1)*-.5,matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.desaturate=function(){this.saturate(-1)},ColorMatrixFilter2.prototype.negative=function(multiply2){var matrix=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.sepia=function(multiply2){var matrix=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.technicolor=function(multiply2){var matrix=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.polaroid=function(multiply2){var matrix=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.toBGR=function(multiply2){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.kodachrome=function(multiply2){var matrix=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.browni=function(multiply2){var matrix=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.vintage=function(multiply2){var matrix=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.colorTone=function(desaturation,toned,lightColor,darkColor,multiply2){desaturation=desaturation||.2,toned=toned||.15,lightColor=lightColor||16770432,darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255,lG=(lightColor>>8&255)/255,lB=(lightColor&255)/255,dR=(darkColor>>16&255)/255,dG=(darkColor>>8&255)/255,dB=(darkColor&255)/255,matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.night=function(intensity,multiply2){intensity=intensity||.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.predator=function(amount,multiply2){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.lsd=function(multiply2){var matrix=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply2)},ColorMatrixFilter2.prototype.reset=function(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,!1)},Object.defineProperty(ColorMatrixFilter2.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(value){this.uniforms.m=value},enumerable:!1,configurable:!0}),Object.defineProperty(ColorMatrixFilter2.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(value){this.uniforms.uAlpha=value},enumerable:!1,configurable:!0}),ColorMatrixFilter2}(Filter);ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var extendStatics17=function(d,b){return extendStatics17=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics17(d,b)};function __extends17(d,b){extendStatics17(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var fragment7=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,vertex5=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,DisplacementFilter=function(_super){__extends17(DisplacementFilter2,_super);function DisplacementFilter2(sprite,scale){var _this=this,maskMatrix=new Matrix;return sprite.renderable=!1,_this=_super.call(this,vertex5,fragment7,{mapSampler:sprite._texture,filterMatrix:maskMatrix,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,_this.maskSprite=sprite,_this.maskMatrix=maskMatrix,scale==null&&(scale=20),_this.scale=new Point(scale,scale),_this}return DisplacementFilter2.prototype.apply=function(filterManager,input,output,clearMode){this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var wt=this.maskSprite.worldTransform,lenX=Math.sqrt(wt.a*wt.a+wt.b*wt.b),lenY=Math.sqrt(wt.c*wt.c+wt.d*wt.d);lenX!==0&&lenY!==0&&(this.uniforms.rotation[0]=wt.a/lenX,this.uniforms.rotation[1]=wt.b/lenX,this.uniforms.rotation[2]=wt.c/lenY,this.uniforms.rotation[3]=wt.d/lenY),filterManager.applyFilter(this,input,output,clearMode)},Object.defineProperty(DisplacementFilter2.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(value){this.uniforms.mapSampler=value},enumerable:!1,configurable:!0}),DisplacementFilter2}(Filter);var extendStatics18=function(d,b){return extendStatics18=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics18(d,b)};function __extends18(d,b){extendStatics18(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var vertex6=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,fragment8=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,FXAAFilter=function(_super){__extends18(FXAAFilter2,_super);function FXAAFilter2(){return _super.call(this,vertex6,fragment8)||this}return FXAAFilter2}(Filter);var extendStatics19=function(d,b){return extendStatics19=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics19(d,b)};function __extends19(d,b){extendStatics19(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var fragment9=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,NoiseFilter=function(_super){__extends19(NoiseFilter2,_super);function NoiseFilter2(noise,seed){noise===void 0&&(noise=.5),seed===void 0&&(seed=Math.random());var _this=_super.call(this,defaultFilterVertex,fragment9,{uNoise:0,uSeed:0})||this;return _this.noise=noise,_this.seed=seed,_this}return Object.defineProperty(NoiseFilter2.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(value){this.uniforms.uNoise=value},enumerable:!1,configurable:!0}),Object.defineProperty(NoiseFilter2.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(value){this.uniforms.uSeed=value},enumerable:!1,configurable:!0}),NoiseFilter2}(Filter);var _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;var CacheData=function(){function CacheData2(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return CacheData2}();Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(resolution){resolution!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=resolution,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(value){if(this._cacheAsBitmap!==value){this._cacheAsBitmap=value;var data;value?(this._cacheData||(this._cacheData=new CacheData),data=this._cacheData,data.originalRender=this.render,data.originalRenderCanvas=this.renderCanvas,data.originalUpdateTransform=this.updateTransform,data.originalCalculateBounds=this.calculateBounds,data.originalGetLocalBounds=this.getLocalBounds,data.originalDestroy=this.destroy,data.originalContainsPoint=this.containsPoint,data.originalMask=this._mask,data.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(data=this._cacheData,data.sprite&&this._destroyCachedDisplayObject(),this.render=data.originalRender,this.renderCanvas=data.originalRenderCanvas,this.calculateBounds=data.originalCalculateBounds,this.getLocalBounds=data.originalGetLocalBounds,this.destroy=data.originalDestroy,this.updateTransform=data.originalUpdateTransform,this.containsPoint=data.originalContainsPoint,this._mask=data.originalMask,this.filterArea=data.originalFilterArea)}}}});DisplayObject.prototype._renderCached=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(renderer),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(renderer))};DisplayObject.prototype._initCachedDisplayObject=function(renderer){if(!(this._cacheData&&this._cacheData.sprite)){var cacheAlpha=this.alpha;this.alpha=1,renderer.batch.flush();var bounds=this.getLocalBounds(null,!0).clone();if(this.filters){var padding=this.filters[0].padding;bounds.pad(padding)}bounds.ceil(settings.RESOLUTION);var cachedRenderTexture=renderer.renderTexture.current,cachedSourceFrame=renderer.renderTexture.sourceFrame.clone(),cachedDestinationFrame=renderer.renderTexture.destinationFrame.clone(),cachedProjectionTransform=renderer.projection.transform,renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height,resolution:this.cacheAsBitmapResolution||renderer.resolution}),textureCacheId="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=textureCacheId,BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId),Texture.addToCache(renderTexture,textureCacheId);var m=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-bounds.x,-bounds.y);this.render=this._cacheData.originalRender,renderer.render(this,{renderTexture,clear:!0,transform:m,skipUpdateTransform:!1}),renderer.projection.transform=cachedProjectionTransform,renderer.renderTexture.bind(cachedRenderTexture,cachedSourceFrame,cachedDestinationFrame),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=cacheAlpha;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-(bounds.x/bounds.width),cachedSprite.anchor.y=-(bounds.y/bounds.height),cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)}};DisplayObject.prototype._renderCachedCanvas=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(renderer),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(renderer))};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(renderer){if(!(this._cacheData&&this._cacheData.sprite)){var bounds=this.getLocalBounds(null,!0),cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.context,cachedProjectionTransform=renderer._projTransform;bounds.ceil(settings.RESOLUTION);var renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height}),textureCacheId="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=textureCacheId,BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId),Texture.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copyTo(m),m.invert(),m.tx-=bounds.x,m.ty-=bounds.y,this.renderCanvas=this._cacheData.originalRenderCanvas,renderer.render(this,{renderTexture,clear:!0,transform:m,skipUpdateTransform:!1}),renderer.context=cachedRenderTarget,renderer._projTransform=cachedProjectionTransform,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=cacheAlpha;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-(bounds.x/bounds.width),cachedSprite.anchor.y=-(bounds.y/bounds.height),cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=renderer._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)}};DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(options){this.cacheAsBitmap=!1,this.destroy(options)};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function(name,deep){for(var i=0,j=this.children.length;i<j;i++)if(this.children[i].name===name)return this.children[i];if(deep)for(var i=0,j=this.children.length;i<j;i++){var child=this.children[i];if(!!child.getChildByName){var target=this.children[i].getChildByName(name,!0);if(target)return target}}return null};DisplayObject.prototype.getGlobalPosition=function(point,skipUpdate){return point===void 0&&(point=new Point),skipUpdate===void 0&&(skipUpdate=!1),this.parent?this.parent.toGlobal(this.position,point,skipUpdate):(point.x=this.position.x,point.y=this.position.y),point};var extendStatics20=function(d,b){return extendStatics20=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics20(d,b)};function __extends20(d,b){extendStatics20(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var PlaneGeometry=function(_super){__extends20(PlaneGeometry2,_super);function PlaneGeometry2(width,height,segWidth,segHeight){width===void 0&&(width=100),height===void 0&&(height=100),segWidth===void 0&&(segWidth=10),segHeight===void 0&&(segHeight=10);var _this=_super.call(this)||this;return _this.segWidth=segWidth,_this.segHeight=segHeight,_this.width=width,_this.height=height,_this.build(),_this}return PlaneGeometry2.prototype.build=function(){for(var total=this.segWidth*this.segHeight,verts=[],uvs=[],indices2=[],segmentsX=this.segWidth-1,segmentsY=this.segHeight-1,sizeX=this.width/segmentsX,sizeY=this.height/segmentsY,i=0;i<total;i++){var x=i%this.segWidth,y=i/this.segWidth|0;verts.push(x*sizeX,y*sizeY),uvs.push(x/segmentsX,y/segmentsY)}for(var totalSub=segmentsX*segmentsY,i=0;i<totalSub;i++){var xpos=i%segmentsX,ypos=i/segmentsX|0,value=ypos*this.segWidth+xpos,value2=ypos*this.segWidth+xpos+1,value3=(ypos+1)*this.segWidth+xpos,value4=(ypos+1)*this.segWidth+xpos+1;indices2.push(value,value2,value3,value2,value4,value3)}this.buffers[0].data=new Float32Array(verts),this.buffers[1].data=new Float32Array(uvs),this.indexBuffer.data=new Uint16Array(indices2),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},PlaneGeometry2}(MeshGeometry),RopeGeometry=function(_super){__extends20(RopeGeometry2,_super);function RopeGeometry2(width,points,textureScale){width===void 0&&(width=200),textureScale===void 0&&(textureScale=0);var _this=_super.call(this,new Float32Array(points.length*4),new Float32Array(points.length*4),new Uint16Array((points.length-1)*6))||this;return _this.points=points,_this._width=width,_this.textureScale=textureScale,_this.build(),_this}return Object.defineProperty(RopeGeometry2.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),RopeGeometry2.prototype.build=function(){var points=this.points;if(!!points){var vertexBuffer=this.getBuffer("aVertexPosition"),uvBuffer=this.getBuffer("aTextureCoord"),indexBuffer=this.getIndex();if(!(points.length<1)){vertexBuffer.data.length/4!==points.length&&(vertexBuffer.data=new Float32Array(points.length*4),uvBuffer.data=new Float32Array(points.length*4),indexBuffer.data=new Uint16Array((points.length-1)*6));var uvs=uvBuffer.data,indices2=indexBuffer.data;uvs[0]=0,uvs[1]=0,uvs[2]=0,uvs[3]=1;for(var amount=0,prev=points[0],textureWidth=this._width*this.textureScale,total=points.length,i=0;i<total;i++){var index3=i*4;if(this.textureScale>0){var dx=prev.x-points[i].x,dy=prev.y-points[i].y,distance=Math.sqrt(dx*dx+dy*dy);prev=points[i],amount+=distance/textureWidth}else amount=i/(total-1);uvs[index3]=amount,uvs[index3+1]=0,uvs[index3+2]=amount,uvs[index3+3]=1}for(var indexCount=0,i=0;i<total-1;i++){var index3=i*2;indices2[indexCount++]=index3,indices2[indexCount++]=index3+1,indices2[indexCount++]=index3+2,indices2[indexCount++]=index3+2,indices2[indexCount++]=index3+1,indices2[indexCount++]=index3+3}uvBuffer.update(),indexBuffer.update(),this.updateVertices()}}},RopeGeometry2.prototype.updateVertices=function(){var points=this.points;if(!(points.length<1)){for(var lastPoint=points[0],nextPoint,perpX=0,perpY=0,vertices=this.buffers[0].data,total=points.length,i=0;i<total;i++){var point=points[i],index3=i*4;i<points.length-1?nextPoint=points[i+1]:nextPoint=point,perpY=-(nextPoint.x-lastPoint.x),perpX=nextPoint.y-lastPoint.y;var perpLength=Math.sqrt(perpX*perpX+perpY*perpY),num=this.textureScale>0?this.textureScale*this._width/2:this._width/2;perpX/=perpLength,perpY/=perpLength,perpX*=num,perpY*=num,vertices[index3]=point.x+perpX,vertices[index3+1]=point.y+perpY,vertices[index3+2]=point.x-perpX,vertices[index3+3]=point.y-perpY,lastPoint=point}this.buffers[0].update()}},RopeGeometry2.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},RopeGeometry2}(MeshGeometry),SimpleRope=function(_super){__extends20(SimpleRope2,_super);function SimpleRope2(texture,points,textureScale){textureScale===void 0&&(textureScale=0);var _this=this,ropeGeometry=new RopeGeometry(texture.height,points,textureScale),meshMaterial=new MeshMaterial(texture);return textureScale>0&&(texture.baseTexture.wrapMode=WRAP_MODES2.REPEAT),_this=_super.call(this,ropeGeometry,meshMaterial)||this,_this.autoUpdate=!0,_this}return SimpleRope2.prototype._render=function(renderer){var geometry=this.geometry;(this.autoUpdate||geometry._width!==this.shader.texture.height)&&(geometry._width=this.shader.texture.height,geometry.update()),_super.prototype._render.call(this,renderer)},SimpleRope2}(Mesh),SimplePlane=function(_super){__extends20(SimplePlane2,_super);function SimplePlane2(texture,verticesX,verticesY){var _this=this,planeGeometry=new PlaneGeometry(texture.width,texture.height,verticesX,verticesY),meshMaterial=new MeshMaterial(Texture.WHITE);return _this=_super.call(this,planeGeometry,meshMaterial)||this,_this.texture=texture,_this}return SimplePlane2.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var geometry=this.geometry;geometry.width=this.shader.texture.width,geometry.height=this.shader.texture.height,geometry.build()},Object.defineProperty(SimplePlane2.prototype,"texture",{get:function(){return this.shader.texture},set:function(value){this.shader.texture!==value&&(this.shader.texture=value,this._textureID=-1,value.baseTexture.valid?this.textureUpdated():value.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),SimplePlane2.prototype._render=function(renderer){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),_super.prototype._render.call(this,renderer)},SimplePlane2.prototype.destroy=function(options){this.shader.texture.off("update",this.textureUpdated,this),_super.prototype.destroy.call(this,options)},SimplePlane2}(Mesh),SimpleMesh=function(_super){__extends20(SimpleMesh2,_super);function SimpleMesh2(texture,vertices,uvs,indices2,drawMode){texture===void 0&&(texture=Texture.EMPTY);var _this=this,geometry=new MeshGeometry(vertices,uvs,indices2);geometry.getBuffer("aVertexPosition").static=!1;var meshMaterial=new MeshMaterial(texture);return _this=_super.call(this,geometry,meshMaterial,null,drawMode)||this,_this.autoUpdate=!0,_this}return Object.defineProperty(SimpleMesh2.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(value){this.geometry.getBuffer("aVertexPosition").data=value},enumerable:!1,configurable:!0}),SimpleMesh2.prototype._render=function(renderer){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),_super.prototype._render.call(this,renderer)},SimpleMesh2}(Mesh),DEFAULT_BORDER_SIZE=10,NineSlicePlane=function(_super){__extends20(NineSlicePlane2,_super);function NineSlicePlane2(texture,leftWidth,topHeight,rightWidth,bottomHeight){leftWidth===void 0&&(leftWidth=DEFAULT_BORDER_SIZE),topHeight===void 0&&(topHeight=DEFAULT_BORDER_SIZE),rightWidth===void 0&&(rightWidth=DEFAULT_BORDER_SIZE),bottomHeight===void 0&&(bottomHeight=DEFAULT_BORDER_SIZE);var _this=_super.call(this,Texture.WHITE,4,4)||this;return _this._origWidth=texture.orig.width,_this._origHeight=texture.orig.height,_this._width=_this._origWidth,_this._height=_this._origHeight,_this._leftWidth=leftWidth,_this._rightWidth=rightWidth,_this._topHeight=topHeight,_this._bottomHeight=bottomHeight,_this.texture=texture,_this}return NineSlicePlane2.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(NineSlicePlane2.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(value){this.geometry.getBuffer("aVertexPosition").data=value},enumerable:!1,configurable:!0}),NineSlicePlane2.prototype.updateHorizontalVertices=function(){var vertices=this.vertices,scale=this._getMinScale();vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight*scale,vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight*scale,vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height},NineSlicePlane2.prototype.updateVerticalVertices=function(){var vertices=this.vertices,scale=this._getMinScale();vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth*scale,vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth*scale,vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width},NineSlicePlane2.prototype._getMinScale=function(){var w=this._leftWidth+this._rightWidth,scaleW=this._width>w?1:this._width/w,h=this._topHeight+this._bottomHeight,scaleH=this._height>h?1:this._height/h,scale=Math.min(scaleW,scaleH);return scale},Object.defineProperty(NineSlicePlane2.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane2.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane2.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(value){this._leftWidth=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane2.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(value){this._rightWidth=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane2.prototype,"topHeight",{get:function(){return this._topHeight},set:function(value){this._topHeight=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane2.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(value){this._bottomHeight=value,this._refresh()},enumerable:!1,configurable:!0}),NineSlicePlane2.prototype._refresh=function(){var texture=this.texture,uvs=this.geometry.buffers[1].data;this._origWidth=texture.orig.width,this._origHeight=texture.orig.height;var _uvw=1/this._origWidth,_uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0,uvs[1]=uvs[3]=uvs[5]=uvs[7]=0,uvs[6]=uvs[14]=uvs[22]=uvs[30]=1,uvs[25]=uvs[27]=uvs[29]=uvs[31]=1,uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth,uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth,uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight,uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},NineSlicePlane2}(SimplePlane);var extendStatics21=function(d,b){return extendStatics21=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics21(d,b)};function __extends21(d,b){extendStatics21(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var AnimatedSprite=function(_super){__extends21(AnimatedSprite2,_super);function AnimatedSprite2(textures,autoUpdate){autoUpdate===void 0&&(autoUpdate=!0);var _this=_super.call(this,textures[0]instanceof Texture?textures[0]:textures[0].texture)||this;return _this._textures=null,_this._durations=null,_this._autoUpdate=autoUpdate,_this._isConnectedToTicker=!1,_this.animationSpeed=1,_this.loop=!0,_this.updateAnchor=!1,_this.onComplete=null,_this.onFrameChange=null,_this.onLoop=null,_this._currentTime=0,_this._playing=!1,_this._previousFrame=null,_this.textures=textures,_this}return AnimatedSprite2.prototype.stop=function(){!this._playing||(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))},AnimatedSprite2.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},AnimatedSprite2.prototype.gotoAndStop=function(frameNumber){this.stop();var previousFrame=this.currentFrame;this._currentTime=frameNumber,previousFrame!==this.currentFrame&&this.updateTexture()},AnimatedSprite2.prototype.gotoAndPlay=function(frameNumber){var previousFrame=this.currentFrame;this._currentTime=frameNumber,previousFrame!==this.currentFrame&&this.updateTexture(),this.play()},AnimatedSprite2.prototype.update=function(deltaTime){if(!!this._playing){var elapsed=this.animationSpeed*deltaTime,previousFrame=this.currentFrame;if(this._durations!==null){var lag=this._currentTime%1*this._durations[this.currentFrame];for(lag+=elapsed/60*1e3;lag<0;)this._currentTime--,lag+=this._durations[this.currentFrame];var sign2=Math.sign(this.animationSpeed*deltaTime);for(this._currentTime=Math.floor(this._currentTime);lag>=this._durations[this.currentFrame];)lag-=this._durations[this.currentFrame]*sign2,this._currentTime+=sign2;this._currentTime+=lag/this._durations[this.currentFrame]}else this._currentTime+=elapsed;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):previousFrame!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<previousFrame?this.onLoop():this.animationSpeed<0&&this.currentFrame>previousFrame&&this.onLoop()),this.updateTexture())}},AnimatedSprite2.prototype.updateTexture=function(){var currentFrame=this.currentFrame;this._previousFrame!==currentFrame&&(this._previousFrame=currentFrame,this._texture=this._textures[currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},AnimatedSprite2.prototype.destroy=function(options){this.stop(),_super.prototype.destroy.call(this,options),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},AnimatedSprite2.fromFrames=function(frames){for(var textures=[],i=0;i<frames.length;++i)textures.push(Texture.from(frames[i]));return new AnimatedSprite2(textures)},AnimatedSprite2.fromImages=function(images){for(var textures=[],i=0;i<images.length;++i)textures.push(Texture.from(images[i]));return new AnimatedSprite2(textures)},Object.defineProperty(AnimatedSprite2.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite2.prototype,"textures",{get:function(){return this._textures},set:function(value){if(value[0]instanceof Texture)this._textures=value,this._durations=null;else{this._textures=[],this._durations=[];for(var i=0;i<value.length;i++)this._textures.push(value[i].texture),this._durations.push(value[i].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite2.prototype,"currentFrame",{get:function(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;return currentFrame<0&&(currentFrame+=this._textures.length),currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite2.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite2.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),AnimatedSprite2}(Sprite);Renderer.registerPlugin("accessibility",AccessibilityManager);Renderer.registerPlugin("extract",Extract);Renderer.registerPlugin("interaction",InteractionManager);Renderer.registerPlugin("particle",ParticleRenderer);Renderer.registerPlugin("prepare",Prepare);Renderer.registerPlugin("batch",BatchRenderer);Renderer.registerPlugin("tilingSprite",TilingSpriteRenderer);Loader2.registerPlugin(BitmapFontLoader);Loader2.registerPlugin(CompressedTextureLoader);Loader2.registerPlugin(DDSLoader);Loader2.registerPlugin(KTXLoader);Loader2.registerPlugin(SpritesheetLoader);Application.registerPlugin(TickerPlugin);Application.registerPlugin(AppLoaderPlugin);var filters={AlphaFilter,BlurFilter,BlurFilterPass,ColorMatrixFilter,DisplacementFilter,FXAAFilter,NoiseFilter};var extendStatics22=function(d,b){return extendStatics22=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics22(d,b)};function __extends22(d,b){extendStatics22(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var CanvasMaskManager=function(){function CanvasMaskManager2(renderer){this.renderer=renderer,this._foundShapes=[]}return CanvasMaskManager2.prototype.pushMask=function(maskData){var renderer=this.renderer,maskObject=maskData.maskObject||maskData;renderer.context.save();var foundShapes=this._foundShapes;if(this.recursiveFindShapes(maskObject,foundShapes),foundShapes.length>0){var context4=renderer.context;context4.beginPath();for(var i=0;i<foundShapes.length;i++){var shape=foundShapes[i],transform=shape.transform.worldTransform;this.renderer.setContextTransform(transform),this.renderGraphicsShape(shape)}foundShapes.length=0,context4.clip()}},CanvasMaskManager2.prototype.recursiveFindShapes=function(container,out){container.geometry&&container.geometry.graphicsData&&out.push(container);var children=container.children;if(children)for(var i=0;i<children.length;i++)this.recursiveFindShapes(children[i],out)},CanvasMaskManager2.prototype.renderGraphicsShape=function(graphics){graphics.finishPoly();var context4=this.renderer.context,graphicsData=graphics.geometry.graphicsData,len2=graphicsData.length;if(len2!==0)for(var i=0;i<len2;i++){var data=graphicsData[i],shape=data.shape;if(shape.type===SHAPES.POLY){var points=shape.points;context4.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context4.lineTo(points[j*2],points[j*2+1]);points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context4.closePath()}else if(shape.type===SHAPES.RECT)context4.rect(shape.x,shape.y,shape.width,shape.height),context4.closePath();else if(shape.type===SHAPES.CIRC)context4.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context4.closePath();else if(shape.type===SHAPES.ELIP){var w=shape.width*2,h=shape.height*2,x=shape.x-w/2,y=shape.y-h/2,kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context4.moveTo(x,ym),context4.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context4.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context4.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context4.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context4.closePath()}else if(shape.type===SHAPES.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context4.moveTo(rx,ry+radius),context4.lineTo(rx,ry+height-radius),context4.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context4.lineTo(rx+width-radius,ry+height),context4.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context4.lineTo(rx+width,ry+radius),context4.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context4.lineTo(rx+radius,ry),context4.quadraticCurveTo(rx,ry,rx,ry+radius),context4.closePath()}}},CanvasMaskManager2.prototype.popMask=function(renderer){renderer.context.restore(),renderer.invalidateBlendMode()},CanvasMaskManager2.prototype.destroy=function(){},CanvasMaskManager2}();function createColoredCanvas(color){var canvas2=document.createElement("canvas");canvas2.width=6,canvas2.height=1;var context4=canvas2.getContext("2d");return context4.fillStyle=color,context4.fillRect(0,0,6,1),canvas2}function canUseNewCanvasBlendModes(){if(typeof document=="undefined")return!1;var magenta2=createColoredCanvas("#ff00ff"),yellow2=createColoredCanvas("#ffff00"),canvas2=document.createElement("canvas");canvas2.width=6,canvas2.height=1;var context4=canvas2.getContext("2d");context4.globalCompositeOperation="multiply",context4.drawImage(magenta2,0,0),context4.drawImage(yellow2,2,0);var imageData=context4.getImageData(2,0,1,1);if(!imageData)return!1;var data=imageData.data;return data[0]===255&&data[1]===0&&data[2]===0}function mapCanvasBlendModesToPixi(array){return array===void 0&&(array=[]),canUseNewCanvasBlendModes()?(array[BLEND_MODES2.NORMAL]="source-over",array[BLEND_MODES2.ADD]="lighter",array[BLEND_MODES2.MULTIPLY]="multiply",array[BLEND_MODES2.SCREEN]="screen",array[BLEND_MODES2.OVERLAY]="overlay",array[BLEND_MODES2.DARKEN]="darken",array[BLEND_MODES2.LIGHTEN]="lighten",array[BLEND_MODES2.COLOR_DODGE]="color-dodge",array[BLEND_MODES2.COLOR_BURN]="color-burn",array[BLEND_MODES2.HARD_LIGHT]="hard-light",array[BLEND_MODES2.SOFT_LIGHT]="soft-light",array[BLEND_MODES2.DIFFERENCE]="difference",array[BLEND_MODES2.EXCLUSION]="exclusion",array[BLEND_MODES2.HUE]="hue",array[BLEND_MODES2.SATURATION]="saturate",array[BLEND_MODES2.COLOR]="color",array[BLEND_MODES2.LUMINOSITY]="luminosity"):(array[BLEND_MODES2.NORMAL]="source-over",array[BLEND_MODES2.ADD]="lighter",array[BLEND_MODES2.MULTIPLY]="source-over",array[BLEND_MODES2.SCREEN]="source-over",array[BLEND_MODES2.OVERLAY]="source-over",array[BLEND_MODES2.DARKEN]="source-over",array[BLEND_MODES2.LIGHTEN]="source-over",array[BLEND_MODES2.COLOR_DODGE]="source-over",array[BLEND_MODES2.COLOR_BURN]="source-over",array[BLEND_MODES2.HARD_LIGHT]="source-over",array[BLEND_MODES2.SOFT_LIGHT]="source-over",array[BLEND_MODES2.DIFFERENCE]="source-over",array[BLEND_MODES2.EXCLUSION]="source-over",array[BLEND_MODES2.HUE]="source-over",array[BLEND_MODES2.SATURATION]="source-over",array[BLEND_MODES2.COLOR]="source-over",array[BLEND_MODES2.LUMINOSITY]="source-over"),array[BLEND_MODES2.NORMAL_NPM]=array[BLEND_MODES2.NORMAL],array[BLEND_MODES2.ADD_NPM]=array[BLEND_MODES2.ADD],array[BLEND_MODES2.SCREEN_NPM]=array[BLEND_MODES2.SCREEN],array[BLEND_MODES2.SRC_IN]="source-in",array[BLEND_MODES2.SRC_OUT]="source-out",array[BLEND_MODES2.SRC_ATOP]="source-atop",array[BLEND_MODES2.DST_OVER]="destination-over",array[BLEND_MODES2.DST_IN]="destination-in",array[BLEND_MODES2.DST_OUT]="destination-out",array[BLEND_MODES2.DST_ATOP]="destination-atop",array[BLEND_MODES2.XOR]="xor",array[BLEND_MODES2.SUBTRACT]="source-over",array}var tempMatrix2=new Matrix,CanvasRenderer=function(_super){__extends22(CanvasRenderer2,_super);function CanvasRenderer2(options){var _this=_super.call(this,RENDERER_TYPE2.CANVAS,options)||this;if(_this.rootContext=_this.view.getContext("2d",{alpha:_this.useContextAlpha}),_this.context=_this.rootContext,_this.refresh=!0,_this.maskManager=new CanvasMaskManager(_this),_this.smoothProperty="imageSmoothingEnabled",!_this.rootContext.imageSmoothingEnabled){var rc=_this.rootContext;rc.webkitImageSmoothingEnabled?_this.smoothProperty="webkitImageSmoothingEnabled":rc.mozImageSmoothingEnabled?_this.smoothProperty="mozImageSmoothingEnabled":rc.oImageSmoothingEnabled?_this.smoothProperty="oImageSmoothingEnabled":rc.msImageSmoothingEnabled&&(_this.smoothProperty="msImageSmoothingEnabled")}return _this.initPlugins(CanvasRenderer2.__plugins),_this.blendModes=mapCanvasBlendModesToPixi(),_this._activeBlendMode=null,_this._outerBlend=!1,_this._projTransform=null,_this.renderingToScreen=!1,sayHello("Canvas"),_this.resize(_this.options.width,_this.options.height),_this}return CanvasRenderer2.prototype.render=function(displayObject,options){if(!!this.view){var renderTexture,clear,transform,skipUpdateTransform;options&&(options instanceof RenderTexture||options instanceof BaseRenderTexture?(deprecation("6.0.0","CanvasRenderer#render arguments changed, use options instead."),renderTexture=options,clear=arguments[2],transform=arguments[3],skipUpdateTransform=arguments[4]):(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform)),this.renderingToScreen=!renderTexture,this.emit("prerender");var rootResolution=this.resolution;renderTexture?(renderTexture=renderTexture.castToBaseTexture(),renderTexture._canvasRenderTarget||(renderTexture._canvasRenderTarget=new CanvasRenderTarget(renderTexture.width,renderTexture.height,renderTexture.resolution),renderTexture.resource=new CanvasResource(renderTexture._canvasRenderTarget.canvas),renderTexture.valid=!0),this.context=renderTexture._canvasRenderTarget.context,this.resolution=renderTexture._canvasRenderTarget.resolution):this.context=this.rootContext;var context4=this.context;if(this._projTransform=transform||null,renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}if(context4.save(),context4.setTransform(1,0,0,1,0,0),context4.globalAlpha=1,this._activeBlendMode=BLEND_MODES2.NORMAL,this._outerBlend=!1,context4.globalCompositeOperation=this.blendModes[BLEND_MODES2.NORMAL],clear!==void 0?clear:this.clearBeforeRender)if(this.renderingToScreen)context4.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(context4.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,context4.fillStyle=this._backgroundColorString,context4.fillRect(0,0,this.width,this.height),context4.globalAlpha=1);else{renderTexture=renderTexture,renderTexture._canvasRenderTarget.clear();var clearColor=renderTexture.clearColor;clearColor[3]>0&&(context4.globalAlpha=this.useContextAlpha?clearColor[3]:1,context4.fillStyle=hex2string(rgb2hex(clearColor)),context4.fillRect(0,0,renderTexture.realWidth,renderTexture.realHeight),context4.globalAlpha=1)}var tempContext=this.context;this.context=context4,displayObject.renderCanvas(this),this.context=tempContext,context4.restore(),this.resolution=rootResolution,this._projTransform=null,this.emit("postrender")}},CanvasRenderer2.prototype.setContextTransform=function(transform,roundPixels,localResolution){var mat=transform,proj=this._projTransform,resolution=this.resolution;localResolution=localResolution||resolution,proj&&(mat=tempMatrix2,mat.copyFrom(transform),mat.prepend(proj)),roundPixels?this.context.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*resolution|0,mat.ty*resolution|0):this.context.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*resolution,mat.ty*resolution)},CanvasRenderer2.prototype.clear=function(clearColor,alpha){clearColor===void 0&&(clearColor=this._backgroundColorString),alpha===void 0&&(alpha=this.backgroundAlpha);var context4=this.context;context4.clearRect(0,0,this.width,this.height),clearColor&&(context4.globalAlpha=this.useContextAlpha?alpha:1,context4.fillStyle=clearColor,context4.fillRect(0,0,this.width,this.height),context4.globalAlpha=1)},CanvasRenderer2.prototype.setBlendMode=function(blendMode,readyForOuterBlend){var outerBlend=blendMode===BLEND_MODES2.SRC_IN||blendMode===BLEND_MODES2.SRC_OUT||blendMode===BLEND_MODES2.DST_IN||blendMode===BLEND_MODES2.DST_ATOP;!readyForOuterBlend&&outerBlend&&(blendMode=BLEND_MODES2.NORMAL),this._activeBlendMode!==blendMode&&(this._activeBlendMode=blendMode,this._outerBlend=outerBlend,this.context.globalCompositeOperation=this.blendModes[blendMode])},CanvasRenderer2.prototype.destroy=function(removeView){_super.prototype.destroy.call(this,removeView),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},CanvasRenderer2.prototype.resize=function(screenWidth,screenHeight){_super.prototype.resize.call(this,screenWidth,screenHeight),this.smoothProperty&&(this.rootContext[this.smoothProperty]=settings.SCALE_MODE===SCALE_MODES2.LINEAR)},CanvasRenderer2.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},CanvasRenderer2.registerPlugin=function(pluginName,ctor){CanvasRenderer2.__plugins=CanvasRenderer2.__plugins||{},CanvasRenderer2.__plugins[pluginName]=ctor},CanvasRenderer2}(AbstractRenderer),canvasUtils={canvas:null,getTintedCanvas:function(sprite,color){var texture=sprite.texture;color=canvasUtils.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};var cachedCanvas=texture.tintCache[stringColor],canvas2;if(cachedCanvas){if(cachedCanvas.tintId===texture._updateID)return texture.tintCache[stringColor];canvas2=texture.tintCache[stringColor]}else canvas2=document.createElement("canvas");if(canvasUtils.tintMethod(texture,color,canvas2),canvas2.tintId=texture._updateID,canvasUtils.convertTintToImage){var tintImage=new Image;tintImage.src=canvas2.toDataURL(),texture.tintCache[stringColor]=tintImage}else texture.tintCache[stringColor]=canvas2;return canvas2},getTintedPattern:function(texture,color){color=canvasUtils.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.patternCache=texture.patternCache||{};var pattern=texture.patternCache[stringColor];return pattern&&pattern.tintId===texture._updateID||(canvasUtils.canvas||(canvasUtils.canvas=document.createElement("canvas")),canvasUtils.tintMethod(texture,color,canvasUtils.canvas),pattern=canvasUtils.canvas.getContext("2d").createPattern(canvasUtils.canvas,"repeat"),pattern.tintId=texture._updateID,texture.patternCache[stringColor]=pattern),pattern},tintWithMultiply:function(texture,color,canvas2){var context4=canvas2.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas2.width=Math.ceil(crop.width),canvas2.height=Math.ceil(crop.height),context4.save(),context4.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6),context4.fillRect(0,0,crop.width,crop.height),context4.globalCompositeOperation="multiply";var source=texture.baseTexture.getDrawableSource();context4.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context4.globalCompositeOperation="destination-atop",context4.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context4.restore()},tintWithOverlay:function(texture,color,canvas2){var context4=canvas2.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas2.width=Math.ceil(crop.width),canvas2.height=Math.ceil(crop.height),context4.save(),context4.globalCompositeOperation="copy",context4.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6),context4.fillRect(0,0,crop.width,crop.height),context4.globalCompositeOperation="destination-atop",context4.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context4.restore()},tintWithPerPixel:function(texture,color,canvas2){var context4=canvas2.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas2.width=Math.ceil(crop.width),canvas2.height=Math.ceil(crop.height),context4.save(),context4.globalCompositeOperation="copy",context4.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context4.restore();for(var rgbValues=hex2rgb(color),r=rgbValues[0],g=rgbValues[1],b=rgbValues[2],pixelData=context4.getImageData(0,0,crop.width,crop.height),pixels=pixelData.data,i=0;i<pixels.length;i+=4)pixels[i+0]*=r,pixels[i+1]*=g,pixels[i+2]*=b;context4.putImageData(pixelData,0,0)},roundColor:function(color){var step=canvasUtils.cacheStepsPerColorChannel,rgbValues=hex2rgb(color);return rgbValues[0]=Math.min(255,rgbValues[0]/step*step),rgbValues[1]=Math.min(255,rgbValues[1]/step*step),rgbValues[2]=Math.min(255,rgbValues[2]/step*step),rgb2hex(rgbValues)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:canUseNewCanvasBlendModes(),tintMethod:null};canvasUtils.tintMethod=canvasUtils.canUseMultiply?canvasUtils.tintWithMultiply:canvasUtils.tintWithPerPixel;var parentCreate=Renderer.create;Renderer.create=function(options){var forceCanvas=options&&options.forceCanvas;if(!forceCanvas)try{return parentCreate(options)}catch(err){}return new CanvasRenderer(options)};BaseTexture.prototype.getDrawableSource=function(){var resource=this.resource;return resource?resource.bitmap||resource.source:null};BaseRenderTexture.prototype._canvasRenderTarget=null;Texture.prototype.patternCache=null;Texture.prototype.tintCache=null;var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function createCommonjsModule(fn,basedir,module2){return module2={path:basedir,exports:{},require:function(path,base){return commonjsRequire(path,base==null?module2.path:base)}},fn(module2,module2.exports),module2.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var eventemitter3=createCommonjsModule(function(module2){var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(prefix=!1));function EE(fn,context4,once){this.fn=fn,this.context=context4,this.once=once||!1}function addListener(emitter,event,fn,context4,once){if(typeof fn!="function")throw new TypeError("The listener must be a function");var listener=new EE(fn,context4||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){--emitter._eventsCount==0?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter2(){this._events=new Events,this._eventsCount=0}EventEmitter2.prototype.eventNames=function(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter2.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter2.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter2.prototype.emit=function(event,a1,a2,a3,a4,a5){var arguments$1=arguments,evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var listeners=this._events[evt],len2=arguments.length,args,i;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len2){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len2-1);i<len2;i++)args[i-1]=arguments$1[i];listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len2){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len2-1);j<len2;j++)args[j-1]=arguments$1[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter2.prototype.on=function(event,fn,context4){return addListener(this,event,fn,context4,!1)},EventEmitter2.prototype.once=function(event,fn,context4){return addListener(this,event,fn,context4,!0)},EventEmitter2.prototype.removeListener=function(event,fn,context4,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn===fn&&(!once||listeners.once)&&(!context4||listeners.context===context4)&&clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context4&&listeners[i].context!==context4)&&events.push(listeners[i]);events.length?this._events[evt]=events.length===1?events[0]:events:clearEvent(this,evt)}return this},EventEmitter2.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter2.prototype.off=EventEmitter2.prototype.removeListener,EventEmitter2.prototype.addListener=EventEmitter2.prototype.on,EventEmitter2.prefixed=prefix,EventEmitter2.EventEmitter=EventEmitter2,module2.exports=EventEmitter2}),punycode=createCommonjsModule(function(module2,exports2){(function(root){var freeExports=exports2&&!exports2.nodeType&&exports2,freeModule=module2&&!module2.nodeType&&module2,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var punycode2,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map4(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map4(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var output=[],counter=0,length=string.length,value,extra;counter<length;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length?(extra=string.charCodeAt(counter++),(extra&64512)==56320?output.push(((value&1023)<<10)+(extra&1023)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map4(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|value&1023),output+=stringFromCharCode(value),output}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode2(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index3,oldi,w,k,digit,t,baseMinusT;for(basic=input.lastIndexOf(delimiter),basic<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index3=basic>0?basic+1:0;index3<inputLength;){for(oldi=i,w=1,k=base;index3>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index3++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(digit<t);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,oldi==0),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode2(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)currentValue=input[j],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)currentValue=input[j],currentValue>=n&&currentValue<m&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if(currentValue=input[j],currentValue<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(q<t);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode2(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode2(string):string})}if(punycode2={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode2,encode:encode2,toASCII,toUnicode},freeExports&&freeModule)if(module2.exports==freeExports)freeModule.exports=punycode2;else for(key in punycode2)punycode2.hasOwnProperty(key)&&(freeExports[key]=punycode2[key]);else root.punycode=punycode2})(commonjsGlobal)}),util2={isString:function(arg){return typeof arg=="string"},isObject:function(arg){return typeof arg=="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var decode=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if(typeof qs!="string"||qs.length===0)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&typeof options.maxKeys=="number"&&(maxKeys=options.maxKeys);var len2=qs.length;maxKeys>0&&len2>maxKeys&&(len2=maxKeys);for(var i=0;i<len2;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?Array.isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj},stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}},encode=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",obj===null&&(obj=void 0),typeof obj=="object"?Object.keys(obj).map(function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return Array.isArray(obj[k])?obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""},querystring=createCommonjsModule(function(module2,exports2){exports2.decode=exports2.parse=decode,exports2.encode=exports2.stringify=encode}),parse2=urlParse,resolve3=urlResolve,format2=urlFormat;function Url2(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r",`
`,"	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(url3,parseQueryString,slashesDenoteHost){if(url3&&util2.isObject(url3)&&url3 instanceof Url2)return url3;var u=new Url2;return u.parse(url3,parseQueryString,slashesDenoteHost),u}Url2.prototype.parse=function(url3,parseQueryString,slashesDenoteHost){if(!util2.isString(url3))throw new TypeError("Parameter 'url' must be a string, not "+typeof url3);var queryIndex=url3.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url3.indexOf("#")?"?":"#",uSplit=url3.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/"),url3=uSplit.join(splitter);var rest=url3;if(rest=rest.trim(),!slashesDenoteHost&&url3.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],parseQueryString?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";slashes&&!(proto&&hostlessProtocol[proto])&&(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;hostEnd===-1?atSign=rest.lastIndexOf("@"):atSign=rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!!part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),rest[0]!=="/"&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)!==-1){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this};function urlFormat(obj){return util2.isString(obj)&&(obj=urlParse(obj)),obj instanceof Url2?obj.format():Url2.prototype.format.call(obj)}Url2.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util2.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&protocol.substr(-1)!==":"&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&pathname.charAt(0)!=="/"&&(pathname="/"+pathname)):host||(host=""),hash&&hash.charAt(0)!=="#"&&(hash="#"+hash),search&&search.charAt(0)!=="?"&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}Url2.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()};Url2.prototype.resolveObject=function(relative){if(util2.isString(relative)){var rel=new Url2;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url2,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,relative.href==="")return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];rkey!=="protocol"&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys2=Object.keys(relative),v=0;v<keys2.length;v++){var k=keys2[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,!relative.host&&!hostlessProtocol[relative.protocol]){for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),relPath[0]!==""&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}else result.pathname=relative.pathname;if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(srcPath[0]===""?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(relPath[0]===""?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")),isRelAbs)result.host=relative.host||relative.host===""?relative.host:result.host,result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util2.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,(!util2.isNull(result.pathname)||!util2.isNull(result.search))&&(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="",up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],last==="."?srcPath.splice(i,1):last===".."?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")&&srcPath.unshift(""),hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"&&srcPath.push("");var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),(!util2.isNull(result.pathname)||!util2.isNull(result.search))&&(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result};Url2.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],port!==":"&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)};var url2={parse:parse2,format:format2,resolve:resolve3};settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var saidHello2=!1,VERSION2="6.0.4";function sayHello2(type){var _a3;if(!saidHello2){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=[`
 %c %c %c PixiJS `+VERSION2+" - \u2730 "+type+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(_a3=self.console).log.apply(_a3,args)}else self.console&&self.console.log("PixiJS "+VERSION2+" - "+type+" - http://www.pixijs.com/");saidHello2=!0}}var supported2;function isWebGLSupported2(){return typeof supported2=="undefined"&&(supported2=function(){var contextOptions={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var canvas2=document.createElement("canvas"),gl=canvas2.getContext("webgl",contextOptions)||canvas2.getContext("experimental-webgl",contextOptions),success=!!(gl&&gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}return gl=null,success}catch(e){return!1}}()),supported2}function hex2rgb2(hex,out){return out===void 0&&(out=[]),out[0]=(hex>>16&255)/255,out[1]=(hex>>8&255)/255,out[2]=(hex&255)/255,out}function hex2string2(hex){var hexString=hex.toString(16);return hexString="000000".substr(0,6-hexString.length)+hexString,"#"+hexString}function mapPremultipliedBlendModes2(){for(var pm=[],npm=[],i=0;i<32;i++)pm[i]=i,npm[i]=i;pm[BLEND_MODES2.NORMAL_NPM]=BLEND_MODES2.NORMAL,pm[BLEND_MODES2.ADD_NPM]=BLEND_MODES2.ADD,pm[BLEND_MODES2.SCREEN_NPM]=BLEND_MODES2.SCREEN,npm[BLEND_MODES2.NORMAL]=BLEND_MODES2.NORMAL_NPM,npm[BLEND_MODES2.ADD]=BLEND_MODES2.ADD_NPM,npm[BLEND_MODES2.SCREEN]=BLEND_MODES2.SCREEN_NPM;var array=[];return array.push(npm),array.push(pm),array}var premultiplyBlendMode2=mapPremultipliedBlendModes2();function premultiplyTint2(tint,alpha){if(alpha===1)return(alpha*255<<24)+tint;if(alpha===0)return 0;var R=tint>>16&255,G=tint>>8&255,B=tint&255;return R=R*alpha+.5|0,G=G*alpha+.5|0,B=B*alpha+.5|0,(alpha*255<<24)+(R<<16)+(G<<8)+B}function nextPow22(v){return v+=v===0?1:0,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,v|=v>>>16,v+1}function isPow22(v){return!(v&v-1)&&!!v}function log22(v){var r=(v>65535?1:0)<<4;v>>>=r;var shift=(v>255?1:0)<<3;return v>>>=shift,r|=shift,shift=(v>15?1:0)<<2,v>>>=shift,r|=shift,shift=(v>3?1:0)<<1,v>>>=shift,r|=shift,r|v>>1}function removeItems2(arr,startIdx,removeCount){var length=arr.length,i;if(!(startIdx>=length||removeCount===0)){removeCount=startIdx+removeCount>length?length-startIdx:removeCount;var len2=length-removeCount;for(i=startIdx;i<len2;++i)arr[i]=arr[i+removeCount];arr.length=len2}}var nextUid2=0;function uid2(){return++nextUid2}var warnings2={};function deprecation2(version3,message,ignoreDepth){if(ignoreDepth===void 0&&(ignoreDepth=3),!warnings2[message]){var stack=new Error().stack;typeof stack=="undefined"?console.warn("PixiJS Deprecation Warning: ",message+`
Deprecated since v`+version3):(stack=stack.split(`
`).splice(ignoreDepth).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",message+`
Deprecated since v`+version3),console.warn(stack),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",message+`
Deprecated since v`+version3),console.warn(stack))),warnings2[message]=!0}}var ProgramCache2={},TextureCache2=Object.create(null),BaseTextureCache2=Object.create(null),CanvasRenderTarget2=function(){function CanvasRenderTarget3(width,height,resolution){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=resolution||settings.RESOLUTION,this.resize(width,height)}return CanvasRenderTarget3.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasRenderTarget3.prototype.resize=function(width,height){this.canvas.width=width*this.resolution,this.canvas.height=height*this.resolution},CanvasRenderTarget3.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(CanvasRenderTarget3.prototype,"width",{get:function(){return this.canvas.width},set:function(val){this.canvas.width=val},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasRenderTarget3.prototype,"height",{get:function(){return this.canvas.height},set:function(val){this.canvas.height=val},enumerable:!1,configurable:!0}),CanvasRenderTarget3}(),tempAnchor3;function determineCrossOrigin2(url$1,loc){if(loc===void 0&&(loc=self.location),url$1.indexOf("data:")===0)return"";loc=loc||self.location,tempAnchor3||(tempAnchor3=document.createElement("a")),tempAnchor3.href=url$1;var parsedUrl=url2.parse(tempAnchor3.href),samePort=!parsedUrl.port&&loc.port===""||parsedUrl.port===loc.port;return parsedUrl.hostname!==loc.hostname||!samePort||parsedUrl.protocol!==loc.protocol?"anonymous":""}function getResolutionOfUrl2(url3,defaultValue3){var resolution=settings.RETINA_PREFIX.exec(url3);return resolution?parseFloat(resolution[1]):defaultValue3!==void 0?defaultValue3:1}var Runner2=function(){function Runner3(name){this.items=[],this._name=name,this._aliasCount=0}return Runner3.prototype.emit=function(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8)throw new Error("max arguments reached");var _a3=this,name=_a3.name,items=_a3.items;this._aliasCount++;for(var i=0,len2=items.length;i<len2;i++)items[i][name](a0,a1,a2,a3,a4,a5,a6,a7);return items===this.items&&this._aliasCount--,this},Runner3.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},Runner3.prototype.add=function(item){return item[this._name]&&(this.ensureNonAliasedItems(),this.remove(item),this.items.push(item)),this},Runner3.prototype.remove=function(item){var index3=this.items.indexOf(item);return index3!==-1&&(this.ensureNonAliasedItems(),this.items.splice(index3,1)),this},Runner3.prototype.contains=function(item){return this.items.indexOf(item)!==-1},Runner3.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Runner3.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Runner3.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(Runner3.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Runner3}();Object.defineProperties(Runner2.prototype,{dispatch:{value:Runner2.prototype.emit},run:{value:Runner2.prototype.emit}});settings.TARGET_FPMS=.06;var UPDATE_PRIORITY2;(function(UPDATE_PRIORITY3){UPDATE_PRIORITY3[UPDATE_PRIORITY3.INTERACTION=50]="INTERACTION",UPDATE_PRIORITY3[UPDATE_PRIORITY3.HIGH=25]="HIGH",UPDATE_PRIORITY3[UPDATE_PRIORITY3.NORMAL=0]="NORMAL",UPDATE_PRIORITY3[UPDATE_PRIORITY3.LOW=-25]="LOW",UPDATE_PRIORITY3[UPDATE_PRIORITY3.UTILITY=-50]="UTILITY"})(UPDATE_PRIORITY2||(UPDATE_PRIORITY2={}));var TickerListener2=function(){function TickerListener3(fn,context4,priority,once){context4===void 0&&(context4=null),priority===void 0&&(priority=0),once===void 0&&(once=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=fn,this.context=context4,this.priority=priority,this.once=once}return TickerListener3.prototype.match=function(fn,context4){return context4===void 0&&(context4=null),this.fn===fn&&this.context===context4},TickerListener3.prototype.emit=function(deltaTime){this.fn&&(this.context?this.fn.call(this.context,deltaTime):this.fn(deltaTime));var redirect=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),redirect},TickerListener3.prototype.connect=function(previous){this.previous=previous,previous.next&&(previous.next.previous=this),this.next=previous.next,previous.next=this},TickerListener3.prototype.destroy=function(hard){hard===void 0&&(hard=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var redirect=this.next;return this.next=hard?null:redirect,this.previous=null,redirect},TickerListener3}(),Ticker2=function(){function Ticker4(){var _this=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener2(null,null,Infinity),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(time){_this._requestId=null,_this.started&&(_this.update(time),_this.started&&_this._requestId===null&&_this._head.next&&(_this._requestId=requestAnimationFrame(_this._tick)))}}return Ticker4.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},Ticker4.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker4.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker4.prototype.add=function(fn,context4,priority){return priority===void 0&&(priority=UPDATE_PRIORITY2.NORMAL),this._addListener(new TickerListener2(fn,context4,priority))},Ticker4.prototype.addOnce=function(fn,context4,priority){return priority===void 0&&(priority=UPDATE_PRIORITY2.NORMAL),this._addListener(new TickerListener2(fn,context4,priority,!0))},Ticker4.prototype._addListener=function(listener){var current=this._head.next,previous=this._head;if(!current)listener.connect(previous);else{for(;current;){if(listener.priority>current.priority){listener.connect(previous);break}previous=current,current=current.next}listener.previous||listener.connect(previous)}return this._startIfPossible(),this},Ticker4.prototype.remove=function(fn,context4){for(var listener=this._head.next;listener;)listener.match(fn,context4)?listener=listener.destroy():listener=listener.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(Ticker4.prototype,"count",{get:function(){if(!this._head)return 0;for(var count2=0,current=this._head;current=current.next;)count2++;return count2},enumerable:!1,configurable:!0}),Ticker4.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker4.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker4.prototype.destroy=function(){if(!this._protected){this.stop();for(var listener=this._head.next;listener;)listener=listener.destroy(!0);this._head.destroy(),this._head=null}},Ticker4.prototype.update=function(currentTime){currentTime===void 0&&(currentTime=performance.now());var elapsedMS;if(currentTime>this.lastTime){if(elapsedMS=this.elapsedMS=currentTime-this.lastTime,elapsedMS>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),elapsedMS*=this.speed,this._minElapsedMS){var delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS)return;this._lastFrame=currentTime-delta%this._minElapsedMS}this.deltaMS=elapsedMS,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var head=this._head,listener=head.next;listener;)listener=listener.emit(this.deltaTime);head.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=currentTime},Object.defineProperty(Ticker4.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPS=Math.min(this.maxFPS,fps),minFPMS=Math.min(Math.max(0,minFPS)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/minFPMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(fps){if(fps===0)this._minElapsedMS=0;else{var maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4,"shared",{get:function(){if(!Ticker4._shared){var shared=Ticker4._shared=new Ticker4;shared.autoStart=!0,shared._protected=!0}return Ticker4._shared},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker4,"system",{get:function(){if(!Ticker4._system){var system=Ticker4._system=new Ticker4;system.autoStart=!0,system._protected=!0}return Ticker4._system},enumerable:!1,configurable:!0}),Ticker4}();var PI_22=Math.PI*2,SHAPES2;(function(SHAPES3){SHAPES3[SHAPES3.POLY=0]="POLY",SHAPES3[SHAPES3.RECT=1]="RECT",SHAPES3[SHAPES3.CIRC=2]="CIRC",SHAPES3[SHAPES3.ELIP=3]="ELIP",SHAPES3[SHAPES3.RREC=4]="RREC"})(SHAPES2||(SHAPES2={}));var Rectangle2=function(){function Rectangle3(x,y,width,height){x===void 0&&(x=0),y===void 0&&(y=0),width===void 0&&(width=0),height===void 0&&(height=0),this.x=Number(x),this.y=Number(y),this.width=Number(width),this.height=Number(height),this.type=SHAPES2.RECT}return Object.defineProperty(Rectangle3.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle3,"EMPTY",{get:function(){return new Rectangle3(0,0,0,0)},enumerable:!1,configurable:!0}),Rectangle3.prototype.clone=function(){return new Rectangle3(this.x,this.y,this.width,this.height)},Rectangle3.prototype.copyFrom=function(rectangle){return this.x=rectangle.x,this.y=rectangle.y,this.width=rectangle.width,this.height=rectangle.height,this},Rectangle3.prototype.copyTo=function(rectangle){return rectangle.x=this.x,rectangle.y=this.y,rectangle.width=this.width,rectangle.height=this.height,rectangle},Rectangle3.prototype.contains=function(x,y){return this.width<=0||this.height<=0?!1:x>=this.x&&x<this.x+this.width&&y>=this.y&&y<this.y+this.height},Rectangle3.prototype.pad=function(paddingX,paddingY){return paddingX===void 0&&(paddingX=0),paddingY===void 0&&(paddingY=paddingX),this.x-=paddingX,this.y-=paddingY,this.width+=paddingX*2,this.height+=paddingY*2,this},Rectangle3.prototype.fit=function(rectangle){var x1=Math.max(this.x,rectangle.x),x2=Math.min(this.x+this.width,rectangle.x+rectangle.width),y1=Math.max(this.y,rectangle.y),y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=Math.max(x2-x1,0),this.y=y1,this.height=Math.max(y2-y1,0),this},Rectangle3.prototype.ceil=function(resolution,eps){resolution===void 0&&(resolution=1),eps===void 0&&(eps=.001);var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution,y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;return this.x=Math.floor((this.x+eps)*resolution)/resolution,this.y=Math.floor((this.y+eps)*resolution)/resolution,this.width=x2-this.x,this.height=y2-this.y,this},Rectangle3.prototype.enlarge=function(rectangle){var x1=Math.min(this.x,rectangle.x),x2=Math.max(this.x+this.width,rectangle.x+rectangle.width),y1=Math.min(this.y,rectangle.y),y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=x2-x1,this.y=y1,this.height=y2-y1,this},Rectangle3.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},Rectangle3}(),Point2=function(){function Point3(x,y){x===void 0&&(x=0),y===void 0&&(y=0),this.x=0,this.y=0,this.x=x,this.y=y}return Point3.prototype.clone=function(){return new Point3(this.x,this.y)},Point3.prototype.copyFrom=function(p){return this.set(p.x,p.y),this},Point3.prototype.copyTo=function(p){return p.set(this.x,this.y),p},Point3.prototype.equals=function(p){return p.x===this.x&&p.y===this.y},Point3.prototype.set=function(x,y){return x===void 0&&(x=0),y===void 0&&(y=x),this.x=x,this.y=y,this},Point3.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},Point3}(),ObservablePoint2=function(){function ObservablePoint3(cb,scope,x,y){x===void 0&&(x=0),y===void 0&&(y=0),this._x=x,this._y=y,this.cb=cb,this.scope=scope}return ObservablePoint3.prototype.clone=function(cb,scope){return cb===void 0&&(cb=this.cb),scope===void 0&&(scope=this.scope),new ObservablePoint3(cb,scope,this._x,this._y)},ObservablePoint3.prototype.set=function(x,y){return x===void 0&&(x=0),y===void 0&&(y=x),(this._x!==x||this._y!==y)&&(this._x=x,this._y=y,this.cb.call(this.scope)),this},ObservablePoint3.prototype.copyFrom=function(p){return(this._x!==p.x||this._y!==p.y)&&(this._x=p.x,this._y=p.y,this.cb.call(this.scope)),this},ObservablePoint3.prototype.copyTo=function(p){return p.set(this._x,this._y),p},ObservablePoint3.prototype.equals=function(p){return p.x===this._x&&p.y===this._y},ObservablePoint3.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(ObservablePoint3.prototype,"x",{get:function(){return this._x},set:function(value){this._x!==value&&(this._x=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(ObservablePoint3.prototype,"y",{get:function(){return this._y},set:function(value){this._y!==value&&(this._y=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),ObservablePoint3}(),Matrix2=function(){function Matrix3(a,b,c,d,tx,ty){a===void 0&&(a=1),b===void 0&&(b=0),c===void 0&&(c=0),d===void 0&&(d=1),tx===void 0&&(tx=0),ty===void 0&&(ty=0),this.array=null,this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty}return Matrix3.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},Matrix3.prototype.set=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},Matrix3.prototype.toArray=function(transpose,out){this.array||(this.array=new Float32Array(9));var array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},Matrix3.prototype.apply=function(pos,newPos){newPos=newPos||new Point2;var x=pos.x,y=pos.y;return newPos.x=this.a*x+this.c*y+this.tx,newPos.y=this.b*x+this.d*y+this.ty,newPos},Matrix3.prototype.applyInverse=function(pos,newPos){newPos=newPos||new Point2;var id=1/(this.a*this.d+this.c*-this.b),x=pos.x,y=pos.y;return newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id,newPos},Matrix3.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},Matrix3.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},Matrix3.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},Matrix3.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},Matrix3.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){return this.a=Math.cos(rotation+skewY)*scaleX,this.b=Math.sin(rotation+skewY)*scaleX,this.c=-Math.sin(rotation-skewX)*scaleY,this.d=Math.cos(rotation-skewX)*scaleY,this.tx=x-(pivotX*this.a+pivotY*this.c),this.ty=y-(pivotX*this.b+pivotY*this.d),this},Matrix3.prototype.prepend=function(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this},Matrix3.prototype.decompose=function(transform){var a=this.a,b=this.b,c=this.c,d=this.d,pivot=transform.pivot,skewX=-Math.atan2(-c,d),skewY=Math.atan2(b,a),delta=Math.abs(skewX+skewY);return delta<1e-5||Math.abs(PI_22-delta)<1e-5?(transform.rotation=skewY,transform.skew.x=transform.skew.y=0):(transform.rotation=0,transform.skew.x=skewX,transform.skew.y=skewY),transform.scale.x=Math.sqrt(a*a+b*b),transform.scale.y=Math.sqrt(c*c+d*d),transform.position.x=this.tx+(pivot.x*a+pivot.y*c),transform.position.y=this.ty+(pivot.x*b+pivot.y*d),transform},Matrix3.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},Matrix3.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix3.prototype.clone=function(){var matrix=new Matrix3;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix3.prototype.copyTo=function(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix3.prototype.copyFrom=function(matrix){return this.a=matrix.a,this.b=matrix.b,this.c=matrix.c,this.d=matrix.d,this.tx=matrix.tx,this.ty=matrix.ty,this},Matrix3.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(Matrix3,"IDENTITY",{get:function(){return new Matrix3},enumerable:!1,configurable:!0}),Object.defineProperty(Matrix3,"TEMP_MATRIX",{get:function(){return new Matrix3},enumerable:!1,configurable:!0}),Matrix3}(),ux2=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy2=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx2=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy2=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley2=[],rotationMatrices2=[],signum2=Math.sign;function init2(){for(var i=0;i<16;i++){var row=[];rotationCayley2.push(row);for(var j=0;j<16;j++)for(var _ux=signum2(ux2[i]*ux2[j]+vx2[i]*uy2[j]),_uy=signum2(uy2[i]*ux2[j]+vy2[i]*uy2[j]),_vx=signum2(ux2[i]*vx2[j]+vx2[i]*vy2[j]),_vy=signum2(uy2[i]*vx2[j]+vy2[i]*vy2[j]),k=0;k<16;k++)if(ux2[k]===_ux&&uy2[k]===_uy&&vx2[k]===_vx&&vy2[k]===_vy){row.push(k);break}}for(var i=0;i<16;i++){var mat=new Matrix2;mat.set(ux2[i],uy2[i],vx2[i],vy2[i],0,0),rotationMatrices2.push(mat)}}init2();var groupD82={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(ind){return ux2[ind]},uY:function(ind){return uy2[ind]},vX:function(ind){return vx2[ind]},vY:function(ind){return vy2[ind]},inv:function(rotation){return rotation&8?rotation&15:-rotation&7},add:function(rotationSecond,rotationFirst){return rotationCayley2[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return rotationCayley2[rotationSecond][groupD82.inv(rotationFirst)]},rotate180:function(rotation){return rotation^4},isVertical:function(rotation){return(rotation&3)==2},byDirection:function(dx,dy){return Math.abs(dx)*2<=Math.abs(dy)?dy>=0?groupD82.S:groupD82.N:Math.abs(dy)*2<=Math.abs(dx)?dx>0?groupD82.E:groupD82.W:dy>0?dx>0?groupD82.SE:groupD82.SW:dx>0?groupD82.NE:groupD82.NW},matrixAppendRotationInv:function(matrix,rotation,tx,ty){tx===void 0&&(tx=0),ty===void 0&&(ty=0);var mat=rotationMatrices2[groupD82.inv(rotation)];mat.tx=tx,mat.ty=ty,matrix.append(mat)}},Transform2=function(){function Transform3(){this.worldTransform=new Matrix2,this.localTransform=new Matrix2,this.position=new ObservablePoint2(this.onChange,this,0,0),this.scale=new ObservablePoint2(this.onChange,this,1,1),this.pivot=new ObservablePoint2(this.onChange,this,0,0),this.skew=new ObservablePoint2(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return Transform3.prototype.onChange=function(){this._localID++},Transform3.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},Transform3.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},Transform3.prototype.updateLocalTransform=function(){var lt=this.localTransform;this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1)},Transform3.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._parentID=parentTransform._worldID,this._worldID++}},Transform3.prototype.setFromMatrix=function(matrix){matrix.decompose(this),this._localID++},Object.defineProperty(Transform3.prototype,"rotation",{get:function(){return this._rotation},set:function(value){this._rotation!==value&&(this._rotation=value,this.updateSkew())},enumerable:!1,configurable:!0}),Transform3.IDENTITY=new Transform3,Transform3}();settings.PREFER_ENV=isMobile2.any?ENV2.WEBGL:ENV2.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED2=[];function autoDetectResource2(source,options){if(!source)return null;var extension="";if(typeof source=="string"){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);result&&(extension=result[1].toLowerCase())}for(var i=INSTALLED2.length-1;i>=0;--i){var ResourcePlugin=INSTALLED2[i];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension))return new ResourcePlugin(source,options)}throw new Error("Unrecognized source type to auto-detect Resource")}var extendStatics23=function(d,b){return extendStatics23=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics23(d,b)};function __extends23(d,b){extendStatics23(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var Resource3=function(){function Resource4(width,height){width===void 0&&(width=0),height===void 0&&(height=0),this._width=width,this._height=height,this.destroyed=!1,this.internal=!1,this.onResize=new Runner2("setRealSize"),this.onUpdate=new Runner2("update"),this.onError=new Runner2("onError")}return Resource4.prototype.bind=function(baseTexture){this.onResize.add(baseTexture),this.onUpdate.add(baseTexture),this.onError.add(baseTexture),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},Resource4.prototype.unbind=function(baseTexture){this.onResize.remove(baseTexture),this.onUpdate.remove(baseTexture),this.onError.remove(baseTexture)},Resource4.prototype.resize=function(width,height){(width!==this._width||height!==this._height)&&(this._width=width,this._height=height,this.onResize.emit(width,height))},Object.defineProperty(Resource4.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),Resource4.prototype.update=function(){this.destroyed||this.onUpdate.emit()},Resource4.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(Resource4.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(Resource4.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Resource4.prototype.style=function(_renderer,_baseTexture,_glTexture){return!1},Resource4.prototype.dispose=function(){},Resource4.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Resource4.test=function(_source,_extension){return!1},Resource4}(),BufferResource2=function(_super){__extends23(BufferResource3,_super);function BufferResource3(source,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height;if(!width||!height)throw new Error("BufferResource width or height invalid");return _this=_super.call(this,width,height)||this,_this.data=source,_this}return BufferResource3.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES2.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,baseTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0},BufferResource3.prototype.dispose=function(){this.data=null},BufferResource3.test=function(source){return source instanceof Float32Array||source instanceof Uint8Array||source instanceof Uint32Array},BufferResource3}(Resource3),defaultBufferOptions2={scaleMode:SCALE_MODES2.NEAREST,format:FORMATS2.RGBA,alphaMode:ALPHA_MODES2.NPM},BaseTexture2=function(_super){__extends23(BaseTexture3,_super);function BaseTexture3(resource,options){resource===void 0&&(resource=null),options===void 0&&(options=null);var _this=_super.call(this)||this;options=options||{};var alphaMode=options.alphaMode,mipmap=options.mipmap,anisotropicLevel=options.anisotropicLevel,scaleMode=options.scaleMode,width=options.width,height=options.height,wrapMode=options.wrapMode,format3=options.format,type=options.type,target=options.target,resolution=options.resolution,resourceOptions=options.resourceOptions;return resource&&!(resource instanceof Resource3)&&(resource=autoDetectResource2(resource,resourceOptions),resource.internal=!0),_this.width=width||0,_this.height=height||0,_this.resolution=resolution||settings.RESOLUTION,_this.mipmap=mipmap!==void 0?mipmap:settings.MIPMAP_TEXTURES,_this.anisotropicLevel=anisotropicLevel!==void 0?anisotropicLevel:settings.ANISOTROPIC_LEVEL,_this.wrapMode=wrapMode||settings.WRAP_MODE,_this.scaleMode=scaleMode!==void 0?scaleMode:settings.SCALE_MODE,_this.format=format3||FORMATS2.RGBA,_this.type=type||TYPES2.UNSIGNED_BYTE,_this.target=target||TARGETS2.TEXTURE_2D,_this.alphaMode=alphaMode!==void 0?alphaMode:ALPHA_MODES2.UNPACK,_this.uid=uid2(),_this.touched=0,_this.isPowerOfTwo=!1,_this._refreshPOT(),_this._glTextures={},_this.dirtyId=0,_this.dirtyStyleId=0,_this.cacheId=null,_this.valid=width>0&&height>0,_this.textureCacheIds=[],_this.destroyed=!1,_this.resource=null,_this._batchEnabled=0,_this._batchLocation=0,_this.parentTextureArray=null,_this.setResource(resource),_this}return Object.defineProperty(BaseTexture3.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture3.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),BaseTexture3.prototype.setStyle=function(scaleMode,mipmap){var dirty;return scaleMode!==void 0&&scaleMode!==this.scaleMode&&(this.scaleMode=scaleMode,dirty=!0),mipmap!==void 0&&mipmap!==this.mipmap&&(this.mipmap=mipmap,dirty=!0),dirty&&this.dirtyStyleId++,this},BaseTexture3.prototype.setSize=function(width,height,resolution){return this.resolution=resolution||this.resolution,this.width=width,this.height=height,this._refreshPOT(),this.update(),this},BaseTexture3.prototype.setRealSize=function(realWidth,realHeight,resolution){return this.resolution=resolution||this.resolution,this.width=realWidth/this.resolution,this.height=realHeight/this.resolution,this._refreshPOT(),this.update(),this},BaseTexture3.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow22(this.realWidth)&&isPow22(this.realHeight)},BaseTexture3.prototype.setResolution=function(resolution){var oldResolution=this.resolution;return oldResolution===resolution?this:(this.resolution=resolution,this.valid&&(this.width=this.width*oldResolution/resolution,this.height=this.height*oldResolution/resolution,this.emit("update",this)),this._refreshPOT(),this)},BaseTexture3.prototype.setResource=function(resource){if(this.resource===resource)return this;if(this.resource)throw new Error("Resource can be set only once");return resource.bind(this),this.resource=resource,this},BaseTexture3.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},BaseTexture3.prototype.onError=function(event){this.emit("error",this,event)},BaseTexture3.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache2[this.cacheId],delete TextureCache2[this.cacheId],this.cacheId=null),this.dispose(),BaseTexture3.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},BaseTexture3.prototype.dispose=function(){this.emit("dispose",this)},BaseTexture3.prototype.castToBaseTexture=function(){return this},BaseTexture3.from=function(source,options,strict){strict===void 0&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame=typeof source=="string",cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+uid2()}cacheId=source._pixiId}var baseTexture=BaseTextureCache2[cacheId];if(isFrame&&strict&&!baseTexture)throw new Error('The cacheId "'+cacheId+'" does not exist in BaseTextureCache.');return baseTexture||(baseTexture=new BaseTexture3(source,options),baseTexture.cacheId=cacheId,BaseTexture3.addToCache(baseTexture,cacheId)),baseTexture},BaseTexture3.fromBuffer=function(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new BufferResource2(buffer,{width,height}),type=buffer instanceof Float32Array?TYPES2.FLOAT:TYPES2.UNSIGNED_BYTE;return new BaseTexture3(resource,Object.assign(defaultBufferOptions2,options||{width,height,type}))},BaseTexture3.addToCache=function(baseTexture,id){id&&(baseTexture.textureCacheIds.indexOf(id)===-1&&baseTexture.textureCacheIds.push(id),BaseTextureCache2[id]&&console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry"),BaseTextureCache2[id]=baseTexture)},BaseTexture3.removeFromCache=function(baseTexture){if(typeof baseTexture=="string"){var baseTextureFromCache=BaseTextureCache2[baseTexture];if(baseTextureFromCache){var index3=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);return index3>-1&&baseTextureFromCache.textureCacheIds.splice(index3,1),delete BaseTextureCache2[baseTexture],baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i)delete BaseTextureCache2[baseTexture.textureCacheIds[i]];return baseTexture.textureCacheIds.length=0,baseTexture}return null},BaseTexture3._globalBatch=0,BaseTexture3}(eventemitter3),AbstractMultiResource2=function(_super){__extends23(AbstractMultiResource3,_super);function AbstractMultiResource3(length,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height;_this=_super.call(this,width,height)||this,_this.items=[],_this.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new BaseTexture2;_this.items.push(partTexture),_this.itemDirtyIds.push(-2)}return _this.length=length,_this._load=null,_this.baseTexture=null,_this}return AbstractMultiResource3.prototype.initFromArray=function(resources3,options){for(var i=0;i<this.length;i++)!resources3[i]||(resources3[i].castToBaseTexture?this.addBaseTextureAt(resources3[i].castToBaseTexture(),i):resources3[i]instanceof Resource3?this.addResourceAt(resources3[i],i):this.addResourceAt(autoDetectResource2(resources3[i],options),i))},AbstractMultiResource3.prototype.dispose=function(){for(var i=0,len2=this.length;i<len2;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},AbstractMultiResource3.prototype.addResourceAt=function(resource,index3){if(!this.items[index3])throw new Error("Index "+index3+" is out of bounds");return resource.valid&&!this.valid&&this.resize(resource.width,resource.height),this.items[index3].setResource(resource),this},AbstractMultiResource3.prototype.bind=function(baseTexture){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");_super.prototype.bind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=baseTexture,this.items[i].on("update",baseTexture.update,baseTexture)},AbstractMultiResource3.prototype.unbind=function(baseTexture){_super.prototype.unbind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",baseTexture.update,baseTexture)},AbstractMultiResource3.prototype.load=function(){var _this=this;if(this._load)return this._load;var resources3=this.items.map(function(item){return item.resource}).filter(function(item){return item}),promises=resources3.map(function(item){return item.load()});return this._load=Promise.all(promises).then(function(){var _a3=_this.items[0],realWidth=_a3.realWidth,realHeight=_a3.realHeight;return _this.resize(realWidth,realHeight),Promise.resolve(_this)}),this._load},AbstractMultiResource3}(Resource3),ArrayResource2=function(_super){__extends23(ArrayResource3,_super);function ArrayResource3(source,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height,urls,length;return Array.isArray(source)?(urls=source,length=source.length):length=source,_this=_super.call(this,length,{width,height})||this,urls&&_this.initFromArray(urls,options),_this}return ArrayResource3.prototype.addBaseTextureAt=function(baseTexture,index3){if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index3);else throw new Error("ArrayResource does not support RenderTexture");return this},ArrayResource3.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=TARGETS2.TEXTURE_2D_ARRAY},ArrayResource3.prototype.upload=function(renderer,texture,glTexture){var _a3=this,length=_a3.length,itemDirtyIds=_a3.itemDirtyIds,items=_a3.items,gl=renderer.gl;glTexture.dirtyId<0&&gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,texture.format,this._width,this._height,length,0,texture.format,texture.type,null);for(var i=0;i<length;i++){var item=items[i];itemDirtyIds[i]<item.dirtyId&&(itemDirtyIds[i]=item.dirtyId,item.valid&&gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,texture.type,item.resource.source))}return!0},ArrayResource3}(AbstractMultiResource2),BaseImageResource2=function(_super){__extends23(BaseImageResource3,_super);function BaseImageResource3(source){var _this=this,sourceAny=source,width=sourceAny.naturalWidth||sourceAny.videoWidth||sourceAny.width,height=sourceAny.naturalHeight||sourceAny.videoHeight||sourceAny.height;return _this=_super.call(this,width,height)||this,_this.source=source,_this.noSubImage=!1,_this}return BaseImageResource3.crossOrigin=function(element,url3,crossorigin){crossorigin===void 0&&url3.indexOf("data:")!==0?element.crossOrigin=determineCrossOrigin2(url3):crossorigin!==!1&&(element.crossOrigin=typeof crossorigin=="string"?crossorigin:"anonymous")},BaseImageResource3.prototype.upload=function(renderer,baseTexture,glTexture,source){var gl=renderer.gl,width=baseTexture.realWidth,height=baseTexture.realHeight;return source=source||this.source,gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES2.UNPACK),!this.noSubImage&&baseTexture.target===gl.TEXTURE_2D&&glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,baseTexture.type,source):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,baseTexture.format,baseTexture.format,baseTexture.type,source)),!0},BaseImageResource3.prototype.update=function(){if(!this.destroyed){var source=this.source,width=source.naturalWidth||source.videoWidth||source.width,height=source.naturalHeight||source.videoHeight||source.height;this.resize(width,height),_super.prototype.update.call(this)}},BaseImageResource3.prototype.dispose=function(){this.source=null},BaseImageResource3}(Resource3),CanvasResource2=function(_super){__extends23(CanvasResource3,_super);function CanvasResource3(source){return _super.call(this,source)||this}return CanvasResource3.test=function(source){var OffscreenCanvas2=self.OffscreenCanvas;return OffscreenCanvas2&&source instanceof OffscreenCanvas2?!0:self.HTMLCanvasElement&&source instanceof HTMLCanvasElement},CanvasResource3}(BaseImageResource2),CubeResource2=function(_super){__extends23(CubeResource3,_super);function CubeResource3(source,options){var _this=this,_a3=options||{},width=_a3.width,height=_a3.height,autoLoad=_a3.autoLoad,linkBaseTexture=_a3.linkBaseTexture;if(source&&source.length!==CubeResource3.SIDES)throw new Error("Invalid length. Got "+source.length+", expected 6");_this=_super.call(this,6,{width,height})||this;for(var i=0;i<CubeResource3.SIDES;i++)_this.items[i].target=TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_X+i;return _this.linkBaseTexture=linkBaseTexture!==!1,source&&_this.initFromArray(source,options),autoLoad!==!1&&_this.load(),_this}return CubeResource3.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=TARGETS2.TEXTURE_CUBE_MAP},CubeResource3.prototype.addBaseTextureAt=function(baseTexture,index3,linkBaseTexture){if(linkBaseTexture===void 0&&(linkBaseTexture=this.linkBaseTexture),!this.items[index3])throw new Error("Index "+index3+" is out of bounds");if(!this.linkBaseTexture||baseTexture.parentTextureArray||Object.keys(baseTexture._glTextures).length>0)if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index3);else throw new Error("CubeResource does not support copying of renderTexture.");else baseTexture.target=TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_X+index3,baseTexture.parentTextureArray=this.baseTexture,this.items[index3]=baseTexture;return baseTexture.valid&&!this.valid&&this.resize(baseTexture.realWidth,baseTexture.realHeight),this.items[index3]=baseTexture,this},CubeResource3.prototype.upload=function(renderer,_baseTexture,glTexture){for(var dirty=this.itemDirtyIds,i=0;i<CubeResource3.SIDES;i++){var side=this.items[i];dirty[i]<side.dirtyId&&(side.valid&&side.resource?(side.resource.upload(renderer,side,glTexture),dirty[i]=side.dirtyId):dirty[i]<-1&&(renderer.gl.texImage2D(side.target,0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null),dirty[i]=-1))}return!0},CubeResource3.test=function(source){return Array.isArray(source)&&source.length===CubeResource3.SIDES},CubeResource3.SIDES=6,CubeResource3}(AbstractMultiResource2),ImageResource2=function(_super){__extends23(ImageResource3,_super);function ImageResource3(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLImageElement)){var imageElement=new Image;BaseImageResource2.crossOrigin(imageElement,source,options.crossorigin),imageElement.src=source,source=imageElement}return _this=_super.call(this,source)||this,!source.complete&&!!_this._width&&!!_this._height&&(_this._width=0,_this._height=0),_this.url=source.src,_this._process=null,_this.preserveBitmap=!1,_this.createBitmap=(options.createBitmap!==void 0?options.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,_this.alphaMode=typeof options.alphaMode=="number"?options.alphaMode:null,_this.bitmap=null,_this._load=null,options.autoLoad!==!1&&_this.load(),_this}return ImageResource3.prototype.load=function(createBitmap){var _this=this;return this._load?this._load:(createBitmap!==void 0&&(this.createBitmap=createBitmap),this._load=new Promise(function(resolve4,reject2){var source=_this.source;_this.url=source.src;var completed=function(){_this.destroyed||(source.onload=null,source.onerror=null,_this.resize(source.width,source.height),_this._load=null,_this.createBitmap?resolve4(_this.process()):resolve4(_this))};source.complete&&source.src?completed():(source.onload=completed,source.onerror=function(event){reject2(event),_this.onError.emit(event)})}),this._load)},ImageResource3.prototype.process=function(){var _this=this,source=this.source;return this._process!==null?this._process:this.bitmap!==null||!self.createImageBitmap?Promise.resolve(this):(this._process=self.createImageBitmap(source,0,0,source.width,source.height,{premultiplyAlpha:this.alphaMode===ALPHA_MODES2.UNPACK?"premultiply":"none"}).then(function(bitmap){return _this.destroyed?Promise.reject():(_this.bitmap=bitmap,_this.update(),_this._process=null,Promise.resolve(_this))}),this._process)},ImageResource3.prototype.upload=function(renderer,baseTexture,glTexture){if(typeof this.alphaMode=="number"&&(baseTexture.alphaMode=this.alphaMode),!this.createBitmap)return _super.prototype.upload.call(this,renderer,baseTexture,glTexture);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(_super.prototype.upload.call(this,renderer,baseTexture,glTexture,this.bitmap),!this.preserveBitmap){var flag=!0,glTextures=baseTexture._glTextures;for(var key in glTextures){var otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=!1;break}}flag&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},ImageResource3.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,_super.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},ImageResource3.test=function(source){return typeof source=="string"||source instanceof HTMLImageElement},ImageResource3}(BaseImageResource2),SVGResource2=function(_super){__extends23(SVGResource3,_super);function SVGResource3(sourceBase64,options){var _this=this;return options=options||{},_this=_super.call(this,document.createElement("canvas"))||this,_this._width=0,_this._height=0,_this.svg=sourceBase64,_this.scale=options.scale||1,_this._overrideWidth=options.width,_this._overrideHeight=options.height,_this._resolve=null,_this._crossorigin=options.crossorigin,_this._load=null,options.autoLoad!==!1&&_this.load(),_this}return SVGResource3.prototype.load=function(){var _this=this;return this._load?this._load:(this._load=new Promise(function(resolve4){if(_this._resolve=function(){_this.resize(_this.source.width,_this.source.height),resolve4(_this)},/^\<svg/.test(_this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");_this.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(_this.svg)))}_this._loadSvg()}),this._load)},SVGResource3.prototype._loadSvg=function(){var _this=this,tempImage=new Image;BaseImageResource2.crossOrigin(tempImage,this.svg,this._crossorigin),tempImage.src=this.svg,tempImage.onerror=function(event){!_this._resolve||(tempImage.onerror=null,_this.onError.emit(event))},tempImage.onload=function(){if(!!_this._resolve){var svgWidth=tempImage.width,svgHeight=tempImage.height;if(!svgWidth||!svgHeight)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var width=svgWidth*_this.scale,height=svgHeight*_this.scale;(_this._overrideWidth||_this._overrideHeight)&&(width=_this._overrideWidth||_this._overrideHeight/svgHeight*svgWidth,height=_this._overrideHeight||_this._overrideWidth/svgWidth*svgHeight),width=Math.round(width),height=Math.round(height);var canvas2=_this.source;canvas2.width=width,canvas2.height=height,canvas2._pixiId="canvas_"+uid2(),canvas2.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height),_this._resolve(),_this._resolve=null}}},SVGResource3.getSize=function(svgString){var sizeMatch=SVGResource3.SVG_SIZE.exec(svgString),size={};return sizeMatch&&(size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3])),size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))),size},SVGResource3.prototype.dispose=function(){_super.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},SVGResource3.test=function(source,extension){return extension==="svg"||typeof source=="string"&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(source)||typeof source=="string"&&source.indexOf("<svg")===0},SVGResource3.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,SVGResource3}(BaseImageResource2),VideoResource2=function(_super){__extends23(VideoResource3,_super);function VideoResource3(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");videoElement.setAttribute("preload","auto"),videoElement.setAttribute("webkit-playsinline",""),videoElement.setAttribute("playsinline",""),typeof source=="string"&&(source=[source]);var firstSrc=source[0].src||source[0];BaseImageResource2.crossOrigin(videoElement,firstSrc,options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source"),_a3=source[i],src=_a3.src,mime=_a3.mime;src=src||source[i];var baseSrc=src.split("?").shift().toLowerCase(),ext=baseSrc.substr(baseSrc.lastIndexOf(".")+1);mime=mime||VideoResource3.MIME_TYPES[ext]||"video/"+ext,sourceElement.src=src,sourceElement.type=mime,videoElement.appendChild(sourceElement)}source=videoElement}return _this=_super.call(this,source)||this,_this.noSubImage=!0,_this._autoUpdate=!0,_this._isConnectedToTicker=!1,_this._updateFPS=options.updateFPS||0,_this._msToNextUpdate=0,_this.autoPlay=options.autoPlay!==!1,_this._load=null,_this._resolve=null,_this._onCanPlay=_this._onCanPlay.bind(_this),_this._onError=_this._onError.bind(_this),options.autoLoad!==!1&&_this.load(),_this}return VideoResource3.prototype.update=function(_deltaTime){if(!this.destroyed){var elapsedMS=Ticker2.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS),(!this._updateFPS||this._msToNextUpdate<=0)&&(_super.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},VideoResource3.prototype.load=function(){var _this=this;if(this._load)return this._load;var source=this.source;return(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),source.addEventListener("play",this._onPlayStart.bind(this)),source.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("error",this._onError,!0)),this._load=new Promise(function(resolve4){_this.valid?resolve4(_this):(_this._resolve=resolve4,source.load())}),this._load},VideoResource3.prototype._onError=function(event){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(event)},VideoResource3.prototype._isSourcePlaying=function(){var source=this.source;return source.currentTime>0&&source.paused===!1&&source.ended===!1&&source.readyState>2},VideoResource3.prototype._isSourceReady=function(){var source=this.source;return source.readyState===3||source.readyState===4},VideoResource3.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker2.shared.add(this.update,this),this._isConnectedToTicker=!0)},VideoResource3.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker2.shared.remove(this.update,this),this._isConnectedToTicker=!1)},VideoResource3.prototype._onCanPlay=function(){var source=this.source;source.removeEventListener("canplay",this._onCanPlay),source.removeEventListener("canplaythrough",this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight),!valid&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&source.play()},VideoResource3.prototype.dispose=function(){this._isConnectedToTicker&&Ticker2.shared.remove(this.update,this);var source=this.source;source&&(source.removeEventListener("error",this._onError,!0),source.pause(),source.src="",source.load()),_super.prototype.dispose.call(this)},Object.defineProperty(VideoResource3.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(Ticker2.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker2.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(VideoResource3.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(value){value!==this._updateFPS&&(this._updateFPS=value)},enumerable:!1,configurable:!0}),VideoResource3.test=function(source,extension){return self.HTMLVideoElement&&source instanceof HTMLVideoElement||VideoResource3.TYPES.indexOf(extension)>-1},VideoResource3.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],VideoResource3.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},VideoResource3}(BaseImageResource2),ImageBitmapResource2=function(_super){__extends23(ImageBitmapResource3,_super);function ImageBitmapResource3(source){return _super.call(this,source)||this}return ImageBitmapResource3.test=function(source){return!!self.createImageBitmap&&source instanceof ImageBitmap},ImageBitmapResource3}(BaseImageResource2);INSTALLED2.push(ImageResource2,ImageBitmapResource2,CanvasResource2,VideoResource2,SVGResource2,BufferResource2,CubeResource2,ArrayResource2);var _resources2={__proto__:null,Resource:Resource3,BaseImageResource:BaseImageResource2,INSTALLED:INSTALLED2,autoDetectResource:autoDetectResource2,AbstractMultiResource:AbstractMultiResource2,ArrayResource:ArrayResource2,BufferResource:BufferResource2,CanvasResource:CanvasResource2,CubeResource:CubeResource2,ImageResource:ImageResource2,SVGResource:SVGResource2,VideoResource:VideoResource2,ImageBitmapResource:ImageBitmapResource2},System2=function(){function System3(renderer){this.renderer=renderer}return System3.prototype.destroy=function(){this.renderer=null},System3}(),DepthResource2=function(_super){__extends23(DepthResource3,_super);function DepthResource3(){return _super!==null&&_super.apply(this,arguments)||this}return DepthResource3.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES2.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,baseTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,renderer.context.webGLVersion===1?gl.DEPTH_COMPONENT:gl.DEPTH_COMPONENT16,width,height,0,baseTexture.format,baseTexture.type,this.data)),!0},DepthResource3}(BufferResource2),Framebuffer2=function(){function Framebuffer3(width,height){this.width=Math.ceil(width||100),this.height=Math.ceil(height||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner2("disposeFramebuffer"),this.multisample=MSAA_QUALITY2.NONE}return Object.defineProperty(Framebuffer3.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),Framebuffer3.prototype.addColorTexture=function(index3,texture){return index3===void 0&&(index3=0),this.colorTextures[index3]=texture||new BaseTexture2(null,{scaleMode:SCALE_MODES2.NEAREST,resolution:1,mipmap:MIPMAP_MODES2.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.addDepthTexture=function(texture){return this.depthTexture=texture||new BaseTexture2(new DepthResource2(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES2.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES2.OFF,format:FORMATS2.DEPTH_COMPONENT,type:TYPES2.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer3.prototype.resize=function(width,height){if(width=Math.ceil(width),height=Math.ceil(height),!(width===this.width&&height===this.height)){this.width=width,this.height=height,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i],resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}if(this.depthTexture){var resolution=this.depthTexture.resolution;this.depthTexture.setSize(width/resolution,height/resolution)}}},Framebuffer3.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Framebuffer3.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},Framebuffer3}(),BaseRenderTexture2=function(_super){__extends23(BaseRenderTexture3,_super);function BaseRenderTexture3(options){var _this=this;if(typeof options=="number"){var width_1=arguments[0],height_1=arguments[1],scaleMode=arguments[2],resolution=arguments[3];options={width:width_1,height:height_1,scaleMode,resolution}}_this=_super.call(this,null,options)||this;var _a3=options||{},width=_a3.width,height=_a3.height;return _this.mipmap=MIPMAP_MODES2.OFF,_this.width=Math.ceil(width)||100,_this.height=Math.ceil(height)||100,_this.valid=!0,_this.clearColor=[0,0,0,0],_this.framebuffer=new Framebuffer2(_this.width*_this.resolution,_this.height*_this.resolution).addColorTexture(0,_this),_this.maskStack=[],_this.filterStack=[{}],_this}return BaseRenderTexture3.prototype.resize=function(width,height){width=Math.ceil(width),height=Math.ceil(height),this.framebuffer.resize(width*this.resolution,height*this.resolution)},BaseRenderTexture3.prototype.dispose=function(){this.framebuffer.dispose(),_super.prototype.dispose.call(this)},BaseRenderTexture3.prototype.destroy=function(){_super.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},BaseRenderTexture3}(BaseTexture2),TextureUvs2=function(){function TextureUvs3(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return TextureUvs3.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){var w2=frame.width/2/tw,h2=frame.height/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=groupD82.add(rotate,groupD82.NW),this.x0=cX+w2*groupD82.uX(rotate),this.y0=cY+h2*groupD82.uY(rotate),rotate=groupD82.add(rotate,2),this.x1=cX+w2*groupD82.uX(rotate),this.y1=cY+h2*groupD82.uY(rotate),rotate=groupD82.add(rotate,2),this.x2=cX+w2*groupD82.uX(rotate),this.y2=cY+h2*groupD82.uY(rotate),rotate=groupD82.add(rotate,2),this.x3=cX+w2*groupD82.uX(rotate),this.y3=cY+h2*groupD82.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},TextureUvs3.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},TextureUvs3}(),DEFAULT_UVS2=new TextureUvs2,Texture2=function(_super){__extends23(Texture3,_super);function Texture3(baseTexture,frame,orig,trim,rotate,anchor){var _this=_super.call(this)||this;if(_this.noFrame=!1,frame||(_this.noFrame=!0,frame=new Rectangle2(0,0,1,1)),baseTexture instanceof Texture3&&(baseTexture=baseTexture.baseTexture),_this.baseTexture=baseTexture,_this._frame=frame,_this.trim=trim,_this.valid=!1,_this._uvs=DEFAULT_UVS2,_this.uvMatrix=null,_this.orig=orig||frame,_this._rotate=Number(rotate||0),rotate===!0)_this._rotate=2;else if(_this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return _this.defaultAnchor=anchor?new Point2(anchor.x,anchor.y):new Point2(0,0),_this._updateID=0,_this.textureCacheIds=[],baseTexture.valid?_this.noFrame?baseTexture.valid&&_this.onBaseTextureUpdated(baseTexture):_this.frame=frame:baseTexture.once("loaded",_this.onBaseTextureUpdated,_this),_this.noFrame&&baseTexture.on("update",_this.onBaseTextureUpdated,_this),_this}return Texture3.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},Texture3.prototype.onBaseTextureUpdated=function(baseTexture){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},Texture3.prototype.destroy=function(destroyBase){if(this.baseTexture){if(destroyBase){var resource=this.baseTexture.resource;resource&&resource.url&&TextureCache2[resource.url]&&Texture3.removeFromCache(resource.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture3.removeFromCache(this),this.textureCacheIds=null},Texture3.prototype.clone=function(){var clonedFrame=this._frame.clone(),clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone(),clonedTexture=new Texture3(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(clonedTexture._frame=clonedFrame),clonedTexture},Texture3.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS2&&(this._uvs=new TextureUvs2),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Texture3.from=function(source,options,strict){options===void 0&&(options={}),strict===void 0&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame=typeof source=="string",cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+uid2()}cacheId=source._pixiId}var texture=TextureCache2[cacheId];if(isFrame&&strict&&!texture)throw new Error('The cacheId "'+cacheId+'" does not exist in TextureCache.');return texture||(options.resolution||(options.resolution=getResolutionOfUrl2(source)),texture=new Texture3(new BaseTexture2(source,options)),texture.baseTexture.cacheId=cacheId,BaseTexture2.addToCache(texture.baseTexture,cacheId),Texture3.addToCache(texture,cacheId)),texture},Texture3.fromURL=function(url3,options){var resourceOptions=Object.assign({autoLoad:!1},options==null?void 0:options.resourceOptions),texture=Texture3.from(url3,Object.assign({resourceOptions},options),!1),resource=texture.baseTexture.resource;return texture.baseTexture.valid?Promise.resolve(texture):resource.load().then(function(){return Promise.resolve(texture)})},Texture3.fromBuffer=function(buffer,width,height,options){return new Texture3(BaseTexture2.fromBuffer(buffer,width,height,options))},Texture3.fromLoader=function(source,imageUrl,name,options){var baseTexture=new BaseTexture2(source,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl2(imageUrl)},options)),resource=baseTexture.resource;resource instanceof ImageResource2&&(resource.url=imageUrl);var texture=new Texture3(baseTexture);return name||(name=imageUrl),BaseTexture2.addToCache(texture.baseTexture,name),Texture3.addToCache(texture,name),name!==imageUrl&&(BaseTexture2.addToCache(texture.baseTexture,imageUrl),Texture3.addToCache(texture,imageUrl)),texture.baseTexture.valid?Promise.resolve(texture):new Promise(function(resolve4){texture.baseTexture.once("loaded",function(){return resolve4(texture)})})},Texture3.addToCache=function(texture,id){id&&(texture.textureCacheIds.indexOf(id)===-1&&texture.textureCacheIds.push(id),TextureCache2[id]&&console.warn("Texture added to the cache with an id ["+id+"] that already had an entry"),TextureCache2[id]=texture)},Texture3.removeFromCache=function(texture){if(typeof texture=="string"){var textureFromCache=TextureCache2[texture];if(textureFromCache){var index3=textureFromCache.textureCacheIds.indexOf(texture);return index3>-1&&textureFromCache.textureCacheIds.splice(index3,1),delete TextureCache2[texture],textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i)TextureCache2[texture.textureCacheIds[i]]===texture&&delete TextureCache2[texture.textureCacheIds[i]];return texture.textureCacheIds.length=0,texture}return null},Object.defineProperty(Texture3.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"frame",{get:function(){return this._frame},set:function(frame){this._frame=frame,this.noFrame=!1;var x=frame.x,y=frame.y,width=frame.width,height=frame.height,xNotFit=x+width>this.baseTexture.width,yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or",errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width,errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(errorX+" "+relationship+" "+errorY))}this.valid=width&&height&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=frame),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"rotate",{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(Texture3.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),Texture3.prototype.castToBaseTexture=function(){return this.baseTexture},Texture3}(eventemitter3);function createWhiteTexture2(){var canvas2=document.createElement("canvas");canvas2.width=16,canvas2.height=16;var context4=canvas2.getContext("2d");return context4.fillStyle="white",context4.fillRect(0,0,16,16),new Texture2(new BaseTexture2(new CanvasResource2(canvas2)))}function removeAllHandlers2(tex){tex.destroy=function(){},tex.on=function(){},tex.once=function(){},tex.emit=function(){}}Texture2.EMPTY=new Texture2(new BaseTexture2);removeAllHandlers2(Texture2.EMPTY);removeAllHandlers2(Texture2.EMPTY.baseTexture);Texture2.WHITE=createWhiteTexture2();removeAllHandlers2(Texture2.WHITE);removeAllHandlers2(Texture2.WHITE.baseTexture);var RenderTexture2=function(_super){__extends23(RenderTexture3,_super);function RenderTexture3(baseRenderTexture,frame){var _this=_super.call(this,baseRenderTexture,frame)||this;return _this.valid=!0,_this.filterFrame=null,_this.filterPoolKey=null,_this.updateUvs(),_this}return Object.defineProperty(RenderTexture3.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),RenderTexture3.prototype.resize=function(width,height,resizeBaseTexture){resizeBaseTexture===void 0&&(resizeBaseTexture=!0),width=Math.ceil(width),height=Math.ceil(height),this.valid=width>0&&height>0,this._frame.width=this.orig.width=width,this._frame.height=this.orig.height=height,resizeBaseTexture&&this.baseTexture.resize(width,height),this.updateUvs()},RenderTexture3.prototype.setResolution=function(resolution){var baseTexture=this.baseTexture;baseTexture.resolution!==resolution&&(baseTexture.setResolution(resolution),this.resize(baseTexture.width,baseTexture.height,!1))},RenderTexture3.create=function(options){for(var arguments$1=arguments,rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments$1[_i];return typeof options=="number"&&(deprecation2("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),options={width:options,height:rest[0],scaleMode:rest[1],resolution:rest[2]}),new RenderTexture3(new BaseRenderTexture2(options))},RenderTexture3}(Texture2),RenderTexturePool2=function(){function RenderTexturePool3(textureOptions){this.texturePool={},this.textureOptions=textureOptions||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return RenderTexturePool3.prototype.createTexture=function(realWidth,realHeight){var baseRenderTexture=new BaseRenderTexture2(Object.assign({width:realWidth,height:realHeight,resolution:1},this.textureOptions));return new RenderTexture2(baseRenderTexture)},RenderTexturePool3.prototype.getOptimalTexture=function(minWidth,minHeight,resolution){resolution===void 0&&(resolution=1);var key=RenderTexturePool3.SCREEN_KEY;minWidth*=resolution,minHeight*=resolution,(!this.enableFullScreen||minWidth!==this._pixelsWidth||minHeight!==this._pixelsHeight)&&(minWidth=nextPow22(minWidth),minHeight=nextPow22(minHeight),key=(minWidth&65535)<<16|minHeight&65535),this.texturePool[key]||(this.texturePool[key]=[]);var renderTexture=this.texturePool[key].pop();return renderTexture||(renderTexture=this.createTexture(minWidth,minHeight)),renderTexture.filterPoolKey=key,renderTexture.setResolution(resolution),renderTexture},RenderTexturePool3.prototype.getFilterTexture=function(input,resolution){var filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution);return filterTexture.filterFrame=input.filterFrame,filterTexture},RenderTexturePool3.prototype.returnTexture=function(renderTexture){var key=renderTexture.filterPoolKey;renderTexture.filterFrame=null,this.texturePool[key].push(renderTexture)},RenderTexturePool3.prototype.returnFilterTexture=function(renderTexture){this.returnTexture(renderTexture)},RenderTexturePool3.prototype.clear=function(destroyTextures){if(destroyTextures=destroyTextures!==!1,destroyTextures)for(var i in this.texturePool){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0)}this.texturePool={}},RenderTexturePool3.prototype.setScreenSize=function(size){if(!(size.width===this._pixelsWidth&&size.height===this._pixelsHeight)){var screenKey=RenderTexturePool3.SCREEN_KEY,textures=this.texturePool[screenKey];if(this.enableFullScreen=size.width>0&&size.height>0,textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0);this.texturePool[screenKey]=[],this._pixelsWidth=size.width,this._pixelsHeight=size.height}},RenderTexturePool3.SCREEN_KEY="screen",RenderTexturePool3}(),Attribute2=function(){function Attribute3(buffer,size,normalized,type,stride,start2,instance){size===void 0&&(size=0),normalized===void 0&&(normalized=!1),type===void 0&&(type=TYPES2.FLOAT),this.buffer=buffer,this.size=size,this.normalized=normalized,this.type=type,this.stride=stride,this.start=start2,this.instance=instance}return Attribute3.prototype.destroy=function(){this.buffer=null},Attribute3.from=function(buffer,size,normalized,type,stride){return new Attribute3(buffer,size,normalized,type,stride)},Attribute3}(),UID2=0,Buffer3=function(){function Buffer5(data,_static,index3){_static===void 0&&(_static=!0),index3===void 0&&(index3=!1),this.data=data||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=index3,this.static=_static,this.id=UID2++,this.disposeRunner=new Runner2("disposeBuffer")}return Buffer5.prototype.update=function(data){this.data=data||this.data,this._updateID++},Buffer5.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Buffer5.prototype.destroy=function(){this.dispose(),this.data=null},Buffer5.from=function(data){return data instanceof Array&&(data=new Float32Array(data)),new Buffer5(data)},Buffer5}();function getBufferType3(array){if(array.BYTES_PER_ELEMENT===4)return array instanceof Float32Array?"Float32Array":array instanceof Uint32Array?"Uint32Array":"Int32Array";if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array)return"Uint16Array"}else if(array.BYTES_PER_ELEMENT===1&&array instanceof Uint8Array)return"Uint8Array";return null}var map3={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays3(arrays,sizes){for(var outSize=0,stride=0,views={},i=0;i<arrays.length;i++)stride+=sizes[i],outSize+=arrays[i].length;for(var buffer=new ArrayBuffer(outSize*4),out=null,littleOffset=0,i=0;i<arrays.length;i++){var size=sizes[i],array=arrays[i],type=getBufferType3(array);views[type]||(views[type]=new map3[type](buffer)),out=views[type];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset,index3=j%size;out[indexStart+index3]=array[j]}littleOffset+=size}return new Float32Array(buffer)}var byteSizeMap2={5126:4,5123:2,5121:1},UID$12=0,map$12={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Geometry2=function(){function Geometry3(buffers,attributes){buffers===void 0&&(buffers=[]),attributes===void 0&&(attributes={}),this.buffers=buffers,this.indexBuffer=null,this.attributes=attributes,this.glVertexArrayObjects={},this.id=UID$12++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner2("disposeGeometry"),this.refCount=0}return Geometry3.prototype.addAttribute=function(id,buffer,size,normalized,type,stride,start2,instance){if(size===void 0&&(size=0),normalized===void 0&&(normalized=!1),instance===void 0&&(instance=!1),!buffer)throw new Error("You must pass a buffer when creating an attribute");buffer instanceof Buffer3||(buffer instanceof Array&&(buffer=new Float32Array(buffer)),buffer=new Buffer3(buffer));var ids=id.split("|");if(ids.length>1){for(var i=0;i<ids.length;i++)this.addAttribute(ids[i],buffer,size,normalized,type);return this}var bufferIndex=this.buffers.indexOf(buffer);return bufferIndex===-1&&(this.buffers.push(buffer),bufferIndex=this.buffers.length-1),this.attributes[id]=new Attribute2(bufferIndex,size,normalized,type,stride,start2,instance),this.instanced=this.instanced||instance,this},Geometry3.prototype.getAttribute=function(id){return this.attributes[id]},Geometry3.prototype.getBuffer=function(id){return this.buffers[this.getAttribute(id).buffer]},Geometry3.prototype.addIndex=function(buffer){return buffer instanceof Buffer3||(buffer instanceof Array&&(buffer=new Uint16Array(buffer)),buffer=new Buffer3(buffer)),buffer.index=!0,this.indexBuffer=buffer,this.buffers.indexOf(buffer)===-1&&this.buffers.push(buffer),this},Geometry3.prototype.getIndex=function(){return this.indexBuffer},Geometry3.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var arrays=[],sizes=[],interleavedBuffer=new Buffer3,i;for(i in this.attributes){var attribute=this.attributes[i],buffer=this.buffers[attribute.buffer];arrays.push(buffer.data),sizes.push(attribute.size*byteSizeMap2[attribute.type]/4),attribute.buffer=0}for(interleavedBuffer.data=interleaveTypedArrays3(arrays,sizes),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[interleavedBuffer],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Geometry3.prototype.getSize=function(){for(var i in this.attributes){var attribute=this.attributes[i],buffer=this.buffers[attribute.buffer];return buffer.data.length/(attribute.stride/4||attribute.size)}return 0},Geometry3.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Geometry3.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Geometry3.prototype.clone=function(){for(var geometry=new Geometry3,i=0;i<this.buffers.length;i++)geometry.buffers[i]=new Buffer3(this.buffers[i].data.slice(0));for(var i in this.attributes){var attrib=this.attributes[i];geometry.attributes[i]=new Attribute2(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}return this.indexBuffer&&(geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)],geometry.indexBuffer.index=!0),geometry},Geometry3.merge=function(geometries){for(var geometryOut=new Geometry3,arrays=[],sizes=[],offsets=[],geometry,i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)sizes[j]=sizes[j]||0,sizes[j]+=geometry.buffers[j].data.length,offsets[j]=0}for(var i=0;i<geometry.buffers.length;i++)arrays[i]=new map$12[getBufferType3(geometry.buffers[i].data)](sizes[i]),geometryOut.buffers[i]=new Buffer3(arrays[i]);for(var i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)arrays[j].set(geometry.buffers[j].data,offsets[j]),offsets[j]+=geometry.buffers[j].data.length}if(geometryOut.attributes=geometry.attributes,geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)],geometryOut.indexBuffer.index=!0;for(var offset=0,stride=0,offset2=0,bufferIndexToCount=0,i=0;i<geometry.buffers.length;i++)if(geometry.buffers[i]!==geometry.indexBuffer){bufferIndexToCount=i;break}for(var i in geometry.attributes){var attribute=geometry.attributes[i];(attribute.buffer|0)===bufferIndexToCount&&(stride+=attribute.size*byteSizeMap2[attribute.type]/4)}for(var i=0;i<geometries.length;i++){for(var indexBufferData=geometries[i].indexBuffer.data,j=0;j<indexBufferData.length;j++)geometryOut.indexBuffer.data[j+offset2]+=offset;offset+=geometry.buffers[bufferIndexToCount].data.length/stride,offset2+=indexBufferData.length}}return geometryOut},Geometry3}(),Quad2=function(_super){__extends23(Quad3,_super);function Quad3(){var _this=_super.call(this)||this;return _this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),_this}return Quad3}(Geometry2),QuadUv2=function(_super){__extends23(QuadUv3,_super);function QuadUv3(){var _this=_super.call(this)||this;return _this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),_this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),_this.vertexBuffer=new Buffer3(_this.vertices),_this.uvBuffer=new Buffer3(_this.uvs),_this.addAttribute("aVertexPosition",_this.vertexBuffer).addAttribute("aTextureCoord",_this.uvBuffer).addIndex([0,1,2,0,2,3]),_this}return QuadUv3.prototype.map=function(targetTextureFrame,destinationFrame){var x=0,y=0;return this.uvs[0]=x,this.uvs[1]=y,this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[3]=y,this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height,this.uvs[6]=x,this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height,x=destinationFrame.x,y=destinationFrame.y,this.vertices[0]=x,this.vertices[1]=y,this.vertices[2]=x+destinationFrame.width,this.vertices[3]=y,this.vertices[4]=x+destinationFrame.width,this.vertices[5]=y+destinationFrame.height,this.vertices[6]=x,this.vertices[7]=y+destinationFrame.height,this.invalidate(),this},QuadUv3.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},QuadUv3}(Geometry2),UID$22=0,UniformGroup2=function(){function UniformGroup3(uniforms,_static){this.uniforms=uniforms,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$22++,this.static=!!_static}return UniformGroup3.prototype.update=function(){this.dirtyId++},UniformGroup3.prototype.add=function(name,uniforms,_static){this.uniforms[name]=new UniformGroup3(uniforms,_static)},UniformGroup3.from=function(uniforms,_static){return new UniformGroup3(uniforms,_static)},UniformGroup3}(),FilterState2=function(){function FilterState3(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Rectangle2,this.destinationFrame=new Rectangle2,this.bindingSourceFrame=new Rectangle2,this.bindingDestinationFrame=new Rectangle2,this.filters=[],this.transform=null}return FilterState3.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},FilterState3}(),tempPoints2=[new Point2,new Point2,new Point2,new Point2],tempMatrix3=new Matrix2,FilterSystem2=function(_super){__extends23(FilterSystem3,_super);function FilterSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.defaultFilterStack=[{}],_this.texturePool=new RenderTexturePool2,_this.texturePool.setScreenSize(renderer.view),_this.statePool=[],_this.quad=new Quad2,_this.quadUv=new QuadUv2,_this.tempRect=new Rectangle2,_this.activeState={},_this.globalUniforms=new UniformGroup2({outputFrame:new Rectangle2,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),_this.forceClear=!1,_this.useMaxPadding=!1,_this}return FilterSystem3.prototype.push=function(target,filters2){for(var renderer=this.renderer,filterStack=this.defaultFilterStack,state=this.statePool.pop()||new FilterState2,renderTextureSystem=this.renderer.renderTexture,resolution=filters2[0].resolution,padding=filters2[0].padding,autoFit=filters2[0].autoFit,legacy=filters2[0].legacy,i=1;i<filters2.length;i++){var filter=filters2[i];resolution=Math.min(resolution,filter.resolution),padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding,autoFit=autoFit&&filter.autoFit,legacy=legacy||filter.legacy}if(filterStack.length===1&&(this.defaultFilterStack[0].renderTexture=renderTextureSystem.current),filterStack.push(state),state.resolution=resolution,state.legacy=legacy,state.target=target,state.sourceFrame.copyFrom(target.filterArea||target.getBounds(!0)),state.sourceFrame.pad(padding),autoFit){var sourceFrameProjected=this.tempRect.copyFrom(renderTextureSystem.sourceFrame);renderer.projection.transform&&this.transformAABB(tempMatrix3.copyFrom(renderer.projection.transform).invert(),sourceFrameProjected),state.sourceFrame.fit(sourceFrameProjected)}this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform),state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution),state.filters=filters2,state.destinationFrame.width=state.renderTexture.width,state.destinationFrame.height=state.renderTexture.height;var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=state.sourceFrame.width,destinationFrame.height=state.sourceFrame.height,state.renderTexture.filterFrame=state.sourceFrame,state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame),state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame),state.transform=renderer.projection.transform,renderer.projection.transform=null,renderTextureSystem.bind(state.renderTexture,state.sourceFrame,destinationFrame),renderer.framebuffer.clear(0,0,0,0)},FilterSystem3.prototype.pop=function(){var filterStack=this.defaultFilterStack,state=filterStack.pop(),filters2=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame,globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize,inputPixel=globalUniforms.inputPixel,inputClamp=globalUniforms.inputClamp;if(inputSize[0]=state.destinationFrame.width,inputSize[1]=state.destinationFrame.height,inputSize[2]=1/inputSize[0],inputSize[3]=1/inputSize[1],inputPixel[0]=inputSize[0]*state.resolution,inputPixel[1]=inputSize[1]*state.resolution,inputPixel[2]=1/inputPixel[0],inputPixel[3]=1/inputPixel[1],inputClamp[0]=.5*inputPixel[2],inputClamp[1]=.5*inputPixel[3],inputClamp[2]=state.sourceFrame.width*inputSize[2]-.5*inputPixel[2],inputClamp[3]=state.sourceFrame.height*inputSize[3]-.5*inputPixel[3],state.legacy){var filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width,filterArea[1]=state.destinationFrame.height,filterArea[2]=state.sourceFrame.x,filterArea[3]=state.sourceFrame.y,globalUniforms.filterClamp=globalUniforms.inputClamp}this.globalUniforms.update();var lastState=filterStack[filterStack.length-1];if(state.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),filters2.length===1)filters2[0].apply(this,state.renderTexture,lastState.renderTexture,CLEAR_MODES2.BLEND,state),this.returnFilterTexture(state.renderTexture);else{var flip=state.renderTexture,flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;var i=0;for(i=0;i<filters2.length-1;++i){filters2[i].apply(this,flip,flop,CLEAR_MODES2.CLEAR,state);var t=flip;flip=flop,flop=t}filters2[i].apply(this,flip,lastState.renderTexture,CLEAR_MODES2.BLEND,state),this.returnFilterTexture(flip),this.returnFilterTexture(flop)}state.clear(),this.statePool.push(state)},FilterSystem3.prototype.bindAndClear=function(filterTexture,clearMode){clearMode===void 0&&(clearMode=CLEAR_MODES2.CLEAR);var _a3=this.renderer,renderTextureSystem=_a3.renderTexture,stateSystem=_a3.state;if(filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,filterTexture&&filterTexture.filterFrame){var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=filterTexture.filterFrame.width,destinationFrame.height=filterTexture.filterFrame.height,renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame)}else filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?renderTextureSystem.bind(filterTexture):this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var autoClear=stateSystem.stateId&1||this.forceClear;(clearMode===CLEAR_MODES2.CLEAR||clearMode===CLEAR_MODES2.BLIT&&autoClear)&&this.renderer.framebuffer.clear(0,0,0,0)},FilterSystem3.prototype.applyFilter=function(filter,input,output,clearMode){var renderer=this.renderer;renderer.state.set(filter.state),this.bindAndClear(output,clearMode),filter.uniforms.uSampler=input,filter.uniforms.filterGlobals=this.globalUniforms,renderer.shader.bind(filter),filter.legacy?(this.quadUv.map(input._frame,input.filterFrame),renderer.geometry.bind(this.quadUv),renderer.geometry.draw(DRAW_MODES2.TRIANGLES)):(renderer.geometry.bind(this.quad),renderer.geometry.draw(DRAW_MODES2.TRIANGLE_STRIP))},FilterSystem3.prototype.calculateSpriteMatrix=function(outputMatrix,sprite){var _a3=this.activeState,sourceFrame=_a3.sourceFrame,destinationFrame=_a3.destinationFrame,orig=sprite._texture.orig,mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y),worldTransform=sprite.worldTransform.copyTo(Matrix2.TEMP_MATRIX);return worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1/orig.width,1/orig.height),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix},FilterSystem3.prototype.destroy=function(){this.texturePool.clear(!1)},FilterSystem3.prototype.getOptimalFilterTexture=function(minWidth,minHeight,resolution){return resolution===void 0&&(resolution=1),this.texturePool.getOptimalTexture(minWidth,minHeight,resolution)},FilterSystem3.prototype.getFilterTexture=function(input,resolution){if(typeof input=="number"){var swap=input;input=resolution,resolution=swap}input=input||this.activeState.renderTexture;var filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution);return filterTexture.filterFrame=input.filterFrame,filterTexture},FilterSystem3.prototype.returnFilterTexture=function(renderTexture){this.texturePool.returnTexture(renderTexture)},FilterSystem3.prototype.emptyPool=function(){this.texturePool.clear(!0)},FilterSystem3.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},FilterSystem3.prototype.transformAABB=function(matrix,rect){var lt=tempPoints2[0],lb=tempPoints2[1],rt=tempPoints2[2],rb=tempPoints2[3];lt.set(rect.left,rect.top),lb.set(rect.left,rect.bottom),rt.set(rect.right,rect.top),rb.set(rect.right,rect.bottom),matrix.apply(lt,lt),matrix.apply(lb,lb),matrix.apply(rt,rt),matrix.apply(rb,rb);var x0=Math.min(lt.x,lb.x,rt.x,rb.x),y0=Math.min(lt.y,lb.y,rt.y,rb.y),x1=Math.max(lt.x,lb.x,rt.x,rb.x),y1=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=x0,rect.y=y0,rect.width=x1-x0,rect.height=y1-y0},FilterSystem3.prototype.roundFrame=function(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(transform){var a=transform.a,b=transform.b,c=transform.c,d=transform.d;if((b!==0||c!==0)&&(a!==0||d!==0))return}transform=transform?tempMatrix3.copyFrom(transform):tempMatrix3.identity(),transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.transformAABB(transform,frame),frame.ceil(resolution),this.transformAABB(transform.invert(),frame)},FilterSystem3}(System2),ObjectRenderer2=function(){function ObjectRenderer3(renderer){this.renderer=renderer}return ObjectRenderer3.prototype.flush=function(){},ObjectRenderer3.prototype.destroy=function(){this.renderer=null},ObjectRenderer3.prototype.start=function(){},ObjectRenderer3.prototype.stop=function(){this.flush()},ObjectRenderer3.prototype.render=function(_object){},ObjectRenderer3}(),BatchSystem2=function(_super){__extends23(BatchSystem3,_super);function BatchSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.emptyRenderer=new ObjectRenderer2(renderer),_this.currentRenderer=_this.emptyRenderer,_this}return BatchSystem3.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())},BatchSystem3.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem3.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem3.prototype.copyBoundTextures=function(arr,maxTextures){for(var boundTextures=this.renderer.texture.boundTextures,i=maxTextures-1;i>=0;--i)arr[i]=boundTextures[i]||null,arr[i]&&(arr[i]._batchLocation=i)},BatchSystem3.prototype.boundArray=function(texArray,boundTextures,batchId,maxTextures){for(var elements=texArray.elements,ids=texArray.ids,count2=texArray.count,j=0,i=0;i<count2;i++){var tex=elements[i],loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex){ids[i]=loc;continue}for(;j<maxTextures;){var bound=boundTextures[j];if(bound&&bound._batchEnabled===batchId&&bound._batchLocation===j){j++;continue}ids[i]=j,tex._batchLocation=j,boundTextures[j]=tex;break}}},BatchSystem3}(System2),CONTEXT_UID_COUNTER2=0,ContextSystem2=function(_super){__extends23(ContextSystem3,_super);function ContextSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.webGLVersion=1,_this.extensions={},_this.supports={uint32Indices:!1},_this.handleContextLost=_this.handleContextLost.bind(_this),_this.handleContextRestored=_this.handleContextRestored.bind(_this),renderer.view.addEventListener("webglcontextlost",_this.handleContextLost,!1),renderer.view.addEventListener("webglcontextrestored",_this.handleContextRestored,!1),_this}return Object.defineProperty(ContextSystem3.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),ContextSystem3.prototype.contextChange=function(gl){this.gl=gl,this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER2++,gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").restoreContext()},ContextSystem3.prototype.initFromContext=function(gl){this.gl=gl,this.validateContext(gl),this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER2++,this.renderer.runners.contextChange.emit(gl)},ContextSystem3.prototype.initFromOptions=function(options){var gl=this.createContext(this.renderer.view,options);this.initFromContext(gl)},ContextSystem3.prototype.createContext=function(canvas2,options){var gl;if(settings.PREFER_ENV>=ENV2.WEBGL2&&(gl=canvas2.getContext("webgl2",options)),gl)this.webGLVersion=2;else if(this.webGLVersion=1,gl=canvas2.getContext("webgl",options)||canvas2.getContext("experimental-webgl",options),!gl)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=gl,this.getExtensions(),this.gl},ContextSystem3.prototype.getExtensions=function(){var gl=this.gl,common={anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),loseContext:gl.getExtension("WEBGL_lose_context"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")})},ContextSystem3.prototype.handleContextLost=function(event){event.preventDefault()},ContextSystem3.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},ContextSystem3.prototype.destroy=function(){var view=this.renderer.view;view.removeEventListener("webglcontextlost",this.handleContextLost),view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},ContextSystem3.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},ContextSystem3.prototype.validateContext=function(gl){var attributes=gl.getContextAttributes(),isWebGl2="WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext;isWebGl2&&(this.webGLVersion=2),attributes.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var hasuint32=isWebGl2||!!gl.getExtension("OES_element_index_uint");this.supports.uint32Indices=hasuint32,hasuint32||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},ContextSystem3}(System2),GLFramebuffer2=function(){function GLFramebuffer3(framebuffer){this.framebuffer=framebuffer,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=MSAA_QUALITY2.NONE,this.msaaBuffer=null,this.blitFramebuffer=null}return GLFramebuffer3}(),tempRectangle2=new Rectangle2,FramebufferSystem2=function(_super){__extends23(FramebufferSystem3,_super);function FramebufferSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.managedFramebuffers=[],_this.unknownFramebuffer=new Framebuffer2(10,10),_this.msaaSamples=null,_this}return FramebufferSystem3.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle2,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){var nativeDrawBuffersExtension_1=this.renderer.context.extensions.drawBuffers,nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV2.WEBGL_LEGACY&&(nativeDrawBuffersExtension_1=null,nativeDepthTextureExtension=null),nativeDrawBuffersExtension_1?gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension_1.drawBuffersWEBGL(activeTextures)}:(this.hasMRT=!1,gl.drawBuffers=function(){}),nativeDepthTextureExtension||(this.writeDepthTexture=!1)}else this.msaaSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES)},FramebufferSystem3.prototype.bind=function(framebuffer,frame){var gl=this.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);this.current!==framebuffer&&(this.current=framebuffer,gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer)),fbo.dirtyId!==framebuffer.dirtyId&&(fbo.dirtyId=framebuffer.dirtyId,fbo.dirtyFormat!==framebuffer.dirtyFormat?(fbo.dirtyFormat=framebuffer.dirtyFormat,this.updateFramebuffer(framebuffer)):fbo.dirtySize!==framebuffer.dirtySize&&(fbo.dirtySize=framebuffer.dirtySize,this.resizeFramebuffer(framebuffer)));for(var i=0;i<framebuffer.colorTextures.length;i++){var tex=framebuffer.colorTextures[i];this.renderer.texture.unbind(tex.parentTextureArray||tex)}framebuffer.depthTexture&&this.renderer.texture.unbind(framebuffer.depthTexture),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,framebuffer.width,framebuffer.height)}else this.current&&(this.current=null,gl.bindFramebuffer(gl.FRAMEBUFFER,null)),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},FramebufferSystem3.prototype.setViewport=function(x,y,width,height){var v=this.viewport;(v.width!==width||v.height!==height||v.x!==x||v.y!==y)&&(v.x=x,v.y=y,v.width=width,v.height=height,this.gl.viewport(x,y,width,height))},Object.defineProperty(FramebufferSystem3.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),FramebufferSystem3.prototype.clear=function(r,g,b,a,mask){mask===void 0&&(mask=BUFFER_BITS2.COLOR|BUFFER_BITS2.DEPTH);var gl=this.gl;gl.clearColor(r,g,b,a),gl.clear(mask)},FramebufferSystem3.prototype.initFramebuffer=function(framebuffer){var gl=this.gl,fbo=new GLFramebuffer2(gl.createFramebuffer());return fbo.multisample=this.detectSamples(framebuffer.multisample),framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo,this.managedFramebuffers.push(framebuffer),framebuffer.disposeRunner.add(this),fbo},FramebufferSystem3.prototype.resizeFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];fbo.stencil&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height));for(var colorTextures=framebuffer.colorTextures,i=0;i<colorTextures.length;i++)this.renderer.texture.bind(colorTextures[i],0);framebuffer.depthTexture&&this.renderer.texture.bind(framebuffer.depthTexture,0)},FramebufferSystem3.prototype.updateFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],colorTextures=framebuffer.colorTextures,count2=colorTextures.length;gl.drawBuffers||(count2=Math.min(count2,1)),fbo.multisample>1&&(fbo.msaaBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer));for(var activeTextures=[],i=0;i<count2;i++)if(!(i===0&&fbo.multisample>1)){var texture=framebuffer.colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,0),activeTextures.push(gl.COLOR_ATTACHMENT0+i)}if(activeTextures.length>1&&gl.drawBuffers(activeTextures),framebuffer.depthTexture){var writeDepthTexture=this.writeDepthTexture;if(writeDepthTexture){var depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,0)}}!fbo.stencil&&(framebuffer.stencil||framebuffer.depth)&&(fbo.stencil=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height),framebuffer.depthTexture||gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil))},FramebufferSystem3.prototype.detectSamples=function(samples){var msaaSamples=this.msaaSamples,res=MSAA_QUALITY2.NONE;if(samples<=1||msaaSamples===null)return res;for(var i=0;i<msaaSamples.length;i++)if(msaaSamples[i]<=samples){res=msaaSamples[i];break}return res===1&&(res=MSAA_QUALITY2.NONE),res},FramebufferSystem3.prototype.blit=function(framebuffer,sourcePixels,destPixels){var _a3=this,current=_a3.current,renderer=_a3.renderer,gl=_a3.gl,CONTEXT_UID=_a3.CONTEXT_UID;if(renderer.context.webGLVersion===2&&!!current){var fbo=current.glFramebuffers[CONTEXT_UID];if(!!fbo){if(!framebuffer){if(fbo.multisample<=1)return;fbo.blitFramebuffer||(fbo.blitFramebuffer=new Framebuffer2(current.width,current.height),fbo.blitFramebuffer.addColorTexture(0,current.colorTextures[0])),framebuffer=fbo.blitFramebuffer,framebuffer.width=current.width,framebuffer.height=current.height}sourcePixels||(sourcePixels=tempRectangle2,sourcePixels.width=current.width,sourcePixels.height=current.height),destPixels||(destPixels=sourcePixels);var sameSize=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,fbo.framebuffer),gl.blitFramebuffer(sourcePixels.x,sourcePixels.y,sourcePixels.width,sourcePixels.height,destPixels.x,destPixels.y,destPixels.width,destPixels.height,gl.COLOR_BUFFER_BIT,sameSize?gl.NEAREST:gl.LINEAR)}}},FramebufferSystem3.prototype.disposeFramebuffer=function(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],gl=this.gl;if(!!fbo){delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index3=this.managedFramebuffers.indexOf(framebuffer);index3>=0&&this.managedFramebuffers.splice(index3,1),framebuffer.disposeRunner.remove(this),contextLost||(gl.deleteFramebuffer(fbo.framebuffer),fbo.stencil&&gl.deleteRenderbuffer(fbo.stencil))}},FramebufferSystem3.prototype.disposeAll=function(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++)this.disposeFramebuffer(list[i],contextLost)},FramebufferSystem3.prototype.forceStencil=function(){var framebuffer=this.current;if(!!framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(!(!fbo||fbo.stencil)){framebuffer.enableStencil();var w=framebuffer.width,h=framebuffer.height,gl=this.gl,stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,h),fbo.stencil=stencil,gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil)}}},FramebufferSystem3.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle2},FramebufferSystem3}(System2),GLBuffer2=function(){function GLBuffer3(buffer){this.buffer=buffer||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return GLBuffer3}(),byteSizeMap$12={5126:4,5123:2,5121:1},GeometrySystem2=function(_super){__extends23(GeometrySystem3,_super);function GeometrySystem3(renderer){var _this=_super.call(this,renderer)||this;return _this._activeGeometry=null,_this._activeVao=null,_this.hasVao=!0,_this.hasInstance=!0,_this.canUseUInt32ElementIndex=!1,_this.managedGeometries={},_this.managedBuffers={},_this}return GeometrySystem3.prototype.contextChange=function(){this.disposeAll(!0);var gl=this.gl=this.renderer.gl,context4=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,context4.webGLVersion!==2){var nativeVaoExtension_1=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV2.WEBGL_LEGACY&&(nativeVaoExtension_1=null),nativeVaoExtension_1?(gl.createVertexArray=function(){return nativeVaoExtension_1.createVertexArrayOES()},gl.bindVertexArray=function(vao){return nativeVaoExtension_1.bindVertexArrayOES(vao)},gl.deleteVertexArray=function(vao){return nativeVaoExtension_1.deleteVertexArrayOES(vao)}):(this.hasVao=!1,gl.createVertexArray=function(){return null},gl.bindVertexArray=function(){return null},gl.deleteVertexArray=function(){return null})}if(context4.webGLVersion!==2){var instanceExt_1=gl.getExtension("ANGLE_instanced_arrays");instanceExt_1?(gl.vertexAttribDivisor=function(a,b){return instanceExt_1.vertexAttribDivisorANGLE(a,b)},gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt_1.drawElementsInstancedANGLE(a,b,c,d,e)},gl.drawArraysInstanced=function(a,b,c,d){return instanceExt_1.drawArraysInstancedANGLE(a,b,c,d)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=context4.webGLVersion===2||!!context4.extensions.uint32ElementIndex},GeometrySystem3.prototype.bind=function(geometry,shader){shader=shader||this.renderer.shader.shader;var gl=this.gl,vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],incRefCount=!1;vaos||(this.managedGeometries[geometry.id]=geometry,geometry.disposeRunner.add(this),geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={},incRefCount=!0);var vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader.program,incRefCount);this._activeGeometry=geometry,this._activeVao!==vao&&(this._activeVao=vao,this.hasVao?gl.bindVertexArray(vao):this.activateVao(geometry,shader.program)),this.updateBuffers()},GeometrySystem3.prototype.reset=function(){this.unbind()},GeometrySystem3.prototype.updateBuffers=function(){for(var geometry=this._activeGeometry,gl=this.gl,i=0;i<geometry.buffers.length;i++){var buffer=geometry.buffers[i],glBuffer=buffer._glBuffers[this.CONTEXT_UID];if(buffer._updateID!==glBuffer.updateID){glBuffer.updateID=buffer._updateID;var type=buffer.index?gl.ELEMENT_ARRAY_BUFFER:gl.ARRAY_BUFFER;if(gl.bindBuffer(type,glBuffer.buffer),this._boundBuffer=glBuffer,glBuffer.byteLength>=buffer.data.byteLength)gl.bufferSubData(type,0,buffer.data);else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength,gl.bufferData(type,buffer.data,drawType)}}}},GeometrySystem3.prototype.checkCompatibility=function(geometry,program){var geometryAttributes=geometry.attributes,shaderAttributes=program.attributeData;for(var j in shaderAttributes)if(!geometryAttributes[j])throw new Error('shader and geometry incompatible, geometry missing the "'+j+'" attribute')},GeometrySystem3.prototype.getSignature=function(geometry,program){var attribs=geometry.attributes,shaderAttributes=program.attributeData,strings=["g",geometry.id];for(var i in attribs)shaderAttributes[i]&&strings.push(i);return strings.join("-")},GeometrySystem3.prototype.initGeometryVao=function(geometry,program,incRefCount){incRefCount===void 0&&(incRefCount=!0),this.checkCompatibility(geometry,program);var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,signature=this.getSignature(geometry,program),vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID],vao=vaoObjectHash[signature];if(vao)return vaoObjectHash[program.id]=vao,vao;var buffers=geometry.buffers,attributes=geometry.attributes,tempStride={},tempStart={};for(var j in buffers)tempStride[j]=0,tempStart[j]=0;for(var j in attributes)!attributes[j].size&&program.attributeData[j]?attributes[j].size=program.attributeData[j].size:attributes[j].size||console.warn("PIXI Geometry attribute '"+j+"' size cannot be determined (likely the bound shader does not have the attribute)"),tempStride[attributes[j].buffer]+=attributes[j].size*byteSizeMap$12[attributes[j].type];for(var j in attributes){var attribute=attributes[j],attribSize=attribute.size;attribute.stride===void 0&&(tempStride[attribute.buffer]===attribSize*byteSizeMap$12[attribute.type]?attribute.stride=0:attribute.stride=tempStride[attribute.buffer]),attribute.start===void 0&&(attribute.start=tempStart[attribute.buffer],tempStart[attribute.buffer]+=attribSize*byteSizeMap$12[attribute.type])}vao=gl.createVertexArray(),gl.bindVertexArray(vao);for(var i=0;i<buffers.length;i++){var buffer=buffers[i];buffer._glBuffers[CONTEXT_UID]||(buffer._glBuffers[CONTEXT_UID]=new GLBuffer2(gl.createBuffer()),this.managedBuffers[buffer.id]=buffer,buffer.disposeRunner.add(this)),incRefCount&&buffer._glBuffers[CONTEXT_UID].refCount++}return this.activateVao(geometry,program),this._activeVao=vao,vaoObjectHash[program.id]=vao,vaoObjectHash[signature]=vao,vao},GeometrySystem3.prototype.disposeBuffer=function(buffer,contextLost){if(!!this.managedBuffers[buffer.id]){delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID],gl=this.gl;buffer.disposeRunner.remove(this),!!glBuffer&&(contextLost||gl.deleteBuffer(glBuffer.buffer),delete buffer._glBuffers[this.CONTEXT_UID])}},GeometrySystem3.prototype.disposeGeometry=function(geometry,contextLost){if(!!this.managedGeometries[geometry.id]){delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],gl=this.gl,buffers=geometry.buffers;if(geometry.disposeRunner.remove(this),!!vaos){for(var i=0;i<buffers.length;i++){var buf=buffers[i]._glBuffers[this.CONTEXT_UID];buf.refCount--,buf.refCount===0&&!contextLost&&this.disposeBuffer(buffers[i],contextLost)}if(!contextLost){for(var vaoId in vaos)if(vaoId[0]==="g"){var vao=vaos[vaoId];this._activeVao===vao&&this.unbind(),gl.deleteVertexArray(vao)}}delete geometry.glVertexArrayObjects[this.CONTEXT_UID]}}},GeometrySystem3.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedGeometries),i=0;i<all.length;i++)this.disposeGeometry(this.managedGeometries[all[i]],contextLost);all=Object.keys(this.managedBuffers);for(var i=0;i<all.length;i++)this.disposeBuffer(this.managedBuffers[all[i]],contextLost)},GeometrySystem3.prototype.activateVao=function(geometry,program){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,buffers=geometry.buffers,attributes=geometry.attributes;geometry.indexBuffer&&gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,geometry.indexBuffer._glBuffers[CONTEXT_UID].buffer);var lastBuffer=null;for(var j in attributes){var attribute=attributes[j],buffer=buffers[attribute.buffer],glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j]){lastBuffer!==glBuffer&&(gl.bindBuffer(gl.ARRAY_BUFFER,glBuffer.buffer),lastBuffer=glBuffer);var location2=program.attributeData[j].location;if(gl.enableVertexAttribArray(location2),gl.vertexAttribPointer(location2,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start),attribute.instance)if(this.hasInstance)gl.vertexAttribDivisor(location2,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},GeometrySystem3.prototype.draw=function(type,size,start2,instanceCount){var gl=this.gl,geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT,glType=byteSize===2?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;byteSize===2||byteSize===4&&this.canUseUInt32ElementIndex?geometry.instanced?gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start2||0)*byteSize,instanceCount||1):gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start2||0)*byteSize):console.warn("unsupported index buffer type: uint32")}else geometry.instanced?gl.drawArraysInstanced(type,start2,size||geometry.getSize(),instanceCount||1):gl.drawArrays(type,start2,size||geometry.getSize());return this},GeometrySystem3.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},GeometrySystem3}(System2),MaskData2=function(){function MaskData3(maskObject){maskObject===void 0&&(maskObject=null),this.type=MASK_TYPES2.NONE,this.autoDetect=!0,this.maskObject=maskObject||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return MaskData3.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES2.NONE,this.autoDetect=!0),this._target=null},MaskData3.prototype.copyCountersOrReset=function(maskAbove){maskAbove?(this._stencilCounter=maskAbove._stencilCounter,this._scissorCounter=maskAbove._scissorCounter,this._scissorRect=maskAbove._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},MaskData3}();function compileShader2(gl,type,src){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function compileProgram2(gl,vertexSrc,fragmentSrc,attributeLocations){var glVertShader=compileShader2(gl,gl.VERTEX_SHADER,vertexSrc),glFragShader=compileShader2(gl,gl.FRAGMENT_SHADER,fragmentSrc),program=gl.createProgram();if(gl.attachShader(program,glVertShader),gl.attachShader(program,glFragShader),attributeLocations)for(var i in attributeLocations)gl.bindAttribLocation(program,attributeLocations[i],i);return gl.linkProgram(program),gl.getProgramParameter(program,gl.LINK_STATUS)||(gl.getShaderParameter(glVertShader,gl.COMPILE_STATUS)||(console.warn(vertexSrc),console.error(gl.getShaderInfoLog(glVertShader))),gl.getShaderParameter(glFragShader,gl.COMPILE_STATUS)||(console.warn(fragmentSrc),console.error(gl.getShaderInfoLog(glFragShader))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS)),console.error("gl.getError()",gl.getError()),gl.getProgramInfoLog(program)!==""&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)),gl.deleteProgram(program),program=null),gl.deleteShader(glVertShader),gl.deleteShader(glFragShader),program}function booleanArray2(size){for(var array=new Array(size),i=0;i<array.length;i++)array[i]=!1;return array}function defaultValue2(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"uvec2":return new Uint32Array(2*size);case"uvec3":return new Uint32Array(3*size);case"uvec4":return new Uint32Array(4*size);case"bool":return!1;case"bvec2":return booleanArray2(2*size);case"bvec3":return booleanArray2(3*size);case"bvec4":return booleanArray2(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var unknownContext2={},context2=unknownContext2;function getTestContext2(){if(context2===unknownContext2||context2&&context2.isContextLost()){var canvas2=document.createElement("canvas"),gl=void 0;settings.PREFER_ENV>=ENV2.WEBGL2&&(gl=canvas2.getContext("webgl2",{})),gl||(gl=canvas2.getContext("webgl",{})||canvas2.getContext("experimental-webgl",{}),gl?gl.getExtension("WEBGL_draw_buffers"):gl=null),context2=gl}return context2}var maxFragmentPrecision2;function getMaxFragmentPrecision2(){if(!maxFragmentPrecision2){maxFragmentPrecision2=PRECISION2.MEDIUM;var gl=getTestContext2();if(gl&&gl.getShaderPrecisionFormat){var shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);maxFragmentPrecision2=shaderFragment.precision?PRECISION2.HIGH:PRECISION2.MEDIUM}}return maxFragmentPrecision2}function setPrecision2(src,requestedPrecision,maxSupportedPrecision){if(src.substring(0,9)!=="precision"){var precision=requestedPrecision;return requestedPrecision===PRECISION2.HIGH&&maxSupportedPrecision!==PRECISION2.HIGH&&(precision=PRECISION2.MEDIUM),"precision "+precision+` float;
`+src}else if(maxSupportedPrecision!==PRECISION2.HIGH&&src.substring(0,15)==="precision highp")return src.replace("precision highp","precision mediump");return src}var GLSL_TO_SIZE2={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize2(type){return GLSL_TO_SIZE2[type]}var GL_TABLE2=null,GL_TO_GLSL_TYPES2={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType2(gl,type){if(!GL_TABLE2){var typeNames=Object.keys(GL_TO_GLSL_TYPES2);GL_TABLE2={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE2[gl[tn]]=GL_TO_GLSL_TYPES2[tn]}}return GL_TABLE2[type]}var uniformParsers2=[{test:function(data){return data.type==="float"&&data.size===1},code:function(name){return`
            if(uv["`+name+'"] !== ud["'+name+`"].value)
            {
                ud["`+name+'"].value = uv["'+name+`"]
                gl.uniform1f(ud["`+name+'"].location, uv["'+name+`"])
            }
            `}},{test:function(data){return(data.type==="sampler2D"||data.type==="samplerCube"||data.type==="sampler2DArray")&&data.size===1&&!data.isArray},code:function(name){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+name+`"], t);

            if(ud["`+name+`"].value !== t)
            {
                ud["`+name+`"].value = t;
                gl.uniform1i(ud["`+name+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(data,uniform){return data.type==="mat3"&&data.size===1&&uniform.a!==void 0},code:function(name){return`
            gl.uniformMatrix3fv(ud["`+name+'"].location, false, uv["'+name+`"].toArray(true));
            `}},{test:function(data,uniform){return data.type==="vec2"&&data.size===1&&uniform.x!==void 0},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+name+`"].location, v.x, v.y);
                }`}},{test:function(data){return data.type==="vec2"&&data.size===1},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+name+`"].location, v[0], v[1]);
                }
            `}},{test:function(data,uniform){return data.type==="vec4"&&data.size===1&&uniform.width!==void 0},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+name+`"].location, v.x, v.y, v.width, v.height)
                }`}},{test:function(data){return data.type==="vec4"&&data.size===1},code:function(name){return`
                cv = ud["`+name+`"].value;
                v = uv["`+name+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+name+`"].location, v[0], v[1], v[2], v[3])
                }`}}],GLSL_TO_SINGLE_SETTERS_CACHED2={float:`
    if(cv !== v)
    {
        cv.v = v;
        gl.uniform1f(location, v)
    }`,vec2:`
    if(cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},GLSL_TO_ARRAY_SETTERS2={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync2(group,uniformData){var funcFragments=[`
        var v = null;
        var cv = null
        var t = 0;
        var gl = renderer.gl
    `];for(var i in group.uniforms){var data=uniformData[i];if(!data){group.uniforms[i].group&&funcFragments.push(`
                    renderer.shader.syncUniformGroup(uv["`+i+`"], syncData);
                `);continue}for(var uniform=group.uniforms[i],parsed=!1,j=0;j<uniformParsers2.length;j++)if(uniformParsers2[j].test(data,uniform)){funcFragments.push(uniformParsers2[j].code(i,uniform)),parsed=!0;break}if(!parsed){var templateType=data.size===1?GLSL_TO_SINGLE_SETTERS_CACHED2:GLSL_TO_ARRAY_SETTERS2,template=templateType[data.type].replace("location",'ud["'+i+'"].location');funcFragments.push(`
            cv = ud["`+i+`"].value;
            v = uv["`+i+`"];
            `+template+";")}}return new Function("ud","uv","renderer","syncData",funcFragments.join(`
`))}var fragTemplate3=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc2(maxIfs){for(var src="",i=0;i<maxIfs;++i)i>0&&(src+=`
else `),i<maxIfs-1&&(src+="if(test == "+i+".0){}");return src}function checkMaxIfStatementsInShader2(maxIfs,gl){if(maxIfs===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var shader=gl.createShader(gl.FRAGMENT_SHADER);;){var fragmentSrc=fragTemplate3.replace(/%forloop%/gi,generateIfTestSrc2(maxIfs));if(gl.shaderSource(shader,fragmentSrc),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS))maxIfs=maxIfs/2|0;else break}return maxIfs}var unsafeEval2;function unsafeEvalSupported2(){if(typeof unsafeEval2=="boolean")return unsafeEval2;try{var func=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval2=func({a:"b"},"a","b")===!0}catch(e){unsafeEval2=!1}return unsafeEval2}var defaultFragment2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,UID$32=0,nameCache2={},Program2=function(){function Program3(vertexSrc,fragmentSrc,name){name===void 0&&(name="pixi-shader"),this.id=UID$32++,this.vertexSrc=vertexSrc||Program3.defaultVertexSrc,this.fragmentSrc=fragmentSrc||Program3.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(name=name.replace(/\s+/g,"-"),nameCache2[name]?(nameCache2[name]++,name+="-"+nameCache2[name]):nameCache2[name]=1,this.vertexSrc="#define SHADER_NAME "+name+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+name+`
`+this.fragmentSrc,this.vertexSrc=setPrecision2(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION2.HIGH),this.fragmentSrc=setPrecision2(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision2())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return Program3.prototype.extractData=function(vertexSrc,fragmentSrc){var gl=getTestContext2();if(gl){var program=compileProgram2(gl,vertexSrc,fragmentSrc);this.attributeData=this.getAttributeData(program,gl),this.uniformData=this.getUniformData(program,gl),gl.deleteProgram(program)}else this.uniformData={},this.attributeData={}},Program3.prototype.getAttributeData=function(program,gl){for(var attributes={},attributesArray=[],totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i),type=mapType2(gl,attribData.type),data={type,name:attribData.name,size:mapSize2(type),location:0};attributes[attribData.name]=data,attributesArray.push(data)}attributesArray.sort(function(a,b){return a.name>b.name?1:-1});for(var i=0;i<attributesArray.length;i++)attributesArray[i].location=i;return attributes},Program3.prototype.getUniformData=function(program,gl){for(var uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i),name=uniformData.name.replace(/\[.*?\]$/,""),isArray3=uniformData.name.match(/\[.*?\]$/),type=mapType2(gl,uniformData.type);uniforms[name]={type,size:uniformData.size,isArray:isArray3,value:defaultValue2(type,uniformData.size)}}return uniforms},Object.defineProperty(Program3,"defaultVertexSrc",{get:function(){return defaultVertex2},enumerable:!1,configurable:!0}),Object.defineProperty(Program3,"defaultFragmentSrc",{get:function(){return defaultFragment2},enumerable:!1,configurable:!0}),Program3.from=function(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc,program=ProgramCache2[key];return program||(ProgramCache2[key]=program=new Program3(vertexSrc,fragmentSrc,name)),program},Program3}(),Shader2=function(){function Shader3(program,uniforms){this.program=program,uniforms?uniforms instanceof UniformGroup2?this.uniformGroup=uniforms:this.uniformGroup=new UniformGroup2(uniforms):this.uniformGroup=new UniformGroup2({});for(var i in program.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))}return Shader3.prototype.checkUniformExists=function(name,group){if(group.uniforms[name])return!0;for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group&&this.checkUniformExists(name,uniform))return!0}return!1},Shader3.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(Shader3.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),Shader3.from=function(vertexSrc,fragmentSrc,uniforms){var program=Program2.from(vertexSrc,fragmentSrc);return new Shader3(program,uniforms)},Shader3}(),BLEND2=0,OFFSET2=1,CULLING2=2,DEPTH_TEST2=3,WINDING2=4,DEPTH_MASK2=5,State2=function(){function State3(){this.data=0,this.blendMode=BLEND_MODES2.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(State3.prototype,"blend",{get:function(){return!!(this.data&1<<BLEND2)},set:function(value){!!(this.data&1<<BLEND2)!==value&&(this.data^=1<<BLEND2)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"offsets",{get:function(){return!!(this.data&1<<OFFSET2)},set:function(value){!!(this.data&1<<OFFSET2)!==value&&(this.data^=1<<OFFSET2)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"culling",{get:function(){return!!(this.data&1<<CULLING2)},set:function(value){!!(this.data&1<<CULLING2)!==value&&(this.data^=1<<CULLING2)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"depthTest",{get:function(){return!!(this.data&1<<DEPTH_TEST2)},set:function(value){!!(this.data&1<<DEPTH_TEST2)!==value&&(this.data^=1<<DEPTH_TEST2)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"depthMask",{get:function(){return!!(this.data&1<<DEPTH_MASK2)},set:function(value){!!(this.data&1<<DEPTH_MASK2)!==value&&(this.data^=1<<DEPTH_MASK2)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<WINDING2)},set:function(value){!!(this.data&1<<WINDING2)!==value&&(this.data^=1<<WINDING2)},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"blendMode",{get:function(){return this._blendMode},set:function(value){this.blend=value!==BLEND_MODES2.NONE,this._blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(State3.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(value){this.offsets=!!value,this._polygonOffset=value},enumerable:!1,configurable:!0}),State3.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},State3.for2d=function(){var state=new State3;return state.depthTest=!1,state.blend=!0,state},State3}(),defaultVertex$12=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,defaultFragment$12=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Filter2=function(_super){__extends23(Filter4,_super);function Filter4(vertexSrc,fragmentSrc,uniforms){var _this=this,program=Program2.from(vertexSrc||Filter4.defaultVertexSrc,fragmentSrc||Filter4.defaultFragmentSrc);return _this=_super.call(this,program,uniforms)||this,_this.padding=0,_this.resolution=settings.FILTER_RESOLUTION,_this.enabled=!0,_this.autoFit=!0,_this.legacy=!!_this.program.attributeData.aTextureCoord,_this.state=new State2,_this}return Filter4.prototype.apply=function(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode)},Object.defineProperty(Filter4.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Filter4,"defaultVertexSrc",{get:function(){return defaultVertex$12},enumerable:!1,configurable:!0}),Object.defineProperty(Filter4,"defaultFragmentSrc",{get:function(){return defaultFragment$12},enumerable:!1,configurable:!0}),Filter4}(Shader2),vertex7=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,fragment10=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,tempMat3=new Matrix2,TextureMatrix2=function(){function TextureMatrix3(texture,clampMargin){this._texture=texture,this.mapCoord=new Matrix2,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof clampMargin=="undefined"?.5:clampMargin,this.isSimple=!1}return Object.defineProperty(TextureMatrix3.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture=value,this._textureID=-1},enumerable:!1,configurable:!0}),TextureMatrix3.prototype.multiplyUvs=function(uvs,out){out===void 0&&(out=uvs);for(var mat=this.mapCoord,i=0;i<uvs.length;i+=2){var x=uvs[i],y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx,out[i+1]=x*mat.b+y*mat.d+mat.ty}return out},TextureMatrix3.prototype.update=function(forceUpdate){var tex=this._texture;if(!tex||!tex.valid||!forceUpdate&&this._textureID===tex._updateID)return!1;this._textureID=tex._updateID,this._updateID++;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig,trim=tex.trim;trim&&(tempMat3.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(tempMat3));var texBase=tex.baseTexture,frame=this.uClampFrame,margin=this.clampMargin/texBase.resolution,offset=this.clampOffset;return frame[0]=(tex._frame.x+margin+offset)/texBase.width,frame[1]=(tex._frame.y+margin+offset)/texBase.height,frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width,frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height,this.uClampOffset[0]=offset/texBase.realWidth,this.uClampOffset[1]=offset/texBase.realHeight,this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&tex.rotate===0,!0},TextureMatrix3}(),SpriteMaskFilter2=function(_super){__extends23(SpriteMaskFilter3,_super);function SpriteMaskFilter3(sprite){var _this=this,maskMatrix=new Matrix2;return _this=_super.call(this,vertex7,fragment10)||this,sprite.renderable=!1,_this.maskSprite=sprite,_this.maskMatrix=maskMatrix,_this}return SpriteMaskFilter3.prototype.apply=function(filterManager,input,output,clearMode){var maskSprite=this.maskSprite,tex=maskSprite._texture;!tex.valid||(tex.uvMatrix||(tex.uvMatrix=new TextureMatrix2(tex,0)),tex.uvMatrix.update(),this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1,this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.uvMatrix.uClampFrame,filterManager.applyFilter(this,input,output,clearMode))},SpriteMaskFilter3}(Filter2),MaskSystem2=function(_super){__extends23(MaskSystem3,_super);function MaskSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.enableScissor=!0,_this.alphaMaskPool=[],_this.maskDataPool=[],_this.maskStack=[],_this.alphaMaskIndex=0,_this}return MaskSystem3.prototype.setMaskStack=function(maskStack){this.maskStack=maskStack,this.renderer.scissor.setMaskStack(maskStack),this.renderer.stencil.setMaskStack(maskStack)},MaskSystem3.prototype.push=function(target,maskDataOrTarget){var maskData=maskDataOrTarget;if(!maskData.isMaskData){var d=this.maskDataPool.pop()||new MaskData2;d.pooled=!0,d.maskObject=maskDataOrTarget,maskData=d}switch(maskData.autoDetect&&this.detect(maskData),maskData.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),maskData._target=target,maskData.type){case MASK_TYPES2.SCISSOR:this.maskStack.push(maskData),this.renderer.scissor.push(maskData);break;case MASK_TYPES2.STENCIL:this.maskStack.push(maskData),this.renderer.stencil.push(maskData);break;case MASK_TYPES2.SPRITE:maskData.copyCountersOrReset(null),this.pushSpriteMask(maskData),this.maskStack.push(maskData);break}},MaskSystem3.prototype.pop=function(target){var maskData=this.maskStack.pop();if(!(!maskData||maskData._target!==target)){switch(maskData.type){case MASK_TYPES2.SCISSOR:this.renderer.scissor.pop();break;case MASK_TYPES2.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case MASK_TYPES2.SPRITE:this.popSpriteMask();break}maskData.reset(),maskData.pooled&&this.maskDataPool.push(maskData)}},MaskSystem3.prototype.detect=function(maskData){var maskObject=maskData.maskObject;if(maskObject.isSprite){maskData.type=MASK_TYPES2.SPRITE;return}if(maskData.type=MASK_TYPES2.STENCIL,this.enableScissor&&maskObject.isFastRect&&maskObject.isFastRect()){var matrix=maskObject.worldTransform,rotX=Math.atan2(matrix.b,matrix.a),rotXY=Math.atan2(matrix.d,matrix.c);rotX=Math.round(rotX*(180/Math.PI)*100),rotXY=Math.round(rotXY*(180/Math.PI)*100)-rotX,rotX=(rotX%9e3+9e3)%9e3,rotXY=(rotXY%18e3+18e3)%18e3,rotX===0&&rotXY===9e3&&(maskData.type=MASK_TYPES2.SCISSOR)}},MaskSystem3.prototype.pushSpriteMask=function(maskData){var maskObject=maskData.maskObject,target=maskData._target,alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter2(maskObject)]),alphaMaskFilter[0].resolution=this.renderer.resolution,alphaMaskFilter[0].maskSprite=maskObject;var stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(!0),this.renderer.filter.push(target,alphaMaskFilter),target.filterArea=stashFilterArea,this.alphaMaskIndex++},MaskSystem3.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},MaskSystem3}(System2),AbstractMaskSystem2=function(_super){__extends23(AbstractMaskSystem3,_super);function AbstractMaskSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.maskStack=[],_this.glConst=0,_this}return AbstractMaskSystem3.prototype.getStackLength=function(){return this.maskStack.length},AbstractMaskSystem3.prototype.setMaskStack=function(maskStack){var gl=this.renderer.gl,curStackLen=this.getStackLength();this.maskStack=maskStack;var newStackLen=this.getStackLength();newStackLen!==curStackLen&&(newStackLen===0?gl.disable(this.glConst):(gl.enable(this.glConst),this._useCurrent()))},AbstractMaskSystem3.prototype._useCurrent=function(){},AbstractMaskSystem3.prototype.destroy=function(){_super.prototype.destroy.call(this),this.maskStack=null},AbstractMaskSystem3}(System2),ScissorSystem2=function(_super){__extends23(ScissorSystem3,_super);function ScissorSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.SCISSOR_TEST,_this}return ScissorSystem3.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._scissorCounter:0},ScissorSystem3.prototype.push=function(maskData){var maskObject=maskData.maskObject;maskObject.renderable=!0;var prevData=maskData._scissorRect,bounds=maskObject.getBounds(!0),gl=this.renderer.gl;maskObject.renderable=!1,prevData?bounds.fit(prevData):gl.enable(gl.SCISSOR_TEST),maskData._scissorCounter++,maskData._scissorRect=bounds,this._useCurrent()},ScissorSystem3.prototype.pop=function(){var gl=this.renderer.gl;this.getStackLength()>0?this._useCurrent():gl.disable(gl.SCISSOR_TEST)},ScissorSystem3.prototype._useCurrent=function(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect,rt=this.renderer.renderTexture.current,_a3=this.renderer.projection,transform=_a3.transform,sourceFrame=_a3.sourceFrame,destinationFrame=_a3.destinationFrame,resolution=rt?rt.resolution:this.renderer.resolution,sx=destinationFrame.width/sourceFrame.width,sy=destinationFrame.height/sourceFrame.height,x=((rect.x-sourceFrame.x)*sx+destinationFrame.x)*resolution,y=((rect.y-sourceFrame.y)*sy+destinationFrame.y)*resolution,width=rect.width*sx*resolution,height=rect.height*sy*resolution;transform&&(x+=transform.tx*resolution,y+=transform.ty*resolution),rt||(y=this.renderer.height-height-y),this.renderer.gl.scissor(x,y,width,height)},ScissorSystem3}(AbstractMaskSystem2),StencilSystem2=function(_super){__extends23(StencilSystem3,_super);function StencilSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.STENCIL_TEST,_this}return StencilSystem3.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._stencilCounter:0},StencilSystem3.prototype.push=function(maskData){var maskObject=maskData.maskObject,gl=this.renderer.gl,prevMaskCount=maskData._stencilCounter;prevMaskCount===0&&(this.renderer.framebuffer.forceStencil(),gl.enable(gl.STENCIL_TEST)),maskData._stencilCounter++,gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),this.renderer.framebuffer.blit(),maskObject.renderable=!1,this._useCurrent()},StencilSystem3.prototype.pop=function(maskObject){var gl=this.renderer.gl;this.getStackLength()===0?(gl.disable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.clearStencil(0)):(gl.colorMask(!1,!1,!1,!1),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,this._useCurrent())},StencilSystem3.prototype._useCurrent=function(){var gl=this.renderer.gl;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.getStackLength(),this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},StencilSystem3.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},StencilSystem3}(AbstractMaskSystem2),ProjectionSystem2=function(_super){__extends23(ProjectionSystem3,_super);function ProjectionSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.destinationFrame=null,_this.sourceFrame=null,_this.defaultFrame=null,_this.projectionMatrix=new Matrix2,_this.transform=null,_this}return ProjectionSystem3.prototype.update=function(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame,this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame,this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root),this.transform&&this.projectionMatrix.append(this.transform);var renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,renderer.globalUniforms.update(),renderer.shader.shader&&renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals)},ProjectionSystem3.prototype.calculateProjection=function(_destinationFrame,sourceFrame,_resolution,root){var pm=this.projectionMatrix,sign2=root?-1:1;pm.identity(),pm.a=1/sourceFrame.width*2,pm.d=sign2*(1/sourceFrame.height*2),pm.tx=-1-sourceFrame.x*pm.a,pm.ty=-sign2-sourceFrame.y*pm.d},ProjectionSystem3.prototype.setTransform=function(_matrix){},ProjectionSystem3}(System2),tempRect3=new Rectangle2,tempRect22=new Rectangle2,RenderTextureSystem2=function(_super){__extends23(RenderTextureSystem3,_super);function RenderTextureSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.clearColor=renderer._backgroundColorRgba,_this.defaultMaskStack=[],_this.current=null,_this.sourceFrame=new Rectangle2,_this.destinationFrame=new Rectangle2,_this.viewportFrame=new Rectangle2,_this}return RenderTextureSystem3.prototype.bind=function(renderTexture,sourceFrame,destinationFrame){renderTexture===void 0&&(renderTexture=null);var renderer=this.renderer;this.current=renderTexture;var baseTexture,framebuffer,resolution;renderTexture?(baseTexture=renderTexture.baseTexture,resolution=baseTexture.resolution,sourceFrame||(tempRect3.width=renderTexture.frame.width,tempRect3.height=renderTexture.frame.height,sourceFrame=tempRect3),destinationFrame||(tempRect22.x=renderTexture.frame.x,tempRect22.y=renderTexture.frame.y,tempRect22.width=sourceFrame.width,tempRect22.height=sourceFrame.height,destinationFrame=tempRect22),framebuffer=baseTexture.framebuffer):(resolution=renderer.resolution,sourceFrame||(tempRect3.width=renderer.screen.width,tempRect3.height=renderer.screen.height,sourceFrame=tempRect3),destinationFrame||(destinationFrame=tempRect3,destinationFrame.width=sourceFrame.width,destinationFrame.height=sourceFrame.height));var viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution,viewportFrame.y=destinationFrame.y*resolution,viewportFrame.width=destinationFrame.width*resolution,viewportFrame.height=destinationFrame.height*resolution,renderTexture||(viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height)),this.renderer.framebuffer.bind(framebuffer,viewportFrame),this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer),renderTexture?this.renderer.mask.setMaskStack(baseTexture.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(sourceFrame),this.destinationFrame.copyFrom(destinationFrame)},RenderTextureSystem3.prototype.clear=function(clearColor,mask){this.current?clearColor=clearColor||this.current.baseTexture.clearColor:clearColor=clearColor||this.clearColor;var destinationFrame=this.destinationFrame,baseFrame=this.current?this.current.baseTexture:this.renderer.screen,clearMask=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height;if(clearMask){var _a3=this.viewportFrame,x=_a3.x,y=_a3.y,width=_a3.width,height=_a3.height;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(x,y,width,height)}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3],mask),clearMask&&this.renderer.scissor.pop()},RenderTextureSystem3.prototype.resize=function(){this.bind(null)},RenderTextureSystem3.prototype.reset=function(){this.bind(null)},RenderTextureSystem3}(System2),GLProgram2=function(){function GLProgram3(program,uniformData){this.program=program,this.uniformData=uniformData,this.uniformGroups={}}return GLProgram3.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},GLProgram3}(),UID$42=0,defaultSyncData2={textureCount:0},ShaderSystem2=function(_super){__extends23(ShaderSystem3,_super);function ShaderSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.destroyed=!1,_this.systemCheck(),_this.gl=null,_this.shader=null,_this.program=null,_this.cache={},_this.id=UID$42++,_this}return ShaderSystem3.prototype.systemCheck=function(){if(!unsafeEvalSupported2())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},ShaderSystem3.prototype.contextChange=function(gl){this.gl=gl,this.reset()},ShaderSystem3.prototype.bind=function(shader,dontSync){shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program,glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(shader);return this.shader=shader,this.program!==program&&(this.program=program,this.gl.useProgram(glProgram.program)),dontSync||(defaultSyncData2.textureCount=0,this.syncUniformGroup(shader.uniformGroup,defaultSyncData2)),glProgram},ShaderSystem3.prototype.setUniforms=function(uniforms){var shader=this.shader.program,glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer)},ShaderSystem3.prototype.syncUniformGroup=function(group,syncData){var glProgram=this.getglProgram();(!group.static||group.dirtyId!==glProgram.uniformGroups[group.id])&&(glProgram.uniformGroups[group.id]=group.dirtyId,this.syncUniforms(group,glProgram,syncData))},ShaderSystem3.prototype.syncUniforms=function(group,glProgram,syncData){var syncFunc=group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group);syncFunc(glProgram.uniformData,group.uniforms,this.renderer,syncData)},ShaderSystem3.prototype.createSyncGroups=function(group){var id=this.getSignature(group,this.shader.program.uniformData);return this.cache[id]||(this.cache[id]=generateUniformsSync2(group,this.shader.program.uniformData)),group.syncUniforms[this.shader.program.id]=this.cache[id],group.syncUniforms[this.shader.program.id]},ShaderSystem3.prototype.getSignature=function(group,uniformData){var uniforms=group.uniforms,strings=[];for(var i in uniforms)strings.push(i),uniformData[i]&&strings.push(uniformData[i].type);return strings.join("-")},ShaderSystem3.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},ShaderSystem3.prototype.generateShader=function(shader){var gl=this.gl,program=shader.program,attribMap={};for(var i in program.attributeData)attribMap[i]=program.attributeData[i].location;var shaderProgram=compileProgram2(gl,program.vertexSrc,program.fragmentSrc,attribMap),uniformData={};for(var i in program.uniformData){var data=program.uniformData[i];uniformData[i]={location:gl.getUniformLocation(shaderProgram,i),value:defaultValue2(data.type,data.size)}}var glProgram=new GLProgram2(shaderProgram,uniformData);return program.glPrograms[this.renderer.CONTEXT_UID]=glProgram,glProgram},ShaderSystem3.prototype.reset=function(){this.program=null,this.shader=null},ShaderSystem3.prototype.destroy=function(){this.destroyed=!0},ShaderSystem3}(System2);function mapWebGLBlendModesToPixi2(gl,array){return array===void 0&&(array=[]),array[BLEND_MODES2.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.ADD]=[gl.ONE,gl.ONE],array[BLEND_MODES2.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.NONE]=[0,0],array[BLEND_MODES2.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE],array[BLEND_MODES2.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SRC_IN]=[gl.DST_ALPHA,gl.ZERO],array[BLEND_MODES2.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO],array[BLEND_MODES2.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE],array[BLEND_MODES2.DST_IN]=[gl.ZERO,gl.SRC_ALPHA],array[BLEND_MODES2.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA],array[BLEND_MODES2.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES2.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD],array}var BLEND$12=0,OFFSET$12=1,CULLING$12=2,DEPTH_TEST$12=3,WINDING$12=4,DEPTH_MASK$12=5,StateSystem2=function(_super){__extends23(StateSystem3,_super);function StateSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.gl=null,_this.stateId=0,_this.polygonOffset=0,_this.blendMode=BLEND_MODES2.NONE,_this._blendEq=!1,_this.map=[],_this.map[BLEND$12]=_this.setBlend,_this.map[OFFSET$12]=_this.setOffset,_this.map[CULLING$12]=_this.setCullFace,_this.map[DEPTH_TEST$12]=_this.setDepthTest,_this.map[WINDING$12]=_this.setFrontFace,_this.map[DEPTH_MASK$12]=_this.setDepthMask,_this.checks=[],_this.defaultState=new State2,_this.defaultState.blend=!0,_this}return StateSystem3.prototype.contextChange=function(gl){this.gl=gl,this.blendModes=mapWebGLBlendModesToPixi2(gl),this.set(this.defaultState),this.reset()},StateSystem3.prototype.set=function(state){if(state=state||this.defaultState,this.stateId!==state.data){for(var diff=this.stateId^state.data,i=0;diff;)diff&1&&this.map[i].call(this,!!(state.data&1<<i)),diff=diff>>1,i++;this.stateId=state.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,state)},StateSystem3.prototype.forceState=function(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(state.data&1<<i));for(var i=0;i<this.checks.length;i++)this.checks[i](this,state);this.stateId=state.data},StateSystem3.prototype.setBlend=function(value){this.updateCheck(StateSystem3.checkBlendMode,value),this.gl[value?"enable":"disable"](this.gl.BLEND)},StateSystem3.prototype.setOffset=function(value){this.updateCheck(StateSystem3.checkPolygonOffset,value),this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},StateSystem3.prototype.setDepthTest=function(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)},StateSystem3.prototype.setDepthMask=function(value){this.gl.depthMask(value)},StateSystem3.prototype.setCullFace=function(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)},StateSystem3.prototype.setFrontFace=function(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])},StateSystem3.prototype.setBlendMode=function(value){if(value!==this.blendMode){this.blendMode=value;var mode=this.blendModes[value],gl=this.gl;mode.length===2?gl.blendFunc(mode[0],mode[1]):gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3]),mode.length===6?(this._blendEq=!0,gl.blendEquationSeparate(mode[4],mode[5])):this._blendEq&&(this._blendEq=!1,gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD))}},StateSystem3.prototype.setPolygonOffset=function(value,scale){this.gl.polygonOffset(value,scale)},StateSystem3.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},StateSystem3.prototype.updateCheck=function(func,value){var index3=this.checks.indexOf(func);value&&index3===-1?this.checks.push(func):!value&&index3!==-1&&this.checks.splice(index3,1)},StateSystem3.checkBlendMode=function(system,state){system.setBlendMode(state.blendMode)},StateSystem3.checkPolygonOffset=function(system,state){system.setPolygonOffset(1,state.polygonOffset)},StateSystem3}(System2),TextureGCSystem2=function(_super){__extends23(TextureGCSystem3,_super);function TextureGCSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.count=0,_this.checkCount=0,_this.maxIdle=settings.GC_MAX_IDLE,_this.checkCountMax=settings.GC_MAX_CHECK_COUNT,_this.mode=settings.GC_MODE,_this}return TextureGCSystem3.prototype.postrender=function(){!this.renderer.renderingToScreen||(this.count++,this.mode!==GC_MODES2.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},TextureGCSystem3.prototype.run=function(){for(var tm=this.renderer.texture,managedTextures=tm.managedTextures,wasRemoved=!1,i=0;i<managedTextures.length;i++){var texture=managedTextures[i];!texture.framebuffer&&this.count-texture.touched>this.maxIdle&&(tm.destroyTexture(texture,!0),managedTextures[i]=null,wasRemoved=!0)}if(wasRemoved){for(var j=0,i=0;i<managedTextures.length;i++)managedTextures[i]!==null&&(managedTextures[j++]=managedTextures[i]);managedTextures.length=j}},TextureGCSystem3.prototype.unload=function(displayObject){var tm=this.renderer.texture,texture=displayObject._texture;texture&&!texture.framebuffer&&tm.destroyTexture(texture);for(var i=displayObject.children.length-1;i>=0;i--)this.unload(displayObject.children[i])},TextureGCSystem3}(System2),GLTexture2=function(){function GLTexture3(texture){this.texture=texture,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121,this.samplerType=0}return GLTexture3}(),TextureSystem2=function(_super){__extends23(TextureSystem3,_super);function TextureSystem3(renderer){var _this=_super.call(this,renderer)||this;return _this.boundTextures=[],_this.currentLocation=-1,_this.managedTextures=[],_this._unknownBoundTextures=!1,_this.unknownTexture=new BaseTexture2,_this.hasIntegerTextures=!1,_this}return TextureSystem3.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(var i=0;i<maxTextures;i++)this.boundTextures[i]=null;this.emptyTextures={};var emptyTexture2D=new GLTexture2(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D,this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture2(gl.createTexture()),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(var i=0;i<this.boundTextures.length;i++)this.bind(null,i)},TextureSystem3.prototype.bind=function(texture,location2){location2===void 0&&(location2=0);var gl=this.gl;if(texture){if(texture=texture.castToBaseTexture(),texture.parentTextureArray)return;if(texture.valid){texture.touched=this.renderer.textureGC.count;var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);this.boundTextures[location2]!==texture&&(this.currentLocation!==location2&&(this.currentLocation=location2,gl.activeTexture(gl.TEXTURE0+location2)),gl.bindTexture(texture.target,glTexture.texture)),glTexture.dirtyId!==texture.dirtyId&&(this.currentLocation!==location2&&(this.currentLocation=location2,gl.activeTexture(gl.TEXTURE0+location2)),this.updateTexture(texture)),this.boundTextures[location2]=texture}}else this.currentLocation!==location2&&(this.currentLocation=location2,gl.activeTexture(gl.TEXTURE0+location2)),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture),this.boundTextures[location2]=null},TextureSystem3.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]=this.unknownTexture},TextureSystem3.prototype.unbind=function(texture){var _a3=this,gl=_a3.gl,boundTextures=_a3.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<boundTextures.length;i++)boundTextures[i]===this.unknownTexture&&this.bind(null,i)}for(var i=0;i<boundTextures.length;i++)boundTextures[i]===texture&&(this.currentLocation!==i&&(gl.activeTexture(gl.TEXTURE0+i),this.currentLocation=i),gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture),boundTextures[i]=null)},TextureSystem3.prototype.ensureSamplerType=function(maxTextures){var _a3=this,boundTextures=_a3.boundTextures,hasIntegerTextures=_a3.hasIntegerTextures,CONTEXT_UID=_a3.CONTEXT_UID;if(!!hasIntegerTextures)for(var i=maxTextures-1;i>=0;--i){var tex=boundTextures[i];if(tex){var glTexture=tex._glTextures[CONTEXT_UID];glTexture.samplerType!==SAMPLER_TYPES2.FLOAT&&this.renderer.texture.unbind(tex)}}},TextureSystem3.prototype.initTexture=function(texture){var glTexture=new GLTexture2(this.gl.createTexture());return glTexture.dirtyId=-1,texture._glTextures[this.CONTEXT_UID]=glTexture,this.managedTextures.push(texture),texture.on("dispose",this.destroyTexture,this),glTexture},TextureSystem3.prototype.initTextureType=function(texture,glTexture){if(glTexture.internalFormat=texture.format,glTexture.type=texture.type,this.webGLVersion===2){var gl=this.renderer.gl;texture.type===gl.FLOAT&&texture.format===gl.RGBA&&(glTexture.internalFormat=gl.RGBA32F),texture.type===TYPES2.HALF_FLOAT&&(glTexture.type=gl.HALF_FLOAT),glTexture.type===gl.HALF_FLOAT&&texture.format===gl.RGBA&&(glTexture.internalFormat=gl.RGBA16F)}},TextureSystem3.prototype.updateTexture=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(!!glTexture){var renderer=this.renderer;if(this.initTextureType(texture,glTexture),texture.resource&&texture.resource.upload(renderer,texture,glTexture))glTexture.samplerType!==SAMPLER_TYPES2.FLOAT&&(this.hasIntegerTextures=!0);else{var width=texture.realWidth,height=texture.realHeight,gl=renderer.gl;(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0)&&(glTexture.width=width,glTexture.height=height,gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null))}texture.dirtyStyleId!==glTexture.dirtyStyleId&&this.updateTextureStyle(texture),glTexture.dirtyId=texture.dirtyId}},TextureSystem3.prototype.destroyTexture=function(texture,skipRemove){var gl=this.gl;if(texture=texture.castToBaseTexture(),texture._glTextures[this.CONTEXT_UID]&&(this.unbind(texture),gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture),texture.off("dispose",this.destroyTexture,this),delete texture._glTextures[this.CONTEXT_UID],!skipRemove)){var i=this.managedTextures.indexOf(texture);i!==-1&&removeItems2(this.managedTextures,i,1)}},TextureSystem3.prototype.updateTextureStyle=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];!glTexture||((texture.mipmap===MIPMAP_MODES2.POW2||this.webGLVersion!==2)&&!texture.isPowerOfTwo?glTexture.mipmap=!1:glTexture.mipmap=texture.mipmap>=1,this.webGLVersion!==2&&!texture.isPowerOfTwo?glTexture.wrapMode=WRAP_MODES2.CLAMP:glTexture.wrapMode=texture.wrapMode,texture.resource&&texture.resource.style(this.renderer,texture,glTexture)||this.setStyle(texture,glTexture),glTexture.dirtyStyleId=texture.dirtyStyleId)},TextureSystem3.prototype.setStyle=function(texture,glTexture){var gl=this.gl;if(glTexture.mipmap&&texture.mipmap!==MIPMAP_MODES2.ON_MANUAL&&gl.generateMipmap(texture.target),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode),glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES2.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);var anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===SCALE_MODES2.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES2.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===SCALE_MODES2.LINEAR?gl.LINEAR:gl.NEAREST)},TextureSystem3}(System2),_systems2={__proto__:null,FilterSystem:FilterSystem2,BatchSystem:BatchSystem2,ContextSystem:ContextSystem2,FramebufferSystem:FramebufferSystem2,GeometrySystem:GeometrySystem2,MaskSystem:MaskSystem2,ScissorSystem:ScissorSystem2,StencilSystem:StencilSystem2,ProjectionSystem:ProjectionSystem2,RenderTextureSystem:RenderTextureSystem2,ShaderSystem:ShaderSystem2,StateSystem:StateSystem2,TextureGCSystem:TextureGCSystem2,TextureSystem:TextureSystem2},tempMatrix$12=new Matrix2,AbstractRenderer2=function(_super){__extends23(AbstractRenderer3,_super);function AbstractRenderer3(type,options){type===void 0&&(type=RENDERER_TYPE2.UNKNOWN);var _this=_super.call(this)||this;return options=Object.assign({},settings.RENDER_OPTIONS,options),_this.options=options,_this.type=type,_this.screen=new Rectangle2(0,0,options.width,options.height),_this.view=options.view||document.createElement("canvas"),_this.resolution=options.resolution||settings.RESOLUTION,_this.useContextAlpha=options.useContextAlpha,_this.autoDensity=!!options.autoDensity,_this.preserveDrawingBuffer=options.preserveDrawingBuffer,_this.clearBeforeRender=options.clearBeforeRender,_this._backgroundColor=0,_this._backgroundColorRgba=[0,0,0,1],_this._backgroundColorString="#000000",_this.backgroundColor=options.backgroundColor||_this._backgroundColor,_this.backgroundAlpha=options.backgroundAlpha,options.transparent!==void 0&&(deprecation2("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),_this.useContextAlpha=options.transparent,_this.backgroundAlpha=options.transparent?0:1),_this._lastObjectRendered=null,_this.plugins={},_this}return AbstractRenderer3.prototype.initPlugins=function(staticMap){for(var o in staticMap)this.plugins[o]=new staticMap[o](this)},Object.defineProperty(AbstractRenderer3.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer3.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),AbstractRenderer3.prototype.resize=function(screenWidth,screenHeight){this.screen.width=screenWidth,this.screen.height=screenHeight,this.view.width=screenWidth*this.resolution,this.view.height=screenHeight*this.resolution,this.autoDensity&&(this.view.style.width=screenWidth+"px",this.view.style.height=screenHeight+"px"),this.emit("resize",screenWidth,screenHeight)},AbstractRenderer3.prototype.generateTexture=function(displayObject,scaleMode,resolution,region){region=region||displayObject.getLocalBounds(null,!0),region.width===0&&(region.width=1),region.height===0&&(region.height=1);var renderTexture=RenderTexture2.create({width:region.width|0,height:region.height|0,scaleMode,resolution});return tempMatrix$12.tx=-region.x,tempMatrix$12.ty=-region.y,this.render(displayObject,{renderTexture,clear:!1,transform:tempMatrix$12,skipUpdateTransform:!!displayObject.parent}),renderTexture},AbstractRenderer3.prototype.destroy=function(removeView){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var thisAny=this;thisAny.plugins=null,thisAny.type=RENDERER_TYPE2.UNKNOWN,thisAny.view=null,thisAny.screen=null,thisAny._tempDisplayObjectParent=null,thisAny.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(AbstractRenderer3.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(value){this._backgroundColor=value,this._backgroundColorString=hex2string2(value),hex2rgb2(value,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer3.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(value){this._backgroundColorRgba[3]=value},enumerable:!1,configurable:!0}),AbstractRenderer3}(eventemitter3),Renderer2=function(_super){__extends23(Renderer3,_super);function Renderer3(options){var _this=_super.call(this,RENDERER_TYPE2.WEBGL,options)||this;return options=_this.options,_this.gl=null,_this.CONTEXT_UID=0,_this.runners={destroy:new Runner2("destroy"),contextChange:new Runner2("contextChange"),reset:new Runner2("reset"),update:new Runner2("update"),postrender:new Runner2("postrender"),prerender:new Runner2("prerender"),resize:new Runner2("resize")},_this.globalUniforms=new UniformGroup2({projectionMatrix:new Matrix2},!0),_this.addSystem(MaskSystem2,"mask").addSystem(ContextSystem2,"context").addSystem(StateSystem2,"state").addSystem(ShaderSystem2,"shader").addSystem(TextureSystem2,"texture").addSystem(GeometrySystem2,"geometry").addSystem(FramebufferSystem2,"framebuffer").addSystem(ScissorSystem2,"scissor").addSystem(StencilSystem2,"stencil").addSystem(ProjectionSystem2,"projection").addSystem(TextureGCSystem2,"textureGC").addSystem(FilterSystem2,"filter").addSystem(RenderTextureSystem2,"renderTexture").addSystem(BatchSystem2,"batch"),_this.initPlugins(Renderer3.__plugins),options.context?_this.context.initFromContext(options.context):_this.context.initFromOptions({alpha:!!_this.useContextAlpha,antialias:options.antialias,premultipliedAlpha:_this.useContextAlpha&&_this.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference}),_this.renderingToScreen=!0,sayHello2(_this.context.webGLVersion===2?"WebGL 2":"WebGL 1"),_this.resize(_this.options.width,_this.options.height),_this}return Renderer3.create=function(options){if(isWebGLSupported2())return new Renderer3(options);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Renderer3.prototype.addSystem=function(ClassRef,name){name||(name=ClassRef.name);var system=new ClassRef(this);if(this[name])throw new Error('Whoops! The name "'+name+'" is already in use');this[name]=system;for(var i in this.runners)this.runners[i].add(system);return this},Renderer3.prototype.render=function(displayObject,options){var renderTexture,clear,transform,skipUpdateTransform;if(options&&(options instanceof RenderTexture2?(deprecation2("6.0.0","Renderer#render arguments changed, use options instead."),renderTexture=options,clear=arguments[2],transform=arguments[3],skipUpdateTransform=arguments[4]):(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform)),this.renderingToScreen=!renderTexture,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=transform,!this.context.isLost){if(renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}this.renderTexture.bind(renderTexture),this.batch.currentRenderer.start(),(clear!==void 0?clear:this.clearBeforeRender)&&this.renderTexture.clear(),displayObject.render(this),this.batch.currentRenderer.flush(),renderTexture&&renderTexture.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},Renderer3.prototype.resize=function(screenWidth,screenHeight){_super.prototype.resize.call(this,screenWidth,screenHeight),this.runners.resize.emit(screenWidth,screenHeight)},Renderer3.prototype.reset=function(){return this.runners.reset.emit(),this},Renderer3.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},Renderer3.prototype.destroy=function(removeView){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();_super.prototype.destroy.call(this,removeView),this.gl=null},Object.defineProperty(Renderer3.prototype,"extract",{get:function(){return deprecation2("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),Renderer3.registerPlugin=function(pluginName,ctor){Renderer3.__plugins=Renderer3.__plugins||{},Renderer3.__plugins[pluginName]=ctor},Renderer3}(AbstractRenderer2),BatchDrawCall2=function(){function BatchDrawCall3(){this.texArray=null,this.blend=0,this.type=DRAW_MODES2.TRIANGLES,this.start=0,this.size=0,this.data=null}return BatchDrawCall3}(),BatchTextureArray2=function(){function BatchTextureArray3(){this.elements=[],this.ids=[],this.count=0}return BatchTextureArray3.prototype.clear=function(){for(var i=0;i<this.count;i++)this.elements[i]=null;this.count=0},BatchTextureArray3}(),ViewableBuffer2=function(){function ViewableBuffer3(sizeOrBuffer){typeof sizeOrBuffer=="number"?this.rawBinaryData=new ArrayBuffer(sizeOrBuffer):sizeOrBuffer instanceof Uint8Array?this.rawBinaryData=sizeOrBuffer.buffer:this.rawBinaryData=sizeOrBuffer,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(ViewableBuffer3.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer3.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),ViewableBuffer3.prototype.view=function(type){return this[type+"View"]},ViewableBuffer3.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},ViewableBuffer3.sizeOf=function(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(type+" isn't a valid view type")}},ViewableBuffer3}(),AbstractBatchRenderer2=function(_super){__extends23(AbstractBatchRenderer3,_super);function AbstractBatchRenderer3(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=null,_this.geometryClass=null,_this.vertexSize=null,_this.state=State2.for2d(),_this.size=settings.SPRITE_BATCH_SIZE*4,_this._vertexCount=0,_this._indexCount=0,_this._bufferedElements=[],_this._bufferedTextures=[],_this._bufferSize=0,_this._shader=null,_this._packedGeometries=[],_this._packedGeometryPoolSize=2,_this._flushId=0,_this._aBuffers={},_this._iBuffers={},_this.MAX_TEXTURES=1,_this.renderer.on("prerender",_this.onPrerender,_this),renderer.runners.contextChange.add(_this),_this._dcIndex=0,_this._aIndex=0,_this._iIndex=0,_this._attributeBuffer=null,_this._indexBuffer=null,_this._tempBoundTextures=[],_this}return AbstractBatchRenderer3.prototype.contextChange=function(){var gl=this.renderer.gl;settings.PREFER_ENV===ENV2.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader2(this.MAX_TEXTURES,gl)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},AbstractBatchRenderer3.prototype.initFlushBuffers=function(){for(var _drawCallPool=AbstractBatchRenderer3._drawCallPool,_textureArrayPool=AbstractBatchRenderer3._textureArrayPool,MAX_SPRITES=this.size/4,MAX_TA=Math.floor(MAX_SPRITES/this.MAX_TEXTURES)+1;_drawCallPool.length<MAX_SPRITES;)_drawCallPool.push(new BatchDrawCall2);for(;_textureArrayPool.length<MAX_TA;)_textureArrayPool.push(new BatchTextureArray2);for(var i=0;i<this.MAX_TEXTURES;i++)this._tempBoundTextures[i]=null},AbstractBatchRenderer3.prototype.onPrerender=function(){this._flushId=0},AbstractBatchRenderer3.prototype.render=function(element){!element._texture.valid||(this._vertexCount+element.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=element.vertexData.length/2,this._indexCount+=element.indices.length,this._bufferedTextures[this._bufferSize]=element._texture.baseTexture,this._bufferedElements[this._bufferSize++]=element)},AbstractBatchRenderer3.prototype.buildTexturesAndDrawCalls=function(){var _a3=this,textures=_a3._bufferedTextures,MAX_TEXTURES=_a3.MAX_TEXTURES,textureArrays=AbstractBatchRenderer3._textureArrayPool,batch=this.renderer.batch,boundTextures=this._tempBoundTextures,touch=this.renderer.textureGC.count,TICK=++BaseTexture2._globalBatch,countTexArrays=0,texArray=textureArrays[0],start2=0;batch.copyBoundTextures(boundTextures,MAX_TEXTURES);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null,tex._batchEnabled!==TICK&&(texArray.count>=MAX_TEXTURES&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start2,i),start2=i,texArray=textureArrays[++countTexArrays],++TICK),tex._batchEnabled=TICK,tex.touched=touch,texArray.elements[texArray.count++]=tex)}texArray.count>0&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start2,this._bufferSize),++countTexArrays,++TICK);for(var i=0;i<boundTextures.length;i++)boundTextures[i]=null;BaseTexture2._globalBatch=TICK},AbstractBatchRenderer3.prototype.buildDrawCalls=function(texArray,start2,finish){var _a3=this,elements=_a3._bufferedElements,_attributeBuffer=_a3._attributeBuffer,_indexBuffer=_a3._indexBuffer,vertexSize=_a3.vertexSize,drawCalls=AbstractBatchRenderer3._drawCallPool,dcIndex=this._dcIndex,aIndex=this._aIndex,iIndex=this._iIndex,drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex,drawCall.texArray=texArray;for(var i=start2;i<finish;++i){var sprite=elements[i],tex=sprite._texture.baseTexture,spriteBlendMode=premultiplyBlendMode2[tex.alphaMode?1:0][sprite.blendMode];elements[i]=null,start2<i&&drawCall.blend!==spriteBlendMode&&(drawCall.size=iIndex-drawCall.start,start2=i,drawCall=drawCalls[++dcIndex],drawCall.texArray=texArray,drawCall.start=iIndex),this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex),aIndex+=sprite.vertexData.length/2*vertexSize,iIndex+=sprite.indices.length,drawCall.blend=spriteBlendMode}start2<finish&&(drawCall.size=iIndex-drawCall.start,++dcIndex),this._dcIndex=dcIndex,this._aIndex=aIndex,this._iIndex=iIndex},AbstractBatchRenderer3.prototype.bindAndClearTexArray=function(texArray){for(var textureSystem=this.renderer.texture,j=0;j<texArray.count;j++)textureSystem.bind(texArray.elements[j],texArray.ids[j]),texArray.elements[j]=null;texArray.count=0},AbstractBatchRenderer3.prototype.updateGeometry=function(){var _a3=this,packedGeometries=_a3._packedGeometries,attributeBuffer=_a3._attributeBuffer,indexBuffer=_a3._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,packedGeometries[this._flushId]=new this.geometryClass),packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.bind(packedGeometries[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},AbstractBatchRenderer3.prototype.drawBatches=function(){for(var dcCount=this._dcIndex,_a3=this.renderer,gl=_a3.gl,stateSystem=_a3.state,drawCalls=AbstractBatchRenderer3._drawCallPool,curTexArray=null,i=0;i<dcCount;i++){var _b2=drawCalls[i],texArray=_b2.texArray,type=_b2.type,size=_b2.size,start2=_b2.start,blend=_b2.blend;curTexArray!==texArray&&(curTexArray=texArray,this.bindAndClearTexArray(texArray)),this.state.blendMode=blend,stateSystem.set(this.state),gl.drawElements(type,size,gl.UNSIGNED_SHORT,start2*2)}},AbstractBatchRenderer3.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},AbstractBatchRenderer3.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},AbstractBatchRenderer3.prototype.stop=function(){this.flush()},AbstractBatchRenderer3.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),_super.prototype.destroy.call(this)},AbstractBatchRenderer3.prototype.getAttributeBuffer=function(size){var roundedP2=nextPow22(Math.ceil(size/8)),roundedSizeIndex=log22(roundedP2),roundedSize=roundedP2*8;this._aBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._aBuffers[roundedSize];return buffer||(this._aBuffers[roundedSize]=buffer=new ViewableBuffer2(roundedSize*this.vertexSize*4)),buffer},AbstractBatchRenderer3.prototype.getIndexBuffer=function(size){var roundedP2=nextPow22(Math.ceil(size/12)),roundedSizeIndex=log22(roundedP2),roundedSize=roundedP2*12;this._iBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._iBuffers[roundedSizeIndex];return buffer||(this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize)),buffer},AbstractBatchRenderer3.prototype.packInterleavedGeometry=function(element,attributeBuffer,indexBuffer,aIndex,iIndex){for(var uint32View=attributeBuffer.uint32View,float32View=attributeBuffer.float32View,packedVertices=aIndex/this.vertexSize,uvs=element.uvs,indicies=element.indices,vertexData=element.vertexData,textureId=element._texture.baseTexture._batchLocation,alpha=Math.min(element.worldAlpha,1),argb=alpha<1&&element._texture.baseTexture.alphaMode?premultiplyTint2(element._tintRGB,alpha):element._tintRGB+(alpha*255<<24),i=0;i<vertexData.length;i+=2)float32View[aIndex++]=vertexData[i],float32View[aIndex++]=vertexData[i+1],float32View[aIndex++]=uvs[i],float32View[aIndex++]=uvs[i+1],uint32View[aIndex++]=argb,float32View[aIndex++]=textureId;for(var i=0;i<indicies.length;i++)indexBuffer[iIndex++]=packedVertices+indicies[i]},AbstractBatchRenderer3._drawCallPool=[],AbstractBatchRenderer3._textureArrayPool=[],AbstractBatchRenderer3}(ObjectRenderer2),BatchShaderGenerator2=function(){function BatchShaderGenerator3(vertexSrc,fragTemplate4){if(this.vertexSrc=vertexSrc,this.fragTemplate=fragTemplate4,this.programCache={},this.defaultGroupCache={},fragTemplate4.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(fragTemplate4.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return BatchShaderGenerator3.prototype.generateShader=function(maxTextures){if(!this.programCache[maxTextures]){for(var sampleValues=new Int32Array(maxTextures),i=0;i<maxTextures;i++)sampleValues[i]=i;this.defaultGroupCache[maxTextures]=UniformGroup2.from({uSamplers:sampleValues},!0);var fragmentSrc=this.fragTemplate;fragmentSrc=fragmentSrc.replace(/%count%/gi,""+maxTextures),fragmentSrc=fragmentSrc.replace(/%forloop%/gi,this.generateSampleSrc(maxTextures)),this.programCache[maxTextures]=new Program2(this.vertexSrc,fragmentSrc)}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix2,default:this.defaultGroupCache[maxTextures]};return new Shader2(this.programCache[maxTextures],uniforms)},BatchShaderGenerator3.prototype.generateSampleSrc=function(maxTextures){var src="";src+=`
`,src+=`
`;for(var i=0;i<maxTextures;i++)i>0&&(src+=`
else `),i<maxTextures-1&&(src+="if(vTextureId < "+i+".5)"),src+=`
{`,src+=`
	color = texture2D(uSamplers[`+i+"], vTextureCoord);",src+=`
}`;return src+=`
`,src+=`
`,src},BatchShaderGenerator3}(),BatchGeometry2=function(_super){__extends23(BatchGeometry3,_super);function BatchGeometry3(_static){_static===void 0&&(_static=!1);var _this=_super.call(this)||this;return _this._buffer=new Buffer3(null,_static,!1),_this._indexBuffer=new Buffer3(null,_static,!0),_this.addAttribute("aVertexPosition",_this._buffer,2,!1,TYPES2.FLOAT).addAttribute("aTextureCoord",_this._buffer,2,!1,TYPES2.FLOAT).addAttribute("aColor",_this._buffer,4,!0,TYPES2.UNSIGNED_BYTE).addAttribute("aTextureId",_this._buffer,1,!0,TYPES2.FLOAT).addIndex(_this._indexBuffer),_this}return BatchGeometry3}(Geometry2),defaultVertex$32=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,defaultFragment$22=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,BatchPluginFactory2=function(){function BatchPluginFactory3(){}return BatchPluginFactory3.create=function(options){var _a3=Object.assign({vertex:defaultVertex$32,fragment:defaultFragment$22,geometryClass:BatchGeometry2,vertexSize:6},options),vertex9=_a3.vertex,fragment12=_a3.fragment,vertexSize=_a3.vertexSize,geometryClass=_a3.geometryClass;return function(_super){__extends23(BatchPlugin,_super);function BatchPlugin(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=new BatchShaderGenerator2(vertex9,fragment12),_this.geometryClass=geometryClass,_this.vertexSize=vertexSize,_this}return BatchPlugin}(AbstractBatchRenderer2)},Object.defineProperty(BatchPluginFactory3,"defaultVertexSrc",{get:function(){return defaultVertex$32},enumerable:!1,configurable:!0}),Object.defineProperty(BatchPluginFactory3,"defaultFragmentTemplate",{get:function(){return defaultFragment$22},enumerable:!1,configurable:!0}),BatchPluginFactory3}(),BatchRenderer2=BatchPluginFactory2.create(),resources2={},_loop_12=function(name){Object.defineProperty(resources2,name,{get:function(){return deprecation2("6.0.0","PIXI.systems."+name+" has moved to PIXI."+name),_resources2[name]}})};for(var name in _resources2)_loop_12(name);var systems2={},_loop_22=function(name){Object.defineProperty(systems2,name,{get:function(){return deprecation2("6.0.0","PIXI.resources."+name+" has moved to PIXI."+name),_systems2[name]}})};for(var name in _systems2)_loop_22(name);var CanvasMeshRenderer=function(){function CanvasMeshRenderer2(renderer){this.renderer=renderer}return CanvasMeshRenderer2.prototype.render=function(mesh){var renderer=this.renderer,transform=mesh.worldTransform;renderer.context.globalAlpha=mesh.worldAlpha,renderer.setBlendMode(mesh.blendMode),renderer.setContextTransform(transform,mesh.roundPixels),mesh.drawMode!==DRAW_MODES2.TRIANGLES?this._renderTriangleMesh(mesh):this._renderTriangles(mesh)},CanvasMeshRenderer2.prototype._renderTriangleMesh=function(mesh){for(var length=mesh.geometry.buffers[0].data.length,i=0;i<length-2;i++){var index3=i*2;this._renderDrawTriangle(mesh,index3,index3+2,index3+4)}},CanvasMeshRenderer2.prototype._renderTriangles=function(mesh){for(var indices2=mesh.geometry.getIndex().data,length=indices2.length,i=0;i<length;i+=3){var index0=indices2[i]*2,index1=indices2[i+1]*2,index22=indices2[i+2]*2;this._renderDrawTriangle(mesh,index0,index1,index22)}},CanvasMeshRenderer2.prototype._renderDrawTriangle=function(mesh,index0,index1,index22){var context4=this.renderer.context,vertices=mesh.geometry.buffers[0].data,uvs=mesh.uvs,texture=mesh.texture;if(!!texture.valid){var isTinted=mesh.tint!==16777215,base=texture.baseTexture,textureWidth=base.width,textureHeight=base.height;isTinted&&mesh._cachedTint!==mesh.tint&&(mesh._cachedTint=mesh.tint,mesh._cachedTexture=mesh._cachedTexture||new Texture2(base),mesh._tintedCanvas=canvasUtils.getTintedCanvas({texture:mesh._cachedTexture},mesh.tint));var textureSource=isTinted?mesh._tintedCanvas:base.getDrawableSource(),u0=uvs[index0]*base.width,u1=uvs[index1]*base.width,u2=uvs[index22]*base.width,v0=uvs[index0+1]*base.height,v1=uvs[index1+1]*base.height,v2=uvs[index22+1]*base.height,x0=vertices[index0],x1=vertices[index1],x2=vertices[index22],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index22+1],screenPadding=mesh.canvasPadding/this.renderer.resolution;if(screenPadding>0){var _a3=mesh.worldTransform,a=_a3.a,b=_a3.b,c=_a3.c,d=_a3.d,centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3,normX=x0-centerX,normY=y0-centerY,screenX=a*normX+c*normY,screenY=b*normX+d*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist;x0=centerX+normX*paddingFactor,y0=centerY+normY*paddingFactor,normX=x1-centerX,normY=y1-centerY,screenX=a*normX+c*normY,screenY=b*normX+d*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist,x1=centerX+normX*paddingFactor,y1=centerY+normY*paddingFactor,normX=x2-centerX,normY=y2-centerY,screenX=a*normX+c*normY,screenY=b*normX+d*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist,x2=centerX+normX*paddingFactor,y2=centerY+normY*paddingFactor}context4.save(),context4.beginPath(),context4.moveTo(x0,y0),context4.lineTo(x1,y1),context4.lineTo(x2,y2),context4.closePath(),context4.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context4.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta),context4.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight),context4.restore(),this.renderer.invalidateBlendMode()}},CanvasMeshRenderer2.prototype.renderMeshFlat=function(mesh){var context4=this.renderer.context,vertices=mesh.geometry.getBuffer("aVertexPosition").data,length=vertices.length/2;context4.beginPath();for(var i=1;i<length-2;++i){var index3=i*2,x0=vertices[index3],y0=vertices[index3+1],x1=vertices[index3+2],y1=vertices[index3+3],x2=vertices[index3+4],y2=vertices[index3+5];context4.moveTo(x0,y0),context4.lineTo(x1,y1),context4.lineTo(x2,y2)}context4.fillStyle="#FF0000",context4.fill(),context4.closePath()},CanvasMeshRenderer2.prototype.destroy=function(){this.renderer=null},CanvasMeshRenderer2}();settings.MESH_CANVAS_PADDING=0;MeshMaterial.prototype._renderCanvas=function(renderer,mesh){renderer.plugins.mesh.render(mesh)};NineSlicePlane.prototype._cachedTint=16777215;NineSlicePlane.prototype._tintedCanvas=null;NineSlicePlane.prototype._canvasUvs=null;NineSlicePlane.prototype._renderCanvas=function(renderer){var context4=renderer.context,transform=this.worldTransform,isTinted=this.tint!==16777215,texture=this.texture;if(!!texture.valid){isTinted&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tint));var textureSource=isTinted?this._tintedCanvas:texture.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var vertices=this.vertices,uvs=this._canvasUvs,u0=isTinted?0:texture.frame.x,v0=isTinted?0:texture.frame.y,u1=u0+texture.frame.width,v1=v0+texture.frame.height;uvs[0]=u0,uvs[1]=u0+this._leftWidth,uvs[2]=u1-this._rightWidth,uvs[3]=u1,uvs[4]=v0,uvs[5]=v0+this._topHeight,uvs[6]=v1-this._bottomHeight,uvs[7]=v1;for(var i=0;i<8;i++)uvs[i]*=texture.baseTexture.resolution;context4.globalAlpha=this.worldAlpha,renderer.setBlendMode(this.blendMode),renderer.setContextTransform(transform,this.roundPixels);for(var row=0;row<3;row++)for(var col=0;col<3;col++){var ind=col*2+row*8,sw=Math.max(1,uvs[col+1]-uvs[col]),sh=Math.max(1,uvs[row+5]-uvs[row+4]),dw=Math.max(1,vertices[ind+10]-vertices[ind]),dh=Math.max(1,vertices[ind+11]-vertices[ind+1]);context4.drawImage(textureSource,uvs[col],uvs[row+4],sw,sh,vertices[ind],vertices[ind+1],dw,dh)}}};var warned=!1;Mesh.prototype._cachedTint=16777215;Mesh.prototype._tintedCanvas=null;Mesh.prototype._cachedTexture=null;Mesh.prototype._renderCanvas=function(renderer){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(renderer,this):warned||(warned=!0,self.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))};Mesh.prototype._canvasPadding=null;Object.defineProperty(Mesh.prototype,"canvasPadding",{get:function(){return this._canvasPadding!==null?this._canvasPadding:settings.MESH_CANVAS_PADDING},set:function(value){this._canvasPadding=value}});SimpleMesh.prototype._renderCanvas=function(renderer){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(renderer,this)};SimpleRope.prototype._renderCanvas=function(renderer){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(renderer,this)};var CanvasGraphicsRenderer=function(){function CanvasGraphicsRenderer2(renderer){this.renderer=renderer,this._svgMatrix=null,this._tempMatrix=new Matrix}return CanvasGraphicsRenderer2.prototype._calcCanvasStyle=function(style,tint){var res;return style.texture&&style.texture.baseTexture!==Texture.WHITE.baseTexture?style.texture.valid?(res=canvasUtils.getTintedPattern(style.texture,tint),this.setPatternTransform(res,style.matrix||Matrix.IDENTITY)):res="#808080":res="#"+("00000"+(tint|0).toString(16)).substr(-6),res},CanvasGraphicsRenderer2.prototype.render=function(graphics){var renderer=this.renderer,context4=renderer.context,worldAlpha=graphics.worldAlpha,transform=graphics.transform.worldTransform;renderer.setContextTransform(transform),renderer.setBlendMode(graphics.blendMode);for(var graphicsData=graphics.geometry.graphicsData,contextFillStyle,contextStrokeStyle,tintR=(graphics.tint>>16&255)/255,tintG=(graphics.tint>>8&255)/255,tintB=(graphics.tint&255)/255,i=0;i<graphicsData.length;i++){var data=graphicsData[i],shape=data.shape,fillStyle=data.fillStyle,lineStyle=data.lineStyle,fillColor=data.fillStyle.color|0,lineColor=data.lineStyle.color|0;if(data.matrix&&renderer.setContextTransform(transform.copyTo(this._tempMatrix).append(data.matrix)),fillStyle.visible){var fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(fillColor&255)/255*tintB*255;contextFillStyle=this._calcCanvasStyle(fillStyle,fillTint)}if(lineStyle.visible){var lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(lineColor&255)/255*tintB*255;contextStrokeStyle=this._calcCanvasStyle(lineStyle,lineTint)}if(context4.lineWidth=lineStyle.width,context4.lineCap=lineStyle.cap,context4.lineJoin=lineStyle.join,context4.miterLimit=lineStyle.miterLimit,data.type===SHAPES.POLY){context4.beginPath();var tempShape=shape,points=tempShape.points,holes=data.holes,outerArea=void 0,innerArea=void 0,px=void 0,py=void 0;context4.moveTo(points[0],points[1]);for(var j=2;j<points.length;j+=2)context4.lineTo(points[j],points[j+1]);if(tempShape.closeStroke&&context4.closePath(),holes.length>0){outerArea=0,px=points[0],py=points[1];for(var j=2;j+2<points.length;j+=2)outerArea+=(points[j]-px)*(points[j+3]-py)-(points[j+2]-px)*(points[j+1]-py);for(var k=0;k<holes.length;k++)if(points=holes[k].shape.points,!!points){innerArea=0,px=points[0],py=points[1];for(var j=2;j+2<points.length;j+=2)innerArea+=(points[j]-px)*(points[j+3]-py)-(points[j+2]-px)*(points[j+1]-py);if(innerArea*outerArea<0){context4.moveTo(points[0],points[1]);for(var j=2;j<points.length;j+=2)context4.lineTo(points[j],points[j+1])}else{context4.moveTo(points[points.length-2],points[points.length-1]);for(var j=points.length-4;j>=0;j-=2)context4.lineTo(points[j],points[j+1])}holes[k].shape.closeStroke&&context4.closePath()}}fillStyle.visible&&(context4.globalAlpha=fillStyle.alpha*worldAlpha,context4.fillStyle=contextFillStyle,context4.fill()),lineStyle.visible&&(context4.globalAlpha=lineStyle.alpha*worldAlpha,context4.strokeStyle=contextStrokeStyle,context4.stroke())}else if(data.type===SHAPES.RECT){var tempShape=shape;fillStyle.visible&&(context4.globalAlpha=fillStyle.alpha*worldAlpha,context4.fillStyle=contextFillStyle,context4.fillRect(tempShape.x,tempShape.y,tempShape.width,tempShape.height)),lineStyle.visible&&(context4.globalAlpha=lineStyle.alpha*worldAlpha,context4.strokeStyle=contextStrokeStyle,context4.strokeRect(tempShape.x,tempShape.y,tempShape.width,tempShape.height))}else if(data.type===SHAPES.CIRC){var tempShape=shape;context4.beginPath(),context4.arc(tempShape.x,tempShape.y,tempShape.radius,0,2*Math.PI),context4.closePath(),fillStyle.visible&&(context4.globalAlpha=fillStyle.alpha*worldAlpha,context4.fillStyle=contextFillStyle,context4.fill()),lineStyle.visible&&(context4.globalAlpha=lineStyle.alpha*worldAlpha,context4.strokeStyle=contextStrokeStyle,context4.stroke())}else if(data.type===SHAPES.ELIP){var tempShape=shape,w=tempShape.width*2,h=tempShape.height*2,x=tempShape.x-w/2,y=tempShape.y-h/2;context4.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context4.moveTo(x,ym),context4.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context4.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context4.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context4.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context4.closePath(),fillStyle.visible&&(context4.globalAlpha=fillStyle.alpha*worldAlpha,context4.fillStyle=contextFillStyle,context4.fill()),lineStyle.visible&&(context4.globalAlpha=lineStyle.alpha*worldAlpha,context4.strokeStyle=contextStrokeStyle,context4.stroke())}else if(data.type===SHAPES.RREC){var tempShape=shape,rx=tempShape.x,ry=tempShape.y,width=tempShape.width,height=tempShape.height,radius=tempShape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context4.beginPath(),context4.moveTo(rx,ry+radius),context4.lineTo(rx,ry+height-radius),context4.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context4.lineTo(rx+width-radius,ry+height),context4.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context4.lineTo(rx+width,ry+radius),context4.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context4.lineTo(rx+radius,ry),context4.quadraticCurveTo(rx,ry,rx,ry+radius),context4.closePath(),fillStyle.visible&&(context4.globalAlpha=fillStyle.alpha*worldAlpha,context4.fillStyle=contextFillStyle,context4.fill()),lineStyle.visible&&(context4.globalAlpha=lineStyle.alpha*worldAlpha,context4.strokeStyle=contextStrokeStyle,context4.stroke())}}},CanvasGraphicsRenderer2.prototype.setPatternTransform=function(pattern,matrix){if(this._svgMatrix!==!1){if(!this._svgMatrix){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");if(svg&&svg.createSVGMatrix&&(this._svgMatrix=svg.createSVGMatrix()),!this._svgMatrix||!pattern.setTransform){this._svgMatrix=!1;return}}this._svgMatrix.a=matrix.a,this._svgMatrix.b=matrix.b,this._svgMatrix.c=matrix.c,this._svgMatrix.d=matrix.d,this._svgMatrix.e=matrix.tx,this._svgMatrix.f=matrix.ty,pattern.setTransform(this._svgMatrix.inverse())}},CanvasGraphicsRenderer2.prototype.destroy=function(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null},CanvasGraphicsRenderer2}(),canvasRenderer,tempMatrix4=new Matrix;Graphics.prototype.generateCanvasTexture=function(scaleMode,resolution){resolution===void 0&&(resolution=1);var bounds=this.getLocalBounds(),canvasBuffer=RenderTexture.create({width:bounds.width,height:bounds.height,scaleMode,resolution});canvasRenderer||(canvasRenderer=new CanvasRenderer),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(tempMatrix4),tempMatrix4.invert(),tempMatrix4.tx-=bounds.x,tempMatrix4.ty-=bounds.y,canvasRenderer.render(this,{renderTexture:canvasBuffer,clear:!0,transform:tempMatrix4});var texture=Texture.from(canvasBuffer.baseTexture._canvasRenderTarget.canvas,{scaleMode});return texture.baseTexture.setResolution(resolution),texture};Graphics.prototype.cachedGraphicsData=[];Graphics.prototype._renderCanvas=function(renderer){this.isMask!==!0&&(this.finishPoly(),renderer.plugins.graphics.render(this))};var canvasRenderWorldTransform=new Matrix,CanvasSpriteRenderer=function(){function CanvasSpriteRenderer2(renderer){this.renderer=renderer}return CanvasSpriteRenderer2.prototype.render=function(sprite){var texture=sprite._texture,renderer=this.renderer,context4=renderer.context,width=texture._frame.width,height=texture._frame.height,wt=sprite.transform.worldTransform,dx=0,dy=0,source=texture.baseTexture.getDrawableSource();if(!(texture.orig.width<=0||texture.orig.height<=0||!texture.valid||!source)&&!!texture.valid){renderer.setBlendMode(sprite.blendMode,!0),renderer.context.globalAlpha=sprite.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===SCALE_MODES2.LINEAR;renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled&&(context4[renderer.smoothProperty]=smoothingEnabled),texture.trim?(dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width,dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height):(dx=(.5-sprite.anchor.x)*texture.orig.width,dy=(.5-sprite.anchor.y)*texture.orig.height),texture.rotate&&(wt.copyTo(canvasRenderWorldTransform),wt=canvasRenderWorldTransform,groupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy),dx=0,dy=0),dx-=width/2,dy-=height/2,renderer.setContextTransform(wt,sprite.roundPixels,1),sprite.roundPixels&&(dx=dx|0,dy=dy|0);var resolution=texture.baseTexture.resolution,outerBlend=renderer._outerBlend;outerBlend&&(context4.save(),context4.beginPath(),context4.rect(dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution),context4.clip()),sprite.tint!==16777215?((sprite._cachedTint!==sprite.tint||sprite._tintedCanvas.tintId!==sprite._texture._updateID)&&(sprite._cachedTint=sprite.tint,sprite._tintedCanvas=canvasUtils.getTintedCanvas(sprite,sprite.tint)),context4.drawImage(sprite._tintedCanvas,0,0,Math.floor(width*resolution),Math.floor(height*resolution),Math.floor(dx*renderer.resolution),Math.floor(dy*renderer.resolution),Math.floor(width*renderer.resolution),Math.floor(height*renderer.resolution))):context4.drawImage(source,texture._frame.x*resolution,texture._frame.y*resolution,Math.floor(width*resolution),Math.floor(height*resolution),Math.floor(dx*renderer.resolution),Math.floor(dy*renderer.resolution),Math.floor(width*renderer.resolution),Math.floor(height*renderer.resolution)),outerBlend&&context4.restore(),renderer.setBlendMode(BLEND_MODES2.NORMAL)}},CanvasSpriteRenderer2.prototype.destroy=function(){this.renderer=null},CanvasSpriteRenderer2}();Sprite.prototype._tintedCanvas=null;Sprite.prototype._renderCanvas=function(renderer){renderer.plugins.sprite.render(this)};var TEMP_RECT2=new Rectangle,CanvasExtract=function(){function CanvasExtract2(renderer){this.renderer=renderer}return CanvasExtract2.prototype.image=function(target,format3,quality){var image=new Image;return image.src=this.base64(target,format3,quality),image},CanvasExtract2.prototype.base64=function(target,format3,quality){return this.canvas(target).toDataURL(format3,quality)},CanvasExtract2.prototype.canvas=function(target){var renderer=this.renderer,context4,resolution,frame,renderTexture;target&&(target instanceof RenderTexture?renderTexture=target:renderTexture=renderer.generateTexture(target)),renderTexture?(context4=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=renderTexture.frame):(context4=renderer.rootContext,resolution=renderer.resolution,frame=TEMP_RECT2,frame.width=this.renderer.width,frame.height=this.renderer.height);var width=Math.floor(frame.width*resolution+1e-4),height=Math.floor(frame.height*resolution+1e-4),canvasBuffer=new CanvasRenderTarget(width,height,1),canvasData=context4.getImageData(frame.x*resolution,frame.y*resolution,width,height);return canvasBuffer.context.putImageData(canvasData,0,0),canvasBuffer.canvas},CanvasExtract2.prototype.pixels=function(target){var renderer=this.renderer,context4,resolution,frame,renderTexture;target&&(target instanceof RenderTexture?renderTexture=target:renderTexture=renderer.generateTexture(target)),renderTexture?(context4=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=renderTexture.frame):(context4=renderer.rootContext,frame=TEMP_RECT2,frame.width=renderer.width,frame.height=renderer.height);var x=frame.x*resolution,y=frame.y*resolution,width=frame.width*resolution,height=frame.height*resolution;return context4.getImageData(x,y,width,height).data},CanvasExtract2.prototype.destroy=function(){this.renderer=null},CanvasExtract2}();var extendStatics24=function(d,b){return extendStatics24=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)b2.hasOwnProperty(p)&&(d2[p]=b2[p])},extendStatics24(d,b)};function __extends24(d,b){extendStatics24(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var CANVAS_START_SIZE=16;function uploadBaseTextures2(prepare,item){var tempPrepare=prepare;if(item instanceof BaseTexture){var image=item.source,imageWidth=image.width===0?tempPrepare.canvas.width:Math.min(tempPrepare.canvas.width,image.width),imageHeight=image.height===0?tempPrepare.canvas.height:Math.min(tempPrepare.canvas.height,image.height);return tempPrepare.ctx.drawImage(image,0,0,imageWidth,imageHeight,0,0,tempPrepare.canvas.width,tempPrepare.canvas.height),!0}return!1}var CanvasPrepare=function(_super){__extends24(CanvasPrepare2,_super);function CanvasPrepare2(renderer){var _this=_super.call(this,renderer)||this;return _this.uploadHookHelper=_this,_this.canvas=document.createElement("canvas"),_this.canvas.width=CANVAS_START_SIZE,_this.canvas.height=CANVAS_START_SIZE,_this.ctx=_this.canvas.getContext("2d"),_this.registerUploadHook(uploadBaseTextures2),_this}return CanvasPrepare2.prototype.destroy=function(){_super.prototype.destroy.call(this),this.ctx=null,this.canvas=null},CanvasPrepare2}(BasePrepare);var worldMatrix=new Matrix,patternMatrix=new Matrix,patternRect=[new Point,new Point,new Point,new Point];TilingSprite.prototype._renderCanvas=function(renderer){var texture=this._texture;if(!!texture.baseTexture.valid){var context4=renderer.context,transform=this.worldTransform,baseTexture=texture.baseTexture,source=baseTexture.getDrawableSource(),baseTextureResolution=baseTexture.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var tempCanvas=new CanvasRenderTarget(texture._frame.width,texture._frame.height,baseTextureResolution);this.tint!==16777215?(this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tint),tempCanvas.context.drawImage(this._tintedCanvas,0,0)):tempCanvas.context.drawImage(source,-texture._frame.x*baseTextureResolution,-texture._frame.y*baseTextureResolution),this._cachedTint=this.tint,this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context4.globalAlpha=this.worldAlpha,renderer.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();var lt=this.tileTransform.localTransform,W=this._width,H=this._height;worldMatrix.identity(),patternMatrix.copyFrom(lt),this.uvRespectAnchor||patternMatrix.translate(-this.anchor.x*W,-this.anchor.y*H),worldMatrix.prepend(patternMatrix),worldMatrix.prepend(transform),renderer.setContextTransform(worldMatrix),context4.fillStyle=this._canvasPattern;var lx=this.anchor.x*-W,ly=this.anchor.y*-H;patternRect[0].set(lx,ly),patternRect[1].set(lx+W,ly),patternRect[2].set(lx+W,ly+H),patternRect[3].set(lx,ly+H);for(var i=0;i<4;i++)patternMatrix.applyInverse(patternRect[i],patternRect[i]);context4.beginPath(),context4.moveTo(patternRect[0].x,patternRect[0].y);for(var i=1;i<4;i++)context4.lineTo(patternRect[i].x,patternRect[i].y);context4.closePath(),context4.fill()}};ParticleContainer.prototype.renderCanvas=function(renderer){if(!(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable)){var context4=renderer.context,transform=this.worldTransform,isRotated=!0,positionX=0,positionY=0,finalWidth=0,finalHeight=0;renderer.setBlendMode(this.blendMode),context4.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(!!child.visible&&!!child._texture.valid){var frame=child._texture.frame;if(context4.globalAlpha=this.worldAlpha*child.alpha,child.rotation%(Math.PI*2)==0)isRotated&&(renderer.setContextTransform(transform,!1,1),isRotated=!1),positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5,positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5,finalWidth=frame.width*child.scale.x,finalHeight=frame.height*child.scale.y;else{isRotated||(isRotated=!0),child.displayObjectUpdateTransform();var childTransform=child.worldTransform;renderer.setContextTransform(childTransform,this.roundPixels,1),positionX=child.anchor.x*-frame.width+.5,positionY=child.anchor.y*-frame.height+.5,finalWidth=frame.width,finalHeight=frame.height}var resolution=child._texture.baseTexture.resolution;context4.drawImage(child._texture.baseTexture.getDrawableSource(),frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*renderer.resolution,positionY*renderer.resolution,finalWidth*renderer.resolution,finalHeight*renderer.resolution)}}}};Container.prototype._renderCanvas=function(_renderer){};Container.prototype.renderCanvas=function(renderer){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){this._mask&&renderer.maskManager.pushMask(this._mask),this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].renderCanvas(renderer);this._mask&&renderer.maskManager.popMask(renderer)}};DisplayObject.prototype.renderCanvas=function(_renderer){};Text.prototype._renderCanvas=function(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),Sprite.prototype._renderCanvas.call(this,renderer)};CanvasRenderer.registerPlugin("accessibility",AccessibilityManager);CanvasRenderer.registerPlugin("extract",CanvasExtract);CanvasRenderer.registerPlugin("graphics",CanvasGraphicsRenderer);CanvasRenderer.registerPlugin("interaction",InteractionManager);CanvasRenderer.registerPlugin("mesh",CanvasMeshRenderer);CanvasRenderer.registerPlugin("prepare",CanvasPrepare);CanvasRenderer.registerPlugin("sprite",CanvasSpriteRenderer);function to_pixiPoint(pos,posUnit,win,integerCoordinates=!1){let pos_px=to_px(pos,posUnit,win);return integerCoordinates?new Point(Math.round(pos_px[0]),Math.round(pos_px[1])):new Point(pos_px[0],pos_px[1])}var PsychObject=class extends EventEmitter{constructor(psychoJS,name){super();this._psychoJS=psychoJS,this._userAttributes=new Set,typeof name=="undefined"&&(name=this.constructor.name),this._addAttribute("name",name)}get psychoJS(){return this._psychoJS}set psychoJS(psychoJS){this._psychoJS=psychoJS}toString(){let representation=this.constructor.name+"( ",addComma=!1;for(let attribute of this._userAttributes){addComma&&(representation+=", "),addComma=!0;let value=toString(this["_"+attribute]),l=value.length;l>50&&(value[l-1]===")"?value=value.substring(0,50)+"~)":value=value.substring(0,50)+"~"),representation+=attribute+"="+value}return representation+=" )",representation}_setAttribute(attributeName,attributeValue,log3=!1,operation=void 0,stealth=!1){let response2={origin:"PsychObject.setAttribute",context:"when setting the attribute of an object"};if(typeof attributeName=="undefined")throw Object.assign(response2,{error:"the attribute name cannot be undefined"});if(typeof attributeValue=="undefined"&&this._psychoJS.logger.warn("setting the value of attribute: "+attributeName+" in PsychObject: "+this._name+" as: undefined"),typeof operation!="undefined"&&this.hasOwnProperty("_"+attributeName)){let oldValue=this["_"+attributeName];if(typeof attributeValue=="number"||Array.isArray(attributeValue)&&(attributeValue.length===0||typeof attributeValue[0]=="number"))if(Array.isArray(attributeValue))if(Array.isArray(oldValue)){if(attributeValue.length!==oldValue.length)throw Object.assign(response2,{error:"old and new value should have the same size when they are both arrays"});switch(operation){case"":break;case"+":attributeValue=attributeValue.map((v,i)=>oldValue[i]+v);break;case"*":attributeValue=attributeValue.map((v,i)=>oldValue[i]*v);break;case"-":attributeValue=attributeValue.map((v,i)=>oldValue[i]-v);break;case"/":attributeValue=attributeValue.map((v,i)=>oldValue[i]/v);break;case"**":attributeValue=attributeValue.map((v,i)=>oldValue[i]**v);break;case"%":attributeValue=attributeValue.map((v,i)=>oldValue[i]%v);break;default:throw Object.assign(response2,{error:"unsupported operation: "+operation+" when setting: "+attributeName+" in: "+this.name})}}else switch(operation){case"":break;case"+":attributeValue=attributeValue.map(v=>oldValue+v);break;case"*":attributeValue=attributeValue.map(v=>oldValue*v);break;case"-":attributeValue=attributeValue.map(v=>oldValue-v);break;case"/":attributeValue=attributeValue.map(v=>oldValue/v);break;case"**":attributeValue=attributeValue.map(v=>oldValue**v);break;case"%":attributeValue=attributeValue.map(v=>oldValue%v);break;default:throw Object.assign(response2,{error:"unsupported value: "+JSON.stringify(attributeValue)+" for operation: "+operation+" when setting: "+attributeName+" in: "+this.name})}else if(Array.isArray(oldValue))switch(operation){case"":attributeValue=oldValue.map(v=>attributeValue);break;case"+":attributeValue=oldValue.map(v=>v+attributeValue);break;case"*":attributeValue=oldValue.map(v=>v*attributeValue);break;case"-":attributeValue=oldValue.map(v=>v-attributeValue);break;case"/":attributeValue=oldValue.map(v=>v/attributeValue);break;case"**":attributeValue=oldValue.map(v=>v**attributeValue);break;case"%":attributeValue=oldValue.map(v=>v%attributeValue);break;default:throw Object.assign(response2,{error:"unsupported operation: "+operation+" when setting: "+attributeName+" in: "+this.name})}else switch(operation){case"":break;case"+":attributeValue=oldValue+attributeValue;break;case"*":attributeValue=oldValue*attributeValue;break;case"-":attributeValue=oldValue-attributeValue;break;case"/":attributeValue=oldValue/attributeValue;break;case"**":attributeValue=oldValue**attributeValue;break;case"%":attributeValue=oldValue%attributeValue;break;default:throw Object.assign(response2,{error:"unsupported value: "+JSON.stringify(attributeValue)+" for operation: "+operation+" when setting: "+attributeName+" in: "+this.name})}else throw Object.assign(response2,{error:"operation: "+operation+" is invalid for old value: "+JSON.stringify(oldValue)+" and new value: "+JSON.stringify(attributeValue)})}if(!stealth&&(log3||this._autoLog)&&typeof this.win!="undefined"){let msg=this.name+": "+attributeName+" = "+toString(attributeValue);this.win.logOnFlip({msg})}let previousAttributeValue=this["_"+attributeName];if(this["_"+attributeName]=attributeValue,typeof previousAttributeValue=="undefined")return!1;let prev=toString(previousAttributeValue),next=toString(attributeValue);return prev==="Object (circular)"||next==="Object (circular)"||prev!==next}_addAttribute(name,value,defaultValue3=void 0,onChange=()=>{}){let getPropertyName="get"+name[0].toUpperCase()+name.substr(1);typeof this[getPropertyName]=="undefined"&&(this[getPropertyName]=()=>this["_"+name]);let setPropertyName="set"+name[0].toUpperCase()+name.substr(1);typeof this[setPropertyName]=="undefined"?this[setPropertyName]=(value2,log3=!1)=>{(typeof value2=="undefined"||value2===null)&&(value2=defaultValue3),this._setAttribute(name,value2,log3)&&onChange()}:(typeof value=="undefined"||value===null)&&(value=defaultValue3),Object.defineProperty(this,name,{configurable:!0,get(){return this[getPropertyName]()},set(value2){this[setPropertyName](value2)}}),this[name]=value,this._userAttributes.add(name)}};var Scheduler=class{constructor(psychoJS){this._psychoJS=psychoJS,this._taskList=[],this._currentTask=void 0,this._argsList=[],this._currentArgs=void 0,this._stopAtNextUpdate=!1,this._stopAtNextTask=!1,this._status=Scheduler.Status.STOPPED}get status(){return this._status}add(task,...args){this._taskList.push(task),this._argsList.push(args)}addConditional(condition,thenScheduler,elseScheduler){let self2=this,task=function(){return condition()?self2.add(thenScheduler):self2.add(elseScheduler),Scheduler.Event.NEXT};this.add(task)}start(){let shedulerResolve,self2=this,update=async timestamp=>{if(self2._stopAtNextUpdate){self2._status=Scheduler.Status.STOPPED,shedulerResolve();return}if(await self2._runNextTasks()===Scheduler.Event.QUIT){self2._status=Scheduler.Status.STOPPED,shedulerResolve();return}let lastTimestamp=self2._lastTimestamp===void 0?timestamp:self2._lastTimestamp;self2._lastDelta=timestamp-lastTimestamp,self2._lastTimestamp=timestamp,self2._psychoJS.window.render(),requestAnimationFrame(update)};return requestAnimationFrame(update),new Promise((resolve4,_)=>{shedulerResolve=resolve4})}stop(){this._status=Scheduler.Status.STOPPED,this._stopAtNextTask=!0,this._stopAtNextUpdate=!0}async _runNextTasks(){this._status=Scheduler.Status.RUNNING;let state=Scheduler.Event.NEXT;for(;state===Scheduler.Event.NEXT;){if(this._stopAtNextTask)return Scheduler.Event.QUIT;if(typeof this._currentTask=="undefined")if(this._taskList.length>0)this._currentTask=this._taskList.shift(),this._currentArgs=this._argsList.shift();else return this._currentTask=void 0,this._currentArgs=void 0,Scheduler.Event.QUIT;this._currentTask instanceof Function?state=await this._currentTask(...this._currentArgs):(state=await this._currentTask._runNextTasks(),state===Scheduler.Event.QUIT&&(this._psychoJS.experiment.experimentEnded||(state=Scheduler.Event.NEXT))),state!==Scheduler.Event.FLIP_REPEAT&&(this._currentTask=void 0,this._currentArgs=void 0)}return state}};Scheduler.Event={NEXT:Symbol.for("NEXT"),FLIP_REPEAT:Symbol.for("FLIP_REPEAT"),FLIP_NEXT:Symbol.for("FLIP_NEXT"),QUIT:Symbol.for("QUIT")};Scheduler.Status={RUNNING:Symbol.for("RUNNING"),STOPPED:Symbol.for("STOPPED")};var core_exports={};__export(core_exports,{BuilderKeyResponse:()=>BuilderKeyResponse,EventManager:()=>EventManager,GUI:()=>GUI,KeyPress:()=>KeyPress,Keyboard:()=>Keyboard,Logger:()=>Logger,MinimalStim:()=>MinimalStim,Mouse:()=>Mouse,PsychoJS:()=>PsychoJS,ServerManager:()=>ServerManager,Window:()=>Window,WindowMixin:()=>WindowMixin});var import_log4javascript2=__toModule(require_log4javascript());var XLSX={};XLSX.version="0.18.5";var current_codepage=1200,current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],CS2CP={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},set_ansi=function(cp){VALID_ANSI.indexOf(cp)!=-1&&(current_ansi=CS2CP[0]=cp)};function reset_ansi(){set_ansi(1252)}var set_cp=function(cp){current_codepage=cp,set_ansi(cp)};function reset_cp(){set_cp(1200),reset_ansi()}function char_codes(data){for(var o=[],i=0,len2=data.length;i<len2;++i)o[i]=data.charCodeAt(i);return o}function utf16leread(data){for(var o=[],i=0;i<data.length>>1;++i)o[i]=String.fromCharCode(data.charCodeAt(2*i)+(data.charCodeAt(2*i+1)<<8));return o.join("")}function utf16beread(data){for(var o=[],i=0;i<data.length>>1;++i)o[i]=String.fromCharCode(data.charCodeAt(2*i+1)+(data.charCodeAt(2*i)<<8));return o.join("")}var debom=function(data){var c1=data.charCodeAt(0),c2=data.charCodeAt(1);return c1==255&&c2==254?utf16leread(data.slice(2)):c1==254&&c2==255?utf16beread(data.slice(2)):c1==65279?data.slice(1):data},_getchar=function(x){return String.fromCharCode(x)},_getansi=function(x){return String.fromCharCode(x)},$cptable;var DENSE=null,DIF_XL=!0,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(input){for(var o="",c1=0,c2=0,c3=0,e1=0,e2=0,e3=0,e4=0,i=0;i<input.length;)c1=input.charCodeAt(i++),e1=c1>>2,c2=input.charCodeAt(i++),e2=(c1&3)<<4|c2>>4,c3=input.charCodeAt(i++),e3=(c2&15)<<2|c3>>6,e4=c3&63,isNaN(c2)?e3=e4=64:isNaN(c3)&&(e4=64),o+=Base64_map.charAt(e1)+Base64_map.charAt(e2)+Base64_map.charAt(e3)+Base64_map.charAt(e4);return o}function Base64_decode(input){var o="",c1=0,c2=0,c3=0,e1=0,e2=0,e3=0,e4=0;input=input.replace(/[^\w\+\/\=]/g,"");for(var i=0;i<input.length;)e1=Base64_map.indexOf(input.charAt(i++)),e2=Base64_map.indexOf(input.charAt(i++)),c1=e1<<2|e2>>4,o+=String.fromCharCode(c1),e3=Base64_map.indexOf(input.charAt(i++)),c2=(e2&15)<<4|e3>>2,e3!==64&&(o+=String.fromCharCode(c2)),e4=Base64_map.indexOf(input.charAt(i++)),c3=(e3&3)<<6|e4,e4!==64&&(o+=String.fromCharCode(c3));return o}var has_buf=function(){return typeof Buffer!="undefined"&&typeof process!="undefined"&&typeof process.versions!="undefined"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer!="undefined"){var nbfs=!Buffer.from;if(!nbfs)try{Buffer.from("foo","utf8")}catch(e){nbfs=!0}return nbfs?function(buf,enc){return enc?new Buffer(buf,enc):new Buffer(buf)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(len2){return has_buf?Buffer.alloc?Buffer.alloc(len2):new Buffer(len2):typeof Uint8Array!="undefined"?new Uint8Array(len2):new Array(len2)}function new_unsafe_buf(len2){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(len2):new Buffer(len2):typeof Uint8Array!="undefined"?new Uint8Array(len2):new Array(len2)}var s2a=function(s){return has_buf?Buffer_from(s,"binary"):s.split("").map(function(x){return x.charCodeAt(0)&255})};function a2s(data){if(Array.isArray(data))return data.map(function(c){return String.fromCharCode(c)}).join("");for(var o=[],i=0;i<data.length;++i)o[i]=String.fromCharCode(data[i]);return o.join("")}function ab2a(data){if(typeof ArrayBuffer=="undefined")throw new Error("Unsupported");if(data instanceof ArrayBuffer)return ab2a(new Uint8Array(data));for(var o=new Array(data.length),i=0;i<data.length;++i)o[i]=data[i];return o}var bconcat=has_buf?function(bufs){return Buffer.concat(bufs.map(function(buf){return Buffer.isBuffer(buf)?buf:Buffer_from(buf)}))}:function(bufs){if(typeof Uint8Array!="undefined"){var i=0,maxlen=0;for(i=0;i<bufs.length;++i)maxlen+=bufs[i].length;var o=new Uint8Array(maxlen),len2=0;for(i=0,maxlen=0;i<bufs.length;maxlen+=len2,++i)if(len2=bufs[i].length,bufs[i]instanceof Uint8Array)o.set(bufs[i],maxlen);else{if(typeof bufs[i]=="string")throw"wtf";o.set(new Uint8Array(bufs[i]),maxlen)}return o}return[].concat.apply([],bufs.map(function(buf){return Array.isArray(buf)?buf:[].slice.call(buf)}))};function utf8decode(content){for(var out=[],widx=0,L=content.length+250,o=new_raw_buf(content.length+255),ridx=0;ridx<content.length;++ridx){var c=content.charCodeAt(ridx);if(c<128)o[widx++]=c;else if(c<2048)o[widx++]=192|c>>6&31,o[widx++]=128|c&63;else if(c>=55296&&c<57344){c=(c&1023)+64;var d=content.charCodeAt(++ridx)&1023;o[widx++]=240|c>>8&7,o[widx++]=128|c>>2&63,o[widx++]=128|d>>6&15|(c&3)<<4,o[widx++]=128|d&63}else o[widx++]=224|c>>12&15,o[widx++]=128|c>>6&63,o[widx++]=128|c&63;widx>L&&(out.push(o.slice(0,widx)),widx=0,o=new_raw_buf(65535),L=65530)}return out.push(o.slice(0,widx)),bconcat(out)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(x){for(var o="",i=x.length-1;i>=0;)o+=x.charAt(i--);return o}function pad0(v,d){var t=""+v;return t.length>=d?t:fill("0",d-t.length)+t}function pad_(v,d){var t=""+v;return t.length>=d?t:fill(" ",d-t.length)+t}function rpad_(v,d){var t=""+v;return t.length>=d?t:t+fill(" ",d-t.length)}function pad0r1(v,d){var t=""+Math.round(v);return t.length>=d?t:fill("0",d-t.length)+t}function pad0r2(v,d){var t=""+v;return t.length>=d?t:fill("0",d-t.length)+t}var p2_32=Math.pow(2,32);function pad0r(v,d){if(v>p2_32||v<-p2_32)return pad0r1(v,d);var i=Math.round(v);return pad0r2(i,d)}function SSF_isgeneral(s,i){return i=i||0,s.length>=7+i&&(s.charCodeAt(i)|32)==103&&(s.charCodeAt(i+1)|32)==101&&(s.charCodeAt(i+2)|32)==110&&(s.charCodeAt(i+3)|32)==101&&(s.charCodeAt(i+4)|32)==114&&(s.charCodeAt(i+5)|32)==97&&(s.charCodeAt(i+6)|32)==108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "',t}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(x,D,mixed){for(var sgn=x<0?-1:1,B=x*sgn,P_2=0,P_1=1,P=0,Q_2=1,Q_1=0,Q=0,A=Math.floor(B);Q_1<D&&(A=Math.floor(B),P=A*P_1+P_2,Q=A*Q_1+Q_2,!(B-A<5e-8));)B=1/(B-A),P_2=P_1,P_1=P,Q_2=Q_1,Q_1=Q;if(Q>D&&(Q_1>D?(Q=Q_2,P=P_2):(Q=Q_1,P=P_1)),!mixed)return[0,sgn*P,Q];var q=Math.floor(sgn*P/Q);return[q,sgn*P-q*Q,Q]}function SSF_parse_date_code(v,opts,b2){if(v>2958465||v<0)return null;var date=v|0,time=Math.floor(86400*(v-date)),dow=0,dout=[],out={D:date,T:time,u:86400*(v-date)-time,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(out.u)<1e-6&&(out.u=0),opts&&opts.date1904&&(date+=1462),out.u>.9999&&(out.u=0,++time==86400&&(out.T=time=0,++date,++out.D)),date===60)dout=b2?[1317,10,29]:[1900,2,29],dow=3;else if(date===0)dout=b2?[1317,8,29]:[1900,1,0],dow=6;else{date>60&&--date;var d=new Date(1900,0,1);d.setDate(d.getDate()+date-1),dout=[d.getFullYear(),d.getMonth()+1,d.getDate()],dow=d.getDay(),date<60&&(dow=(dow+6)%7),b2&&(dow=SSF_fix_hijri(d,dout))}return out.y=dout[0],out.m=dout[1],out.d=dout[2],out.S=time%60,time=Math.floor(time/60),out.M=time%60,time=Math.floor(time/60),out.H=time,out.q=dow,out}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(v,date1904){var epoch=v.getTime();return date1904?epoch-=1461*24*60*60*1e3:v>=SSFbase1904&&(epoch+=24*60*60*1e3),(epoch-(SSFdnthresh+(v.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function SSF_strip_decimal(o){return o.indexOf(".")==-1?o:o.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(o){return o.indexOf("E")==-1?o:o.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(v){var w=v<0?12:11,o=SSF_strip_decimal(v.toFixed(12));return o.length<=w||(o=v.toPrecision(10),o.length<=w)?o:v.toExponential(5)}function SSF_large_exp(v){var o=SSF_strip_decimal(v.toFixed(11));return o.length>(v<0?12:11)||o==="0"||o==="-0"?v.toPrecision(6):o}function SSF_general_num(v){var V=Math.floor(Math.log(Math.abs(v))*Math.LOG10E),o;return V>=-4&&V<=-1?o=v.toPrecision(10+V):Math.abs(V)<=9?o=SSF_small_exp(v):V===10?o=v.toFixed(10).substr(0,12):o=SSF_large_exp(v),SSF_strip_decimal(SSF_normalize_exp(o.toUpperCase()))}function SSF_general(v,opts){switch(typeof v){case"string":return v;case"boolean":return v?"TRUE":"FALSE";case"number":return(v|0)===v?v.toString(10):SSF_general_num(v);case"undefined":return"";case"object":if(v==null)return"";if(v instanceof Date)return SSF_format(14,datenum_local(v,opts&&opts.date1904),opts)}throw new Error("unsupported value in General format: "+v)}function SSF_fix_hijri(date,o){o[0]-=581;var dow=date.getDay();return date<60&&(dow=(dow+6)%7),dow}function SSF_write_date(type,fmt,val,ss0){var o="",ss=0,tt=0,y=val.y,out,outl=0;switch(type){case 98:y=val.y+543;case 121:switch(fmt.length){case 1:case 2:out=y%100,outl=2;break;default:out=y%1e4,outl=4;break}break;case 109:switch(fmt.length){case 1:case 2:out=val.m,outl=fmt.length;break;case 3:return months[val.m-1][1];case 5:return months[val.m-1][0];default:return months[val.m-1][2]}break;case 100:switch(fmt.length){case 1:case 2:out=val.d,outl=fmt.length;break;case 3:return days[val.q][0];default:return days[val.q][1]}break;case 104:switch(fmt.length){case 1:case 2:out=1+(val.H+11)%12,outl=fmt.length;break;default:throw"bad hour format: "+fmt}break;case 72:switch(fmt.length){case 1:case 2:out=val.H,outl=fmt.length;break;default:throw"bad hour format: "+fmt}break;case 77:switch(fmt.length){case 1:case 2:out=val.M,outl=fmt.length;break;default:throw"bad minute format: "+fmt}break;case 115:if(fmt!="s"&&fmt!="ss"&&fmt!=".0"&&fmt!=".00"&&fmt!=".000")throw"bad second format: "+fmt;return val.u===0&&(fmt=="s"||fmt=="ss")?pad0(val.S,fmt.length):(ss0>=2?tt=ss0===3?1e3:100:tt=ss0===1?10:1,ss=Math.round(tt*(val.S+val.u)),ss>=60*tt&&(ss=0),fmt==="s"?ss===0?"0":""+ss/tt:(o=pad0(ss,2+ss0),fmt==="ss"?o.substr(0,2):"."+o.substr(2,fmt.length-1)));case 90:switch(fmt){case"[h]":case"[hh]":out=val.D*24+val.H;break;case"[m]":case"[mm]":out=(val.D*24+val.H)*60+val.M;break;case"[s]":case"[ss]":out=((val.D*24+val.H)*60+val.M)*60+Math.round(val.S+val.u);break;default:throw"bad abstime format: "+fmt}outl=fmt.length===3?1:2;break;case 101:out=y,outl=1;break}var outstr=outl>0?pad0(out,outl):"";return outstr}function commaify(s){var w=3;if(s.length<=w)return s;for(var j=s.length%w,o=s.substr(0,j);j!=s.length;j+=w)o+=(o.length>0?",":"")+s.substr(j,w);return o}var pct1=/%/g;function write_num_pct(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul)}function write_num_cm(type,fmt,val){for(var idx=fmt.length-1;fmt.charCodeAt(idx-1)===44;)--idx;return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)))}function write_num_exp(fmt,val){var o,idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){if(val==0)return"0.0E+0";if(val<0)return"-"+write_num_exp(fmt,-val);var period=fmt.indexOf(".");period===-1&&(period=fmt.indexOf("E"));var ee=Math.floor(Math.log(val)*Math.LOG10E)%period;if(ee<0&&(ee+=period),o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period),o.indexOf("e")===-1){var fakee=Math.floor(Math.log(val)*Math.LOG10E);for(o.indexOf(".")===-1?o=o.charAt(0)+"."+o.substr(1)+"E+"+(fakee-o.length+ee):o+="E+"+(fakee-ee);o.substr(0,2)==="0.";)o=o.charAt(0)+o.substr(2,period)+"."+o.substr(2+period),o=o.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");o=o.replace(/\+-/,"-")}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$2,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E"})}else o=val.toExponential(idx);return fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/)&&(o=o.substr(0,o.length-1)+"0"+o.charAt(o.length-1)),fmt.match(/E\-/)&&o.match(/e\+/)&&(o=o.replace(/e\+/,"e")),o.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(r,aval,sign2){var den=parseInt(r[4],10),rr=Math.round(aval*den),base=Math.floor(rr/den),myn=rr-base*den,myd=den;return sign2+(base===0?"":""+base)+" "+(myn===0?fill(" ",r[1].length+1+r[4].length):pad_(myn,r[1].length)+r[2]+"/"+r[3]+pad0(myd,r[4].length))}function write_num_f2(r,aval,sign2){return sign2+(aval===0?"":""+aval)+fill(" ",r[1].length+2+r[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(str){for(var o="",cc,i=0;i!=str.length;++i)switch(cc=str.charCodeAt(i)){case 35:break;case 63:o+=" ";break;case 48:o+="0";break;default:o+=String.fromCharCode(cc)}return o}function rnd(val,d){var dd=Math.pow(10,d);return""+Math.round(val*dd)/dd}function dec(val,d){var _frac=val-Math.floor(val),dd=Math.pow(10,d);return d<(""+Math.round(_frac*dd)).length?0:Math.round(_frac*dd)}function carry(val,d){return d<(""+Math.round((val-Math.floor(val))*Math.pow(10,d))).length?1:0}function flr(val){return val<2147483647&&val>-2147483648?""+(val>=0?val|0:val-1|0):""+Math.floor(val)}function write_num_flt(type,fmt,val){if(type.charCodeAt(0)===40&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return val>=0?write_num_flt("n",ffmt,val):"("+write_num_flt("n",ffmt,-val)+")"}if(fmt.charCodeAt(fmt.length-1)===44)return write_num_cm(type,fmt,val);if(fmt.indexOf("%")!==-1)return write_num_pct(type,fmt,val);if(fmt.indexOf("E")!==-1)return write_num_exp(fmt,val);if(fmt.charCodeAt(0)===36)return"$"+write_num_flt(type,fmt.substr(fmt.charAt(1)==" "?2:1),val);var o,r,ri,ff,aval=Math.abs(val),sign2=val<0?"-":"";if(fmt.match(/^00+$/))return sign2+pad0r(aval,fmt.length);if(fmt.match(/^[#?]+$/))return o=pad0r(val,0),o==="0"&&(o=""),o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(r=fmt.match(frac1))return write_num_f1(r,aval,sign2);if(fmt.match(/^#+0+$/))return sign2+pad0r(aval,fmt.length-fmt.indexOf("0"));if(r=fmt.match(dec1))return o=rnd(val,r[1].length).replace(/^([^\.]+)$/,"$1."+hashq(r[1])).replace(/\.$/,"."+hashq(r[1])).replace(/\.(\d*)$/,function($$2,$1){return"."+$1+fill("0",hashq(r[1]).length-$1.length)}),fmt.indexOf("0.")!==-1?o:o.replace(/^0\./,".");if(fmt=fmt.replace(/^#+([0.])/,"$1"),r=fmt.match(/^(0*)\.(#*)$/))return sign2+rnd(aval,r[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".");if(r=fmt.match(/^#{1,3},##0(\.?)$/))return sign2+commaify(pad0r(aval,0));if(r=fmt.match(/^#,##0\.([#0]*0)$/))return val<0?"-"+write_num_flt(type,fmt,-val):commaify(""+(Math.floor(val)+carry(val,r[1].length)))+"."+pad0(dec(val,r[1].length),r[1].length);if(r=fmt.match(/^#,#*,#0/))return write_num_flt(type,fmt.replace(/^#,#*,/,""),val);if(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/))return o=_strrev(write_num_flt(type,fmt.replace(/[\\-]/g,""),val)),ri=0,_strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x2){return ri<o.length?o.charAt(ri++):x2==="0"?"0":""}));if(fmt.match(phone))return o=write_num_flt(type,"##########",val),"("+o.substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6);var oa="";if(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return ri=Math.min(r[4].length,7),ff=SSF_frac(aval,Math.pow(10,ri)-1,!1),o=""+sign2,oa=write_num("n",r[1],ff[1]),oa.charAt(oa.length-1)==" "&&(oa=oa.substr(0,oa.length-1)+"0"),o+=oa+r[2]+"/"+r[3],oa=rpad_(ff[2],ri),oa.length<r[4].length&&(oa=hashq(r[4].substr(r[4].length-oa.length))+oa),o+=oa,o;if(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return ri=Math.min(Math.max(r[1].length,r[4].length),7),ff=SSF_frac(aval,Math.pow(10,ri)-1,!0),sign2+(ff[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length));if(r=fmt.match(/^[#0?]+$/))return o=pad0r(val,0),fmt.length<=o.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(r=fmt.match(/^([#0?]+)\.([#0]+)$/)){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1"),ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres))}if(r=fmt.match(/^00,000\.([#0]*0)$/))return ri=dec(val,r[1].length),val<0?"-"+write_num_flt(type,fmt,-val):commaify(flr(val)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$2){return"00,"+($$2.length<3?pad0(0,3-$$2.length):"")+$$2})+"."+pad0(ri,r[1].length);switch(fmt){case"###,##0.00":return write_num_flt(type,"#,##0.00",val);case"###,###":case"##,###":case"#,###":var x=commaify(pad0r(aval,0));return x!=="0"?sign2+x:"";case"###,###.00":return write_num_flt(type,"###,##0.00",val).replace(/^0\./,".");case"#,###.00":return write_num_flt(type,"#,##0.00",val).replace(/^0\./,".");default:}throw new Error("unsupported format |"+fmt+"|")}function write_num_cm2(type,fmt,val){for(var idx=fmt.length-1;fmt.charCodeAt(idx-1)===44;)--idx;return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)))}function write_num_pct2(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul)}function write_num_exp2(fmt,val){var o,idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){if(val==0)return"0.0E+0";if(val<0)return"-"+write_num_exp2(fmt,-val);var period=fmt.indexOf(".");period===-1&&(period=fmt.indexOf("E"));var ee=Math.floor(Math.log(val)*Math.LOG10E)%period;if(ee<0&&(ee+=period),o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period),!o.match(/[Ee]/)){var fakee=Math.floor(Math.log(val)*Math.LOG10E);o.indexOf(".")===-1?o=o.charAt(0)+"."+o.substr(1)+"E+"+(fakee-o.length+ee):o+="E+"+(fakee-ee),o=o.replace(/\+-/,"-")}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$2,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E"})}else o=val.toExponential(idx);return fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/)&&(o=o.substr(0,o.length-1)+"0"+o.charAt(o.length-1)),fmt.match(/E\-/)&&o.match(/e\+/)&&(o=o.replace(/e\+/,"e")),o.replace("e","E")}function write_num_int(type,fmt,val){if(type.charCodeAt(0)===40&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return val>=0?write_num_int("n",ffmt,val):"("+write_num_int("n",ffmt,-val)+")"}if(fmt.charCodeAt(fmt.length-1)===44)return write_num_cm2(type,fmt,val);if(fmt.indexOf("%")!==-1)return write_num_pct2(type,fmt,val);if(fmt.indexOf("E")!==-1)return write_num_exp2(fmt,val);if(fmt.charCodeAt(0)===36)return"$"+write_num_int(type,fmt.substr(fmt.charAt(1)==" "?2:1),val);var o,r,ri,ff,aval=Math.abs(val),sign2=val<0?"-":"";if(fmt.match(/^00+$/))return sign2+pad0(aval,fmt.length);if(fmt.match(/^[#?]+$/))return o=""+val,val===0&&(o=""),o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(r=fmt.match(frac1))return write_num_f2(r,aval,sign2);if(fmt.match(/^#+0+$/))return sign2+pad0(aval,fmt.length-fmt.indexOf("0"));if(r=fmt.match(dec1))return o=(""+val).replace(/^([^\.]+)$/,"$1."+hashq(r[1])).replace(/\.$/,"."+hashq(r[1])),o=o.replace(/\.(\d*)$/,function($$2,$1){return"."+$1+fill("0",hashq(r[1]).length-$1.length)}),fmt.indexOf("0.")!==-1?o:o.replace(/^0\./,".");if(fmt=fmt.replace(/^#+([0.])/,"$1"),r=fmt.match(/^(0*)\.(#*)$/))return sign2+(""+aval).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".");if(r=fmt.match(/^#{1,3},##0(\.?)$/))return sign2+commaify(""+aval);if(r=fmt.match(/^#,##0\.([#0]*0)$/))return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val)+"."+fill("0",r[1].length);if(r=fmt.match(/^#,#*,#0/))return write_num_int(type,fmt.replace(/^#,#*,/,""),val);if(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/))return o=_strrev(write_num_int(type,fmt.replace(/[\\-]/g,""),val)),ri=0,_strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x2){return ri<o.length?o.charAt(ri++):x2==="0"?"0":""}));if(fmt.match(phone))return o=write_num_int(type,"##########",val),"("+o.substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6);var oa="";if(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return ri=Math.min(r[4].length,7),ff=SSF_frac(aval,Math.pow(10,ri)-1,!1),o=""+sign2,oa=write_num("n",r[1],ff[1]),oa.charAt(oa.length-1)==" "&&(oa=oa.substr(0,oa.length-1)+"0"),o+=oa+r[2]+"/"+r[3],oa=rpad_(ff[2],ri),oa.length<r[4].length&&(oa=hashq(r[4].substr(r[4].length-oa.length))+oa),o+=oa,o;if(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return ri=Math.min(Math.max(r[1].length,r[4].length),7),ff=SSF_frac(aval,Math.pow(10,ri)-1,!0),sign2+(ff[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length));if(r=fmt.match(/^[#0?]+$/))return o=""+val,fmt.length<=o.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(r=fmt.match(/^([#0]+)\.([#0]+)$/)){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1"),ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres))}if(r=fmt.match(/^00,000\.([#0]*0)$/))return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$2){return"00,"+($$2.length<3?pad0(0,3-$$2.length):"")+$$2})+"."+pad0(0,r[1].length);switch(fmt){case"###,###":case"##,###":case"#,###":var x=commaify(""+aval);return x!=="0"?sign2+x:"";default:if(fmt.match(/\.[0#?]*$/))return write_num_int(type,fmt.slice(0,fmt.lastIndexOf(".")),val)+hashq(fmt.slice(fmt.lastIndexOf(".")))}throw new Error("unsupported format |"+fmt+"|")}function write_num(type,fmt,val){return(val|0)===val?write_num_int(type,fmt,val):write_num_flt(type,fmt,val)}function SSF_split_fmt(fmt){for(var out=[],in_str=!1,i=0,j=0;i<fmt.length;++i)switch(fmt.charCodeAt(i)){case 34:in_str=!in_str;break;case 95:case 42:case 92:++i;break;case 59:out[out.length]=fmt.substr(j,i-j),j=i+1}if(out[out.length]=fmt.substr(j),in_str===!0)throw new Error("Format |"+fmt+"| unterminated string ");return out}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(fmt){for(var i=0,c="",o="";i<fmt.length;)switch(c=fmt.charAt(i)){case"G":SSF_isgeneral(fmt,i)&&(i+=6),i++;break;case'"':for(;fmt.charCodeAt(++i)!==34&&i<fmt.length;);++i;break;case"\\":i+=2;break;case"_":i+=2;break;case"@":++i;break;case"B":case"b":if(fmt.charAt(i+1)==="1"||fmt.charAt(i+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4E0A":if(fmt.substr(i,3).toUpperCase()==="A/P"||fmt.substr(i,5).toUpperCase()==="AM/PM"||fmt.substr(i,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348")return!0;++i;break;case"[":for(o=c;fmt.charAt(i++)!=="]"&&i<fmt.length;)o+=fmt.charAt(i);if(o.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;i<fmt.length&&("0#?.,E+-%".indexOf(c=fmt.charAt(++i))>-1||c=="\\"&&fmt.charAt(i+1)=="-"&&"0#".indexOf(fmt.charAt(i+2))>-1););break;case"?":for(;fmt.charAt(++i)===c;);break;case"*":++i,(fmt.charAt(i)==" "||fmt.charAt(i)=="*")&&++i;break;case"(":case")":++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;i<fmt.length&&"0123456789".indexOf(fmt.charAt(++i))>-1;);break;case" ":++i;break;default:++i;break}return!1}function eval_fmt(fmt,v,opts,flen){for(var out=[],o="",i=0,c="",lst="t",dt,j,cc,hr="H";i<fmt.length;)switch(c=fmt.charAt(i)){case"G":if(!SSF_isgeneral(fmt,i))throw new Error("unrecognized character "+c+" in "+fmt);out[out.length]={t:"G",v:"General"},i+=7;break;case'"':for(o="";(cc=fmt.charCodeAt(++i))!==34&&i<fmt.length;)o+=String.fromCharCode(cc);out[out.length]={t:"t",v:o},++i;break;case"\\":var w=fmt.charAt(++i),t=w==="("||w===")"?w:"t";out[out.length]={t,v:w},++i;break;case"_":out[out.length]={t:"t",v:" "},i+=2;break;case"@":out[out.length]={t:"T",v},++i;break;case"B":case"b":if(fmt.charAt(i+1)==="1"||fmt.charAt(i+1)==="2"){if(dt==null&&(dt=SSF_parse_date_code(v,opts,fmt.charAt(i+1)==="2"),dt==null))return"";out[out.length]={t:"X",v:fmt.substr(i,2)},lst=c,i+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":c=c.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(v<0||dt==null&&(dt=SSF_parse_date_code(v,opts),dt==null))return"";for(o=c;++i<fmt.length&&fmt.charAt(i).toLowerCase()===c;)o+=c;c==="m"&&lst.toLowerCase()==="h"&&(c="M"),c==="h"&&(c=hr),out[out.length]={t:c,v:o},lst=c;break;case"A":case"a":case"\u4E0A":var q={t:c,v:c};if(dt==null&&(dt=SSF_parse_date_code(v,opts)),fmt.substr(i,3).toUpperCase()==="A/P"?(dt!=null&&(q.v=dt.H>=12?"P":"A"),q.t="T",hr="h",i+=3):fmt.substr(i,5).toUpperCase()==="AM/PM"?(dt!=null&&(q.v=dt.H>=12?"PM":"AM"),q.t="T",i+=5,hr="h"):fmt.substr(i,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348"?(dt!=null&&(q.v=dt.H>=12?"\u4E0B\u5348":"\u4E0A\u5348"),q.t="T",i+=5,hr="h"):(q.t="t",++i),dt==null&&q.t==="T")return"";out[out.length]=q,lst=c;break;case"[":for(o=c;fmt.charAt(i++)!=="]"&&i<fmt.length;)o+=fmt.charAt(i);if(o.slice(-1)!=="]")throw'unterminated "[" block: |'+o+"|";if(o.match(SSF_abstime)){if(dt==null&&(dt=SSF_parse_date_code(v,opts),dt==null))return"";out[out.length]={t:"Z",v:o.toLowerCase()},lst=o.charAt(1)}else o.indexOf("$")>-1&&(o=(o.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(fmt)||(out[out.length]={t:"t",v:o}));break;case".":if(dt!=null){for(o=c;++i<fmt.length&&(c=fmt.charAt(i))==="0";)o+=c;out[out.length]={t:"s",v:o};break}case"0":case"#":for(o=c;++i<fmt.length&&"0#?.,E+-%".indexOf(c=fmt.charAt(i))>-1;)o+=c;out[out.length]={t:"n",v:o};break;case"?":for(o=c;fmt.charAt(++i)===c;)o+=c;out[out.length]={t:c,v:o},lst=c;break;case"*":++i,(fmt.charAt(i)==" "||fmt.charAt(i)=="*")&&++i;break;case"(":case")":out[out.length]={t:flen===1?"t":c,v:c},++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(o=c;i<fmt.length&&"0123456789".indexOf(fmt.charAt(++i))>-1;)o+=fmt.charAt(i);out[out.length]={t:"D",v:o};break;case" ":out[out.length]={t:c,v:c},++i;break;case"$":out[out.length]={t:"t",v:"$"},++i;break;default:if(",$-+/():!^&'~{}<>=\u20ACacfijklopqrtuvwxzP".indexOf(c)===-1)throw new Error("unrecognized character "+c+" in "+fmt);out[out.length]={t:"t",v:c},++i;break}var bt=0,ss0=0,ssm;for(i=out.length-1,lst="t";i>=0;--i)switch(out[i].t){case"h":case"H":out[i].t=hr,lst="h",bt<1&&(bt=1);break;case"s":(ssm=out[i].v.match(/\.0+$/))&&(ss0=Math.max(ss0,ssm[0].length-1)),bt<3&&(bt=3);case"d":case"y":case"M":case"e":lst=out[i].t;break;case"m":lst==="s"&&(out[i].t="M",bt<2&&(bt=2));break;case"X":break;case"Z":bt<1&&out[i].v.match(/[Hh]/)&&(bt=1),bt<2&&out[i].v.match(/[Mm]/)&&(bt=2),bt<3&&out[i].v.match(/[Ss]/)&&(bt=3)}switch(bt){case 0:break;case 1:dt.u>=.5&&(dt.u=0,++dt.S),dt.S>=60&&(dt.S=0,++dt.M),dt.M>=60&&(dt.M=0,++dt.H);break;case 2:dt.u>=.5&&(dt.u=0,++dt.S),dt.S>=60&&(dt.S=0,++dt.M);break}var nstr="",jj;for(i=0;i<out.length;++i)switch(out[i].t){case"t":case"T":case" ":case"D":break;case"X":out[i].v="",out[i].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":out[i].v=SSF_write_date(out[i].t.charCodeAt(0),out[i].v,dt,ss0),out[i].t="t";break;case"n":case"?":for(jj=i+1;out[jj]!=null&&((c=out[jj].t)==="?"||c==="D"||(c===" "||c==="t")&&out[jj+1]!=null&&(out[jj+1].t==="?"||out[jj+1].t==="t"&&out[jj+1].v==="/")||out[i].t==="("&&(c===" "||c==="n"||c===")")||c==="t"&&(out[jj].v==="/"||out[jj].v===" "&&out[jj+1]!=null&&out[jj+1].t=="?"));)out[i].v+=out[jj].v,out[jj]={v:"",t:";"},++jj;nstr+=out[i].v,i=jj-1;break;case"G":out[i].t="t",out[i].v=SSF_general(v,opts);break}var vv="",myv,ostr;if(nstr.length>0){nstr.charCodeAt(0)==40?(myv=v<0&&nstr.charCodeAt(0)===45?-v:v,ostr=write_num("n",nstr,myv)):(myv=v<0&&flen>1?-v:v,ostr=write_num("n",nstr,myv),myv<0&&out[0]&&out[0].t=="t"&&(ostr=ostr.substr(1),out[0].v="-"+out[0].v)),jj=ostr.length-1;var decpt=out.length;for(i=0;i<out.length;++i)if(out[i]!=null&&out[i].t!="t"&&out[i].v.indexOf(".")>-1){decpt=i;break}var lasti=out.length;if(decpt===out.length&&ostr.indexOf("E")===-1){for(i=out.length-1;i>=0;--i)out[i]==null||"n?".indexOf(out[i].t)===-1||(jj>=out[i].v.length-1?(jj-=out[i].v.length,out[i].v=ostr.substr(jj+1,out[i].v.length)):jj<0?out[i].v="":(out[i].v=ostr.substr(0,jj+1),jj=-1),out[i].t="t",lasti=i);jj>=0&&lasti<out.length&&(out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v)}else if(decpt!==out.length&&ostr.indexOf("E")===-1){for(jj=ostr.indexOf(".")-1,i=decpt;i>=0;--i)if(!(out[i]==null||"n?".indexOf(out[i].t)===-1)){for(j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")-1:out[i].v.length-1,vv=out[i].v.substr(j+1);j>=0;--j)jj>=0&&(out[i].v.charAt(j)==="0"||out[i].v.charAt(j)==="#")&&(vv=ostr.charAt(jj--)+vv);out[i].v=vv,out[i].t="t",lasti=i}for(jj>=0&&lasti<out.length&&(out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v),jj=ostr.indexOf(".")+1,i=decpt;i<out.length;++i)if(!(out[i]==null||"n?(".indexOf(out[i].t)===-1&&i!==decpt)){for(j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")+1:0,vv=out[i].v.substr(0,j);j<out[i].v.length;++j)jj<ostr.length&&(vv+=ostr.charAt(jj++));out[i].v=vv,out[i].t="t",lasti=i}}}for(i=0;i<out.length;++i)out[i]!=null&&"n?".indexOf(out[i].t)>-1&&(myv=flen>1&&v<0&&i>0&&out[i-1].v==="-"?-v:v,out[i].v=write_num(out[i].t,out[i].v,myv),out[i].t="t");var retval="";for(i=0;i!==out.length;++i)out[i]!=null&&(retval+=out[i].v);return retval}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(v,rr){if(rr==null)return!1;var thresh=parseFloat(rr[2]);switch(rr[1]){case"=":if(v==thresh)return!0;break;case">":if(v>thresh)return!0;break;case"<":if(v<thresh)return!0;break;case"<>":if(v!=thresh)return!0;break;case">=":if(v>=thresh)return!0;break;case"<=":if(v<=thresh)return!0;break}return!1}function choose_fmt(f,v){var fmt=SSF_split_fmt(f),l=fmt.length,lat=fmt[l-1].indexOf("@");if(l<4&&lat>-1&&--l,fmt.length>4)throw new Error("cannot find right format for |"+fmt.join("|")+"|");if(typeof v!="number")return[4,fmt.length===4||lat>-1?fmt[fmt.length-1]:"@"];switch(fmt.length){case 1:fmt=lat>-1?["General","General","General",fmt[0]]:[fmt[0],fmt[0],fmt[0],"@"];break;case 2:fmt=lat>-1?[fmt[0],fmt[0],fmt[0],fmt[1]]:[fmt[0],fmt[1],fmt[0],"@"];break;case 3:fmt=lat>-1?[fmt[0],fmt[1],fmt[0],fmt[2]]:[fmt[0],fmt[1],fmt[2],"@"];break;case 4:break}var ff=v>0?fmt[0]:v<0?fmt[1]:fmt[2];if(fmt[0].indexOf("[")===-1&&fmt[1].indexOf("[")===-1)return[l,ff];if(fmt[0].match(/\[[=<>]/)!=null||fmt[1].match(/\[[=<>]/)!=null){var m1=fmt[0].match(cfregex2),m2=fmt[1].match(cfregex2);return chkcond(v,m1)?[l,fmt[0]]:chkcond(v,m2)?[l,fmt[1]]:[l,fmt[m1!=null&&m2!=null?2:1]]}return[l,ff]}function SSF_format(fmt,v,o){o==null&&(o={});var sfmt="";switch(typeof fmt){case"string":fmt=="m/d/yy"&&o.dateNF?sfmt=o.dateNF:sfmt=fmt;break;case"number":fmt==14&&o.dateNF?sfmt=o.dateNF:sfmt=(o.table!=null?o.table:table_fmt)[fmt],sfmt==null&&(sfmt=o.table&&o.table[SSF_default_map[fmt]]||table_fmt[SSF_default_map[fmt]]),sfmt==null&&(sfmt=SSF_default_str[fmt]||"General");break}if(SSF_isgeneral(sfmt,0))return SSF_general(v,o);v instanceof Date&&(v=datenum_local(v,o.date1904));var f=choose_fmt(sfmt,v);if(SSF_isgeneral(f[1]))return SSF_general(v,o);if(v===!0)v="TRUE";else if(v===!1)v="FALSE";else if(v===""||v==null)return"";return eval_fmt(f[1],v,o,f[0])}function SSF_load(fmt,idx){if(typeof idx!="number"){idx=+idx||-1;for(var i=0;i<392;++i){if(table_fmt[i]==null){idx<0&&(idx=i);continue}if(table_fmt[i]==fmt){idx=i;break}}idx<0&&(idx=391)}return table_fmt[idx]=fmt,idx}function make_ssf(){table_fmt=SSF_init_table()}var SSFImplicit={"5":'"$"#,##0_);\\("$"#,##0\\)',"6":'"$"#,##0_);[Red]\\("$"#,##0\\)',"7":'"$"#,##0.00_);\\("$"#,##0.00\\)',"8":'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',"23":"General","24":"General","25":"General","26":"General","27":"m/d/yy","28":"m/d/yy","29":"m/d/yy","30":"m/d/yy","31":"m/d/yy","32":"h:mm:ss","33":"h:mm:ss","34":"h:mm:ss","35":"h:mm:ss","36":"m/d/yy","41":'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',"42":'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',"43":'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',"44":'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',"50":"m/d/yy","51":"m/d/yy","52":"m/d/yy","53":"m/d/yy","54":"m/d/yy","55":"m/d/yy","56":"m/d/yy","57":"m/d/yy","58":"m/d/yy","59":"0","60":"0.00","61":"#,##0","62":"#,##0.00","63":'"$"#,##0_);\\("$"#,##0\\)',"64":'"$"#,##0_);[Red]\\("$"#,##0\\)',"65":'"$"#,##0.00_);\\("$"#,##0.00\\)',"66":'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',"67":"0%","68":"0.00%","69":"# ?/?","70":"# ??/??","71":"m/d/yy","72":"m/d/yy","73":"d-mmm-yy","74":"d-mmm","75":"mmm-yy","76":"h:mm","77":"h:mm:ss","78":"m/d/yy h:mm","79":"mm:ss","80":"[h]:mm:ss","81":"mmss.0"},dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(dateNF){var fmt=typeof dateNF=="number"?table_fmt[dateNF]:dateNF;return fmt=fmt.replace(dateNFregex,"(\\d+)"),new RegExp("^"+fmt+"$")}function dateNF_fix(str,dateNF,match){var Y=-1,m=-1,d=-1,H=-1,M=-1,S=-1;(dateNF.match(dateNFregex)||[]).forEach(function(n,i){var v=parseInt(match[i+1],10);switch(n.toLowerCase().charAt(0)){case"y":Y=v;break;case"d":d=v;break;case"h":H=v;break;case"s":S=v;break;case"m":H>=0?M=v:m=v;break}}),S>=0&&M==-1&&m>=0&&(M=m,m=-1);var datestr=(""+(Y>=0?Y:new Date().getFullYear())).slice(-4)+"-"+("00"+(m>=1?m:1)).slice(-2)+"-"+("00"+(d>=1?d:1)).slice(-2);datestr.length==7&&(datestr="0"+datestr),datestr.length==8&&(datestr="20"+datestr);var timestr=("00"+(H>=0?H:0)).slice(-2)+":"+("00"+(M>=0?M:0)).slice(-2)+":"+("00"+(S>=0?S:0)).slice(-2);return H==-1&&M==-1&&S==-1?datestr:Y==-1&&m==-1&&d==-1?timestr:datestr+"T"+timestr}var CRC32=function(){var CRC322={};CRC322.version="1.2.0";function signed_crc_table(){for(var c=0,table=new Array(256),n=0;n!=256;++n)c=n,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,c=c&1?-306674912^c>>>1:c>>>1,table[n]=c;return typeof Int32Array!="undefined"?new Int32Array(table):table}var T0=signed_crc_table();function slice_by_16_tables(T){var c=0,v=0,n=0,table=typeof Int32Array!="undefined"?new Int32Array(4096):new Array(4096);for(n=0;n!=256;++n)table[n]=T[n];for(n=0;n!=256;++n)for(v=T[n],c=256+n;c<4096;c+=256)v=table[c]=v>>>8^T[v&255];var out=[];for(n=1;n!=16;++n)out[n-1]=typeof Int32Array!="undefined"?table.subarray(n*256,n*256+256):table.slice(n*256,n*256+256);return out}var TT=slice_by_16_tables(T0),T1=TT[0],T2=TT[1],T3=TT[2],T4=TT[3],T5=TT[4],T6=TT[5],T7=TT[6],T8=TT[7],T9=TT[8],Ta=TT[9],Tb=TT[10],Tc=TT[11],Td=TT[12],Te=TT[13],Tf=TT[14];function crc32_bstr(bstr,seed){for(var C=seed^-1,i=0,L=bstr.length;i<L;)C=C>>>8^T0[(C^bstr.charCodeAt(i++))&255];return~C}function crc32_buf(B,seed){for(var C=seed^-1,L=B.length-15,i=0;i<L;)C=Tf[B[i++]^C&255]^Te[B[i++]^C>>8&255]^Td[B[i++]^C>>16&255]^Tc[B[i++]^C>>>24]^Tb[B[i++]]^Ta[B[i++]]^T9[B[i++]]^T8[B[i++]]^T7[B[i++]]^T6[B[i++]]^T5[B[i++]]^T4[B[i++]]^T3[B[i++]]^T2[B[i++]]^T1[B[i++]]^T0[B[i++]];for(L+=15;i<L;)C=C>>>8^T0[(C^B[i++])&255];return~C}function crc32_str(str,seed){for(var C=seed^-1,i=0,L=str.length,c=0,d=0;i<L;)c=str.charCodeAt(i++),c<128?C=C>>>8^T0[(C^c)&255]:c<2048?(C=C>>>8^T0[(C^(192|c>>6&31))&255],C=C>>>8^T0[(C^(128|c&63))&255]):c>=55296&&c<57344?(c=(c&1023)+64,d=str.charCodeAt(i++)&1023,C=C>>>8^T0[(C^(240|c>>8&7))&255],C=C>>>8^T0[(C^(128|c>>2&63))&255],C=C>>>8^T0[(C^(128|d>>6&15|(c&3)<<4))&255],C=C>>>8^T0[(C^(128|d&63))&255]):(C=C>>>8^T0[(C^(224|c>>12&15))&255],C=C>>>8^T0[(C^(128|c>>6&63))&255],C=C>>>8^T0[(C^(128|c&63))&255]);return~C}return CRC322.table=T0,CRC322.bstr=crc32_bstr,CRC322.buf=crc32_buf,CRC322.str=crc32_str,CRC322}(),CFB=function(){var exports2={};exports2.version="1.2.1";function namecmp(l,r){for(var L=l.split("/"),R=r.split("/"),i2=0,c=0,Z=Math.min(L.length,R.length);i2<Z;++i2){if(c=L[i2].length-R[i2].length)return c;if(L[i2]!=R[i2])return L[i2]<R[i2]?-1:1}return L.length-R.length}function dirname(p){if(p.charAt(p.length-1)=="/")return p.slice(0,-1).indexOf("/")===-1?p:dirname(p.slice(0,-1));var c=p.lastIndexOf("/");return c===-1?p:p.slice(0,c+1)}function filename(p){if(p.charAt(p.length-1)=="/")return filename(p.slice(0,-1));var c=p.lastIndexOf("/");return c===-1?p:p.slice(c+1)}function write_dos_date(buf,date){typeof date=="string"&&(date=new Date(date));var hms=date.getHours();hms=hms<<6|date.getMinutes(),hms=hms<<5|date.getSeconds()>>>1,buf.write_shift(2,hms);var ymd=date.getFullYear()-1980;ymd=ymd<<4|date.getMonth()+1,ymd=ymd<<5|date.getDate(),buf.write_shift(2,ymd)}function parse_dos_date(buf){var hms=buf.read_shift(2)&65535,ymd=buf.read_shift(2)&65535,val=new Date,d=ymd&31;ymd>>>=5;var m=ymd&15;ymd>>>=4,val.setMilliseconds(0),val.setFullYear(ymd+1980),val.setMonth(m-1),val.setDate(d);var S=hms&31;hms>>>=5;var M=hms&63;return hms>>>=6,val.setHours(hms),val.setMinutes(M),val.setSeconds(S<<1),val}function parse_extra_field(blob){prep_blob(blob,0);for(var o={},flags=0;blob.l<=blob.length-4;){var type=blob.read_shift(2),sz=blob.read_shift(2),tgt=blob.l+sz,p={};switch(type){case 21589:flags=blob.read_shift(1),flags&1&&(p.mtime=blob.read_shift(4)),sz>5&&(flags&2&&(p.atime=blob.read_shift(4)),flags&4&&(p.ctime=blob.read_shift(4))),p.mtime&&(p.mt=new Date(p.mtime*1e3));break}blob.l=tgt,o[type]=p}return o}var fs;function get_fs(){return fs||(fs={})}function parse3(file,options){if(file[0]==80&&file[1]==75)return parse_zip2(file,options);if((file[0]|32)==109&&(file[1]|32)==105)return parse_mad(file,options);if(file.length<512)throw new Error("CFB file size "+file.length+" < 512");var mver=3,ssz=512,nmfs=0,difat_sec_cnt=0,dir_start=0,minifat_start=0,difat_start=0,fat_addrs=[],blob=file.slice(0,512);prep_blob(blob,0);var mv=check_get_mver(blob);switch(mver=mv[0],mver){case 3:ssz=512;break;case 4:ssz=4096;break;case 0:if(mv[1]==0)return parse_zip2(file,options);default:throw new Error("Major Version: Expected 3 or 4 saw "+mver)}ssz!==512&&(blob=file.slice(0,ssz),prep_blob(blob,28));var header=file.slice(0,ssz);check_shifts(blob,mver);var dir_cnt=blob.read_shift(4,"i");if(mver===3&&dir_cnt!==0)throw new Error("# Directory Sectors: Expected 0 saw "+dir_cnt);blob.l+=4,dir_start=blob.read_shift(4,"i"),blob.l+=4,blob.chk("00100000","Mini Stream Cutoff Size: "),minifat_start=blob.read_shift(4,"i"),nmfs=blob.read_shift(4,"i"),difat_start=blob.read_shift(4,"i"),difat_sec_cnt=blob.read_shift(4,"i");for(var q2=-1,j=0;j<109&&(q2=blob.read_shift(4,"i"),!(q2<0));++j)fat_addrs[j]=q2;var sectors=sectorify(file,ssz);sleuth_fat(difat_start,difat_sec_cnt,sectors,ssz,fat_addrs);var sector_list=make_sector_list(sectors,dir_start,fat_addrs,ssz);sector_list[dir_start].name="!Directory",nmfs>0&&minifat_start!==ENDOFCHAIN&&(sector_list[minifat_start].name="!MiniFAT"),sector_list[fat_addrs[0]].name="!FAT",sector_list.fat_addrs=fat_addrs,sector_list.ssz=ssz;var files={},Paths=[],FileIndex=[],FullPaths=[];read_directory(dir_start,sector_list,sectors,Paths,nmfs,files,FileIndex,minifat_start),build_full_paths(FileIndex,FullPaths,Paths),Paths.shift();var o={FileIndex,FullPaths};return options&&options.raw&&(o.raw={header,sectors}),o}function check_get_mver(blob){if(blob[blob.l]==80&&blob[blob.l+1]==75)return[0,0];blob.chk(HEADER_SIGNATURE,"Header Signature: "),blob.l+=16;var mver=blob.read_shift(2,"u");return[blob.read_shift(2,"u"),mver]}function check_shifts(blob,mver){var shift=9;switch(blob.l+=2,shift=blob.read_shift(2)){case 9:if(mver!=3)throw new Error("Sector Shift: Expected 9 saw "+shift);break;case 12:if(mver!=4)throw new Error("Sector Shift: Expected 12 saw "+shift);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+shift)}blob.chk("0600","Mini Sector Shift: "),blob.chk("000000000000","Reserved: ")}function sectorify(file,ssz){for(var nsectors=Math.ceil(file.length/ssz)-1,sectors=[],i2=1;i2<nsectors;++i2)sectors[i2-1]=file.slice(i2*ssz,(i2+1)*ssz);return sectors[nsectors-1]=file.slice(nsectors*ssz),sectors}function build_full_paths(FI,FP,Paths){for(var i2=0,L=0,R=0,C=0,j=0,pl=Paths.length,dad=[],q2=[];i2<pl;++i2)dad[i2]=q2[i2]=i2,FP[i2]=Paths[i2];for(;j<q2.length;++j)i2=q2[j],L=FI[i2].L,R=FI[i2].R,C=FI[i2].C,dad[i2]===i2&&(L!==-1&&dad[L]!==L&&(dad[i2]=dad[L]),R!==-1&&dad[R]!==R&&(dad[i2]=dad[R])),C!==-1&&(dad[C]=i2),L!==-1&&i2!=dad[i2]&&(dad[L]=dad[i2],q2.lastIndexOf(L)<j&&q2.push(L)),R!==-1&&i2!=dad[i2]&&(dad[R]=dad[i2],q2.lastIndexOf(R)<j&&q2.push(R));for(i2=1;i2<pl;++i2)dad[i2]===i2&&(R!==-1&&dad[R]!==R?dad[i2]=dad[R]:L!==-1&&dad[L]!==L&&(dad[i2]=dad[L]));for(i2=1;i2<pl;++i2)if(FI[i2].type!==0){if(j=i2,j!=dad[j])do j=dad[j],FP[i2]=FP[j]+"/"+FP[i2];while(j!==0&&dad[j]!==-1&&j!=dad[j]);dad[i2]=-1}for(FP[0]+="/",i2=1;i2<pl;++i2)FI[i2].type!==2&&(FP[i2]+="/")}function get_mfat_entry(entry,payload,mini){for(var start2=entry.start,size=entry.size,o=[],idx=start2;mini&&size>0&&idx>=0;)o.push(payload.slice(idx*MSSZ,idx*MSSZ+MSSZ)),size-=MSSZ,idx=__readInt32LE(mini,idx*4);return o.length===0?new_buf(0):bconcat(o).slice(0,entry.size)}function sleuth_fat(idx,cnt,sectors,ssz,fat_addrs){var q2=ENDOFCHAIN;if(idx===ENDOFCHAIN){if(cnt!==0)throw new Error("DIFAT chain shorter than expected")}else if(idx!==-1){var sector=sectors[idx],m=(ssz>>>2)-1;if(!sector)return;for(var i2=0;i2<m&&(q2=__readInt32LE(sector,i2*4))!==ENDOFCHAIN;++i2)fat_addrs.push(q2);sleuth_fat(__readInt32LE(sector,ssz-4),cnt-1,sectors,ssz,fat_addrs)}}function get_sector_list(sectors,start2,fat_addrs,ssz,chkd){var buf=[],buf_chain=[];chkd||(chkd=[]);var modulus=ssz-1,j=0,jj=0;for(j=start2;j>=0;){chkd[j]=!0,buf[buf.length]=j,buf_chain.push(sectors[j]);var addr=fat_addrs[Math.floor(j*4/ssz)];if(jj=j*4&modulus,ssz<4+jj)throw new Error("FAT boundary crossed: "+j+" 4 "+ssz);if(!sectors[addr])break;j=__readInt32LE(sectors[addr],jj)}return{nodes:buf,data:__toBuffer([buf_chain])}}function make_sector_list(sectors,dir_start,fat_addrs,ssz){var sl=sectors.length,sector_list=[],chkd=[],buf=[],buf_chain=[],modulus=ssz-1,i2=0,j=0,k=0,jj=0;for(i2=0;i2<sl;++i2)if(buf=[],k=i2+dir_start,k>=sl&&(k-=sl),!chkd[k]){buf_chain=[];var seen=[];for(j=k;j>=0;){seen[j]=!0,chkd[j]=!0,buf[buf.length]=j,buf_chain.push(sectors[j]);var addr=fat_addrs[Math.floor(j*4/ssz)];if(jj=j*4&modulus,ssz<4+jj)throw new Error("FAT boundary crossed: "+j+" 4 "+ssz);if(!sectors[addr]||(j=__readInt32LE(sectors[addr],jj),seen[j]))break}sector_list[k]={nodes:buf,data:__toBuffer([buf_chain])}}return sector_list}function read_directory(dir_start,sector_list,sectors,Paths,nmfs,files,FileIndex,mini){for(var minifat_store=0,pl=Paths.length?2:0,sector=sector_list[dir_start].data,i2=0,namelen=0,name;i2<sector.length;i2+=128){var blob=sector.slice(i2,i2+128);prep_blob(blob,64),namelen=blob.read_shift(2),name=__utf16le(blob,0,namelen-pl),Paths.push(name);var o={name,type:blob.read_shift(1),color:blob.read_shift(1),L:blob.read_shift(4,"i"),R:blob.read_shift(4,"i"),C:blob.read_shift(4,"i"),clsid:blob.read_shift(16),state:blob.read_shift(4,"i"),start:0,size:0},ctime=blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2);ctime!==0&&(o.ct=read_date(blob,blob.l-8));var mtime=blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2);mtime!==0&&(o.mt=read_date(blob,blob.l-8)),o.start=blob.read_shift(4,"i"),o.size=blob.read_shift(4,"i"),o.size<0&&o.start<0&&(o.size=o.type=0,o.start=ENDOFCHAIN,o.name=""),o.type===5?(minifat_store=o.start,nmfs>0&&minifat_store!==ENDOFCHAIN&&(sector_list[minifat_store].name="!StreamData")):o.size>=4096?(o.storage="fat",sector_list[o.start]===void 0&&(sector_list[o.start]=get_sector_list(sectors,o.start,sector_list.fat_addrs,sector_list.ssz)),sector_list[o.start].name=o.name,o.content=sector_list[o.start].data.slice(0,o.size)):(o.storage="minifat",o.size<0?o.size=0:minifat_store!==ENDOFCHAIN&&o.start!==ENDOFCHAIN&&sector_list[minifat_store]&&(o.content=get_mfat_entry(o,sector_list[minifat_store].data,(sector_list[mini]||{}).data))),o.content&&prep_blob(o.content,0),files[name]=o,FileIndex.push(o)}}function read_date(blob,offset){return new Date((__readUInt32LE(blob,offset+4)/1e7*Math.pow(2,32)+__readUInt32LE(blob,offset)/1e7-11644473600)*1e3)}function read_file(filename2,options){return get_fs(),parse3(fs.readFileSync(filename2),options)}function read(blob,options){var type=options&&options.type;switch(type||has_buf&&Buffer.isBuffer(blob)&&(type="buffer"),type||"base64"){case"file":return read_file(blob,options);case"base64":return parse3(s2a(Base64_decode(blob)),options);case"binary":return parse3(s2a(blob),options)}return parse3(blob,options)}function init_cfb(cfb,opts){var o=opts||{},root=o.root||"Root Entry";if(cfb.FullPaths||(cfb.FullPaths=[]),cfb.FileIndex||(cfb.FileIndex=[]),cfb.FullPaths.length!==cfb.FileIndex.length)throw new Error("inconsistent CFB structure");cfb.FullPaths.length===0&&(cfb.FullPaths[0]=root+"/",cfb.FileIndex[0]={name:root,type:5}),o.CLSID&&(cfb.FileIndex[0].clsid=o.CLSID),seed_cfb(cfb)}function seed_cfb(cfb){var nm="Sh33tJ5";if(!CFB.find(cfb,"/"+nm)){var p=new_buf(4);p[0]=55,p[1]=p[3]=50,p[2]=54,cfb.FileIndex.push({name:nm,type:2,content:p,size:4,L:69,R:69,C:69}),cfb.FullPaths.push(cfb.FullPaths[0]+nm),rebuild_cfb(cfb)}}function rebuild_cfb(cfb,f){init_cfb(cfb);for(var gc=!1,s=!1,i2=cfb.FullPaths.length-1;i2>=0;--i2){var _file=cfb.FileIndex[i2];switch(_file.type){case 0:s?gc=!0:(cfb.FileIndex.pop(),cfb.FullPaths.pop());break;case 1:case 2:case 5:s=!0,isNaN(_file.R*_file.L*_file.C)&&(gc=!0),_file.R>-1&&_file.L>-1&&_file.R==_file.L&&(gc=!0);break;default:gc=!0;break}}if(!(!gc&&!f)){var now2=new Date(1987,1,19),j=0,fullPaths=Object.create?Object.create(null):{},data=[];for(i2=0;i2<cfb.FullPaths.length;++i2)fullPaths[cfb.FullPaths[i2]]=!0,cfb.FileIndex[i2].type!==0&&data.push([cfb.FullPaths[i2],cfb.FileIndex[i2]]);for(i2=0;i2<data.length;++i2){var dad=dirname(data[i2][0]);s=fullPaths[dad],s||(data.push([dad,{name:filename(dad).replace("/",""),type:1,clsid:HEADER_CLSID,ct:now2,mt:now2,content:null}]),fullPaths[dad]=!0)}for(data.sort(function(x,y){return namecmp(x[0],y[0])}),cfb.FullPaths=[],cfb.FileIndex=[],i2=0;i2<data.length;++i2)cfb.FullPaths[i2]=data[i2][0],cfb.FileIndex[i2]=data[i2][1];for(i2=0;i2<data.length;++i2){var elt=cfb.FileIndex[i2],nm=cfb.FullPaths[i2];if(elt.name=filename(nm).replace("/",""),elt.L=elt.R=elt.C=-(elt.color=1),elt.size=elt.content?elt.content.length:0,elt.start=0,elt.clsid=elt.clsid||HEADER_CLSID,i2===0)elt.C=data.length>1?1:-1,elt.size=0,elt.type=5;else if(nm.slice(-1)=="/"){for(j=i2+1;j<data.length&&dirname(cfb.FullPaths[j])!=nm;++j);for(elt.C=j>=data.length?-1:j,j=i2+1;j<data.length&&dirname(cfb.FullPaths[j])!=dirname(nm);++j);elt.R=j>=data.length?-1:j,elt.type=1}else dirname(cfb.FullPaths[i2+1]||"")==dirname(nm)&&(elt.R=i2+1),elt.type=2}}}function _write(cfb,options){var _opts=options||{};if(_opts.fileType=="mad")return write_mad(cfb,_opts);switch(rebuild_cfb(cfb),_opts.fileType){case"zip":return write_zip(cfb,_opts)}var L=function(cfb2){for(var mini_size=0,fat_size=0,i3=0;i3<cfb2.FileIndex.length;++i3){var file2=cfb2.FileIndex[i3];if(!!file2.content){var flen2=file2.content.length;flen2>0&&(flen2<4096?mini_size+=flen2+63>>6:fat_size+=flen2+511>>9)}}for(var dir_cnt=cfb2.FullPaths.length+3>>2,mini_cnt=mini_size+7>>3,mfat_cnt=mini_size+127>>7,fat_base=mini_cnt+fat_size+dir_cnt+mfat_cnt,fat_cnt=fat_base+127>>7,difat_cnt=fat_cnt<=109?0:Math.ceil((fat_cnt-109)/127);fat_base+fat_cnt+difat_cnt+127>>7>fat_cnt;)difat_cnt=++fat_cnt<=109?0:Math.ceil((fat_cnt-109)/127);var L2=[1,difat_cnt,fat_cnt,mfat_cnt,dir_cnt,fat_size,mini_size,0];return cfb2.FileIndex[0].size=mini_size<<6,L2[7]=(cfb2.FileIndex[0].start=L2[0]+L2[1]+L2[2]+L2[3]+L2[4]+L2[5])+(L2[6]+7>>3),L2}(cfb),o=new_buf(L[7]<<9),i2=0,T=0;{for(i2=0;i2<8;++i2)o.write_shift(1,HEADER_SIG[i2]);for(i2=0;i2<8;++i2)o.write_shift(2,0);for(o.write_shift(2,62),o.write_shift(2,3),o.write_shift(2,65534),o.write_shift(2,9),o.write_shift(2,6),i2=0;i2<3;++i2)o.write_shift(2,0);for(o.write_shift(4,0),o.write_shift(4,L[2]),o.write_shift(4,L[0]+L[1]+L[2]+L[3]-1),o.write_shift(4,0),o.write_shift(4,1<<12),o.write_shift(4,L[3]?L[0]+L[1]+L[2]-1:ENDOFCHAIN),o.write_shift(4,L[3]),o.write_shift(-4,L[1]?L[0]-1:ENDOFCHAIN),o.write_shift(4,L[1]),i2=0;i2<109;++i2)o.write_shift(-4,i2<L[2]?L[1]+i2:-1)}if(L[1])for(T=0;T<L[1];++T){for(;i2<236+T*127;++i2)o.write_shift(-4,i2<L[2]?L[1]+i2:-1);o.write_shift(-4,T===L[1]-1?ENDOFCHAIN:T+1)}var chainit=function(w){for(T+=w;i2<T-1;++i2)o.write_shift(-4,i2+1);w&&(++i2,o.write_shift(-4,ENDOFCHAIN))};for(T=i2=0,T+=L[1];i2<T;++i2)o.write_shift(-4,consts.DIFSECT);for(T+=L[2];i2<T;++i2)o.write_shift(-4,consts.FATSECT);chainit(L[3]),chainit(L[4]);for(var j=0,flen=0,file=cfb.FileIndex[0];j<cfb.FileIndex.length;++j)file=cfb.FileIndex[j],!!file.content&&(flen=file.content.length,!(flen<4096)&&(file.start=T,chainit(flen+511>>9)));for(chainit(L[6]+7>>3);o.l&511;)o.write_shift(-4,consts.ENDOFCHAIN);for(T=i2=0,j=0;j<cfb.FileIndex.length;++j)file=cfb.FileIndex[j],!!file.content&&(flen=file.content.length,!(!flen||flen>=4096)&&(file.start=T,chainit(flen+63>>6)));for(;o.l&511;)o.write_shift(-4,consts.ENDOFCHAIN);for(i2=0;i2<L[4]<<2;++i2){var nm=cfb.FullPaths[i2];if(!nm||nm.length===0){for(j=0;j<17;++j)o.write_shift(4,0);for(j=0;j<3;++j)o.write_shift(4,-1);for(j=0;j<12;++j)o.write_shift(4,0);continue}file=cfb.FileIndex[i2],i2===0&&(file.start=file.size?file.start-1:ENDOFCHAIN);var _nm=i2===0&&_opts.root||file.name;if(flen=2*(_nm.length+1),o.write_shift(64,_nm,"utf16le"),o.write_shift(2,flen),o.write_shift(1,file.type),o.write_shift(1,file.color),o.write_shift(-4,file.L),o.write_shift(-4,file.R),o.write_shift(-4,file.C),file.clsid)o.write_shift(16,file.clsid,"hex");else for(j=0;j<4;++j)o.write_shift(4,0);o.write_shift(4,file.state||0),o.write_shift(4,0),o.write_shift(4,0),o.write_shift(4,0),o.write_shift(4,0),o.write_shift(4,file.start),o.write_shift(4,file.size),o.write_shift(4,0)}for(i2=1;i2<cfb.FileIndex.length;++i2)if(file=cfb.FileIndex[i2],file.size>=4096)if(o.l=file.start+1<<9,has_buf&&Buffer.isBuffer(file.content))file.content.copy(o,o.l,0,file.size),o.l+=file.size+511&-512;else{for(j=0;j<file.size;++j)o.write_shift(1,file.content[j]);for(;j&511;++j)o.write_shift(1,0)}for(i2=1;i2<cfb.FileIndex.length;++i2)if(file=cfb.FileIndex[i2],file.size>0&&file.size<4096)if(has_buf&&Buffer.isBuffer(file.content))file.content.copy(o,o.l,0,file.size),o.l+=file.size+63&-64;else{for(j=0;j<file.size;++j)o.write_shift(1,file.content[j]);for(;j&63;++j)o.write_shift(1,0)}if(has_buf)o.l=o.length;else for(;o.l<o.length;)o.write_shift(1,0);return o}function find(cfb,path){var UCFullPaths=cfb.FullPaths.map(function(x){return x.toUpperCase()}),UCPaths=UCFullPaths.map(function(x){var y=x.split("/");return y[y.length-(x.slice(-1)=="/"?2:1)]}),k=!1;path.charCodeAt(0)===47?(k=!0,path=UCFullPaths[0].slice(0,-1)+path):k=path.indexOf("/")!==-1;var UCPath=path.toUpperCase(),w=k===!0?UCFullPaths.indexOf(UCPath):UCPaths.indexOf(UCPath);if(w!==-1)return cfb.FileIndex[w];var m=!UCPath.match(chr1);for(UCPath=UCPath.replace(chr0,""),m&&(UCPath=UCPath.replace(chr1,"!")),w=0;w<UCFullPaths.length;++w)if((m?UCFullPaths[w].replace(chr1,"!"):UCFullPaths[w]).replace(chr0,"")==UCPath||(m?UCPaths[w].replace(chr1,"!"):UCPaths[w]).replace(chr0,"")==UCPath)return cfb.FileIndex[w];return null}var MSSZ=64,ENDOFCHAIN=-2,HEADER_SIGNATURE="d0cf11e0a1b11ae1",HEADER_SIG=[208,207,17,224,161,177,26,225],HEADER_CLSID="00000000000000000000000000000000",consts={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN,FREESECT:-1,HEADER_SIGNATURE,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function write_file(cfb,filename2,options){get_fs();var o=_write(cfb,options);fs.writeFileSync(filename2,o)}function a2s2(o){for(var out=new Array(o.length),i2=0;i2<o.length;++i2)out[i2]=String.fromCharCode(o[i2]);return out.join("")}function write(cfb,options){var o=_write(cfb,options);switch(options&&options.type||"buffer"){case"file":return get_fs(),fs.writeFileSync(options.filename,o),o;case"binary":return typeof o=="string"?o:a2s2(o);case"base64":return Base64_encode(typeof o=="string"?o:a2s2(o));case"buffer":if(has_buf)return Buffer.isBuffer(o)?o:Buffer_from(o);case"array":return typeof o=="string"?s2a(o):o}return o}var _zlib;function use_zlib(zlib){try{var InflateRaw=zlib.InflateRaw,InflRaw=new InflateRaw;if(InflRaw._processChunk(new Uint8Array([3,0]),InflRaw._finishFlushFlag),InflRaw.bytesRead)_zlib=zlib;else throw new Error("zlib does not expose bytesRead")}catch(e){console.error("cannot use native zlib: "+(e.message||e))}}function _inflateRawSync(payload,usz){if(!_zlib)return _inflate(payload,usz);var InflateRaw=_zlib.InflateRaw,InflRaw=new InflateRaw,out=InflRaw._processChunk(payload.slice(payload.l),InflRaw._finishFlushFlag);return payload.l+=InflRaw.bytesRead,out}function _deflateRawSync(payload){return _zlib?_zlib.deflateRawSync(payload):_deflate(payload)}var CLEN_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],LEN_LN=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],DST_LN=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function bit_swap_8(n){var t=(n<<1|n<<11)&139536|(n<<5|n<<15)&558144;return(t>>16|t>>8|t)&255}for(var use_typed_arrays=typeof Uint8Array!="undefined",bitswap8=use_typed_arrays?new Uint8Array(1<<8):[],q=0;q<1<<8;++q)bitswap8[q]=bit_swap_8(q);function bit_swap_n(n,b){var rev=bitswap8[n&255];return b<=8?rev>>>8-b:(rev=rev<<8|bitswap8[n>>8&255],b<=16?rev>>>16-b:(rev=rev<<8|bitswap8[n>>16&255],rev>>>24-b))}function read_bits_2(buf,bl){var w=bl&7,h=bl>>>3;return(buf[h]|(w<=6?0:buf[h+1]<<8))>>>w&3}function read_bits_3(buf,bl){var w=bl&7,h=bl>>>3;return(buf[h]|(w<=5?0:buf[h+1]<<8))>>>w&7}function read_bits_4(buf,bl){var w=bl&7,h=bl>>>3;return(buf[h]|(w<=4?0:buf[h+1]<<8))>>>w&15}function read_bits_5(buf,bl){var w=bl&7,h=bl>>>3;return(buf[h]|(w<=3?0:buf[h+1]<<8))>>>w&31}function read_bits_7(buf,bl){var w=bl&7,h=bl>>>3;return(buf[h]|(w<=1?0:buf[h+1]<<8))>>>w&127}function read_bits_n(buf,bl,n){var w=bl&7,h=bl>>>3,f=(1<<n)-1,v=buf[h]>>>w;return n<8-w||(v|=buf[h+1]<<8-w,n<16-w)||(v|=buf[h+2]<<16-w,n<24-w)||(v|=buf[h+3]<<24-w),v&f}function write_bits_3(buf,bl,v){var w=bl&7,h=bl>>>3;return w<=5?buf[h]|=(v&7)<<w:(buf[h]|=v<<w&255,buf[h+1]=(v&7)>>8-w),bl+3}function write_bits_1(buf,bl,v){var w=bl&7,h=bl>>>3;return v=(v&1)<<w,buf[h]|=v,bl+1}function write_bits_8(buf,bl,v){var w=bl&7,h=bl>>>3;return v<<=w,buf[h]|=v&255,v>>>=8,buf[h+1]=v,bl+8}function write_bits_16(buf,bl,v){var w=bl&7,h=bl>>>3;return v<<=w,buf[h]|=v&255,v>>>=8,buf[h+1]=v&255,buf[h+2]=v>>>8,bl+16}function realloc(b,sz){var L=b.length,M=2*L>sz?2*L:sz+5,i2=0;if(L>=sz)return b;if(has_buf){var o=new_unsafe_buf(M);if(b.copy)b.copy(o);else for(;i2<b.length;++i2)o[i2]=b[i2];return o}else if(use_typed_arrays){var a=new Uint8Array(M);if(a.set)a.set(b);else for(;i2<L;++i2)a[i2]=b[i2];return a}return b.length=M,b}function zero_fill_array(n){for(var o=new Array(n),i2=0;i2<n;++i2)o[i2]=0;return o}function build_tree(clens,cmap,MAX){var maxlen=1,w=0,i2=0,j=0,ccode=0,L=clens.length,bl_count=use_typed_arrays?new Uint16Array(32):zero_fill_array(32);for(i2=0;i2<32;++i2)bl_count[i2]=0;for(i2=L;i2<MAX;++i2)clens[i2]=0;L=clens.length;var ctree=use_typed_arrays?new Uint16Array(L):zero_fill_array(L);for(i2=0;i2<L;++i2)bl_count[w=clens[i2]]++,maxlen<w&&(maxlen=w),ctree[i2]=0;for(bl_count[0]=0,i2=1;i2<=maxlen;++i2)bl_count[i2+16]=ccode=ccode+bl_count[i2-1]<<1;for(i2=0;i2<L;++i2)ccode=clens[i2],ccode!=0&&(ctree[i2]=bl_count[ccode+16]++);var cleni=0;for(i2=0;i2<L;++i2)if(cleni=clens[i2],cleni!=0)for(ccode=bit_swap_n(ctree[i2],maxlen)>>maxlen-cleni,j=(1<<maxlen+4-cleni)-1;j>=0;--j)cmap[ccode|j<<cleni]=cleni&15|i2<<4;return maxlen}var fix_lmap=use_typed_arrays?new Uint16Array(512):zero_fill_array(512),fix_dmap=use_typed_arrays?new Uint16Array(32):zero_fill_array(32);if(!use_typed_arrays){for(var i=0;i<512;++i)fix_lmap[i]=0;for(i=0;i<32;++i)fix_dmap[i]=0}(function(){for(var dlens=[],i2=0;i2<32;i2++)dlens.push(5);build_tree(dlens,fix_dmap,32);var clens=[];for(i2=0;i2<=143;i2++)clens.push(8);for(;i2<=255;i2++)clens.push(9);for(;i2<=279;i2++)clens.push(7);for(;i2<=287;i2++)clens.push(8);build_tree(clens,fix_lmap,288)})();var _deflateRaw=function(){for(var DST_LN_RE=use_typed_arrays?new Uint8Array(32768):[],j=0,k=0;j<DST_LN.length-1;++j)for(;k<DST_LN[j+1];++k)DST_LN_RE[k]=j;for(;k<32768;++k)DST_LN_RE[k]=29;var LEN_LN_RE=use_typed_arrays?new Uint8Array(259):[];for(j=0,k=0;j<LEN_LN.length-1;++j)for(;k<LEN_LN[j+1];++k)LEN_LN_RE[k]=j;function write_stored(data,out){for(var boff=0;boff<data.length;){var L=Math.min(65535,data.length-boff),h=boff+L==data.length;for(out.write_shift(1,+h),out.write_shift(2,L),out.write_shift(2,~L&65535);L-- >0;)out[out.l++]=data[boff++]}return out.l}function write_huff_fixed(data,out){for(var bl=0,boff=0,addrs=use_typed_arrays?new Uint16Array(32768):[];boff<data.length;){var L=Math.min(65535,data.length-boff);if(L<10){for(bl=write_bits_3(out,bl,+(boff+L==data.length)),bl&7&&(bl+=8-(bl&7)),out.l=bl/8|0,out.write_shift(2,L),out.write_shift(2,~L&65535);L-- >0;)out[out.l++]=data[boff++];bl=out.l*8;continue}bl=write_bits_3(out,bl,+(boff+L==data.length)+2);for(var hash=0;L-- >0;){var d=data[boff];hash=(hash<<5^d)&32767;var match=-1,mlen=0;if((match=addrs[hash])&&(match|=boff&~32767,match>boff&&(match-=32768),match<boff))for(;data[match+mlen]==data[boff+mlen]&&mlen<250;)++mlen;if(mlen>2){d=LEN_LN_RE[mlen],d<=22?bl=write_bits_8(out,bl,bitswap8[d+1]>>1)-1:(write_bits_8(out,bl,3),bl+=5,write_bits_8(out,bl,bitswap8[d-23]>>5),bl+=3);var len_eb=d<8?0:d-4>>2;len_eb>0&&(write_bits_16(out,bl,mlen-LEN_LN[d]),bl+=len_eb),d=DST_LN_RE[boff-match],bl=write_bits_8(out,bl,bitswap8[d]>>3),bl-=3;var dst_eb=d<4?0:d-2>>1;dst_eb>0&&(write_bits_16(out,bl,boff-match-DST_LN[d]),bl+=dst_eb);for(var q2=0;q2<mlen;++q2)addrs[hash]=boff&32767,hash=(hash<<5^data[boff])&32767,++boff;L-=mlen-1}else d<=143?d=d+48:bl=write_bits_1(out,bl,1),bl=write_bits_8(out,bl,bitswap8[d]),addrs[hash]=boff&32767,++boff}bl=write_bits_8(out,bl,0)-1}return out.l=(bl+7)/8|0,out.l}return function(data,out){return data.length<8?write_stored(data,out):write_huff_fixed(data,out)}}();function _deflate(data){var buf=new_buf(50+Math.floor(data.length*1.1)),off=_deflateRaw(data,buf);return buf.slice(0,off)}var dyn_lmap=use_typed_arrays?new Uint16Array(32768):zero_fill_array(32768),dyn_dmap=use_typed_arrays?new Uint16Array(32768):zero_fill_array(32768),dyn_cmap=use_typed_arrays?new Uint16Array(128):zero_fill_array(128),dyn_len_1=1,dyn_len_2=1;function dyn(data,boff){var _HLIT=read_bits_5(data,boff)+257;boff+=5;var _HDIST=read_bits_5(data,boff)+1;boff+=5;var _HCLEN=read_bits_4(data,boff)+4;boff+=4;for(var w=0,clens=use_typed_arrays?new Uint8Array(19):zero_fill_array(19),ctree=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],maxlen=1,bl_count=use_typed_arrays?new Uint8Array(8):zero_fill_array(8),next_code=use_typed_arrays?new Uint8Array(8):zero_fill_array(8),L=clens.length,i2=0;i2<_HCLEN;++i2)clens[CLEN_ORDER[i2]]=w=read_bits_3(data,boff),maxlen<w&&(maxlen=w),bl_count[w]++,boff+=3;var ccode=0;for(bl_count[0]=0,i2=1;i2<=maxlen;++i2)next_code[i2]=ccode=ccode+bl_count[i2-1]<<1;for(i2=0;i2<L;++i2)(ccode=clens[i2])!=0&&(ctree[i2]=next_code[ccode]++);var cleni=0;for(i2=0;i2<L;++i2)if(cleni=clens[i2],cleni!=0){ccode=bitswap8[ctree[i2]]>>8-cleni;for(var j=(1<<7-cleni)-1;j>=0;--j)dyn_cmap[ccode|j<<cleni]=cleni&7|i2<<3}var hcodes=[];for(maxlen=1;hcodes.length<_HLIT+_HDIST;)switch(ccode=dyn_cmap[read_bits_7(data,boff)],boff+=ccode&7,ccode>>>=3){case 16:for(w=3+read_bits_2(data,boff),boff+=2,ccode=hcodes[hcodes.length-1];w-- >0;)hcodes.push(ccode);break;case 17:for(w=3+read_bits_3(data,boff),boff+=3;w-- >0;)hcodes.push(0);break;case 18:for(w=11+read_bits_7(data,boff),boff+=7;w-- >0;)hcodes.push(0);break;default:hcodes.push(ccode),maxlen<ccode&&(maxlen=ccode);break}var h1=hcodes.slice(0,_HLIT),h2=hcodes.slice(_HLIT);for(i2=_HLIT;i2<286;++i2)h1[i2]=0;for(i2=_HDIST;i2<30;++i2)h2[i2]=0;return dyn_len_1=build_tree(h1,dyn_lmap,286),dyn_len_2=build_tree(h2,dyn_dmap,30),boff}function inflate(data,usz){if(data[0]==3&&!(data[1]&3))return[new_raw_buf(usz),2];for(var boff=0,header=0,outbuf=new_unsafe_buf(usz||1<<18),woff=0,OL=outbuf.length>>>0,max_len_1=0,max_len_2=0;(header&1)==0;){if(header=read_bits_3(data,boff),boff+=3,header>>>1==0){boff&7&&(boff+=8-(boff&7));var sz=data[boff>>>3]|data[(boff>>>3)+1]<<8;if(boff+=32,sz>0)for(!usz&&OL<woff+sz&&(outbuf=realloc(outbuf,woff+sz),OL=outbuf.length);sz-- >0;)outbuf[woff++]=data[boff>>>3],boff+=8;continue}else header>>1==1?(max_len_1=9,max_len_2=5):(boff=dyn(data,boff),max_len_1=dyn_len_1,max_len_2=dyn_len_2);for(;;){!usz&&OL<woff+32767&&(outbuf=realloc(outbuf,woff+32767),OL=outbuf.length);var bits=read_bits_n(data,boff,max_len_1),code=header>>>1==1?fix_lmap[bits]:dyn_lmap[bits];if(boff+=code&15,code>>>=4,(code>>>8&255)==0)outbuf[woff++]=code;else{if(code==256)break;code-=257;var len_eb=code<8?0:code-4>>2;len_eb>5&&(len_eb=0);var tgt=woff+LEN_LN[code];len_eb>0&&(tgt+=read_bits_n(data,boff,len_eb),boff+=len_eb),bits=read_bits_n(data,boff,max_len_2),code=header>>>1==1?fix_dmap[bits]:dyn_dmap[bits],boff+=code&15,code>>>=4;var dst_eb=code<4?0:code-2>>1,dst=DST_LN[code];for(dst_eb>0&&(dst+=read_bits_n(data,boff,dst_eb),boff+=dst_eb),!usz&&OL<tgt&&(outbuf=realloc(outbuf,tgt+100),OL=outbuf.length);woff<tgt;)outbuf[woff]=outbuf[woff-dst],++woff}}}return usz?[outbuf,boff+7>>>3]:[outbuf.slice(0,woff),boff+7>>>3]}function _inflate(payload,usz){var data=payload.slice(payload.l||0),out=inflate(data,usz);return payload.l+=out[1],out[0]}function warn_or_throw(wrn,msg){if(wrn)typeof console!="undefined"&&console.error(msg);else throw new Error(msg)}function parse_zip2(file,options){var blob=file;prep_blob(blob,0);var FileIndex=[],FullPaths=[],o={FileIndex,FullPaths};init_cfb(o,{root:options.root});for(var i2=blob.length-4;(blob[i2]!=80||blob[i2+1]!=75||blob[i2+2]!=5||blob[i2+3]!=6)&&i2>=0;)--i2;blob.l=i2+4,blob.l+=4;var fcnt=blob.read_shift(2);blob.l+=6;var start_cd=blob.read_shift(4);for(blob.l=start_cd,i2=0;i2<fcnt;++i2){blob.l+=20;var csz=blob.read_shift(4),usz=blob.read_shift(4),namelen=blob.read_shift(2),efsz=blob.read_shift(2),fcsz=blob.read_shift(2);blob.l+=8;var offset=blob.read_shift(4),EF=parse_extra_field(blob.slice(blob.l+namelen,blob.l+namelen+efsz));blob.l+=namelen+efsz+fcsz;var L=blob.l;blob.l=offset+4,parse_local_file(blob,csz,usz,o,EF),blob.l=L}return o}function parse_local_file(blob,csz,usz,o,EF){blob.l+=2;var flags=blob.read_shift(2),meth=blob.read_shift(2),date=parse_dos_date(blob);if(flags&8257)throw new Error("Unsupported ZIP encryption");for(var crc32=blob.read_shift(4),_csz=blob.read_shift(4),_usz=blob.read_shift(4),namelen=blob.read_shift(2),efsz=blob.read_shift(2),name="",i2=0;i2<namelen;++i2)name+=String.fromCharCode(blob[blob.l++]);if(efsz){var ef=parse_extra_field(blob.slice(blob.l,blob.l+efsz));(ef[21589]||{}).mt&&(date=ef[21589].mt),((EF||{})[21589]||{}).mt&&(date=EF[21589].mt)}blob.l+=efsz;var data=blob.slice(blob.l,blob.l+_csz);switch(meth){case 8:data=_inflateRawSync(blob,_usz);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+meth)}var wrn=!1;flags&8&&(crc32=blob.read_shift(4),crc32==134695760&&(crc32=blob.read_shift(4),wrn=!0),_csz=blob.read_shift(4),_usz=blob.read_shift(4)),_csz!=csz&&warn_or_throw(wrn,"Bad compressed size: "+csz+" != "+_csz),_usz!=usz&&warn_or_throw(wrn,"Bad uncompressed size: "+usz+" != "+_usz),cfb_add(o,name,data,{unsafe:!0,mt:date})}function write_zip(cfb,options){var _opts=options||{},out=[],cdirs=[],o=new_buf(1),method=_opts.compression?8:0,flags=0,desc=!1;desc&&(flags|=8);var i2=0,j=0,start_cd=0,fcnt=0,root=cfb.FullPaths[0],fp=root,fi=cfb.FileIndex[0],crcs=[],sz_cd=0;for(i2=1;i2<cfb.FullPaths.length;++i2)if(fp=cfb.FullPaths[i2].slice(root.length),fi=cfb.FileIndex[i2],!(!fi.size||!fi.content||fp=="Sh33tJ5")){var start2=start_cd,namebuf=new_buf(fp.length);for(j=0;j<fp.length;++j)namebuf.write_shift(1,fp.charCodeAt(j)&127);namebuf=namebuf.slice(0,namebuf.l),crcs[fcnt]=CRC32.buf(fi.content,0);var outbuf=fi.content;method==8&&(outbuf=_deflateRawSync(outbuf)),o=new_buf(30),o.write_shift(4,67324752),o.write_shift(2,20),o.write_shift(2,flags),o.write_shift(2,method),fi.mt?write_dos_date(o,fi.mt):o.write_shift(4,0),o.write_shift(-4,flags&8?0:crcs[fcnt]),o.write_shift(4,flags&8?0:outbuf.length),o.write_shift(4,flags&8?0:fi.content.length),o.write_shift(2,namebuf.length),o.write_shift(2,0),start_cd+=o.length,out.push(o),start_cd+=namebuf.length,out.push(namebuf),start_cd+=outbuf.length,out.push(outbuf),flags&8&&(o=new_buf(12),o.write_shift(-4,crcs[fcnt]),o.write_shift(4,outbuf.length),o.write_shift(4,fi.content.length),start_cd+=o.l,out.push(o)),o=new_buf(46),o.write_shift(4,33639248),o.write_shift(2,0),o.write_shift(2,20),o.write_shift(2,flags),o.write_shift(2,method),o.write_shift(4,0),o.write_shift(-4,crcs[fcnt]),o.write_shift(4,outbuf.length),o.write_shift(4,fi.content.length),o.write_shift(2,namebuf.length),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(4,0),o.write_shift(4,start2),sz_cd+=o.l,cdirs.push(o),sz_cd+=namebuf.length,cdirs.push(namebuf),++fcnt}return o=new_buf(22),o.write_shift(4,101010256),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,fcnt),o.write_shift(2,fcnt),o.write_shift(4,sz_cd),o.write_shift(4,start_cd),o.write_shift(2,0),bconcat([bconcat(out),bconcat(cdirs),o])}var ContentTypeMap={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function get_content_type(fi,fp){if(fi.ctype)return fi.ctype;var ext=fi.name||"",m=ext.match(/\.([^\.]+)$/);return m&&ContentTypeMap[m[1]]||fp&&(m=(ext=fp).match(/[\.\\]([^\.\\])+$/),m&&ContentTypeMap[m[1]])?ContentTypeMap[m[1]]:"application/octet-stream"}function write_base64_76(bstr){for(var data=Base64_encode(bstr),o=[],i2=0;i2<data.length;i2+=76)o.push(data.slice(i2,i2+76));return o.join(`\r
`)+`\r
`}function write_quoted_printable(text){var encoded=text.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(c){var w=c.charCodeAt(0).toString(16).toUpperCase();return"="+(w.length==1?"0"+w:w)});encoded=encoded.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),encoded.charAt(0)==`
`&&(encoded="=0D"+encoded.slice(1)),encoded=encoded.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var o=[],split=encoded.split(`\r
`),si=0;si<split.length;++si){var str=split[si];if(str.length==0){o.push("");continue}for(var i2=0;i2<str.length;){var end=76,tmp=str.slice(i2,i2+end);tmp.charAt(end-1)=="="?end--:tmp.charAt(end-2)=="="?end-=2:tmp.charAt(end-3)=="="&&(end-=3),tmp=str.slice(i2,i2+end),i2+=end,i2<str.length&&(tmp+="="),o.push(tmp)}}return o.join(`\r
`)}function parse_quoted_printable(data){for(var o=[],di=0;di<data.length;++di){for(var line=data[di];di<=data.length&&line.charAt(line.length-1)=="=";)line=line.slice(0,line.length-1)+data[++di];o.push(line)}for(var oi=0;oi<o.length;++oi)o[oi]=o[oi].replace(/[=][0-9A-Fa-f]{2}/g,function($$2){return String.fromCharCode(parseInt($$2.slice(1),16))});return s2a(o.join(`\r
`))}function parse_mime(cfb,data,root){for(var fname="",cte="",ctype="",fdata,di=0;di<10;++di){var line=data[di];if(!line||line.match(/^\s*$/))break;var m=line.match(/^(.*?):\s*([^\s].*)$/);if(m)switch(m[1].toLowerCase()){case"content-location":fname=m[2].trim();break;case"content-type":ctype=m[2].trim();break;case"content-transfer-encoding":cte=m[2].trim();break}}switch(++di,cte.toLowerCase()){case"base64":fdata=s2a(Base64_decode(data.slice(di).join("")));break;case"quoted-printable":fdata=parse_quoted_printable(data.slice(di));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+cte)}var file=cfb_add(cfb,fname.slice(root.length),fdata,{unsafe:!0});ctype&&(file.ctype=ctype)}function parse_mad(file,options){if(a2s2(file.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var root=options&&options.root||"",data=(has_buf&&Buffer.isBuffer(file)?file.toString("binary"):a2s2(file)).split(`\r
`),di=0,row="";for(di=0;di<data.length;++di)if(row=data[di],!!/^Content-Location:/i.test(row)&&(row=row.slice(row.indexOf("file")),root||(root=row.slice(0,row.lastIndexOf("/")+1)),row.slice(0,root.length)!=root))for(;root.length>0&&(root=root.slice(0,root.length-1),root=root.slice(0,root.lastIndexOf("/")+1),row.slice(0,root.length)!=root););var mboundary=(data[1]||"").match(/boundary="(.*?)"/);if(!mboundary)throw new Error("MAD cannot find boundary");var boundary="--"+(mboundary[1]||""),FileIndex=[],FullPaths=[],o={FileIndex,FullPaths};init_cfb(o);var start_di,fcnt=0;for(di=0;di<data.length;++di){var line=data[di];line!==boundary&&line!==boundary+"--"||(fcnt++&&parse_mime(o,data.slice(start_di,di),root),start_di=di)}return o}function write_mad(cfb,options){var opts=options||{},boundary=opts.boundary||"SheetJS";boundary="------="+boundary;for(var out=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+boundary.slice(2)+'"',"","",""],root=cfb.FullPaths[0],fp=root,fi=cfb.FileIndex[0],i2=1;i2<cfb.FullPaths.length;++i2)if(fp=cfb.FullPaths[i2].slice(root.length),fi=cfb.FileIndex[i2],!(!fi.size||!fi.content||fp=="Sh33tJ5")){fp=fp.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(c){return"_x"+c.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(u){return"_u"+u.charCodeAt(0).toString(16)+"_"});for(var ca=fi.content,cstr=has_buf&&Buffer.isBuffer(ca)?ca.toString("binary"):a2s2(ca),dispcnt=0,L=Math.min(1024,cstr.length),cc=0,csl=0;csl<=L;++csl)(cc=cstr.charCodeAt(csl))>=32&&cc<128&&++dispcnt;var qp=dispcnt>=L*4/5;out.push(boundary),out.push("Content-Location: "+(opts.root||"file:///C:/SheetJS/")+fp),out.push("Content-Transfer-Encoding: "+(qp?"quoted-printable":"base64")),out.push("Content-Type: "+get_content_type(fi,fp)),out.push(""),out.push(qp?write_quoted_printable(cstr):write_base64_76(cstr))}return out.push(boundary+`--\r
`),out.join(`\r
`)}function cfb_new(opts){var o={};return init_cfb(o,opts),o}function cfb_add(cfb,name,content,opts){var unsafe=opts&&opts.unsafe;unsafe||init_cfb(cfb);var file=!unsafe&&CFB.find(cfb,name);if(!file){var fpath=cfb.FullPaths[0];name.slice(0,fpath.length)==fpath?fpath=name:(fpath.slice(-1)!="/"&&(fpath+="/"),fpath=(fpath+name).replace("//","/")),file={name:filename(name),type:2},cfb.FileIndex.push(file),cfb.FullPaths.push(fpath),unsafe||CFB.utils.cfb_gc(cfb)}return file.content=content,file.size=content?content.length:0,opts&&(opts.CLSID&&(file.clsid=opts.CLSID),opts.mt&&(file.mt=opts.mt),opts.ct&&(file.ct=opts.ct)),file}function cfb_del(cfb,name){init_cfb(cfb);var file=CFB.find(cfb,name);if(file){for(var j=0;j<cfb.FileIndex.length;++j)if(cfb.FileIndex[j]==file)return cfb.FileIndex.splice(j,1),cfb.FullPaths.splice(j,1),!0}return!1}function cfb_mov(cfb,old_name,new_name){init_cfb(cfb);var file=CFB.find(cfb,old_name);if(file){for(var j=0;j<cfb.FileIndex.length;++j)if(cfb.FileIndex[j]==file)return cfb.FileIndex[j].name=filename(new_name),cfb.FullPaths[j]=new_name,!0}return!1}function cfb_gc(cfb){rebuild_cfb(cfb,!0)}return exports2.find=find,exports2.read=read,exports2.parse=parse3,exports2.write=write,exports2.writeFile=write_file,exports2.utils={cfb_new,cfb_add,cfb_del,cfb_mov,cfb_gc,ReadShift,CheckField,prep_blob,bconcat,use_zlib,_deflateRaw:_deflate,_inflateRaw:_inflate,consts},exports2}(),_fs;function read_binary(path){if(typeof _fs!="undefined")return _fs.readFileSync(path);if(typeof Deno!="undefined")return Deno.readFileSync(path);if(typeof $!="undefined"&&typeof File!="undefined"&&typeof Folder!="undefined")try{var infile=File(path);infile.open("r"),infile.encoding="binary";var data=infile.read();return infile.close(),data}catch(e){if(!e.message||!e.message.match(/onstruct/))throw e}throw new Error("Cannot access file "+path)}function keys(o){for(var ks=Object.keys(o),o2=[],i=0;i<ks.length;++i)Object.prototype.hasOwnProperty.call(o,ks[i])&&o2.push(ks[i]);return o2}function evert(obj){for(var o=[],K=keys(obj),i=0;i!==K.length;++i)o[obj[K[i]]]=K[i];return o}var basedate=new Date(1899,11,30,0,0,0);function datenum(v,date1904){var epoch=v.getTime();date1904&&(epoch-=1462*24*60*60*1e3);var dnthresh2=basedate.getTime()+(v.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;return(epoch-dnthresh2)/(24*60*60*1e3)}var refdate=new Date,dnthresh=basedate.getTime()+(refdate.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4,refoffset=refdate.getTimezoneOffset();function numdate(v){var out=new Date;return out.setTime(v*24*60*60*1e3+dnthresh),out.getTimezoneOffset()!==refoffset&&out.setTime(out.getTime()+(out.getTimezoneOffset()-refoffset)*6e4),out}function parse_isodur(s){var sec=0,mt=0,time=!1,m=s.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!m)throw new Error("|"+s+"| is not an ISO8601 Duration");for(var i=1;i!=m.length;++i)if(!!m[i]){switch(mt=1,i>3&&(time=!0),m[i].slice(m[i].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+m[i].slice(m[i].length-1));case"D":mt*=24;case"H":mt*=60;case"M":if(time)mt*=60;else throw new Error("Unsupported ISO Duration Field: M");case"S":break}sec+=mt*parseInt(m[i],10)}return sec}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=good_pd_date.getFullYear()==2017;function parseDate(str,fixdate){var d=new Date(str);if(good_pd)return fixdate>0?d.setTime(d.getTime()+d.getTimezoneOffset()*60*1e3):fixdate<0&&d.setTime(d.getTime()-d.getTimezoneOffset()*60*1e3),d;if(str instanceof Date)return str;if(good_pd_date.getFullYear()==1917&&!isNaN(d.getFullYear())){var s=d.getFullYear();return str.indexOf(""+s)>-1||d.setFullYear(d.getFullYear()+100),d}var n=str.match(/\d+/g)||["2017","2","19","0","0","0"],out=new Date(+n[0],+n[1]-1,+n[2],+n[3]||0,+n[4]||0,+n[5]||0);return str.indexOf("Z")>-1&&(out=new Date(out.getTime()-out.getTimezoneOffset()*60*1e3)),out}function cc2str(arr,debomit){if(has_buf&&Buffer.isBuffer(arr)){if(debomit){if(arr[0]==255&&arr[1]==254)return utf8write(arr.slice(2).toString("utf16le"));if(arr[1]==254&&arr[2]==255)return utf8write(utf16beread(arr.slice(2).toString("binary")))}return arr.toString("binary")}if(typeof TextDecoder!="undefined")try{if(debomit){if(arr[0]==255&&arr[1]==254)return utf8write(new TextDecoder("utf-16le").decode(arr.slice(2)));if(arr[0]==254&&arr[1]==255)return utf8write(new TextDecoder("utf-16be").decode(arr.slice(2)))}var rev={"\u20AC":"\x80","\u201A":"\x82",\u0192:"\x83","\u201E":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87",\u02C6:"\x88","\u2030":"\x89",\u0160:"\x8A","\u2039":"\x8B",\u0152:"\x8C",\u017D:"\x8E","\u2018":"\x91","\u2019":"\x92","\u201C":"\x93","\u201D":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02DC":"\x98","\u2122":"\x99",\u0161:"\x9A","\u203A":"\x9B",\u0153:"\x9C",\u017E:"\x9E",\u0178:"\x9F"};return Array.isArray(arr)&&(arr=new Uint8Array(arr)),new TextDecoder("latin1").decode(arr).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(c){return rev[c]||c})}catch(e){}for(var o=[],i=0;i!=arr.length;++i)o.push(String.fromCharCode(arr[i]));return o.join("")}function dup(o){if(typeof JSON!="undefined"&&!Array.isArray(o))return JSON.parse(JSON.stringify(o));if(typeof o!="object"||o==null)return o;if(o instanceof Date)return new Date(o.getTime());var out={};for(var k in o)Object.prototype.hasOwnProperty.call(o,k)&&(out[k]=dup(o[k]));return out}function fill(c,l){for(var o="";o.length<l;)o+=c;return o}function fuzzynum(s){var v=Number(s);if(!isNaN(v))return isFinite(v)?v:NaN;if(!/\d/.test(s))return v;var wt=1,ss=s.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return wt*=100,""});return!isNaN(v=Number(ss))||(ss=ss.replace(/[(](.*)[)]/,function($$2,$1){return wt=-wt,$1}),!isNaN(v=Number(ss)))?v/wt:v}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(s){var o=new Date(s),n=new Date(NaN),y=o.getYear(),m=o.getMonth(),d=o.getDate();if(isNaN(d))return n;var lower=s.toLowerCase();if(lower.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(lower=lower.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),lower.length>3&&lower_months.indexOf(lower)==-1)return n}else if(lower.match(/[a-z]/))return n;return y<0||y>8099?n:(m>0||d>1)&&y!=101?o:s.match(/[^-0-9:,\/\\]/)?n:o}var split_regex=function(){var safe_split_regex="abacaba".split(/(:?b)/i).length==5;return function(str,re,def){if(safe_split_regex||typeof re=="string")return str.split(re);for(var p=str.split(re),o=[p[0]],i=1;i<p.length;++i)o.push(def),o.push(p[i]);return o}}();function getdatastr(data){return data?data.content&&data.type?cc2str(data.content,!0):data.data?debom(data.data):data.asNodeBuffer&&has_buf?debom(data.asNodeBuffer().toString("binary")):data.asBinary?debom(data.asBinary()):data._data&&data._data.getContent?debom(cc2str(Array.prototype.slice.call(data._data.getContent(),0))):null:null}function getdatabin(data){if(!data)return null;if(data.data)return char_codes(data.data);if(data.asNodeBuffer&&has_buf)return data.asNodeBuffer();if(data._data&&data._data.getContent){var o=data._data.getContent();return typeof o=="string"?char_codes(o):Array.prototype.slice.call(o)}return data.content&&data.type?data.content:null}function getdata(data){return data&&data.name.slice(-4)===".bin"?getdatabin(data):getdatastr(data)}function safegetzipfile(zip,file){for(var k=zip.FullPaths||keys(zip.files),f=file.toLowerCase().replace(/[\/]/g,"\\"),g=f.replace(/\\/g,"/"),i=0;i<k.length;++i){var n=k[i].replace(/^Root Entry[\/]/,"").toLowerCase();if(f==n||g==n)return zip.files?zip.files[k[i]]:zip.FileIndex[i]}return null}function getzipfile(zip,file){var o=safegetzipfile(zip,file);if(o==null)throw new Error("Cannot find file "+file+" in zip");return o}function getzipdata(zip,file,safe){if(!safe)return getdata(getzipfile(zip,file));if(!file)return null;try{return getzipdata(zip,file)}catch(e){return null}}function getzipstr(zip,file,safe){if(!safe)return getdatastr(getzipfile(zip,file));if(!file)return null;try{return getzipstr(zip,file)}catch(e){return null}}function getzipbin(zip,file,safe){if(!safe)return getdatabin(getzipfile(zip,file));if(!file)return null;try{return getzipbin(zip,file)}catch(e){return null}}function zipentries(zip){for(var k=zip.FullPaths||keys(zip.files),o=[],i=0;i<k.length;++i)k[i].slice(-1)!="/"&&o.push(k[i].replace(/^Root Entry[\/]/,""));return o.sort()}function zip_add_file(zip,path,content){if(zip.FullPaths){if(typeof content=="string"){var res;return has_buf?res=Buffer_from(content):res=utf8decode(content),CFB.utils.cfb_add(zip,path,res)}CFB.utils.cfb_add(zip,path,content)}else zip.file(path,content)}function zip_read(d,o){switch(o.type){case"base64":return CFB.read(d,{type:"base64"});case"binary":return CFB.read(d,{type:"binary"});case"buffer":case"array":return CFB.read(d,{type:"buffer"})}throw new Error("Unrecognized type "+o.type)}function resolve_path(path,base){if(path.charAt(0)=="/")return path.slice(1);var result=base.split("/");base.slice(-1)!="/"&&result.pop();for(var target=path.split("/");target.length!==0;){var step=target.shift();step===".."?result.pop():step!=="."&&result.push(step)}return result.join("/")}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,attregexg=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,tagregex1=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,tagregex2=/<[^>]*>/g,tagregex=XML_HEADER.match(tagregex1)?tagregex1:tagregex2,nsregex=/<\w*:/,nsregex2=/<(\/?)\w+:/;function parsexmltag(tag,skip_root,skip_LC){for(var z={},eq=0,c=0;eq!==tag.length&&!((c=tag.charCodeAt(eq))===32||c===10||c===13);++eq);if(skip_root||(z[0]=tag.slice(0,eq)),eq===tag.length)return z;var m=tag.match(attregexg),j=0,v="",i=0,q="",cc="",quot=1;if(m)for(i=0;i!=m.length;++i){for(cc=m[i],c=0;c!=cc.length&&cc.charCodeAt(c)!==61;++c);for(q=cc.slice(0,c).trim();cc.charCodeAt(c+1)==32;)++c;for(quot=(eq=cc.charCodeAt(c+1))==34||eq==39?1:0,v=cc.slice(c+1+quot,cc.length-quot),j=0;j!=q.length&&q.charCodeAt(j)!==58;++j);if(j===q.length)q.indexOf("_")>0&&(q=q.slice(0,q.indexOf("_"))),z[q]=v,skip_LC||(z[q.toLowerCase()]=v);else{var k=(j===5&&q.slice(0,5)==="xmlns"?"xmlns":"")+q.slice(j+1);if(z[k]&&q.slice(j-3,j)=="ext")continue;z[k]=v,skip_LC||(z[k.toLowerCase()]=v)}}return z}function strip_ns(x){return x.replace(nsregex2,"<$1")}var encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),unescapexml=function(){var encregex=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,coderegex=/_x([\da-fA-F]{4})_/ig;return function unescapexml2(text){var s=text+"",i=s.indexOf("<![CDATA[");if(i==-1)return s.replace(encregex,function($$2,$1){return encodings[$$2]||String.fromCharCode(parseInt($1,$$2.indexOf("x")>-1?16:10))||$$2}).replace(coderegex,function(m,c){return String.fromCharCode(parseInt(c,16))});var j=s.indexOf("]]>");return unescapexml2(s.slice(0,i))+s.slice(i+9,j)+unescapexml2(s.slice(j+3))}}(),decregex=/[&<>'"]/g;var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(text){var s=text+"";return s.replace(decregex,function(y){return rencoding[y]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(s2){return"&#x"+("000"+s2.charCodeAt(0).toString(16)).slice(-4)+";"})}var xlml_fixstr=function(){var entregex=/&#(\d+);/g;function entrepl($$2,$1){return String.fromCharCode(parseInt($1,10))}return function(str){return str.replace(entregex,entrepl)}}();function parsexmlbool(value){switch(value){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(orig){for(var out="",i=0,c=0,d=0,e=0,f=0,w=0;i<orig.length;){if(c=orig.charCodeAt(i++),c<128){out+=String.fromCharCode(c);continue}if(d=orig.charCodeAt(i++),c>191&&c<224){f=(c&31)<<6,f|=d&63,out+=String.fromCharCode(f);continue}if(e=orig.charCodeAt(i++),c<240){out+=String.fromCharCode((c&15)<<12|(d&63)<<6|e&63);continue}f=orig.charCodeAt(i++),w=((c&7)<<18|(d&63)<<12|(e&63)<<6|f&63)-65536,out+=String.fromCharCode(55296+(w>>>10&1023)),out+=String.fromCharCode(56320+(w&1023))}return out}function utf8readb(data){var out=new_raw_buf(2*data.length),w,i,j=1,k=0,ww=0,c;for(i=0;i<data.length;i+=j)j=1,(c=data.charCodeAt(i))<128?w=c:c<224?(w=(c&31)*64+(data.charCodeAt(i+1)&63),j=2):c<240?(w=(c&15)*4096+(data.charCodeAt(i+1)&63)*64+(data.charCodeAt(i+2)&63),j=3):(j=4,w=(c&7)*262144+(data.charCodeAt(i+1)&63)*4096+(data.charCodeAt(i+2)&63)*64+(data.charCodeAt(i+3)&63),w-=65536,ww=55296+(w>>>10&1023),w=56320+(w&1023)),ww!==0&&(out[k++]=ww&255,out[k++]=ww>>>8,ww=0),out[k++]=w%256,out[k++]=w>>>8;return out.slice(0,k).toString("ucs2")}function utf8readc(data){return Buffer_from(data,"binary").toString("utf8")}var utf8corpus="foo bar baz\xE2\x98\x83\xF0\x9F\x8D\xA3",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(data){return Buffer_from(data,"utf8").toString("binary")}:function(orig){for(var out=[],i=0,c=0,d=0;i<orig.length;)switch(c=orig.charCodeAt(i++),!0){case c<128:out.push(String.fromCharCode(c));break;case c<2048:out.push(String.fromCharCode(192+(c>>6))),out.push(String.fromCharCode(128+(c&63)));break;case(c>=55296&&c<57344):c-=55296,d=orig.charCodeAt(i++)-56320+(c<<10),out.push(String.fromCharCode(240+(d>>18&7))),out.push(String.fromCharCode(144+(d>>12&63))),out.push(String.fromCharCode(128+(d>>6&63))),out.push(String.fromCharCode(128+(d&63)));break;default:out.push(String.fromCharCode(224+(c>>12))),out.push(String.fromCharCode(128+(c>>6&63))),out.push(String.fromCharCode(128+(c&63)))}return out.join("")},matchtag=function(){var mtcache={};return function(f,g){var t=f+"|"+(g||"");return mtcache[t]?mtcache[t]:mtcache[t]=new RegExp("<(?:\\w+:)?"+f+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+f+">",g||"")}}(),htmldecode=function(){var entities=[["nbsp"," "],["middot","\xB7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(x){return[new RegExp("&"+x[0]+";","ig"),x[1]]});return function(str){for(var o=str.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),i=0;i<entities.length;++i)o=o.replace(entities[i][0],entities[i][1]);return o}}(),vtregex=function(){var vt_cache={};return function(bt){return vt_cache[bt]!==void 0?vt_cache[bt]:vt_cache[bt]=new RegExp("<(?:vt:)?"+bt+">([\\s\\S]*?)</(?:vt:)?"+bt+">","g")}}(),vtvregex=/<\/?(?:vt:)?variant>/g,vtmregex=/<(?:vt:)([^>]*)>([\s\S]*)</;function parseVector(data,opts){var h=parsexmltag(data),matches=data.match(vtregex(h.baseType))||[],res=[];if(matches.length!=h.size){if(opts.WTF)throw new Error("unexpected vector length "+matches.length+" != "+h.size);return res}return matches.forEach(function(x){var v=x.replace(vtvregex,"").match(vtmregex);v&&res.push({v:utf8read(v[2]),t:v[1]})}),res}var wtregex=/(^\s|\s$|\n)/;function wxt_helper(h){return keys(h).map(function(k){return" "+k+'="'+h[k]+'"'}).join("")}function writextag(f,g,h){return"<"+f+(h!=null?wxt_helper(h):"")+(g!=null?(g.match(wtregex)?' xml:space="preserve"':"")+">"+g+"</"+f:"/")+">"}function xlml_normalize(d){if(has_buf&&Buffer.isBuffer(d))return d.toString("utf8");if(typeof d=="string")return d;if(typeof Uint8Array!="undefined"&&d instanceof Uint8Array)return utf8read(a2s(ab2a(d)));throw new Error("Bad input format: expected Buffer or string")}var xlmlregex=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,XMLNS={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function read_double_le(b,idx){for(var s=1-2*(b[idx+7]>>>7),e=((b[idx+7]&127)<<4)+(b[idx+6]>>>4&15),m=b[idx+6]&15,i=5;i>=0;--i)m=m*256+b[idx+i];return e==2047?m==0?s*Infinity:NaN:(e==0?e=-1022:(e-=1023,m+=Math.pow(2,52)),s*Math.pow(2,e-52)*m)}function write_double_le(b,v,idx){var bs=(v<0||1/v==-Infinity?1:0)<<7,e=0,m=0,av=bs?-v:v;isFinite(av)?av==0?e=m=0:(e=Math.floor(Math.log(av)/Math.LN2),m=av*Math.pow(2,52-e),e<=-1023&&(!isFinite(m)||m<Math.pow(2,52))?e=-1022:(m-=Math.pow(2,52),e+=1023)):(e=2047,m=isNaN(v)?26985:0);for(var i=0;i<=5;++i,m/=256)b[idx+i]=m&255;b[idx+6]=(e&15)<<4|m&15,b[idx+7]=e>>4|bs}var ___toBuffer=function(bufs){for(var x=[],w=10240,i=0;i<bufs[0].length;++i)if(bufs[0][i])for(var j=0,L=bufs[0][i].length;j<L;j+=w)x.push.apply(x,bufs[0][i].slice(j,j+w));return x},__toBuffer=has_buf?function(bufs){return bufs[0].length>0&&Buffer.isBuffer(bufs[0][0])?Buffer.concat(bufs[0].map(function(x){return Buffer.isBuffer(x)?x:Buffer_from(x)})):___toBuffer(bufs)}:___toBuffer,___utf16le=function(b,s,e){for(var ss=[],i=s;i<e;i+=2)ss.push(String.fromCharCode(__readUInt16LE(b,i)));return ss.join("").replace(chr0,"")},__utf16le=has_buf?function(b,s,e){return Buffer.isBuffer(b)?b.toString("utf16le",s,e).replace(chr0,""):___utf16le(b,s,e)}:___utf16le,___hexlify=function(b,s,l){for(var ss=[],i=s;i<s+l;++i)ss.push(("0"+b[i].toString(16)).slice(-2));return ss.join("")},__hexlify=has_buf?function(b,s,l){return Buffer.isBuffer(b)?b.toString("hex",s,s+l):___hexlify(b,s,l)}:___hexlify,___utf8=function(b,s,e){for(var ss=[],i=s;i<e;i++)ss.push(String.fromCharCode(__readUInt8(b,i)));return ss.join("")},__utf8=has_buf?function(b,s,e){return Buffer.isBuffer(b)?b.toString("utf8",s,e):___utf8(b,s,e)}:___utf8,___lpstr=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?__utf8(b,i+4,i+4+len2-1):""},__lpstr=___lpstr,___cpstr=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?__utf8(b,i+4,i+4+len2-1):""},__cpstr=___cpstr,___lpwstr=function(b,i){var len2=2*__readUInt32LE(b,i);return len2>0?__utf8(b,i+4,i+4+len2-1):""},__lpwstr=___lpwstr,___lpp4=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?__utf16le(b,i+4,i+4+len2):""},__lpp4=___lpp4,___8lpp4=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?__utf8(b,i+4,i+4+len2):""},__8lpp4=___8lpp4,___double=function(b,idx){return read_double_le(b,idx)},__double=___double,is_buf=function(a){return Array.isArray(a)||typeof Uint8Array!="undefined"&&a instanceof Uint8Array};has_buf&&(__lpstr=function(b,i){if(!Buffer.isBuffer(b))return ___lpstr(b,i);var len2=b.readUInt32LE(i);return len2>0?b.toString("utf8",i+4,i+4+len2-1):""},__cpstr=function(b,i){if(!Buffer.isBuffer(b))return ___cpstr(b,i);var len2=b.readUInt32LE(i);return len2>0?b.toString("utf8",i+4,i+4+len2-1):""},__lpwstr=function(b,i){if(!Buffer.isBuffer(b))return ___lpwstr(b,i);var len2=2*b.readUInt32LE(i);return b.toString("utf16le",i+4,i+4+len2-1)},__lpp4=function(b,i){if(!Buffer.isBuffer(b))return ___lpp4(b,i);var len2=b.readUInt32LE(i);return b.toString("utf16le",i+4,i+4+len2)},__8lpp4=function(b,i){if(!Buffer.isBuffer(b))return ___8lpp4(b,i);var len2=b.readUInt32LE(i);return b.toString("utf8",i+4,i+4+len2)},__double=function(b,i){return Buffer.isBuffer(b)?b.readDoubleLE(i):___double(b,i)},is_buf=function(a){return Buffer.isBuffer(a)||Array.isArray(a)||typeof Uint8Array!="undefined"&&a instanceof Uint8Array});function cpdoit(){__utf16le=function(b,s,e){return $cptable.utils.decode(1200,b.slice(s,e)).replace(chr0,"")},__utf8=function(b,s,e){return $cptable.utils.decode(65001,b.slice(s,e))},__lpstr=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?$cptable.utils.decode(current_ansi,b.slice(i+4,i+4+len2-1)):""},__cpstr=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?$cptable.utils.decode(current_codepage,b.slice(i+4,i+4+len2-1)):""},__lpwstr=function(b,i){var len2=2*__readUInt32LE(b,i);return len2>0?$cptable.utils.decode(1200,b.slice(i+4,i+4+len2-1)):""},__lpp4=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?$cptable.utils.decode(1200,b.slice(i+4,i+4+len2)):""},__8lpp4=function(b,i){var len2=__readUInt32LE(b,i);return len2>0?$cptable.utils.decode(65001,b.slice(i+4,i+4+len2)):""}}typeof $cptable!="undefined"&&cpdoit();var __readUInt8=function(b,idx){return b[idx]},__readUInt16LE=function(b,idx){return b[idx+1]*(1<<8)+b[idx]},__readInt16LE=function(b,idx){var u=b[idx+1]*(1<<8)+b[idx];return u<32768?u:(65535-u+1)*-1},__readUInt32LE=function(b,idx){return b[idx+3]*(1<<24)+(b[idx+2]<<16)+(b[idx+1]<<8)+b[idx]},__readInt32LE=function(b,idx){return b[idx+3]<<24|b[idx+2]<<16|b[idx+1]<<8|b[idx]},__readInt32BE=function(b,idx){return b[idx]<<24|b[idx+1]<<16|b[idx+2]<<8|b[idx+3]};function ReadShift(size,t){var o="",oI,oR,oo=[],w,vv,i,loc;switch(t){case"dbcs":if(loc=this.l,has_buf&&Buffer.isBuffer(this))o=this.slice(this.l,this.l+2*size).toString("utf16le");else for(i=0;i<size;++i)o+=String.fromCharCode(__readUInt16LE(this,loc)),loc+=2;size*=2;break;case"utf8":o=__utf8(this,this.l,this.l+size);break;case"utf16le":size*=2,o=__utf16le(this,this.l,this.l+size);break;case"wstr":if(typeof $cptable!="undefined")o=$cptable.utils.decode(current_codepage,this.slice(this.l,this.l+2*size));else return ReadShift.call(this,size,"dbcs");size=2*size;break;case"lpstr-ansi":o=__lpstr(this,this.l),size=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":o=__cpstr(this,this.l),size=4+__readUInt32LE(this,this.l);break;case"lpwstr":o=__lpwstr(this,this.l),size=4+2*__readUInt32LE(this,this.l);break;case"lpp4":size=4+__readUInt32LE(this,this.l),o=__lpp4(this,this.l),size&2&&(size+=2);break;case"8lpp4":size=4+__readUInt32LE(this,this.l),o=__8lpp4(this,this.l),size&3&&(size+=4-(size&3));break;case"cstr":for(size=0,o="";(w=__readUInt8(this,this.l+size++))!==0;)oo.push(_getchar(w));o=oo.join("");break;case"_wstr":for(size=0,o="";(w=__readUInt16LE(this,this.l+size))!==0;)oo.push(_getchar(w)),size+=2;size+=2,o=oo.join("");break;case"dbcs-cont":for(o="",loc=this.l,i=0;i<size;++i){if(this.lens&&this.lens.indexOf(loc)!==-1)return w=__readUInt8(this,loc),this.l=loc+1,vv=ReadShift.call(this,size-i,w?"dbcs-cont":"sbcs-cont"),oo.join("")+vv;oo.push(_getchar(__readUInt16LE(this,loc))),loc+=2}o=oo.join(""),size*=2;break;case"cpstr":if(typeof $cptable!="undefined"){o=$cptable.utils.decode(current_codepage,this.slice(this.l,this.l+size));break}case"sbcs-cont":for(o="",loc=this.l,i=0;i!=size;++i){if(this.lens&&this.lens.indexOf(loc)!==-1)return w=__readUInt8(this,loc),this.l=loc+1,vv=ReadShift.call(this,size-i,w?"dbcs-cont":"sbcs-cont"),oo.join("")+vv;oo.push(_getchar(__readUInt8(this,loc))),loc+=1}o=oo.join("");break;default:switch(size){case 1:return oI=__readUInt8(this,this.l),this.l++,oI;case 2:return oI=(t==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,oI;case 4:case-4:return t==="i"||(this[this.l+3]&128)==0?(oI=(size>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,oI):(oR=__readUInt32LE(this,this.l),this.l+=4,oR);case 8:case-8:if(t==="f")return size==8?oR=__double(this,this.l):oR=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,oR;size=8;case 16:o=__hexlify(this,this.l,size);break}}return this.l+=size,o}var __writeUInt32LE=function(b,val,idx){b[idx]=val&255,b[idx+1]=val>>>8&255,b[idx+2]=val>>>16&255,b[idx+3]=val>>>24&255},__writeInt32LE=function(b,val,idx){b[idx]=val&255,b[idx+1]=val>>8&255,b[idx+2]=val>>16&255,b[idx+3]=val>>24&255},__writeUInt16LE=function(b,val,idx){b[idx]=val&255,b[idx+1]=val>>>8&255};function WriteShift(t,val,f){var size=0,i=0;if(f==="dbcs"){for(i=0;i!=val.length;++i)__writeUInt16LE(this,val.charCodeAt(i),this.l+2*i);size=2*val.length}else if(f==="sbcs"){if(typeof $cptable!="undefined"&&current_ansi==874)for(i=0;i!=val.length;++i){var cppayload=$cptable.utils.encode(current_ansi,val.charAt(i));this[this.l+i]=cppayload[0]}else for(val=val.replace(/[^\x00-\x7F]/g,"_"),i=0;i!=val.length;++i)this[this.l+i]=val.charCodeAt(i)&255;size=val.length}else if(f==="hex"){for(;i<t;++i)this[this.l++]=parseInt(val.slice(2*i,2*i+2),16)||0;return this}else if(f==="utf16le"){var end=Math.min(this.l+t,this.length);for(i=0;i<Math.min(val.length,t);++i){var cc=val.charCodeAt(i);this[this.l++]=cc&255,this[this.l++]=cc>>8}for(;this.l<end;)this[this.l++]=0;return this}else switch(t){case 1:size=1,this[this.l]=val&255;break;case 2:size=2,this[this.l]=val&255,val>>>=8,this[this.l+1]=val&255;break;case 3:size=3,this[this.l]=val&255,val>>>=8,this[this.l+1]=val&255,val>>>=8,this[this.l+2]=val&255;break;case 4:size=4,__writeUInt32LE(this,val,this.l);break;case 8:if(size=8,f==="f"){write_double_le(this,val,this.l);break}case 16:break;case-4:size=4,__writeInt32LE(this,val,this.l);break}return this.l+=size,this}function CheckField(hexstr,fld){var m=__hexlify(this,this.l,hexstr.length>>1);if(m!==hexstr)throw new Error(fld+"Expected "+hexstr+" saw "+m);this.l+=hexstr.length>>1}function prep_blob(blob,pos){blob.l=pos,blob.read_shift=ReadShift,blob.chk=CheckField,blob.write_shift=WriteShift}function parsenoop(blob,length){blob.l+=length}function new_buf(sz){var o=new_raw_buf(sz);return prep_blob(o,0),o}function recordhopper(data,cb,opts){if(!!data){var tmpbyte,cntbyte,length;prep_blob(data,data.l||0);for(var L=data.length,RT=0,tgt=0;data.l<L;){RT=data.read_shift(1),RT&128&&(RT=(RT&127)+((data.read_shift(1)&127)<<7));var R=XLSBRecordEnum[RT]||XLSBRecordEnum[65535];for(tmpbyte=data.read_shift(1),length=tmpbyte&127,cntbyte=1;cntbyte<4&&tmpbyte&128;++cntbyte)length+=((tmpbyte=data.read_shift(1))&127)<<7*cntbyte;tgt=data.l+length;var d=R.f&&R.f(data,length,opts);if(data.l=tgt,cb(d,R,RT))return}}}function buf_array(){var bufs=[],blksz=has_buf?256:2048,newblk=function(sz){var o=new_buf(sz);return prep_blob(o,0),o},curbuf=newblk(blksz),endbuf=function(){!curbuf||(curbuf.length>curbuf.l&&(curbuf=curbuf.slice(0,curbuf.l),curbuf.l=curbuf.length),curbuf.length>0&&bufs.push(curbuf),curbuf=null)},next=function(sz){return curbuf&&sz<curbuf.length-curbuf.l?curbuf:(endbuf(),curbuf=newblk(Math.max(sz+1,blksz)))},end=function(){return endbuf(),bconcat(bufs)},push=function(buf){endbuf(),curbuf=buf,curbuf.l==null&&(curbuf.l=curbuf.length),next(blksz)};return{next,push,end,_bufs:bufs}}function shift_cell_xls(cell,tgt,opts){var out=dup(cell);if(tgt.s?(out.cRel&&(out.c+=tgt.s.c),out.rRel&&(out.r+=tgt.s.r)):(out.cRel&&(out.c+=tgt.c),out.rRel&&(out.r+=tgt.r)),!opts||opts.biff<12){for(;out.c>=256;)out.c-=256;for(;out.r>=65536;)out.r-=65536}return out}function shift_range_xls(cell,range3,opts){var out=dup(cell);return out.s=shift_cell_xls(out.s,range3.s,opts),out.e=shift_cell_xls(out.e,range3.s,opts),out}function encode_cell_xls(c,biff){if(c.cRel&&c.c<0)for(c=dup(c);c.c<0;)c.c+=biff>8?16384:256;if(c.rRel&&c.r<0)for(c=dup(c);c.r<0;)c.r+=biff>8?1048576:biff>5?65536:16384;var s=encode_cell(c);return!c.cRel&&c.cRel!=null&&(s=fix_col(s)),!c.rRel&&c.rRel!=null&&(s=fix_row(s)),s}function encode_range_xls(r,opts){return r.s.r==0&&!r.s.rRel&&r.e.r==(opts.biff>=12?1048575:opts.biff>=8?65536:16384)&&!r.e.rRel?(r.s.cRel?"":"$")+encode_col(r.s.c)+":"+(r.e.cRel?"":"$")+encode_col(r.e.c):r.s.c==0&&!r.s.cRel&&r.e.c==(opts.biff>=12?16383:255)&&!r.e.cRel?(r.s.rRel?"":"$")+encode_row(r.s.r)+":"+(r.e.rRel?"":"$")+encode_row(r.e.r):encode_cell_xls(r.s,opts.biff)+":"+encode_cell_xls(r.e,opts.biff)}function decode_row(rowstr){return parseInt(unfix_row(rowstr),10)-1}function encode_row(row){return""+(row+1)}function fix_row(cstr){return cstr.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(cstr){return cstr.replace(/\$(\d+)$/,"$1")}function decode_col(colstr){for(var c=unfix_col(colstr),d=0,i=0;i!==c.length;++i)d=26*d+c.charCodeAt(i)-64;return d-1}function encode_col(col){if(col<0)throw new Error("invalid column "+col);var s="";for(++col;col;col=Math.floor((col-1)/26))s=String.fromCharCode((col-1)%26+65)+s;return s}function fix_col(cstr){return cstr.replace(/^([A-Z])/,"$$$1")}function unfix_col(cstr){return cstr.replace(/^\$([A-Z])/,"$1")}function split_cell(cstr){return cstr.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(cstr){for(var R=0,C=0,i=0;i<cstr.length;++i){var cc=cstr.charCodeAt(i);cc>=48&&cc<=57?R=10*R+(cc-48):cc>=65&&cc<=90&&(C=26*C+(cc-64))}return{c:C-1,r:R-1}}function encode_cell(cell){for(var col=cell.c+1,s="";col;col=(col-1)/26|0)s=String.fromCharCode((col-1)%26+65)+s;return s+(cell.r+1)}function decode_range(range3){var idx=range3.indexOf(":");return idx==-1?{s:decode_cell(range3),e:decode_cell(range3)}:{s:decode_cell(range3.slice(0,idx)),e:decode_cell(range3.slice(idx+1))}}function encode_range(cs,ce){return typeof ce=="undefined"||typeof ce=="number"?encode_range(cs.s,cs.e):(typeof cs!="string"&&(cs=encode_cell(cs)),typeof ce!="string"&&(ce=encode_cell(ce)),cs==ce?cs:cs+":"+ce)}function safe_decode_range(range3){var o={s:{c:0,r:0},e:{c:0,r:0}},idx=0,i=0,cc=0,len2=range3.length;for(idx=0;i<len2&&!((cc=range3.charCodeAt(i)-64)<1||cc>26);++i)idx=26*idx+cc;for(o.s.c=--idx,idx=0;i<len2&&!((cc=range3.charCodeAt(i)-48)<0||cc>9);++i)idx=10*idx+cc;if(o.s.r=--idx,i===len2||cc!=10)return o.e.c=o.s.c,o.e.r=o.s.r,o;for(++i,idx=0;i!=len2&&!((cc=range3.charCodeAt(i)-64)<1||cc>26);++i)idx=26*idx+cc;for(o.e.c=--idx,idx=0;i!=len2&&!((cc=range3.charCodeAt(i)-48)<0||cc>9);++i)idx=10*idx+cc;return o.e.r=--idx,o}function safe_format_cell(cell,v){var q=cell.t=="d"&&v instanceof Date;if(cell.z!=null)try{return cell.w=SSF_format(cell.z,q?datenum(v):v)}catch(e){}try{return cell.w=SSF_format((cell.XF||{}).numFmtId||(q?14:0),q?datenum(v):v)}catch(e){return""+v}}function format_cell(cell,v,o){return cell==null||cell.t==null||cell.t=="z"?"":cell.w!==void 0?cell.w:(cell.t=="d"&&!cell.z&&o&&o.dateNF&&(cell.z=o.dateNF),cell.t=="e"?BErr[cell.v]||cell.v:v==null?safe_format_cell(cell,cell.v):safe_format_cell(cell,v))}function sheet_to_workbook(sheet,opts){var n=opts&&opts.sheet?opts.sheet:"Sheet1",sheets={};return sheets[n]=sheet,{SheetNames:[n],Sheets:sheets}}function sheet_add_aoa(_ws,data,opts){var o=opts||{},dense=_ws?Array.isArray(_ws):o.dense;DENSE!=null&&dense==null&&(dense=DENSE);var ws=_ws||(dense?[]:{}),_R=0,_C=0;if(ws&&o.origin!=null){if(typeof o.origin=="number")_R=o.origin;else{var _origin=typeof o.origin=="string"?decode_cell(o.origin):o.origin;_R=_origin.r,_C=_origin.c}ws["!ref"]||(ws["!ref"]="A1:A1")}var range3={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(ws["!ref"]){var _range=safe_decode_range(ws["!ref"]);range3.s.c=_range.s.c,range3.s.r=_range.s.r,range3.e.c=Math.max(range3.e.c,_range.e.c),range3.e.r=Math.max(range3.e.r,_range.e.r),_R==-1&&(range3.e.r=_R=_range.e.r+1)}for(var R=0;R!=data.length;++R)if(!!data[R]){if(!Array.isArray(data[R]))throw new Error("aoa_to_sheet expects an array of arrays");for(var C=0;C!=data[R].length;++C)if(typeof data[R][C]!="undefined"){var cell={v:data[R][C]},__R=_R+R,__C=_C+C;if(range3.s.r>__R&&(range3.s.r=__R),range3.s.c>__C&&(range3.s.c=__C),range3.e.r<__R&&(range3.e.r=__R),range3.e.c<__C&&(range3.e.c=__C),data[R][C]&&typeof data[R][C]=="object"&&!Array.isArray(data[R][C])&&!(data[R][C]instanceof Date))cell=data[R][C];else if(Array.isArray(cell.v)&&(cell.f=data[R][C][1],cell.v=cell.v[0]),cell.v===null)if(cell.f)cell.t="n";else if(o.nullError)cell.t="e",cell.v=0;else if(o.sheetStubs)cell.t="z";else continue;else typeof cell.v=="number"?cell.t="n":typeof cell.v=="boolean"?cell.t="b":cell.v instanceof Date?(cell.z=o.dateNF||table_fmt[14],o.cellDates?(cell.t="d",cell.w=SSF_format(cell.z,datenum(cell.v))):(cell.t="n",cell.v=datenum(cell.v),cell.w=SSF_format(cell.z,cell.v))):cell.t="s";if(dense)ws[__R]||(ws[__R]=[]),ws[__R][__C]&&ws[__R][__C].z&&(cell.z=ws[__R][__C].z),ws[__R][__C]=cell;else{var cell_ref=encode_cell({c:__C,r:__R});ws[cell_ref]&&ws[cell_ref].z&&(cell.z=ws[cell_ref].z),ws[cell_ref]=cell}}}return range3.s.c<1e7&&(ws["!ref"]=encode_range(range3)),ws}function aoa_to_sheet(data,opts){return sheet_add_aoa(null,data,opts)}function parse_Int32LE(data){return data.read_shift(4,"i")}function parse_XLWideString(data){var cchCharacters=data.read_shift(4);return cchCharacters===0?"":data.read_shift(cchCharacters,"dbcs")}function parse_StrRun(data){return{ich:data.read_shift(2),ifnt:data.read_shift(2)}}function parse_RichStr(data,length){var start2=data.l,flags=data.read_shift(1),str=parse_XLWideString(data),rgsStrRun=[],z={t:str,h:str};if((flags&1)!=0){for(var dwSizeStrRun=data.read_shift(4),i=0;i!=dwSizeStrRun;++i)rgsStrRun.push(parse_StrRun(data));z.r=rgsStrRun}else z.r=[{ich:0,ifnt:0}];return data.l=start2+length,z}var parse_BrtCommentText=parse_RichStr;function parse_XLSBCell(data){var col=data.read_shift(4),iStyleRef=data.read_shift(2);return iStyleRef+=data.read_shift(1)<<16,data.l++,{c:col,iStyleRef}}function parse_XLSBShortCell(data){var iStyleRef=data.read_shift(2);return iStyleRef+=data.read_shift(1)<<16,data.l++,{c:-1,iStyleRef}}var parse_XLSBCodeName=parse_XLWideString;function parse_XLNullableWideString(data){var cchCharacters=data.read_shift(4);return cchCharacters===0||cchCharacters===4294967295?"":data.read_shift(cchCharacters,"dbcs")}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString;function parse_RkNumber(data){var b=data.slice(data.l,data.l+4),fX100=b[0]&1,fInt=b[0]&2;data.l+=4;var RK=fInt===0?__double([0,0,0,0,b[0]&252,b[1],b[2],b[3]],0):__readInt32LE(b,0)>>2;return fX100?RK/100:RK}function parse_RfX(data){var cell={s:{},e:{}};return cell.s.r=data.read_shift(4),cell.e.r=data.read_shift(4),cell.s.c=data.read_shift(4),cell.e.c=data.read_shift(4),cell}var parse_UncheckedRfX=parse_RfX;function parse_Xnum(data){if(data.length-data.l<8)throw"XLS Xnum Buffer underflow";return data.read_shift(8,"f")}function parse_BrtColor(data){var out={},d=data.read_shift(1),xColorType=d>>>1,index3=data.read_shift(1),nTS=data.read_shift(2,"i"),bR=data.read_shift(1),bG=data.read_shift(1),bB=data.read_shift(1);switch(data.l++,xColorType){case 0:out.auto=1;break;case 1:out.index=index3;var icv=XLSIcv[index3];icv&&(out.rgb=rgb2Hex(icv));break;case 2:out.rgb=rgb2Hex([bR,bG,bB]);break;case 3:out.theme=index3;break}return nTS!=0&&(out.tint=nTS>0?nTS/32767:nTS/32768),out}function parse_FontFlags(data){var d=data.read_shift(1);data.l++;var out={fBold:d&1,fItalic:d&2,fUnderline:d&4,fStrikeout:d&8,fOutline:d&16,fShadow:d&32,fCondense:d&64,fExtend:d&128};return out}function parse_ClipboardFormatOrString(o,w){var ClipFmt={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},m=o.read_shift(4);switch(m){case 0:return"";case 4294967295:case 4294967294:return ClipFmt[o.read_shift(4)]||""}if(m>400)throw new Error("Unsupported Clipboard: "+m.toString(16));return o.l-=4,o.read_shift(0,w==1?"lpstr":"lpwstr")}function parse_ClipboardFormatOrAnsiString(o){return parse_ClipboardFormatOrString(o,1)}function parse_ClipboardFormatOrUnicodeString(o){return parse_ClipboardFormatOrString(o,2)}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_VARIANT=12,VT_UI4=19;var VT_FILETIME=64,VT_BLOB=65,VT_CF=71;var VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,VT_USTR=81,VT_CUSTOM=[VT_STRING,VT_USTR],DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},CountryEnum={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},XLSFillPattern=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function rgbify(arr){return arr.map(function(x){return[x>>16&255,x>>8&255,x&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},RBErr={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function parse_ct(data){var ct=new_ct();if(!data||!data.match)return ct;var ctext={};if((data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0].replace(nsregex,"<")){case"<?xml":break;case"<Types":ct.xmlns=y["xmlns"+(y[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":ctext[y.Extension]=y.ContentType;break;case"<Override":ct[ct2type[y.ContentType]]!==void 0&&ct[ct2type[y.ContentType]].push(y.PartName);break}}),ct.xmlns!==XMLNS.CT)throw new Error("Unknown Namespace: "+ct.xmlns);return ct.calcchain=ct.calcchains.length>0?ct.calcchains[0]:"",ct.sst=ct.strs.length>0?ct.strs[0]:"",ct.style=ct.styles.length>0?ct.styles[0]:"",ct.defaults=ctext,delete ct.calcchains,ct}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(file){var n=file.lastIndexOf("/");return file.slice(0,n+1)+"_rels/"+file.slice(n+1)+".rels"}function parse_rels(data,currentFilePath){var rels={"!id":{}};if(!data)return rels;currentFilePath.charAt(0)!=="/"&&(currentFilePath="/"+currentFilePath);var hash={};return(data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);if(y[0]==="<Relationship"){var rel={};rel.Type=y.Type,rel.Target=y.Target,rel.Id=y.Id,y.TargetMode&&(rel.TargetMode=y.TargetMode);var canonictarget=y.TargetMode==="External"?y.Target:resolve_path(y.Target,currentFilePath);rels[canonictarget]=rel,hash[y.Id]=rel}}),rels["!id"]=hash,rels}var CT_ODS="application/vnd.oasis.opendocument.spreadsheet";function parse_manifest(d,opts){for(var str=xlml_normalize(d),Rn,FEtag;Rn=xlmlregex.exec(str);)switch(Rn[3]){case"manifest":break;case"file-entry":if(FEtag=parsexmltag(Rn[0],!1),FEtag.path=="/"&&FEtag.type!==CT_ODS)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(opts&&opts.WTF)throw Rn}}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],CORE_PROPS_REGEX=function(){for(var r=new Array(CORE_PROPS.length),i=0;i<CORE_PROPS.length;++i){var f=CORE_PROPS[i],g="(?:"+f[0].slice(0,f[0].indexOf(":"))+":)"+f[0].slice(f[0].indexOf(":")+1);r[i]=new RegExp("<"+g+"[^>]*>([\\s\\S]*?)</"+g+">")}return r}();function parse_core_props(data){var p={};data=utf8read(data);for(var i=0;i<CORE_PROPS.length;++i){var f=CORE_PROPS[i],cur=data.match(CORE_PROPS_REGEX[i]);cur!=null&&cur.length>0&&(p[f[1]]=unescapexml(cur[1])),f[2]==="date"&&p[f[1]]&&(p[f[1]]=parseDate(p[f[1]]))}return p}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function load_props_pairs(HP,TOP,props,opts){var v=[];if(typeof HP=="string")v=parseVector(HP,opts);else for(var j=0;j<HP.length;++j)v=v.concat(HP[j].map(function(hp){return{v:hp}}));var parts=typeof TOP=="string"?parseVector(TOP,opts).map(function(x){return x.v}):TOP,idx=0,len2=0;if(parts.length>0)for(var i=0;i!==v.length;i+=2){switch(len2=+v[i+1].v,v[i].v){case"Worksheets":case"\u5DE5\u4F5C\u8868":case"\u041B\u0438\u0441\u0442\u044B":case"\u0623\u0648\u0631\u0627\u0642 \u0627\u0644\u0639\u0645\u0644":case"\u30EF\u30FC\u30AF\u30B7\u30FC\u30C8":case"\u05D2\u05DC\u05D9\u05D5\u05E0\u05D5\u05EA \u05E2\u05D1\u05D5\u05D3\u05D4":case"Arbeitsbl\xE4tter":case"\xC7al\u0131\u015Fma Sayfalar\u0131":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de c\xE1lculo":case"Planilhas":case"Regneark":case"Hojas de c\xE1lculo":case"Werkbladen":props.Worksheets=len2,props.SheetNames=parts.slice(idx,idx+len2);break;case"Named Ranges":case"Rangos con nombre":case"\u540D\u524D\u4ED8\u304D\u4E00\u89A7":case"Benannte Bereiche":case"Navngivne omr\xE5der":props.NamedRanges=len2,props.DefinedNames=parts.slice(idx,idx+len2);break;case"Charts":case"Diagramme":props.Chartsheets=len2,props.ChartNames=parts.slice(idx,idx+len2);break}idx+=len2}}function parse_ext_props(data,p,opts){var q={};return p||(p={}),data=utf8read(data),EXT_PROPS.forEach(function(f){var xml=(data.match(matchtag(f[0]))||[])[1];switch(f[2]){case"string":xml&&(p[f[1]]=unescapexml(xml));break;case"bool":p[f[1]]=xml==="true";break;case"raw":var cur=data.match(new RegExp("<"+f[0]+"[^>]*>([\\s\\S]*?)</"+f[0]+">"));cur&&cur.length>0&&(q[f[1]]=cur[1]);break}}),q.HeadingPairs&&q.TitlesOfParts&&load_props_pairs(q.HeadingPairs,q.TitlesOfParts,p,opts),p}var custregex=/<[^>]+>[^<]*/g;function parse_cust_props(data,opts){var p={},name="",m=data.match(custregex);if(m)for(var i=0;i!=m.length;++i){var x=m[i],y=parsexmltag(x);switch(y[0]){case"<?xml":break;case"<Properties":break;case"<property":name=unescapexml(y.name);break;case"</property>":name=null;break;default:if(x.indexOf("<vt:")===0){var toks=x.split(">"),type=toks[0].slice(4),text=toks[1];switch(type){case"lpstr":case"bstr":case"lpwstr":p[name]=unescapexml(text);break;case"bool":p[name]=parsexmlbool(text);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":p[name]=parseInt(text,10);break;case"r4":case"r8":case"decimal":p[name]=parseFloat(text);break;case"filetime":case"date":p[name]=parseDate(text);break;case"cy":case"error":p[name]=unescapexml(text);break;default:if(type.slice(-1)=="/")break;opts.WTF&&typeof console!="undefined"&&console.warn("Unexpected",x,type,toks)}}else if(x.slice(0,2)!=="</"){if(opts.WTF)throw new Error(x)}}}return p}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},evert_XLMLDPM;function xlml_set_prop(Props,tag,val){evert_XLMLDPM||(evert_XLMLDPM=evert(XLMLDocPropsMap)),tag=evert_XLMLDPM[tag]||tag,Props[tag]=val}function parse_FILETIME(blob){var dwLowDateTime=blob.read_shift(4),dwHighDateTime=blob.read_shift(4);return new Date((dwHighDateTime/1e7*Math.pow(2,32)+dwLowDateTime/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function parse_lpstr(blob,type,pad2){var start2=blob.l,str=blob.read_shift(0,"lpstr-cp");if(pad2)for(;blob.l-start2&3;)++blob.l;return str}function parse_lpwstr(blob,type,pad2){var str=blob.read_shift(0,"lpwstr");return pad2&&(blob.l+=4-(str.length+1&3)&3),str}function parse_VtStringBase(blob,stringType,pad2){return stringType===31?parse_lpwstr(blob):parse_lpstr(blob,stringType,pad2)}function parse_VtString(blob,t,pad2){return parse_VtStringBase(blob,t,pad2===!1?0:4)}function parse_VtUnalignedString(blob,t){if(!t)throw new Error("VtUnalignedString must have positive length");return parse_VtStringBase(blob,t,0)}function parse_VtVecLpwstrValue(blob){for(var length=blob.read_shift(4),ret=[],i=0;i!=length;++i){var start2=blob.l;ret[i]=blob.read_shift(0,"lpwstr").replace(chr0,""),blob.l-start2&2&&(blob.l+=2)}return ret}function parse_VtVecUnalignedLpstrValue(blob){for(var length=blob.read_shift(4),ret=[],i=0;i!=length;++i)ret[i]=blob.read_shift(0,"lpstr-cp").replace(chr0,"");return ret}function parse_VtHeadingPair(blob){var start2=blob.l,headingString=parse_TypedPropertyValue(blob,VT_USTR);blob[blob.l]==0&&blob[blob.l+1]==0&&blob.l-start2&2&&(blob.l+=2);var headerParts=parse_TypedPropertyValue(blob,VT_I4);return[headingString,headerParts]}function parse_VtVecHeadingPairValue(blob){for(var cElements=blob.read_shift(4),out=[],i=0;i<cElements/2;++i)out.push(parse_VtHeadingPair(blob));return out}function parse_dictionary(blob,CodePage){for(var cnt=blob.read_shift(4),dict={},j=0;j!=cnt;++j){var pid=blob.read_shift(4),len2=blob.read_shift(4);dict[pid]=blob.read_shift(len2,CodePage===1200?"utf16le":"utf8").replace(chr0,"").replace(chr1,"!"),CodePage===1200&&len2%2&&(blob.l+=2)}return blob.l&3&&(blob.l=blob.l>>2+1<<2),dict}function parse_BLOB(blob){var size=blob.read_shift(4),bytes=blob.slice(blob.l,blob.l+size);return blob.l+=size,(size&3)>0&&(blob.l+=4-(size&3)&3),bytes}function parse_ClipboardData(blob){var o={};return o.Size=blob.read_shift(4),blob.l+=o.Size+3-(o.Size-1)%4,o}function parse_TypedPropertyValue(blob,type,_opts){var t=blob.read_shift(2),ret,opts=_opts||{};if(blob.l+=2,type!==VT_VARIANT&&t!==type&&VT_CUSTOM.indexOf(type)===-1&&!((type&65534)==4126&&(t&65534)==4126))throw new Error("Expected type "+type+" saw "+t);switch(type===VT_VARIANT?t:type){case 2:return ret=blob.read_shift(2,"i"),opts.raw||(blob.l+=2),ret;case 3:return ret=blob.read_shift(4,"i"),ret;case 11:return blob.read_shift(4)!==0;case 19:return ret=blob.read_shift(4),ret;case 30:return parse_lpstr(blob,t,4).replace(chr0,"");case 31:return parse_lpwstr(blob);case 64:return parse_FILETIME(blob);case 65:return parse_BLOB(blob);case 71:return parse_ClipboardData(blob);case 80:return parse_VtString(blob,t,!opts.raw).replace(chr0,"");case 81:return parse_VtUnalignedString(blob,t).replace(chr0,"");case 4108:return parse_VtVecHeadingPairValue(blob);case 4126:case 4127:return t==4127?parse_VtVecLpwstrValue(blob):parse_VtVecUnalignedLpstrValue(blob);default:throw new Error("TypedPropertyValue unrecognized type "+type+" "+t)}}function parse_PropertySet(blob,PIDSI){var start_addr=blob.l,size=blob.read_shift(4),NumProps=blob.read_shift(4),Props=[],i=0,CodePage=0,Dictionary=-1,DictObj={};for(i=0;i!=NumProps;++i){var PropID=blob.read_shift(4),Offset=blob.read_shift(4);Props[i]=[PropID,Offset+start_addr]}Props.sort(function(x,y){return x[1]-y[1]});var PropH={};for(i=0;i!=NumProps;++i){if(blob.l!==Props[i][1]){var fail=!0;if(i>0&&PIDSI)switch(PIDSI[Props[i-1][0]].t){case 2:blob.l+2===Props[i][1]&&(blob.l+=2,fail=!1);break;case 80:blob.l<=Props[i][1]&&(blob.l=Props[i][1],fail=!1);break;case 4108:blob.l<=Props[i][1]&&(blob.l=Props[i][1],fail=!1);break}if((!PIDSI||i==0)&&blob.l<=Props[i][1]&&(fail=!1,blob.l=Props[i][1]),fail)throw new Error("Read Error: Expected address "+Props[i][1]+" at "+blob.l+" :"+i)}if(PIDSI){var piddsi=PIDSI[Props[i][0]];if(PropH[piddsi.n]=parse_TypedPropertyValue(blob,piddsi.t,{raw:!0}),piddsi.p==="version"&&(PropH[piddsi.n]=String(PropH[piddsi.n]>>16)+"."+("0000"+String(PropH[piddsi.n]&65535)).slice(-4)),piddsi.n=="CodePage")switch(PropH[piddsi.n]){case 0:PropH[piddsi.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:set_cp(CodePage=PropH[piddsi.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+PropH[piddsi.n])}}else if(Props[i][0]===1){if(CodePage=PropH.CodePage=parse_TypedPropertyValue(blob,VT_I2),set_cp(CodePage),Dictionary!==-1){var oldpos=blob.l;blob.l=Props[Dictionary][1],DictObj=parse_dictionary(blob,CodePage),blob.l=oldpos}}else if(Props[i][0]===0){if(CodePage===0){Dictionary=i,blob.l=Props[i+1][1];continue}DictObj=parse_dictionary(blob,CodePage)}else{var name=DictObj[Props[i][0]],val;switch(blob[blob.l]){case 65:blob.l+=4,val=parse_BLOB(blob);break;case 30:blob.l+=4,val=parse_VtString(blob,blob[blob.l-4]).replace(/\u0000+$/,"");break;case 31:blob.l+=4,val=parse_VtString(blob,blob[blob.l-4]).replace(/\u0000+$/,"");break;case 3:blob.l+=4,val=blob.read_shift(4,"i");break;case 19:blob.l+=4,val=blob.read_shift(4);break;case 5:blob.l+=4,val=blob.read_shift(8,"f");break;case 11:blob.l+=4,val=parsebool(blob,4);break;case 64:blob.l+=4,val=parseDate(parse_FILETIME(blob));break;default:throw new Error("unparsed value: "+blob[blob.l])}PropH[name]=val}}return blob.l=start_addr+size,PropH}function parse_PropertySetStream(file,PIDSI,clsid){var blob=file.content;if(!blob)return{};prep_blob(blob,0);var NumSets,FMTID0,FMTID1,Offset0,Offset1=0;blob.chk("feff","Byte Order: "),blob.read_shift(2);var SystemIdentifier=blob.read_shift(4),CLSID=blob.read_shift(16);if(CLSID!==CFB.utils.consts.HEADER_CLSID&&CLSID!==clsid)throw new Error("Bad PropertySet CLSID "+CLSID);if(NumSets=blob.read_shift(4),NumSets!==1&&NumSets!==2)throw new Error("Unrecognized #Sets: "+NumSets);if(FMTID0=blob.read_shift(16),Offset0=blob.read_shift(4),NumSets===1&&Offset0!==blob.l)throw new Error("Length mismatch: "+Offset0+" !== "+blob.l);NumSets===2&&(FMTID1=blob.read_shift(16),Offset1=blob.read_shift(4));var PSet0=parse_PropertySet(blob,PIDSI),rval={SystemIdentifier};for(var y in PSet0)rval[y]=PSet0[y];if(rval.FMTID=FMTID0,NumSets===1)return rval;if(Offset1-blob.l==2&&(blob.l+=2),blob.l!==Offset1)throw new Error("Length mismatch 2: "+blob.l+" !== "+Offset1);var PSet1;try{PSet1=parse_PropertySet(blob,null)}catch(e){}for(y in PSet1)rval[y]=PSet1[y];return rval.FMTID=[FMTID0,FMTID1],rval}function parsenoop2(blob,length){return blob.read_shift(length),null}function parslurp(blob,length,cb){for(var arr=[],target=blob.l+length;blob.l<target;)arr.push(cb(blob,target-blob.l));if(target!==blob.l)throw new Error("Slurp error");return arr}function parsebool(blob,length){return blob.read_shift(length)===1}function parseuint16(blob){return blob.read_shift(2,"u")}function parseuint16a(blob,length){return parslurp(blob,length,parseuint16)}function parse_Bes(blob){var v=blob.read_shift(1),t=blob.read_shift(1);return t===1?v:v===1}function parse_ShortXLUnicodeString(blob,length,opts){var cch=blob.read_shift(opts&&opts.biff>=12?2:1),encoding="sbcs-cont",cp=current_codepage;if(opts&&opts.biff>=8&&(current_codepage=1200),!opts||opts.biff==8){var fHighByte=blob.read_shift(1);fHighByte&&(encoding="dbcs-cont")}else opts.biff==12&&(encoding="wstr");opts.biff>=2&&opts.biff<=5&&(encoding="cpstr");var o=cch?blob.read_shift(cch,encoding):"";return current_codepage=cp,o}function parse_XLUnicodeRichExtendedString(blob){var cp=current_codepage;current_codepage=1200;var cch=blob.read_shift(2),flags=blob.read_shift(1),fExtSt=flags&4,fRichSt=flags&8,width=1+(flags&1),cRun=0,cbExtRst,z={};fRichSt&&(cRun=blob.read_shift(2)),fExtSt&&(cbExtRst=blob.read_shift(4));var encoding=width==2?"dbcs-cont":"sbcs-cont",msg=cch===0?"":blob.read_shift(cch,encoding);return fRichSt&&(blob.l+=4*cRun),fExtSt&&(blob.l+=cbExtRst),z.t=msg,fRichSt||(z.raw="<t>"+z.t+"</t>",z.r=z.t),current_codepage=cp,z}function parse_XLUnicodeStringNoCch(blob,cch,opts){var retval;if(opts){if(opts.biff>=2&&opts.biff<=5)return blob.read_shift(cch,"cpstr");if(opts.biff>=12)return blob.read_shift(cch,"dbcs-cont")}var fHighByte=blob.read_shift(1);return fHighByte===0?retval=blob.read_shift(cch,"sbcs-cont"):retval=blob.read_shift(cch,"dbcs-cont"),retval}function parse_XLUnicodeString(blob,length,opts){var cch=blob.read_shift(opts&&opts.biff==2?1:2);return cch===0?(blob.l++,""):parse_XLUnicodeStringNoCch(blob,cch,opts)}function parse_XLUnicodeString2(blob,length,opts){if(opts.biff>5)return parse_XLUnicodeString(blob,length,opts);var cch=blob.read_shift(1);return cch===0?(blob.l++,""):blob.read_shift(cch,opts.biff<=4||!blob.lens?"cpstr":"sbcs-cont")}function parse_ControlInfo(blob){var flags=blob.read_shift(1);blob.l++;var accel=blob.read_shift(2);return blob.l+=2,[flags,accel]}function parse_URLMoniker(blob){var len2=blob.read_shift(4),start2=blob.l,extra=!1;len2>24&&(blob.l+=len2-24,blob.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(extra=!0),blob.l=start2);var url3=blob.read_shift((extra?len2-24:len2)>>1,"utf16le").replace(chr0,"");return extra&&(blob.l+=24),url3}function parse_FileMoniker(blob){for(var cAnti=blob.read_shift(2),preamble="";cAnti-- >0;)preamble+="../";var ansiPath=blob.read_shift(0,"lpstr-ansi");if(blob.l+=2,blob.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var sz=blob.read_shift(4);if(sz===0)return preamble+ansiPath.replace(/\\/g,"/");var bytes=blob.read_shift(4);if(blob.read_shift(2)!=3)throw new Error("Bad FileMoniker");var unicodePath=blob.read_shift(bytes>>1,"utf16le").replace(chr0,"");return preamble+unicodePath}function parse_HyperlinkMoniker(blob,length){var clsid=blob.read_shift(16);switch(length-=16,clsid){case"e0c9ea79f9bace118c8200aa004ba90b":return parse_URLMoniker(blob,length);case"0303000000000000c000000000000046":return parse_FileMoniker(blob,length);default:throw new Error("Unsupported Moniker "+clsid)}}function parse_HyperlinkString(blob){var len2=blob.read_shift(4),o=len2>0?blob.read_shift(len2,"utf16le").replace(chr0,""):"";return o}function parse_Hyperlink(blob,length){var end=blob.l+length,sVer=blob.read_shift(4);if(sVer!==2)throw new Error("Unrecognized streamVersion: "+sVer);var flags=blob.read_shift(2);blob.l+=2;var displayName,targetFrameName,moniker,oleMoniker,Loc="",guid,fileTime;flags&16&&(displayName=parse_HyperlinkString(blob,end-blob.l)),flags&128&&(targetFrameName=parse_HyperlinkString(blob,end-blob.l)),(flags&257)==257&&(moniker=parse_HyperlinkString(blob,end-blob.l)),(flags&257)==1&&(oleMoniker=parse_HyperlinkMoniker(blob,end-blob.l)),flags&8&&(Loc=parse_HyperlinkString(blob,end-blob.l)),flags&32&&(guid=blob.read_shift(16)),flags&64&&(fileTime=parse_FILETIME(blob)),blob.l=end;var target=targetFrameName||moniker||oleMoniker||"";target&&Loc&&(target+="#"+Loc),target||(target="#"+Loc),flags&2&&target.charAt(0)=="/"&&target.charAt(1)!="/"&&(target="file://"+target);var out={Target:target};return guid&&(out.guid=guid),fileTime&&(out.time=fileTime),displayName&&(out.Tooltip=displayName),out}function parse_LongRGBA(blob){var r=blob.read_shift(1),g=blob.read_shift(1),b=blob.read_shift(1),a=blob.read_shift(1);return[r,g,b,a]}function parse_LongRGB(blob,length){var x=parse_LongRGBA(blob,length);return x[3]=0,x}function parse_XLSCell(blob){var rw=blob.read_shift(2),col=blob.read_shift(2),ixfe=blob.read_shift(2);return{r:rw,c:col,ixfe}}function parse_frtHeader(blob){var rt=blob.read_shift(2),flags=blob.read_shift(2);return blob.l+=8,{type:rt,flags}}function parse_OptXLUnicodeString(blob,length,opts){return length===0?"":parse_XLUnicodeString2(blob,length,opts)}function parse_XTI(blob,length,opts){var w=opts.biff>8?4:2,iSupBook=blob.read_shift(w),itabFirst=blob.read_shift(w,"i"),itabLast=blob.read_shift(w,"i");return[iSupBook,itabFirst,itabLast]}function parse_RkRec(blob){var ixfe=blob.read_shift(2),RK=parse_RkNumber(blob);return[ixfe,RK]}function parse_AddinUdf(blob,length,opts){blob.l+=4,length-=4;var l=blob.l+length,udfName=parse_ShortXLUnicodeString(blob,length,opts),cb=blob.read_shift(2);if(l-=blob.l,cb!==l)throw new Error("Malformed AddinUdf: padding = "+l+" != "+cb);return blob.l+=cb,udfName}function parse_Ref8U(blob){var rwFirst=blob.read_shift(2),rwLast=blob.read_shift(2),colFirst=blob.read_shift(2),colLast=blob.read_shift(2);return{s:{c:colFirst,r:rwFirst},e:{c:colLast,r:rwLast}}}function parse_RefU(blob){var rwFirst=blob.read_shift(2),rwLast=blob.read_shift(2),colFirst=blob.read_shift(1),colLast=blob.read_shift(1);return{s:{c:colFirst,r:rwFirst},e:{c:colLast,r:rwLast}}}var parse_Ref=parse_RefU;function parse_FtCmo(blob){blob.l+=4;var ot=blob.read_shift(2),id=blob.read_shift(2),flags=blob.read_shift(2);return blob.l+=12,[id,ot,flags]}function parse_FtNts(blob){var out={};return blob.l+=4,blob.l+=16,out.fSharedNote=blob.read_shift(2),blob.l+=4,out}function parse_FtCf(blob){var out={};return blob.l+=4,blob.cf=blob.read_shift(2),out}function parse_FtSkip(blob){blob.l+=2,blob.l+=blob.read_shift(2)}var FtTab={0:parse_FtSkip,4:parse_FtSkip,5:parse_FtSkip,6:parse_FtSkip,7:parse_FtCf,8:parse_FtSkip,9:parse_FtSkip,10:parse_FtSkip,11:parse_FtSkip,12:parse_FtSkip,13:parse_FtNts,14:parse_FtSkip,15:parse_FtSkip,16:parse_FtSkip,17:parse_FtSkip,18:parse_FtSkip,19:parse_FtSkip,20:parse_FtSkip,21:parse_FtCmo};function parse_FtArray(blob,length){for(var tgt=blob.l+length,fts=[];blob.l<tgt;){var ft=blob.read_shift(2);blob.l-=2;try{fts.push(FtTab[ft](blob,tgt-blob.l))}catch(e){return blob.l=tgt,fts}}return blob.l!=tgt&&(blob.l=tgt),fts}function parse_BOF(blob,length){var o={BIFFVer:0,dt:0};switch(o.BIFFVer=blob.read_shift(2),length-=2,length>=2&&(o.dt=blob.read_shift(2),blob.l-=2),o.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(length>6)throw new Error("Unexpected BIFF Ver "+o.BIFFVer)}return blob.read_shift(length),o}function parse_InterfaceHdr(blob,length){return length===0||blob.read_shift(2)!==1200,1200}function parse_WriteAccess(blob,length,opts){if(opts.enc)return blob.l+=length,"";var l=blob.l,UserName=parse_XLUnicodeString2(blob,0,opts);return blob.read_shift(length+l-blob.l),UserName}function parse_WsBool(blob,length,opts){var flags=opts&&opts.biff==8||length==2?blob.read_shift(2):(blob.l+=length,0);return{fDialog:flags&16,fBelow:flags&64,fRight:flags&128}}function parse_BoundSheet8(blob,length,opts){var pos=blob.read_shift(4),hidden=blob.read_shift(1)&3,dt=blob.read_shift(1);switch(dt){case 0:dt="Worksheet";break;case 1:dt="Macrosheet";break;case 2:dt="Chartsheet";break;case 6:dt="VBAModule";break}var name=parse_ShortXLUnicodeString(blob,0,opts);return name.length===0&&(name="Sheet1"),{pos,hs:hidden,dt,name}}function parse_SST(blob,length){for(var end=blob.l+length,cnt=blob.read_shift(4),ucnt=blob.read_shift(4),strs2=[],i=0;i!=ucnt&&blob.l<end;++i)strs2.push(parse_XLUnicodeRichExtendedString(blob));return strs2.Count=cnt,strs2.Unique=ucnt,strs2}function parse_ExtSST(blob,length){var extsst={};return extsst.dsst=blob.read_shift(2),blob.l+=length-2,extsst}function parse_Row(blob){var z={};z.r=blob.read_shift(2),z.c=blob.read_shift(2),z.cnt=blob.read_shift(2)-z.c;var miyRw=blob.read_shift(2);blob.l+=4;var flags=blob.read_shift(1);return blob.l+=3,flags&7&&(z.level=flags&7),flags&32&&(z.hidden=!0),flags&64&&(z.hpt=miyRw/20),z}function parse_ForceFullCalculation(blob){var header=parse_frtHeader(blob);if(header.type!=2211)throw new Error("Invalid Future Record "+header.type);var fullcalc=blob.read_shift(4);return fullcalc!==0}function parse_RecalcId(blob){return blob.read_shift(2),blob.read_shift(4)}function parse_DefaultRowHeight(blob,length,opts){var f=0;opts&&opts.biff==2||(f=blob.read_shift(2));var miyRw=blob.read_shift(2);opts&&opts.biff==2&&(f=1-(miyRw>>15),miyRw&=32767);var fl={Unsynced:f&1,DyZero:(f&2)>>1,ExAsc:(f&4)>>2,ExDsc:(f&8)>>3};return[fl,miyRw]}function parse_Window1(blob){var xWn=blob.read_shift(2),yWn=blob.read_shift(2),dxWn=blob.read_shift(2),dyWn=blob.read_shift(2),flags=blob.read_shift(2),iTabCur=blob.read_shift(2),iTabFirst=blob.read_shift(2),ctabSel=blob.read_shift(2),wTabRatio=blob.read_shift(2);return{Pos:[xWn,yWn],Dim:[dxWn,dyWn],Flags:flags,CurTab:iTabCur,FirstTab:iTabFirst,Selected:ctabSel,TabRatio:wTabRatio}}function parse_Window2(blob,length,opts){if(opts&&opts.biff>=2&&opts.biff<5)return{};var f=blob.read_shift(2);return{RTL:f&64}}function parse_Pane(){}function parse_Font(blob,length,opts){var o={dyHeight:blob.read_shift(2),fl:blob.read_shift(2)};switch(opts&&opts.biff||8){case 2:break;case 3:case 4:blob.l+=2;break;default:blob.l+=10;break}return o.name=parse_ShortXLUnicodeString(blob,0,opts),o}function parse_LabelSst(blob){var cell=parse_XLSCell(blob);return cell.isst=blob.read_shift(4),cell}function parse_Label(blob,length,opts){opts.biffguess&&opts.biff==2&&(opts.biff=5);var target=blob.l+length,cell=parse_XLSCell(blob,6);opts.biff==2&&blob.l++;var str=parse_XLUnicodeString(blob,target-blob.l,opts);return cell.val=str,cell}function parse_Format(blob,length,opts){var numFmtId=blob.read_shift(2),fmtstr=parse_XLUnicodeString2(blob,0,opts);return[numFmtId,fmtstr]}var parse_BIFF2Format=parse_XLUnicodeString2;function parse_Dimensions(blob,length,opts){var end=blob.l+length,w=opts.biff==8||!opts.biff?4:2,r=blob.read_shift(w),R=blob.read_shift(w),c=blob.read_shift(2),C=blob.read_shift(2);return blob.l=end,{s:{r,c},e:{r:R,c:C}}}function parse_RK(blob){var rw=blob.read_shift(2),col=blob.read_shift(2),rkrec=parse_RkRec(blob);return{r:rw,c:col,ixfe:rkrec[0],rknum:rkrec[1]}}function parse_MulRk(blob,length){for(var target=blob.l+length-2,rw=blob.read_shift(2),col=blob.read_shift(2),rkrecs=[];blob.l<target;)rkrecs.push(parse_RkRec(blob));if(blob.l!==target)throw new Error("MulRK read error");var lastcol=blob.read_shift(2);if(rkrecs.length!=lastcol-col+1)throw new Error("MulRK length mismatch");return{r:rw,c:col,C:lastcol,rkrec:rkrecs}}function parse_MulBlank(blob,length){for(var target=blob.l+length-2,rw=blob.read_shift(2),col=blob.read_shift(2),ixfes=[];blob.l<target;)ixfes.push(blob.read_shift(2));if(blob.l!==target)throw new Error("MulBlank read error");var lastcol=blob.read_shift(2);if(ixfes.length!=lastcol-col+1)throw new Error("MulBlank length mismatch");return{r:rw,c:col,C:lastcol,ixfe:ixfes}}function parse_CellStyleXF(blob,length,style,opts){var o={},a=blob.read_shift(4),b=blob.read_shift(4),c=blob.read_shift(4),d=blob.read_shift(2);return o.patternType=XLSFillPattern[c>>26],opts.cellStyles&&(o.alc=a&7,o.fWrap=a>>3&1,o.alcV=a>>4&7,o.fJustLast=a>>7&1,o.trot=a>>8&255,o.cIndent=a>>16&15,o.fShrinkToFit=a>>20&1,o.iReadOrder=a>>22&2,o.fAtrNum=a>>26&1,o.fAtrFnt=a>>27&1,o.fAtrAlc=a>>28&1,o.fAtrBdr=a>>29&1,o.fAtrPat=a>>30&1,o.fAtrProt=a>>31&1,o.dgLeft=b&15,o.dgRight=b>>4&15,o.dgTop=b>>8&15,o.dgBottom=b>>12&15,o.icvLeft=b>>16&127,o.icvRight=b>>23&127,o.grbitDiag=b>>30&3,o.icvTop=c&127,o.icvBottom=c>>7&127,o.icvDiag=c>>14&127,o.dgDiag=c>>21&15,o.icvFore=d&127,o.icvBack=d>>7&127,o.fsxButton=d>>14&1),o}function parse_XF(blob,length,opts){var o={};return o.ifnt=blob.read_shift(2),o.numFmtId=blob.read_shift(2),o.flags=blob.read_shift(2),o.fStyle=o.flags>>2&1,length-=6,o.data=parse_CellStyleXF(blob,length,o.fStyle,opts),o}function parse_Guts(blob){blob.l+=4;var out=[blob.read_shift(2),blob.read_shift(2)];if(out[0]!==0&&out[0]--,out[1]!==0&&out[1]--,out[0]>7||out[1]>7)throw new Error("Bad Gutters: "+out.join("|"));return out}function parse_BoolErr(blob,length,opts){var cell=parse_XLSCell(blob,6);(opts.biff==2||length==9)&&++blob.l;var val=parse_Bes(blob,2);return cell.val=val,cell.t=val===!0||val===!1?"b":"e",cell}function parse_Number(blob,length,opts){opts.biffguess&&opts.biff==2&&(opts.biff=5);var cell=parse_XLSCell(blob,6),xnum=parse_Xnum(blob,8);return cell.val=xnum,cell}var parse_XLHeaderFooter=parse_OptXLUnicodeString;function parse_SupBook(blob,length,opts){var end=blob.l+length,ctab=blob.read_shift(2),cch=blob.read_shift(2);if(opts.sbcch=cch,cch==1025||cch==14849)return[cch,ctab];if(cch<1||cch>255)throw new Error("Unexpected SupBook type: "+cch);for(var virtPath=parse_XLUnicodeStringNoCch(blob,cch),rgst=[];end>blob.l;)rgst.push(parse_XLUnicodeString(blob));return[cch,ctab,virtPath,rgst]}function parse_ExternName(blob,length,opts){var flags=blob.read_shift(2),body,o={fBuiltIn:flags&1,fWantAdvise:flags>>>1&1,fWantPict:flags>>>2&1,fOle:flags>>>3&1,fOleLink:flags>>>4&1,cf:flags>>>5&1023,fIcon:flags>>>15&1};return opts.sbcch===14849&&(body=parse_AddinUdf(blob,length-2,opts)),o.body=body||blob.read_shift(length-2),typeof body=="string"&&(o.Name=body),o}var XLSLblBuiltIn=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function parse_Lbl(blob,length,opts){var target=blob.l+length,flags=blob.read_shift(2),chKey=blob.read_shift(1),cch=blob.read_shift(1),cce=blob.read_shift(opts&&opts.biff==2?1:2),itab=0;(!opts||opts.biff>=5)&&(opts.biff!=5&&(blob.l+=2),itab=blob.read_shift(2),opts.biff==5&&(blob.l+=2),blob.l+=4);var name=parse_XLUnicodeStringNoCch(blob,cch,opts);flags&32&&(name=XLSLblBuiltIn[name.charCodeAt(0)]);var npflen=target-blob.l;opts&&opts.biff==2&&--npflen;var rgce=target==blob.l||cce===0||!(npflen>0)?[]:parse_NameParsedFormula(blob,npflen,opts,cce);return{chKey,Name:name,itab,rgce}}function parse_ExternSheet(blob,length,opts){if(opts.biff<8)return parse_BIFF5ExternSheet(blob,length,opts);for(var o=[],target=blob.l+length,len2=blob.read_shift(opts.biff>8?4:2);len2--!=0;)o.push(parse_XTI(blob,opts.biff>8?12:6,opts));if(blob.l!=target)throw new Error("Bad ExternSheet: "+blob.l+" != "+target);return o}function parse_BIFF5ExternSheet(blob,length,opts){blob[blob.l+1]==3&&blob[blob.l]++;var o=parse_ShortXLUnicodeString(blob,length,opts);return o.charCodeAt(0)==3?o.slice(1):o}function parse_NameCmt(blob,length,opts){if(opts.biff<8){blob.l+=length;return}var cchName=blob.read_shift(2),cchComment=blob.read_shift(2),name=parse_XLUnicodeStringNoCch(blob,cchName,opts),comment=parse_XLUnicodeStringNoCch(blob,cchComment,opts);return[name,comment]}function parse_ShrFmla(blob,length,opts){var ref=parse_RefU(blob,6);blob.l++;var cUse=blob.read_shift(1);return length-=8,[parse_SharedParsedFormula(blob,length,opts),cUse,ref]}function parse_Array(blob,length,opts){var ref=parse_Ref(blob,6);switch(opts.biff){case 2:blob.l++,length-=7;break;case 3:case 4:blob.l+=2,length-=8;break;default:blob.l+=6,length-=12}return[ref,parse_ArrayParsedFormula(blob,length,opts,ref)]}function parse_MTRSettings(blob){var fMTREnabled=blob.read_shift(4)!==0,fUserSetThreadCount=blob.read_shift(4)!==0,cUserThreadCount=blob.read_shift(4);return[fMTREnabled,fUserSetThreadCount,cUserThreadCount]}function parse_NoteSh(blob,length,opts){if(!(opts.biff<8)){var row=blob.read_shift(2),col=blob.read_shift(2),flags=blob.read_shift(2),idObj=blob.read_shift(2),stAuthor=parse_XLUnicodeString2(blob,0,opts);return opts.biff<8&&blob.read_shift(1),[{r:row,c:col},stAuthor,idObj,flags]}}function parse_Note(blob,length,opts){return parse_NoteSh(blob,length,opts)}function parse_MergeCells(blob,length){for(var merges=[],cmcs=blob.read_shift(2);cmcs--;)merges.push(parse_Ref8U(blob,length));return merges}function parse_Obj(blob,length,opts){if(opts&&opts.biff<8)return parse_BIFF5Obj(blob,length,opts);var cmo=parse_FtCmo(blob,22),fts=parse_FtArray(blob,length-22,cmo[1]);return{cmo,ft:fts}}var parse_BIFF5OT={8:function(blob,length){var tgt=blob.l+length;blob.l+=10;var cf=blob.read_shift(2);blob.l+=4,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=4;var cchName=blob.read_shift(1);return blob.l+=cchName,blob.l=tgt,{fmt:cf}}};function parse_BIFF5Obj(blob,length,opts){blob.l+=4;var ot=blob.read_shift(2),id=blob.read_shift(2),grbit=blob.read_shift(2);blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=2,blob.l+=6,length-=36;var fts=[];return fts.push((parse_BIFF5OT[ot]||parsenoop)(blob,length,opts)),{cmo:[id,ot,grbit],ft:fts}}function parse_TxO(blob,length,opts){var s=blob.l,texts="";try{blob.l+=4;var ot=(opts.lastobj||{cmo:[0,0]}).cmo[1],controlInfo;[0,5,7,11,12,14].indexOf(ot)==-1?blob.l+=6:controlInfo=parse_ControlInfo(blob,6,opts);var cchText=blob.read_shift(2);blob.read_shift(2),parseuint16(blob,2);var len2=blob.read_shift(2);blob.l+=len2;for(var i=1;i<blob.lens.length-1;++i){if(blob.l-s!=blob.lens[i])throw new Error("TxO: bad continue record");var hdr=blob[blob.l],t=parse_XLUnicodeStringNoCch(blob,blob.lens[i+1]-blob.lens[i]-1);if(texts+=t,texts.length>=(hdr?cchText:2*cchText))break}if(texts.length!==cchText&&texts.length!==cchText*2)throw new Error("cchText: "+cchText+" != "+texts.length);return blob.l=s+length,{t:texts}}catch(e){return blob.l=s+length,{t:texts}}}function parse_HLink(blob,length){var ref=parse_Ref8U(blob,8);blob.l+=16;var hlink=parse_Hyperlink(blob,length-24);return[ref,hlink]}function parse_HLinkTooltip(blob,length){blob.read_shift(2);var ref=parse_Ref8U(blob,8),wzTooltip=blob.read_shift((length-10)/2,"dbcs-cont");return wzTooltip=wzTooltip.replace(chr0,""),[ref,wzTooltip]}function parse_Country(blob){var o=[0,0],d;return d=blob.read_shift(2),o[0]=CountryEnum[d]||d,d=blob.read_shift(2),o[1]=CountryEnum[d]||d,o}function parse_ClrtClient(blob){for(var ccv=blob.read_shift(2),o=[];ccv-- >0;)o.push(parse_LongRGB(blob,8));return o}function parse_Palette(blob){for(var ccv=blob.read_shift(2),o=[];ccv-- >0;)o.push(parse_LongRGB(blob,8));return o}function parse_XFCRC(blob){blob.l+=2;var o={cxfs:0,crc:0};return o.cxfs=blob.read_shift(2),o.crc=blob.read_shift(4),o}function parse_ColInfo(blob,length,opts){if(!opts.cellStyles)return parsenoop(blob,length);var w=opts&&opts.biff>=12?4:2,colFirst=blob.read_shift(w),colLast=blob.read_shift(w),coldx=blob.read_shift(w),ixfe=blob.read_shift(w),flags=blob.read_shift(2);w==2&&(blob.l+=2);var o={s:colFirst,e:colLast,w:coldx,ixfe,flags};return(opts.biff>=5||!opts.biff)&&(o.level=flags>>8&7),o}function parse_Setup(blob,length){var o={};return length<32||(blob.l+=16,o.header=parse_Xnum(blob,8),o.footer=parse_Xnum(blob,8),blob.l+=2),o}function parse_ShtProps(blob,length,opts){var def={area:!1};if(opts.biff!=5)return blob.l+=length,def;var d=blob.read_shift(1);return blob.l+=3,d&16&&(def.area=!0),def}var parse_Blank=parse_XLSCell,parse_Scl=parseuint16a,parse_String=parse_XLUnicodeString;function parse_ImData(blob){var cf=blob.read_shift(2),env=blob.read_shift(2),lcb=blob.read_shift(4),o={fmt:cf,env,len:lcb,data:blob.slice(blob.l,blob.l+lcb)};return blob.l+=lcb,o}function parse_BIFF2STR(blob,length,opts){opts.biffguess&&opts.biff==5&&(opts.biff=2);var cell=parse_XLSCell(blob,6);++blob.l;var str=parse_XLUnicodeString2(blob,length-7,opts);return cell.t="str",cell.val=str,cell}function parse_BIFF2NUM(blob){var cell=parse_XLSCell(blob,6);++blob.l;var num=parse_Xnum(blob,8);return cell.t="n",cell.val=num,cell}function parse_BIFF2INT(blob){var cell=parse_XLSCell(blob,6);++blob.l;var num=blob.read_shift(2);return cell.t="n",cell.val=num,cell}function parse_BIFF2STRING(blob){var cch=blob.read_shift(1);return cch===0?(blob.l++,""):blob.read_shift(cch,"sbcs-cont")}function parse_BIFF2FONTXTRA(blob,length){blob.l+=6,blob.l+=2,blob.l+=1,blob.l+=3,blob.l+=1,blob.l+=length-13}function parse_RString(blob,length,opts){var end=blob.l+length,cell=parse_XLSCell(blob,6),cch=blob.read_shift(2),str=parse_XLUnicodeStringNoCch(blob,cch,opts);return blob.l=end,cell.t="str",cell.val=str,cell}var DBF_SUPPORTED_VERSIONS=[2,3,48,49,131,139,140,245],DBF=function(){var dbf_codepage_map={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},dbf_reverse_map=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function dbf_to_aoa(buf,opts){var out=[],d=new_raw_buf(1);switch(opts.type){case"base64":d=s2a(Base64_decode(buf));break;case"binary":d=s2a(buf);break;case"buffer":case"array":d=buf;break}prep_blob(d,0);var ft=d.read_shift(1),memo=!!(ft&136),vfp=!1,l7=!1;switch(ft){case 2:break;case 3:break;case 48:vfp=!0,memo=!0;break;case 49:vfp=!0,memo=!0;break;case 131:break;case 139:break;case 140:l7=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+ft.toString(16))}var nrow=0,fpos=521;ft==2&&(nrow=d.read_shift(2)),d.l+=3,ft!=2&&(nrow=d.read_shift(4)),nrow>1048576&&(nrow=1e6),ft!=2&&(fpos=d.read_shift(2));var rlen=d.read_shift(2),current_cp=opts.codepage||1252;ft!=2&&(d.l+=16,d.read_shift(1),d[d.l]!==0&&(current_cp=dbf_codepage_map[d[d.l]]),d.l+=1,d.l+=2),l7&&(d.l+=36);for(var fields=[],field={},hend=Math.min(d.length,ft==2?521:fpos-10-(vfp?264:0)),ww=l7?32:11;d.l<hend&&d[d.l]!=13;)switch(field={},field.name=$cptable.utils.decode(current_cp,d.slice(d.l,d.l+ww)).replace(/[\u0000\r\n].*$/g,""),d.l+=ww,field.type=String.fromCharCode(d.read_shift(1)),ft!=2&&!l7&&(field.offset=d.read_shift(4)),field.len=d.read_shift(1),ft==2&&(field.offset=d.read_shift(2)),field.dec=d.read_shift(1),field.name.length&&fields.push(field),ft!=2&&(d.l+=l7?13:14),field.type){case"B":(!vfp||field.len!=8)&&opts.WTF&&console.log("Skipping "+field.name+":"+field.type);break;case"G":case"P":opts.WTF&&console.log("Skipping "+field.name+":"+field.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+field.type)}if(d[d.l]!==13&&(d.l=fpos-1),d.read_shift(1)!==13)throw new Error("DBF Terminator not found "+d.l+" "+d[d.l]);d.l=fpos;var R=0,C=0;for(out[0]=[],C=0;C!=fields.length;++C)out[0][C]=fields[C].name;for(;nrow-- >0;){if(d[d.l]===42){d.l+=rlen;continue}for(++d.l,out[++R]=[],C=0,C=0;C!=fields.length;++C){var dd=d.slice(d.l,d.l+fields[C].len);d.l+=fields[C].len,prep_blob(dd,0);var s=$cptable.utils.decode(current_cp,dd);switch(fields[C].type){case"C":s.trim().length&&(out[R][C]=s.replace(/\s+$/,""));break;case"D":s.length===8?out[R][C]=new Date(+s.slice(0,4),+s.slice(4,6)-1,+s.slice(6,8)):out[R][C]=s;break;case"F":out[R][C]=parseFloat(s.trim());break;case"+":case"I":out[R][C]=l7?dd.read_shift(-4,"i")^2147483648:dd.read_shift(4,"i");break;case"L":switch(s.trim().toUpperCase()){case"Y":case"T":out[R][C]=!0;break;case"N":case"F":out[R][C]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+s+"|")}break;case"M":if(!memo)throw new Error("DBF Unexpected MEMO for type "+ft.toString(16));out[R][C]="##MEMO##"+(l7?parseInt(s.trim(),10):dd.read_shift(4));break;case"N":s=s.replace(/\u0000/g,"").trim(),s&&s!="."&&(out[R][C]=+s||0);break;case"@":out[R][C]=new Date(dd.read_shift(-8,"f")-621356832e5);break;case"T":out[R][C]=new Date((dd.read_shift(4)-2440588)*864e5+dd.read_shift(4));break;case"Y":out[R][C]=dd.read_shift(4,"i")/1e4+dd.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":out[R][C]=-dd.read_shift(-8,"f");break;case"B":if(vfp&&fields[C].len==8){out[R][C]=dd.read_shift(8,"f");break}case"G":case"P":dd.l+=fields[C].len;break;case"0":if(fields[C].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+fields[C].type)}}}if(ft!=2&&d.l<d.length&&d[d.l++]!=26)throw new Error("DBF EOF Marker missing "+(d.l-1)+" of "+d.length+" "+d[d.l-1].toString(16));return opts&&opts.sheetRows&&(out=out.slice(0,opts.sheetRows)),opts.DBF=fields,out}function dbf_to_sheet(buf,opts){var o=opts||{};o.dateNF||(o.dateNF="yyyymmdd");var ws=aoa_to_sheet(dbf_to_aoa(buf,o),o);return ws["!cols"]=o.DBF.map(function(field){return{wch:field.len,DBF:field}}),delete o.DBF,ws}function dbf_to_workbook(buf,opts){try{return sheet_to_workbook(dbf_to_sheet(buf,opts),opts)}catch(e){if(opts&&opts.WTF)throw e}return{SheetNames:[],Sheets:{}}}var _RLEN={B:8,C:250,L:1,D:8,"?":0,"":0};function sheet_to_dbf(ws,opts){var o=opts||{};if(+o.codepage>=0&&set_cp(+o.codepage),o.type=="string")throw new Error("Cannot write DBF to JS string");var ba=buf_array(),aoa=sheet_to_json(ws,{header:1,raw:!0,cellDates:!0}),headers=aoa[0],data=aoa.slice(1),cols=ws["!cols"]||[],i=0,j=0,hcnt=0,rlen=1;for(i=0;i<headers.length;++i){if(((cols[i]||{}).DBF||{}).name){headers[i]=cols[i].DBF.name,++hcnt;continue}if(headers[i]!=null){if(++hcnt,typeof headers[i]=="number"&&(headers[i]=headers[i].toString(10)),typeof headers[i]!="string")throw new Error("DBF Invalid column name "+headers[i]+" |"+typeof headers[i]+"|");if(headers.indexOf(headers[i])!==i){for(j=0;j<1024;++j)if(headers.indexOf(headers[i]+"_"+j)==-1){headers[i]+="_"+j;break}}}}var range3=safe_decode_range(ws["!ref"]),coltypes=[],colwidths=[],coldecimals=[];for(i=0;i<=range3.e.c-range3.s.c;++i){var guess="",_guess="",maxlen=0,col=[];for(j=0;j<data.length;++j)data[j][i]!=null&&col.push(data[j][i]);if(col.length==0||headers[i]==null){coltypes[i]="?";continue}for(j=0;j<col.length;++j){switch(typeof col[j]){case"number":_guess="B";break;case"string":_guess="C";break;case"boolean":_guess="L";break;case"object":_guess=col[j]instanceof Date?"D":"C";break;default:_guess="C"}maxlen=Math.max(maxlen,String(col[j]).length),guess=guess&&guess!=_guess?"C":_guess}maxlen>250&&(maxlen=250),_guess=((cols[i]||{}).DBF||{}).type,_guess=="C"&&cols[i].DBF.len>maxlen&&(maxlen=cols[i].DBF.len),guess=="B"&&_guess=="N"&&(guess="N",coldecimals[i]=cols[i].DBF.dec,maxlen=cols[i].DBF.len),colwidths[i]=guess=="C"||_guess=="N"?maxlen:_RLEN[guess]||0,rlen+=colwidths[i],coltypes[i]=guess}var h=ba.next(32);for(h.write_shift(4,318902576),h.write_shift(4,data.length),h.write_shift(2,296+32*hcnt),h.write_shift(2,rlen),i=0;i<4;++i)h.write_shift(4,0);for(h.write_shift(4,0|(+dbf_reverse_map[current_ansi]||3)<<8),i=0,j=0;i<headers.length;++i)if(headers[i]!=null){var hf=ba.next(32),_f=(headers[i].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);hf.write_shift(1,_f,"sbcs"),hf.write_shift(1,coltypes[i]=="?"?"C":coltypes[i],"sbcs"),hf.write_shift(4,j),hf.write_shift(1,colwidths[i]||_RLEN[coltypes[i]]||0),hf.write_shift(1,coldecimals[i]||0),hf.write_shift(1,2),hf.write_shift(4,0),hf.write_shift(1,0),hf.write_shift(4,0),hf.write_shift(4,0),j+=colwidths[i]||_RLEN[coltypes[i]]||0}var hb=ba.next(264);for(hb.write_shift(4,13),i=0;i<65;++i)hb.write_shift(4,0);for(i=0;i<data.length;++i){var rout=ba.next(rlen);for(rout.write_shift(1,0),j=0;j<headers.length;++j)if(headers[j]!=null)switch(coltypes[j]){case"L":rout.write_shift(1,data[i][j]==null?63:data[i][j]?84:70);break;case"B":rout.write_shift(8,data[i][j]||0,"f");break;case"N":var _n="0";for(typeof data[i][j]=="number"&&(_n=data[i][j].toFixed(coldecimals[j]||0)),hcnt=0;hcnt<colwidths[j]-_n.length;++hcnt)rout.write_shift(1,32);rout.write_shift(1,_n,"sbcs");break;case"D":data[i][j]?(rout.write_shift(4,("0000"+data[i][j].getFullYear()).slice(-4),"sbcs"),rout.write_shift(2,("00"+(data[i][j].getMonth()+1)).slice(-2),"sbcs"),rout.write_shift(2,("00"+data[i][j].getDate()).slice(-2),"sbcs")):rout.write_shift(8,"00000000","sbcs");break;case"C":var _s=String(data[i][j]!=null?data[i][j]:"").slice(0,colwidths[j]);for(rout.write_shift(1,_s,"sbcs"),hcnt=0;hcnt<colwidths[j]-_s.length;++hcnt)rout.write_shift(1,32);break}}return ba.next(1).write_shift(1,26),ba.end()}return{to_workbook:dbf_to_workbook,to_sheet:dbf_to_sheet,from_sheet:sheet_to_dbf}}(),SYLK=function(){var sylk_escapes={AA:"\xC0",BA:"\xC1",CA:"\xC2",DA:195,HA:"\xC4",JA:197,AE:"\xC8",BE:"\xC9",CE:"\xCA",HE:"\xCB",AI:"\xCC",BI:"\xCD",CI:"\xCE",HI:"\xCF",AO:"\xD2",BO:"\xD3",CO:"\xD4",DO:213,HO:"\xD6",AU:"\xD9",BU:"\xDA",CU:"\xDB",HU:"\xDC",Aa:"\xE0",Ba:"\xE1",Ca:"\xE2",Da:227,Ha:"\xE4",Ja:229,Ae:"\xE8",Be:"\xE9",Ce:"\xEA",He:"\xEB",Ai:"\xEC",Bi:"\xED",Ci:"\xEE",Hi:"\xEF",Ao:"\xF2",Bo:"\xF3",Co:"\xF4",Do:245,Ho:"\xF6",Au:"\xF9",Bu:"\xFA",Cu:"\xFB",Hu:"\xFC",KC:"\xC7",Kc:"\xE7",q:"\xE6",z:"\u0153",a:"\xC6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},sylk_char_regex=new RegExp("N("+keys(sylk_escapes).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),sylk_char_fn=function(_,$1){var o=sylk_escapes[$1];return typeof o=="number"?_getansi(o):o},decode_sylk_char=function($$2,$1,$2){var newcc=$1.charCodeAt(0)-32<<4|$2.charCodeAt(0)-48;return newcc==59?$$2:_getansi(newcc)};sylk_escapes["|"]=254;function sylk_to_aoa(d,opts){switch(opts.type){case"base64":return sylk_to_aoa_str(Base64_decode(d),opts);case"binary":return sylk_to_aoa_str(d,opts);case"buffer":return sylk_to_aoa_str(has_buf&&Buffer.isBuffer(d)?d.toString("binary"):a2s(d),opts);case"array":return sylk_to_aoa_str(cc2str(d),opts)}throw new Error("Unrecognized type "+opts.type)}function sylk_to_aoa_str(str,opts){var records=str.split(/[\n\r]+/),R=-1,C=-1,ri=0,rj=0,arr=[],formats2=[],next_cell_format=null,sht={},rowinfo=[],colinfo=[],cw=[],Mval=0,j;for(+opts.codepage>=0&&set_cp(+opts.codepage);ri!==records.length;++ri){Mval=0;var rstr=records[ri].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,decode_sylk_char).replace(sylk_char_regex,sylk_char_fn),record=rstr.replace(/;;/g,"\0").split(";").map(function(x){return x.replace(/\u0000/g,";")}),RT=record[0],val;if(rstr.length>0)switch(RT){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":record[1].charAt(0)=="P"&&formats2.push(rstr.slice(3).replace(/;;/g,";"));break;case"C":var C_seen_K=!1,C_seen_X=!1,C_seen_S=!1,C_seen_E=!1,_R=-1,_C=-1;for(rj=1;rj<record.length;++rj)switch(record[rj].charAt(0)){case"A":break;case"X":C=parseInt(record[rj].slice(1))-1,C_seen_X=!0;break;case"Y":for(R=parseInt(record[rj].slice(1))-1,C_seen_X||(C=0),j=arr.length;j<=R;++j)arr[j]=[];break;case"K":val=record[rj].slice(1),val.charAt(0)==='"'?val=val.slice(1,val.length-1):val==="TRUE"?val=!0:val==="FALSE"?val=!1:isNaN(fuzzynum(val))?isNaN(fuzzydate(val).getDate())||(val=parseDate(val)):(val=fuzzynum(val),next_cell_format!==null&&fmt_is_date(next_cell_format)&&(val=numdate(val))),typeof $cptable!="undefined"&&typeof val=="string"&&(opts||{}).type!="string"&&(opts||{}).codepage&&(val=$cptable.utils.decode(opts.codepage,val)),C_seen_K=!0;break;case"E":C_seen_E=!0;var formula=rc_to_a1(record[rj].slice(1),{r:R,c:C});arr[R][C]=[arr[R][C],formula];break;case"S":C_seen_S=!0,arr[R][C]=[arr[R][C],"S5S"];break;case"G":break;case"R":_R=parseInt(record[rj].slice(1))-1;break;case"C":_C=parseInt(record[rj].slice(1))-1;break;default:if(opts&&opts.WTF)throw new Error("SYLK bad record "+rstr)}if(C_seen_K&&(arr[R][C]&&arr[R][C].length==2?arr[R][C][0]=val:arr[R][C]=val,next_cell_format=null),C_seen_S){if(C_seen_E)throw new Error("SYLK shared formula cannot have own formula");var shrbase=_R>-1&&arr[_R][_C];if(!shrbase||!shrbase[1])throw new Error("SYLK shared formula cannot find base");arr[R][C][1]=shift_formula_str(shrbase[1],{r:R-_R,c:C-_C})}break;case"F":var F_seen=0;for(rj=1;rj<record.length;++rj)switch(record[rj].charAt(0)){case"X":C=parseInt(record[rj].slice(1))-1,++F_seen;break;case"Y":for(R=parseInt(record[rj].slice(1))-1,j=arr.length;j<=R;++j)arr[j]=[];break;case"M":Mval=parseInt(record[rj].slice(1))/20;break;case"F":break;case"G":break;case"P":next_cell_format=formats2[parseInt(record[rj].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(cw=record[rj].slice(1).split(" "),j=parseInt(cw[0],10);j<=parseInt(cw[1],10);++j)Mval=parseInt(cw[2],10),colinfo[j-1]=Mval===0?{hidden:!0}:{wch:Mval},process_col(colinfo[j-1]);break;case"C":C=parseInt(record[rj].slice(1))-1,colinfo[C]||(colinfo[C]={});break;case"R":R=parseInt(record[rj].slice(1))-1,rowinfo[R]||(rowinfo[R]={}),Mval>0?(rowinfo[R].hpt=Mval,rowinfo[R].hpx=pt2px(Mval)):Mval===0&&(rowinfo[R].hidden=!0);break;default:if(opts&&opts.WTF)throw new Error("SYLK bad record "+rstr)}F_seen<1&&(next_cell_format=null);break;default:if(opts&&opts.WTF)throw new Error("SYLK bad record "+rstr)}}return rowinfo.length>0&&(sht["!rows"]=rowinfo),colinfo.length>0&&(sht["!cols"]=colinfo),opts&&opts.sheetRows&&(arr=arr.slice(0,opts.sheetRows)),[arr,sht]}function sylk_to_sheet(d,opts){var aoasht=sylk_to_aoa(d,opts),aoa=aoasht[0],ws=aoasht[1],o=aoa_to_sheet(aoa,opts);return keys(ws).forEach(function(k){o[k]=ws[k]}),o}function sylk_to_workbook(d,opts){return sheet_to_workbook(sylk_to_sheet(d,opts),opts)}function write_ws_cell_sylk(cell,ws,R,C){var o="C;Y"+(R+1)+";X"+(C+1)+";K";switch(cell.t){case"n":o+=cell.v||0,cell.f&&!cell.F&&(o+=";E"+a1_to_rc(cell.f,{r:R,c:C}));break;case"b":o+=cell.v?"TRUE":"FALSE";break;case"e":o+=cell.w||cell.v;break;case"d":o+='"'+(cell.w||cell.v)+'"';break;case"s":o+='"'+cell.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return o}function write_ws_cols_sylk(out,cols){cols.forEach(function(col,i){var rec="F;W"+(i+1)+" "+(i+1)+" ";col.hidden?rec+="0":(typeof col.width=="number"&&!col.wpx&&(col.wpx=width2px(col.width)),typeof col.wpx=="number"&&!col.wch&&(col.wch=px2char(col.wpx)),typeof col.wch=="number"&&(rec+=Math.round(col.wch))),rec.charAt(rec.length-1)!=" "&&out.push(rec)})}function write_ws_rows_sylk(out,rows){rows.forEach(function(row,i){var rec="F;";row.hidden?rec+="M0;":row.hpt?rec+="M"+20*row.hpt+";":row.hpx&&(rec+="M"+20*px2pt(row.hpx)+";"),rec.length>2&&out.push(rec+"R"+(i+1))})}function sheet_to_sylk(ws,opts){var preamble=["ID;PWXL;N;E"],o=[],r=safe_decode_range(ws["!ref"]),cell,dense=Array.isArray(ws),RS=`\r
`;preamble.push("P;PGeneral"),preamble.push("F;P0;DG0G8;M255"),ws["!cols"]&&write_ws_cols_sylk(preamble,ws["!cols"]),ws["!rows"]&&write_ws_rows_sylk(preamble,ws["!rows"]),preamble.push("B;Y"+(r.e.r-r.s.r+1)+";X"+(r.e.c-r.s.c+1)+";D"+[r.s.c,r.s.r,r.e.c,r.e.r].join(" "));for(var R=r.s.r;R<=r.e.r;++R)for(var C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});cell=dense?(ws[R]||[])[C]:ws[coord],!(!cell||cell.v==null&&(!cell.f||cell.F))&&o.push(write_ws_cell_sylk(cell,ws,R,C,opts))}return preamble.join(RS)+RS+o.join(RS)+RS+"E"+RS}return{to_workbook:sylk_to_workbook,to_sheet:sylk_to_sheet,from_sheet:sheet_to_sylk}}(),DIF=function(){function dif_to_aoa(d,opts){switch(opts.type){case"base64":return dif_to_aoa_str(Base64_decode(d),opts);case"binary":return dif_to_aoa_str(d,opts);case"buffer":return dif_to_aoa_str(has_buf&&Buffer.isBuffer(d)?d.toString("binary"):a2s(d),opts);case"array":return dif_to_aoa_str(cc2str(d),opts)}throw new Error("Unrecognized type "+opts.type)}function dif_to_aoa_str(str,opts){for(var records=str.split(`
`),R=-1,C=-1,ri=0,arr=[];ri!==records.length;++ri){if(records[ri].trim()==="BOT"){arr[++R]=[],C=0;continue}if(!(R<0)){var metadata=records[ri].trim().split(","),type=metadata[0],value=metadata[1];++ri;for(var data=records[ri]||"";(data.match(/["]/g)||[]).length&1&&ri<records.length-1;)data+=`
`+records[++ri];switch(data=data.trim(),+type){case-1:if(data==="BOT"){arr[++R]=[],C=0;continue}else if(data!=="EOD")throw new Error("Unrecognized DIF special command "+data);break;case 0:data==="TRUE"?arr[R][C]=!0:data==="FALSE"?arr[R][C]=!1:isNaN(fuzzynum(value))?isNaN(fuzzydate(value).getDate())?arr[R][C]=value:arr[R][C]=parseDate(value):arr[R][C]=fuzzynum(value),++C;break;case 1:data=data.slice(1,data.length-1),data=data.replace(/""/g,'"'),DIF_XL&&data&&data.match(/^=".*"$/)&&(data=data.slice(2,-1)),arr[R][C++]=data!==""?data:null;break}if(data==="EOD")break}}return opts&&opts.sheetRows&&(arr=arr.slice(0,opts.sheetRows)),arr}function dif_to_sheet(str,opts){return aoa_to_sheet(dif_to_aoa(str,opts),opts)}function dif_to_workbook(str,opts){return sheet_to_workbook(dif_to_sheet(str,opts),opts)}var sheet_to_dif=function(){var push_field=function(o,topic,v,n,s){o.push(topic),o.push(v+","+n),o.push('"'+s.replace(/"/g,'""')+'"')},push_value=function(o,type,v,s){o.push(type+","+v),o.push(type==1?'"'+s.replace(/"/g,'""')+'"':s)};return function(ws){var o=[],r=safe_decode_range(ws["!ref"]),cell,dense=Array.isArray(ws);push_field(o,"TABLE",0,1,"sheetjs"),push_field(o,"VECTORS",0,r.e.r-r.s.r+1,""),push_field(o,"TUPLES",0,r.e.c-r.s.c+1,""),push_field(o,"DATA",0,0,"");for(var R=r.s.r;R<=r.e.r;++R){push_value(o,-1,0,"BOT");for(var C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});if(cell=dense?(ws[R]||[])[C]:ws[coord],!cell){push_value(o,1,0,"");continue}switch(cell.t){case"n":var val=DIF_XL?cell.w:cell.v;!val&&cell.v!=null&&(val=cell.v),val==null?DIF_XL&&cell.f&&!cell.F?push_value(o,1,0,"="+cell.f):push_value(o,1,0,""):push_value(o,0,val,"V");break;case"b":push_value(o,0,cell.v?1:0,cell.v?"TRUE":"FALSE");break;case"s":push_value(o,1,0,!DIF_XL||isNaN(cell.v)?cell.v:'="'+cell.v+'"');break;case"d":cell.w||(cell.w=SSF_format(cell.z||table_fmt[14],datenum(parseDate(cell.v)))),DIF_XL?push_value(o,0,cell.w,"V"):push_value(o,1,0,cell.w);break;default:push_value(o,1,0,"")}}}push_value(o,-1,0,"EOD");var RS=`\r
`,oo=o.join(RS);return oo}}();return{to_workbook:dif_to_workbook,to_sheet:dif_to_sheet,from_sheet:sheet_to_dif}}(),ETH=function(){function decode2(s){return s.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function encode2(s){return s.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function eth_to_aoa(str,opts){for(var records=str.split(`
`),R=-1,C=-1,ri=0,arr=[];ri!==records.length;++ri){var record=records[ri].trim().split(":");if(record[0]==="cell"){var addr=decode_cell(record[1]);if(arr.length<=addr.r)for(R=arr.length;R<=addr.r;++R)arr[R]||(arr[R]=[]);switch(R=addr.r,C=addr.c,record[2]){case"t":arr[R][C]=decode2(record[3]);break;case"v":arr[R][C]=+record[3];break;case"vtf":var _f=record[record.length-1];case"vtc":switch(record[3]){case"nl":arr[R][C]=!!+record[4];break;default:arr[R][C]=+record[4];break}record[2]=="vtf"&&(arr[R][C]=[arr[R][C],_f])}}}return opts&&opts.sheetRows&&(arr=arr.slice(0,opts.sheetRows)),arr}function eth_to_sheet(d,opts){return aoa_to_sheet(eth_to_aoa(d,opts),opts)}function eth_to_workbook(d,opts){return sheet_to_workbook(eth_to_sheet(d,opts),opts)}var header=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),sep=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,meta=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),end="--SocialCalcSpreadsheetControlSave--";function sheet_to_eth_data(ws){if(!ws||!ws["!ref"])return"";for(var o=[],oo=[],cell,coord="",r=decode_range(ws["!ref"]),dense=Array.isArray(ws),R=r.s.r;R<=r.e.r;++R)for(var C=r.s.c;C<=r.e.c;++C)if(coord=encode_cell({r:R,c:C}),cell=dense?(ws[R]||[])[C]:ws[coord],!(!cell||cell.v==null||cell.t==="z")){switch(oo=["cell",coord,"t"],cell.t){case"s":case"str":oo.push(encode2(cell.v));break;case"n":cell.f?(oo[2]="vtf",oo[3]="n",oo[4]=cell.v,oo[5]=encode2(cell.f)):(oo[2]="v",oo[3]=cell.v);break;case"b":oo[2]="vt"+(cell.f?"f":"c"),oo[3]="nl",oo[4]=cell.v?"1":"0",oo[5]=encode2(cell.f||(cell.v?"TRUE":"FALSE"));break;case"d":var t=datenum(parseDate(cell.v));oo[2]="vtc",oo[3]="nd",oo[4]=""+t,oo[5]=cell.w||SSF_format(cell.z||table_fmt[14],t);break;case"e":continue}o.push(oo.join(":"))}return o.push("sheet:c:"+(r.e.c-r.s.c+1)+":r:"+(r.e.r-r.s.r+1)+":tvf:1"),o.push("valueformat:1:text-wiki"),o.join(`
`)}function sheet_to_eth(ws){return[header,sep,meta,sep,sheet_to_eth_data(ws),end].join(`
`)}return{to_workbook:eth_to_workbook,to_sheet:eth_to_sheet,from_sheet:sheet_to_eth}}(),PRN=function(){function set_text_arr(data,arr,R,C,o){o.raw?arr[R][C]=data:data===""||(data==="TRUE"?arr[R][C]=!0:data==="FALSE"?arr[R][C]=!1:isNaN(fuzzynum(data))?isNaN(fuzzydate(data).getDate())?arr[R][C]=data:arr[R][C]=parseDate(data):arr[R][C]=fuzzynum(data))}function prn_to_aoa_str(f,opts){var o=opts||{},arr=[];if(!f||f.length===0)return arr;for(var lines=f.split(/[\r\n]/),L=lines.length-1;L>=0&&lines[L].length===0;)--L;for(var start2=10,idx=0,R=0;R<=L;++R)idx=lines[R].indexOf(" "),idx==-1?idx=lines[R].length:idx++,start2=Math.max(start2,idx);for(R=0;R<=L;++R){arr[R]=[];var C=0;for(set_text_arr(lines[R].slice(0,start2).trim(),arr,R,C,o),C=1;C<=(lines[R].length-start2)/10+1;++C)set_text_arr(lines[R].slice(start2+(C-1)*10,start2+C*10).trim(),arr,R,C,o)}return o.sheetRows&&(arr=arr.slice(0,o.sheetRows)),arr}var guess_seps={44:",",9:"	",59:";",124:"|"},guess_sep_weights={44:3,9:2,59:1,124:0};function guess_sep(str){for(var cnt={},instr=!1,end=0,cc=0;end<str.length;++end)(cc=str.charCodeAt(end))==34?instr=!instr:!instr&&cc in guess_seps&&(cnt[cc]=(cnt[cc]||0)+1);cc=[];for(end in cnt)Object.prototype.hasOwnProperty.call(cnt,end)&&cc.push([cnt[end],end]);if(!cc.length){cnt=guess_sep_weights;for(end in cnt)Object.prototype.hasOwnProperty.call(cnt,end)&&cc.push([cnt[end],end])}return cc.sort(function(a,b){return a[0]-b[0]||guess_sep_weights[a[1]]-guess_sep_weights[b[1]]}),guess_seps[cc.pop()[1]]||44}function dsv_to_sheet_str(str,opts){var o=opts||{},sep="";DENSE!=null&&o.dense==null&&(o.dense=DENSE);var ws=o.dense?[]:{},range3={s:{c:0,r:0},e:{c:0,r:0}};str.slice(0,4)=="sep="?str.charCodeAt(5)==13&&str.charCodeAt(6)==10?(sep=str.charAt(4),str=str.slice(7)):str.charCodeAt(5)==13||str.charCodeAt(5)==10?(sep=str.charAt(4),str=str.slice(6)):sep=guess_sep(str.slice(0,1024)):o&&o.FS?sep=o.FS:sep=guess_sep(str.slice(0,1024));var R=0,C=0,v=0,start2=0,end=0,sepcc=sep.charCodeAt(0),instr=!1,cc=0,startcc=str.charCodeAt(0);str=str.replace(/\r\n/mg,`
`);var _re=o.dateNF!=null?dateNF_regex(o.dateNF):null;function finish_cell(){var s=str.slice(start2,end),cell={};if(s.charAt(0)=='"'&&s.charAt(s.length-1)=='"'&&(s=s.slice(1,-1).replace(/""/g,'"')),s.length===0)cell.t="z";else if(o.raw)cell.t="s",cell.v=s;else if(s.trim().length===0)cell.t="s",cell.v=s;else if(s.charCodeAt(0)==61)s.charCodeAt(1)==34&&s.charCodeAt(s.length-1)==34?(cell.t="s",cell.v=s.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(s)?(cell.t="n",cell.f=s.slice(1)):(cell.t="s",cell.v=s);else if(s=="TRUE")cell.t="b",cell.v=!0;else if(s=="FALSE")cell.t="b",cell.v=!1;else if(!isNaN(v=fuzzynum(s)))cell.t="n",o.cellText!==!1&&(cell.w=s),cell.v=v;else if(!isNaN(fuzzydate(s).getDate())||_re&&s.match(_re)){cell.z=o.dateNF||table_fmt[14];var k=0;_re&&s.match(_re)&&(s=dateNF_fix(s,o.dateNF,s.match(_re)||[]),k=1),o.cellDates?(cell.t="d",cell.v=parseDate(s,k)):(cell.t="n",cell.v=datenum(parseDate(s,k))),o.cellText!==!1&&(cell.w=SSF_format(cell.z,cell.v instanceof Date?datenum(cell.v):cell.v)),o.cellNF||delete cell.z}else cell.t="s",cell.v=s;if(cell.t=="z"||(o.dense?(ws[R]||(ws[R]=[]),ws[R][C]=cell):ws[encode_cell({c:C,r:R})]=cell),start2=end+1,startcc=str.charCodeAt(start2),range3.e.c<C&&(range3.e.c=C),range3.e.r<R&&(range3.e.r=R),cc==sepcc)++C;else if(C=0,++R,o.sheetRows&&o.sheetRows<=R)return!0}outer:for(;end<str.length;++end)switch(cc=str.charCodeAt(end)){case 34:startcc===34&&(instr=!instr);break;case sepcc:case 10:case 13:if(!instr&&finish_cell())break outer;break;default:break}return end-start2>0&&finish_cell(),ws["!ref"]=encode_range(range3),ws}function prn_to_sheet_str(str,opts){return!(opts&&opts.PRN)||opts.FS||str.slice(0,4)=="sep="||str.indexOf("	")>=0||str.indexOf(",")>=0||str.indexOf(";")>=0?dsv_to_sheet_str(str,opts):aoa_to_sheet(prn_to_aoa_str(str,opts),opts)}function prn_to_sheet(d,opts){var str="",bytes=opts.type=="string"?[0,0,0,0]:firstbyte(d,opts);switch(opts.type){case"base64":str=Base64_decode(d);break;case"binary":str=d;break;case"buffer":opts.codepage==65001?str=d.toString("utf8"):opts.codepage&&typeof $cptable!="undefined"?str=$cptable.utils.decode(opts.codepage,d):str=has_buf&&Buffer.isBuffer(d)?d.toString("binary"):a2s(d);break;case"array":str=cc2str(d);break;case"string":str=d;break;default:throw new Error("Unrecognized type "+opts.type)}return bytes[0]==239&&bytes[1]==187&&bytes[2]==191?str=utf8read(str.slice(3)):opts.type!="string"&&opts.type!="buffer"&&opts.codepage==65001?str=utf8read(str):opts.type=="binary"&&typeof $cptable!="undefined"&&opts.codepage&&(str=$cptable.utils.decode(opts.codepage,$cptable.utils.encode(28591,str))),str.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(opts.type=="string"?str:utf8read(str),opts):prn_to_sheet_str(str,opts)}function prn_to_workbook(d,opts){return sheet_to_workbook(prn_to_sheet(d,opts),opts)}function sheet_to_prn(ws){for(var o=[],r=safe_decode_range(ws["!ref"]),cell,dense=Array.isArray(ws),R=r.s.r;R<=r.e.r;++R){for(var oo=[],C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});if(cell=dense?(ws[R]||[])[C]:ws[coord],!cell||cell.v==null){oo.push("          ");continue}for(var w=(cell.w||(format_cell(cell),cell.w)||"").slice(0,10);w.length<10;)w+=" ";oo.push(w+(C===0?" ":""))}o.push(oo.join(""))}return o.join(`
`)}return{to_workbook:prn_to_workbook,to_sheet:prn_to_sheet,from_sheet:sheet_to_prn}}();function read_wb_ID(d,opts){var o=opts||{},OLD_WTF=!!o.WTF;o.WTF=!0;try{var out=SYLK.to_workbook(d,o);return o.WTF=OLD_WTF,out}catch(e){if(o.WTF=OLD_WTF,!e.message.match(/SYLK bad record ID/)&&OLD_WTF)throw e;return PRN.to_workbook(d,opts)}}var WK_=function(){function lotushopper(data,cb,opts){if(!!data){prep_blob(data,data.l||0);for(var Enum=opts.Enum||WK1Enum;data.l<data.length;){var RT=data.read_shift(2),R=Enum[RT]||Enum[65535],length=data.read_shift(2),tgt=data.l+length,d=R.f&&R.f(data,length,opts);if(data.l=tgt,cb(d,R,RT))return}}}function lotus_to_workbook(d,opts){switch(opts.type){case"base64":return lotus_to_workbook_buf(s2a(Base64_decode(d)),opts);case"binary":return lotus_to_workbook_buf(s2a(d),opts);case"buffer":case"array":return lotus_to_workbook_buf(d,opts)}throw"Unsupported type "+opts.type}function lotus_to_workbook_buf(d,opts){if(!d)return d;var o=opts||{};DENSE!=null&&o.dense==null&&(o.dense=DENSE);var s=o.dense?[]:{},n="Sheet1",next_n="",sidx=0,sheets={},snames=[],realnames=[],refguess={s:{r:0,c:0},e:{r:0,c:0}},sheetRows=o.sheetRows||0;if(d[2]==0&&(d[3]==8||d[3]==9)&&d.length>=16&&d[14]==5&&d[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(d[2]==2)o.Enum=WK1Enum,lotushopper(d,function(val,R,RT){switch(RT){case 0:o.vers=val,val>=4096&&(o.qpro=!0);break;case 6:refguess=val;break;case 204:val&&(next_n=val);break;case 222:next_n=val;break;case 15:case 51:o.qpro||(val[1].v=val[1].v.slice(1));case 13:case 14:case 16:RT==14&&(val[2]&112)==112&&(val[2]&15)>1&&(val[2]&15)<15&&(val[1].z=o.dateNF||table_fmt[14],o.cellDates&&(val[1].t="d",val[1].v=numdate(val[1].v))),o.qpro&&val[3]>sidx&&(s["!ref"]=encode_range(refguess),sheets[n]=s,snames.push(n),s=o.dense?[]:{},refguess={s:{r:0,c:0},e:{r:0,c:0}},sidx=val[3],n=next_n||"Sheet"+(sidx+1),next_n="");var tmpcell=o.dense?(s[val[0].r]||[])[val[0].c]:s[encode_cell(val[0])];if(tmpcell){tmpcell.t=val[1].t,tmpcell.v=val[1].v,val[1].z!=null&&(tmpcell.z=val[1].z),val[1].f!=null&&(tmpcell.f=val[1].f);break}o.dense?(s[val[0].r]||(s[val[0].r]=[]),s[val[0].r][val[0].c]=val[1]):s[encode_cell(val[0])]=val[1];break;default:}},o);else if(d[2]==26||d[2]==14)o.Enum=WK3Enum,d[2]==14&&(o.qpro=!0,d.l=0),lotushopper(d,function(val,R,RT){switch(RT){case 204:n=val;break;case 22:val[1].v=val[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(val[3]>sidx&&(s["!ref"]=encode_range(refguess),sheets[n]=s,snames.push(n),s=o.dense?[]:{},refguess={s:{r:0,c:0},e:{r:0,c:0}},sidx=val[3],n="Sheet"+(sidx+1)),sheetRows>0&&val[0].r>=sheetRows)break;o.dense?(s[val[0].r]||(s[val[0].r]=[]),s[val[0].r][val[0].c]=val[1]):s[encode_cell(val[0])]=val[1],refguess.e.c<val[0].c&&(refguess.e.c=val[0].c),refguess.e.r<val[0].r&&(refguess.e.r=val[0].r);break;case 27:val[14e3]&&(realnames[val[14e3][0]]=val[14e3][1]);break;case 1537:realnames[val[0]]=val[1],val[0]==sidx&&(n=val[1]);break;default:break}},o);else throw new Error("Unrecognized LOTUS BOF "+d[2]);if(s["!ref"]=encode_range(refguess),sheets[next_n||n]=s,snames.push(next_n||n),!realnames.length)return{SheetNames:snames,Sheets:sheets};for(var osheets={},rnames=[],i=0;i<realnames.length;++i)sheets[snames[i]]?(rnames.push(realnames[i]||snames[i]),osheets[realnames[i]]=sheets[realnames[i]]||sheets[snames[i]]):(rnames.push(realnames[i]),osheets[realnames[i]]={"!ref":"A1"});return{SheetNames:rnames,Sheets:osheets}}function sheet_to_wk1(ws,opts){var o=opts||{};if(+o.codepage>=0&&set_cp(+o.codepage),o.type=="string")throw new Error("Cannot write WK1 to JS string");var ba=buf_array(),range3=safe_decode_range(ws["!ref"]),dense=Array.isArray(ws),cols=[];write_biff_rec(ba,0,write_BOF_WK1(1030)),write_biff_rec(ba,6,write_RANGE(range3));for(var max_R=Math.min(range3.e.r,8191),R=range3.s.r;R<=max_R;++R)for(var rr=encode_row(R),C=range3.s.c;C<=range3.e.c;++C){R===range3.s.r&&(cols[C]=encode_col(C));var ref=cols[C]+rr,cell=dense?(ws[R]||[])[C]:ws[ref];if(!(!cell||cell.t=="z"))if(cell.t=="n")(cell.v|0)==cell.v&&cell.v>=-32768&&cell.v<=32767?write_biff_rec(ba,13,write_INTEGER(R,C,cell.v)):write_biff_rec(ba,14,write_NUMBER(R,C,cell.v));else{var str=format_cell(cell);write_biff_rec(ba,15,write_LABEL(R,C,str.slice(0,239)))}}return write_biff_rec(ba,1),ba.end()}function book_to_wk3(wb,opts){var o=opts||{};if(+o.codepage>=0&&set_cp(+o.codepage),o.type=="string")throw new Error("Cannot write WK3 to JS string");var ba=buf_array();write_biff_rec(ba,0,write_BOF_WK3(wb));for(var i=0,cnt=0;i<wb.SheetNames.length;++i)(wb.Sheets[wb.SheetNames[i]]||{})["!ref"]&&write_biff_rec(ba,27,write_XFORMAT_SHEETNAME(wb.SheetNames[i],cnt++));var wsidx=0;for(i=0;i<wb.SheetNames.length;++i){var ws=wb.Sheets[wb.SheetNames[i]];if(!(!ws||!ws["!ref"])){for(var range3=safe_decode_range(ws["!ref"]),dense=Array.isArray(ws),cols=[],max_R=Math.min(range3.e.r,8191),R=range3.s.r;R<=max_R;++R)for(var rr=encode_row(R),C=range3.s.c;C<=range3.e.c;++C){R===range3.s.r&&(cols[C]=encode_col(C));var ref=cols[C]+rr,cell=dense?(ws[R]||[])[C]:ws[ref];if(!(!cell||cell.t=="z"))if(cell.t=="n")write_biff_rec(ba,23,write_NUMBER_17(R,C,wsidx,cell.v));else{var str=format_cell(cell);write_biff_rec(ba,22,write_LABEL_16(R,C,wsidx,str.slice(0,239)))}}++wsidx}}return write_biff_rec(ba,1),ba.end()}function write_BOF_WK1(v){var out=new_buf(2);return out.write_shift(2,v),out}function write_BOF_WK3(wb){var out=new_buf(26);out.write_shift(2,4096),out.write_shift(2,4),out.write_shift(4,0);for(var rows=0,cols=0,wscnt=0,i=0;i<wb.SheetNames.length;++i){var name=wb.SheetNames[i],ws=wb.Sheets[name];if(!(!ws||!ws["!ref"])){++wscnt;var range3=decode_range(ws["!ref"]);rows<range3.e.r&&(rows=range3.e.r),cols<range3.e.c&&(cols=range3.e.c)}}return rows>8191&&(rows=8191),out.write_shift(2,rows),out.write_shift(1,wscnt),out.write_shift(1,cols),out.write_shift(2,0),out.write_shift(2,0),out.write_shift(1,1),out.write_shift(1,2),out.write_shift(4,0),out.write_shift(4,0),out}function parse_RANGE(blob,length,opts){var o={s:{c:0,r:0},e:{c:0,r:0}};return length==8&&opts.qpro?(o.s.c=blob.read_shift(1),blob.l++,o.s.r=blob.read_shift(2),o.e.c=blob.read_shift(1),blob.l++,o.e.r=blob.read_shift(2),o):(o.s.c=blob.read_shift(2),o.s.r=blob.read_shift(2),length==12&&opts.qpro&&(blob.l+=2),o.e.c=blob.read_shift(2),o.e.r=blob.read_shift(2),length==12&&opts.qpro&&(blob.l+=2),o.s.c==65535&&(o.s.c=o.e.c=o.s.r=o.e.r=0),o)}function write_RANGE(range3){var out=new_buf(8);return out.write_shift(2,range3.s.c),out.write_shift(2,range3.s.r),out.write_shift(2,range3.e.c),out.write_shift(2,range3.e.r),out}function parse_cell(blob,length,opts){var o=[{c:0,r:0},{t:"n",v:0},0,0];return opts.qpro&&opts.vers!=20768?(o[0].c=blob.read_shift(1),o[3]=blob.read_shift(1),o[0].r=blob.read_shift(2),blob.l+=2):(o[2]=blob.read_shift(1),o[0].c=blob.read_shift(2),o[0].r=blob.read_shift(2)),o}function parse_LABEL(blob,length,opts){var tgt=blob.l+length,o=parse_cell(blob,length,opts);if(o[1].t="s",opts.vers==20768){blob.l++;var len2=blob.read_shift(1);return o[1].v=blob.read_shift(len2,"utf8"),o}return opts.qpro&&blob.l++,o[1].v=blob.read_shift(tgt-blob.l,"cstr"),o}function write_LABEL(R,C,s){var o=new_buf(7+s.length);o.write_shift(1,255),o.write_shift(2,C),o.write_shift(2,R),o.write_shift(1,39);for(var i=0;i<o.length;++i){var cc=s.charCodeAt(i);o.write_shift(1,cc>=128?95:cc)}return o.write_shift(1,0),o}function parse_INTEGER(blob,length,opts){var o=parse_cell(blob,length,opts);return o[1].v=blob.read_shift(2,"i"),o}function write_INTEGER(R,C,v){var o=new_buf(7);return o.write_shift(1,255),o.write_shift(2,C),o.write_shift(2,R),o.write_shift(2,v,"i"),o}function parse_NUMBER(blob,length,opts){var o=parse_cell(blob,length,opts);return o[1].v=blob.read_shift(8,"f"),o}function write_NUMBER(R,C,v){var o=new_buf(13);return o.write_shift(1,255),o.write_shift(2,C),o.write_shift(2,R),o.write_shift(8,v,"f"),o}function parse_FORMULA(blob,length,opts){var tgt=blob.l+length,o=parse_cell(blob,length,opts);if(o[1].v=blob.read_shift(8,"f"),opts.qpro)blob.l=tgt;else{var flen=blob.read_shift(2);wk1_fmla_to_csf(blob.slice(blob.l,blob.l+flen),o),blob.l+=flen}return o}function wk1_parse_rc(B,V,col){var rel=V&32768;return V&=~32768,V=(rel?B:0)+(V>=8192?V-16384:V),(rel?"":"$")+(col?encode_col(V):encode_row(V))}var FuncTab={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},BinOpTab=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function wk1_fmla_to_csf(blob,o){prep_blob(blob,0);for(var out=[],argc=0,R="",C="",argL="",argR="";blob.l<blob.length;){var cc=blob[blob.l++];switch(cc){case 0:out.push(blob.read_shift(8,"f"));break;case 1:C=wk1_parse_rc(o[0].c,blob.read_shift(2),!0),R=wk1_parse_rc(o[0].r,blob.read_shift(2),!1),out.push(C+R);break;case 2:{var c=wk1_parse_rc(o[0].c,blob.read_shift(2),!0),r=wk1_parse_rc(o[0].r,blob.read_shift(2),!1);C=wk1_parse_rc(o[0].c,blob.read_shift(2),!0),R=wk1_parse_rc(o[0].r,blob.read_shift(2),!1),out.push(c+r+":"+C+R)}break;case 3:if(blob.l<blob.length){console.error("WK1 premature formula end");return}break;case 4:out.push("("+out.pop()+")");break;case 5:out.push(blob.read_shift(2));break;case 6:{for(var Z="";cc=blob[blob.l++];)Z+=String.fromCharCode(cc);out.push('"'+Z.replace(/"/g,'""')+'"')}break;case 8:out.push("-"+out.pop());break;case 23:out.push("+"+out.pop());break;case 22:out.push("NOT("+out.pop()+")");break;case 20:case 21:argR=out.pop(),argL=out.pop(),out.push(["AND","OR"][cc-20]+"("+argL+","+argR+")");break;default:if(cc<32&&BinOpTab[cc])argR=out.pop(),argL=out.pop(),out.push(argL+BinOpTab[cc]+argR);else if(FuncTab[cc]){if(argc=FuncTab[cc][1],argc==69&&(argc=blob[blob.l++]),argc>out.length){console.error("WK1 bad formula parse 0x"+cc.toString(16)+":|"+out.join("|")+"|");return}var args=out.slice(-argc);out.length-=argc,out.push(FuncTab[cc][0]+"("+args.join(",")+")")}else return cc<=7?console.error("WK1 invalid opcode "+cc.toString(16)):cc<=24?console.error("WK1 unsupported op "+cc.toString(16)):cc<=30?console.error("WK1 invalid opcode "+cc.toString(16)):cc<=115?console.error("WK1 unsupported function opcode "+cc.toString(16)):console.error("WK1 unrecognized opcode "+cc.toString(16))}}out.length==1?o[1].f=""+out[0]:console.error("WK1 bad formula parse |"+out.join("|")+"|")}function parse_cell_3(blob){var o=[{c:0,r:0},{t:"n",v:0},0];return o[0].r=blob.read_shift(2),o[3]=blob[blob.l++],o[0].c=blob[blob.l++],o}function parse_LABEL_16(blob,length){var o=parse_cell_3(blob,length);return o[1].t="s",o[1].v=blob.read_shift(length-4,"cstr"),o}function write_LABEL_16(R,C,wsidx,s){var o=new_buf(6+s.length);o.write_shift(2,R),o.write_shift(1,wsidx),o.write_shift(1,C),o.write_shift(1,39);for(var i=0;i<s.length;++i){var cc=s.charCodeAt(i);o.write_shift(1,cc>=128?95:cc)}return o.write_shift(1,0),o}function parse_NUMBER_18(blob,length){var o=parse_cell_3(blob,length);o[1].v=blob.read_shift(2);var v=o[1].v>>1;if(o[1].v&1)switch(v&7){case 0:v=(v>>3)*5e3;break;case 1:v=(v>>3)*500;break;case 2:v=(v>>3)/20;break;case 3:v=(v>>3)/200;break;case 4:v=(v>>3)/2e3;break;case 5:v=(v>>3)/2e4;break;case 6:v=(v>>3)/16;break;case 7:v=(v>>3)/64;break}return o[1].v=v,o}function parse_NUMBER_17(blob,length){var o=parse_cell_3(blob,length),v1=blob.read_shift(4),v2=blob.read_shift(4),e=blob.read_shift(2);if(e==65535)return v1===0&&v2===3221225472?(o[1].t="e",o[1].v=15):v1===0&&v2===3489660928?(o[1].t="e",o[1].v=42):o[1].v=0,o;var s=e&32768;return e=(e&32767)-16446,o[1].v=(1-s*2)*(v2*Math.pow(2,e+32)+v1*Math.pow(2,e)),o}function write_NUMBER_17(R,C,wsidx,v){var o=new_buf(14);if(o.write_shift(2,R),o.write_shift(1,wsidx),o.write_shift(1,C),v==0)return o.write_shift(4,0),o.write_shift(4,0),o.write_shift(2,65535),o;var s=0,e=0,v1=0,v2=0;return v<0&&(s=1,v=-v),e=Math.log2(v)|0,v/=Math.pow(2,e-31),v2=v>>>0,(v2&2147483648)==0&&(v/=2,++e,v2=v>>>0),v-=v2,v2|=2147483648,v2>>>=0,v*=Math.pow(2,32),v1=v>>>0,o.write_shift(4,v1),o.write_shift(4,v2),e+=16383+(s?32768:0),o.write_shift(2,e),o}function parse_FORMULA_19(blob,length){var o=parse_NUMBER_17(blob,14);return blob.l+=length-14,o}function parse_NUMBER_25(blob,length){var o=parse_cell_3(blob,length),v1=blob.read_shift(4);return o[1].v=v1>>6,o}function parse_NUMBER_27(blob,length){var o=parse_cell_3(blob,length),v1=blob.read_shift(8,"f");return o[1].v=v1,o}function parse_FORMULA_28(blob,length){var o=parse_NUMBER_27(blob,14);return blob.l+=length-10,o}function parse_SHEETNAMECS(blob,length){return blob[blob.l+length-1]==0?blob.read_shift(length,"cstr"):""}function parse_SHEETNAMELP(blob,length){var len2=blob[blob.l++];len2>length-1&&(len2=length-1);for(var o="";o.length<len2;)o+=String.fromCharCode(blob[blob.l++]);return o}function parse_SHEETINFOQP(blob,length,opts){if(!(!opts.qpro||length<21)){var id=blob.read_shift(1);blob.l+=17,blob.l+=1,blob.l+=2;var nm=blob.read_shift(length-21,"cstr");return[id,nm]}}function parse_XFORMAT(blob,length){for(var o={},tgt=blob.l+length;blob.l<tgt;){var dt=blob.read_shift(2);if(dt==14e3){for(o[dt]=[0,""],o[dt][0]=blob.read_shift(2);blob[blob.l];)o[dt][1]+=String.fromCharCode(blob[blob.l]),blob.l++;blob.l++}}return o}function write_XFORMAT_SHEETNAME(name,wsidx){var out=new_buf(5+name.length);out.write_shift(2,14e3),out.write_shift(2,wsidx);for(var i=0;i<name.length;++i){var cc=name.charCodeAt(i);out[out.l++]=cc>127?95:cc}return out[out.l++]=0,out}var WK1Enum={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:parse_RANGE},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:parse_INTEGER},14:{n:"NUMBER",f:parse_NUMBER},15:{n:"LABEL",f:parse_LABEL},16:{n:"FORMULA",f:parse_FORMULA},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:parse_LABEL},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:parse_SHEETNAMECS},222:{n:"SHEETNAMELP",f:parse_SHEETNAMELP},65535:{n:""}},WK3Enum={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:parse_LABEL_16},23:{n:"NUMBER17",f:parse_NUMBER_17},24:{n:"NUMBER18",f:parse_NUMBER_18},25:{n:"FORMULA19",f:parse_FORMULA_19},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:parse_XFORMAT},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:parse_NUMBER_25},38:{n:"??"},39:{n:"NUMBER27",f:parse_NUMBER_27},40:{n:"FORMULA28",f:parse_FORMULA_28},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:parse_SHEETNAMECS},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:parse_SHEETINFOQP},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1,book_to_wk3,to_workbook:lotus_to_workbook}}();function parse_rpr(rpr){var font={},m=rpr.match(tagregex),i=0,pass=!1;if(m)for(;i!=m.length;++i){var y=parsexmltag(m[i]);switch(y[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!y.val)break;case"<shadow>":case"<shadow/>":font.shadow=1;break;case"</shadow>":break;case"<charset":if(y.val=="1")break;font.cp=CS2CP[parseInt(y.val,10)];break;case"<outline":if(!y.val)break;case"<outline>":case"<outline/>":font.outline=1;break;case"</outline>":break;case"<rFont":font.name=y.val;break;case"<sz":font.sz=y.val;break;case"<strike":if(!y.val)break;case"<strike>":case"<strike/>":font.strike=1;break;case"</strike>":break;case"<u":if(!y.val)break;switch(y.val){case"double":font.uval="double";break;case"singleAccounting":font.uval="single-accounting";break;case"doubleAccounting":font.uval="double-accounting";break}case"<u>":case"<u/>":font.u=1;break;case"</u>":break;case"<b":if(y.val=="0")break;case"<b>":case"<b/>":font.b=1;break;case"</b>":break;case"<i":if(y.val=="0")break;case"<i>":case"<i/>":font.i=1;break;case"</i>":break;case"<color":y.rgb&&(font.color=y.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":font.family=y.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":font.valign=y.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(y[0].charCodeAt(1)!==47&&!pass)throw new Error("Unrecognized rich format "+y[0])}}return font}var parse_rs=function(){var tregex=matchtag("t"),rpregex=matchtag("rPr");function parse_r(r){var t=r.match(tregex);if(!t)return{t:"s",v:""};var o={t:"s",v:unescapexml(t[1])},rpr=r.match(rpregex);return rpr&&(o.s=parse_rpr(rpr[1])),o}var rregex=/<(?:\w+:)?r>/g,rend=/<\/(?:\w+:)?r>/;return function(rs){return rs.replace(rregex,"").split(rend).map(parse_r).filter(function(r){return r.v})}}(),rs_to_html=function(){var nlregex=/(\r\n|\n)/g;function parse_rpr2(font,intro,outro){var style=[];font.u&&style.push("text-decoration: underline;"),font.uval&&style.push("text-underline-style:"+font.uval+";"),font.sz&&style.push("font-size:"+font.sz+"pt;"),font.outline&&style.push("text-effect: outline;"),font.shadow&&style.push("text-shadow: auto;"),intro.push('<span style="'+style.join("")+'">'),font.b&&(intro.push("<b>"),outro.push("</b>")),font.i&&(intro.push("<i>"),outro.push("</i>")),font.strike&&(intro.push("<s>"),outro.push("</s>"));var align=font.valign||"";return align=="superscript"||align=="super"?align="sup":align=="subscript"&&(align="sub"),align!=""&&(intro.push("<"+align+">"),outro.push("</"+align+">")),outro.push("</span>"),font}function r_to_html(r){var terms=[[],r.v,[]];return r.v?(r.s&&parse_rpr2(r.s,terms[0],terms[2]),terms[0].join("")+terms[1].replace(nlregex,"<br/>")+terms[2].join("")):""}return function(rs){return rs.map(r_to_html).join("")}}(),sitregex=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,sirregex=/<(?:\w+:)?r>/,sirphregex=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function parse_si(x,opts){var html=opts?opts.cellHTML:!0,z={};return x?(x.match(/^\s*<(?:\w+:)?t[^>]*>/)?(z.t=unescapexml(utf8read(x.slice(x.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),z.r=utf8read(x),html&&(z.h=escapehtml(z.t))):x.match(sirregex)&&(z.r=utf8read(x),z.t=unescapexml(utf8read((x.replace(sirphregex,"").match(sitregex)||[]).join("").replace(tagregex,""))),html&&(z.h=rs_to_html(parse_rs(z.r)))),z):{t:""}}var sstr0=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,sstr1=/<(?:\w+:)?(?:si|sstItem)>/g,sstr2=/<\/(?:\w+:)?(?:si|sstItem)>/;function parse_sst_xml(data,opts){var s=[],ss="";if(!data)return s;var sst=data.match(sstr0);if(sst){ss=sst[2].replace(sstr1,"").split(sstr2);for(var i=0;i!=ss.length;++i){var o=parse_si(ss[i].trim(),opts);o!=null&&(s[s.length]=o)}sst=parsexmltag(sst[1]),s.Count=sst.count,s.Unique=sst.uniqueCount}return s}function parse_BrtBeginSst(data){return[data.read_shift(4),data.read_shift(4)]}function parse_sst_bin(data,opts){var s=[],pass=!1;return recordhopper(data,function(val,R,RT){switch(RT){case 159:s.Count=val[0],s.Unique=val[1];break;case 19:s.push(val);break;case 160:return!0;case 35:pass=!0;break;case 36:pass=!1;break;default:if(R.T,!pass||opts.WTF)throw new Error("Unexpected record 0x"+RT.toString(16))}}),s}function _JS2ANSI(str){if(typeof $cptable!="undefined")return $cptable.utils.encode(current_ansi,str);for(var o=[],oo=str.split(""),i=0;i<oo.length;++i)o[i]=oo[i].charCodeAt(0);return o}function parse_CRYPTOVersion(blob,length){var o={};return o.Major=blob.read_shift(2),o.Minor=blob.read_shift(2),length>=4&&(blob.l+=length-4),o}function parse_DataSpaceVersionInfo(blob){var o={};return o.id=blob.read_shift(0,"lpp4"),o.R=parse_CRYPTOVersion(blob,4),o.U=parse_CRYPTOVersion(blob,4),o.W=parse_CRYPTOVersion(blob,4),o}function parse_DataSpaceMapEntry(blob){for(var len2=blob.read_shift(4),end=blob.l+len2-4,o={},cnt=blob.read_shift(4),comps=[];cnt-- >0;)comps.push({t:blob.read_shift(4),v:blob.read_shift(0,"lpp4")});if(o.name=blob.read_shift(0,"lpp4"),o.comps=comps,blob.l!=end)throw new Error("Bad DataSpaceMapEntry: "+blob.l+" != "+end);return o}function parse_DataSpaceMap(blob){var o=[];blob.l+=4;for(var cnt=blob.read_shift(4);cnt-- >0;)o.push(parse_DataSpaceMapEntry(blob));return o}function parse_DataSpaceDefinition(blob){var o=[];blob.l+=4;for(var cnt=blob.read_shift(4);cnt-- >0;)o.push(blob.read_shift(0,"lpp4"));return o}function parse_TransformInfoHeader(blob){var o={};return blob.read_shift(4),blob.l+=4,o.id=blob.read_shift(0,"lpp4"),o.name=blob.read_shift(0,"lpp4"),o.R=parse_CRYPTOVersion(blob,4),o.U=parse_CRYPTOVersion(blob,4),o.W=parse_CRYPTOVersion(blob,4),o}function parse_Primary(blob){var hdr=parse_TransformInfoHeader(blob);if(hdr.ename=blob.read_shift(0,"8lpp4"),hdr.blksz=blob.read_shift(4),hdr.cmode=blob.read_shift(4),blob.read_shift(4)!=4)throw new Error("Bad !Primary record");return hdr}function parse_EncryptionHeader(blob,length){var tgt=blob.l+length,o={};o.Flags=blob.read_shift(4)&63,blob.l+=4,o.AlgID=blob.read_shift(4);var valid=!1;switch(o.AlgID){case 26126:case 26127:case 26128:valid=o.Flags==36;break;case 26625:valid=o.Flags==4;break;case 0:valid=o.Flags==16||o.Flags==4||o.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+o.AlgID}if(!valid)throw new Error("Encryption Flags/AlgID mismatch");return o.AlgIDHash=blob.read_shift(4),o.KeySize=blob.read_shift(4),o.ProviderType=blob.read_shift(4),blob.l+=8,o.CSPName=blob.read_shift(tgt-blob.l>>1,"utf16le"),blob.l=tgt,o}function parse_EncryptionVerifier(blob,length){var o={},tgt=blob.l+length;return blob.l+=4,o.Salt=blob.slice(blob.l,blob.l+16),blob.l+=16,o.Verifier=blob.slice(blob.l,blob.l+16),blob.l+=16,blob.read_shift(4),o.VerifierHash=blob.slice(blob.l,tgt),blob.l=tgt,o}function parse_EncryptionInfo(blob){var vers=parse_CRYPTOVersion(blob);switch(vers.Minor){case 2:return[vers.Minor,parse_EncInfoStd(blob,vers)];case 3:return[vers.Minor,parse_EncInfoExt(blob,vers)];case 4:return[vers.Minor,parse_EncInfoAgl(blob,vers)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+vers.Minor)}function parse_EncInfoStd(blob){var flags=blob.read_shift(4);if((flags&63)!=36)throw new Error("EncryptionInfo mismatch");var sz=blob.read_shift(4),hdr=parse_EncryptionHeader(blob,sz),verifier=parse_EncryptionVerifier(blob,blob.length-blob.l);return{t:"Std",h:hdr,v:verifier}}function parse_EncInfoExt(){throw new Error("File is password-protected: ECMA-376 Extensible")}function parse_EncInfoAgl(blob){var KeyData=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];blob.l+=4;var xml=blob.read_shift(blob.length-blob.l,"utf8"),o={};return xml.replace(tagregex,function(x){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":KeyData.forEach(function(k){o[k]=y[k]});break;case"<dataIntegrity":o.encryptedHmacKey=y.encryptedHmacKey,o.encryptedHmacValue=y.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":o.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":o.uri=y.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":o.encs.push(y);break;default:throw y[0]}}),o}function parse_RC4CryptoHeader(blob,length){var o={},vers=o.EncryptionVersionInfo=parse_CRYPTOVersion(blob,4);if(length-=4,vers.Minor!=2)throw new Error("unrecognized minor version code: "+vers.Minor);if(vers.Major>4||vers.Major<2)throw new Error("unrecognized major version code: "+vers.Major);o.Flags=blob.read_shift(4),length-=4;var sz=blob.read_shift(4);return length-=4,o.EncryptionHeader=parse_EncryptionHeader(blob,sz),length-=sz,o.EncryptionVerifier=parse_EncryptionVerifier(blob,length),o}function parse_RC4Header(blob){var o={},vers=o.EncryptionVersionInfo=parse_CRYPTOVersion(blob,4);if(vers.Major!=1||vers.Minor!=1)throw"unrecognized version code "+vers.Major+" : "+vers.Minor;return o.Salt=blob.read_shift(16),o.EncryptedVerifier=blob.read_shift(16),o.EncryptedVerifierHash=blob.read_shift(16),o}function crypto_CreatePasswordVerifier_Method1(Password){var Verifier=0,PasswordArray,PasswordDecoded=_JS2ANSI(Password),len2=PasswordDecoded.length+1,i,PasswordByte,Intermediate1,Intermediate2,Intermediate3;for(PasswordArray=new_raw_buf(len2),PasswordArray[0]=PasswordDecoded.length,i=1;i!=len2;++i)PasswordArray[i]=PasswordDecoded[i-1];for(i=len2-1;i>=0;--i)PasswordByte=PasswordArray[i],Intermediate1=(Verifier&16384)==0?0:1,Intermediate2=Verifier<<1&32767,Intermediate3=Intermediate1|Intermediate2,Verifier=Intermediate3^PasswordByte;return Verifier^52811}var crypto_CreateXorArray_Method1=function(){var PadArray=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],InitialCode=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],XorMatrix=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],Ror=function(Byte){return(Byte/2|Byte*128)&255},XorRor=function(byte1,byte2){return Ror(byte1^byte2)},CreateXorKey_Method1=function(Password){for(var XorKey=InitialCode[Password.length-1],CurrentElement=104,i=Password.length-1;i>=0;--i)for(var Char=Password[i],j=0;j!=7;++j)Char&64&&(XorKey^=XorMatrix[CurrentElement]),Char*=2,--CurrentElement;return XorKey};return function(password){for(var Password=_JS2ANSI(password),XorKey=CreateXorKey_Method1(Password),Index=Password.length,ObfuscationArray=new_raw_buf(16),i=0;i!=16;++i)ObfuscationArray[i]=0;var Temp,PasswordLastChar,PadIndex;for((Index&1)==1&&(Temp=XorKey>>8,ObfuscationArray[Index]=XorRor(PadArray[0],Temp),--Index,Temp=XorKey&255,PasswordLastChar=Password[Password.length-1],ObfuscationArray[Index]=XorRor(PasswordLastChar,Temp));Index>0;)--Index,Temp=XorKey>>8,ObfuscationArray[Index]=XorRor(Password[Index],Temp),--Index,Temp=XorKey&255,ObfuscationArray[Index]=XorRor(Password[Index],Temp);for(Index=15,PadIndex=15-Password.length;PadIndex>0;)Temp=XorKey>>8,ObfuscationArray[Index]=XorRor(PadArray[PadIndex],Temp),--Index,--PadIndex,Temp=XorKey&255,ObfuscationArray[Index]=XorRor(Password[Index],Temp),--Index,--PadIndex;return ObfuscationArray}}(),crypto_DecryptData_Method1=function(password,Data,XorArrayIndex,XorArray,O){O||(O=Data),XorArray||(XorArray=crypto_CreateXorArray_Method1(password));var Index,Value;for(Index=0;Index!=Data.length;++Index)Value=Data[Index],Value^=XorArray[XorArrayIndex],Value=(Value>>5|Value<<3)&255,O[Index]=Value,++XorArrayIndex;return[O,XorArrayIndex,XorArray]},crypto_MakeXorDecryptor=function(password){var XorArrayIndex=0,XorArray=crypto_CreateXorArray_Method1(password);return function(Data){var O=crypto_DecryptData_Method1("",Data,XorArrayIndex,XorArray);return XorArrayIndex=O[1],O[0]}};function parse_XORObfuscation(blob,length,opts,out){var o={key:parseuint16(blob),verificationBytes:parseuint16(blob)};return opts.password&&(o.verifier=crypto_CreatePasswordVerifier_Method1(opts.password)),out.valid=o.verificationBytes===o.verifier,out.valid&&(out.insitu=crypto_MakeXorDecryptor(opts.password)),o}function parse_FilePassHeader(blob,length,oo){var o=oo||{};return o.Info=blob.read_shift(2),blob.l-=2,o.Info===1?o.Data=parse_RC4Header(blob,length):o.Data=parse_RC4CryptoHeader(blob,length),o}function parse_FilePass(blob,length,opts){var o={Type:opts.biff>=8?blob.read_shift(2):0};return o.Type?parse_FilePassHeader(blob,length-2,o):parse_XORObfuscation(blob,opts.biff>=8?length:length-2,opts,o),o}var RTF=function(){function rtf_to_sheet(d,opts){switch(opts.type){case"base64":return rtf_to_sheet_str(Base64_decode(d),opts);case"binary":return rtf_to_sheet_str(d,opts);case"buffer":return rtf_to_sheet_str(has_buf&&Buffer.isBuffer(d)?d.toString("binary"):a2s(d),opts);case"array":return rtf_to_sheet_str(cc2str(d),opts)}throw new Error("Unrecognized type "+opts.type)}function rtf_to_sheet_str(str,opts){var o=opts||{},ws=o.dense?[]:{},rows=str.match(/\\trowd.*?\\row\b/g);if(!rows.length)throw new Error("RTF missing table");var range3={s:{c:0,r:0},e:{c:0,r:rows.length-1}};return rows.forEach(function(rowtf,R){Array.isArray(ws)&&(ws[R]=[]);for(var rtfre=/\\\w+\b/g,last_index=0,res,C=-1;res=rtfre.exec(rowtf);){switch(res[0]){case"\\cell":var data=rowtf.slice(last_index,rtfre.lastIndex-res[0].length);if(data[0]==" "&&(data=data.slice(1)),++C,data.length){var cell={v:data,t:"s"};Array.isArray(ws)?ws[R][C]=cell:ws[encode_cell({r:R,c:C})]=cell}break}last_index=rtfre.lastIndex}C>range3.e.c&&(range3.e.c=C)}),ws["!ref"]=encode_range(range3),ws}function rtf_to_workbook(d,opts){return sheet_to_workbook(rtf_to_sheet(d,opts),opts)}function sheet_to_rtf(ws){for(var o=["{\\rtf1\\ansi"],r=safe_decode_range(ws["!ref"]),cell,dense=Array.isArray(ws),R=r.s.r;R<=r.e.r;++R){o.push("\\trowd\\trautofit1");for(var C=r.s.c;C<=r.e.c;++C)o.push("\\cellx"+(C+1));for(o.push("\\pard\\intbl"),C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});cell=dense?(ws[R]||[])[C]:ws[coord],!(!cell||cell.v==null&&(!cell.f||cell.F))&&(o.push(" "+(cell.w||(format_cell(cell),cell.w))),o.push("\\cell"))}o.push("\\pard\\intbl\\row")}return o.join("")+"}"}return{to_workbook:rtf_to_workbook,to_sheet:rtf_to_sheet,from_sheet:sheet_to_rtf}}();function hex2RGB(h){var o=h.slice(h[0]==="#"?1:0).slice(0,6);return[parseInt(o.slice(0,2),16),parseInt(o.slice(2,4),16),parseInt(o.slice(4,6),16)]}function rgb2Hex(rgb){for(var i=0,o=1;i!=3;++i)o=o*256+(rgb[i]>255?255:rgb[i]<0?0:rgb[i]);return o.toString(16).toUpperCase().slice(1)}function rgb2HSL(rgb){var R=rgb[0]/255,G=rgb[1]/255,B=rgb[2]/255,M=Math.max(R,G,B),m=Math.min(R,G,B),C=M-m;if(C===0)return[0,0,R];var H6=0,S=0,L2=M+m;switch(S=C/(L2>1?2-L2:L2),M){case R:H6=((G-B)/C+6)%6;break;case G:H6=(B-R)/C+2;break;case B:H6=(R-G)/C+4;break}return[H6/6,S,L2/2]}function hsl2RGB(hsl){var H=hsl[0],S=hsl[1],L=hsl[2],C=S*2*(L<.5?L:1-L),m=L-C/2,rgb=[m,m,m],h6=6*H,X;if(S!==0)switch(h6|0){case 0:case 6:X=C*h6,rgb[0]+=C,rgb[1]+=X;break;case 1:X=C*(2-h6),rgb[0]+=X,rgb[1]+=C;break;case 2:X=C*(h6-2),rgb[1]+=C,rgb[2]+=X;break;case 3:X=C*(4-h6),rgb[1]+=X,rgb[2]+=C;break;case 4:X=C*(h6-4),rgb[2]+=C,rgb[0]+=X;break;case 5:X=C*(6-h6),rgb[2]+=X,rgb[0]+=C;break}for(var i=0;i!=3;++i)rgb[i]=Math.round(rgb[i]*255);return rgb}function rgb_tint(hex,tint){if(tint===0)return hex;var hsl=rgb2HSL(hex2RGB(hex));return tint<0?hsl[2]=hsl[2]*(1+tint):hsl[2]=1-(1-hsl[2])*(1-tint),rgb2Hex(hsl2RGB(hsl))}var DEF_MDW=6,MAX_MDW=15,MIN_MDW=1,MDW=DEF_MDW;function width2px(width){return Math.floor((width+Math.round(128/MDW)/256)*MDW)}function px2char(px){return Math.floor((px-5)/MDW*100+.5)/100}function char2width(chr){return Math.round((chr*MDW+5)/MDW*256)/256}function cycle_width(collw){return char2width(px2char(width2px(collw)))}function find_mdw_colw(collw){var delta=Math.abs(collw-cycle_width(collw)),_MDW=MDW;if(delta>.005)for(MDW=MIN_MDW;MDW<MAX_MDW;++MDW)Math.abs(collw-cycle_width(collw))<=delta&&(delta=Math.abs(collw-cycle_width(collw)),_MDW=MDW);MDW=_MDW}function process_col(coll){coll.width?(coll.wpx=width2px(coll.width),coll.wch=px2char(coll.wpx),coll.MDW=MDW):coll.wpx?(coll.wch=px2char(coll.wpx),coll.width=char2width(coll.wch),coll.MDW=MDW):typeof coll.wch=="number"&&(coll.width=char2width(coll.wch),coll.wpx=width2px(coll.width),coll.MDW=MDW),coll.customWidth&&delete coll.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(px){return px*96/PPI}function pt2px(pt){return pt*PPI/96}var XLMLPatternTypeMap={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function parse_borders(t,styles,themes,opts){styles.Borders=[];var border={},pass=!1;(t[0].match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":border={},y.diagonalUp&&(border.diagonalUp=parsexmlbool(y.diagonalUp)),y.diagonalDown&&(border.diagonalDown=parsexmlbool(y.diagonalDown)),styles.Borders.push(border);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(opts&&opts.WTF&&!pass)throw new Error("unrecognized "+y[0]+" in borders")}})}function parse_fills(t,styles,themes,opts){styles.Fills=[];var fill2={},pass=!1;(t[0].match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":fill2={},styles.Fills.push(fill2);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":styles.Fills.push(fill2),fill2={};break;case"<patternFill":case"<patternFill>":y.patternType&&(fill2.patternType=y.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":fill2.bgColor||(fill2.bgColor={}),y.indexed&&(fill2.bgColor.indexed=parseInt(y.indexed,10)),y.theme&&(fill2.bgColor.theme=parseInt(y.theme,10)),y.tint&&(fill2.bgColor.tint=parseFloat(y.tint)),y.rgb&&(fill2.bgColor.rgb=y.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":fill2.fgColor||(fill2.fgColor={}),y.theme&&(fill2.fgColor.theme=parseInt(y.theme,10)),y.tint&&(fill2.fgColor.tint=parseFloat(y.tint)),y.rgb!=null&&(fill2.fgColor.rgb=y.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(opts&&opts.WTF&&!pass)throw new Error("unrecognized "+y[0]+" in fills")}})}function parse_fonts(t,styles,themes,opts){styles.Fonts=[];var font={},pass=!1;(t[0].match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":styles.Fonts.push(font),font={};break;case"<name":y.val&&(font.name=utf8read(y.val));break;case"<name/>":case"</name>":break;case"<b":font.bold=y.val?parsexmlbool(y.val):1;break;case"<b/>":font.bold=1;break;case"<i":font.italic=y.val?parsexmlbool(y.val):1;break;case"<i/>":font.italic=1;break;case"<u":switch(y.val){case"none":font.underline=0;break;case"single":font.underline=1;break;case"double":font.underline=2;break;case"singleAccounting":font.underline=33;break;case"doubleAccounting":font.underline=34;break}break;case"<u/>":font.underline=1;break;case"<strike":font.strike=y.val?parsexmlbool(y.val):1;break;case"<strike/>":font.strike=1;break;case"<outline":font.outline=y.val?parsexmlbool(y.val):1;break;case"<outline/>":font.outline=1;break;case"<shadow":font.shadow=y.val?parsexmlbool(y.val):1;break;case"<shadow/>":font.shadow=1;break;case"<condense":font.condense=y.val?parsexmlbool(y.val):1;break;case"<condense/>":font.condense=1;break;case"<extend":font.extend=y.val?parsexmlbool(y.val):1;break;case"<extend/>":font.extend=1;break;case"<sz":y.val&&(font.sz=+y.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":y.val&&(font.vertAlign=y.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":y.val&&(font.family=parseInt(y.val,10));break;case"<family/>":case"</family>":break;case"<scheme":y.val&&(font.scheme=y.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(y.val=="1")break;y.codepage=CS2CP[parseInt(y.val,10)];break;case"<color":if(font.color||(font.color={}),y.auto&&(font.color.auto=parsexmlbool(y.auto)),y.rgb)font.color.rgb=y.rgb.slice(-6);else if(y.indexed){font.color.index=parseInt(y.indexed,10);var icv=XLSIcv[font.color.index];font.color.index==81&&(icv=XLSIcv[1]),icv||(icv=XLSIcv[1]),font.color.rgb=icv[0].toString(16)+icv[1].toString(16)+icv[2].toString(16)}else y.theme&&(font.color.theme=parseInt(y.theme,10),y.tint&&(font.color.tint=parseFloat(y.tint)),y.theme&&themes.themeElements&&themes.themeElements.clrScheme&&(font.color.rgb=rgb_tint(themes.themeElements.clrScheme[font.color.theme].rgb,font.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":pass=!0;break;case"</AlternateContent>":pass=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(opts&&opts.WTF&&!pass)throw new Error("unrecognized "+y[0]+" in fonts")}})}function parse_numFmts(t,styles,opts){styles.NumberFmt=[];for(var k=keys(table_fmt),i=0;i<k.length;++i)styles.NumberFmt[k[i]]=table_fmt[k[i]];var m=t[0].match(tagregex);if(!!m)for(i=0;i<m.length;++i){var y=parsexmltag(m[i]);switch(strip_ns(y[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var f=unescapexml(utf8read(y.formatCode)),j=parseInt(y.numFmtId,10);if(styles.NumberFmt[j]=f,j>0){if(j>392){for(j=392;j>60&&styles.NumberFmt[j]!=null;--j);styles.NumberFmt[j]=f}SSF_load(f,j)}}break;case"</numFmt>":break;default:if(opts.WTF)throw new Error("unrecognized "+y[0]+" in numFmts")}}}var cellXF_uint=["numFmtId","fillId","fontId","borderId","xfId"],cellXF_bool=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function parse_cellXfs(t,styles,opts){styles.CellXf=[];var xf,pass=!1;(t[0].match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x),i=0;switch(strip_ns(y[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(xf=y,delete xf[0],i=0;i<cellXF_uint.length;++i)xf[cellXF_uint[i]]&&(xf[cellXF_uint[i]]=parseInt(xf[cellXF_uint[i]],10));for(i=0;i<cellXF_bool.length;++i)xf[cellXF_bool[i]]&&(xf[cellXF_bool[i]]=parsexmlbool(xf[cellXF_bool[i]]));if(styles.NumberFmt&&xf.numFmtId>392){for(i=392;i>60;--i)if(styles.NumberFmt[xf.numFmtId]==styles.NumberFmt[i]){xf.numFmtId=i;break}}styles.CellXf.push(xf);break;case"</xf>":break;case"<alignment":case"<alignment/>":var alignment={};y.vertical&&(alignment.vertical=y.vertical),y.horizontal&&(alignment.horizontal=y.horizontal),y.textRotation!=null&&(alignment.textRotation=y.textRotation),y.indent&&(alignment.indent=y.indent),y.wrapText&&(alignment.wrapText=parsexmlbool(y.wrapText)),xf.alignment=alignment;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":pass=!0;break;case"</AlternateContent>":pass=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(opts&&opts.WTF&&!pass)throw new Error("unrecognized "+y[0]+" in cellXfs")}})}var parse_sty_xml=function(){var numFmtRegex=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,cellXfRegex=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,fillsRegex=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,fontsRegex=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,bordersRegex=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(data,themes,opts){var styles={};if(!data)return styles;data=data.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var t;return(t=data.match(numFmtRegex))&&parse_numFmts(t,styles,opts),(t=data.match(fontsRegex))&&parse_fonts(t,styles,themes,opts),(t=data.match(fillsRegex))&&parse_fills(t,styles,themes,opts),(t=data.match(bordersRegex))&&parse_borders(t,styles,themes,opts),(t=data.match(cellXfRegex))&&parse_cellXfs(t,styles,opts),styles}}();function parse_BrtFmt(data,length){var numFmtId=data.read_shift(2),stFmtCode=parse_XLWideString(data,length-2);return[numFmtId,stFmtCode]}function parse_BrtFont(data,length,opts){var out={};out.sz=data.read_shift(2)/20;var grbit=parse_FontFlags(data,2,opts);grbit.fItalic&&(out.italic=1),grbit.fCondense&&(out.condense=1),grbit.fExtend&&(out.extend=1),grbit.fShadow&&(out.shadow=1),grbit.fOutline&&(out.outline=1),grbit.fStrikeout&&(out.strike=1);var bls=data.read_shift(2);switch(bls===700&&(out.bold=1),data.read_shift(2)){case 1:out.vertAlign="superscript";break;case 2:out.vertAlign="subscript";break}var underline=data.read_shift(1);underline!=0&&(out.underline=underline);var family=data.read_shift(1);family>0&&(out.family=family);var bCharSet=data.read_shift(1);switch(bCharSet>0&&(out.charset=bCharSet),data.l++,out.color=parse_BrtColor(data,8),data.read_shift(1)){case 1:out.scheme="major";break;case 2:out.scheme="minor";break}return out.name=parse_XLWideString(data,length-21),out}var parse_BrtFill=parsenoop;function parse_BrtXF(data,length){var tgt=data.l+length,ixfeParent=data.read_shift(2),ifmt=data.read_shift(2);return data.l=tgt,{ixfe:ixfeParent,numFmtId:ifmt}}var parse_BrtBorder=parsenoop;function parse_sty_bin(data,themes,opts){var styles={};styles.NumberFmt=[];for(var y in table_fmt)styles.NumberFmt[y]=table_fmt[y];styles.CellXf=[],styles.Fonts=[];var state=[],pass=!1;return recordhopper(data,function(val,R,RT){switch(RT){case 44:styles.NumberFmt[val[0]]=val[1],SSF_load(val[1],val[0]);break;case 43:styles.Fonts.push(val),val.color.theme!=null&&themes&&themes.themeElements&&themes.themeElements.clrScheme&&(val.color.rgb=rgb_tint(themes.themeElements.clrScheme[val.color.theme].rgb,val.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:state[state.length-1]==617&&styles.CellXf.push(val);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:pass=!0;break;case 36:pass=!1;break;case 37:state.push(RT),pass=!0;break;case 38:state.pop(),pass=!1;break;default:if(R.T>0)state.push(RT);else if(R.T<0)state.pop();else if(!pass||opts.WTF&&state[state.length-1]!=37)throw new Error("Unexpected record 0x"+RT.toString(16))}}),styles}var XLSXThemeClrScheme=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function parse_clrScheme(t,themes,opts){themes.themeElements.clrScheme=[];var color={};(t[0].match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":color.rgb=y.val;break;case"<a:sysClr":color.rgb=y.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":y[0].charAt(1)==="/"?(themes.themeElements.clrScheme[XLSXThemeClrScheme.indexOf(y[0])]=color,color={}):color.name=y[0].slice(3,y[0].length-1);break;default:if(opts&&opts.WTF)throw new Error("Unrecognized "+y[0]+" in clrScheme")}})}function parse_fontScheme(){}function parse_fmtScheme(){}var clrsregex=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,fntsregex=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,fmtsregex=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function parse_themeElements(data,themes,opts){themes.themeElements={};var t;[["clrScheme",clrsregex,parse_clrScheme],["fontScheme",fntsregex,parse_fontScheme],["fmtScheme",fmtsregex,parse_fmtScheme]].forEach(function(m){if(!(t=data.match(m[1])))throw new Error(m[0]+" not found in themeElements");m[2](t,themes,opts)})}var themeltregex=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function parse_theme_xml(data,opts){(!data||data.length===0)&&(data=write_theme());var t,themes={};if(!(t=data.match(themeltregex)))throw new Error("themeElements not found in theme");return parse_themeElements(t[0],themes,opts),themes.raw=data,themes}function write_theme(Themes,opts){if(opts&&opts.themeXLSX)return opts.themeXLSX;if(Themes&&typeof Themes.raw=="string")return Themes.raw;var o=[XML_HEADER];return o[o.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',o[o.length]="<a:themeElements>",o[o.length]='<a:clrScheme name="Office">',o[o.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',o[o.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',o[o.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',o[o.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',o[o.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',o[o.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',o[o.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',o[o.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',o[o.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',o[o.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',o[o.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',o[o.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',o[o.length]="</a:clrScheme>",o[o.length]='<a:fontScheme name="Office">',o[o.length]="<a:majorFont>",o[o.length]='<a:latin typeface="Cambria"/>',o[o.length]='<a:ea typeface=""/>',o[o.length]='<a:cs typeface=""/>',o[o.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',o[o.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',o[o.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',o[o.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',o[o.length]='<a:font script="Arab" typeface="Times New Roman"/>',o[o.length]='<a:font script="Hebr" typeface="Times New Roman"/>',o[o.length]='<a:font script="Thai" typeface="Tahoma"/>',o[o.length]='<a:font script="Ethi" typeface="Nyala"/>',o[o.length]='<a:font script="Beng" typeface="Vrinda"/>',o[o.length]='<a:font script="Gujr" typeface="Shruti"/>',o[o.length]='<a:font script="Khmr" typeface="MoolBoran"/>',o[o.length]='<a:font script="Knda" typeface="Tunga"/>',o[o.length]='<a:font script="Guru" typeface="Raavi"/>',o[o.length]='<a:font script="Cans" typeface="Euphemia"/>',o[o.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',o[o.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',o[o.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',o[o.length]='<a:font script="Thaa" typeface="MV Boli"/>',o[o.length]='<a:font script="Deva" typeface="Mangal"/>',o[o.length]='<a:font script="Telu" typeface="Gautami"/>',o[o.length]='<a:font script="Taml" typeface="Latha"/>',o[o.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',o[o.length]='<a:font script="Orya" typeface="Kalinga"/>',o[o.length]='<a:font script="Mlym" typeface="Kartika"/>',o[o.length]='<a:font script="Laoo" typeface="DokChampa"/>',o[o.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',o[o.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',o[o.length]='<a:font script="Viet" typeface="Times New Roman"/>',o[o.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',o[o.length]='<a:font script="Geor" typeface="Sylfaen"/>',o[o.length]="</a:majorFont>",o[o.length]="<a:minorFont>",o[o.length]='<a:latin typeface="Calibri"/>',o[o.length]='<a:ea typeface=""/>',o[o.length]='<a:cs typeface=""/>',o[o.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',o[o.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',o[o.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',o[o.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',o[o.length]='<a:font script="Arab" typeface="Arial"/>',o[o.length]='<a:font script="Hebr" typeface="Arial"/>',o[o.length]='<a:font script="Thai" typeface="Tahoma"/>',o[o.length]='<a:font script="Ethi" typeface="Nyala"/>',o[o.length]='<a:font script="Beng" typeface="Vrinda"/>',o[o.length]='<a:font script="Gujr" typeface="Shruti"/>',o[o.length]='<a:font script="Khmr" typeface="DaunPenh"/>',o[o.length]='<a:font script="Knda" typeface="Tunga"/>',o[o.length]='<a:font script="Guru" typeface="Raavi"/>',o[o.length]='<a:font script="Cans" typeface="Euphemia"/>',o[o.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',o[o.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',o[o.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',o[o.length]='<a:font script="Thaa" typeface="MV Boli"/>',o[o.length]='<a:font script="Deva" typeface="Mangal"/>',o[o.length]='<a:font script="Telu" typeface="Gautami"/>',o[o.length]='<a:font script="Taml" typeface="Latha"/>',o[o.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',o[o.length]='<a:font script="Orya" typeface="Kalinga"/>',o[o.length]='<a:font script="Mlym" typeface="Kartika"/>',o[o.length]='<a:font script="Laoo" typeface="DokChampa"/>',o[o.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',o[o.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',o[o.length]='<a:font script="Viet" typeface="Arial"/>',o[o.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',o[o.length]='<a:font script="Geor" typeface="Sylfaen"/>',o[o.length]="</a:minorFont>",o[o.length]="</a:fontScheme>",o[o.length]='<a:fmtScheme name="Office">',o[o.length]="<a:fillStyleLst>",o[o.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',o[o.length]='<a:gradFill rotWithShape="1">',o[o.length]="<a:gsLst>",o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',o[o.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',o[o.length]="</a:gsLst>",o[o.length]='<a:lin ang="16200000" scaled="1"/>',o[o.length]="</a:gradFill>",o[o.length]='<a:gradFill rotWithShape="1">',o[o.length]="<a:gsLst>",o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',o[o.length]="</a:gsLst>",o[o.length]='<a:lin ang="16200000" scaled="0"/>',o[o.length]="</a:gradFill>",o[o.length]="</a:fillStyleLst>",o[o.length]="<a:lnStyleLst>",o[o.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',o[o.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',o[o.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',o[o.length]="</a:lnStyleLst>",o[o.length]="<a:effectStyleLst>",o[o.length]="<a:effectStyle>",o[o.length]="<a:effectLst>",o[o.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',o[o.length]="</a:effectLst>",o[o.length]="</a:effectStyle>",o[o.length]="<a:effectStyle>",o[o.length]="<a:effectLst>",o[o.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',o[o.length]="</a:effectLst>",o[o.length]="</a:effectStyle>",o[o.length]="<a:effectStyle>",o[o.length]="<a:effectLst>",o[o.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',o[o.length]="</a:effectLst>",o[o.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',o[o.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',o[o.length]="</a:effectStyle>",o[o.length]="</a:effectStyleLst>",o[o.length]="<a:bgFillStyleLst>",o[o.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',o[o.length]='<a:gradFill rotWithShape="1">',o[o.length]="<a:gsLst>",o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',o[o.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',o[o.length]="</a:gsLst>",o[o.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',o[o.length]="</a:gradFill>",o[o.length]='<a:gradFill rotWithShape="1">',o[o.length]="<a:gsLst>",o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',o[o.length]="</a:gsLst>",o[o.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',o[o.length]="</a:gradFill>",o[o.length]="</a:bgFillStyleLst>",o[o.length]="</a:fmtScheme>",o[o.length]="</a:themeElements>",o[o.length]="<a:objectDefaults>",o[o.length]="<a:spDef>",o[o.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',o[o.length]="</a:spDef>",o[o.length]="<a:lnDef>",o[o.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',o[o.length]="</a:lnDef>",o[o.length]="</a:objectDefaults>",o[o.length]="<a:extraClrSchemeLst/>",o[o.length]="</a:theme>",o.join("")}function parse_Theme(blob,length,opts){var end=blob.l+length,dwThemeVersion=blob.read_shift(4);if(dwThemeVersion!==124226){if(!opts.cellStyles){blob.l=end;return}var data=blob.slice(blob.l);blob.l=end;var zip;try{zip=zip_read(data,{type:"array"})}catch(e){return}var themeXML=getzipstr(zip,"theme/theme/theme1.xml",!0);if(!!themeXML)return parse_theme_xml(themeXML,opts)}}function parse_ColorTheme(blob){return blob.read_shift(4)}function parse_FullColorExt(blob){var o={};switch(o.xclrType=blob.read_shift(2),o.nTintShade=blob.read_shift(2),o.xclrType){case 0:blob.l+=4;break;case 1:o.xclrValue=parse_IcvXF(blob,4);break;case 2:o.xclrValue=parse_LongRGBA(blob,4);break;case 3:o.xclrValue=parse_ColorTheme(blob,4);break;case 4:blob.l+=4;break}return blob.l+=8,o}function parse_IcvXF(blob,length){return parsenoop(blob,length)}function parse_XFExtGradient(blob,length){return parsenoop(blob,length)}function parse_ExtProp(blob){var extType=blob.read_shift(2),cb=blob.read_shift(2)-4,o=[extType];switch(extType){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:o[1]=parse_FullColorExt(blob,cb);break;case 6:o[1]=parse_XFExtGradient(blob,cb);break;case 14:case 15:o[1]=blob.read_shift(cb===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+extType+" "+cb)}return o}function parse_XFExt(blob,length){var end=blob.l+length;blob.l+=2;var ixfe=blob.read_shift(2);blob.l+=2;for(var cexts=blob.read_shift(2),ext=[];cexts-- >0;)ext.push(parse_ExtProp(blob,end-blob.l));return{ixfe,ext}}function update_xfext(xf,xfext){xfext.forEach(function(xfe){switch(xfe[0]){case 4:break;case 5:break;case 6:break;case 7:break;case 8:break;case 9:break;case 10:break;case 11:break;case 13:break;case 14:break;case 15:break}})}function parse_BrtMdtinfo(data,length){return{flags:data.read_shift(4),version:data.read_shift(4),name:parse_XLWideString(data,length-8)}}function parse_BrtMdb(data){for(var out=[],cnt=data.read_shift(4);cnt-- >0;)out.push([data.read_shift(4),data.read_shift(4)]);return out}function parse_BrtBeginEsmdb(data){return data.l+=4,data.read_shift(4)!=0}function parse_xlmeta_bin(data,name,_opts){var out={Types:[],Cell:[],Value:[]},opts=_opts||{},state=[],pass=!1,metatype=2;return recordhopper(data,function(val,R,RT){switch(RT){case 335:out.Types.push({name:val.name});break;case 51:val.forEach(function(r){metatype==1?out.Cell.push({type:out.Types[r[0]-1].name,index:r[1]}):metatype==0&&out.Value.push({type:out.Types[r[0]-1].name,index:r[1]})});break;case 337:metatype=val?1:0;break;case 338:metatype=2;break;case 35:state.push(RT),pass=!0;break;case 36:state.pop(),pass=!1;break;default:if(!R.T){if(!pass||opts.WTF&&state[state.length-1]!=35)throw new Error("Unexpected record 0x"+RT.toString(16))}}}),out}function parse_xlmeta_xml(data,name,opts){var out={Types:[],Cell:[],Value:[]};if(!data)return out;var pass=!1,metatype=2,lastmeta;return data.replace(tagregex,function(x){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":out.Types.push({name:y.name});break;case"</metadataType>":break;case"<futureMetadata":for(var j=0;j<out.Types.length;++j)out.Types[j].name==y.name&&(lastmeta=out.Types[j]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":metatype==1?out.Cell.push({type:out.Types[y.t-1].name,index:+y.v}):metatype==0&&out.Value.push({type:out.Types[y.t-1].name,index:+y.v});break;case"</rc>":break;case"<cellMetadata":metatype=1;break;case"</cellMetadata>":metatype=2;break;case"<valueMetadata":metatype=0;break;case"</valueMetadata>":metatype=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;case"<rvb":if(!lastmeta)break;lastmeta.offsets||(lastmeta.offsets=[]),lastmeta.offsets.push(+y.i);break;default:if(!pass&&opts.WTF)throw new Error("unrecognized "+y[0]+" in metadata")}return x}),out}function parse_cc_xml(data){var d=[];if(!data)return d;var i=1;return(data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete y[0],y.i?i=y.i:y.i=i,d.push(y);break}}),d}function parse_BrtCalcChainItem$(data){var out={};out.i=data.read_shift(4);var cell={};cell.r=data.read_shift(4),cell.c=data.read_shift(4),out.r=encode_cell(cell);var flags=data.read_shift(1);return flags&2&&(out.l="1"),flags&8&&(out.a="1"),out}function parse_cc_bin(data,name,opts){var out=[],pass=!1;return recordhopper(data,function(val,R,RT){switch(RT){case 63:out.push(val);break;default:if(!R.T){if(!pass||opts.WTF)throw new Error("Unexpected record 0x"+RT.toString(16))}}}),out}function parse_xlink_xml(){}function parse_xlink_bin(data,rel,name,_opts){if(!data)return data;var opts=_opts||{},pass=!1,end=!1;recordhopper(data,function(val,R,RT){if(!end)switch(RT){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:pass=!0;break;case 36:pass=!1;break;default:if(!R.T){if(!pass||opts.WTF)throw new Error("Unexpected record 0x"+RT.toString(16))}}},opts)}function parse_drawing(data,rels){if(!data)return"??";var id=(data.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return rels["!id"][id].Target}function sheet_insert_comments(sheet,comments,threaded,people){var dense=Array.isArray(sheet),cell;comments.forEach(function(comment){var r=decode_cell(comment.ref);if(dense?(sheet[r.r]||(sheet[r.r]=[]),cell=sheet[r.r][r.c]):cell=sheet[comment.ref],!cell){cell={t:"z"},dense?sheet[r.r][r.c]=cell:sheet[comment.ref]=cell;var range3=safe_decode_range(sheet["!ref"]||"BDWGO1000001:A1");range3.s.r>r.r&&(range3.s.r=r.r),range3.e.r<r.r&&(range3.e.r=r.r),range3.s.c>r.c&&(range3.s.c=r.c),range3.e.c<r.c&&(range3.e.c=r.c);var encoded=encode_range(range3);encoded!==sheet["!ref"]&&(sheet["!ref"]=encoded)}cell.c||(cell.c=[]);var o={a:comment.author,t:comment.t,r:comment.r,T:threaded};comment.h&&(o.h=comment.h);for(var i=cell.c.length-1;i>=0;--i){if(!threaded&&cell.c[i].T)return;threaded&&!cell.c[i].T&&cell.c.splice(i,1)}if(threaded&&people){for(i=0;i<people.length;++i)if(o.a==people[i].id){o.a=people[i].name||o.a;break}}cell.c.push(o)})}function parse_comments_xml(data,opts){if(data.match(/<(?:\w+:)?comments *\/>/))return[];var authors=[],commentList=[],authtag=data.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);authtag&&authtag[1]&&authtag[1].split(/<\/\w*:?author>/).forEach(function(x){if(!(x===""||x.trim()==="")){var a=x.match(/<(?:\w+:)?author[^>]*>(.*)/);a&&authors.push(a[1])}});var cmnttag=data.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return cmnttag&&cmnttag[1]&&cmnttag[1].split(/<\/\w*:?comment>/).forEach(function(x){if(!(x===""||x.trim()==="")){var cm=x.match(/<(?:\w+:)?comment[^>]*>/);if(!!cm){var y=parsexmltag(cm[0]),comment={author:y.authorId&&authors[y.authorId]||"sheetjsghost",ref:y.ref,guid:y.guid},cell=decode_cell(y.ref);if(!(opts.sheetRows&&opts.sheetRows<=cell.r)){var textMatch=x.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),rt=!!textMatch&&!!textMatch[1]&&parse_si(textMatch[1])||{r:"",t:"",h:""};comment.r=rt.r,rt.r=="<t></t>"&&(rt.t=rt.h=""),comment.t=(rt.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),opts.cellHTML&&(comment.h=rt.h),commentList.push(comment)}}}}),commentList}function parse_tcmnt_xml(data,opts){var out=[],pass=!1,comment={},tidx=0;return data.replace(tagregex,function(x,idx){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":comment={author:y.personId,guid:y.id,ref:y.ref,T:1};break;case"</threadedComment>":comment.t!=null&&out.push(comment);break;case"<text>":case"<text":tidx=idx+x.length;break;case"</text>":comment.t=data.slice(tidx,idx).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":pass=!0;break;case"</mentions>":pass=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(!pass&&opts.WTF)throw new Error("unrecognized "+y[0]+" in threaded comments")}return x}),out}function parse_people_xml(data,opts){var out=[],pass=!1;return data.replace(tagregex,function(x){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":out.push({name:y.displayname,id:y.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;default:if(!pass&&opts.WTF)throw new Error("unrecognized "+y[0]+" in threaded comments")}return x}),out}function parse_BrtBeginComment(data){var out={};out.iauthor=data.read_shift(4);var rfx=parse_UncheckedRfX(data,16);return out.rfx=rfx.s,out.ref=encode_cell(rfx.s),data.l+=16,out}var parse_BrtCommentAuthor=parse_XLWideString;function parse_comments_bin(data,opts){var out=[],authors=[],c={},pass=!1;return recordhopper(data,function(val,R,RT){switch(RT){case 632:authors.push(val);break;case 635:c=val;break;case 637:c.t=val.t,c.h=val.h,c.r=val.r;break;case 636:if(c.author=authors[c.iauthor],delete c.iauthor,opts.sheetRows&&c.rfx&&opts.sheetRows<=c.rfx.r)break;c.t||(c.t=""),delete c.rfx,out.push(c);break;case 3072:break;case 35:pass=!0;break;case 36:pass=!1;break;case 37:break;case 38:break;default:if(!R.T){if(!pass||opts.WTF)throw new Error("Unexpected record 0x"+RT.toString(16))}}}),out}var CT_VBA="application/vnd.ms-office.vbaProject";function make_vba_xls(cfb){var newcfb=CFB.utils.cfb_new({root:"R"});return cfb.FullPaths.forEach(function(p,i){if(!(p.slice(-1)==="/"||!p.match(/_VBA_PROJECT_CUR/))){var newpath=p.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");CFB.utils.cfb_add(newcfb,newpath,cfb.FileIndex[i].content)}}),CFB.write(newcfb)}function parse_ds_bin(){return{"!type":"dialog"}}function parse_ds_xml(){return{"!type":"dialog"}}function parse_ms_bin(){return{"!type":"macro"}}function parse_ms_xml(){return{"!type":"macro"}}var rc_to_a1=function(){var rcregex=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,rcbase={r:0,c:0};function rcfunc($$2,$1,$2,$3){var cRel=!1,rRel=!1;$2.length==0?rRel=!0:$2.charAt(0)=="["&&(rRel=!0,$2=$2.slice(1,-1)),$3.length==0?cRel=!0:$3.charAt(0)=="["&&(cRel=!0,$3=$3.slice(1,-1));var R=$2.length>0?parseInt($2,10)|0:0,C=$3.length>0?parseInt($3,10)|0:0;return cRel?C+=rcbase.c:--C,rRel?R+=rcbase.r:--R,$1+(cRel?"":"$")+encode_col(C)+(rRel?"":"$")+encode_row(R)}return function(fstr,base){return rcbase=base,fstr.replace(rcregex,rcfunc)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(fstr,base){return fstr.replace(crefregex,function($0,$1,$2,$3,$4,$5){var c=decode_col($3)-($2?0:base.c),r=decode_row($5)-($4?0:base.r),R=r==0?"":$4?r+1:"["+r+"]",C=c==0?"":$2?c+1:"["+c+"]";return $1+"R"+R+"C"+C})}}();function shift_formula_str(f,delta){return f.replace(crefregex,function($0,$1,$2,$3,$4,$5){return $1+($2=="$"?$2+$3:encode_col(decode_col($3)+delta.c))+($4=="$"?$4+$5:encode_row(decode_row($5)+delta.r))})}function shift_formula_xlsx(f,range3,cell){var r=decode_range(range3),s=r.s,c=decode_cell(cell),delta={r:c.r-s.r,c:c.c-s.c};return shift_formula_str(f,delta)}function fuzzyfmla(f){return f.length!=1}function _xlfn(f){return f.replace(/_xlfn\./g,"")}function parseread1(blob){blob.l+=1}function parse_ColRelU(blob,length){var c=blob.read_shift(length==1?1:2);return[c&16383,c>>14&1,c>>15&1]}function parse_RgceArea(blob,length,opts){var w=2;if(opts){if(opts.biff>=2&&opts.biff<=5)return parse_RgceArea_BIFF2(blob,length,opts);opts.biff==12&&(w=4)}var r=blob.read_shift(w),R=blob.read_shift(w),c=parse_ColRelU(blob,2),C=parse_ColRelU(blob,2);return{s:{r,c:c[0],cRel:c[1],rRel:c[2]},e:{r:R,c:C[0],cRel:C[1],rRel:C[2]}}}function parse_RgceArea_BIFF2(blob){var r=parse_ColRelU(blob,2),R=parse_ColRelU(blob,2),c=blob.read_shift(1),C=blob.read_shift(1);return{s:{r:r[0],c,cRel:r[1],rRel:r[2]},e:{r:R[0],c:C,cRel:R[1],rRel:R[2]}}}function parse_RgceAreaRel(blob,length,opts){if(opts.biff<8)return parse_RgceArea_BIFF2(blob,length,opts);var r=blob.read_shift(opts.biff==12?4:2),R=blob.read_shift(opts.biff==12?4:2),c=parse_ColRelU(blob,2),C=parse_ColRelU(blob,2);return{s:{r,c:c[0],cRel:c[1],rRel:c[2]},e:{r:R,c:C[0],cRel:C[1],rRel:C[2]}}}function parse_RgceLoc(blob,length,opts){if(opts&&opts.biff>=2&&opts.biff<=5)return parse_RgceLoc_BIFF2(blob,length,opts);var r=blob.read_shift(opts&&opts.biff==12?4:2),c=parse_ColRelU(blob,2);return{r,c:c[0],cRel:c[1],rRel:c[2]}}function parse_RgceLoc_BIFF2(blob){var r=parse_ColRelU(blob,2),c=blob.read_shift(1);return{r:r[0],c,cRel:r[1],rRel:r[2]}}function parse_RgceElfLoc(blob){var r=blob.read_shift(2),c=blob.read_shift(2);return{r,c:c&255,fQuoted:!!(c&16384),cRel:c>>15,rRel:c>>15}}function parse_RgceLocRel(blob,length,opts){var biff=opts&&opts.biff?opts.biff:8;if(biff>=2&&biff<=5)return parse_RgceLocRel_BIFF2(blob,length,opts);var r=blob.read_shift(biff>=12?4:2),cl=blob.read_shift(2),cRel=(cl&16384)>>14,rRel=(cl&32768)>>15;if(cl&=16383,rRel==1)for(;r>524287;)r-=1048576;if(cRel==1)for(;cl>8191;)cl=cl-16384;return{r,c:cl,cRel,rRel}}function parse_RgceLocRel_BIFF2(blob){var rl=blob.read_shift(2),c=blob.read_shift(1),rRel=(rl&32768)>>15,cRel=(rl&16384)>>14;return rl&=16383,rRel==1&&rl>=8192&&(rl=rl-16384),cRel==1&&c>=128&&(c=c-256),{r:rl,c,cRel,rRel}}function parse_PtgArea(blob,length,opts){var type=(blob[blob.l++]&96)>>5,area=parse_RgceArea(blob,opts.biff>=2&&opts.biff<=5?6:8,opts);return[type,area]}function parse_PtgArea3d(blob,length,opts){var type=(blob[blob.l++]&96)>>5,ixti=blob.read_shift(2,"i"),w=8;if(opts)switch(opts.biff){case 5:blob.l+=12,w=6;break;case 12:w=12;break}var area=parse_RgceArea(blob,w,opts);return[type,ixti,area]}function parse_PtgAreaErr(blob,length,opts){var type=(blob[blob.l++]&96)>>5;return blob.l+=opts&&opts.biff>8?12:opts.biff<8?6:8,[type]}function parse_PtgAreaErr3d(blob,length,opts){var type=(blob[blob.l++]&96)>>5,ixti=blob.read_shift(2),w=8;if(opts)switch(opts.biff){case 5:blob.l+=12,w=6;break;case 12:w=12;break}return blob.l+=w,[type,ixti]}function parse_PtgAreaN(blob,length,opts){var type=(blob[blob.l++]&96)>>5,area=parse_RgceAreaRel(blob,length-1,opts);return[type,area]}function parse_PtgArray(blob,length,opts){var type=(blob[blob.l++]&96)>>5;return blob.l+=opts.biff==2?6:opts.biff==12?14:7,[type]}function parse_PtgAttrBaxcel(blob){var bitSemi=blob[blob.l+1]&1,bitBaxcel=1;return blob.l+=4,[bitSemi,bitBaxcel]}function parse_PtgAttrChoose(blob,length,opts){blob.l+=2;for(var offset=blob.read_shift(opts&&opts.biff==2?1:2),o=[],i=0;i<=offset;++i)o.push(blob.read_shift(opts&&opts.biff==2?1:2));return o}function parse_PtgAttrGoto(blob,length,opts){var bitGoto=blob[blob.l+1]&255?1:0;return blob.l+=2,[bitGoto,blob.read_shift(opts&&opts.biff==2?1:2)]}function parse_PtgAttrIf(blob,length,opts){var bitIf=blob[blob.l+1]&255?1:0;return blob.l+=2,[bitIf,blob.read_shift(opts&&opts.biff==2?1:2)]}function parse_PtgAttrIfError(blob){var bitIf=blob[blob.l+1]&255?1:0;return blob.l+=2,[bitIf,blob.read_shift(2)]}function parse_PtgAttrSemi(blob,length,opts){var bitSemi=blob[blob.l+1]&255?1:0;return blob.l+=opts&&opts.biff==2?3:4,[bitSemi]}function parse_PtgAttrSpaceType(blob){var type=blob.read_shift(1),cch=blob.read_shift(1);return[type,cch]}function parse_PtgAttrSpace(blob){return blob.read_shift(2),parse_PtgAttrSpaceType(blob,2)}function parse_PtgAttrSpaceSemi(blob){return blob.read_shift(2),parse_PtgAttrSpaceType(blob,2)}function parse_PtgRef(blob,length,opts){var type=(blob[blob.l]&96)>>5;blob.l+=1;var loc=parse_RgceLoc(blob,0,opts);return[type,loc]}function parse_PtgRefN(blob,length,opts){var type=(blob[blob.l]&96)>>5;blob.l+=1;var loc=parse_RgceLocRel(blob,0,opts);return[type,loc]}function parse_PtgRef3d(blob,length,opts){var type=(blob[blob.l]&96)>>5;blob.l+=1;var ixti=blob.read_shift(2);opts&&opts.biff==5&&(blob.l+=12);var loc=parse_RgceLoc(blob,0,opts);return[type,ixti,loc]}function parse_PtgFunc(blob,length,opts){var type=(blob[blob.l]&96)>>5;blob.l+=1;var iftab=blob.read_shift(opts&&opts.biff<=3?1:2);return[FtabArgc[iftab],Ftab[iftab],type]}function parse_PtgFuncVar(blob,length,opts){var type=blob[blob.l++],cparams=blob.read_shift(1),tab=opts&&opts.biff<=3?[type==88?-1:0,blob.read_shift(1)]:parsetab(blob);return[cparams,(tab[0]===0?Ftab:Cetab)[tab[1]]]}function parsetab(blob){return[blob[blob.l+1]>>7,blob.read_shift(2)&32767]}function parse_PtgAttrSum(blob,length,opts){blob.l+=opts&&opts.biff==2?3:4}function parse_PtgExp(blob,length,opts){if(blob.l++,opts&&opts.biff==12)return[blob.read_shift(4,"i"),0];var row=blob.read_shift(2),col=blob.read_shift(opts&&opts.biff==2?1:2);return[row,col]}function parse_PtgErr(blob){return blob.l++,BErr[blob.read_shift(1)]}function parse_PtgInt(blob){return blob.l++,blob.read_shift(2)}function parse_PtgBool(blob){return blob.l++,blob.read_shift(1)!==0}function parse_PtgNum(blob){return blob.l++,parse_Xnum(blob,8)}function parse_PtgStr(blob,length,opts){return blob.l++,parse_ShortXLUnicodeString(blob,length-1,opts)}function parse_SerAr(blob,biff){var val=[blob.read_shift(1)];if(biff==12)switch(val[0]){case 2:val[0]=4;break;case 4:val[0]=16;break;case 0:val[0]=1;break;case 1:val[0]=2;break}switch(val[0]){case 4:val[1]=parsebool(blob,1)?"TRUE":"FALSE",biff!=12&&(blob.l+=7);break;case 37:case 16:val[1]=BErr[blob[blob.l]],blob.l+=biff==12?4:8;break;case 0:blob.l+=8;break;case 1:val[1]=parse_Xnum(blob,8);break;case 2:val[1]=parse_XLUnicodeString2(blob,0,{biff:biff>0&&biff<8?2:biff});break;default:throw new Error("Bad SerAr: "+val[0])}return val}function parse_PtgExtraMem(blob,cce,opts){for(var count2=blob.read_shift(opts.biff==12?4:2),out=[],i=0;i!=count2;++i)out.push((opts.biff==12?parse_UncheckedRfX:parse_Ref8U)(blob,8));return out}function parse_PtgExtraArray(blob,length,opts){var rows=0,cols=0;opts.biff==12?(rows=blob.read_shift(4),cols=blob.read_shift(4)):(cols=1+blob.read_shift(1),rows=1+blob.read_shift(2)),opts.biff>=2&&opts.biff<8&&(--rows,--cols==0&&(cols=256));for(var i=0,o=[];i!=rows&&(o[i]=[]);++i)for(var j=0;j!=cols;++j)o[i][j]=parse_SerAr(blob,opts.biff);return o}function parse_PtgName(blob,length,opts){var type=blob.read_shift(1)>>>5&3,w=!opts||opts.biff>=8?4:2,nameindex=blob.read_shift(w);switch(opts.biff){case 2:blob.l+=5;break;case 3:case 4:blob.l+=8;break;case 5:blob.l+=12;break}return[type,0,nameindex]}function parse_PtgNameX(blob,length,opts){if(opts.biff==5)return parse_PtgNameX_BIFF5(blob,length,opts);var type=blob.read_shift(1)>>>5&3,ixti=blob.read_shift(2),nameindex=blob.read_shift(4);return[type,ixti,nameindex]}function parse_PtgNameX_BIFF5(blob){var type=blob.read_shift(1)>>>5&3,ixti=blob.read_shift(2,"i");blob.l+=8;var nameindex=blob.read_shift(2);return blob.l+=12,[type,ixti,nameindex]}function parse_PtgMemArea(blob,length,opts){var type=blob.read_shift(1)>>>5&3;blob.l+=opts&&opts.biff==2?3:4;var cce=blob.read_shift(opts&&opts.biff==2?1:2);return[type,cce]}function parse_PtgMemFunc(blob,length,opts){var type=blob.read_shift(1)>>>5&3,cce=blob.read_shift(opts&&opts.biff==2?1:2);return[type,cce]}function parse_PtgRefErr(blob,length,opts){var type=blob.read_shift(1)>>>5&3;return blob.l+=4,opts.biff<8&&blob.l--,opts.biff==12&&(blob.l+=2),[type]}function parse_PtgRefErr3d(blob,length,opts){var type=(blob[blob.l++]&96)>>5,ixti=blob.read_shift(2),w=4;if(opts)switch(opts.biff){case 5:w=15;break;case 12:w=6;break}return blob.l+=w,[type,ixti]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(blob,length,opts){return blob.l+=2,[parse_RgceElfLoc(blob,4,opts)]}function parse_PtgElfNoop(blob){return blob.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(blob){return blob.l+=2,[parseuint16(blob),blob.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(blob){blob.l+=2;var ixti=blob.read_shift(2),flags=blob.read_shift(2),idx=blob.read_shift(4),c=blob.read_shift(2),C=blob.read_shift(2),rt=PtgListRT[flags>>2&31];return{ixti,coltype:flags&3,rt,idx,c,C}}function parse_PtgSxName(blob){return blob.l+=2,[blob.read_shift(4)]}function parse_PtgSheet(blob,length,opts){return blob.l+=5,blob.l+=2,blob.l+=opts.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(blob,length,opts){return blob.l+=opts.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(blob){var type=blob.read_shift(1)>>>5&3,cce=blob.read_shift(2);return[type,cce]}function parse_PtgMemNoMemN(blob){var type=blob.read_shift(1)>>>5&3,cce=blob.read_shift(2);return[type,cce]}function parse_PtgAttrNoop(blob){return blob.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(blob,length,rgce,opts){if(opts.biff<8)return parsenoop(blob,length);for(var target=blob.l+length,o=[],i=0;i!==rgce.length;++i)switch(rgce[i][0]){case"PtgArray":rgce[i][1]=parse_PtgExtraArray(blob,0,opts),o.push(rgce[i][1]);break;case"PtgMemArea":rgce[i][2]=parse_PtgExtraMem(blob,rgce[i][1],opts),o.push(rgce[i][2]);break;case"PtgExp":opts&&opts.biff==12&&(rgce[i][1][1]=blob.read_shift(4),o.push(rgce[i][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+rgce[i][0];default:break}return length=target-blob.l,length!==0&&o.push(parsenoop(blob,length)),o}function parse_Rgce(blob,length,opts){for(var target=blob.l+length,R,id,ptgs=[];target!=blob.l;)length=target-blob.l,id=blob[blob.l],R=PtgTypes[id]||PtgTypes[PtgDupes[id]],(id===24||id===25)&&(R=(id===24?Ptg18:Ptg19)[blob[blob.l+1]]),!R||!R.f?parsenoop(blob,length):ptgs.push([R.n,R.f(blob,length,opts)]);return ptgs}function stringify_array(f){for(var o=[],i=0;i<f.length;++i){for(var x=f[i],r=[],j=0;j<x.length;++j){var y=x[j];if(y)switch(y[0]){case 2:r.push('"'+y[1].replace(/"/g,'""')+'"');break;default:r.push(y[1])}else r.push("")}o.push(r.join(","))}return o.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(sname,opts){if(!sname&&!(opts&&opts.biff<=5&&opts.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(sname)?"'"+sname+"'":sname}function get_ixti_raw(supbooks,ixti,opts){if(!supbooks)return"SH33TJSERR0";if(opts.biff>8&&(!supbooks.XTI||!supbooks.XTI[ixti]))return supbooks.SheetNames[ixti];if(!supbooks.XTI)return"SH33TJSERR6";var XTI=supbooks.XTI[ixti];if(opts.biff<8)return ixti>1e4&&(ixti-=65536),ixti<0&&(ixti=-ixti),ixti==0?"":supbooks.XTI[ixti-1];if(!XTI)return"SH33TJSERR1";var o="";if(opts.biff>8)switch(supbooks[XTI[0]][0]){case 357:return o=XTI[1]==-1?"#REF":supbooks.SheetNames[XTI[1]],XTI[1]==XTI[2]?o:o+":"+supbooks.SheetNames[XTI[2]];case 358:return opts.SID!=null?supbooks.SheetNames[opts.SID]:"SH33TJSSAME"+supbooks[XTI[0]][0];case 355:default:return"SH33TJSSRC"+supbooks[XTI[0]][0]}switch(supbooks[XTI[0]][0][0]){case 1025:return o=XTI[1]==-1?"#REF":supbooks.SheetNames[XTI[1]]||"SH33TJSERR3",XTI[1]==XTI[2]?o:o+":"+supbooks.SheetNames[XTI[2]];case 14849:return supbooks[XTI[0]].slice(1).map(function(name){return name.Name}).join(";;");default:return supbooks[XTI[0]][0][3]?(o=XTI[1]==-1?"#REF":supbooks[XTI[0]][0][3][XTI[1]]||"SH33TJSERR4",XTI[1]==XTI[2]?o:o+":"+supbooks[XTI[0]][0][3][XTI[2]]):"SH33TJSERR2"}}function get_ixti(supbooks,ixti,opts){var ixtiraw=get_ixti_raw(supbooks,ixti,opts);return ixtiraw=="#REF"?ixtiraw:formula_quote_sheet_name(ixtiraw,opts)}function stringify_formula(formula,range3,cell,supbooks,opts){var biff=opts&&opts.biff||8,_range={s:{c:0,r:0},e:{c:0,r:0}},stack=[],e1,e2,c,ixti=0,nameidx=0,r,sname="";if(!formula[0]||!formula[0][0])return"";for(var last_sp=-1,sp="",ff=0,fflen=formula[0].length;ff<fflen;++ff){var f=formula[0][ff];switch(f[0]){case"PtgUminus":stack.push("-"+stack.pop());break;case"PtgUplus":stack.push("+"+stack.pop());break;case"PtgPercent":stack.push(stack.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(e1=stack.pop(),e2=stack.pop(),last_sp>=0){switch(formula[0][last_sp][1][0]){case 0:sp=fill(" ",formula[0][last_sp][1][1]);break;case 1:sp=fill("\r",formula[0][last_sp][1][1]);break;default:if(sp="",opts.WTF)throw new Error("Unexpected PtgAttrSpaceType "+formula[0][last_sp][1][0])}e2=e2+sp,last_sp=-1}stack.push(e2+PtgBinOp[f[0]]+e1);break;case"PtgIsect":e1=stack.pop(),e2=stack.pop(),stack.push(e2+" "+e1);break;case"PtgUnion":e1=stack.pop(),e2=stack.pop(),stack.push(e2+","+e1);break;case"PtgRange":e1=stack.pop(),e2=stack.pop(),stack.push(e2+":"+e1);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":c=shift_cell_xls(f[1][1],_range,opts),stack.push(encode_cell_xls(c,biff));break;case"PtgRefN":c=cell?shift_cell_xls(f[1][1],cell,opts):f[1][1],stack.push(encode_cell_xls(c,biff));break;case"PtgRef3d":ixti=f[1][1],c=shift_cell_xls(f[1][2],_range,opts),sname=get_ixti(supbooks,ixti,opts);var w=sname;stack.push(sname+"!"+encode_cell_xls(c,biff));break;case"PtgFunc":case"PtgFuncVar":var argc=f[1][0],func=f[1][1];argc||(argc=0),argc&=127;var args=argc==0?[]:stack.slice(-argc);stack.length-=argc,func==="User"&&(func=args.shift()),stack.push(func+"("+args.join(",")+")");break;case"PtgBool":stack.push(f[1]?"TRUE":"FALSE");break;case"PtgInt":stack.push(f[1]);break;case"PtgNum":stack.push(String(f[1]));break;case"PtgStr":stack.push('"'+f[1].replace(/"/g,'""')+'"');break;case"PtgErr":stack.push(f[1]);break;case"PtgAreaN":r=shift_range_xls(f[1][1],cell?{s:cell}:_range,opts),stack.push(encode_range_xls(r,opts));break;case"PtgArea":r=shift_range_xls(f[1][1],_range,opts),stack.push(encode_range_xls(r,opts));break;case"PtgArea3d":ixti=f[1][1],r=f[1][2],sname=get_ixti(supbooks,ixti,opts),stack.push(sname+"!"+encode_range_xls(r,opts));break;case"PtgAttrSum":stack.push("SUM("+stack.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":nameidx=f[1][2];var lbl=(supbooks.names||[])[nameidx-1]||(supbooks[0]||[])[nameidx],name=lbl?lbl.Name:"SH33TJSNAME"+String(nameidx);name&&name.slice(0,6)=="_xlfn."&&!opts.xlfn&&(name=name.slice(6)),stack.push(name);break;case"PtgNameX":var bookidx=f[1][1];nameidx=f[1][2];var externbook;if(opts.biff<=5)bookidx<0&&(bookidx=-bookidx),supbooks[bookidx]&&(externbook=supbooks[bookidx][nameidx]);else{var o="";if(((supbooks[bookidx]||[])[0]||[])[0]==14849||(((supbooks[bookidx]||[])[0]||[])[0]==1025?supbooks[bookidx][nameidx]&&supbooks[bookidx][nameidx].itab>0&&(o=supbooks.SheetNames[supbooks[bookidx][nameidx].itab-1]+"!"):o=supbooks.SheetNames[nameidx-1]+"!"),supbooks[bookidx]&&supbooks[bookidx][nameidx])o+=supbooks[bookidx][nameidx].Name;else if(supbooks[0]&&supbooks[0][nameidx])o+=supbooks[0][nameidx].Name;else{var ixtidata=(get_ixti_raw(supbooks,bookidx,opts)||"").split(";;");ixtidata[nameidx-1]?o=ixtidata[nameidx-1]:o+="SH33TJSERRX"}stack.push(o);break}externbook||(externbook={Name:"SH33TJSERRY"}),stack.push(externbook.Name);break;case"PtgParen":var lp="(",rp=")";if(last_sp>=0){switch(sp="",formula[0][last_sp][1][0]){case 2:lp=fill(" ",formula[0][last_sp][1][1])+lp;break;case 3:lp=fill("\r",formula[0][last_sp][1][1])+lp;break;case 4:rp=fill(" ",formula[0][last_sp][1][1])+rp;break;case 5:rp=fill("\r",formula[0][last_sp][1][1])+rp;break;default:if(opts.WTF)throw new Error("Unexpected PtgAttrSpaceType "+formula[0][last_sp][1][0])}last_sp=-1}stack.push(lp+stack.pop()+rp);break;case"PtgRefErr":stack.push("#REF!");break;case"PtgRefErr3d":stack.push("#REF!");break;case"PtgExp":c={c:f[1][1],r:f[1][0]};var q={c:cell.c,r:cell.r};if(supbooks.sharedf[encode_cell(c)]){var parsedf=supbooks.sharedf[encode_cell(c)];stack.push(stringify_formula(parsedf,_range,q,supbooks,opts))}else{var fnd=!1;for(e1=0;e1!=supbooks.arrayf.length;++e1)if(e2=supbooks.arrayf[e1],!(c.c<e2[0].s.c||c.c>e2[0].e.c)&&!(c.r<e2[0].s.r||c.r>e2[0].e.r)){stack.push(stringify_formula(e2[1],_range,q,supbooks,opts)),fnd=!0;break}fnd||stack.push(f[1])}break;case"PtgArray":stack.push("{"+stringify_array(f[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":last_sp=ff;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":stack.push("");break;case"PtgAreaErr":stack.push("#REF!");break;case"PtgAreaErr3d":stack.push("#REF!");break;case"PtgList":stack.push("Table"+f[1].idx+"[#"+f[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(f));default:throw new Error("Unrecognized Formula Token: "+String(f))}var PtgNonDisp=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(opts.biff!=3&&last_sp>=0&&PtgNonDisp.indexOf(formula[0][ff][0])==-1){f=formula[0][last_sp];var _left=!0;switch(f[1][0]){case 4:_left=!1;case 0:sp=fill(" ",f[1][1]);break;case 5:_left=!1;case 1:sp=fill("\r",f[1][1]);break;default:if(sp="",opts.WTF)throw new Error("Unexpected PtgAttrSpaceType "+f[1][0])}stack.push((_left?sp:"")+stack.pop()+(_left?"":sp)),last_sp=-1}}if(stack.length>1&&opts.WTF)throw new Error("bad formula stack");return stack[0]}function parse_ArrayParsedFormula(blob,length,opts){var target=blob.l+length,len2=opts.biff==2?1:2,rgcb,cce=blob.read_shift(len2);if(cce==65535)return[[],parsenoop(blob,length-2)];var rgce=parse_Rgce(blob,cce,opts);return length!==cce+len2&&(rgcb=parse_RgbExtra(blob,length-cce-len2,rgce,opts)),blob.l=target,[rgce,rgcb]}function parse_XLSCellParsedFormula(blob,length,opts){var target=blob.l+length,len2=opts.biff==2?1:2,rgcb,cce=blob.read_shift(len2);if(cce==65535)return[[],parsenoop(blob,length-2)];var rgce=parse_Rgce(blob,cce,opts);return length!==cce+len2&&(rgcb=parse_RgbExtra(blob,length-cce-len2,rgce,opts)),blob.l=target,[rgce,rgcb]}function parse_NameParsedFormula(blob,length,opts,cce){var target=blob.l+length,rgce=parse_Rgce(blob,cce,opts),rgcb;return target!==blob.l&&(rgcb=parse_RgbExtra(blob,target-blob.l,rgce,opts)),[rgce,rgcb]}function parse_SharedParsedFormula(blob,length,opts){var target=blob.l+length,rgcb,cce=blob.read_shift(2),rgce=parse_Rgce(blob,cce,opts);return cce==65535?[[],parsenoop(blob,length-2)]:(length!==cce+2&&(rgcb=parse_RgbExtra(blob,target-cce-2,rgce,opts)),[rgce,rgcb])}function parse_FormulaValue(blob){var b;if(__readUInt16LE(blob,blob.l+6)!==65535)return[parse_Xnum(blob),"n"];switch(blob[blob.l]){case 0:return blob.l+=8,["String","s"];case 1:return b=blob[blob.l+2]===1,blob.l+=8,[b,"b"];case 2:return b=blob[blob.l+2],blob.l+=8,[b,"e"];case 3:return blob.l+=8,["","s"]}return[]}function parse_Formula(blob,length,opts){var end=blob.l+length,cell=parse_XLSCell(blob,6);opts.biff==2&&++blob.l;var val=parse_FormulaValue(blob,8),flags=blob.read_shift(1);opts.biff!=2&&(blob.read_shift(1),opts.biff>=5&&blob.read_shift(4));var cbf=parse_XLSCellParsedFormula(blob,end-blob.l,opts);return{cell,val:val[0],formula:cbf,shared:flags>>3&1,tt:val[1]}}function parse_XLSBParsedFormula(data,length,opts){var cce=data.read_shift(4),rgce=parse_Rgce(data,cce,opts),cb=data.read_shift(4),rgcb=cb>0?parse_RgbExtra(data,cb,rgce,opts):null;return[rgce,rgcb]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function ods_to_csf_formula(f){return f.slice(0,3)=="of:"&&(f=f.slice(3)),f.charCodeAt(0)==61&&(f=f.slice(1),f.charCodeAt(0)==61&&(f=f.slice(1))),f=f.replace(/COM\.MICROSOFT\./g,""),f=f.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function($$2,$1){return $1.replace(/\./g,"")}),f=f.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),f.replace(/[;~]/g,",").replace(/\|/g,";")}function ods_to_csf_3D(r){var a=r.split(":"),s=a[0].split(".")[0];return[s,a[0].split(".")[1]+(a.length>1?":"+(a[1].split(".")[1]||a[1].split(".")[0]):"")]}var strs={},_ssfopts={},browser_has_Map=typeof Map!="undefined";function default_margins(margins,mode){if(!!margins){var defs=[.7,.7,.75,.75,.3,.3];mode=="xlml"&&(defs=[1,1,1,1,.5,.5]),margins.left==null&&(margins.left=defs[0]),margins.right==null&&(margins.right=defs[1]),margins.top==null&&(margins.top=defs[2]),margins.bottom==null&&(margins.bottom=defs[3]),margins.header==null&&(margins.header=defs[4]),margins.footer==null&&(margins.footer=defs[5])}}function safe_format(p,fmtid,fillid,opts,themes,styles){try{opts.cellNF&&(p.z=table_fmt[fmtid])}catch(e){if(opts.WTF)throw e}if(!(p.t==="z"&&!opts.cellStyles)){if(p.t==="d"&&typeof p.v=="string"&&(p.v=parseDate(p.v)),(!opts||opts.cellText!==!1)&&p.t!=="z")try{if(table_fmt[fmtid]==null&&SSF_load(SSFImplicit[fmtid]||"General",fmtid),p.t==="e")p.w=p.w||BErr[p.v];else if(fmtid===0)if(p.t==="n")(p.v|0)===p.v?p.w=p.v.toString(10):p.w=SSF_general_num(p.v);else if(p.t==="d"){var dd=datenum(p.v);(dd|0)===dd?p.w=dd.toString(10):p.w=SSF_general_num(dd)}else{if(p.v===void 0)return"";p.w=SSF_general(p.v,_ssfopts)}else p.t==="d"?p.w=SSF_format(fmtid,datenum(p.v),_ssfopts):p.w=SSF_format(fmtid,p.v,_ssfopts)}catch(e){if(opts.WTF)throw e}if(!!opts.cellStyles&&fillid!=null)try{p.s=styles.Fills[fillid],p.s.fgColor&&p.s.fgColor.theme&&!p.s.fgColor.rgb&&(p.s.fgColor.rgb=rgb_tint(themes.themeElements.clrScheme[p.s.fgColor.theme].rgb,p.s.fgColor.tint||0),opts.WTF&&(p.s.fgColor.raw_rgb=themes.themeElements.clrScheme[p.s.fgColor.theme].rgb)),p.s.bgColor&&p.s.bgColor.theme&&(p.s.bgColor.rgb=rgb_tint(themes.themeElements.clrScheme[p.s.bgColor.theme].rgb,p.s.bgColor.tint||0),opts.WTF&&(p.s.bgColor.raw_rgb=themes.themeElements.clrScheme[p.s.bgColor.theme].rgb))}catch(e){if(opts.WTF&&styles.Fills)throw e}}}function parse_ws_xml_dim(ws,s){var d=safe_decode_range(s);d.s.r<=d.e.r&&d.s.c<=d.e.c&&d.s.r>=0&&d.s.c>=0&&(ws["!ref"]=encode_range(d))}var mergecregex=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,sheetdataregex=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,hlinkregex=/<(?:\w:)?hyperlink [^>]*>/mg,dimregex=/"(\w*:\w*)"/,colregex=/<(?:\w:)?col\b[^>]*[\/]?>/g,afregex=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,marginregex=/<(?:\w:)?pageMargins[^>]*\/>/g,sheetprregex=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,sheetprregex2=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,svsregex=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function parse_ws_xml(data,opts,idx,rels,wb,themes,styles){if(!data)return data;rels||(rels={"!id":{}}),DENSE!=null&&opts.dense==null&&(opts.dense=DENSE);var s=opts.dense?[]:{},refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}},data1="",data2="",mtch=data.match(sheetdataregex);mtch?(data1=data.slice(0,mtch.index),data2=data.slice(mtch.index+mtch[0].length)):data1=data2=data;var sheetPr=data1.match(sheetprregex);sheetPr?parse_ws_xml_sheetpr(sheetPr[0],s,wb,idx):(sheetPr=data1.match(sheetprregex2))&&parse_ws_xml_sheetpr2(sheetPr[0],sheetPr[1]||"",s,wb,idx,styles,themes);var ridx=(data1.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(ridx>0){var ref=data1.slice(ridx,ridx+50).match(dimregex);ref&&parse_ws_xml_dim(s,ref[1])}var svs=data1.match(svsregex);svs&&svs[1]&&parse_ws_xml_sheetviews(svs[1],wb);var columns=[];if(opts.cellStyles){var cols=data1.match(colregex);cols&&parse_ws_xml_cols(columns,cols)}mtch&&parse_ws_xml_data(mtch[1],s,opts,refguess,themes,styles);var afilter=data2.match(afregex);afilter&&(s["!autofilter"]=parse_ws_xml_autofilter(afilter[0]));var merges=[],_merge=data2.match(mergecregex);if(_merge)for(ridx=0;ridx!=_merge.length;++ridx)merges[ridx]=safe_decode_range(_merge[ridx].slice(_merge[ridx].indexOf('"')+1));var hlink=data2.match(hlinkregex);hlink&&parse_ws_xml_hlinks(s,hlink,rels);var margins=data2.match(marginregex);if(margins&&(s["!margins"]=parse_ws_xml_margins(parsexmltag(margins[0]))),!s["!ref"]&&refguess.e.c>=refguess.s.c&&refguess.e.r>=refguess.s.r&&(s["!ref"]=encode_range(refguess)),opts.sheetRows>0&&s["!ref"]){var tmpref=safe_decode_range(s["!ref"]);opts.sheetRows<=+tmpref.e.r&&(tmpref.e.r=opts.sheetRows-1,tmpref.e.r>refguess.e.r&&(tmpref.e.r=refguess.e.r),tmpref.e.r<tmpref.s.r&&(tmpref.s.r=tmpref.e.r),tmpref.e.c>refguess.e.c&&(tmpref.e.c=refguess.e.c),tmpref.e.c<tmpref.s.c&&(tmpref.s.c=tmpref.e.c),s["!fullref"]=s["!ref"],s["!ref"]=encode_range(tmpref))}return columns.length>0&&(s["!cols"]=columns),merges.length>0&&(s["!merges"]=merges),s}function parse_ws_xml_sheetpr(sheetPr,s,wb,idx){var data=parsexmltag(sheetPr);wb.Sheets[idx]||(wb.Sheets[idx]={}),data.codeName&&(wb.Sheets[idx].CodeName=unescapexml(utf8read(data.codeName)))}function parse_ws_xml_sheetpr2(sheetPr,body,s,wb,idx){parse_ws_xml_sheetpr(sheetPr.slice(0,sheetPr.indexOf(">")),s,wb,idx)}function parse_ws_xml_hlinks(s,data,rels){for(var dense=Array.isArray(s),i=0;i!=data.length;++i){var val=parsexmltag(utf8read(data[i]),!0);if(!val.ref)return;var rel=((rels||{})["!id"]||[])[val.id];rel?(val.Target=rel.Target,val.location&&(val.Target+="#"+unescapexml(val.location))):(val.Target="#"+unescapexml(val.location),rel={Target:val.Target,TargetMode:"Internal"}),val.Rel=rel,val.tooltip&&(val.Tooltip=val.tooltip,delete val.tooltip);for(var rng=safe_decode_range(val.ref),R=rng.s.r;R<=rng.e.r;++R)for(var C=rng.s.c;C<=rng.e.c;++C){var addr=encode_cell({c:C,r:R});dense?(s[R]||(s[R]=[]),s[R][C]||(s[R][C]={t:"z",v:void 0}),s[R][C].l=val):(s[addr]||(s[addr]={t:"z",v:void 0}),s[addr].l=val)}}}function parse_ws_xml_margins(margin){var o={};return["left","right","top","bottom","header","footer"].forEach(function(k){margin[k]&&(o[k]=parseFloat(margin[k]))}),o}function parse_ws_xml_cols(columns,cols){for(var seencol=!1,coli=0;coli!=cols.length;++coli){var coll=parsexmltag(cols[coli],!0);coll.hidden&&(coll.hidden=parsexmlbool(coll.hidden));var colm=parseInt(coll.min,10)-1,colM=parseInt(coll.max,10)-1;for(coll.outlineLevel&&(coll.level=+coll.outlineLevel||0),delete coll.min,delete coll.max,coll.width=+coll.width,!seencol&&coll.width&&(seencol=!0,find_mdw_colw(coll.width)),process_col(coll);colm<=colM;)columns[colm++]=dup(coll)}}function parse_ws_xml_autofilter(data){var o={ref:(data.match(/ref="([^"]*)"/)||[])[1]};return o}var sviewregex=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function parse_ws_xml_sheetviews(data,wb){wb.Views||(wb.Views=[{}]),(data.match(sviewregex)||[]).forEach(function(r,i){var tag=parsexmltag(r);wb.Views[i]||(wb.Views[i]={}),+tag.zoomScale&&(wb.Views[i].zoom=+tag.zoomScale),parsexmlbool(tag.rightToLeft)&&(wb.Views[i].RTL=!0)})}var parse_ws_xml_data=function(){var cellregex=/<(?:\w+:)?c[ \/>]/,rowregex=/<\/(?:\w+:)?row>/,rregex=/r=["']([^"']*)["']/,isregex=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,refregex=/ref=["']([^"']*)["']/,match_v=matchtag("v"),match_f=matchtag("f");return function(sdata,s,opts,guess,themes,styles){for(var ri=0,x="",cells=[],cref=[],idx=0,i=0,cc=0,d="",p,tag,tagr=0,tagc=0,sstr,ftag,fmtid=0,fillid=0,do_format=Array.isArray(styles.CellXf),cf,arrayf=[],sharedf=[],dense=Array.isArray(s),rows=[],rowobj={},rowrite=!1,sheetStubs=!!opts.sheetStubs,marr=sdata.split(rowregex),mt=0,marrlen=marr.length;mt!=marrlen;++mt){x=marr[mt].trim();var xlen=x.length;if(xlen===0)continue;var rstarti=0;outa:for(ri=0;ri<xlen;++ri)switch(x[ri]){case">":if(x[ri-1]!="/"){++ri;break outa}if(opts&&opts.cellStyles){if(tag=parsexmltag(x.slice(rstarti,ri),!0),tagr=tag.r!=null?parseInt(tag.r,10):tagr+1,tagc=-1,opts.sheetRows&&opts.sheetRows<tagr)continue;rowobj={},rowrite=!1,tag.ht&&(rowrite=!0,rowobj.hpt=parseFloat(tag.ht),rowobj.hpx=pt2px(rowobj.hpt)),tag.hidden=="1"&&(rowrite=!0,rowobj.hidden=!0),tag.outlineLevel!=null&&(rowrite=!0,rowobj.level=+tag.outlineLevel),rowrite&&(rows[tagr-1]=rowobj)}break;case"<":rstarti=ri;break}if(rstarti>=ri)break;if(tag=parsexmltag(x.slice(rstarti,ri),!0),tagr=tag.r!=null?parseInt(tag.r,10):tagr+1,tagc=-1,!(opts.sheetRows&&opts.sheetRows<tagr)){guess.s.r>tagr-1&&(guess.s.r=tagr-1),guess.e.r<tagr-1&&(guess.e.r=tagr-1),opts&&opts.cellStyles&&(rowobj={},rowrite=!1,tag.ht&&(rowrite=!0,rowobj.hpt=parseFloat(tag.ht),rowobj.hpx=pt2px(rowobj.hpt)),tag.hidden=="1"&&(rowrite=!0,rowobj.hidden=!0),tag.outlineLevel!=null&&(rowrite=!0,rowobj.level=+tag.outlineLevel),rowrite&&(rows[tagr-1]=rowobj)),cells=x.slice(ri).split(cellregex);for(var rslice=0;rslice!=cells.length&&cells[rslice].trim().charAt(0)=="<";++rslice);for(cells=cells.slice(rslice),ri=0;ri!=cells.length;++ri)if(x=cells[ri].trim(),x.length!==0){if(cref=x.match(rregex),idx=ri,i=0,cc=0,x="<c "+(x.slice(0,1)=="<"?">":"")+x,cref!=null&&cref.length===2){for(idx=0,d=cref[1],i=0;i!=d.length&&!((cc=d.charCodeAt(i)-64)<1||cc>26);++i)idx=26*idx+cc;--idx,tagc=idx}else++tagc;for(i=0;i!=x.length&&x.charCodeAt(i)!==62;++i);if(++i,tag=parsexmltag(x.slice(0,i),!0),tag.r||(tag.r=encode_cell({r:tagr-1,c:tagc})),d=x.slice(i),p={t:""},(cref=d.match(match_v))!=null&&cref[1]!==""&&(p.v=unescapexml(cref[1])),opts.cellFormula){if((cref=d.match(match_f))!=null&&cref[1]!==""){if(p.f=unescapexml(utf8read(cref[1])).replace(/\r\n/g,`
`),opts.xlfn||(p.f=_xlfn(p.f)),cref[0].indexOf('t="array"')>-1)p.F=(d.match(refregex)||[])[1],p.F.indexOf(":")>-1&&arrayf.push([safe_decode_range(p.F),p.F]);else if(cref[0].indexOf('t="shared"')>-1){ftag=parsexmltag(cref[0]);var ___f=unescapexml(utf8read(cref[1]));opts.xlfn||(___f=_xlfn(___f)),sharedf[parseInt(ftag.si,10)]=[ftag,___f,tag.r]}}else(cref=d.match(/<f[^>]*\/>/))&&(ftag=parsexmltag(cref[0]),sharedf[ftag.si]&&(p.f=shift_formula_xlsx(sharedf[ftag.si][1],sharedf[ftag.si][2],tag.r)));var _tag=decode_cell(tag.r);for(i=0;i<arrayf.length;++i)_tag.r>=arrayf[i][0].s.r&&_tag.r<=arrayf[i][0].e.r&&_tag.c>=arrayf[i][0].s.c&&_tag.c<=arrayf[i][0].e.c&&(p.F=arrayf[i][1])}if(tag.t==null&&p.v===void 0)if(p.f||p.F)p.v=0,p.t="n";else if(sheetStubs)p.t="z";else continue;else p.t=tag.t||"n";switch(guess.s.c>tagc&&(guess.s.c=tagc),guess.e.c<tagc&&(guess.e.c=tagc),p.t){case"n":if(p.v==""||p.v==null){if(!sheetStubs)continue;p.t="z"}else p.v=parseFloat(p.v);break;case"s":if(typeof p.v=="undefined"){if(!sheetStubs)continue;p.t="z"}else sstr=strs[parseInt(p.v,10)],p.v=sstr.t,p.r=sstr.r,opts.cellHTML&&(p.h=sstr.h);break;case"str":p.t="s",p.v=p.v!=null?utf8read(p.v):"",opts.cellHTML&&(p.h=escapehtml(p.v));break;case"inlineStr":cref=d.match(isregex),p.t="s",cref!=null&&(sstr=parse_si(cref[1]))?(p.v=sstr.t,opts.cellHTML&&(p.h=sstr.h)):p.v="";break;case"b":p.v=parsexmlbool(p.v);break;case"d":opts.cellDates?p.v=parseDate(p.v,1):(p.v=datenum(parseDate(p.v,1)),p.t="n");break;case"e":(!opts||opts.cellText!==!1)&&(p.w=p.v),p.v=RBErr[p.v];break}if(fmtid=fillid=0,cf=null,do_format&&tag.s!==void 0&&(cf=styles.CellXf[tag.s],cf!=null&&(cf.numFmtId!=null&&(fmtid=cf.numFmtId),opts.cellStyles&&cf.fillId!=null&&(fillid=cf.fillId))),safe_format(p,fmtid,fillid,opts,themes,styles),opts.cellDates&&do_format&&p.t=="n"&&fmt_is_date(table_fmt[fmtid])&&(p.t="d",p.v=numdate(p.v)),tag.cm&&opts.xlmeta){var cm=(opts.xlmeta.Cell||[])[+tag.cm-1];cm&&cm.type=="XLDAPR"&&(p.D=!0)}if(dense){var _r=decode_cell(tag.r);s[_r.r]||(s[_r.r]=[]),s[_r.r][_r.c]=p}else s[tag.r]=p}}}rows.length>0&&(s["!rows"]=rows)}}();function parse_BrtRowHdr(data,length){var z={},tgt=data.l+length;z.r=data.read_shift(4),data.l+=4;var miyRw=data.read_shift(2);data.l+=1;var flags=data.read_shift(1);return data.l=tgt,flags&7&&(z.level=flags&7),flags&16&&(z.hidden=!0),flags&32&&(z.hpt=miyRw/20),z}var parse_BrtWsDim=parse_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(data,length){var z={},f=data[data.l];return++data.l,z.above=!(f&64),z.left=!(f&128),data.l+=18,z.name=parse_XLSBCodeName(data,length-19),z}function parse_BrtCellBlank(data){var cell=parse_XLSBCell(data);return[cell]}function parse_BrtShortBlank(data){var cell=parse_XLSBShortCell(data);return[cell]}function parse_BrtCellBool(data){var cell=parse_XLSBCell(data),fBool=data.read_shift(1);return[cell,fBool,"b"]}function parse_BrtShortBool(data){var cell=parse_XLSBShortCell(data),fBool=data.read_shift(1);return[cell,fBool,"b"]}function parse_BrtCellError(data){var cell=parse_XLSBCell(data),bError=data.read_shift(1);return[cell,bError,"e"]}function parse_BrtShortError(data){var cell=parse_XLSBShortCell(data),bError=data.read_shift(1);return[cell,bError,"e"]}function parse_BrtCellIsst(data){var cell=parse_XLSBCell(data),isst=data.read_shift(4);return[cell,isst,"s"]}function parse_BrtShortIsst(data){var cell=parse_XLSBShortCell(data),isst=data.read_shift(4);return[cell,isst,"s"]}function parse_BrtCellReal(data){var cell=parse_XLSBCell(data),value=parse_Xnum(data);return[cell,value,"n"]}function parse_BrtShortReal(data){var cell=parse_XLSBShortCell(data),value=parse_Xnum(data);return[cell,value,"n"]}function parse_BrtCellRk(data){var cell=parse_XLSBCell(data),value=parse_RkNumber(data);return[cell,value,"n"]}function parse_BrtShortRk(data){var cell=parse_XLSBShortCell(data),value=parse_RkNumber(data);return[cell,value,"n"]}function parse_BrtCellRString(data){var cell=parse_XLSBCell(data),value=parse_RichStr(data);return[cell,value,"is"]}function parse_BrtCellSt(data){var cell=parse_XLSBCell(data),value=parse_XLWideString(data);return[cell,value,"str"]}function parse_BrtShortSt(data){var cell=parse_XLSBShortCell(data),value=parse_XLWideString(data);return[cell,value,"str"]}function parse_BrtFmlaBool(data,length,opts){var end=data.l+length,cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=data.read_shift(1),o=[cell,value,"b"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}function parse_BrtFmlaError(data,length,opts){var end=data.l+length,cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=data.read_shift(1),o=[cell,value,"e"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}function parse_BrtFmlaNum(data,length,opts){var end=data.l+length,cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=parse_Xnum(data),o=[cell,value,"n"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}function parse_BrtFmlaString(data,length,opts){var end=data.l+length,cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=parse_XLWideString(data),o=[cell,value,"str"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}var parse_BrtMergeCell=parse_UncheckedRfX;function parse_BrtHLink(data,length){var end=data.l+length,rfx=parse_UncheckedRfX(data,16),relId=parse_XLNullableWideString(data),loc=parse_XLWideString(data),tooltip=parse_XLWideString(data),display=parse_XLWideString(data);data.l=end;var o={rfx,relId,loc,display};return tooltip&&(o.Tooltip=tooltip),o}function parse_BrtPane(){}function parse_BrtArrFmla(data,length,opts){var end=data.l+length,rfx=parse_RfX(data,16),fAlwaysCalc=data.read_shift(1),o=[rfx];if(o[2]=fAlwaysCalc,opts.cellFormula){var formula=parse_XLSBArrayParsedFormula(data,end-data.l,opts);o[1]=formula}else data.l=end;return o}function parse_BrtShrFmla(data,length,opts){var end=data.l+length,rfx=parse_UncheckedRfX(data,16),o=[rfx];if(opts.cellFormula){var formula=parse_XLSBSharedParsedFormula(data,end-data.l,opts);o[1]=formula,data.l=end}else data.l=end;return o}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(data){var margins={};return BrtMarginKeys.forEach(function(k){margins[k]=parse_Xnum(data,8)}),margins}function parse_BrtBeginWsView(data){var f=data.read_shift(2);return data.l+=28,{RTL:f&32}}function parse_BrtDVal(){}function parse_BrtDVal14(){}function parse_ws_bin(data,_opts,idx,rels,wb,themes,styles){if(!data)return data;var opts=_opts||{};rels||(rels={"!id":{}}),DENSE!=null&&opts.dense==null&&(opts.dense=DENSE);var s=opts.dense?[]:{},ref,refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}},state=[],pass=!1,end=!1,row,p,cf,R,C,addr,sstr,rr,cell,merges=[];opts.biff=12,opts["!row"]=0;var ai=0,af=!1,arrayf=[],sharedf={},supbooks=opts.supbooks||wb.supbooks||[[]];if(supbooks.sharedf=sharedf,supbooks.arrayf=arrayf,supbooks.SheetNames=wb.SheetNames||wb.Sheets.map(function(x){return x.name}),!opts.supbooks&&(opts.supbooks=supbooks,wb.Names))for(var i=0;i<wb.Names.length;++i)supbooks[0][i+1]=wb.Names[i];var colinfo=[],rowinfo=[],seencol=!1;XLSBRecordEnum[16]={n:"BrtShortReal",f:parse_BrtShortReal};var cm,vm;if(recordhopper(data,function(val,RR,RT){if(!end)switch(RT){case 148:ref=val;break;case 0:row=val,opts.sheetRows&&opts.sheetRows<=row.r&&(end=!0),rr=encode_row(R=row.r),opts["!row"]=row.r,(val.hidden||val.hpt||val.level!=null)&&(val.hpt&&(val.hpx=pt2px(val.hpt)),rowinfo[val.r]=val);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(p={t:val[2]},val[2]){case"n":p.v=val[1];break;case"s":sstr=strs[val[1]],p.v=sstr.t,p.r=sstr.r;break;case"b":p.v=!!val[1];break;case"e":p.v=val[1],opts.cellText!==!1&&(p.w=BErr[p.v]);break;case"str":p.t="s",p.v=val[1];break;case"is":p.t="s",p.v=val[1].t;break}if((cf=styles.CellXf[val[0].iStyleRef])&&safe_format(p,cf.numFmtId,null,opts,themes,styles),C=val[0].c==-1?C+1:val[0].c,opts.dense?(s[R]||(s[R]=[]),s[R][C]=p):s[encode_col(C)+rr]=p,opts.cellFormula){for(af=!1,ai=0;ai<arrayf.length;++ai){var aii=arrayf[ai];row.r>=aii[0].s.r&&row.r<=aii[0].e.r&&C>=aii[0].s.c&&C<=aii[0].e.c&&(p.F=encode_range(aii[0]),af=!0)}!af&&val.length>3&&(p.f=val[3])}if(refguess.s.r>row.r&&(refguess.s.r=row.r),refguess.s.c>C&&(refguess.s.c=C),refguess.e.r<row.r&&(refguess.e.r=row.r),refguess.e.c<C&&(refguess.e.c=C),opts.cellDates&&cf&&p.t=="n"&&fmt_is_date(table_fmt[cf.numFmtId])){var _d=SSF_parse_date_code(p.v);_d&&(p.t="d",p.v=new Date(_d.y,_d.m-1,_d.d,_d.H,_d.M,_d.S,_d.u))}cm&&(cm.type=="XLDAPR"&&(p.D=!0),cm=void 0),vm&&(vm=void 0);break;case 1:case 12:if(!opts.sheetStubs||pass)break;p={t:"z",v:void 0},C=val[0].c==-1?C+1:val[0].c,opts.dense?(s[R]||(s[R]=[]),s[R][C]=p):s[encode_col(C)+rr]=p,refguess.s.r>row.r&&(refguess.s.r=row.r),refguess.s.c>C&&(refguess.s.c=C),refguess.e.r<row.r&&(refguess.e.r=row.r),refguess.e.c<C&&(refguess.e.c=C),cm&&(cm.type=="XLDAPR"&&(p.D=!0),cm=void 0),vm&&(vm=void 0);break;case 176:merges.push(val);break;case 49:cm=((opts.xlmeta||{}).Cell||[])[val-1];break;case 494:var rel=rels["!id"][val.relId];for(rel?(val.Target=rel.Target,val.loc&&(val.Target+="#"+val.loc),val.Rel=rel):val.relId==""&&(val.Target="#"+val.loc),R=val.rfx.s.r;R<=val.rfx.e.r;++R)for(C=val.rfx.s.c;C<=val.rfx.e.c;++C)opts.dense?(s[R]||(s[R]=[]),s[R][C]||(s[R][C]={t:"z",v:void 0}),s[R][C].l=val):(addr=encode_cell({c:C,r:R}),s[addr]||(s[addr]={t:"z",v:void 0}),s[addr].l=val);break;case 426:if(!opts.cellFormula)break;arrayf.push(val),cell=opts.dense?s[R][C]:s[encode_col(C)+rr],cell.f=stringify_formula(val[1],refguess,{r:row.r,c:C},supbooks,opts),cell.F=encode_range(val[0]);break;case 427:if(!opts.cellFormula)break;sharedf[encode_cell(val[0].s)]=val[1],cell=opts.dense?s[R][C]:s[encode_col(C)+rr],cell.f=stringify_formula(val[1],refguess,{r:row.r,c:C},supbooks,opts);break;case 60:if(!opts.cellStyles)break;for(;val.e>=val.s;)colinfo[val.e--]={width:val.w/256,hidden:!!(val.flags&1),level:val.level},seencol||(seencol=!0,find_mdw_colw(val.w/256)),process_col(colinfo[val.e+1]);break;case 161:s["!autofilter"]={ref:encode_range(val)};break;case 476:s["!margins"]=val;break;case 147:wb.Sheets[idx]||(wb.Sheets[idx]={}),val.name&&(wb.Sheets[idx].CodeName=val.name),(val.above||val.left)&&(s["!outline"]={above:val.above,left:val.left});break;case 137:wb.Views||(wb.Views=[{}]),wb.Views[0]||(wb.Views[0]={}),val.RTL&&(wb.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:pass=!0;break;case 36:pass=!1;break;case 37:state.push(RT),pass=!0;break;case 38:state.pop(),pass=!1;break;default:if(!RR.T){if(!pass||opts.WTF)throw new Error("Unexpected record 0x"+RT.toString(16))}}},opts),delete opts.supbooks,delete opts["!row"],!s["!ref"]&&(refguess.s.r<2e6||ref&&(ref.e.r>0||ref.e.c>0||ref.s.r>0||ref.s.c>0))&&(s["!ref"]=encode_range(ref||refguess)),opts.sheetRows&&s["!ref"]){var tmpref=safe_decode_range(s["!ref"]);opts.sheetRows<=+tmpref.e.r&&(tmpref.e.r=opts.sheetRows-1,tmpref.e.r>refguess.e.r&&(tmpref.e.r=refguess.e.r),tmpref.e.r<tmpref.s.r&&(tmpref.s.r=tmpref.e.r),tmpref.e.c>refguess.e.c&&(tmpref.e.c=refguess.e.c),tmpref.e.c<tmpref.s.c&&(tmpref.s.c=tmpref.e.c),s["!fullref"]=s["!ref"],s["!ref"]=encode_range(tmpref))}return merges.length>0&&(s["!merges"]=merges),colinfo.length>0&&(s["!cols"]=colinfo),rowinfo.length>0&&(s["!rows"]=rowinfo),s}function parse_Cache(data){var col=[],num=data.match(/^<c:numCache>/),f;(data.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(pt){var q=pt.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);!q||(col[+q[1]]=num?+q[2]:q[2])});var nf=unescapexml((data.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(data.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(F){f=F.replace(/<.*?>/g,"")}),[col,nf,f]}function parse_chart(data,name,opts,rels,wb,csheet){var cs=csheet||{"!type":"chart"};if(!data)return csheet;var C=0,R=0,col="A",refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(data.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(nc){var cache2=parse_Cache(nc);refguess.s.r=refguess.s.c=0,refguess.e.c=C,col=encode_col(C),cache2[0].forEach(function(n,i){cs[col+encode_row(i)]={t:"n",v:n,z:cache2[1]},R=i}),refguess.e.r<R&&(refguess.e.r=R),++C}),C>0&&(cs["!ref"]=encode_range(refguess)),cs}function parse_cs_xml(data,opts,idx,rels,wb){if(!data)return data;rels||(rels={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},m,sheetPr=data.match(sheetprregex);return sheetPr&&parse_ws_xml_sheetpr(sheetPr[0],s,wb,idx),(m=data.match(/drawing r:id="(.*?)"/))&&(s["!rel"]=m[1]),rels["!id"][s["!rel"]]&&(s["!drawel"]=rels["!id"][s["!rel"]]),s}function parse_BrtCsProp(data,length){data.l+=10;var name=parse_XLWideString(data,length-10);return{name}}function parse_cs_bin(data,opts,idx,rels,wb){if(!data)return data;rels||(rels={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},state=[],pass=!1;return recordhopper(data,function(val,R,RT){switch(RT){case 550:s["!rel"]=val;break;case 651:wb.Sheets[idx]||(wb.Sheets[idx]={}),val.name&&(wb.Sheets[idx].CodeName=val.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:pass=!0;break;case 36:pass=!1;break;case 37:state.push(RT);break;case 38:state.pop();break;default:if(R.T>0)state.push(RT);else if(R.T<0)state.pop();else if(!pass||opts.WTF)throw new Error("Unexpected record 0x"+RT.toString(16))}},opts),rels["!id"][s["!rel"]]&&(s["!drawel"]=rels["!id"][s["!rel"]]),s}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],WBViewDef=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],SheetDef=[],CalcPrDef=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function push_defaults_array(target,defaults){for(var j=0;j!=target.length;++j)for(var w=target[j],i=0;i!=defaults.length;++i){var z=defaults[i];if(w[z[0]]==null)w[z[0]]=z[1];else switch(z[2]){case"bool":typeof w[z[0]]=="string"&&(w[z[0]]=parsexmlbool(w[z[0]]));break;case"int":typeof w[z[0]]=="string"&&(w[z[0]]=parseInt(w[z[0]],10));break}}}function push_defaults(target,defaults){for(var i=0;i!=defaults.length;++i){var z=defaults[i];if(target[z[0]]==null)target[z[0]]=z[1];else switch(z[2]){case"bool":typeof target[z[0]]=="string"&&(target[z[0]]=parsexmlbool(target[z[0]]));break;case"int":typeof target[z[0]]=="string"&&(target[z[0]]=parseInt(target[z[0]],10));break}}}function parse_wb_defaults(wb){push_defaults(wb.WBProps,WBPropsDef),push_defaults(wb.CalcPr,CalcPrDef),push_defaults_array(wb.WBView,WBViewDef),push_defaults_array(wb.Sheets,SheetDef),_ssfopts.date1904=parsexmlbool(wb.WBProps.date1904)}var badchars="][*?/\\".split("");function check_ws_name(n,safe){if(n.length>31){if(safe)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var _good=!0;return badchars.forEach(function(c){if(n.indexOf(c)!=-1){if(!safe)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");_good=!1}}),_good}var wbnsregex=/<\w+:workbook/;function parse_wb_xml(data,opts){if(!data)throw new Error("Could not find file");var wb={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},pass=!1,xmlns="xmlns",dname={},dnstart=0;if(data.replace(tagregex,function(x,idx){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<?xml":break;case"<workbook":x.match(wbnsregex)&&(xmlns="xmlns"+x.match(/<(\w+):/)[1]),wb.xmlns=y[xmlns];break;case"</workbook>":break;case"<fileVersion":delete y[0],wb.AppVersion=y;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":WBPropsDef.forEach(function(w){if(y[w[0]]!=null)switch(w[2]){case"bool":wb.WBProps[w[0]]=parsexmlbool(y[w[0]]);break;case"int":wb.WBProps[w[0]]=parseInt(y[w[0]],10);break;default:wb.WBProps[w[0]]=y[w[0]]}}),y.codeName&&(wb.WBProps.CodeName=utf8read(y.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete y[0],wb.WBView.push(y);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(y.state){case"hidden":y.Hidden=1;break;case"veryHidden":y.Hidden=2;break;default:y.Hidden=0}delete y.state,y.name=unescapexml(utf8read(y.name)),delete y[0],wb.Sheets.push(y);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":pass=!0;break;case"</definedNames>":pass=!1;break;case"<definedName":dname={},dname.Name=utf8read(y.name),y.comment&&(dname.Comment=y.comment),y.localSheetId&&(dname.Sheet=+y.localSheetId),parsexmlbool(y.hidden||"0")&&(dname.Hidden=!0),dnstart=idx+x.length;break;case"</definedName>":dname.Ref=unescapexml(utf8read(data.slice(dnstart,idx))),wb.Names.push(dname);break;case"<definedName/>":break;case"<calcPr":delete y[0],wb.CalcPr=y;break;case"<calcPr/>":delete y[0],wb.CalcPr=y;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":pass=!0;break;case"</AlternateContent>":pass=!1;break;case"<revisionPtr":break;default:if(!pass&&opts.WTF)throw new Error("unrecognized "+y[0]+" in workbook")}return x}),XMLNS_main.indexOf(wb.xmlns)===-1)throw new Error("Unknown Namespace: "+wb.xmlns);return parse_wb_defaults(wb),wb}function parse_BrtBundleSh(data,length){var z={};return z.Hidden=data.read_shift(4),z.iTabID=data.read_shift(4),z.strRelID=parse_RelID(data,length-8),z.name=parse_XLWideString(data),z}function parse_BrtWbProp(data,length){var o={},flags=data.read_shift(4);o.defaultThemeVersion=data.read_shift(4);var strName=length>8?parse_XLWideString(data):"";return strName.length>0&&(o.CodeName=strName),o.autoCompressPictures=!!(flags&65536),o.backupFile=!!(flags&64),o.checkCompatibility=!!(flags&4096),o.date1904=!!(flags&1),o.filterPrivacy=!!(flags&8),o.hidePivotFieldList=!!(flags&1024),o.promptedSolutions=!!(flags&16),o.publishItems=!!(flags&2048),o.refreshAllConnections=!!(flags&262144),o.saveExternalLinkValues=!!(flags&128),o.showBorderUnselectedTables=!!(flags&4),o.showInkAnnotation=!!(flags&32),o.showObjects=["all","placeholders","none"][flags>>13&3],o.showPivotChartFilter=!!(flags&32768),o.updateLinks=["userSet","never","always"][flags>>8&3],o}function parse_BrtFRTArchID$(data,length){var o={};return data.read_shift(4),o.ArchID=data.read_shift(4),data.l+=length-8,o}function parse_BrtName(data,length,opts){var end=data.l+length;data.l+=4,data.l+=1;var itab=data.read_shift(4),name=parse_XLNameWideString(data),formula=parse_XLSBNameParsedFormula(data,0,opts),comment=parse_XLNullableWideString(data);data.l=end;var out={Name:name,Ptg:formula};return itab<268435455&&(out.Sheet=itab),comment&&(out.Comment=comment),out}function parse_wb_bin(data,opts){var wb={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},state=[],pass=!1;opts||(opts={}),opts.biff=12;var Names=[],supbooks=[[]];return supbooks.SheetNames=[],supbooks.XTI=[],XLSBRecordEnum[16]={n:"BrtFRTArchID$",f:parse_BrtFRTArchID$},recordhopper(data,function(val,R,RT){switch(RT){case 156:supbooks.SheetNames.push(val.name),wb.Sheets.push(val);break;case 153:wb.WBProps=val;break;case 39:val.Sheet!=null&&(opts.SID=val.Sheet),val.Ref=stringify_formula(val.Ptg,null,null,supbooks,opts),delete opts.SID,delete val.Ptg,Names.push(val);break;case 1036:break;case 357:case 358:case 355:case 667:supbooks[0].length?supbooks.push([RT,val]):supbooks[0]=[RT,val],supbooks[supbooks.length-1].XTI=[];break;case 362:supbooks.length===0&&(supbooks[0]=[],supbooks[0].XTI=[]),supbooks[supbooks.length-1].XTI=supbooks[supbooks.length-1].XTI.concat(val),supbooks.XTI=supbooks.XTI.concat(val);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:state.push(RT),pass=!0;break;case 36:state.pop(),pass=!1;break;case 37:state.push(RT),pass=!0;break;case 38:state.pop(),pass=!1;break;case 16:break;default:if(!R.T){if(!pass||opts.WTF&&state[state.length-1]!=37&&state[state.length-1]!=35)throw new Error("Unexpected record 0x"+RT.toString(16))}}},opts),parse_wb_defaults(wb),wb.Names=Names,wb.supbooks=supbooks,wb}function parse_wb(data,name,opts){return name.slice(-4)===".bin"?parse_wb_bin(data,opts):parse_wb_xml(data,opts)}function parse_ws(data,name,idx,opts,rels,wb,themes,styles){return name.slice(-4)===".bin"?parse_ws_bin(data,opts,idx,rels,wb,themes,styles):parse_ws_xml(data,opts,idx,rels,wb,themes,styles)}function parse_cs(data,name,idx,opts,rels,wb,themes,styles){return name.slice(-4)===".bin"?parse_cs_bin(data,opts,idx,rels,wb,themes,styles):parse_cs_xml(data,opts,idx,rels,wb,themes,styles)}function parse_ms(data,name,idx,opts,rels,wb,themes,styles){return name.slice(-4)===".bin"?parse_ms_bin(data,opts,idx,rels,wb,themes,styles):parse_ms_xml(data,opts,idx,rels,wb,themes,styles)}function parse_ds(data,name,idx,opts,rels,wb,themes,styles){return name.slice(-4)===".bin"?parse_ds_bin(data,opts,idx,rels,wb,themes,styles):parse_ds_xml(data,opts,idx,rels,wb,themes,styles)}function parse_sty(data,name,themes,opts){return name.slice(-4)===".bin"?parse_sty_bin(data,themes,opts):parse_sty_xml(data,themes,opts)}function parse_theme(data,name,opts){return parse_theme_xml(data,opts)}function parse_sst(data,name,opts){return name.slice(-4)===".bin"?parse_sst_bin(data,opts):parse_sst_xml(data,opts)}function parse_cmnt(data,name,opts){return name.slice(-4)===".bin"?parse_comments_bin(data,opts):parse_comments_xml(data,opts)}function parse_cc(data,name,opts){return name.slice(-4)===".bin"?parse_cc_bin(data,name,opts):parse_cc_xml(data,name,opts)}function parse_xlink(data,rel,name,opts){return name.slice(-4)===".bin"?parse_xlink_bin(data,rel,name,opts):parse_xlink_xml(data,rel,name,opts)}function parse_xlmeta(data,name,opts){return name.slice(-4)===".bin"?parse_xlmeta_bin(data,name,opts):parse_xlmeta_xml(data,name,opts)}var attregexg2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,attregex2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function xlml_parsexmltag(tag,skip_root){var words=tag.split(/\s+/),z=[];if(skip_root||(z[0]=words[0]),words.length===1)return z;var m=tag.match(attregexg2),y,j,w,i;if(m)for(i=0;i!=m.length;++i)y=m[i].match(attregex2),(j=y[1].indexOf(":"))===-1?z[y[1]]=y[2].slice(1,y[2].length-1):(y[1].slice(0,6)==="xmlns:"?w="xmlns"+y[1].slice(6):w=y[1].slice(j+1),z[w]=y[2].slice(1,y[2].length-1));return z}function xlml_parsexmltagobj(tag){var words=tag.split(/\s+/),z={};if(words.length===1)return z;var m=tag.match(attregexg2),y,j,w,i;if(m)for(i=0;i!=m.length;++i)y=m[i].match(attregex2),(j=y[1].indexOf(":"))===-1?z[y[1]]=y[2].slice(1,y[2].length-1):(y[1].slice(0,6)==="xmlns:"?w="xmlns"+y[1].slice(6):w=y[1].slice(j+1),z[w]=y[2].slice(1,y[2].length-1));return z}var XLMLFormatMap;function xlml_format(format3,value){var fmt=XLMLFormatMap[format3]||unescapexml(format3);return fmt==="General"?SSF_general(value):SSF_format(fmt,value)}function xlml_set_custprop(Custprops,key,cp,val){var oval=val;switch((cp[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":oval=parsexmlbool(val);break;case"i2":case"int":oval=parseInt(val,10);break;case"r4":case"float":oval=parseFloat(val);break;case"date":case"dateTime.tz":oval=parseDate(val);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+cp[0])}Custprops[unescapexml(key)]=oval}function safe_format_xlml(cell,nf,o){if(cell.t!=="z"){if(!o||o.cellText!==!1)try{cell.t==="e"?cell.w=cell.w||BErr[cell.v]:nf==="General"?cell.t==="n"?(cell.v|0)===cell.v?cell.w=cell.v.toString(10):cell.w=SSF_general_num(cell.v):cell.w=SSF_general(cell.v):cell.w=xlml_format(nf||"General",cell.v)}catch(e){if(o.WTF)throw e}try{var z=XLMLFormatMap[nf]||nf||"General";if(o.cellNF&&(cell.z=z),o.cellDates&&cell.t=="n"&&fmt_is_date(z)){var _d=SSF_parse_date_code(cell.v);_d&&(cell.t="d",cell.v=new Date(_d.y,_d.m-1,_d.d,_d.H,_d.M,_d.S,_d.u))}}catch(e){if(o.WTF)throw e}}}function process_style_xlml(styles,stag,opts){if(opts.cellStyles&&stag.Interior){var I=stag.Interior;I.Pattern&&(I.patternType=XLMLPatternTypeMap[I.Pattern]||I.Pattern)}styles[stag.ID]=stag}function parse_xlml_data(xml,ss,data,cell,base,styles,csty,row,arrayf,o){var nf="General",sid=cell.StyleID,S={};o=o||{};var interiors=[],i=0;for(sid===void 0&&row&&(sid=row.StyleID),sid===void 0&&csty&&(sid=csty.StyleID);styles[sid]!==void 0&&(styles[sid].nf&&(nf=styles[sid].nf),styles[sid].Interior&&interiors.push(styles[sid].Interior),!!styles[sid].Parent);)sid=styles[sid].Parent;switch(data.Type){case"Boolean":cell.t="b",cell.v=parsexmlbool(xml);break;case"String":cell.t="s",cell.r=xlml_fixstr(unescapexml(xml)),cell.v=xml.indexOf("<")>-1?unescapexml(ss||xml).replace(/<.*?>/g,""):cell.r;break;case"DateTime":xml.slice(-1)!="Z"&&(xml+="Z"),cell.v=(parseDate(xml)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),cell.v!==cell.v?cell.v=unescapexml(xml):cell.v<60&&(cell.v=cell.v-1),(!nf||nf=="General")&&(nf="yyyy-mm-dd");case"Number":cell.v===void 0&&(cell.v=+xml),cell.t||(cell.t="n");break;case"Error":cell.t="e",cell.v=RBErr[xml],o.cellText!==!1&&(cell.w=xml);break;default:xml==""&&ss==""?cell.t="z":(cell.t="s",cell.v=xlml_fixstr(ss||xml));break}if(safe_format_xlml(cell,nf,o),o.cellFormula!==!1)if(cell.Formula){var fstr=unescapexml(cell.Formula);fstr.charCodeAt(0)==61&&(fstr=fstr.slice(1)),cell.f=rc_to_a1(fstr,base),delete cell.Formula,cell.ArrayRange=="RC"?cell.F=rc_to_a1("RC:RC",base):cell.ArrayRange&&(cell.F=rc_to_a1(cell.ArrayRange,base),arrayf.push([safe_decode_range(cell.F),cell.F]))}else for(i=0;i<arrayf.length;++i)base.r>=arrayf[i][0].s.r&&base.r<=arrayf[i][0].e.r&&base.c>=arrayf[i][0].s.c&&base.c<=arrayf[i][0].e.c&&(cell.F=arrayf[i][1]);o.cellStyles&&(interiors.forEach(function(x){!S.patternType&&x.patternType&&(S.patternType=x.patternType)}),cell.s=S),cell.StyleID!==void 0&&(cell.ixfe=cell.StyleID)}function xlml_clean_comment(comment){comment.t=comment.v||"",comment.t=comment.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),comment.v=comment.w=comment.ixfe=void 0}function parse_xlml_xml(d,_opts){var opts=_opts||{};make_ssf();var str=debom(xlml_normalize(d));(opts.type=="binary"||opts.type=="array"||opts.type=="base64")&&(typeof $cptable!="undefined"?str=$cptable.utils.decode(65001,char_codes(str)):str=utf8read(str));var opening=str.slice(0,1024).toLowerCase(),ishtml=!1;if(opening=opening.replace(/".*?"/g,""),(opening.indexOf(">")&1023)>Math.min(opening.indexOf(",")&1023,opening.indexOf(";")&1023)){var _o=dup(opts);return _o.type="string",PRN.to_workbook(str,_o)}if(opening.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(tag){opening.indexOf("<"+tag)>=0&&(ishtml=!0)}),ishtml)return html_to_workbook(str,opts);XLMLFormatMap={"General Number":"General","General Date":table_fmt[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":table_fmt[15],"Short Date":table_fmt[14],"Long Time":table_fmt[19],"Medium Time":table_fmt[18],"Short Time":table_fmt[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:table_fmt[2],Standard:table_fmt[4],Percent:table_fmt[10],Scientific:table_fmt[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var Rn,state=[],tmp;DENSE!=null&&opts.dense==null&&(opts.dense=DENSE);var sheets={},sheetnames=[],cursheet=opts.dense?[]:{},sheetname="",cell={},row={},dtag=xlml_parsexmltag('<Data ss:Type="String">'),didx=0,c=0,r=0,refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}},styles={},stag={},ss="",fidx=0,merges=[],Props={},Custprops={},pidx=0,cp=[],comments=[],comment={},cstys=[],csty,seencol=!1,arrayf=[],rowinfo=[],rowobj={},cc=0,rr=0,Workbook={Sheets:[],WBProps:{date1904:!1}},wsprops={};xlmlregex.lastIndex=0,str=str.replace(/<!--([\s\S]*?)-->/mg,"");for(var raw_Rn3="";Rn=xlmlregex.exec(str);)switch(Rn[3]=(raw_Rn3=Rn[3]).toLowerCase()){case"data":if(raw_Rn3=="data"){if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else Rn[0].charAt(Rn[0].length-2)!=="/"&&state.push([Rn[3],!0]);break}if(state[state.length-1][1])break;Rn[1]==="/"?parse_xlml_data(str.slice(didx,Rn.index),ss,dtag,state[state.length-1][0]=="comment"?comment:cell,{c,r},styles,cstys[c],row,arrayf,opts):(ss="",dtag=xlml_parsexmltag(Rn[0]),didx=Rn.index+Rn[0].length);break;case"cell":if(Rn[1]==="/")if(comments.length>0&&(cell.c=comments),(!opts.sheetRows||opts.sheetRows>r)&&cell.v!==void 0&&(opts.dense?(cursheet[r]||(cursheet[r]=[]),cursheet[r][c]=cell):cursheet[encode_col(c)+encode_row(r)]=cell),cell.HRef&&(cell.l={Target:unescapexml(cell.HRef)},cell.HRefScreenTip&&(cell.l.Tooltip=cell.HRefScreenTip),delete cell.HRef,delete cell.HRefScreenTip),(cell.MergeAcross||cell.MergeDown)&&(cc=c+(parseInt(cell.MergeAcross,10)|0),rr=r+(parseInt(cell.MergeDown,10)|0),merges.push({s:{c,r},e:{c:cc,r:rr}})),!opts.sheetStubs)cell.MergeAcross?c=cc+1:++c;else if(cell.MergeAcross||cell.MergeDown){for(var cma=c;cma<=cc;++cma)for(var cmd=r;cmd<=rr;++cmd)(cma>c||cmd>r)&&(opts.dense?(cursheet[cmd]||(cursheet[cmd]=[]),cursheet[cmd][cma]={t:"z"}):cursheet[encode_col(cma)+encode_row(cmd)]={t:"z"});c=cc+1}else++c;else cell=xlml_parsexmltagobj(Rn[0]),cell.Index&&(c=+cell.Index-1),c<refguess.s.c&&(refguess.s.c=c),c>refguess.e.c&&(refguess.e.c=c),Rn[0].slice(-2)==="/>"&&++c,comments=[];break;case"row":Rn[1]==="/"||Rn[0].slice(-2)==="/>"?(r<refguess.s.r&&(refguess.s.r=r),r>refguess.e.r&&(refguess.e.r=r),Rn[0].slice(-2)==="/>"&&(row=xlml_parsexmltag(Rn[0]),row.Index&&(r=+row.Index-1)),c=0,++r):(row=xlml_parsexmltag(Rn[0]),row.Index&&(r=+row.Index-1),rowobj={},(row.AutoFitHeight=="0"||row.Height)&&(rowobj.hpx=parseInt(row.Height,10),rowobj.hpt=px2pt(rowobj.hpx),rowinfo[r]=rowobj),row.Hidden=="1"&&(rowobj.hidden=!0,rowinfo[r]=rowobj));break;case"worksheet":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"));sheetnames.push(sheetname),refguess.s.r<=refguess.e.r&&refguess.s.c<=refguess.e.c&&(cursheet["!ref"]=encode_range(refguess),opts.sheetRows&&opts.sheetRows<=refguess.e.r&&(cursheet["!fullref"]=cursheet["!ref"],refguess.e.r=opts.sheetRows-1,cursheet["!ref"]=encode_range(refguess))),merges.length&&(cursheet["!merges"]=merges),cstys.length>0&&(cursheet["!cols"]=cstys),rowinfo.length>0&&(cursheet["!rows"]=rowinfo),sheets[sheetname]=cursheet}else refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}},r=c=0,state.push([Rn[3],!1]),tmp=xlml_parsexmltag(Rn[0]),sheetname=unescapexml(tmp.Name),cursheet=opts.dense?[]:{},merges=[],arrayf=[],rowinfo=[],wsprops={name:sheetname,Hidden:0},Workbook.Sheets.push(wsprops);break;case"table":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else{if(Rn[0].slice(-2)=="/>")break;state.push([Rn[3],!1]),cstys=[],seencol=!1}break;case"style":Rn[1]==="/"?process_style_xlml(styles,stag,opts):stag=xlml_parsexmltag(Rn[0]);break;case"numberformat":stag.nf=unescapexml(xlml_parsexmltag(Rn[0]).Format||"General"),XLMLFormatMap[stag.nf]&&(stag.nf=XLMLFormatMap[stag.nf]);for(var ssfidx=0;ssfidx!=392&&table_fmt[ssfidx]!=stag.nf;++ssfidx);if(ssfidx==392){for(ssfidx=57;ssfidx!=392;++ssfidx)if(table_fmt[ssfidx]==null){SSF_load(stag.nf,ssfidx);break}}break;case"column":if(state[state.length-1][0]!=="table")break;if(csty=xlml_parsexmltag(Rn[0]),csty.Hidden&&(csty.hidden=!0,delete csty.Hidden),csty.Width&&(csty.wpx=parseInt(csty.Width,10)),!seencol&&csty.wpx>10){seencol=!0,MDW=DEF_MDW;for(var _col=0;_col<cstys.length;++_col)cstys[_col]&&process_col(cstys[_col])}seencol&&process_col(csty),cstys[csty.Index-1||cstys.length]=csty;for(var i=0;i<+csty.Span;++i)cstys[cstys.length]=dup(csty);break;case"namedrange":if(Rn[1]==="/")break;Workbook.Names||(Workbook.Names=[]);var _NamedRange=parsexmltag(Rn[0]),_DefinedName={Name:_NamedRange.Name,Ref:rc_to_a1(_NamedRange.RefersTo.slice(1),{r:0,c:0})};Workbook.Sheets.length>0&&(_DefinedName.Sheet=Workbook.Sheets.length-1),Workbook.Names.push(_DefinedName);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(Rn[0].slice(-2)==="/>")break;Rn[1]==="/"?ss+=str.slice(fidx,Rn.index):fidx=Rn.index+Rn[0].length;break;case"interior":if(!opts.cellStyles)break;stag.Interior=xlml_parsexmltag(Rn[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(Rn[0].slice(-2)==="/>")break;Rn[1]==="/"?xlml_set_prop(Props,raw_Rn3,str.slice(pidx,Rn.index)):pidx=Rn.index+Rn[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else state.push([Rn[3],!1]);break;case"comment":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"));xlml_clean_comment(comment),comments.push(comment)}else state.push([Rn[3],!1]),tmp=xlml_parsexmltag(Rn[0]),comment={a:tmp.Author};break;case"autofilter":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else if(Rn[0].charAt(Rn[0].length-2)!=="/"){var AutoFilter2=xlml_parsexmltag(Rn[0]);cursheet["!autofilter"]={ref:rc_to_a1(AutoFilter2.Range).replace(/\$/g,"")},state.push([Rn[3],!0])}break;case"name":break;case"datavalidation":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else Rn[0].charAt(Rn[0].length-2)!=="/"&&state.push([Rn[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else Rn[0].charAt(Rn[0].length-2)!=="/"&&state.push([Rn[3],!0]);break;case"null":break;default:if(state.length==0&&Rn[3]=="document"||state.length==0&&Rn[3]=="uof")return parse_fods(str,opts);var seen=!0;switch(state[state.length-1][0]){case"officedocumentsettings":switch(Rn[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:seen=!1}break;case"componentoptions":switch(Rn[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:seen=!1}break;case"excelworkbook":switch(Rn[3]){case"date1904":Workbook.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:seen=!1}break;case"workbookoptions":switch(Rn[3]){case"owcversion":break;case"height":break;case"width":break;default:seen=!1}break;case"worksheetoptions":switch(Rn[3]){case"visible":if(Rn[0].slice(-2)!=="/>")if(Rn[1]==="/")switch(str.slice(pidx,Rn.index)){case"SheetHidden":wsprops.Hidden=1;break;case"SheetVeryHidden":wsprops.Hidden=2;break}else pidx=Rn.index+Rn[0].length;break;case"header":cursheet["!margins"]||default_margins(cursheet["!margins"]={},"xlml"),isNaN(+parsexmltag(Rn[0]).Margin)||(cursheet["!margins"].header=+parsexmltag(Rn[0]).Margin);break;case"footer":cursheet["!margins"]||default_margins(cursheet["!margins"]={},"xlml"),isNaN(+parsexmltag(Rn[0]).Margin)||(cursheet["!margins"].footer=+parsexmltag(Rn[0]).Margin);break;case"pagemargins":var pagemargins=parsexmltag(Rn[0]);cursheet["!margins"]||default_margins(cursheet["!margins"]={},"xlml"),isNaN(+pagemargins.Top)||(cursheet["!margins"].top=+pagemargins.Top),isNaN(+pagemargins.Left)||(cursheet["!margins"].left=+pagemargins.Left),isNaN(+pagemargins.Right)||(cursheet["!margins"].right=+pagemargins.Right),isNaN(+pagemargins.Bottom)||(cursheet["!margins"].bottom=+pagemargins.Bottom);break;case"displayrighttoleft":Workbook.Views||(Workbook.Views=[]),Workbook.Views[0]||(Workbook.Views[0]={}),Workbook.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":cursheet["!outline"]||(cursheet["!outline"]={}),cursheet["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":cursheet["!outline"]||(cursheet["!outline"]={}),cursheet["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:seen=!1}break;case"pivottable":case"pivotcache":switch(Rn[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:seen=!1}break;case"pagebreaks":switch(Rn[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:seen=!1}break;case"autofilter":switch(Rn[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:seen=!1}break;case"querytable":switch(Rn[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:seen=!1}break;case"datavalidation":switch(Rn[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:seen=!1}break;case"sorting":case"conditionalformatting":switch(Rn[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:seen=!1}break;case"mapinfo":case"schema":case"data":switch(Rn[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:seen=!1}break;case"smarttags":break;default:seen=!1;break}if(seen||Rn[3].match(/!\[CDATA/))break;if(!state[state.length-1][1])throw"Unrecognized tag: "+Rn[3]+"|"+state.join("|");if(state[state.length-1][0]==="customdocumentproperties"){if(Rn[0].slice(-2)==="/>")break;Rn[1]==="/"?xlml_set_custprop(Custprops,raw_Rn3,cp,str.slice(pidx,Rn.index)):(cp=Rn,pidx=Rn.index+Rn[0].length);break}if(opts.WTF)throw"Unrecognized tag: "+Rn[3]+"|"+state.join("|")}var out={};return!opts.bookSheets&&!opts.bookProps&&(out.Sheets=sheets),out.SheetNames=sheetnames,out.Workbook=Workbook,out.SSF=dup(table_fmt),out.Props=Props,out.Custprops=Custprops,out}function parse_xlml(data,opts){switch(fix_read_opts(opts=opts||{}),opts.type||"base64"){case"base64":return parse_xlml_xml(Base64_decode(data),opts);case"binary":case"buffer":case"file":return parse_xlml_xml(data,opts);case"array":return parse_xlml_xml(a2s(data),opts)}}function parse_compobj(obj){var v={},o=obj.content;if(o.l=28,v.AnsiUserType=o.read_shift(0,"lpstr-ansi"),v.AnsiClipboardFormat=parse_ClipboardFormatOrAnsiString(o),o.length-o.l<=4)return v;var m=o.read_shift(4);if(m==0||m>40||(o.l-=4,v.Reserved1=o.read_shift(0,"lpstr-ansi"),o.length-o.l<=4)||(m=o.read_shift(4),m!==1907505652)||(v.UnicodeClipboardFormat=parse_ClipboardFormatOrUnicodeString(o),m=o.read_shift(4),m==0||m>40))return v;o.l-=4,v.Reserved2=o.read_shift(0,"lpwstr")}var CONTINUE_RT=[60,1084,2066,2165,2175];function slurp(RecordType,R,blob,length,opts){var l=length,bufs=[],d=blob.slice(blob.l,blob.l+l);if(opts&&opts.enc&&opts.enc.insitu&&d.length>0)switch(RecordType){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:opts.enc.insitu(d)}bufs.push(d),blob.l+=l;for(var nextrt=__readUInt16LE(blob,blob.l),next=XLSRecordEnum[nextrt],start2=0;next!=null&&CONTINUE_RT.indexOf(nextrt)>-1;)l=__readUInt16LE(blob,blob.l+2),start2=blob.l+4,nextrt==2066?start2+=4:(nextrt==2165||nextrt==2175)&&(start2+=12),d=blob.slice(start2,blob.l+4+l),bufs.push(d),blob.l+=4+l,next=XLSRecordEnum[nextrt=__readUInt16LE(blob,blob.l)];var b=bconcat(bufs);prep_blob(b,0);var ll=0;b.lens=[];for(var j=0;j<bufs.length;++j)b.lens.push(ll),ll+=bufs[j].length;if(b.length<length)throw"XLS Record 0x"+RecordType.toString(16)+" Truncated: "+b.length+" < "+length;return R.f(b,b.length,opts)}function safe_format_xf(p,opts,date1904){if(p.t!=="z"&&!!p.XF){var fmtid=0;try{fmtid=p.z||p.XF.numFmtId||0,opts.cellNF&&(p.z=table_fmt[fmtid])}catch(e){if(opts.WTF)throw e}if(!opts||opts.cellText!==!1)try{p.t==="e"?p.w=p.w||BErr[p.v]:fmtid===0||fmtid=="General"?p.t==="n"?(p.v|0)===p.v?p.w=p.v.toString(10):p.w=SSF_general_num(p.v):p.w=SSF_general(p.v):p.w=SSF_format(fmtid,p.v,{date1904:!!date1904,dateNF:opts&&opts.dateNF})}catch(e){if(opts.WTF)throw e}if(opts.cellDates&&fmtid&&p.t=="n"&&fmt_is_date(table_fmt[fmtid]||String(fmtid))){var _d=SSF_parse_date_code(p.v);_d&&(p.t="d",p.v=new Date(_d.y,_d.m-1,_d.d,_d.H,_d.M,_d.S,_d.u))}}}function make_cell(val,ixfe,t){return{v:val,ixfe,t}}function parse_workbook(blob,options){var wb={opts:{}},Sheets={};DENSE!=null&&options.dense==null&&(options.dense=DENSE);var out=options.dense?[]:{},Directory={},range3={},last_formula=null,sst=[],cur_sheet="",Preamble={},lastcell,last_cell="",cc,cmnt,rngC,rngR,sharedf={},arrayf=[],temp_val,country,XFs=[],palette=[],Workbook={Sheets:[],WBProps:{date1904:!1},Views:[{}]},wsprops={},get_rgb=function(icv){return icv<8?XLSIcv[icv]:icv<64&&palette[icv-8]||XLSIcv[icv]},process_cell_style=function(cell,line,options2){var xfd=line.XF.data;if(!(!xfd||!xfd.patternType||!options2||!options2.cellStyles)){line.s={},line.s.patternType=xfd.patternType;var t;(t=rgb2Hex(get_rgb(xfd.icvFore)))&&(line.s.fgColor={rgb:t}),(t=rgb2Hex(get_rgb(xfd.icvBack)))&&(line.s.bgColor={rgb:t})}},addcell=function(cell,line,options2){if(!(file_depth>1)&&!(options2.sheetRows&&cell.r>=options2.sheetRows)){if(options2.cellStyles&&line.XF&&line.XF.data&&process_cell_style(cell,line,options2),delete line.ixfe,delete line.XF,lastcell=cell,last_cell=encode_cell(cell),(!range3||!range3.s||!range3.e)&&(range3={s:{r:0,c:0},e:{r:0,c:0}}),cell.r<range3.s.r&&(range3.s.r=cell.r),cell.c<range3.s.c&&(range3.s.c=cell.c),cell.r+1>range3.e.r&&(range3.e.r=cell.r+1),cell.c+1>range3.e.c&&(range3.e.c=cell.c+1),options2.cellFormula&&line.f){for(var afi=0;afi<arrayf.length;++afi)if(!(arrayf[afi][0].s.c>cell.c||arrayf[afi][0].s.r>cell.r)&&!(arrayf[afi][0].e.c<cell.c||arrayf[afi][0].e.r<cell.r)){line.F=encode_range(arrayf[afi][0]),(arrayf[afi][0].s.c!=cell.c||arrayf[afi][0].s.r!=cell.r)&&delete line.f,line.f&&(line.f=""+stringify_formula(arrayf[afi][1],range3,cell,supbooks,opts));break}}options2.dense?(out[cell.r]||(out[cell.r]=[]),out[cell.r][cell.c]=line):out[last_cell]=line}},opts={enc:!1,sbcch:0,snames:[],sharedf,arrayf,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!options&&!!options.cellStyles,WTF:!!options&&!!options.wtf};options.password&&(opts.password=options.password);var themes,merges=[],objects=[],colinfo=[],rowinfo=[],seencol=!1,supbooks=[];supbooks.SheetNames=opts.snames,supbooks.sharedf=opts.sharedf,supbooks.arrayf=opts.arrayf,supbooks.names=[],supbooks.XTI=[];var last_RT=0,file_depth=0,BIFF2Fmt=0,BIFF2FmtTable=[],FilterDatabases=[],last_lbl;opts.codepage=1200,set_cp(1200);for(var seen_codepage=!1;blob.l<blob.length-1;){var s=blob.l,RecordType=blob.read_shift(2);if(RecordType===0&&last_RT===10)break;var length=blob.l===blob.length?0:blob.read_shift(2),R=XLSRecordEnum[RecordType];if(R&&R.f){if(options.bookSheets&&last_RT===133&&RecordType!==133)break;if(last_RT=RecordType,R.r===2||R.r==12){var rt=blob.read_shift(2);if(length-=2,!opts.enc&&rt!==RecordType&&((rt&255)<<8|rt>>8)!==RecordType)throw new Error("rt mismatch: "+rt+"!="+RecordType);R.r==12&&(blob.l+=10,length-=10)}var val={};if(RecordType===10?val=R.f(blob,length,opts):val=slurp(RecordType,R,blob,length,opts),file_depth==0&&[9,521,1033,2057].indexOf(last_RT)===-1)continue;switch(RecordType){case 34:wb.opts.Date1904=Workbook.WBProps.date1904=val;break;case 134:wb.opts.WriteProtect=!0;break;case 47:if(opts.enc||(blob.l=0),opts.enc=val,!options.password)throw new Error("File is password-protected");if(val.valid==null)throw new Error("Encryption scheme unsupported");if(!val.valid)throw new Error("Password is incorrect");break;case 92:opts.lastuser=val;break;case 66:var cpval=Number(val);switch(cpval){case 21010:cpval=1200;break;case 32768:cpval=1e4;break;case 32769:cpval=1252;break}set_cp(opts.codepage=cpval),seen_codepage=!0;break;case 317:opts.rrtabid=val;break;case 25:opts.winlocked=val;break;case 439:wb.opts.RefreshAll=val;break;case 12:wb.opts.CalcCount=val;break;case 16:wb.opts.CalcDelta=val;break;case 17:wb.opts.CalcIter=val;break;case 13:wb.opts.CalcMode=val;break;case 14:wb.opts.CalcPrecision=val;break;case 95:wb.opts.CalcSaveRecalc=val;break;case 15:opts.CalcRefMode=val;break;case 2211:wb.opts.FullCalc=val;break;case 129:val.fDialog&&(out["!type"]="dialog"),val.fBelow||((out["!outline"]||(out["!outline"]={})).above=!0),val.fRight||((out["!outline"]||(out["!outline"]={})).left=!0);break;case 224:XFs.push(val);break;case 430:supbooks.push([val]),supbooks[supbooks.length-1].XTI=[];break;case 35:case 547:supbooks[supbooks.length-1].push(val);break;case 24:case 536:last_lbl={Name:val.Name,Ref:stringify_formula(val.rgce,range3,null,supbooks,opts)},val.itab>0&&(last_lbl.Sheet=val.itab-1),supbooks.names.push(last_lbl),supbooks[0]||(supbooks[0]=[],supbooks[0].XTI=[]),supbooks[supbooks.length-1].push(val),val.Name=="_xlnm._FilterDatabase"&&val.itab>0&&val.rgce&&val.rgce[0]&&val.rgce[0][0]&&val.rgce[0][0][0]=="PtgArea3d"&&(FilterDatabases[val.itab-1]={ref:encode_range(val.rgce[0][0][1][2])});break;case 22:opts.ExternCount=val;break;case 23:supbooks.length==0&&(supbooks[0]=[],supbooks[0].XTI=[]),supbooks[supbooks.length-1].XTI=supbooks[supbooks.length-1].XTI.concat(val),supbooks.XTI=supbooks.XTI.concat(val);break;case 2196:if(opts.biff<8)break;last_lbl!=null&&(last_lbl.Comment=val[1]);break;case 18:out["!protect"]=val;break;case 19:val!==0&&opts.WTF&&console.error("Password verifier: "+val);break;case 133:Directory[val.pos]=val,opts.snames.push(val.name);break;case 10:{if(--file_depth)break;if(range3.e){if(range3.e.r>0&&range3.e.c>0){if(range3.e.r--,range3.e.c--,out["!ref"]=encode_range(range3),options.sheetRows&&options.sheetRows<=range3.e.r){var tmpri=range3.e.r;range3.e.r=options.sheetRows-1,out["!fullref"]=out["!ref"],out["!ref"]=encode_range(range3),range3.e.r=tmpri}range3.e.r++,range3.e.c++}merges.length>0&&(out["!merges"]=merges),objects.length>0&&(out["!objects"]=objects),colinfo.length>0&&(out["!cols"]=colinfo),rowinfo.length>0&&(out["!rows"]=rowinfo),Workbook.Sheets.push(wsprops)}cur_sheet===""?Preamble=out:Sheets[cur_sheet]=out,out=options.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(opts.biff===8&&(opts.biff={9:2,521:3,1033:4}[RecordType]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[val.BIFFVer]||8),opts.biffguess=val.BIFFVer==0,val.BIFFVer==0&&val.dt==4096&&(opts.biff=5,seen_codepage=!0,set_cp(opts.codepage=28591)),opts.biff==8&&val.BIFFVer==0&&val.dt==16&&(opts.biff=2),file_depth++)break;if(out=options.dense?[]:{},opts.biff<8&&!seen_codepage&&(seen_codepage=!0,set_cp(opts.codepage=options.codepage||1252)),opts.biff<5||val.BIFFVer==0&&val.dt==4096){cur_sheet===""&&(cur_sheet="Sheet1"),range3={s:{r:0,c:0},e:{r:0,c:0}};var fakebs8={pos:blob.l-length,name:cur_sheet};Directory[fakebs8.pos]=fakebs8,opts.snames.push(cur_sheet)}else cur_sheet=(Directory[s]||{name:""}).name;val.dt==32&&(out["!type"]="chart"),val.dt==64&&(out["!type"]="macro"),merges=[],objects=[],opts.arrayf=arrayf=[],colinfo=[],rowinfo=[],seencol=!1,wsprops={Hidden:(Directory[s]||{hs:0}).hs,name:cur_sheet}}break;case 515:case 3:case 2:out["!type"]=="chart"&&(options.dense?(out[val.r]||[])[val.c]:out[encode_cell({c:val.c,r:val.r})])&&++val.c,temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe]||{},v:val.val,t:"n"},BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case 5:case 517:temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.val,t:val.t},BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case 638:temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.rknum,t:"n"},BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case 189:for(var j=val.c;j<=val.C;++j){var ixfe=val.rkrec[j-val.c][0];temp_val={ixfe,XF:XFs[ixfe],v:val.rkrec[j-val.c][1],t:"n"},BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:j,r:val.r},temp_val,options)}break;case 6:case 518:case 1030:{if(val.val=="String"){last_formula=val;break}if(temp_val=make_cell(val.val,val.cell.ixfe,val.tt),temp_val.XF=XFs[temp_val.ixfe],options.cellFormula){var _f=val.formula;if(_f&&_f[0]&&_f[0][0]&&_f[0][0][0]=="PtgExp"){var _fr=_f[0][0][1][0],_fc=_f[0][0][1][1],_fe=encode_cell({r:_fr,c:_fc});sharedf[_fe]?temp_val.f=""+stringify_formula(val.formula,range3,val.cell,supbooks,opts):temp_val.F=((options.dense?(out[_fr]||[])[_fc]:out[_fe])||{}).F}else temp_val.f=""+stringify_formula(val.formula,range3,val.cell,supbooks,opts)}BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell(val.cell,temp_val,options),last_formula=val}break;case 7:case 519:if(last_formula)last_formula.val=val,temp_val=make_cell(val,last_formula.cell.ixfe,"s"),temp_val.XF=XFs[temp_val.ixfe],options.cellFormula&&(temp_val.f=""+stringify_formula(last_formula.formula,range3,last_formula.cell,supbooks,opts)),BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell(last_formula.cell,temp_val,options),last_formula=null;else throw new Error("String record expects Formula");break;case 33:case 545:{arrayf.push(val);var _arraystart=encode_cell(val[0].s);if(cc=options.dense?(out[val[0].s.r]||[])[val[0].s.c]:out[_arraystart],options.cellFormula&&cc){if(!last_formula||!_arraystart||!cc)break;cc.f=""+stringify_formula(val[1],range3,val[0],supbooks,opts),cc.F=encode_range(val[0])}}break;case 1212:{if(!options.cellFormula)break;if(last_cell){if(!last_formula)break;sharedf[encode_cell(last_formula.cell)]=val[0],cc=options.dense?(out[last_formula.cell.r]||[])[last_formula.cell.c]:out[encode_cell(last_formula.cell)],(cc||{}).f=""+stringify_formula(val[0],range3,lastcell,supbooks,opts)}}break;case 253:temp_val=make_cell(sst[val.isst].t,val.ixfe,"s"),sst[val.isst].h&&(temp_val.h=sst[val.isst].h),temp_val.XF=XFs[temp_val.ixfe],BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case 513:options.sheetStubs&&(temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],t:"z"},BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options));break;case 190:if(options.sheetStubs)for(var _j=val.c;_j<=val.C;++_j){var _ixfe=val.ixfe[_j-val.c];temp_val={ixfe:_ixfe,XF:XFs[_ixfe],t:"z"},BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:_j,r:val.r},temp_val,options)}break;case 214:case 516:case 4:temp_val=make_cell(val.val,val.ixfe,"s"),temp_val.XF=XFs[temp_val.ixfe],BIFF2Fmt>0&&(temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&63]),safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case 0:case 512:file_depth===1&&(range3=val);break;case 252:sst=val;break;case 1054:if(opts.biff==4){BIFF2FmtTable[BIFF2Fmt++]=val[1];for(var b4idx=0;b4idx<BIFF2Fmt+163&&table_fmt[b4idx]!=val[1];++b4idx);b4idx>=163&&SSF_load(val[1],BIFF2Fmt+163)}else SSF_load(val[1],val[0]);break;case 30:{BIFF2FmtTable[BIFF2Fmt++]=val;for(var b2idx=0;b2idx<BIFF2Fmt+163&&table_fmt[b2idx]!=val;++b2idx);b2idx>=163&&SSF_load(val,BIFF2Fmt+163)}break;case 229:merges=merges.concat(val);break;case 93:objects[val.cmo[0]]=opts.lastobj=val;break;case 438:opts.lastobj.TxO=val;break;case 127:opts.lastobj.ImData=val;break;case 440:for(rngR=val[0].s.r;rngR<=val[0].e.r;++rngR)for(rngC=val[0].s.c;rngC<=val[0].e.c;++rngC)cc=options.dense?(out[rngR]||[])[rngC]:out[encode_cell({c:rngC,r:rngR})],cc&&(cc.l=val[1]);break;case 2048:for(rngR=val[0].s.r;rngR<=val[0].e.r;++rngR)for(rngC=val[0].s.c;rngC<=val[0].e.c;++rngC)cc=options.dense?(out[rngR]||[])[rngC]:out[encode_cell({c:rngC,r:rngR})],cc&&cc.l&&(cc.l.Tooltip=val[1]);break;case 28:{if(opts.biff<=5&&opts.biff>=2)break;cc=options.dense?(out[val[0].r]||[])[val[0].c]:out[encode_cell(val[0])];var noteobj=objects[val[2]];cc||(options.dense?(out[val[0].r]||(out[val[0].r]=[]),cc=out[val[0].r][val[0].c]={t:"z"}):cc=out[encode_cell(val[0])]={t:"z"},range3.e.r=Math.max(range3.e.r,val[0].r),range3.s.r=Math.min(range3.s.r,val[0].r),range3.e.c=Math.max(range3.e.c,val[0].c),range3.s.c=Math.min(range3.s.c,val[0].c)),cc.c||(cc.c=[]),cmnt={a:val[1],t:noteobj.TxO.t},cc.c.push(cmnt)}break;case 2173:update_xfext(XFs[val.ixfe],val.ext);break;case 125:{if(!opts.cellStyles)break;for(;val.e>=val.s;)colinfo[val.e--]={width:val.w/256,level:val.level||0,hidden:!!(val.flags&1)},seencol||(seencol=!0,find_mdw_colw(val.w/256)),process_col(colinfo[val.e+1])}break;case 520:{var rowobj={};val.level!=null&&(rowinfo[val.r]=rowobj,rowobj.level=val.level),val.hidden&&(rowinfo[val.r]=rowobj,rowobj.hidden=!0),val.hpt&&(rowinfo[val.r]=rowobj,rowobj.hpt=val.hpt,rowobj.hpx=pt2px(val.hpt))}break;case 38:case 39:case 40:case 41:out["!margins"]||default_margins(out["!margins"]={}),out["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[RecordType]]=val;break;case 161:out["!margins"]||default_margins(out["!margins"]={}),out["!margins"].header=val.header,out["!margins"].footer=val.footer;break;case 574:val.RTL&&(Workbook.Views[0].RTL=!0);break;case 146:palette=val;break;case 2198:themes=val;break;case 140:country=val;break;case 442:cur_sheet?wsprops.CodeName=val||wsprops.name:Workbook.WBProps.CodeName=val||"ThisWorkbook";break}}else R||console.error("Missing Info for XLS Record 0x"+RecordType.toString(16)),blob.l+=length}return wb.SheetNames=keys(Directory).sort(function(a,b){return Number(a)-Number(b)}).map(function(x){return Directory[x].name}),options.bookSheets||(wb.Sheets=Sheets),!wb.SheetNames.length&&Preamble["!ref"]?(wb.SheetNames.push("Sheet1"),wb.Sheets&&(wb.Sheets.Sheet1=Preamble)):wb.Preamble=Preamble,wb.Sheets&&FilterDatabases.forEach(function(r,i){wb.Sheets[wb.SheetNames[i]]["!autofilter"]=r}),wb.Strings=sst,wb.SSF=dup(table_fmt),opts.enc&&(wb.Encryption=opts.enc),themes&&(wb.Themes=themes),wb.Metadata={},country!==void 0&&(wb.Metadata.Country=country),supbooks.names.length>0&&(Workbook.Names=supbooks.names),wb.Workbook=Workbook,wb}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function parse_xls_props(cfb,props,o){var DSI=CFB.find(cfb,"/!DocumentSummaryInformation");if(DSI&&DSI.size>0)try{var DocSummary=parse_PropertySetStream(DSI,DocSummaryPIDDSI,PSCLSID.DSI);for(var d in DocSummary)props[d]=DocSummary[d]}catch(e){if(o.WTF)throw e}var SI=CFB.find(cfb,"/!SummaryInformation");if(SI&&SI.size>0)try{var Summary=parse_PropertySetStream(SI,SummaryPIDSI,PSCLSID.SI);for(var s in Summary)props[s]==null&&(props[s]=Summary[s])}catch(e){if(o.WTF)throw e}props.HeadingPairs&&props.TitlesOfParts&&(load_props_pairs(props.HeadingPairs,props.TitlesOfParts,props,o),delete props.HeadingPairs,delete props.TitlesOfParts)}function parse_xlscfb(cfb,options){options||(options={}),fix_read_opts(options),reset_cp(),options.codepage&&set_ansi(options.codepage);var CompObj,WB;if(cfb.FullPaths){if(CFB.find(cfb,"/encryption"))throw new Error("File is password-protected");CompObj=CFB.find(cfb,"!CompObj"),WB=CFB.find(cfb,"/Workbook")||CFB.find(cfb,"/Book")}else{switch(options.type){case"base64":cfb=s2a(Base64_decode(cfb));break;case"binary":cfb=s2a(cfb);break;case"buffer":break;case"array":Array.isArray(cfb)||(cfb=Array.prototype.slice.call(cfb));break}prep_blob(cfb,0),WB={content:cfb}}var WorkbookP,_data;if(CompObj&&parse_compobj(CompObj),options.bookProps&&!options.bookSheets)WorkbookP={};else{var T=has_buf?"buffer":"array";if(WB&&WB.content)WorkbookP=parse_workbook(WB.content,options);else if((_data=CFB.find(cfb,"PerfectOffice_MAIN"))&&_data.content)WorkbookP=WK_.to_workbook(_data.content,(options.type=T,options));else if((_data=CFB.find(cfb,"NativeContent_MAIN"))&&_data.content)WorkbookP=WK_.to_workbook(_data.content,(options.type=T,options));else throw(_data=CFB.find(cfb,"MN0"))&&_data.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");options.bookVBA&&cfb.FullPaths&&CFB.find(cfb,"/_VBA_PROJECT_CUR/VBA/dir")&&(WorkbookP.vbaraw=make_vba_xls(cfb))}var props={};return cfb.FullPaths&&parse_xls_props(cfb,props,options),WorkbookP.Props=WorkbookP.Custprops=props,options.bookFiles&&(WorkbookP.cfb=cfb),WorkbookP}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},XLSRecordEnum={6:{f:parse_Formula},10:{f:parsenoop2},12:{f:parseuint16},13:{f:parseuint16},14:{f:parsebool},15:{f:parsebool},16:{f:parse_Xnum},17:{f:parsebool},18:{f:parsebool},19:{f:parseuint16},20:{f:parse_XLHeaderFooter},21:{f:parse_XLHeaderFooter},23:{f:parse_ExternSheet},24:{f:parse_Lbl},25:{f:parsebool},26:{},27:{},28:{f:parse_Note},29:{},34:{f:parsebool},35:{f:parse_ExternName},38:{f:parse_Xnum},39:{f:parse_Xnum},40:{f:parse_Xnum},41:{f:parse_Xnum},42:{f:parsebool},43:{f:parsebool},47:{f:parse_FilePass},49:{f:parse_Font},51:{f:parseuint16},60:{},61:{f:parse_Window1},64:{f:parsebool},65:{f:parse_Pane},66:{f:parseuint16},77:{},80:{},81:{},82:{},85:{f:parseuint16},89:{},90:{},91:{},92:{f:parse_WriteAccess},93:{f:parse_Obj},94:{},95:{f:parsebool},96:{},97:{},99:{f:parsebool},125:{f:parse_ColInfo},128:{f:parse_Guts},129:{f:parse_WsBool},130:{f:parseuint16},131:{f:parsebool},132:{f:parsebool},133:{f:parse_BoundSheet8},134:{},140:{f:parse_Country},141:{f:parseuint16},144:{},146:{f:parse_Palette},151:{},152:{},153:{},154:{},155:{},156:{f:parseuint16},157:{},158:{},160:{f:parse_Scl},161:{f:parse_Setup},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:parse_MulRk},190:{f:parse_MulBlank},193:{f:parsenoop2},197:{},198:{},199:{},200:{},201:{},202:{f:parsebool},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:parseuint16},220:{},221:{f:parsebool},222:{},224:{f:parse_XF},225:{f:parse_InterfaceHdr},226:{f:parsenoop2},227:{},229:{f:parse_MergeCells},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:parse_SST},253:{f:parse_LabelSst},255:{f:parse_ExtSST},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:parseuint16a},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:parsebool},353:{f:parsenoop2},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:parse_SupBook},431:{f:parsebool},432:{},433:{},434:{},437:{},438:{f:parse_TxO},439:{f:parsebool},440:{f:parse_HLink},441:{},442:{f:parse_XLUnicodeString},443:{},444:{f:parseuint16},445:{},446:{},448:{f:parsenoop2},449:{f:parse_RecalcId,r:2},450:{f:parsenoop2},512:{f:parse_Dimensions},513:{f:parse_Blank},515:{f:parse_Number},516:{f:parse_Label},517:{f:parse_BoolErr},519:{f:parse_String},520:{f:parse_Row},523:{},545:{f:parse_Array},549:{f:parse_DefaultRowHeight},566:{},574:{f:parse_Window2},638:{f:parse_RK},659:{},1048:{},1054:{f:parse_Format},1084:{},1212:{f:parse_ShrFmla},2048:{f:parse_HLinkTooltip},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:parse_BOF},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:parsenoop2},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:parse_XFCRC,r:12},2173:{f:parse_XFExt,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:parsebool,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:parse_NameCmt,r:12},2197:{},2198:{f:parse_Theme,r:12},2199:{},2200:{},2201:{},2202:{f:parse_MTRSettings,r:12},2203:{f:parsenoop2},2204:{},2205:{},2206:{},2207:{},2211:{f:parse_ForceFullCalculation},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:parseuint16},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:parse_ShtProps},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:parse_ClrtClient},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:parse_Dimensions},1:{},2:{f:parse_BIFF2INT},3:{f:parse_BIFF2NUM},4:{f:parse_BIFF2STR},5:{f:parse_BoolErr},7:{f:parse_BIFF2STRING},8:{},9:{f:parse_BOF},11:{},22:{f:parseuint16},30:{f:parse_BIFF2Format},31:{},32:{},33:{f:parse_Array},36:{},37:{f:parse_DefaultRowHeight},50:{f:parse_BIFF2FONTXTRA},62:{},52:{},67:{},68:{f:parseuint16},69:{},86:{},126:{},127:{f:parse_ImData},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:parse_RString},223:{},234:{},354:{},421:{},518:{f:parse_Formula},521:{f:parse_BOF},536:{f:parse_Lbl},547:{f:parse_ExternName},561:{},579:{},1030:{f:parse_Formula},1033:{f:parse_BOF},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function write_biff_rec(ba,type,payload,length){var t=type;if(!isNaN(t)){var len2=length||(payload||[]).length||0,o=ba.next(4);o.write_shift(2,t),o.write_shift(2,len2),len2>0&&is_buf(payload)&&ba.push(payload)}}function html_to_sheet(str,_opts){var opts=_opts||{};DENSE!=null&&opts.dense==null&&(opts.dense=DENSE);var ws=opts.dense?[]:{};str=str.replace(/<!--.*?-->/g,"");var mtch=str.match(/<table/i);if(!mtch)throw new Error("Invalid HTML: could not find <table>");var mtch2=str.match(/<\/table/i),i=mtch.index,j=mtch2&&mtch2.index||str.length,rows=split_regex(str.slice(i,j),/(:?<tr[^>]*>)/i,"<tr>"),R=-1,C=0,RS=0,CS=0,range3={s:{r:1e7,c:1e7},e:{r:0,c:0}},merges=[];for(i=0;i<rows.length;++i){var row=rows[i].trim(),hd=row.slice(0,3).toLowerCase();if(hd=="<tr"){if(++R,opts.sheetRows&&opts.sheetRows<=R){--R;break}C=0;continue}if(!(hd!="<td"&&hd!="<th")){var cells=row.split(/<\/t[dh]>/i);for(j=0;j<cells.length;++j){var cell=cells[j].trim();if(!!cell.match(/<t[dh]/i)){for(var m=cell,cc=0;m.charAt(0)=="<"&&(cc=m.indexOf(">"))>-1;)m=m.slice(cc+1);for(var midx=0;midx<merges.length;++midx){var _merge=merges[midx];_merge.s.c==C&&_merge.s.r<R&&R<=_merge.e.r&&(C=_merge.e.c+1,midx=-1)}var tag=parsexmltag(cell.slice(0,cell.indexOf(">")));CS=tag.colspan?+tag.colspan:1,((RS=+tag.rowspan)>1||CS>1)&&merges.push({s:{r:R,c:C},e:{r:R+(RS||1)-1,c:C+CS-1}});var _t=tag.t||tag["data-t"]||"";if(!m.length){C+=CS;continue}if(m=htmldecode(m),range3.s.r>R&&(range3.s.r=R),range3.e.r<R&&(range3.e.r=R),range3.s.c>C&&(range3.s.c=C),range3.e.c<C&&(range3.e.c=C),!m.length){C+=CS;continue}var o={t:"s",v:m};opts.raw||!m.trim().length||_t=="s"||(m==="TRUE"?o={t:"b",v:!0}:m==="FALSE"?o={t:"b",v:!1}:isNaN(fuzzynum(m))?isNaN(fuzzydate(m).getDate())||(o={t:"d",v:parseDate(m)},opts.cellDates||(o={t:"n",v:datenum(o.v)}),o.z=opts.dateNF||table_fmt[14]):o={t:"n",v:fuzzynum(m)}),opts.dense?(ws[R]||(ws[R]=[]),ws[R][C]=o):ws[encode_cell({r:R,c:C})]=o,C+=CS}}}}return ws["!ref"]=encode_range(range3),merges.length&&(ws["!merges"]=merges),ws}function make_html_row(ws,r,R,o){for(var M=ws["!merges"]||[],oo=[],C=r.s.c;C<=r.e.c;++C){for(var RS=0,CS=0,j=0;j<M.length;++j)if(!(M[j].s.r>R||M[j].s.c>C)&&!(M[j].e.r<R||M[j].e.c<C)){if(M[j].s.r<R||M[j].s.c<C){RS=-1;break}RS=M[j].e.r-M[j].s.r+1,CS=M[j].e.c-M[j].s.c+1;break}if(!(RS<0)){var coord=encode_cell({r:R,c:C}),cell=o.dense?(ws[R]||[])[C]:ws[coord],w=cell&&cell.v!=null&&(cell.h||escapehtml(cell.w||(format_cell(cell),cell.w)||""))||"",sp={};RS>1&&(sp.rowspan=RS),CS>1&&(sp.colspan=CS),o.editable?w='<span contenteditable="true">'+w+"</span>":cell&&(sp["data-t"]=cell&&cell.t||"z",cell.v!=null&&(sp["data-v"]=cell.v),cell.z!=null&&(sp["data-z"]=cell.z),cell.l&&(cell.l.Target||"#").charAt(0)!="#"&&(w='<a href="'+cell.l.Target+'">'+w+"</a>")),sp.id=(o.id||"sjs")+"-"+coord,oo.push(writextag("td",w,sp))}}var preamble="<tr>";return preamble+oo.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function html_to_workbook(str,opts){var mtch=str.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!mtch||mtch.length==0)throw new Error("Invalid HTML: could not find <table>");if(mtch.length==1)return sheet_to_workbook(html_to_sheet(mtch[0],opts),opts);var wb=book_new();return mtch.forEach(function(s,idx){book_append_sheet(wb,html_to_sheet(s,opts),"Sheet"+(idx+1))}),wb}function make_html_preamble(ws,R,o){var out=[];return out.join("")+"<table"+(o&&o.id?' id="'+o.id+'"':"")+">"}function sheet_to_html(ws,opts){var o=opts||{},header=o.header!=null?o.header:HTML_BEGIN,footer=o.footer!=null?o.footer:HTML_END,out=[header],r=decode_range(ws["!ref"]);o.dense=Array.isArray(ws),out.push(make_html_preamble(ws,r,o));for(var R=r.s.r;R<=r.e.r;++R)out.push(make_html_row(ws,r,R,o));return out.push("</table>"+footer),out.join("")}function sheet_add_dom(ws,table,_opts){var opts=_opts||{};DENSE!=null&&(opts.dense=DENSE);var or_R=0,or_C=0;if(opts.origin!=null)if(typeof opts.origin=="number")or_R=opts.origin;else{var _origin=typeof opts.origin=="string"?decode_cell(opts.origin):opts.origin;or_R=_origin.r,or_C=_origin.c}var rows=table.getElementsByTagName("tr"),sheetRows=Math.min(opts.sheetRows||1e7,rows.length),range3={s:{r:0,c:0},e:{r:or_R,c:or_C}};if(ws["!ref"]){var _range=decode_range(ws["!ref"]);range3.s.r=Math.min(range3.s.r,_range.s.r),range3.s.c=Math.min(range3.s.c,_range.s.c),range3.e.r=Math.max(range3.e.r,_range.e.r),range3.e.c=Math.max(range3.e.c,_range.e.c),or_R==-1&&(range3.e.r=or_R=_range.e.r+1)}var merges=[],midx=0,rowinfo=ws["!rows"]||(ws["!rows"]=[]),_R=0,R=0,_C=0,C=0,RS=0,CS=0;for(ws["!cols"]||(ws["!cols"]=[]);_R<rows.length&&R<sheetRows;++_R){var row=rows[_R];if(is_dom_element_hidden(row)){if(opts.display)continue;rowinfo[R]={hidden:!0}}var elts=row.children;for(_C=C=0;_C<elts.length;++_C){var elt=elts[_C];if(!(opts.display&&is_dom_element_hidden(elt))){var v=elt.hasAttribute("data-v")?elt.getAttribute("data-v"):elt.hasAttribute("v")?elt.getAttribute("v"):htmldecode(elt.innerHTML),z=elt.getAttribute("data-z")||elt.getAttribute("z");for(midx=0;midx<merges.length;++midx){var m=merges[midx];m.s.c==C+or_C&&m.s.r<R+or_R&&R+or_R<=m.e.r&&(C=m.e.c+1-or_C,midx=-1)}CS=+elt.getAttribute("colspan")||1,((RS=+elt.getAttribute("rowspan")||1)>1||CS>1)&&merges.push({s:{r:R+or_R,c:C+or_C},e:{r:R+or_R+(RS||1)-1,c:C+or_C+(CS||1)-1}});var o={t:"s",v},_t=elt.getAttribute("data-t")||elt.getAttribute("t")||"";v!=null&&(v.length==0?o.t=_t||"z":opts.raw||v.trim().length==0||_t=="s"||(v==="TRUE"?o={t:"b",v:!0}:v==="FALSE"?o={t:"b",v:!1}:isNaN(fuzzynum(v))?isNaN(fuzzydate(v).getDate())||(o={t:"d",v:parseDate(v)},opts.cellDates||(o={t:"n",v:datenum(o.v)}),o.z=opts.dateNF||table_fmt[14]):o={t:"n",v:fuzzynum(v)})),o.z===void 0&&z!=null&&(o.z=z);var l="",Aelts=elt.getElementsByTagName("A");if(Aelts&&Aelts.length)for(var Aelti=0;Aelti<Aelts.length&&!(Aelts[Aelti].hasAttribute("href")&&(l=Aelts[Aelti].getAttribute("href"),l.charAt(0)!="#"));++Aelti);l&&l.charAt(0)!="#"&&(o.l={Target:l}),opts.dense?(ws[R+or_R]||(ws[R+or_R]=[]),ws[R+or_R][C+or_C]=o):ws[encode_cell({c:C+or_C,r:R+or_R})]=o,range3.e.c<C+or_C&&(range3.e.c=C+or_C),C+=CS}}++R}return merges.length&&(ws["!merges"]=(ws["!merges"]||[]).concat(merges)),range3.e.r=Math.max(range3.e.r,R-1+or_R),ws["!ref"]=encode_range(range3),R>=sheetRows&&(ws["!fullref"]=encode_range((range3.e.r=rows.length-_R+R-1+or_R,range3))),ws}function parse_dom_table(table,_opts){var opts=_opts||{},ws=opts.dense?[]:{};return sheet_add_dom(ws,table,_opts)}function table_to_book(table,opts){return sheet_to_workbook(parse_dom_table(table,opts),opts)}function is_dom_element_hidden(element){var display="",get_computed_style=get_get_computed_style_function(element);return get_computed_style&&(display=get_computed_style(element).getPropertyValue("display")),display||(display=element.style&&element.style.display),display==="none"}function get_get_computed_style_function(element){return element.ownerDocument.defaultView&&typeof element.ownerDocument.defaultView.getComputedStyle=="function"?element.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function parse_text_p(text){var fixed=text.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function($$2,$1){return Array(parseInt($1,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),v=unescapexml(fixed.replace(/<[^>]*>/g,""));return[v]}var number_formats_ods={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function parse_content_xml(d,_opts){var opts=_opts||{};DENSE!=null&&opts.dense==null&&(opts.dense=DENSE);var str=xlml_normalize(d),state=[],tmp,tag,NFtag={name:""},NF="",pidx=0,sheetag,rowtag,Sheets={},SheetNames=[],ws=opts.dense?[]:{},Rn,q,ctag={value:""},textp="",textpidx=0,textptag,textR=[],R=-1,C=-1,range3={s:{r:1e6,c:1e7},e:{r:0,c:0}},row_ol=0,number_format_map={},merges=[],mrange={},mR=0,mC=0,rowinfo=[],rowpeat=1,colpeat=1,arrayf=[],WB={Names:[]},atag={},_Ref=["",""],comments=[],comment={},creator="",creatoridx=0,isstub=!1,intable=!1,i=0;for(xlmlregex.lastIndex=0,str=str.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");Rn=xlmlregex.exec(str);)switch(Rn[3]=Rn[3].replace(/_.*$/,"")){case"table":case"\u5DE5\u4F5C\u8868":Rn[1]==="/"?(range3.e.c>=range3.s.c&&range3.e.r>=range3.s.r?ws["!ref"]=encode_range(range3):ws["!ref"]="A1:A1",opts.sheetRows>0&&opts.sheetRows<=range3.e.r&&(ws["!fullref"]=ws["!ref"],range3.e.r=opts.sheetRows-1,ws["!ref"]=encode_range(range3)),merges.length&&(ws["!merges"]=merges),rowinfo.length&&(ws["!rows"]=rowinfo),sheetag.name=sheetag.\u540D\u79F0||sheetag.name,typeof JSON!="undefined"&&JSON.stringify(sheetag),SheetNames.push(sheetag.name),Sheets[sheetag.name]=ws,intable=!1):Rn[0].charAt(Rn[0].length-2)!=="/"&&(sheetag=parsexmltag(Rn[0],!1),R=C=-1,range3.s.r=range3.s.c=1e7,range3.e.r=range3.e.c=0,ws=opts.dense?[]:{},merges=[],rowinfo=[],intable=!0);break;case"table-row-group":Rn[1]==="/"?--row_ol:++row_ol;break;case"table-row":case"\u884C":if(Rn[1]==="/"){R+=rowpeat,rowpeat=1;break}if(rowtag=parsexmltag(Rn[0],!1),rowtag.\u884C\u53F7?R=rowtag.\u884C\u53F7-1:R==-1&&(R=0),rowpeat=+rowtag["number-rows-repeated"]||1,rowpeat<10)for(i=0;i<rowpeat;++i)row_ol>0&&(rowinfo[R+i]={level:row_ol});C=-1;break;case"covered-table-cell":Rn[1]!=="/"&&++C,opts.sheetStubs&&(opts.dense?(ws[R]||(ws[R]=[]),ws[R][C]={t:"z"}):ws[encode_cell({r:R,c:C})]={t:"z"}),textp="",textR=[];break;case"table-cell":case"\u6570\u636E":if(Rn[0].charAt(Rn[0].length-2)==="/")++C,ctag=parsexmltag(Rn[0],!1),colpeat=parseInt(ctag["number-columns-repeated"]||"1",10),q={t:"z",v:null},ctag.formula&&opts.cellFormula!=!1&&(q.f=ods_to_csf_formula(unescapexml(ctag.formula))),(ctag.\u6570\u636E\u7C7B\u578B||ctag["value-type"])=="string"&&(q.t="s",q.v=unescapexml(ctag["string-value"]||""),opts.dense?(ws[R]||(ws[R]=[]),ws[R][C]=q):ws[encode_cell({r:R,c:C})]=q),C+=colpeat-1;else if(Rn[1]!=="/"){++C,textp="",textpidx=0,textR=[],colpeat=1;var rptR=rowpeat?R+rowpeat-1:R;if(C>range3.e.c&&(range3.e.c=C),C<range3.s.c&&(range3.s.c=C),R<range3.s.r&&(range3.s.r=R),rptR>range3.e.r&&(range3.e.r=rptR),ctag=parsexmltag(Rn[0],!1),comments=[],comment={},q={t:ctag.\u6570\u636E\u7C7B\u578B||ctag["value-type"],v:null},opts.cellFormula)if(ctag.formula&&(ctag.formula=unescapexml(ctag.formula)),ctag["number-matrix-columns-spanned"]&&ctag["number-matrix-rows-spanned"]&&(mR=parseInt(ctag["number-matrix-rows-spanned"],10)||0,mC=parseInt(ctag["number-matrix-columns-spanned"],10)||0,mrange={s:{r:R,c:C},e:{r:R+mR-1,c:C+mC-1}},q.F=encode_range(mrange),arrayf.push([mrange,q.F])),ctag.formula)q.f=ods_to_csf_formula(ctag.formula);else for(i=0;i<arrayf.length;++i)R>=arrayf[i][0].s.r&&R<=arrayf[i][0].e.r&&C>=arrayf[i][0].s.c&&C<=arrayf[i][0].e.c&&(q.F=arrayf[i][1]);switch((ctag["number-columns-spanned"]||ctag["number-rows-spanned"])&&(mR=parseInt(ctag["number-rows-spanned"],10)||0,mC=parseInt(ctag["number-columns-spanned"],10)||0,mrange={s:{r:R,c:C},e:{r:R+mR-1,c:C+mC-1}},merges.push(mrange)),ctag["number-columns-repeated"]&&(colpeat=parseInt(ctag["number-columns-repeated"],10)),q.t){case"boolean":q.t="b",q.v=parsexmlbool(ctag["boolean-value"]);break;case"float":q.t="n",q.v=parseFloat(ctag.value);break;case"percentage":q.t="n",q.v=parseFloat(ctag.value);break;case"currency":q.t="n",q.v=parseFloat(ctag.value);break;case"date":q.t="d",q.v=parseDate(ctag["date-value"]),opts.cellDates||(q.t="n",q.v=datenum(q.v)),q.z="m/d/yy";break;case"time":q.t="n",q.v=parse_isodur(ctag["time-value"])/86400,opts.cellDates&&(q.t="d",q.v=numdate(q.v)),q.z="HH:MM:SS";break;case"number":q.t="n",q.v=parseFloat(ctag.\u6570\u636E\u6570\u503C);break;default:if(q.t==="string"||q.t==="text"||!q.t)q.t="s",ctag["string-value"]!=null&&(textp=unescapexml(ctag["string-value"]),textR=[]);else throw new Error("Unsupported value type "+q.t)}}else{if(isstub=!1,q.t==="s"&&(q.v=textp||"",textR.length&&(q.R=textR),isstub=textpidx==0),atag.Target&&(q.l=atag),comments.length>0&&(q.c=comments,comments=[]),textp&&opts.cellText!==!1&&(q.w=textp),isstub&&(q.t="z",delete q.v),(!isstub||opts.sheetStubs)&&!(opts.sheetRows&&opts.sheetRows<=R))for(var rpt=0;rpt<rowpeat;++rpt){if(colpeat=parseInt(ctag["number-columns-repeated"]||"1",10),opts.dense)for(ws[R+rpt]||(ws[R+rpt]=[]),ws[R+rpt][C]=rpt==0?q:dup(q);--colpeat>0;)ws[R+rpt][C+colpeat]=dup(q);else for(ws[encode_cell({r:R+rpt,c:C})]=q;--colpeat>0;)ws[encode_cell({r:R+rpt,c:C+colpeat})]=dup(q);range3.e.c<=C&&(range3.e.c=C)}colpeat=parseInt(ctag["number-columns-repeated"]||"1",10),C+=colpeat-1,colpeat=0,q={},textp="",textR=[]}atag={};break;case"document":case"document-content":case"\u7535\u5B50\u8868\u683C\u6587\u6863":case"spreadsheet":case"\u4E3B\u4F53":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else Rn[0].charAt(Rn[0].length-2)!=="/"&&state.push([Rn[3],!0]);break;case"annotation":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp;comment.t=textp,textR.length&&(comment.R=textR),comment.a=creator,comments.push(comment)}else Rn[0].charAt(Rn[0].length-2)!=="/"&&state.push([Rn[3],!1]);creator="",creatoridx=0,textp="",textpidx=0,textR=[];break;case"creator":Rn[1]==="/"?creator=str.slice(creatoridx,Rn.index):creatoridx=Rn.index+Rn[0].length;break;case"meta":case"\u5143\u6570\u636E":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else Rn[0].charAt(Rn[0].length-2)!=="/"&&state.push([Rn[3],!1]);textp="",textpidx=0,textR=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(Rn[1]==="/"){if(number_format_map[NFtag.name]=NF,(tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else Rn[0].charAt(Rn[0].length-2)!=="/"&&(NF="",NFtag=parsexmltag(Rn[0],!1),state.push([Rn[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(state[state.length-1][0]){case"time-style":case"date-style":tag=parsexmltag(Rn[0],!1),NF+=number_formats_ods[Rn[3]][tag.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(state[state.length-1][0]){case"time-style":case"date-style":tag=parsexmltag(Rn[0],!1),NF+=number_formats_ods[Rn[3]][tag.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(Rn[0].slice(-2)==="/>")break;if(Rn[1]==="/")switch(state[state.length-1][0]){case"number-style":case"date-style":case"time-style":NF+=str.slice(pidx,Rn.index);break}else pidx=Rn.index+Rn[0].length;break;case"named-range":tag=parsexmltag(Rn[0],!1),_Ref=ods_to_csf_3D(tag["cell-range-address"]);var nrange={Name:tag.name,Ref:_Ref[0]+"!"+_Ref[1]};intable&&(nrange.Sheet=SheetNames.length),WB.Names.push(nrange);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"\u7535\u5B50\u8868\u683C":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"\u6587\u672C\u4E32":if(["master-styles"].indexOf(state[state.length-1][0])>-1)break;if(Rn[1]==="/"&&(!ctag||!ctag["string-value"])){var ptp=parse_text_p(str.slice(textpidx,Rn.index),textptag);textp=(textp.length>0?textp+`
`:"")+ptp[0]}else textptag=parsexmltag(Rn[0],!1),textpidx=Rn.index+Rn[0].length;break;case"s":break;case"database-range":if(Rn[1]==="/")break;try{_Ref=ods_to_csf_3D(parsexmltag(Rn[0])["target-range-address"]),Sheets[_Ref[0]]["!autofilter"]={ref:_Ref[1]}}catch(e){}break;case"date":break;case"object":break;case"title":case"\u6807\u9898":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(Rn[1]!=="/"){if(atag=parsexmltag(Rn[0],!1),!atag.href)break;atag.Target=unescapexml(atag.href),delete atag.href,atag.Target.charAt(0)=="#"&&atag.Target.indexOf(".")>-1?(_Ref=ods_to_csf_3D(atag.Target.slice(1)),atag.Target="#"+_Ref[0]+"!"+_Ref[1]):atag.Target.match(/^\.\.[\\\/]/)&&(atag.Target=atag.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(Rn[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"\u8868:":case"\u5B57:":break;default:if(opts.WTF)throw new Error(Rn)}}var out={Sheets,SheetNames,Workbook:WB};return opts.bookSheets&&delete out.Sheets,out}function parse_ods(zip,opts){opts=opts||{},safegetzipfile(zip,"META-INF/manifest.xml")&&parse_manifest(getzipdata(zip,"META-INF/manifest.xml"),opts);var content=getzipstr(zip,"content.xml");if(!content)throw new Error("Missing content.xml in ODS / UOF file");var wb=parse_content_xml(utf8read(content),opts);return safegetzipfile(zip,"meta.xml")&&(wb.Props=parse_core_props(getzipdata(zip,"meta.xml"))),wb}function parse_fods(data,opts){return parse_content_xml(data,opts)}function u8_to_dataview(array){return new DataView(array.buffer,array.byteOffset,array.byteLength)}function u8str(u8){return typeof TextDecoder!="undefined"?new TextDecoder().decode(u8):utf8read(a2s(u8))}function u8concat(u8a){var len2=u8a.reduce(function(acc,x){return acc+x.length},0),out=new Uint8Array(len2),off=0;return u8a.forEach(function(u8){out.set(u8,off),off+=u8.length}),out}function popcnt(x){return x-=x>>1&1431655765,x=(x&858993459)+(x>>2&858993459),(x+(x>>4)&252645135)*16843009>>>24}function readDecimal128LE(buf,offset){for(var exp=(buf[offset+15]&127)<<7|buf[offset+14]>>1,mantissa=buf[offset+14]&1,j=offset+13;j>=offset;--j)mantissa=mantissa*256+buf[j];return(buf[offset+15]&128?-mantissa:mantissa)*Math.pow(10,exp-6176)}function parse_varint49(buf,ptr){var l=ptr?ptr[0]:0,usz=buf[l]&127;varint:if(buf[l++]>=128&&(usz|=(buf[l]&127)<<7,buf[l++]<128||(usz|=(buf[l]&127)<<14,buf[l++]<128)||(usz|=(buf[l]&127)<<21,buf[l++]<128)||(usz+=(buf[l]&127)*Math.pow(2,28),++l,buf[l++]<128)||(usz+=(buf[l]&127)*Math.pow(2,35),++l,buf[l++]<128)||(usz+=(buf[l]&127)*Math.pow(2,42),++l,buf[l++]<128)))break varint;return ptr&&(ptr[0]=l),usz}function varint_to_i32(buf){var l=0,i32=buf[l]&127;varint:if(buf[l++]>=128){if(i32|=(buf[l]&127)<<7,buf[l++]<128||(i32|=(buf[l]&127)<<14,buf[l++]<128)||(i32|=(buf[l]&127)<<21,buf[l++]<128))break varint;i32|=(buf[l]&127)<<28}return i32}function parse_shallow(buf){for(var out=[],ptr=[0];ptr[0]<buf.length;){var off=ptr[0],num=parse_varint49(buf,ptr),type=num&7;num=Math.floor(num/8);var len2=0,res;if(num==0)break;switch(type){case 0:{for(var l=ptr[0];buf[ptr[0]++]>=128;);res=buf.slice(l,ptr[0])}break;case 5:len2=4,res=buf.slice(ptr[0],ptr[0]+len2),ptr[0]+=len2;break;case 1:len2=8,res=buf.slice(ptr[0],ptr[0]+len2),ptr[0]+=len2;break;case 2:len2=parse_varint49(buf,ptr),res=buf.slice(ptr[0],ptr[0]+len2),ptr[0]+=len2;break;case 3:case 4:default:throw new Error("PB Type ".concat(type," for Field ").concat(num," at offset ").concat(off))}var v={data:res,type};out[num]==null?out[num]=[v]:out[num].push(v)}return out}function mappa(data,cb){return(data==null?void 0:data.map(function(d){return cb(d.data)}))||[]}function parse_iwa_file(buf){for(var _a3,out=[],ptr=[0];ptr[0]<buf.length;){var len2=parse_varint49(buf,ptr),ai=parse_shallow(buf.slice(ptr[0],ptr[0]+len2));ptr[0]+=len2;var res={id:varint_to_i32(ai[1][0].data),messages:[]};ai[2].forEach(function(b){var mi=parse_shallow(b.data),fl=varint_to_i32(mi[3][0].data);res.messages.push({meta:mi,data:buf.slice(ptr[0],ptr[0]+fl)}),ptr[0]+=fl}),((_a3=ai[3])==null?void 0:_a3[0])&&(res.merge=varint_to_i32(ai[3][0].data)>>>0>0),out.push(res)}return out}function parse_snappy_chunk(type,buf){if(type!=0)throw new Error("Unexpected Snappy chunk type ".concat(type));for(var ptr=[0],usz=parse_varint49(buf,ptr),chunks=[];ptr[0]<buf.length;){var tag=buf[ptr[0]]&3;if(tag==0){var len2=buf[ptr[0]++]>>2;if(len2<60)++len2;else{var c=len2-59;len2=buf[ptr[0]],c>1&&(len2|=buf[ptr[0]+1]<<8),c>2&&(len2|=buf[ptr[0]+2]<<16),c>3&&(len2|=buf[ptr[0]+3]<<24),len2>>>=0,len2++,ptr[0]+=c}chunks.push(buf.slice(ptr[0],ptr[0]+len2)),ptr[0]+=len2;continue}else{var offset=0,length=0;if(tag==1?(length=(buf[ptr[0]]>>2&7)+4,offset=(buf[ptr[0]++]&224)<<3,offset|=buf[ptr[0]++]):(length=(buf[ptr[0]++]>>2)+1,tag==2?(offset=buf[ptr[0]]|buf[ptr[0]+1]<<8,ptr[0]+=2):(offset=(buf[ptr[0]]|buf[ptr[0]+1]<<8|buf[ptr[0]+2]<<16|buf[ptr[0]+3]<<24)>>>0,ptr[0]+=4)),chunks=[u8concat(chunks)],offset==0)throw new Error("Invalid offset 0");if(offset>chunks[0].length)throw new Error("Invalid offset beyond length");if(length>=offset)for(chunks.push(chunks[0].slice(-offset)),length-=offset;length>=chunks[chunks.length-1].length;)chunks.push(chunks[chunks.length-1]),length-=chunks[chunks.length-1].length;chunks.push(chunks[0].slice(-offset,-offset+length))}}var o=u8concat(chunks);if(o.length!=usz)throw new Error("Unexpected length: ".concat(o.length," != ").concat(usz));return o}function decompress_iwa_file(buf){for(var out=[],l=0;l<buf.length;){var t=buf[l++],len2=buf[l]|buf[l+1]<<8|buf[l+2]<<16;l+=3,out.push(parse_snappy_chunk(t,buf.slice(l,l+len2))),l+=len2}if(l!==buf.length)throw new Error("data is not a valid framed stream!");return u8concat(out)}function parse_old_storage(buf,sst,rsst,v){var dv=u8_to_dataview(buf),flags=dv.getUint32(4,!0),data_offset=(v>1?12:8)+popcnt(flags&(v>1?3470:398))*4,ridx=-1,sidx=-1,ieee=NaN,dt=new Date(2001,0,1);flags&512&&(ridx=dv.getUint32(data_offset,!0),data_offset+=4),data_offset+=popcnt(flags&(v>1?12288:4096))*4,flags&16&&(sidx=dv.getUint32(data_offset,!0),data_offset+=4),flags&32&&(ieee=dv.getFloat64(data_offset,!0),data_offset+=8),flags&64&&(dt.setTime(dt.getTime()+dv.getFloat64(data_offset,!0)*1e3),data_offset+=8);var ret;switch(buf[2]){case 0:break;case 2:ret={t:"n",v:ieee};break;case 3:ret={t:"s",v:sst[sidx]};break;case 5:ret={t:"d",v:dt};break;case 6:ret={t:"b",v:ieee>0};break;case 7:ret={t:"n",v:ieee/86400};break;case 8:ret={t:"e",v:0};break;case 9:if(ridx>-1)ret={t:"s",v:rsst[ridx]};else if(sidx>-1)ret={t:"s",v:sst[sidx]};else if(!isNaN(ieee))ret={t:"n",v:ieee};else throw new Error("Unsupported cell type ".concat(buf.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(buf.slice(0,4)))}return ret}function parse_new_storage(buf,sst,rsst){var dv=u8_to_dataview(buf),flags=dv.getUint32(8,!0),data_offset=12,ridx=-1,sidx=-1,d128=NaN,ieee=NaN,dt=new Date(2001,0,1);flags&1&&(d128=readDecimal128LE(buf,data_offset),data_offset+=16),flags&2&&(ieee=dv.getFloat64(data_offset,!0),data_offset+=8),flags&4&&(dt.setTime(dt.getTime()+dv.getFloat64(data_offset,!0)*1e3),data_offset+=8),flags&8&&(sidx=dv.getUint32(data_offset,!0),data_offset+=4),flags&16&&(ridx=dv.getUint32(data_offset,!0),data_offset+=4);var ret;switch(buf[1]){case 0:break;case 2:ret={t:"n",v:d128};break;case 3:ret={t:"s",v:sst[sidx]};break;case 5:ret={t:"d",v:dt};break;case 6:ret={t:"b",v:ieee>0};break;case 7:ret={t:"n",v:ieee/86400};break;case 8:ret={t:"e",v:0};break;case 9:if(ridx>-1)ret={t:"s",v:rsst[ridx]};else throw new Error("Unsupported cell type ".concat(buf[1]," : ").concat(flags&31," : ").concat(buf.slice(0,4)));break;case 10:ret={t:"n",v:d128};break;default:throw new Error("Unsupported cell type ".concat(buf[1]," : ").concat(flags&31," : ").concat(buf.slice(0,4)))}return ret}function parse_cell_storage(buf,sst,rsst){switch(buf[0]){case 0:case 1:case 2:case 3:return parse_old_storage(buf,sst,rsst,buf[0]);case 5:return parse_new_storage(buf,sst,rsst);default:throw new Error("Unsupported payload version ".concat(buf[0]))}}function parse_TSP_Reference(buf){var pb=parse_shallow(buf);return parse_varint49(pb[1][0].data)}function parse_TST_TableDataList(M,root){var pb=parse_shallow(root.data),type=varint_to_i32(pb[1][0].data),entries=pb[3],data=[];return(entries||[]).forEach(function(entry){var le=parse_shallow(entry.data),key=varint_to_i32(le[1][0].data)>>>0;switch(type){case 1:data[key]=u8str(le[3][0].data);break;case 8:{var rt=M[parse_TSP_Reference(le[9][0].data)][0],rtp=parse_shallow(rt.data),rtpref=M[parse_TSP_Reference(rtp[1][0].data)][0],mtype=varint_to_i32(rtpref.meta[1][0].data);if(mtype!=2001)throw new Error("2000 unexpected reference to ".concat(mtype));var tswpsa=parse_shallow(rtpref.data);data[key]=tswpsa[3].map(function(x){return u8str(x.data)}).join("")}break}}),data}function parse_TST_TileRowInfo(u8,type){var _a3,_b2,_c2,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,pb=parse_shallow(u8),R=varint_to_i32(pb[1][0].data)>>>0,cnt=varint_to_i32(pb[2][0].data)>>>0,wide_offsets=((_b2=(_a3=pb[8])==null?void 0:_a3[0])==null?void 0:_b2.data)&&varint_to_i32(pb[8][0].data)>0||!1,used_storage_u8,used_storage;if(((_d=(_c2=pb[7])==null?void 0:_c2[0])==null?void 0:_d.data)&&type!=0)used_storage_u8=(_f=(_e=pb[7])==null?void 0:_e[0])==null?void 0:_f.data,used_storage=(_h=(_g=pb[6])==null?void 0:_g[0])==null?void 0:_h.data;else if(((_j=(_i=pb[4])==null?void 0:_i[0])==null?void 0:_j.data)&&type!=1)used_storage_u8=(_l=(_k=pb[4])==null?void 0:_k[0])==null?void 0:_l.data,used_storage=(_n=(_m=pb[3])==null?void 0:_m[0])==null?void 0:_n.data;else throw"NUMBERS Tile missing ".concat(type," cell storage");for(var width=wide_offsets?4:1,used_storage_offsets=u8_to_dataview(used_storage_u8),offsets=[],C=0;C<used_storage_u8.length/2;++C){var off=used_storage_offsets.getUint16(C*2,!0);off<65535&&offsets.push([C,off])}if(offsets.length!=cnt)throw"Expected ".concat(cnt," cells, found ").concat(offsets.length);var cells=[];for(C=0;C<offsets.length-1;++C)cells[offsets[C][0]]=used_storage.subarray(offsets[C][1]*width,offsets[C+1][1]*width);return offsets.length>=1&&(cells[offsets[offsets.length-1][0]]=used_storage.subarray(offsets[offsets.length-1][1]*width)),{R,cells}}function parse_TST_Tile(M,root){var _a3,pb=parse_shallow(root.data),storage=((_a3=pb==null?void 0:pb[7])==null?void 0:_a3[0])?varint_to_i32(pb[7][0].data)>>>0>0?1:0:-1,ri=mappa(pb[5],function(u8){return parse_TST_TileRowInfo(u8,storage)});return{nrows:varint_to_i32(pb[4][0].data)>>>0,data:ri.reduce(function(acc,x){return acc[x.R]||(acc[x.R]=[]),x.cells.forEach(function(cell,C){if(acc[x.R][C])throw new Error("Duplicate cell r=".concat(x.R," c=").concat(C));acc[x.R][C]=cell}),acc},[])}}function parse_TST_TableModelArchive(M,root,ws){var _a3,pb=parse_shallow(root.data),range3={s:{r:0,c:0},e:{r:0,c:0}};if(range3.e.r=(varint_to_i32(pb[6][0].data)>>>0)-1,range3.e.r<0)throw new Error("Invalid row varint ".concat(pb[6][0].data));if(range3.e.c=(varint_to_i32(pb[7][0].data)>>>0)-1,range3.e.c<0)throw new Error("Invalid col varint ".concat(pb[7][0].data));ws["!ref"]=encode_range(range3);var store=parse_shallow(pb[4][0].data),sst=parse_TST_TableDataList(M,M[parse_TSP_Reference(store[4][0].data)][0]),rsst=((_a3=store[17])==null?void 0:_a3[0])?parse_TST_TableDataList(M,M[parse_TSP_Reference(store[17][0].data)][0]):[],tile=parse_shallow(store[3][0].data),_R=0;tile[1].forEach(function(t){var tl=parse_shallow(t.data),ref=M[parse_TSP_Reference(tl[2][0].data)][0],mtype=varint_to_i32(ref.meta[1][0].data);if(mtype!=6002)throw new Error("6001 unexpected reference to ".concat(mtype));var _tile=parse_TST_Tile(M,ref);_tile.data.forEach(function(row,R){row.forEach(function(buf,C){var addr=encode_cell({r:_R+R,c:C}),res=parse_cell_storage(buf,sst,rsst);res&&(ws[addr]=res)})}),_R+=_tile.nrows})}function parse_TST_TableInfoArchive(M,root){var pb=parse_shallow(root.data),out={"!ref":"A1"},tableref=M[parse_TSP_Reference(pb[2][0].data)],mtype=varint_to_i32(tableref[0].meta[1][0].data);if(mtype!=6001)throw new Error("6000 unexpected reference to ".concat(mtype));return parse_TST_TableModelArchive(M,tableref[0],out),out}function parse_TN_SheetArchive(M,root){var _a3,pb=parse_shallow(root.data),out={name:((_a3=pb[1])==null?void 0:_a3[0])?u8str(pb[1][0].data):"",sheets:[]},shapeoffs=mappa(pb[2],parse_TSP_Reference);return shapeoffs.forEach(function(off){M[off].forEach(function(m){var mtype=varint_to_i32(m.meta[1][0].data);mtype==6e3&&out.sheets.push(parse_TST_TableInfoArchive(M,m))})}),out}function parse_TN_DocumentArchive(M,root){var out=book_new(),pb=parse_shallow(root.data),sheetoffs=mappa(pb[1],parse_TSP_Reference);if(sheetoffs.forEach(function(off){M[off].forEach(function(m){var mtype=varint_to_i32(m.meta[1][0].data);if(mtype==2){var root2=parse_TN_SheetArchive(M,m);root2.sheets.forEach(function(sheet,idx){book_append_sheet(out,sheet,idx==0?root2.name:root2.name+"_"+idx,!0)})}})}),out.SheetNames.length==0)throw new Error("Empty NUMBERS file");return out}function parse_numbers_iwa(cfb){var _a3,_b2,_c2,_d,M={},indices2=[];if(cfb.FullPaths.forEach(function(p){if(p.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),cfb.FileIndex.forEach(function(s){if(!!s.name.match(/\.iwa$/)){var o;try{o=decompress_iwa_file(s.content)}catch(e){return console.log("?? "+s.content.length+" "+(e.message||e))}var packets;try{packets=parse_iwa_file(o)}catch(e){return console.log("## "+(e.message||e))}packets.forEach(function(packet){M[packet.id]=packet.messages,indices2.push(packet.id)})}}),!indices2.length)throw new Error("File has no messages");var docroot=((_d=(_c2=(_b2=(_a3=M==null?void 0:M[1])==null?void 0:_a3[0])==null?void 0:_b2.meta)==null?void 0:_c2[1])==null?void 0:_d[0].data)&&varint_to_i32(M[1][0].meta[1][0].data)==1&&M[1][0];if(docroot||indices2.forEach(function(idx){M[idx].forEach(function(iwam){var mtype=varint_to_i32(iwam.meta[1][0].data)>>>0;if(mtype==1)if(!docroot)docroot=iwam;else throw new Error("Document has multiple roots")})}),!docroot)throw new Error("Cannot find Document root");return parse_TN_DocumentArchive(M,docroot)}function fix_opts_func(defaults){return function(opts){for(var i=0;i!=defaults.length;++i){var d=defaults[i];opts[d[0]]===void 0&&(opts[d[0]]=d[1]),d[2]==="n"&&(opts[d[0]]=Number(opts[d[0]]))}}}function fix_read_opts(opts){fix_opts_func([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(opts)}function get_sheet_type(n){return RELS.WS.indexOf(n)>-1?"sheet":RELS.CS&&n==RELS.CS?"chart":RELS.DS&&n==RELS.DS?"dialog":RELS.MS&&n==RELS.MS?"macro":n&&n.length?n:"sheet"}function safe_parse_wbrels(wbrels,sheets){if(!wbrels)return 0;try{wbrels=sheets.map(function(w){return w.id||(w.id=w.strRelID),[w.name,wbrels["!id"][w.id].Target,get_sheet_type(wbrels["!id"][w.id].Type)]})}catch(e){return null}return!wbrels||wbrels.length===0?null:wbrels}function safe_parse_sheet(zip,path,relsPath,sheet,idx,sheetRels,sheets,stype,opts,wb,themes,styles){try{sheetRels[sheet]=parse_rels(getzipstr(zip,relsPath,!0),path);var data=getzipdata(zip,path),_ws;switch(stype){case"sheet":_ws=parse_ws(data,path,idx,opts,sheetRels[sheet],wb,themes,styles);break;case"chart":if(_ws=parse_cs(data,path,idx,opts,sheetRels[sheet],wb,themes,styles),!_ws||!_ws["!drawel"])break;var dfile=resolve_path(_ws["!drawel"].Target,path),drelsp=get_rels_path(dfile),draw=parse_drawing(getzipstr(zip,dfile,!0),parse_rels(getzipstr(zip,drelsp,!0),dfile)),chartp=resolve_path(draw,dfile),crelsp=get_rels_path(chartp);_ws=parse_chart(getzipstr(zip,chartp,!0),chartp,opts,parse_rels(getzipstr(zip,crelsp,!0),chartp),wb,_ws);break;case"macro":_ws=parse_ms(data,path,idx,opts,sheetRels[sheet],wb,themes,styles);break;case"dialog":_ws=parse_ds(data,path,idx,opts,sheetRels[sheet],wb,themes,styles);break;default:throw new Error("Unrecognized sheet type "+stype)}sheets[sheet]=_ws;var tcomments=[];sheetRels&&sheetRels[sheet]&&keys(sheetRels[sheet]).forEach(function(n){var dfile2="";if(sheetRels[sheet][n].Type==RELS.CMNT){dfile2=resolve_path(sheetRels[sheet][n].Target,path);var comments=parse_cmnt(getzipdata(zip,dfile2,!0),dfile2,opts);if(!comments||!comments.length)return;sheet_insert_comments(_ws,comments,!1)}sheetRels[sheet][n].Type==RELS.TCMNT&&(dfile2=resolve_path(sheetRels[sheet][n].Target,path),tcomments=tcomments.concat(parse_tcmnt_xml(getzipdata(zip,dfile2,!0),opts)))}),tcomments&&tcomments.length&&sheet_insert_comments(_ws,tcomments,!0,opts.people||[])}catch(e){if(opts.WTF)throw e}}function strip_front_slash(x){return x.charAt(0)=="/"?x.slice(1):x}function parse_zip(zip,opts){if(make_ssf(),opts=opts||{},fix_read_opts(opts),safegetzipfile(zip,"META-INF/manifest.xml")||safegetzipfile(zip,"objectdata.xml"))return parse_ods(zip,opts);if(safegetzipfile(zip,"Index/Document.iwa")){if(typeof Uint8Array=="undefined")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof parse_numbers_iwa!="undefined"){if(zip.FileIndex)return parse_numbers_iwa(zip);var _zip=CFB.utils.cfb_new();return zipentries(zip).forEach(function(e){zip_add_file(_zip,e,getzipbin(zip,e))}),parse_numbers_iwa(_zip)}throw new Error("Unsupported NUMBERS file")}if(!safegetzipfile(zip,"[Content_Types].xml"))throw safegetzipfile(zip,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):safegetzipfile(zip,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var entries=zipentries(zip),dir=parse_ct(getzipstr(zip,"[Content_Types].xml")),xlsb=!1,sheets,binname;if(dir.workbooks.length===0&&(binname="xl/workbook.xml",getzipdata(zip,binname,!0)&&dir.workbooks.push(binname)),dir.workbooks.length===0){if(binname="xl/workbook.bin",!getzipdata(zip,binname,!0))throw new Error("Could not find workbook");dir.workbooks.push(binname),xlsb=!0}dir.workbooks[0].slice(-3)=="bin"&&(xlsb=!0);var themes={},styles={};if(!opts.bookSheets&&!opts.bookProps){if(strs=[],dir.sst)try{strs=parse_sst(getzipdata(zip,strip_front_slash(dir.sst)),dir.sst,opts)}catch(e){if(opts.WTF)throw e}opts.cellStyles&&dir.themes.length&&(themes=parse_theme(getzipstr(zip,dir.themes[0].replace(/^\//,""),!0)||"",dir.themes[0],opts)),dir.style&&(styles=parse_sty(getzipdata(zip,strip_front_slash(dir.style)),dir.style,themes,opts))}dir.links.map(function(link){try{var rels=parse_rels(getzipstr(zip,get_rels_path(strip_front_slash(link))),link);return parse_xlink(getzipdata(zip,strip_front_slash(link)),rels,link,opts)}catch(e){}});var wb=parse_wb(getzipdata(zip,strip_front_slash(dir.workbooks[0])),dir.workbooks[0],opts),props={},propdata="";dir.coreprops.length&&(propdata=getzipdata(zip,strip_front_slash(dir.coreprops[0]),!0),propdata&&(props=parse_core_props(propdata)),dir.extprops.length!==0&&(propdata=getzipdata(zip,strip_front_slash(dir.extprops[0]),!0),propdata&&parse_ext_props(propdata,props,opts)));var custprops={};(!opts.bookSheets||opts.bookProps)&&dir.custprops.length!==0&&(propdata=getzipstr(zip,strip_front_slash(dir.custprops[0]),!0),propdata&&(custprops=parse_cust_props(propdata,opts)));var out={};if((opts.bookSheets||opts.bookProps)&&(wb.Sheets?sheets=wb.Sheets.map(function(x){return x.name}):props.Worksheets&&props.SheetNames.length>0&&(sheets=props.SheetNames),opts.bookProps&&(out.Props=props,out.Custprops=custprops),opts.bookSheets&&typeof sheets!="undefined"&&(out.SheetNames=sheets),opts.bookSheets?out.SheetNames:opts.bookProps))return out;sheets={};var deps={};opts.bookDeps&&dir.calcchain&&(deps=parse_cc(getzipdata(zip,strip_front_slash(dir.calcchain)),dir.calcchain,opts));var i=0,sheetRels={},path,relsPath;{var wbsheets=wb.Sheets;props.Worksheets=wbsheets.length,props.SheetNames=[];for(var j=0;j!=wbsheets.length;++j)props.SheetNames[j]=wbsheets[j].name}var wbext=xlsb?"bin":"xml",wbrelsi=dir.workbooks[0].lastIndexOf("/"),wbrelsfile=(dir.workbooks[0].slice(0,wbrelsi+1)+"_rels/"+dir.workbooks[0].slice(wbrelsi+1)+".rels").replace(/^\//,"");safegetzipfile(zip,wbrelsfile)||(wbrelsfile="xl/_rels/workbook."+wbext+".rels");var wbrels=parse_rels(getzipstr(zip,wbrelsfile,!0),wbrelsfile.replace(/_rels.*/,"s5s"));(dir.metadata||[]).length>=1&&(opts.xlmeta=parse_xlmeta(getzipdata(zip,strip_front_slash(dir.metadata[0])),dir.metadata[0],opts)),(dir.people||[]).length>=1&&(opts.people=parse_people_xml(getzipdata(zip,strip_front_slash(dir.people[0])),opts)),wbrels&&(wbrels=safe_parse_wbrels(wbrels,wb.Sheets));var nmode=getzipdata(zip,"xl/worksheets/sheet.xml",!0)?1:0;wsloop:for(i=0;i!=props.Worksheets;++i){var stype="sheet";if(wbrels&&wbrels[i]?(path="xl/"+wbrels[i][1].replace(/[\/]?xl\//,""),safegetzipfile(zip,path)||(path=wbrels[i][1]),safegetzipfile(zip,path)||(path=wbrelsfile.replace(/_rels\/.*$/,"")+wbrels[i][1]),stype=wbrels[i][2]):(path="xl/worksheets/sheet"+(i+1-nmode)+"."+wbext,path=path.replace(/sheet0\./,"sheet.")),relsPath=path.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),opts&&opts.sheets!=null)switch(typeof opts.sheets){case"number":if(i!=opts.sheets)continue wsloop;break;case"string":if(props.SheetNames[i].toLowerCase()!=opts.sheets.toLowerCase())continue wsloop;break;default:if(Array.isArray&&Array.isArray(opts.sheets)){for(var snjseen=!1,snj=0;snj!=opts.sheets.length;++snj)typeof opts.sheets[snj]=="number"&&opts.sheets[snj]==i&&(snjseen=1),typeof opts.sheets[snj]=="string"&&opts.sheets[snj].toLowerCase()==props.SheetNames[i].toLowerCase()&&(snjseen=1);if(!snjseen)continue wsloop}}safe_parse_sheet(zip,path,relsPath,props.SheetNames[i],i,sheetRels,sheets,stype,opts,wb,themes,styles)}return out={Directory:dir,Workbook:wb,Props:props,Custprops:custprops,Deps:deps,Sheets:sheets,SheetNames:props.SheetNames,Strings:strs,Styles:styles,Themes:themes,SSF:dup(table_fmt)},opts&&opts.bookFiles&&(zip.files?(out.keys=entries,out.files=zip.files):(out.keys=[],out.files={},zip.FullPaths.forEach(function(p,idx){p=p.replace(/^Root Entry[\/]/,""),out.keys.push(p),out.files[p]=zip.FileIndex[idx]}))),opts&&opts.bookVBA&&(dir.vba.length>0?out.vbaraw=getzipdata(zip,strip_front_slash(dir.vba[0]),!0):dir.defaults&&dir.defaults.bin===CT_VBA&&(out.vbaraw=getzipdata(zip,"xl/vbaProject.bin",!0))),out}function parse_xlsxcfb(cfb,_opts){var opts=_opts||{},f="Workbook",data=CFB.find(cfb,f);try{if(f="/!DataSpaces/Version",data=CFB.find(cfb,f),!data||!data.content)throw new Error("ECMA-376 Encrypted file missing "+f);if(parse_DataSpaceVersionInfo(data.content),f="/!DataSpaces/DataSpaceMap",data=CFB.find(cfb,f),!data||!data.content)throw new Error("ECMA-376 Encrypted file missing "+f);var dsm=parse_DataSpaceMap(data.content);if(dsm.length!==1||dsm[0].comps.length!==1||dsm[0].comps[0].t!==0||dsm[0].name!=="StrongEncryptionDataSpace"||dsm[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+f);if(f="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",data=CFB.find(cfb,f),!data||!data.content)throw new Error("ECMA-376 Encrypted file missing "+f);var seds=parse_DataSpaceDefinition(data.content);if(seds.length!=1||seds[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+f);if(f="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",data=CFB.find(cfb,f),!data||!data.content)throw new Error("ECMA-376 Encrypted file missing "+f);parse_Primary(data.content)}catch(e){}if(f="/EncryptionInfo",data=CFB.find(cfb,f),!data||!data.content)throw new Error("ECMA-376 Encrypted file missing "+f);var einfo=parse_EncryptionInfo(data.content);if(f="/EncryptedPackage",data=CFB.find(cfb,f),!data||!data.content)throw new Error("ECMA-376 Encrypted file missing "+f);if(einfo[0]==4&&typeof decrypt_agile!="undefined")return decrypt_agile(einfo[1],data.content,opts.password||"",opts);if(einfo[0]==2&&typeof decrypt_std76!="undefined")return decrypt_std76(einfo[1],data.content,opts.password||"",opts);throw new Error("File is password-protected")}function firstbyte(f,o){var x="";switch((o||{}).type||"base64"){case"buffer":return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]];case"base64":x=Base64_decode(f.slice(0,12));break;case"binary":x=f;break;case"array":return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]];default:throw new Error("Unrecognized type "+(o&&o.type||"undefined"))}return[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3),x.charCodeAt(4),x.charCodeAt(5),x.charCodeAt(6),x.charCodeAt(7)]}function read_cfb(cfb,opts){return CFB.find(cfb,"EncryptedPackage")?parse_xlsxcfb(cfb,opts):parse_xlscfb(cfb,opts)}function read_zip(data,opts){var zip,d=data,o=opts||{};return o.type||(o.type=has_buf&&Buffer.isBuffer(data)?"buffer":"base64"),zip=zip_read(d,o),parse_zip(zip,o)}function read_plaintext(data,o){var i=0;main:for(;i<data.length;)switch(data.charCodeAt(i)){case 10:case 13:case 32:++i;break;case 60:return parse_xlml(data.slice(i),o);default:break main}return PRN.to_workbook(data,o)}function read_plaintext_raw(data,o){var str="",bytes=firstbyte(data,o);switch(o.type){case"base64":str=Base64_decode(data);break;case"binary":str=data;break;case"buffer":str=data.toString("binary");break;case"array":str=cc2str(data);break;default:throw new Error("Unrecognized type "+o.type)}return bytes[0]==239&&bytes[1]==187&&bytes[2]==191&&(str=utf8read(str)),o.type="binary",read_plaintext(str,o)}function read_utf16(data,o){var d=data;return o.type=="base64"&&(d=Base64_decode(d)),d=$cptable.utils.decode(1200,d.slice(2),"str"),o.type="binary",read_plaintext(d,o)}function bstrify(data){return data.match(/[^\x00-\x7F]/)?utf8write(data):data}function read_prn(data,d,o,str){return str?(o.type="string",PRN.to_workbook(data,o)):PRN.to_workbook(d,o)}function readSync(data,opts){reset_cp();var o=opts||{};if(typeof ArrayBuffer!="undefined"&&data instanceof ArrayBuffer)return readSync(new Uint8Array(data),(o=dup(o),o.type="array",o));typeof Uint8Array!="undefined"&&data instanceof Uint8Array&&!o.type&&(o.type=typeof Deno!="undefined"?"buffer":"array");var d=data,n=[0,0,0,0],str=!1;if(o.cellStyles&&(o.cellNF=!0,o.sheetStubs=!0),_ssfopts={},o.dateNF&&(_ssfopts.dateNF=o.dateNF),o.type||(o.type=has_buf&&Buffer.isBuffer(data)?"buffer":"base64"),o.type=="file"&&(o.type=has_buf?"buffer":"binary",d=read_binary(data),typeof Uint8Array!="undefined"&&!has_buf&&(o.type="array")),o.type=="string"&&(str=!0,o.type="binary",o.codepage=65001,d=bstrify(data)),o.type=="array"&&typeof Uint8Array!="undefined"&&data instanceof Uint8Array&&typeof ArrayBuffer!="undefined"){var ab=new ArrayBuffer(3),vu=new Uint8Array(ab);if(vu.foo="bar",!vu.foo)return o=dup(o),o.type="array",readSync(ab2a(d),o)}switch((n=firstbyte(d,o))[0]){case 208:if(n[1]===207&&n[2]===17&&n[3]===224&&n[4]===161&&n[5]===177&&n[6]===26&&n[7]===225)return read_cfb(CFB.read(d,o),o);break;case 9:if(n[1]<=8)return parse_xlscfb(d,o);break;case 60:return parse_xlml(d,o);case 73:if(n[1]===73&&n[2]===42&&n[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(n[1]===68)return read_wb_ID(d,o);break;case 84:if(n[1]===65&&n[2]===66&&n[3]===76)return DIF.to_workbook(d,o);break;case 80:return n[1]===75&&n[2]<9&&n[3]<9?read_zip(d,o):read_prn(data,d,o,str);case 239:return n[3]===60?parse_xlml(d,o):read_prn(data,d,o,str);case 255:if(n[1]===254)return read_utf16(d,o);if(n[1]===0&&n[2]===2&&n[3]===0)return WK_.to_workbook(d,o);break;case 0:if(n[1]===0&&(n[2]>=2&&n[3]===0||n[2]===0&&(n[3]===8||n[3]===9)))return WK_.to_workbook(d,o);break;case 3:case 131:case 139:case 140:return DBF.to_workbook(d,o);case 123:if(n[1]===92&&n[2]===114&&n[3]===116)return RTF.to_workbook(d,o);break;case 10:case 13:case 32:return read_plaintext_raw(d,o);case 137:if(n[1]===80&&n[2]===78&&n[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return DBF_SUPPORTED_VERSIONS.indexOf(n[0])>-1&&n[2]<=12&&n[3]<=31?DBF.to_workbook(d,o):read_prn(data,d,o,str)}function make_json_row(sheet,r,R,cols,header,hdr,dense,o){var rr=encode_row(R),defval=o.defval,raw=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),isempty=!0,row=header===1?[]:{};if(header!==1)if(Object.defineProperty)try{Object.defineProperty(row,"__rowNum__",{value:R,enumerable:!1})}catch(e){row.__rowNum__=R}else row.__rowNum__=R;if(!dense||sheet[R])for(var C=r.s.c;C<=r.e.c;++C){var val=dense?sheet[R][C]:sheet[cols[C]+rr];if(val===void 0||val.t===void 0){if(defval===void 0)continue;hdr[C]!=null&&(row[hdr[C]]=defval);continue}var v=val.v;switch(val.t){case"z":if(v==null)break;continue;case"e":v=v==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+val.t)}if(hdr[C]!=null){if(v==null)if(val.t=="e"&&v===null)row[hdr[C]]=null;else if(defval!==void 0)row[hdr[C]]=defval;else if(raw&&v===null)row[hdr[C]]=null;else continue;else row[hdr[C]]=raw&&(val.t!=="n"||val.t==="n"&&o.rawNumbers!==!1)?v:format_cell(val,v,o);v!=null&&(isempty=!1)}}return{row,isempty}}function sheet_to_json(sheet,opts){if(sheet==null||sheet["!ref"]==null)return[];var val={t:"n",v:0},header=0,offset=1,hdr=[],v=0,vv="",r={s:{r:0,c:0},e:{r:0,c:0}},o=opts||{},range3=o.range!=null?o.range:sheet["!ref"];switch(o.header===1?header=1:o.header==="A"?header=2:Array.isArray(o.header)?header=3:o.header==null&&(header=0),typeof range3){case"string":r=safe_decode_range(range3);break;case"number":r=safe_decode_range(sheet["!ref"]),r.s.r=range3;break;default:r=range3}header>0&&(offset=0);var rr=encode_row(r.s.r),cols=[],out=[],outi=0,counter=0,dense=Array.isArray(sheet),R=r.s.r,C=0,header_cnt={};dense&&!sheet[R]&&(sheet[R]=[]);var colinfo=o.skipHidden&&sheet["!cols"]||[],rowinfo=o.skipHidden&&sheet["!rows"]||[];for(C=r.s.c;C<=r.e.c;++C)if(!(colinfo[C]||{}).hidden)switch(cols[C]=encode_col(C),val=dense?sheet[R][C]:sheet[cols[C]+rr],header){case 1:hdr[C]=C-r.s.c;break;case 2:hdr[C]=cols[C];break;case 3:hdr[C]=o.header[C-r.s.c];break;default:if(val==null&&(val={w:"__EMPTY",t:"s"}),vv=v=format_cell(val,null,o),counter=header_cnt[v]||0,!counter)header_cnt[v]=1;else{do vv=v+"_"+counter++;while(header_cnt[vv]);header_cnt[v]=counter,header_cnt[vv]=1}hdr[C]=vv}for(R=r.s.r+offset;R<=r.e.r;++R)if(!(rowinfo[R]||{}).hidden){var row=make_json_row(sheet,r,R,cols,header,hdr,dense,o);(row.isempty===!1||(header===1?o.blankrows!==!1:!!o.blankrows))&&(out[outi++]=row.row)}return out.length=outi,out}var qreg=/"/g;function make_csv_row(sheet,r,R,cols,fs,rs,FS,o){for(var isempty=!0,row=[],txt="",rr=encode_row(R),C=r.s.c;C<=r.e.c;++C)if(!!cols[C]){var val=o.dense?(sheet[R]||[])[C]:sheet[cols[C]+rr];if(val==null)txt="";else if(val.v!=null){isempty=!1,txt=""+(o.rawNumbers&&val.t=="n"?val.v:format_cell(val,null,o));for(var i=0,cc=0;i!==txt.length;++i)if((cc=txt.charCodeAt(i))===fs||cc===rs||cc===34||o.forceQuotes){txt='"'+txt.replace(qreg,'""')+'"';break}txt=="ID"&&(txt='"ID"')}else val.f!=null&&!val.F?(isempty=!1,txt="="+val.f,txt.indexOf(",")>=0&&(txt='"'+txt.replace(qreg,'""')+'"')):txt="";row.push(txt)}return o.blankrows===!1&&isempty?null:row.join(FS)}function sheet_to_csv(sheet,opts){var out=[],o=opts==null?{}:opts;if(sheet==null||sheet["!ref"]==null)return"";var r=safe_decode_range(sheet["!ref"]),FS=o.FS!==void 0?o.FS:",",fs=FS.charCodeAt(0),RS=o.RS!==void 0?o.RS:`
`,rs=RS.charCodeAt(0),endregex=new RegExp((FS=="|"?"\\|":FS)+"+$"),row="",cols=[];o.dense=Array.isArray(sheet);for(var colinfo=o.skipHidden&&sheet["!cols"]||[],rowinfo=o.skipHidden&&sheet["!rows"]||[],C=r.s.c;C<=r.e.c;++C)(colinfo[C]||{}).hidden||(cols[C]=encode_col(C));for(var w=0,R=r.s.r;R<=r.e.r;++R)(rowinfo[R]||{}).hidden||(row=make_csv_row(sheet,r,R,cols,fs,rs,FS,o),row!=null&&(o.strip&&(row=row.replace(endregex,"")),(row||o.blankrows!==!1)&&out.push((w++?RS:"")+row)));return delete o.dense,out.join("")}function sheet_to_txt(sheet,opts){opts||(opts={}),opts.FS="	",opts.RS=`
`;var s=sheet_to_csv(sheet,opts);if(typeof $cptable=="undefined"||opts.type=="string")return s;var o=$cptable.utils.encode(1200,s,"str");return String.fromCharCode(255)+String.fromCharCode(254)+o}function sheet_to_formulae(sheet){var y="",x,val="";if(sheet==null||sheet["!ref"]==null)return[];var r=safe_decode_range(sheet["!ref"]),rr="",cols=[],C,cmds=[],dense=Array.isArray(sheet);for(C=r.s.c;C<=r.e.c;++C)cols[C]=encode_col(C);for(var R=r.s.r;R<=r.e.r;++R)for(rr=encode_row(R),C=r.s.c;C<=r.e.c;++C)if(y=cols[C]+rr,x=dense?(sheet[R]||[])[C]:sheet[y],val="",x!==void 0){if(x.F!=null){if(y=x.F,!x.f)continue;val=x.f,y.indexOf(":")==-1&&(y=y+":"+y)}if(x.f!=null)val=x.f;else{if(x.t=="z")continue;if(x.t=="n"&&x.v!=null)val=""+x.v;else if(x.t=="b")val=x.v?"TRUE":"FALSE";else if(x.w!==void 0)val="'"+x.w;else{if(x.v===void 0)continue;x.t=="s"?val="'"+x.v:val=""+x.v}}cmds[cmds.length]=y+"="+val}return cmds}function sheet_add_json(_ws,js,opts){var o=opts||{},offset=+!o.skipHeader,ws=_ws||{},_R=0,_C=0;if(ws&&o.origin!=null)if(typeof o.origin=="number")_R=o.origin;else{var _origin=typeof o.origin=="string"?decode_cell(o.origin):o.origin;_R=_origin.r,_C=_origin.c}var cell,range3={s:{c:0,r:0},e:{c:_C,r:_R+js.length-1+offset}};if(ws["!ref"]){var _range=safe_decode_range(ws["!ref"]);range3.e.c=Math.max(range3.e.c,_range.e.c),range3.e.r=Math.max(range3.e.r,_range.e.r),_R==-1&&(_R=_range.e.r+1,range3.e.r=_R+js.length-1+offset)}else _R==-1&&(_R=0,range3.e.r=js.length-1+offset);var hdr=o.header||[],C=0;js.forEach(function(JS,R){keys(JS).forEach(function(k){(C=hdr.indexOf(k))==-1&&(hdr[C=hdr.length]=k);var v=JS[k],t="z",z="",ref=encode_cell({c:_C+C,r:_R+R+offset});cell=ws_get_cell_stub(ws,ref),v&&typeof v=="object"&&!(v instanceof Date)?ws[ref]=v:(typeof v=="number"?t="n":typeof v=="boolean"?t="b":typeof v=="string"?t="s":v instanceof Date?(t="d",o.cellDates||(t="n",v=datenum(v)),z=o.dateNF||table_fmt[14]):v===null&&o.nullError&&(t="e",v=0),cell?(cell.t=t,cell.v=v,delete cell.w,delete cell.R,z&&(cell.z=z)):ws[ref]=cell={t,v},z&&(cell.z=z))})}),range3.e.c=Math.max(range3.e.c,_C+hdr.length-1);var __R=encode_row(_R);if(offset)for(C=0;C<hdr.length;++C)ws[encode_col(C+_C)+__R]={t:"s",v:hdr[C]};return ws["!ref"]=encode_range(range3),ws}function json_to_sheet(js,opts){return sheet_add_json(null,js,opts)}function ws_get_cell_stub(ws,R,C){if(typeof R=="string"){if(Array.isArray(ws)){var RC=decode_cell(R);return ws[RC.r]||(ws[RC.r]=[]),ws[RC.r][RC.c]||(ws[RC.r][RC.c]={t:"z"})}return ws[R]||(ws[R]={t:"z"})}return typeof R!="number"?ws_get_cell_stub(ws,encode_cell(R)):ws_get_cell_stub(ws,encode_cell({r:R,c:C||0}))}function wb_sheet_idx(wb,sh){if(typeof sh=="number"){if(sh>=0&&wb.SheetNames.length>sh)return sh;throw new Error("Cannot find sheet # "+sh)}else if(typeof sh=="string"){var idx=wb.SheetNames.indexOf(sh);if(idx>-1)return idx;throw new Error("Cannot find sheet name |"+sh+"|")}else throw new Error("Cannot find sheet |"+sh+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(wb,ws,name,roll){var i=1;if(!name)for(;i<=65535&&wb.SheetNames.indexOf(name="Sheet"+i)!=-1;++i,name=void 0);if(!name||wb.SheetNames.length>=65535)throw new Error("Too many worksheets");if(roll&&wb.SheetNames.indexOf(name)>=0){var m=name.match(/(^.*?)(\d+)$/);i=m&&+m[2]||0;var root=m&&m[1]||name;for(++i;i<=65535&&wb.SheetNames.indexOf(name=root+i)!=-1;++i);}if(check_ws_name(name),wb.SheetNames.indexOf(name)>=0)throw new Error("Worksheet with name |"+name+"| already exists!");return wb.SheetNames.push(name),wb.Sheets[name]=ws,name}function book_set_sheet_visibility(wb,sh,vis){wb.Workbook||(wb.Workbook={}),wb.Workbook.Sheets||(wb.Workbook.Sheets=[]);var idx=wb_sheet_idx(wb,sh);switch(wb.Workbook.Sheets[idx]||(wb.Workbook.Sheets[idx]={}),vis){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+vis)}wb.Workbook.Sheets[idx].Hidden=vis}function cell_set_number_format(cell,fmt){return cell.z=fmt,cell}function cell_set_hyperlink(cell,target,tooltip){return target?(cell.l={Target:target},tooltip&&(cell.l.Tooltip=tooltip)):delete cell.l,cell}function cell_set_internal_link(cell,range3,tooltip){return cell_set_hyperlink(cell,"#"+range3,tooltip)}function cell_add_comment(cell,text,author){cell.c||(cell.c=[]),cell.c.push({t:text,a:author||"SheetJS"})}function sheet_set_array_formula(ws,range3,formula,dynamic){for(var rng=typeof range3!="string"?range3:safe_decode_range(range3),rngstr=typeof range3=="string"?range3:encode_range(range3),R=rng.s.r;R<=rng.e.r;++R)for(var C=rng.s.c;C<=rng.e.c;++C){var cell=ws_get_cell_stub(ws,R,C);cell.t="n",cell.F=rngstr,delete cell.v,R==rng.s.r&&C==rng.s.c&&(cell.f=formula,dynamic&&(cell.D=!0))}return ws}var utils={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};var version=XLSX.version;var ExperimentHandler=class extends PsychObject{get experimentEnded(){return this._experimentEnded}set experimentEnded(ended){this._experimentEnded=ended}get _thisEntry(){return this._currentTrialData}get _entries(){return this._trialsData}constructor({psychoJS,name,extraInfo,dataFileName}={}){super(psychoJS,name);this._addAttribute("extraInfo",extraInfo),this._experimentName=typeof extraInfo.expName=="string"&&extraInfo.expName.length>0?extraInfo.expName:this.psychoJS.config.experiment.name,this._participant=typeof extraInfo.participant=="string"&&extraInfo.participant.length>0?extraInfo.participant:"PARTICIPANT",this._session=typeof extraInfo.session=="string"&&extraInfo.session.length>0?extraInfo.session:"SESSION",this._datetime=typeof extraInfo.date!="undefined"?extraInfo.date:MonotonicClock.getDateStr(),this._addAttribute("dataFileName",dataFileName,`${this._participant}_${this._experimentName}_${this._datetime}`),this._loops=[],this._unfinishedLoops=[],this._trialsKeys=[],this._trialsData=[],this._currentTrialData={},this._experimentEnded=!1}isEntryEmpty(){return Object.keys(this._currentTrialData).length>0}addLoop(loop){this._loops.push(loop),this._unfinishedLoops.push(loop),loop.experimentHandler=this}removeLoop(loop){let index3=this._unfinishedLoops.indexOf(loop);index3!==-1&&this._unfinishedLoops.splice(index3,1)}addData(key,value){this._trialsKeys.indexOf(key)===-1&&this._trialsKeys.push(key),Array.isArray(value)&&(value=JSON.stringify(value)),this._currentTrialData[key]=value}nextEntry(snapshots){if(typeof snapshots!="undefined"){Array.isArray(snapshots)||(snapshots=[snapshots]);for(let snapshot of snapshots){let attributes=ExperimentHandler._getLoopAttributes(snapshot);for(let a in attributes)attributes.hasOwnProperty(a)&&(this._currentTrialData[a]=attributes[a])}}else for(let loop of this._unfinishedLoops){let attributes=ExperimentHandler._getLoopAttributes(loop);for(let a in attributes)attributes.hasOwnProperty(a)&&(this._currentTrialData[a]=attributes[a])}for(let a in this.extraInfo)this.extraInfo.hasOwnProperty(a)&&(this._currentTrialData[a]=this.extraInfo[a]);this._trialsData.push(this._currentTrialData),this._currentTrialData={}}async save({attributes=[],sync=!1,tag="",clear=!1}={}){if(this._psychoJS.logger.info("[PsychoJS] Save experiment results."),attributes.length===0){attributes=this._trialsKeys.slice();for(let l=0;l<this._loops.length;l++){let loop=this._loops[l],loopAttributes=ExperimentHandler._getLoopAttributes(loop);for(let a in loopAttributes)loopAttributes.hasOwnProperty(a)&&attributes.push(a)}for(let a in this.extraInfo)this.extraInfo.hasOwnProperty(a)&&attributes.push(a)}let data=this._trialsData;if(clear&&(data=this._trialsData.slice(),this._trialsData=[]),this._psychoJS.config.experiment.saveFormat===ExperimentHandler.SaveFormat.CSV){let worksheet=utils.json_to_sheet(data),csv="\uFEFF"+utils.sheet_to_csv(worksheet),key=`${this._dataFileName.split(/[\\/]/).pop()}${tag}.csv`;if(this._psychoJS.getEnvironment()===ExperimentHandler.Environment.SERVER&&this._psychoJS.config.experiment.status==="RUNNING"&&!this._psychoJS._serverMsg.has("__pilotToken"))return this._psychoJS.serverManager.uploadData(key,csv,sync);offerDataForDownload(key,csv,"text/csv")}else if(this._psychoJS.config.experiment.saveFormat===ExperimentHandler.SaveFormat.DATABASE){let gitlabConfig=this._psychoJS.config.gitlab,__projectId=typeof gitlabConfig!="undefined"&&typeof gitlabConfig.projectId!="undefined"?gitlabConfig.projectId:void 0,documents=[];for(let r=0;r<data.length;r++){let doc={__projectId,__experimentName:this._experimentName,__participant:this._participant,__session:this._session,__datetime:this._datetime};for(let h=0;h<attributes.length;h++)doc[attributes[h]]=data[r][attributes[h]];documents.push(doc)}if(this._psychoJS.getEnvironment()===ExperimentHandler.Environment.SERVER&&this._psychoJS.config.experiment.status==="RUNNING"&&!this._psychoJS._serverMsg.has("__pilotToken")){let key="results";return this._psychoJS.serverManager.uploadData(key,JSON.stringify(documents),sync)}else offerDataForDownload("results.json",JSON.stringify(documents),"application/json")}}getResultAsCsv(){let worksheet=utils.json_to_sheet(this._trialsData);return"\uFEFF"+utils.sheet_to_csv(worksheet)}static _getLoopAttributes(loop){let properties=["thisRepN","thisTrialN","thisN","thisIndex","stepSizeCurrent","ran","order"],attributes={},loopName=loop.name;for(let loopProperty in loop)if(properties.includes(loopProperty)){let key=loopProperty==="stepSizeCurrent"?loopName+".stepSize":loopName+"."+loopProperty;attributes[key]=loop[loopProperty]}if(typeof loop.getCurrentTrial=="function"){let currentTrial=loop.getCurrentTrial();for(let trialProperty in currentTrial)attributes[trialProperty]=currentTrial[trialProperty]}return attributes}};ExperimentHandler.SaveFormat={CSV:Symbol.for("CSV"),DATABASE:Symbol.for("DATABASE")};ExperimentHandler.Environment={SERVER:Symbol.for("SERVER"),LOCAL:Symbol.for("LOCAL")};var esm_exports={};__export(esm_exports,{AMOscillator:()=>AMOscillator,AMSynth:()=>AMSynth,Abs:()=>Abs,Add:()=>Add,AmplitudeEnvelope:()=>AmplitudeEnvelope,Analyser:()=>Analyser,AudioToGain:()=>AudioToGain,AutoFilter:()=>AutoFilter,AutoPanner:()=>AutoPanner,AutoWah:()=>AutoWah,BaseContext:()=>BaseContext,BiquadFilter:()=>BiquadFilter,BitCrusher:()=>BitCrusher,Buffer:()=>Buffer4,BufferSource:()=>BufferSource,Buffers:()=>Buffers,Channel:()=>Channel,Chebyshev:()=>Chebyshev,Chorus:()=>Chorus,Clock:()=>Clock2,Compressor:()=>Compressor,Context:()=>Context,Convolver:()=>Convolver,CrossFade:()=>CrossFade,DCMeter:()=>DCMeter,Delay:()=>Delay,Destination:()=>Destination2,Distortion:()=>Distortion,Draw:()=>Draw2,DuoSynth:()=>DuoSynth,EQ3:()=>EQ3,Emitter:()=>Emitter,Envelope:()=>Envelope,FFT:()=>FFT,FMOscillator:()=>FMOscillator,FMSynth:()=>FMSynth,FatOscillator:()=>FatOscillator,FeedbackCombFilter:()=>FeedbackCombFilter,FeedbackDelay:()=>FeedbackDelay,Filter:()=>Filter3,Follower:()=>Follower,Freeverb:()=>Freeverb,Frequency:()=>Frequency,FrequencyClass:()=>FrequencyClass,FrequencyEnvelope:()=>FrequencyEnvelope,FrequencyShifter:()=>FrequencyShifter,Gain:()=>Gain,GainToAudio:()=>GainToAudio,Gate:()=>Gate,GrainPlayer:()=>GrainPlayer,GreaterThan:()=>GreaterThan,GreaterThanZero:()=>GreaterThanZero,IntervalTimeline:()=>IntervalTimeline,JCReverb:()=>JCReverb,LFO:()=>LFO,Limiter:()=>Limiter,Listener:()=>Listener2,Loop:()=>Loop,LowpassCombFilter:()=>LowpassCombFilter,Master:()=>Master,MembraneSynth:()=>MembraneSynth,Merge:()=>Merge,MetalSynth:()=>MetalSynth,Meter:()=>Meter,MidSideCompressor:()=>MidSideCompressor,MidSideMerge:()=>MidSideMerge,MidSideSplit:()=>MidSideSplit,Midi:()=>Midi,MidiClass:()=>MidiClass,Mono:()=>Mono,MonoSynth:()=>MonoSynth,MultibandCompressor:()=>MultibandCompressor,MultibandSplit:()=>MultibandSplit,Multiply:()=>Multiply,Negate:()=>Negate,Noise:()=>Noise,NoiseSynth:()=>NoiseSynth,Offline:()=>Offline,OfflineContext:()=>OfflineContext,OmniOscillator:()=>OmniOscillator,OnePoleFilter:()=>OnePoleFilter,Oscillator:()=>Oscillator,PWMOscillator:()=>PWMOscillator,PanVol:()=>PanVol,Panner:()=>Panner,Panner3D:()=>Panner3D,Param:()=>Param,Part:()=>Part,Pattern:()=>Pattern,Phaser:()=>Phaser,PingPongDelay:()=>PingPongDelay,PitchShift:()=>PitchShift,Player:()=>Player,Players:()=>Players,PluckSynth:()=>PluckSynth,PolySynth:()=>PolySynth,Pow:()=>Pow,PulseOscillator:()=>PulseOscillator,Recorder:()=>Recorder,Reverb:()=>Reverb,Sampler:()=>Sampler,Scale:()=>Scale,ScaleExp:()=>ScaleExp,Sequence:()=>Sequence,Signal:()=>Signal2,Solo:()=>Solo,Split:()=>Split,StateTimeline:()=>StateTimeline,StereoWidener:()=>StereoWidener,Subtract:()=>Subtract,SyncedSignal:()=>SyncedSignal,Synth:()=>Synth,Ticks:()=>Ticks,TicksClass:()=>TicksClass,Time:()=>Time,TimeClass:()=>TimeClass,Timeline:()=>Timeline,ToneAudioBuffer:()=>ToneAudioBuffer,ToneAudioBuffers:()=>ToneAudioBuffers,ToneAudioNode:()=>ToneAudioNode,ToneBufferSource:()=>ToneBufferSource,ToneEvent:()=>ToneEvent,ToneOscillatorNode:()=>ToneOscillatorNode,Transport:()=>Transport2,TransportTime:()=>TransportTime,TransportTimeClass:()=>TransportTimeClass,Tremolo:()=>Tremolo,Unit:()=>Units_exports,UserMedia:()=>UserMedia,Vibrato:()=>Vibrato,Volume:()=>Volume,WaveShaper:()=>WaveShaper,Waveform:()=>Waveform,Zero:()=>Zero,connect:()=>connect,connectSeries:()=>connectSeries,connectSignal:()=>connectSignal,context:()=>context3,dbToGain:()=>dbToGain,debug:()=>Debug_exports,defaultArg:()=>defaultArg,disconnect:()=>disconnect,ftom:()=>ftom,gainToDb:()=>gainToDb,getContext:()=>getContext,getDestination:()=>getDestination,getDraw:()=>getDraw,getListener:()=>getListener,getTransport:()=>getTransport,immediate:()=>immediate,intervalToFrequencyRatio:()=>intervalToFrequencyRatio,isArray:()=>isArray2,isBoolean:()=>isBoolean,isDefined:()=>isDefined,isFunction:()=>isFunction,isNote:()=>isNote,isNumber:()=>isNumber,isObject:()=>isObject,isString:()=>isString,isUndef:()=>isUndef,loaded:()=>loaded,mtof:()=>mtof,now:()=>now,optionsFromArguments:()=>optionsFromArguments,setContext:()=>setContext,start:()=>start,supported:()=>isSupported,version:()=>version2});var version2="14.7.77";var import_automation_events2=__toModule(require_bundle());var createAbortError=()=>new DOMException("","AbortError");var createAddActiveInputConnectionToAudioNode=insertElementInSet2=>(activeInputs,source,[output,input,eventListener],ignoreDuplicates)=>{insertElementInSet2(activeInputs[input],[source,output,eventListener],activeInputConnection=>activeInputConnection[0]===source&&activeInputConnection[1]===output,ignoreDuplicates)};var createAddAudioNodeConnections=audioNodeConnectionsStore=>(audioNode,audioNodeRenderer,nativeAudioNode)=>{let activeInputs=[];for(let i=0;i<nativeAudioNode.numberOfInputs;i+=1)activeInputs.push(new Set);audioNodeConnectionsStore.set(audioNode,{activeInputs,outputs:new Set,passiveInputs:new WeakMap,renderer:audioNodeRenderer})};var createAddAudioParamConnections=audioParamConnectionsStore=>(audioParam,audioParamRenderer)=>{audioParamConnectionsStore.set(audioParam,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:audioParamRenderer})};var ACTIVE_AUDIO_NODE_STORE=new WeakSet,AUDIO_NODE_CONNECTIONS_STORE=new WeakMap,AUDIO_NODE_STORE=new WeakMap,AUDIO_PARAM_CONNECTIONS_STORE=new WeakMap,AUDIO_PARAM_STORE=new WeakMap,CONTEXT_STORE=new WeakMap,EVENT_LISTENERS=new WeakMap,CYCLE_COUNTERS=new WeakMap,NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=new WeakMap,NODE_TO_PROCESSOR_MAPS=new WeakMap;var handler={construct(){return handler}},isConstructible=constructible=>{try{let proxy=new Proxy(constructible,handler);new proxy}catch(e){return!1}return!0};var IMPORT_STATEMENT_REGEX=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,splitImportStatements=(source,url3)=>{let importStatements=[],sourceWithoutImportStatements=source.replace(/^[\s]+/,""),result=sourceWithoutImportStatements.match(IMPORT_STATEMENT_REGEX);for(;result!==null;){let unresolvedUrl=result[1].slice(1,-1),importStatementWithResolvedUrl=result[0].replace(/([\s]+)?;?$/,"").replace(unresolvedUrl,new URL(unresolvedUrl,url3).toString());importStatements.push(importStatementWithResolvedUrl),sourceWithoutImportStatements=sourceWithoutImportStatements.slice(result[0].length).replace(/^[\s]+/,""),result=sourceWithoutImportStatements.match(IMPORT_STATEMENT_REGEX)}return[importStatements.join(";"),sourceWithoutImportStatements]};var verifyParameterDescriptors=parameterDescriptors=>{if(parameterDescriptors!==void 0&&!Array.isArray(parameterDescriptors))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},verifyProcessorCtor=processorCtor=>{if(!isConstructible(processorCtor))throw new TypeError("The given value for processorCtor should be a constructor.");if(processorCtor.prototype===null||typeof processorCtor.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},createAddAudioWorkletModule=(cacheTestResult2,createNotSupportedError2,evaluateSource,exposeCurrentFrameAndCurrentTime2,fetchSource,getNativeContext2,getOrCreateBackupOfflineAudioContext2,isNativeOfflineAudioContext2,ongoingRequests,resolvedRequests,testAudioWorkletProcessorPostMessageSupport,window3)=>(context4,moduleURL,options={credentials:"omit"})=>{let nativeContext=getNativeContext2(context4);if(nativeContext.audioWorklet!==void 0)return Promise.all([fetchSource(moduleURL),Promise.resolve(cacheTestResult2(testAudioWorkletProcessorPostMessageSupport,testAudioWorkletProcessorPostMessageSupport))]).then(([[source,absoluteUrl],isSupportingPostMessage])=>{let[importStatements,sourceWithoutImportStatements]=splitImportStatements(source,absoluteUrl),wrappedSource=`${importStatements};((AudioWorkletProcessor,registerProcessor)=>{${sourceWithoutImportStatements}
})(${isSupportingPostMessage?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${isSupportingPostMessage?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${isSupportingPostMessage?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac',class extends AudioWorkletProcessor{process(){return !1}})`,blob=new Blob([wrappedSource],{type:"application/javascript; charset=utf-8"}),url3=URL.createObjectURL(blob);return nativeContext.audioWorklet.addModule(url3,options).then(()=>{if(isNativeOfflineAudioContext2(nativeContext))return nativeContext;let backupOfflineAudioContext=getOrCreateBackupOfflineAudioContext2(nativeContext);return backupOfflineAudioContext.audioWorklet.addModule(url3,options).then(()=>backupOfflineAudioContext)}).then(nativeContextOrBackupOfflineAudioContext=>{try{new AudioWorkletNode(nativeContextOrBackupOfflineAudioContext,"__sac")}catch(e){throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(url3))});let resolvedRequestsOfContext=resolvedRequests.get(context4);if(resolvedRequestsOfContext!==void 0&&resolvedRequestsOfContext.has(moduleURL))return Promise.resolve();let ongoingRequestsOfContext=ongoingRequests.get(context4);if(ongoingRequestsOfContext!==void 0){let promiseOfOngoingRequest=ongoingRequestsOfContext.get(moduleURL);if(promiseOfOngoingRequest!==void 0)return promiseOfOngoingRequest}let promise=fetchSource(moduleURL).then(([source,absoluteUrl])=>{let[importStatements,sourceWithoutImportStatements]=splitImportStatements(source,absoluteUrl),wrappedSource=`${importStatements};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${sourceWithoutImportStatements}
})})(window,'_AWGS')`;return evaluateSource(wrappedSource)}).then(()=>{let evaluateAudioWorkletGlobalScope=window3._AWGS.pop();if(evaluateAudioWorkletGlobalScope===void 0)throw new SyntaxError;exposeCurrentFrameAndCurrentTime2(nativeContext.currentTime,nativeContext.sampleRate,()=>evaluateAudioWorkletGlobalScope(class{},void 0,(name,processorCtor)=>{if(name.trim()==="")throw createNotSupportedError2();let nodeNameToProcessorConstructorMap=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(nativeContext);if(nodeNameToProcessorConstructorMap!==void 0){if(nodeNameToProcessorConstructorMap.has(name))throw createNotSupportedError2();verifyProcessorCtor(processorCtor),verifyParameterDescriptors(processorCtor.parameterDescriptors),nodeNameToProcessorConstructorMap.set(name,processorCtor)}else verifyProcessorCtor(processorCtor),verifyParameterDescriptors(processorCtor.parameterDescriptors),NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(nativeContext,new Map([[name,processorCtor]]))},nativeContext.sampleRate,void 0,void 0))});return ongoingRequestsOfContext===void 0?ongoingRequests.set(context4,new Map([[moduleURL,promise]])):ongoingRequestsOfContext.set(moduleURL,promise),promise.then(()=>{let rslvdRqstsFCntxt=resolvedRequests.get(context4);rslvdRqstsFCntxt===void 0?resolvedRequests.set(context4,new Set([moduleURL])):rslvdRqstsFCntxt.add(moduleURL)}).finally(()=>{let ngngRqstsFCntxt=ongoingRequests.get(context4);ngngRqstsFCntxt!==void 0&&ngngRqstsFCntxt.delete(moduleURL)}),promise};var getValueForKey=(map4,key)=>{let value=map4.get(key);if(value===void 0)throw new Error("A value with the given key could not be found.");return value};var pickElementFromSet=(set,predicate)=>{let matchingElements=Array.from(set).filter(predicate);if(matchingElements.length>1)throw Error("More than one element was found.");if(matchingElements.length===0)throw Error("No element was found.");let[matchingElement]=matchingElements;return set.delete(matchingElement),matchingElement};var deletePassiveInputConnectionToAudioNode=(passiveInputs,source,output,input)=>{let passiveInputConnections=getValueForKey(passiveInputs,source),matchingConnection=pickElementFromSet(passiveInputConnections,passiveInputConnection=>passiveInputConnection[0]===output&&passiveInputConnection[1]===input);return passiveInputConnections.size===0&&passiveInputs.delete(source),matchingConnection};var getEventListenersOfAudioNode=audioNode=>getValueForKey(EVENT_LISTENERS,audioNode);var setInternalStateToActive=audioNode=>{if(ACTIVE_AUDIO_NODE_STORE.has(audioNode))throw new Error("The AudioNode is already stored.");ACTIVE_AUDIO_NODE_STORE.add(audioNode),getEventListenersOfAudioNode(audioNode).forEach(eventListener=>eventListener(!0))};var isAudioWorkletNode=audioNode=>"port"in audioNode;var setInternalStateToPassive=audioNode=>{if(!ACTIVE_AUDIO_NODE_STORE.has(audioNode))throw new Error("The AudioNode is not stored.");ACTIVE_AUDIO_NODE_STORE.delete(audioNode),getEventListenersOfAudioNode(audioNode).forEach(eventListener=>eventListener(!1))};var setInternalStateToPassiveWhenNecessary=(audioNode,activeInputs)=>{!isAudioWorkletNode(audioNode)&&activeInputs.every(connections=>connections.size===0)&&setInternalStateToPassive(audioNode)};var createAddConnectionToAudioNode=(addActiveInputConnectionToAudioNode2,addPassiveInputConnectionToAudioNode2,connectNativeAudioNodeToNativeAudioNode2,deleteActiveInputConnectionToAudioNode2,disconnectNativeAudioNodeFromNativeAudioNode2,getAudioNodeConnections2,getAudioNodeTailTime2,getEventListenersOfAudioNode2,getNativeAudioNode2,insertElementInSet2,isActiveAudioNode2,isPartOfACycle2,isPassiveAudioNode2)=>{let tailTimeTimeoutIds=new WeakMap;return(source,destination,output,input,isOffline)=>{let{activeInputs,passiveInputs}=getAudioNodeConnections2(destination),{outputs}=getAudioNodeConnections2(source),eventListeners=getEventListenersOfAudioNode2(source),eventListener=isActive=>{let nativeDestinationAudioNode=getNativeAudioNode2(destination),nativeSourceAudioNode=getNativeAudioNode2(source);if(isActive){let partialConnection=deletePassiveInputConnectionToAudioNode(passiveInputs,source,output,input);addActiveInputConnectionToAudioNode2(activeInputs,source,partialConnection,!1),!isOffline&&!isPartOfACycle2(source)&&connectNativeAudioNodeToNativeAudioNode2(nativeSourceAudioNode,nativeDestinationAudioNode,output,input),isPassiveAudioNode2(destination)&&setInternalStateToActive(destination)}else{let partialConnection=deleteActiveInputConnectionToAudioNode2(activeInputs,source,output,input);addPassiveInputConnectionToAudioNode2(passiveInputs,input,partialConnection,!1),!isOffline&&!isPartOfACycle2(source)&&disconnectNativeAudioNodeFromNativeAudioNode2(nativeSourceAudioNode,nativeDestinationAudioNode,output,input);let tailTime=getAudioNodeTailTime2(destination);if(tailTime===0)isActiveAudioNode2(destination)&&setInternalStateToPassiveWhenNecessary(destination,activeInputs);else{let tailTimeTimeoutId=tailTimeTimeoutIds.get(destination);tailTimeTimeoutId!==void 0&&clearTimeout(tailTimeTimeoutId),tailTimeTimeoutIds.set(destination,setTimeout(()=>{isActiveAudioNode2(destination)&&setInternalStateToPassiveWhenNecessary(destination,activeInputs)},tailTime*1e3))}}};return insertElementInSet2(outputs,[destination,output,input],outputConnection=>outputConnection[0]===destination&&outputConnection[1]===output&&outputConnection[2]===input,!0)?(eventListeners.add(eventListener),isActiveAudioNode2(source)?addActiveInputConnectionToAudioNode2(activeInputs,source,[output,input,eventListener],!0):addPassiveInputConnectionToAudioNode2(passiveInputs,input,[source,output,eventListener],!0),!0):!1}};var createAddPassiveInputConnectionToAudioNode=insertElementInSet2=>(passiveInputs,input,[source,output,eventListener],ignoreDuplicates)=>{let passiveInputConnections=passiveInputs.get(source);passiveInputConnections===void 0?passiveInputs.set(source,new Set([[output,input,eventListener]])):insertElementInSet2(passiveInputConnections,[output,input,eventListener],passiveInputConnection=>passiveInputConnection[0]===output&&passiveInputConnection[1]===input,ignoreDuplicates)};var createAddSilentConnection=createNativeGainNode2=>(nativeContext,nativeAudioScheduledSourceNode)=>{let nativeGainNode=createNativeGainNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});nativeAudioScheduledSourceNode.connect(nativeGainNode).connect(nativeContext.destination);let disconnect2=()=>{nativeAudioScheduledSourceNode.removeEventListener("ended",disconnect2),nativeAudioScheduledSourceNode.disconnect(nativeGainNode),nativeGainNode.disconnect()};nativeAudioScheduledSourceNode.addEventListener("ended",disconnect2)};var createAddUnrenderedAudioWorkletNode=getUnrenderedAudioWorkletNodes2=>(nativeContext,audioWorkletNode)=>{getUnrenderedAudioWorkletNodes2(nativeContext).add(audioWorkletNode)};var DEFAULT_OPTIONS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},createAnalyserNodeConstructor=(audionNodeConstructor,createAnalyserNodeRenderer2,createIndexSizeError2,createNativeAnalyserNode2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audionNodeConstructor{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS),options),nativeAnalyserNode=createNativeAnalyserNode2(nativeContext,mergedOptions),analyserNodeRenderer=isNativeOfflineAudioContext2(nativeContext)?createAnalyserNodeRenderer2():null;super(context4,!1,nativeAnalyserNode,analyserNodeRenderer);this._nativeAnalyserNode=nativeAnalyserNode}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(value){this._nativeAnalyserNode.fftSize=value}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(value){let maxDecibels=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=value,!(value>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=maxDecibels,createIndexSizeError2()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(value){let minDecibels=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=value,!(this._nativeAnalyserNode.maxDecibels>value))throw this._nativeAnalyserNode.minDecibels=minDecibels,createIndexSizeError2()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(value){this._nativeAnalyserNode.smoothingTimeConstant=value}getByteFrequencyData(array){this._nativeAnalyserNode.getByteFrequencyData(array)}getByteTimeDomainData(array){this._nativeAnalyserNode.getByteTimeDomainData(array)}getFloatFrequencyData(array){this._nativeAnalyserNode.getFloatFrequencyData(array)}getFloatTimeDomainData(array){this._nativeAnalyserNode.getFloatTimeDomainData(array)}};var isOwnedByContext=(nativeAudioNode,nativeContext)=>nativeAudioNode.context===nativeContext;var createAnalyserNodeRendererFactory=(createNativeAnalyserNode2,getNativeAudioNode2,renderInputsOfAudioNode2)=>()=>{let renderedNativeAnalyserNodes=new WeakMap,createAnalyserNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAnalyserNode=getNativeAudioNode2(proxy);if(!isOwnedByContext(nativeAnalyserNode,nativeOfflineAudioContext)){let options={channelCount:nativeAnalyserNode.channelCount,channelCountMode:nativeAnalyserNode.channelCountMode,channelInterpretation:nativeAnalyserNode.channelInterpretation,fftSize:nativeAnalyserNode.fftSize,maxDecibels:nativeAnalyserNode.maxDecibels,minDecibels:nativeAnalyserNode.minDecibels,smoothingTimeConstant:nativeAnalyserNode.smoothingTimeConstant};nativeAnalyserNode=createNativeAnalyserNode2(nativeOfflineAudioContext,options)}return renderedNativeAnalyserNodes.set(nativeOfflineAudioContext,nativeAnalyserNode),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeAnalyserNode,trace),nativeAnalyserNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeAnalyserNode=renderedNativeAnalyserNodes.get(nativeOfflineAudioContext);return renderedNativeAnalyserNode!==void 0?Promise.resolve(renderedNativeAnalyserNode):createAnalyserNode(proxy,nativeOfflineAudioContext,trace)}}};var testAudioBufferCopyChannelMethodsOutOfBoundsSupport=nativeAudioBuffer=>{try{nativeAudioBuffer.copyToChannel(new Float32Array(1),0,-1)}catch(e){return!1}return!0};var createIndexSizeError=()=>new DOMException("","IndexSizeError");var wrapAudioBufferGetChannelDataMethod=audioBuffer=>{audioBuffer.getChannelData=(getChannelData=>channel=>{try{return getChannelData.call(audioBuffer,channel)}catch(err){throw err.code===12?createIndexSizeError():err}})(audioBuffer.getChannelData)};var DEFAULT_OPTIONS2={numberOfChannels:1},createAudioBufferConstructor=(audioBufferStore2,cacheTestResult2,createNotSupportedError2,nativeAudioBufferConstructor2,nativeOfflineAudioContextConstructor2,testNativeAudioBufferConstructorSupport,wrapAudioBufferCopyChannelMethods2,wrapAudioBufferCopyChannelMethodsOutOfBounds2)=>{let nativeOfflineAudioContext=null;return class AudioBuffer2{constructor(options){if(nativeOfflineAudioContextConstructor2===null)throw new Error("Missing the native OfflineAudioContext constructor.");let{length,numberOfChannels,sampleRate}=__spreadValues(__spreadValues({},DEFAULT_OPTIONS2),options);nativeOfflineAudioContext===null&&(nativeOfflineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100));let audioBuffer=nativeAudioBufferConstructor2!==null&&cacheTestResult2(testNativeAudioBufferConstructorSupport,testNativeAudioBufferConstructorSupport)?new nativeAudioBufferConstructor2({length,numberOfChannels,sampleRate}):nativeOfflineAudioContext.createBuffer(numberOfChannels,length,sampleRate);if(audioBuffer.numberOfChannels===0)throw createNotSupportedError2();return typeof audioBuffer.copyFromChannel!="function"?(wrapAudioBufferCopyChannelMethods2(audioBuffer),wrapAudioBufferGetChannelDataMethod(audioBuffer)):cacheTestResult2(testAudioBufferCopyChannelMethodsOutOfBoundsSupport,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport(audioBuffer))||wrapAudioBufferCopyChannelMethodsOutOfBounds2(audioBuffer),audioBufferStore2.add(audioBuffer),audioBuffer}static[Symbol.hasInstance](instance){return instance!==null&&typeof instance=="object"&&Object.getPrototypeOf(instance)===AudioBuffer2.prototype||audioBufferStore2.has(instance)}}};var MOST_NEGATIVE_SINGLE_FLOAT=-34028234663852886e22,MOST_POSITIVE_SINGLE_FLOAT=-MOST_NEGATIVE_SINGLE_FLOAT;var isActiveAudioNode=audioNode=>ACTIVE_AUDIO_NODE_STORE.has(audioNode);var DEFAULT_OPTIONS3={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},createAudioBufferSourceNodeConstructor=(audioNodeConstructor2,createAudioBufferSourceNodeRenderer2,createAudioParam2,createInvalidStateError2,createNativeAudioBufferSourceNode2,getNativeContext2,isNativeOfflineAudioContext2,wrapEventListener2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS3),options),nativeAudioBufferSourceNode=createNativeAudioBufferSourceNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),audioBufferSourceNodeRenderer=isOffline?createAudioBufferSourceNodeRenderer2():null;super(context4,!1,nativeAudioBufferSourceNode,audioBufferSourceNodeRenderer);this._audioBufferSourceNodeRenderer=audioBufferSourceNodeRenderer,this._isBufferNullified=!1,this._isBufferSet=mergedOptions.buffer!==null,this._nativeAudioBufferSourceNode=nativeAudioBufferSourceNode,this._onended=null,this._playbackRate=createAudioParam2(this,isOffline,nativeAudioBufferSourceNode.playbackRate,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(value){if(this._nativeAudioBufferSourceNode.buffer=value,value!==null){if(this._isBufferSet)throw createInvalidStateError2();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(value){this._nativeAudioBufferSourceNode.loop=value}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(value){this._nativeAudioBufferSourceNode.loopEnd=value}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(value){this._nativeAudioBufferSourceNode.loopStart=value}get onended(){return this._onended}set onended(value){let wrappedListener=typeof value=="function"?wrapEventListener2(this,value):null;this._nativeAudioBufferSourceNode.onended=wrappedListener;let nativeOnEnded=this._nativeAudioBufferSourceNode.onended;this._onended=nativeOnEnded!==null&&nativeOnEnded===wrappedListener?value:nativeOnEnded}get playbackRate(){return this._playbackRate}start(when=0,offset=0,duration){if(this._nativeAudioBufferSourceNode.start(when,offset,duration),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=duration===void 0?[when,offset]:[when,offset,duration]),this.context.state!=="closed"){setInternalStateToActive(this);let resetInternalStateToPassive=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",resetInternalStateToPassive),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",resetInternalStateToPassive)}}stop(when=0){this._nativeAudioBufferSourceNode.stop(when),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=when)}};var createAudioBufferSourceNodeRendererFactory=(connectAudioParam2,createNativeAudioBufferSourceNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeAudioBufferSourceNodes=new WeakMap,start2=null,stop=null,createAudioBufferSourceNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAudioBufferSourceNode=getNativeAudioNode2(proxy),nativeAudioBufferSourceNodeIsOwnedByContext=isOwnedByContext(nativeAudioBufferSourceNode,nativeOfflineAudioContext);if(!nativeAudioBufferSourceNodeIsOwnedByContext){let options={buffer:nativeAudioBufferSourceNode.buffer,channelCount:nativeAudioBufferSourceNode.channelCount,channelCountMode:nativeAudioBufferSourceNode.channelCountMode,channelInterpretation:nativeAudioBufferSourceNode.channelInterpretation,loop:nativeAudioBufferSourceNode.loop,loopEnd:nativeAudioBufferSourceNode.loopEnd,loopStart:nativeAudioBufferSourceNode.loopStart,playbackRate:nativeAudioBufferSourceNode.playbackRate.value};nativeAudioBufferSourceNode=createNativeAudioBufferSourceNode2(nativeOfflineAudioContext,options),start2!==null&&nativeAudioBufferSourceNode.start(...start2),stop!==null&&nativeAudioBufferSourceNode.stop(stop)}return renderedNativeAudioBufferSourceNodes.set(nativeOfflineAudioContext,nativeAudioBufferSourceNode),nativeAudioBufferSourceNodeIsOwnedByContext?await connectAudioParam2(nativeOfflineAudioContext,proxy.playbackRate,nativeAudioBufferSourceNode.playbackRate,trace):await renderAutomation2(nativeOfflineAudioContext,proxy.playbackRate,nativeAudioBufferSourceNode.playbackRate,trace),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeAudioBufferSourceNode,trace),nativeAudioBufferSourceNode};return{set start(value){start2=value},set stop(value){stop=value},render(proxy,nativeOfflineAudioContext,trace){let renderedNativeAudioBufferSourceNode=renderedNativeAudioBufferSourceNodes.get(nativeOfflineAudioContext);return renderedNativeAudioBufferSourceNode!==void 0?Promise.resolve(renderedNativeAudioBufferSourceNode):createAudioBufferSourceNode(proxy,nativeOfflineAudioContext,trace)}}};var isAudioBufferSourceNode=audioNode=>"playbackRate"in audioNode;var isBiquadFilterNode=audioNode=>"frequency"in audioNode&&"gain"in audioNode;var isConstantSourceNode=audioNode=>"offset"in audioNode;var isGainNode=audioNode=>!("frequency"in audioNode)&&"gain"in audioNode;var isOscillatorNode=audioNode=>"detune"in audioNode&&"frequency"in audioNode;var isStereoPannerNode=audioNode=>"pan"in audioNode;var getAudioNodeConnections=audioNode=>getValueForKey(AUDIO_NODE_CONNECTIONS_STORE,audioNode);var getAudioParamConnections=audioParam=>getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE,audioParam);var deactivateActiveAudioNodeInputConnections=(audioNode,trace)=>{let{activeInputs}=getAudioNodeConnections(audioNode);activeInputs.forEach(connections=>connections.forEach(([source])=>{trace.includes(audioNode)||deactivateActiveAudioNodeInputConnections(source,[...trace,audioNode])}));let audioParams=isAudioBufferSourceNode(audioNode)?[audioNode.playbackRate]:isAudioWorkletNode(audioNode)?Array.from(audioNode.parameters.values()):isBiquadFilterNode(audioNode)?[audioNode.Q,audioNode.detune,audioNode.frequency,audioNode.gain]:isConstantSourceNode(audioNode)?[audioNode.offset]:isGainNode(audioNode)?[audioNode.gain]:isOscillatorNode(audioNode)?[audioNode.detune,audioNode.frequency]:isStereoPannerNode(audioNode)?[audioNode.pan]:[];for(let audioParam of audioParams){let audioParamConnections=getAudioParamConnections(audioParam);audioParamConnections!==void 0&&audioParamConnections.activeInputs.forEach(([source])=>deactivateActiveAudioNodeInputConnections(source,trace))}isActiveAudioNode(audioNode)&&setInternalStateToPassive(audioNode)};var deactivateAudioGraph=context4=>{deactivateActiveAudioNodeInputConnections(context4.destination,[])};var isValidLatencyHint=latencyHint=>latencyHint===void 0||typeof latencyHint=="number"||typeof latencyHint=="string"&&(latencyHint==="balanced"||latencyHint==="interactive"||latencyHint==="playback");var createAudioContextConstructor=(baseAudioContextConstructor2,createInvalidStateError2,createNotSupportedError2,createUnknownError2,mediaElementAudioSourceNodeConstructor2,mediaStreamAudioDestinationNodeConstructor2,mediaStreamAudioSourceNodeConstructor2,mediaStreamTrackAudioSourceNodeConstructor2,nativeAudioContextConstructor2)=>class extends baseAudioContextConstructor2{constructor(options={}){if(nativeAudioContextConstructor2===null)throw new Error("Missing the native AudioContext constructor.");let nativeAudioContext;try{nativeAudioContext=new nativeAudioContextConstructor2(options)}catch(err){throw err.code===12&&err.message==="sampleRate is not in range"?createNotSupportedError2():err}if(nativeAudioContext===null)throw createUnknownError2();if(!isValidLatencyHint(options.latencyHint))throw new TypeError(`The provided value '${options.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(options.sampleRate!==void 0&&nativeAudioContext.sampleRate!==options.sampleRate)throw createNotSupportedError2();super(nativeAudioContext,2);let{latencyHint}=options,{sampleRate}=nativeAudioContext;if(this._baseLatency=typeof nativeAudioContext.baseLatency=="number"?nativeAudioContext.baseLatency:latencyHint==="balanced"?512/sampleRate:latencyHint==="interactive"||latencyHint===void 0?256/sampleRate:latencyHint==="playback"?1024/sampleRate:Math.max(2,Math.min(128,Math.round(latencyHint*sampleRate/128)))*128/sampleRate,this._nativeAudioContext=nativeAudioContext,nativeAudioContextConstructor2.name==="webkitAudioContext"?(this._nativeGainNode=nativeAudioContext.createGain(),this._nativeOscillatorNode=nativeAudioContext.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(nativeAudioContext.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,nativeAudioContext.state==="running"){this._state="suspended";let revokeState=()=>{this._state==="suspended"&&(this._state=null),nativeAudioContext.removeEventListener("statechange",revokeState)};nativeAudioContext.addEventListener("statechange",revokeState)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw createInvalidStateError2()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)}))}createMediaElementSource(mediaElement){return new mediaElementAudioSourceNodeConstructor2(this,{mediaElement})}createMediaStreamDestination(){return new mediaStreamAudioDestinationNodeConstructor2(this)}createMediaStreamSource(mediaStream){return new mediaStreamAudioSourceNodeConstructor2(this,{mediaStream})}createMediaStreamTrackSource(mediaStreamTrack){return new mediaStreamTrackAudioSourceNodeConstructor2(this,{mediaStreamTrack})}resume(){return this._state==="suspended"?new Promise((resolve4,reject2)=>{let resolvePromise=()=>{this._nativeAudioContext.removeEventListener("statechange",resolvePromise),this._nativeAudioContext.state==="running"?resolve4():this.resume().then(resolve4,reject2)};this._nativeAudioContext.addEventListener("statechange",resolvePromise)}):this._nativeAudioContext.resume().catch(err=>{throw err===void 0||err.code===15?createInvalidStateError2():err})}suspend(){return this._nativeAudioContext.suspend().catch(err=>{throw err===void 0?createInvalidStateError2():err})}};var createAudioDestinationNodeConstructor=(audioNodeConstructor2,createAudioDestinationNodeRenderer2,createIndexSizeError2,createInvalidStateError2,createNativeAudioDestinationNode,getNativeContext2,isNativeOfflineAudioContext2,renderInputsOfAudioNode2)=>class extends audioNodeConstructor2{constructor(context4,channelCount){let nativeContext=getNativeContext2(context4),isOffline=isNativeOfflineAudioContext2(nativeContext),nativeAudioDestinationNode=createNativeAudioDestinationNode(nativeContext,channelCount,isOffline),audioDestinationNodeRenderer=isOffline?createAudioDestinationNodeRenderer2(renderInputsOfAudioNode2):null;super(context4,!1,nativeAudioDestinationNode,audioDestinationNodeRenderer);this._isNodeOfNativeOfflineAudioContext=isOffline,this._nativeAudioDestinationNode=nativeAudioDestinationNode}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(value){if(this._isNodeOfNativeOfflineAudioContext)throw createInvalidStateError2();if(value>this._nativeAudioDestinationNode.maxChannelCount)throw createIndexSizeError2();this._nativeAudioDestinationNode.channelCount=value}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(value){if(this._isNodeOfNativeOfflineAudioContext)throw createInvalidStateError2();this._nativeAudioDestinationNode.channelCountMode=value}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}};var createAudioDestinationNodeRenderer=renderInputsOfAudioNode2=>{let nativeAudioDestinationNodePromise=null,createAudioDestinationNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAudioDestinationNode=nativeOfflineAudioContext.destination;return await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeAudioDestinationNode,trace),nativeAudioDestinationNode};return{render(proxy,nativeOfflineAudioContext,trace){return nativeAudioDestinationNodePromise===null&&(nativeAudioDestinationNodePromise=createAudioDestinationNode(proxy,nativeOfflineAudioContext,trace)),nativeAudioDestinationNodePromise}}};var createAudioListenerFactory=(createAudioParam2,createNativeChannelMergerNode2,createNativeConstantSourceNode2,createNativeScriptProcessorNode2,isNativeOfflineAudioContext2)=>(context4,nativeContext)=>{let nativeListener=nativeContext.listener,createFakeAudioParams=()=>{let channelMergerNode=createNativeChannelMergerNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),isOffline=isNativeOfflineAudioContext2(nativeContext),scriptProcessorNode=createNativeScriptProcessorNode2(nativeContext,256,9,0),createFakeAudioParam=(input,value)=>{let constantSourceNode=createNativeConstantSourceNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:value});return constantSourceNode.connect(channelMergerNode,0,input),constantSourceNode.start(),Object.defineProperty(constantSourceNode.offset,"defaultValue",{get(){return value}}),createAudioParam2({context:context4},isOffline,constantSourceNode.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)},lastOrientation=[0,0,-1,0,1,0],lastPosition=[0,0,0];return scriptProcessorNode.onaudioprocess=({inputBuffer})=>{let orientation=[inputBuffer.getChannelData(0)[0],inputBuffer.getChannelData(1)[0],inputBuffer.getChannelData(2)[0],inputBuffer.getChannelData(3)[0],inputBuffer.getChannelData(4)[0],inputBuffer.getChannelData(5)[0]];orientation.some((value,index3)=>value!==lastOrientation[index3])&&(nativeListener.setOrientation(...orientation),lastOrientation=orientation);let positon=[inputBuffer.getChannelData(6)[0],inputBuffer.getChannelData(7)[0],inputBuffer.getChannelData(8)[0]];positon.some((value,index3)=>value!==lastPosition[index3])&&(nativeListener.setPosition(...positon),lastPosition=positon)},channelMergerNode.connect(scriptProcessorNode),{forwardX:createFakeAudioParam(0,0),forwardY:createFakeAudioParam(1,0),forwardZ:createFakeAudioParam(2,-1),positionX:createFakeAudioParam(6,0),positionY:createFakeAudioParam(7,0),positionZ:createFakeAudioParam(8,0),upX:createFakeAudioParam(3,0),upY:createFakeAudioParam(4,1),upZ:createFakeAudioParam(5,0)}},{forwardX,forwardY,forwardZ,positionX,positionY,positionZ,upX,upY,upZ}=nativeListener.forwardX===void 0?createFakeAudioParams():nativeListener;return{get forwardX(){return forwardX},get forwardY(){return forwardY},get forwardZ(){return forwardZ},get positionX(){return positionX},get positionY(){return positionY},get positionZ(){return positionZ},get upX(){return upX},get upY(){return upY},get upZ(){return upZ}}};var isAudioNode=audioNodeOrAudioParam=>"context"in audioNodeOrAudioParam;var isAudioNodeOutputConnection=outputConnection=>isAudioNode(outputConnection[0]);var insertElementInSet=(set,element,predicate,ignoreDuplicates)=>{for(let lmnt of set)if(predicate(lmnt)){if(ignoreDuplicates)return!1;throw Error("The set contains at least one similar element.")}return set.add(element),!0};var addActiveInputConnectionToAudioParam=(activeInputs,source,[output,eventListener],ignoreDuplicates)=>{insertElementInSet(activeInputs,[source,output,eventListener],activeInputConnection=>activeInputConnection[0]===source&&activeInputConnection[1]===output,ignoreDuplicates)};var addPassiveInputConnectionToAudioParam=(passiveInputs,[source,output,eventListener],ignoreDuplicates)=>{let passiveInputConnections=passiveInputs.get(source);passiveInputConnections===void 0?passiveInputs.set(source,new Set([[output,eventListener]])):insertElementInSet(passiveInputConnections,[output,eventListener],passiveInputConnection=>passiveInputConnection[0]===output,ignoreDuplicates)};var isNativeAudioNodeFaker=nativeAudioNodeOrNativeAudioNodeFaker=>"inputs"in nativeAudioNodeOrNativeAudioNodeFaker;var connectNativeAudioNodeToNativeAudioNode=(nativeSourceAudioNode,nativeDestinationAudioNode,output,input)=>{if(isNativeAudioNodeFaker(nativeDestinationAudioNode)){let fakeNativeDestinationAudioNode=nativeDestinationAudioNode.inputs[input];return nativeSourceAudioNode.connect(fakeNativeDestinationAudioNode,output,0),[fakeNativeDestinationAudioNode,output,0]}return nativeSourceAudioNode.connect(nativeDestinationAudioNode,output,input),[nativeDestinationAudioNode,output,input]};var deleteActiveInputConnection=(activeInputConnections,source,output)=>{for(let activeInputConnection of activeInputConnections)if(activeInputConnection[0]===source&&activeInputConnection[1]===output)return activeInputConnections.delete(activeInputConnection),activeInputConnection;return null};var deleteActiveInputConnectionToAudioParam=(activeInputs,source,output)=>pickElementFromSet(activeInputs,activeInputConnection=>activeInputConnection[0]===source&&activeInputConnection[1]===output);var deleteEventListenerOfAudioNode=(audioNode,eventListener)=>{if(!getEventListenersOfAudioNode(audioNode).delete(eventListener))throw new Error("Missing the expected event listener.")};var deletePassiveInputConnectionToAudioParam=(passiveInputs,source,output)=>{let passiveInputConnections=getValueForKey(passiveInputs,source),matchingConnection=pickElementFromSet(passiveInputConnections,passiveInputConnection=>passiveInputConnection[0]===output);return passiveInputConnections.size===0&&passiveInputs.delete(source),matchingConnection};var disconnectNativeAudioNodeFromNativeAudioNode=(nativeSourceAudioNode,nativeDestinationAudioNode,output,input)=>{isNativeAudioNodeFaker(nativeDestinationAudioNode)?nativeSourceAudioNode.disconnect(nativeDestinationAudioNode.inputs[input],output,0):nativeSourceAudioNode.disconnect(nativeDestinationAudioNode,output,input)};var getNativeAudioNode=audioNode=>getValueForKey(AUDIO_NODE_STORE,audioNode);var getNativeAudioParam=audioParam=>getValueForKey(AUDIO_PARAM_STORE,audioParam);var isPartOfACycle=audioNode=>CYCLE_COUNTERS.has(audioNode);var isPassiveAudioNode=audioNode=>!ACTIVE_AUDIO_NODE_STORE.has(audioNode);var testAudioNodeDisconnectMethodSupport=nativeAudioContext=>new Promise(resolve4=>{let analyzer=nativeAudioContext.createScriptProcessor(256,1,1),dummy=nativeAudioContext.createGain(),ones=nativeAudioContext.createBuffer(1,2,44100),channelData=ones.getChannelData(0);channelData[0]=1,channelData[1]=1;let source=nativeAudioContext.createBufferSource();source.buffer=ones,source.loop=!0,source.connect(analyzer).connect(nativeAudioContext.destination),source.connect(dummy),source.disconnect(dummy),analyzer.onaudioprocess=event=>{let chnnlDt=event.inputBuffer.getChannelData(0);Array.prototype.some.call(chnnlDt,sample=>sample===1)?resolve4(!0):resolve4(!1),source.stop(),analyzer.onaudioprocess=null,source.disconnect(analyzer),analyzer.disconnect(nativeAudioContext.destination)},source.start()});var visitEachAudioNodeOnce=(cycles,visitor)=>{let counts=new Map;for(let cycle of cycles)for(let audioNode of cycle){let count2=counts.get(audioNode);counts.set(audioNode,count2===void 0?1:count2+1)}counts.forEach((count2,audioNode)=>visitor(audioNode,count2))};var isNativeAudioNode=nativeAudioNodeOrAudioParam=>"context"in nativeAudioNodeOrAudioParam;var wrapAudioNodeDisconnectMethod=nativeAudioNode=>{let connections=new Map;nativeAudioNode.connect=(connect2=>(destination,output=0,input=0)=>{let returnValue=isNativeAudioNode(destination)?connect2(destination,output,input):connect2(destination,output),connectionsToDestination=connections.get(destination);return connectionsToDestination===void 0?connections.set(destination,[{input,output}]):connectionsToDestination.every(connection=>connection.input!==input||connection.output!==output)&&connectionsToDestination.push({input,output}),returnValue})(nativeAudioNode.connect.bind(nativeAudioNode)),nativeAudioNode.disconnect=(disconnect2=>(destinationOrOutput,output,input)=>{if(disconnect2.apply(nativeAudioNode),destinationOrOutput===void 0)connections.clear();else if(typeof destinationOrOutput=="number")for(let[destination,connectionsToDestination]of connections){let filteredConnections=connectionsToDestination.filter(connection=>connection.output!==destinationOrOutput);filteredConnections.length===0?connections.delete(destination):connections.set(destination,filteredConnections)}else if(connections.has(destinationOrOutput))if(output===void 0)connections.delete(destinationOrOutput);else{let connectionsToDestination=connections.get(destinationOrOutput);if(connectionsToDestination!==void 0){let filteredConnections=connectionsToDestination.filter(connection=>connection.output!==output&&(connection.input!==input||input===void 0));filteredConnections.length===0?connections.delete(destinationOrOutput):connections.set(destinationOrOutput,filteredConnections)}}for(let[destination,connectionsToDestination]of connections)connectionsToDestination.forEach(connection=>{isNativeAudioNode(destination)?nativeAudioNode.connect(destination,connection.output,connection.input):nativeAudioNode.connect(destination,connection.output)})})(nativeAudioNode.disconnect)};var addConnectionToAudioParamOfAudioContext=(source,destination,output,isOffline)=>{let{activeInputs,passiveInputs}=getAudioParamConnections(destination),{outputs}=getAudioNodeConnections(source),eventListeners=getEventListenersOfAudioNode(source),eventListener=isActive=>{let nativeAudioNode=getNativeAudioNode(source),nativeAudioParam=getNativeAudioParam(destination);if(isActive){let partialConnection=deletePassiveInputConnectionToAudioParam(passiveInputs,source,output);addActiveInputConnectionToAudioParam(activeInputs,source,partialConnection,!1),!isOffline&&!isPartOfACycle(source)&&nativeAudioNode.connect(nativeAudioParam,output)}else{let partialConnection=deleteActiveInputConnectionToAudioParam(activeInputs,source,output);addPassiveInputConnectionToAudioParam(passiveInputs,partialConnection,!1),!isOffline&&!isPartOfACycle(source)&&nativeAudioNode.disconnect(nativeAudioParam,output)}};return insertElementInSet(outputs,[destination,output],outputConnection=>outputConnection[0]===destination&&outputConnection[1]===output,!0)?(eventListeners.add(eventListener),isActiveAudioNode(source)?addActiveInputConnectionToAudioParam(activeInputs,source,[output,eventListener],!0):addPassiveInputConnectionToAudioParam(passiveInputs,[source,output,eventListener],!0),!0):!1},deleteInputConnectionOfAudioNode=(source,destination,output,input)=>{let{activeInputs,passiveInputs}=getAudioNodeConnections(destination),activeInputConnection=deleteActiveInputConnection(activeInputs[input],source,output);return activeInputConnection===null?[deletePassiveInputConnectionToAudioNode(passiveInputs,source,output,input)[2],!1]:[activeInputConnection[2],!0]},deleteInputConnectionOfAudioParam=(source,destination,output)=>{let{activeInputs,passiveInputs}=getAudioParamConnections(destination),activeInputConnection=deleteActiveInputConnection(activeInputs,source,output);return activeInputConnection===null?[deletePassiveInputConnectionToAudioParam(passiveInputs,source,output)[1],!1]:[activeInputConnection[2],!0]},deleteInputsOfAudioNode=(source,isOffline,destination,output,input)=>{let[listener,isActive]=deleteInputConnectionOfAudioNode(source,destination,output,input);if(listener!==null&&(deleteEventListenerOfAudioNode(source,listener),isActive&&!isOffline&&!isPartOfACycle(source)&&disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(source),getNativeAudioNode(destination),output,input)),isActiveAudioNode(destination)){let{activeInputs}=getAudioNodeConnections(destination);setInternalStateToPassiveWhenNecessary(destination,activeInputs)}},deleteInputsOfAudioParam=(source,isOffline,destination,output)=>{let[listener,isActive]=deleteInputConnectionOfAudioParam(source,destination,output);listener!==null&&(deleteEventListenerOfAudioNode(source,listener),isActive&&!isOffline&&!isPartOfACycle(source)&&getNativeAudioNode(source).disconnect(getNativeAudioParam(destination),output))},deleteAnyConnection=(source,isOffline)=>{let audioNodeConnectionsOfSource=getAudioNodeConnections(source),destinations=[];for(let outputConnection of audioNodeConnectionsOfSource.outputs)isAudioNodeOutputConnection(outputConnection)?deleteInputsOfAudioNode(source,isOffline,...outputConnection):deleteInputsOfAudioParam(source,isOffline,...outputConnection),destinations.push(outputConnection[0]);return audioNodeConnectionsOfSource.outputs.clear(),destinations},deleteConnectionAtOutput=(source,isOffline,output)=>{let audioNodeConnectionsOfSource=getAudioNodeConnections(source),destinations=[];for(let outputConnection of audioNodeConnectionsOfSource.outputs)outputConnection[1]===output&&(isAudioNodeOutputConnection(outputConnection)?deleteInputsOfAudioNode(source,isOffline,...outputConnection):deleteInputsOfAudioParam(source,isOffline,...outputConnection),destinations.push(outputConnection[0]),audioNodeConnectionsOfSource.outputs.delete(outputConnection));return destinations},deleteConnectionToDestination=(source,isOffline,destination,output,input)=>{let audioNodeConnectionsOfSource=getAudioNodeConnections(source);return Array.from(audioNodeConnectionsOfSource.outputs).filter(outputConnection=>outputConnection[0]===destination&&(output===void 0||outputConnection[1]===output)&&(input===void 0||outputConnection[2]===input)).map(outputConnection=>(isAudioNodeOutputConnection(outputConnection)?deleteInputsOfAudioNode(source,isOffline,...outputConnection):deleteInputsOfAudioParam(source,isOffline,...outputConnection),audioNodeConnectionsOfSource.outputs.delete(outputConnection),outputConnection[0]))},createAudioNodeConstructor=(addAudioNodeConnections,addConnectionToAudioNode,cacheTestResult2,createIncrementCycleCounter,createIndexSizeError2,createInvalidAccessError2,createNotSupportedError2,decrementCycleCounter,detectCycles,eventTargetConstructor2,getNativeContext2,isNativeAudioContext2,isNativeAudioNode3,isNativeAudioParam2,isNativeOfflineAudioContext2)=>class extends eventTargetConstructor2{constructor(context4,isActive,nativeAudioNode,audioNodeRenderer){super(nativeAudioNode);this._context=context4,this._nativeAudioNode=nativeAudioNode;let nativeContext=getNativeContext2(context4);isNativeAudioContext2(nativeContext)&&cacheTestResult2(testAudioNodeDisconnectMethodSupport,()=>testAudioNodeDisconnectMethodSupport(nativeContext))!==!0&&wrapAudioNodeDisconnectMethod(nativeAudioNode),AUDIO_NODE_STORE.set(this,nativeAudioNode),EVENT_LISTENERS.set(this,new Set),context4.state!=="closed"&&isActive&&setInternalStateToActive(this),addAudioNodeConnections(this,audioNodeRenderer,nativeAudioNode)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(value){this._nativeAudioNode.channelCount=value}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(value){this._nativeAudioNode.channelCountMode=value}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(value){this._nativeAudioNode.channelInterpretation=value}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(destination,output=0,input=0){if(output<0||output>=this._nativeAudioNode.numberOfOutputs)throw createIndexSizeError2();let nativeContext=getNativeContext2(this._context),isOffline=isNativeOfflineAudioContext2(nativeContext);if(isNativeAudioNode3(destination)||isNativeAudioParam2(destination))throw createInvalidAccessError2();if(isAudioNode(destination)){let nativeDestinationAudioNode=getNativeAudioNode(destination);try{let connection=connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode,nativeDestinationAudioNode,output,input),isPassive=isPassiveAudioNode(this);(isOffline||isPassive)&&this._nativeAudioNode.disconnect(...connection),this.context.state!=="closed"&&!isPassive&&isPassiveAudioNode(destination)&&setInternalStateToActive(destination)}catch(err){throw err.code===12?createInvalidAccessError2():err}if(addConnectionToAudioNode(this,destination,output,input,isOffline)){let cycles=detectCycles([this],destination);visitEachAudioNodeOnce(cycles,createIncrementCycleCounter(isOffline))}return destination}let nativeAudioParam=getNativeAudioParam(destination);if(nativeAudioParam.name==="playbackRate"&&nativeAudioParam.maxValue===1024)throw createNotSupportedError2();try{this._nativeAudioNode.connect(nativeAudioParam,output),(isOffline||isPassiveAudioNode(this))&&this._nativeAudioNode.disconnect(nativeAudioParam,output)}catch(err){throw err.code===12?createInvalidAccessError2():err}if(addConnectionToAudioParamOfAudioContext(this,destination,output,isOffline)){let cycles=detectCycles([this],destination);visitEachAudioNodeOnce(cycles,createIncrementCycleCounter(isOffline))}}disconnect(destinationOrOutput,output,input){let destinations,nativeContext=getNativeContext2(this._context),isOffline=isNativeOfflineAudioContext2(nativeContext);if(destinationOrOutput===void 0)destinations=deleteAnyConnection(this,isOffline);else if(typeof destinationOrOutput=="number"){if(destinationOrOutput<0||destinationOrOutput>=this.numberOfOutputs)throw createIndexSizeError2();destinations=deleteConnectionAtOutput(this,isOffline,destinationOrOutput)}else{if(output!==void 0&&(output<0||output>=this.numberOfOutputs)||isAudioNode(destinationOrOutput)&&input!==void 0&&(input<0||input>=destinationOrOutput.numberOfInputs))throw createIndexSizeError2();if(destinations=deleteConnectionToDestination(this,isOffline,destinationOrOutput,output,input),destinations.length===0)throw createInvalidAccessError2()}for(let destination of destinations){let cycles=detectCycles([this],destination);visitEachAudioNodeOnce(cycles,decrementCycleCounter)}}};var import_automation_events=__toModule(require_bundle()),createAudioParamFactory=(addAudioParamConnections,audioParamAudioNodeStore2,audioParamStore,createAudioParamRenderer2,createCancelAndHoldAutomationEvent2,createCancelScheduledValuesAutomationEvent2,createExponentialRampToValueAutomationEvent2,createLinearRampToValueAutomationEvent2,createSetTargetAutomationEvent2,createSetValueAutomationEvent2,createSetValueCurveAutomationEvent2,nativeAudioContextConstructor2,setValueAtTimeUntilPossible2)=>(audioNode,isAudioParamOfOfflineAudioContext,nativeAudioParam,maxValue=null,minValue=null)=>{let automationEventList=new import_automation_events.AutomationEventList(nativeAudioParam.defaultValue),audioParamRenderer=isAudioParamOfOfflineAudioContext?createAudioParamRenderer2(automationEventList):null,audioParam={get defaultValue(){return nativeAudioParam.defaultValue},get maxValue(){return maxValue===null?nativeAudioParam.maxValue:maxValue},get minValue(){return minValue===null?nativeAudioParam.minValue:minValue},get value(){return nativeAudioParam.value},set value(value){nativeAudioParam.value=value,audioParam.setValueAtTime(value,audioNode.context.currentTime)},cancelAndHoldAtTime(cancelTime){if(typeof nativeAudioParam.cancelAndHoldAtTime=="function")audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createCancelAndHoldAutomationEvent2(cancelTime)),nativeAudioParam.cancelAndHoldAtTime(cancelTime);else{let previousLastEvent=Array.from(automationEventList).pop();audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createCancelAndHoldAutomationEvent2(cancelTime));let currentLastEvent=Array.from(automationEventList).pop();nativeAudioParam.cancelScheduledValues(cancelTime),previousLastEvent!==currentLastEvent&&currentLastEvent!==void 0&&(currentLastEvent.type==="exponentialRampToValue"?nativeAudioParam.exponentialRampToValueAtTime(currentLastEvent.value,currentLastEvent.endTime):currentLastEvent.type==="linearRampToValue"?nativeAudioParam.linearRampToValueAtTime(currentLastEvent.value,currentLastEvent.endTime):currentLastEvent.type==="setValue"?nativeAudioParam.setValueAtTime(currentLastEvent.value,currentLastEvent.startTime):currentLastEvent.type==="setValueCurve"&&nativeAudioParam.setValueCurveAtTime(currentLastEvent.values,currentLastEvent.startTime,currentLastEvent.duration))}return audioParam},cancelScheduledValues(cancelTime){return audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createCancelScheduledValuesAutomationEvent2(cancelTime)),nativeAudioParam.cancelScheduledValues(cancelTime),audioParam},exponentialRampToValueAtTime(value,endTime){if(value===0)throw new RangeError;if(!Number.isFinite(endTime)||endTime<0)throw new RangeError;return audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createExponentialRampToValueAutomationEvent2(value,endTime)),nativeAudioParam.exponentialRampToValueAtTime(value,endTime),audioParam},linearRampToValueAtTime(value,endTime){return audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createLinearRampToValueAutomationEvent2(value,endTime)),nativeAudioParam.linearRampToValueAtTime(value,endTime),audioParam},setTargetAtTime(target,startTime,timeConstant){return audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createSetTargetAutomationEvent2(target,startTime,timeConstant)),nativeAudioParam.setTargetAtTime(target,startTime,timeConstant),audioParam},setValueAtTime(value,startTime){return audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createSetValueAutomationEvent2(value,startTime)),nativeAudioParam.setValueAtTime(value,startTime),audioParam},setValueCurveAtTime(values,startTime,duration){let convertedValues=values instanceof Float32Array?values:new Float32Array(values);if(nativeAudioContextConstructor2!==null&&nativeAudioContextConstructor2.name==="webkitAudioContext"){let endTime=startTime+duration,sampleRate=audioNode.context.sampleRate,firstSample=Math.ceil(startTime*sampleRate),lastSample=Math.floor(endTime*sampleRate),numberOfInterpolatedValues=lastSample-firstSample,interpolatedValues=new Float32Array(numberOfInterpolatedValues);for(let i=0;i<numberOfInterpolatedValues;i+=1){let theoreticIndex=(convertedValues.length-1)/duration*((firstSample+i)/sampleRate-startTime),lowerIndex=Math.floor(theoreticIndex),upperIndex=Math.ceil(theoreticIndex);interpolatedValues[i]=lowerIndex===upperIndex?convertedValues[lowerIndex]:(1-(theoreticIndex-lowerIndex))*convertedValues[lowerIndex]+(1-(upperIndex-theoreticIndex))*convertedValues[upperIndex]}audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createSetValueCurveAutomationEvent2(interpolatedValues,startTime,duration)),nativeAudioParam.setValueCurveAtTime(interpolatedValues,startTime,duration);let timeOfLastSample=lastSample/sampleRate;timeOfLastSample<endTime&&setValueAtTimeUntilPossible2(audioParam,interpolatedValues[interpolatedValues.length-1],timeOfLastSample),setValueAtTimeUntilPossible2(audioParam,convertedValues[convertedValues.length-1],endTime)}else audioParamRenderer===null&&automationEventList.flush(audioNode.context.currentTime),automationEventList.add(createSetValueCurveAutomationEvent2(convertedValues,startTime,duration)),nativeAudioParam.setValueCurveAtTime(convertedValues,startTime,duration);return audioParam}};return audioParamStore.set(audioParam,nativeAudioParam),audioParamAudioNodeStore2.set(audioParam,audioNode),addAudioParamConnections(audioParam,audioParamRenderer),audioParam};var createAudioParamRenderer=automationEventList=>({replay(audioParam){for(let automationEvent of automationEventList)if(automationEvent.type==="exponentialRampToValue"){let{endTime,value}=automationEvent;audioParam.exponentialRampToValueAtTime(value,endTime)}else if(automationEvent.type==="linearRampToValue"){let{endTime,value}=automationEvent;audioParam.linearRampToValueAtTime(value,endTime)}else if(automationEvent.type==="setTarget"){let{startTime,target,timeConstant}=automationEvent;audioParam.setTargetAtTime(target,startTime,timeConstant)}else if(automationEvent.type==="setValue"){let{startTime,value}=automationEvent;audioParam.setValueAtTime(value,startTime)}else if(automationEvent.type==="setValueCurve"){let{duration,startTime,values}=automationEvent;audioParam.setValueCurveAtTime(values,startTime,duration)}else throw new Error("Can't apply an unknown automation.")}});var ReadOnlyMap=class{constructor(parameters){this._map=new Map(parameters)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(callback,thisArg=null){return this._map.forEach((value,key)=>callback.call(thisArg,value,key,this))}get(name){return this._map.get(name)}has(name){return this._map.has(name)}keys(){return this._map.keys()}values(){return this._map.values()}};var DEFAULT_OPTIONS4={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},createAudioWorkletNodeConstructor=(addUnrenderedAudioWorkletNode2,audioNodeConstructor2,createAudioParam2,createAudioWorkletNodeRenderer2,createNativeAudioWorkletNode2,getAudioNodeConnections2,getBackupOfflineAudioContext2,getNativeContext2,isNativeOfflineAudioContext2,nativeAudioWorkletNodeConstructor2,sanitizeAudioWorkletNodeOptions2,setActiveAudioWorkletNodeInputs2,testAudioWorkletNodeOptionsClonability2,wrapEventListener2)=>class extends audioNodeConstructor2{constructor(context4,name,options){var _a3;let nativeContext=getNativeContext2(context4),isOffline=isNativeOfflineAudioContext2(nativeContext),mergedOptions=sanitizeAudioWorkletNodeOptions2(__spreadValues(__spreadValues({},DEFAULT_OPTIONS4),options));testAudioWorkletNodeOptionsClonability2(mergedOptions);let nodeNameToProcessorConstructorMap=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(nativeContext),processorConstructor=nodeNameToProcessorConstructorMap==null?void 0:nodeNameToProcessorConstructorMap.get(name),nativeContextOrBackupOfflineAudioContext=isOffline||nativeContext.state!=="closed"?nativeContext:(_a3=getBackupOfflineAudioContext2(nativeContext))!==null&&_a3!==void 0?_a3:nativeContext,nativeAudioWorkletNode=createNativeAudioWorkletNode2(nativeContextOrBackupOfflineAudioContext,isOffline?null:context4.baseLatency,nativeAudioWorkletNodeConstructor2,name,processorConstructor,mergedOptions),audioWorkletNodeRenderer=isOffline?createAudioWorkletNodeRenderer2(name,mergedOptions,processorConstructor):null;super(context4,!0,nativeAudioWorkletNode,audioWorkletNodeRenderer);let parameters=[];nativeAudioWorkletNode.parameters.forEach((nativeAudioParam,nm)=>{let audioParam=createAudioParam2(this,isOffline,nativeAudioParam);parameters.push([nm,audioParam])}),this._nativeAudioWorkletNode=nativeAudioWorkletNode,this._onprocessorerror=null,this._parameters=new ReadOnlyMap(parameters),isOffline&&addUnrenderedAudioWorkletNode2(nativeContext,this);let{activeInputs}=getAudioNodeConnections2(this);setActiveAudioWorkletNodeInputs2(nativeAudioWorkletNode,activeInputs)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(value){let wrappedListener=typeof value=="function"?wrapEventListener2(this,value):null;this._nativeAudioWorkletNode.onprocessorerror=wrappedListener;let nativeOnProcessorError=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=nativeOnProcessorError!==null&&nativeOnProcessorError===wrappedListener?value:nativeOnProcessorError}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function copyFromChannel(audioBuffer,parent,key,channelNumber,bufferOffset){if(typeof audioBuffer.copyFromChannel=="function")parent[key].byteLength===0&&(parent[key]=new Float32Array(128)),audioBuffer.copyFromChannel(parent[key],channelNumber,bufferOffset);else{let channelData=audioBuffer.getChannelData(channelNumber);if(parent[key].byteLength===0)parent[key]=channelData.slice(bufferOffset,bufferOffset+128);else{let slicedInput=new Float32Array(channelData.buffer,bufferOffset*Float32Array.BYTES_PER_ELEMENT,128);parent[key].set(slicedInput)}}}var copyToChannel=(audioBuffer,parent,key,channelNumber,bufferOffset)=>{typeof audioBuffer.copyToChannel=="function"?parent[key].byteLength!==0&&audioBuffer.copyToChannel(parent[key],channelNumber,bufferOffset):parent[key].byteLength!==0&&audioBuffer.getChannelData(channelNumber).set(parent[key],bufferOffset)};var createNestedArrays=(x,y)=>{let arrays=[];for(let i=0;i<x;i+=1){let array=[],length=typeof y=="number"?y:y[i];for(let j=0;j<length;j+=1)array.push(new Float32Array(128));arrays.push(array)}return arrays};var getAudioWorkletProcessor=(nativeOfflineAudioContext,proxy)=>{let nodeToProcessorMap=getValueForKey(NODE_TO_PROCESSOR_MAPS,nativeOfflineAudioContext),nativeAudioWorkletNode=getNativeAudioNode(proxy);return getValueForKey(nodeToProcessorMap,nativeAudioWorkletNode)};var processBuffer=async(proxy,renderedBuffer,nativeOfflineAudioContext,options,outputChannelCount,processorConstructor,exposeCurrentFrameAndCurrentTime2)=>{let length=renderedBuffer===null?Math.ceil(proxy.context.length/128)*128:renderedBuffer.length,numberOfInputChannels=options.channelCount*options.numberOfInputs,numberOfOutputChannels=outputChannelCount.reduce((sum2,value)=>sum2+value,0),processedBuffer=numberOfOutputChannels===0?null:nativeOfflineAudioContext.createBuffer(numberOfOutputChannels,length,nativeOfflineAudioContext.sampleRate);if(processorConstructor===void 0)throw new Error("Missing the processor constructor.");let audioNodeConnections=getAudioNodeConnections(proxy),audioWorkletProcessor=await getAudioWorkletProcessor(nativeOfflineAudioContext,proxy),inputs=createNestedArrays(options.numberOfInputs,options.channelCount),outputs=createNestedArrays(options.numberOfOutputs,outputChannelCount),parameters=Array.from(proxy.parameters.keys()).reduce((prmtrs,name)=>__spreadProps(__spreadValues({},prmtrs),{[name]:new Float32Array(128)}),{});for(let i=0;i<length;i+=128){if(options.numberOfInputs>0&&renderedBuffer!==null)for(let j=0;j<options.numberOfInputs;j+=1)for(let k=0;k<options.channelCount;k+=1)copyFromChannel(renderedBuffer,inputs[j],k,k,i);processorConstructor.parameterDescriptors!==void 0&&renderedBuffer!==null&&processorConstructor.parameterDescriptors.forEach(({name},index3)=>{copyFromChannel(renderedBuffer,parameters,name,numberOfInputChannels+index3,i)});for(let j=0;j<options.numberOfInputs;j+=1)for(let k=0;k<outputChannelCount[j];k+=1)outputs[j][k].byteLength===0&&(outputs[j][k]=new Float32Array(128));try{let potentiallyEmptyInputs=inputs.map((input,index3)=>audioNodeConnections.activeInputs[index3].size===0?[]:input),activeSourceFlag=exposeCurrentFrameAndCurrentTime2(i/nativeOfflineAudioContext.sampleRate,nativeOfflineAudioContext.sampleRate,()=>audioWorkletProcessor.process(potentiallyEmptyInputs,outputs,parameters));if(processedBuffer!==null)for(let j=0,outputChannelSplitterNodeOutput=0;j<options.numberOfOutputs;j+=1){for(let k=0;k<outputChannelCount[j];k+=1)copyToChannel(processedBuffer,outputs[j],k,outputChannelSplitterNodeOutput+k,i);outputChannelSplitterNodeOutput+=outputChannelCount[j]}if(!activeSourceFlag)break}catch(error){proxy.dispatchEvent(new ErrorEvent("processorerror",{colno:error.colno,filename:error.filename,lineno:error.lineno,message:error.message}));break}}return processedBuffer},createAudioWorkletNodeRendererFactory=(connectAudioParam2,connectMultipleOutputs2,createNativeAudioBufferSourceNode2,createNativeChannelMergerNode2,createNativeChannelSplitterNode2,createNativeConstantSourceNode2,createNativeGainNode2,deleteUnrenderedAudioWorkletNode2,disconnectMultipleOutputs2,exposeCurrentFrameAndCurrentTime2,getNativeAudioNode2,nativeAudioWorkletNodeConstructor2,nativeOfflineAudioContextConstructor2,renderAutomation2,renderInputsOfAudioNode2,renderNativeOfflineAudioContext2)=>(name,options,processorConstructor)=>{let renderedNativeAudioNodes=new WeakMap,processedBufferPromise=null,createAudioNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAudioWorkletNode=getNativeAudioNode2(proxy),nativeOutputNodes=null,nativeAudioWorkletNodeIsOwnedByContext=isOwnedByContext(nativeAudioWorkletNode,nativeOfflineAudioContext),outputChannelCount=Array.isArray(options.outputChannelCount)?options.outputChannelCount:Array.from(options.outputChannelCount);if(nativeAudioWorkletNodeConstructor2===null){let numberOfOutputChannels=outputChannelCount.reduce((sum2,value)=>sum2+value,0),outputChannelSplitterNode=createNativeChannelSplitterNode2(nativeOfflineAudioContext,{channelCount:Math.max(1,numberOfOutputChannels),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,numberOfOutputChannels)}),outputChannelMergerNodes=[];for(let i=0;i<proxy.numberOfOutputs;i+=1)outputChannelMergerNodes.push(createNativeChannelMergerNode2(nativeOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:outputChannelCount[i]}));let outputGainNode=createNativeGainNode2(nativeOfflineAudioContext,{channelCount:options.channelCount,channelCountMode:options.channelCountMode,channelInterpretation:options.channelInterpretation,gain:1});outputGainNode.connect=connectMultipleOutputs2.bind(null,outputChannelMergerNodes),outputGainNode.disconnect=disconnectMultipleOutputs2.bind(null,outputChannelMergerNodes),nativeOutputNodes=[outputChannelSplitterNode,outputChannelMergerNodes,outputGainNode]}else nativeAudioWorkletNodeIsOwnedByContext||(nativeAudioWorkletNode=new nativeAudioWorkletNodeConstructor2(nativeOfflineAudioContext,name));if(renderedNativeAudioNodes.set(nativeOfflineAudioContext,nativeOutputNodes===null?nativeAudioWorkletNode:nativeOutputNodes[2]),nativeOutputNodes!==null){if(processedBufferPromise===null){if(processorConstructor===void 0)throw new Error("Missing the processor constructor.");if(nativeOfflineAudioContextConstructor2===null)throw new Error("Missing the native OfflineAudioContext constructor.");let numberOfInputChannels=proxy.channelCount*proxy.numberOfInputs,numberOfParameters=processorConstructor.parameterDescriptors===void 0?0:processorConstructor.parameterDescriptors.length,numberOfChannels=numberOfInputChannels+numberOfParameters;processedBufferPromise=processBuffer(proxy,numberOfChannels===0?null:await(async()=>{let partialOfflineAudioContext=new nativeOfflineAudioContextConstructor2(numberOfChannels,Math.ceil(proxy.context.length/128)*128,nativeOfflineAudioContext.sampleRate),gainNodes=[],inputChannelSplitterNodes=[];for(let i=0;i<options.numberOfInputs;i+=1)gainNodes.push(createNativeGainNode2(partialOfflineAudioContext,{channelCount:options.channelCount,channelCountMode:options.channelCountMode,channelInterpretation:options.channelInterpretation,gain:1})),inputChannelSplitterNodes.push(createNativeChannelSplitterNode2(partialOfflineAudioContext,{channelCount:options.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:options.channelCount}));let constantSourceNodes=await Promise.all(Array.from(proxy.parameters.values()).map(async audioParam=>{let constantSourceNode=createNativeConstantSourceNode2(partialOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:audioParam.value});return await renderAutomation2(partialOfflineAudioContext,audioParam,constantSourceNode.offset,trace),constantSourceNode})),inputChannelMergerNode=createNativeChannelMergerNode2(partialOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,numberOfInputChannels+numberOfParameters)});for(let i=0;i<options.numberOfInputs;i+=1){gainNodes[i].connect(inputChannelSplitterNodes[i]);for(let j=0;j<options.channelCount;j+=1)inputChannelSplitterNodes[i].connect(inputChannelMergerNode,j,i*options.channelCount+j)}for(let[index3,constantSourceNode]of constantSourceNodes.entries())constantSourceNode.connect(inputChannelMergerNode,0,numberOfInputChannels+index3),constantSourceNode.start(0);return inputChannelMergerNode.connect(partialOfflineAudioContext.destination),await Promise.all(gainNodes.map(gainNode=>renderInputsOfAudioNode2(proxy,partialOfflineAudioContext,gainNode,trace))),renderNativeOfflineAudioContext2(partialOfflineAudioContext)})(),nativeOfflineAudioContext,options,outputChannelCount,processorConstructor,exposeCurrentFrameAndCurrentTime2)}let processedBuffer=await processedBufferPromise,audioBufferSourceNode=createNativeAudioBufferSourceNode2(nativeOfflineAudioContext,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[outputChannelSplitterNode,outputChannelMergerNodes,outputGainNode]=nativeOutputNodes;processedBuffer!==null&&(audioBufferSourceNode.buffer=processedBuffer,audioBufferSourceNode.start(0)),audioBufferSourceNode.connect(outputChannelSplitterNode);for(let i=0,outputChannelSplitterNodeOutput=0;i<proxy.numberOfOutputs;i+=1){let outputChannelMergerNode=outputChannelMergerNodes[i];for(let j=0;j<outputChannelCount[i];j+=1)outputChannelSplitterNode.connect(outputChannelMergerNode,outputChannelSplitterNodeOutput+j,j);outputChannelSplitterNodeOutput+=outputChannelCount[i]}return outputGainNode}if(nativeAudioWorkletNodeIsOwnedByContext)for(let[nm,audioParam]of proxy.parameters.entries())await connectAudioParam2(nativeOfflineAudioContext,audioParam,nativeAudioWorkletNode.parameters.get(nm),trace);else for(let[nm,audioParam]of proxy.parameters.entries())await renderAutomation2(nativeOfflineAudioContext,audioParam,nativeAudioWorkletNode.parameters.get(nm),trace);return await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeAudioWorkletNode,trace),nativeAudioWorkletNode};return{render(proxy,nativeOfflineAudioContext,trace){deleteUnrenderedAudioWorkletNode2(nativeOfflineAudioContext,proxy);let renderedNativeAudioWorkletNodeOrGainNode=renderedNativeAudioNodes.get(nativeOfflineAudioContext);return renderedNativeAudioWorkletNodeOrGainNode!==void 0?Promise.resolve(renderedNativeAudioWorkletNodeOrGainNode):createAudioNode(proxy,nativeOfflineAudioContext,trace)}}};var createBaseAudioContextConstructor=(addAudioWorkletModule2,analyserNodeConstructor2,audioBufferConstructor2,audioBufferSourceNodeConstructor2,biquadFilterNodeConstructor2,channelMergerNodeConstructor2,channelSplitterNodeConstructor2,constantSourceNodeConstructor2,convolverNodeConstructor2,decodeAudioData2,delayNodeConstructor2,dynamicsCompressorNodeConstructor2,gainNodeConstructor2,iIRFilterNodeConstructor2,minimalBaseAudioContextConstructor2,oscillatorNodeConstructor2,pannerNodeConstructor2,periodicWaveConstructor2,stereoPannerNodeConstructor2,waveShaperNodeConstructor2)=>class extends minimalBaseAudioContextConstructor2{constructor(_nativeContext,numberOfChannels){super(_nativeContext,numberOfChannels);this._nativeContext=_nativeContext,this._audioWorklet=addAudioWorkletModule2===void 0?void 0:{addModule:(moduleURL,options)=>addAudioWorkletModule2(this,moduleURL,options)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new analyserNodeConstructor2(this)}createBiquadFilter(){return new biquadFilterNodeConstructor2(this)}createBuffer(numberOfChannels,length,sampleRate){return new audioBufferConstructor2({length,numberOfChannels,sampleRate})}createBufferSource(){return new audioBufferSourceNodeConstructor2(this)}createChannelMerger(numberOfInputs=6){return new channelMergerNodeConstructor2(this,{numberOfInputs})}createChannelSplitter(numberOfOutputs=6){return new channelSplitterNodeConstructor2(this,{numberOfOutputs})}createConstantSource(){return new constantSourceNodeConstructor2(this)}createConvolver(){return new convolverNodeConstructor2(this)}createDelay(maxDelayTime=1){return new delayNodeConstructor2(this,{maxDelayTime})}createDynamicsCompressor(){return new dynamicsCompressorNodeConstructor2(this)}createGain(){return new gainNodeConstructor2(this)}createIIRFilter(feedforward,feedback){return new iIRFilterNodeConstructor2(this,{feedback,feedforward})}createOscillator(){return new oscillatorNodeConstructor2(this)}createPanner(){return new pannerNodeConstructor2(this)}createPeriodicWave(real,imag,constraints={disableNormalization:!1}){return new periodicWaveConstructor2(this,__spreadProps(__spreadValues({},constraints),{imag,real}))}createStereoPanner(){return new stereoPannerNodeConstructor2(this)}createWaveShaper(){return new waveShaperNodeConstructor2(this)}decodeAudioData(audioData,successCallback,errorCallback){return decodeAudioData2(this._nativeContext,audioData).then(audioBuffer=>(typeof successCallback=="function"&&successCallback(audioBuffer),audioBuffer),err=>{throw typeof errorCallback=="function"&&errorCallback(err),err})}};var DEFAULT_OPTIONS5={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},createBiquadFilterNodeConstructor=(audioNodeConstructor2,createAudioParam2,createBiquadFilterNodeRenderer2,createInvalidAccessError2,createNativeBiquadFilterNode2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS5),options),nativeBiquadFilterNode=createNativeBiquadFilterNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),biquadFilterNodeRenderer=isOffline?createBiquadFilterNodeRenderer2():null;super(context4,!1,nativeBiquadFilterNode,biquadFilterNodeRenderer);this._Q=createAudioParam2(this,isOffline,nativeBiquadFilterNode.Q,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._detune=createAudioParam2(this,isOffline,nativeBiquadFilterNode.detune,1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT),-1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT)),this._frequency=createAudioParam2(this,isOffline,nativeBiquadFilterNode.frequency,context4.sampleRate/2,0),this._gain=createAudioParam2(this,isOffline,nativeBiquadFilterNode.gain,40*Math.log10(MOST_POSITIVE_SINGLE_FLOAT),MOST_NEGATIVE_SINGLE_FLOAT),this._nativeBiquadFilterNode=nativeBiquadFilterNode,setAudioNodeTailTime2(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(value){this._nativeBiquadFilterNode.type=value}getFrequencyResponse(frequencyHz,magResponse,phaseResponse){try{this._nativeBiquadFilterNode.getFrequencyResponse(frequencyHz,magResponse,phaseResponse)}catch(err){throw err.code===11?createInvalidAccessError2():err}if(frequencyHz.length!==magResponse.length||magResponse.length!==phaseResponse.length)throw createInvalidAccessError2()}};var createBiquadFilterNodeRendererFactory=(connectAudioParam2,createNativeBiquadFilterNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeBiquadFilterNodes=new WeakMap,createBiquadFilterNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeBiquadFilterNode=getNativeAudioNode2(proxy),nativeBiquadFilterNodeIsOwnedByContext=isOwnedByContext(nativeBiquadFilterNode,nativeOfflineAudioContext);if(!nativeBiquadFilterNodeIsOwnedByContext){let options={Q:nativeBiquadFilterNode.Q.value,channelCount:nativeBiquadFilterNode.channelCount,channelCountMode:nativeBiquadFilterNode.channelCountMode,channelInterpretation:nativeBiquadFilterNode.channelInterpretation,detune:nativeBiquadFilterNode.detune.value,frequency:nativeBiquadFilterNode.frequency.value,gain:nativeBiquadFilterNode.gain.value,type:nativeBiquadFilterNode.type};nativeBiquadFilterNode=createNativeBiquadFilterNode2(nativeOfflineAudioContext,options)}return renderedNativeBiquadFilterNodes.set(nativeOfflineAudioContext,nativeBiquadFilterNode),nativeBiquadFilterNodeIsOwnedByContext?(await connectAudioParam2(nativeOfflineAudioContext,proxy.Q,nativeBiquadFilterNode.Q,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.detune,nativeBiquadFilterNode.detune,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.frequency,nativeBiquadFilterNode.frequency,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.gain,nativeBiquadFilterNode.gain,trace)):(await renderAutomation2(nativeOfflineAudioContext,proxy.Q,nativeBiquadFilterNode.Q,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.detune,nativeBiquadFilterNode.detune,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.frequency,nativeBiquadFilterNode.frequency,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.gain,nativeBiquadFilterNode.gain,trace)),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeBiquadFilterNode,trace),nativeBiquadFilterNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeBiquadFilterNode=renderedNativeBiquadFilterNodes.get(nativeOfflineAudioContext);return renderedNativeBiquadFilterNode!==void 0?Promise.resolve(renderedNativeBiquadFilterNode):createBiquadFilterNode(proxy,nativeOfflineAudioContext,trace)}}};var createCacheTestResult=(ongoingTests,testResults)=>(tester,test)=>{let cachedTestResult=testResults.get(tester);if(cachedTestResult!==void 0)return cachedTestResult;let ongoingTest=ongoingTests.get(tester);if(ongoingTest!==void 0)return ongoingTest;try{let synchronousTestResult=test();return synchronousTestResult instanceof Promise?(ongoingTests.set(tester,synchronousTestResult),synchronousTestResult.catch(()=>!1).then(finalTestResult=>(ongoingTests.delete(tester),testResults.set(tester,finalTestResult),finalTestResult))):(testResults.set(tester,synchronousTestResult),synchronousTestResult)}catch(e){return testResults.set(tester,!1),!1}};var DEFAULT_OPTIONS6={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},createChannelMergerNodeConstructor=(audioNodeConstructor2,createChannelMergerNodeRenderer2,createNativeChannelMergerNode2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS6),options),nativeChannelMergerNode=createNativeChannelMergerNode2(nativeContext,mergedOptions),channelMergerNodeRenderer=isNativeOfflineAudioContext2(nativeContext)?createChannelMergerNodeRenderer2():null;super(context4,!1,nativeChannelMergerNode,channelMergerNodeRenderer)}};var createChannelMergerNodeRendererFactory=(createNativeChannelMergerNode2,getNativeAudioNode2,renderInputsOfAudioNode2)=>()=>{let renderedNativeAudioNodes=new WeakMap,createAudioNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAudioNode=getNativeAudioNode2(proxy);if(!isOwnedByContext(nativeAudioNode,nativeOfflineAudioContext)){let options={channelCount:nativeAudioNode.channelCount,channelCountMode:nativeAudioNode.channelCountMode,channelInterpretation:nativeAudioNode.channelInterpretation,numberOfInputs:nativeAudioNode.numberOfInputs};nativeAudioNode=createNativeChannelMergerNode2(nativeOfflineAudioContext,options)}return renderedNativeAudioNodes.set(nativeOfflineAudioContext,nativeAudioNode),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeAudioNode,trace),nativeAudioNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeAudioNode=renderedNativeAudioNodes.get(nativeOfflineAudioContext);return renderedNativeAudioNode!==void 0?Promise.resolve(renderedNativeAudioNode):createAudioNode(proxy,nativeOfflineAudioContext,trace)}}};var DEFAULT_OPTIONS7={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},createChannelSplitterNodeConstructor=(audioNodeConstructor2,createChannelSplitterNodeRenderer2,createNativeChannelSplitterNode2,getNativeContext2,isNativeOfflineAudioContext2,sanitizeChannelSplitterOptions2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=sanitizeChannelSplitterOptions2(__spreadValues(__spreadValues({},DEFAULT_OPTIONS7),options)),nativeChannelSplitterNode=createNativeChannelSplitterNode2(nativeContext,mergedOptions),channelSplitterNodeRenderer=isNativeOfflineAudioContext2(nativeContext)?createChannelSplitterNodeRenderer2():null;super(context4,!1,nativeChannelSplitterNode,channelSplitterNodeRenderer)}};var createChannelSplitterNodeRendererFactory=(createNativeChannelSplitterNode2,getNativeAudioNode2,renderInputsOfAudioNode2)=>()=>{let renderedNativeAudioNodes=new WeakMap,createAudioNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAudioNode=getNativeAudioNode2(proxy);if(!isOwnedByContext(nativeAudioNode,nativeOfflineAudioContext)){let options={channelCount:nativeAudioNode.channelCount,channelCountMode:nativeAudioNode.channelCountMode,channelInterpretation:nativeAudioNode.channelInterpretation,numberOfOutputs:nativeAudioNode.numberOfOutputs};nativeAudioNode=createNativeChannelSplitterNode2(nativeOfflineAudioContext,options)}return renderedNativeAudioNodes.set(nativeOfflineAudioContext,nativeAudioNode),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeAudioNode,trace),nativeAudioNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeAudioNode=renderedNativeAudioNodes.get(nativeOfflineAudioContext);return renderedNativeAudioNode!==void 0?Promise.resolve(renderedNativeAudioNode):createAudioNode(proxy,nativeOfflineAudioContext,trace)}}};var createConnectAudioParam=renderInputsOfAudioParam2=>(nativeOfflineAudioContext,audioParam,nativeAudioParam,trace)=>renderInputsOfAudioParam2(audioParam,nativeOfflineAudioContext,nativeAudioParam,trace);var createConnectMultipleOutputs=createIndexSizeError2=>(outputAudioNodes,destination,output=0,input=0)=>{let outputAudioNode=outputAudioNodes[output];if(outputAudioNode===void 0)throw createIndexSizeError2();return isNativeAudioNode(destination)?outputAudioNode.connect(destination,0,input):outputAudioNode.connect(destination,0)};var createConnectedNativeAudioBufferSourceNodeFactory=createNativeAudioBufferSourceNode2=>(nativeContext,nativeAudioNode)=>{let nativeAudioBufferSourceNode=createNativeAudioBufferSourceNode2(nativeContext,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),nativeAudioBuffer=nativeContext.createBuffer(1,2,44100);return nativeAudioBufferSourceNode.buffer=nativeAudioBuffer,nativeAudioBufferSourceNode.loop=!0,nativeAudioBufferSourceNode.connect(nativeAudioNode),nativeAudioBufferSourceNode.start(),()=>{nativeAudioBufferSourceNode.stop(),nativeAudioBufferSourceNode.disconnect(nativeAudioNode)}};var DEFAULT_OPTIONS8={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},createConstantSourceNodeConstructor=(audioNodeConstructor2,createAudioParam2,createConstantSourceNodeRendererFactory2,createNativeConstantSourceNode2,getNativeContext2,isNativeOfflineAudioContext2,wrapEventListener2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS8),options),nativeConstantSourceNode=createNativeConstantSourceNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),constantSourceNodeRenderer=isOffline?createConstantSourceNodeRendererFactory2():null;super(context4,!1,nativeConstantSourceNode,constantSourceNodeRenderer);this._constantSourceNodeRenderer=constantSourceNodeRenderer,this._nativeConstantSourceNode=nativeConstantSourceNode,this._offset=createAudioParam2(this,isOffline,nativeConstantSourceNode.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(value){let wrappedListener=typeof value=="function"?wrapEventListener2(this,value):null;this._nativeConstantSourceNode.onended=wrappedListener;let nativeOnEnded=this._nativeConstantSourceNode.onended;this._onended=nativeOnEnded!==null&&nativeOnEnded===wrappedListener?value:nativeOnEnded}start(when=0){if(this._nativeConstantSourceNode.start(when),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=when),this.context.state!=="closed"){setInternalStateToActive(this);let resetInternalStateToPassive=()=>{this._nativeConstantSourceNode.removeEventListener("ended",resetInternalStateToPassive),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeConstantSourceNode.addEventListener("ended",resetInternalStateToPassive)}}stop(when=0){this._nativeConstantSourceNode.stop(when),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=when)}};var createConstantSourceNodeRendererFactory=(connectAudioParam2,createNativeConstantSourceNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeConstantSourceNodes=new WeakMap,start2=null,stop=null,createConstantSourceNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeConstantSourceNode=getNativeAudioNode2(proxy),nativeConstantSourceNodeIsOwnedByContext=isOwnedByContext(nativeConstantSourceNode,nativeOfflineAudioContext);if(!nativeConstantSourceNodeIsOwnedByContext){let options={channelCount:nativeConstantSourceNode.channelCount,channelCountMode:nativeConstantSourceNode.channelCountMode,channelInterpretation:nativeConstantSourceNode.channelInterpretation,offset:nativeConstantSourceNode.offset.value};nativeConstantSourceNode=createNativeConstantSourceNode2(nativeOfflineAudioContext,options),start2!==null&&nativeConstantSourceNode.start(start2),stop!==null&&nativeConstantSourceNode.stop(stop)}return renderedNativeConstantSourceNodes.set(nativeOfflineAudioContext,nativeConstantSourceNode),nativeConstantSourceNodeIsOwnedByContext?await connectAudioParam2(nativeOfflineAudioContext,proxy.offset,nativeConstantSourceNode.offset,trace):await renderAutomation2(nativeOfflineAudioContext,proxy.offset,nativeConstantSourceNode.offset,trace),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeConstantSourceNode,trace),nativeConstantSourceNode};return{set start(value){start2=value},set stop(value){stop=value},render(proxy,nativeOfflineAudioContext,trace){let renderedNativeConstantSourceNode=renderedNativeConstantSourceNodes.get(nativeOfflineAudioContext);return renderedNativeConstantSourceNode!==void 0?Promise.resolve(renderedNativeConstantSourceNode):createConstantSourceNode(proxy,nativeOfflineAudioContext,trace)}}};var createConvertNumberToUnsignedLong=unit32Array=>value=>(unit32Array[0]=value,unit32Array[0]);var DEFAULT_OPTIONS9={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},createConvolverNodeConstructor=(audioNodeConstructor2,createConvolverNodeRenderer2,createNativeConvolverNode2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS9),options),nativeConvolverNode=createNativeConvolverNode2(nativeContext,mergedOptions),convolverNodeRenderer=isNativeOfflineAudioContext2(nativeContext)?createConvolverNodeRenderer2():null;super(context4,!1,nativeConvolverNode,convolverNodeRenderer);this._isBufferNullified=!1,this._nativeConvolverNode=nativeConvolverNode,mergedOptions.buffer!==null&&setAudioNodeTailTime2(this,mergedOptions.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(value){if(this._nativeConvolverNode.buffer=value,value===null&&this._nativeConvolverNode.buffer!==null){let nativeContext=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=nativeContext.createBuffer(1,1,44100),this._isBufferNullified=!0,setAudioNodeTailTime2(this,0)}else this._isBufferNullified=!1,setAudioNodeTailTime2(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(value){this._nativeConvolverNode.normalize=value}};var createConvolverNodeRendererFactory=(createNativeConvolverNode2,getNativeAudioNode2,renderInputsOfAudioNode2)=>()=>{let renderedNativeConvolverNodes=new WeakMap,createConvolverNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeConvolverNode=getNativeAudioNode2(proxy);if(!isOwnedByContext(nativeConvolverNode,nativeOfflineAudioContext)){let options={buffer:nativeConvolverNode.buffer,channelCount:nativeConvolverNode.channelCount,channelCountMode:nativeConvolverNode.channelCountMode,channelInterpretation:nativeConvolverNode.channelInterpretation,disableNormalization:!nativeConvolverNode.normalize};nativeConvolverNode=createNativeConvolverNode2(nativeOfflineAudioContext,options)}return renderedNativeConvolverNodes.set(nativeOfflineAudioContext,nativeConvolverNode),isNativeAudioNodeFaker(nativeConvolverNode)?await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeConvolverNode.inputs[0],trace):await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeConvolverNode,trace),nativeConvolverNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeConvolverNode=renderedNativeConvolverNodes.get(nativeOfflineAudioContext);return renderedNativeConvolverNode!==void 0?Promise.resolve(renderedNativeConvolverNode):createConvolverNode(proxy,nativeOfflineAudioContext,trace)}}};var createCreateNativeOfflineAudioContext=(createNotSupportedError2,nativeOfflineAudioContextConstructor2)=>(numberOfChannels,length,sampleRate)=>{if(nativeOfflineAudioContextConstructor2===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new nativeOfflineAudioContextConstructor2(numberOfChannels,length,sampleRate)}catch(err){throw err.name==="SyntaxError"?createNotSupportedError2():err}};var createDataCloneError=()=>new DOMException("","DataCloneError");var detachArrayBuffer=arrayBuffer=>{let{port1,port2}=new MessageChannel;return new Promise(resolve4=>{port2.onmessage=()=>{port1.close(),port2.close(),resolve4()},port1.postMessage(arrayBuffer,[arrayBuffer])})};var createDecodeAudioData=(audioBufferStore2,cacheTestResult2,createDataCloneError2,createEncodingError2,detachedArrayBuffers,getNativeContext2,isNativeContext2,testAudioBufferCopyChannelMethodsOutOfBoundsSupport2,testPromiseSupport2,wrapAudioBufferCopyChannelMethods2,wrapAudioBufferCopyChannelMethodsOutOfBounds2)=>(anyContext,audioData)=>{let nativeContext=isNativeContext2(anyContext)?anyContext:getNativeContext2(anyContext);if(detachedArrayBuffers.has(audioData)){let err=createDataCloneError2();return Promise.reject(err)}try{detachedArrayBuffers.add(audioData)}catch(e){}return cacheTestResult2(testPromiseSupport2,()=>testPromiseSupport2(nativeContext))?nativeContext.decodeAudioData(audioData).then(audioBuffer=>(detachArrayBuffer(audioData).catch(()=>{}),cacheTestResult2(testAudioBufferCopyChannelMethodsOutOfBoundsSupport2,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport2(audioBuffer))||wrapAudioBufferCopyChannelMethodsOutOfBounds2(audioBuffer),audioBufferStore2.add(audioBuffer),audioBuffer)):new Promise((resolve4,reject2)=>{let complete=async()=>{try{await detachArrayBuffer(audioData)}catch(e){}},fail=err=>{reject2(err),complete()};try{nativeContext.decodeAudioData(audioData,audioBuffer=>{typeof audioBuffer.copyFromChannel!="function"&&(wrapAudioBufferCopyChannelMethods2(audioBuffer),wrapAudioBufferGetChannelDataMethod(audioBuffer)),audioBufferStore2.add(audioBuffer),complete().then(()=>resolve4(audioBuffer))},err=>{fail(err===null?createEncodingError2():err)})}catch(err){fail(err)}})};var createDecrementCycleCounter=(connectNativeAudioNodeToNativeAudioNode2,cycleCounters,getAudioNodeConnections2,getNativeAudioNode2,getNativeAudioParam2,getNativeContext2,isActiveAudioNode2,isNativeOfflineAudioContext2)=>(audioNode,count2)=>{let cycleCounter=cycleCounters.get(audioNode);if(cycleCounter===void 0)throw new Error("Missing the expected cycle count.");let nativeContext=getNativeContext2(audioNode.context),isOffline=isNativeOfflineAudioContext2(nativeContext);if(cycleCounter===count2){if(cycleCounters.delete(audioNode),!isOffline&&isActiveAudioNode2(audioNode)){let nativeSourceAudioNode=getNativeAudioNode2(audioNode),{outputs}=getAudioNodeConnections2(audioNode);for(let output of outputs)if(isAudioNodeOutputConnection(output)){let nativeDestinationAudioNode=getNativeAudioNode2(output[0]);connectNativeAudioNodeToNativeAudioNode2(nativeSourceAudioNode,nativeDestinationAudioNode,output[1],output[2])}else{let nativeDestinationAudioParam=getNativeAudioParam2(output[0]);nativeSourceAudioNode.connect(nativeDestinationAudioParam,output[1])}}}else cycleCounters.set(audioNode,cycleCounter-count2)};var DEFAULT_OPTIONS10={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},createDelayNodeConstructor=(audioNodeConstructor2,createAudioParam2,createDelayNodeRenderer2,createNativeDelayNode2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS10),options),nativeDelayNode=createNativeDelayNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),delayNodeRenderer=isOffline?createDelayNodeRenderer2(mergedOptions.maxDelayTime):null;super(context4,!1,nativeDelayNode,delayNodeRenderer);this._delayTime=createAudioParam2(this,isOffline,nativeDelayNode.delayTime),setAudioNodeTailTime2(this,mergedOptions.maxDelayTime)}get delayTime(){return this._delayTime}};var createDelayNodeRendererFactory=(connectAudioParam2,createNativeDelayNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>maxDelayTime=>{let renderedNativeDelayNodes=new WeakMap,createDelayNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeDelayNode=getNativeAudioNode2(proxy),nativeDelayNodeIsOwnedByContext=isOwnedByContext(nativeDelayNode,nativeOfflineAudioContext);if(!nativeDelayNodeIsOwnedByContext){let options={channelCount:nativeDelayNode.channelCount,channelCountMode:nativeDelayNode.channelCountMode,channelInterpretation:nativeDelayNode.channelInterpretation,delayTime:nativeDelayNode.delayTime.value,maxDelayTime};nativeDelayNode=createNativeDelayNode2(nativeOfflineAudioContext,options)}return renderedNativeDelayNodes.set(nativeOfflineAudioContext,nativeDelayNode),nativeDelayNodeIsOwnedByContext?await connectAudioParam2(nativeOfflineAudioContext,proxy.delayTime,nativeDelayNode.delayTime,trace):await renderAutomation2(nativeOfflineAudioContext,proxy.delayTime,nativeDelayNode.delayTime,trace),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeDelayNode,trace),nativeDelayNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeDelayNode=renderedNativeDelayNodes.get(nativeOfflineAudioContext);return renderedNativeDelayNode!==void 0?Promise.resolve(renderedNativeDelayNode):createDelayNode(proxy,nativeOfflineAudioContext,trace)}}};var createDeleteActiveInputConnectionToAudioNode=pickElementFromSet2=>(activeInputs,source,output,input)=>pickElementFromSet2(activeInputs[input],activeInputConnection=>activeInputConnection[0]===source&&activeInputConnection[1]===output);var createDeleteUnrenderedAudioWorkletNode=getUnrenderedAudioWorkletNodes2=>(nativeContext,audioWorkletNode)=>{getUnrenderedAudioWorkletNodes2(nativeContext).delete(audioWorkletNode)};var isDelayNode=audioNode=>"delayTime"in audioNode;var createDetectCycles=(audioParamAudioNodeStore2,getAudioNodeConnections2,getValueForKey2)=>function detectCycles(chain,nextLink){let audioNode=isAudioNode(nextLink)?nextLink:getValueForKey2(audioParamAudioNodeStore2,nextLink);if(isDelayNode(audioNode))return[];if(chain[0]===audioNode)return[chain];if(chain.includes(audioNode))return[];let{outputs}=getAudioNodeConnections2(audioNode);return Array.from(outputs).map(outputConnection=>detectCycles([...chain,audioNode],outputConnection[0])).reduce((mergedCycles,nestedCycles)=>mergedCycles.concat(nestedCycles),[])};var getOutputAudioNodeAtIndex=(createIndexSizeError2,outputAudioNodes,output)=>{let outputAudioNode=outputAudioNodes[output];if(outputAudioNode===void 0)throw createIndexSizeError2();return outputAudioNode},createDisconnectMultipleOutputs=createIndexSizeError2=>(outputAudioNodes,destinationOrOutput=void 0,output=void 0,input=0)=>destinationOrOutput===void 0?outputAudioNodes.forEach(outputAudioNode=>outputAudioNode.disconnect()):typeof destinationOrOutput=="number"?getOutputAudioNodeAtIndex(createIndexSizeError2,outputAudioNodes,destinationOrOutput).disconnect():isNativeAudioNode(destinationOrOutput)?output===void 0?outputAudioNodes.forEach(outputAudioNode=>outputAudioNode.disconnect(destinationOrOutput)):input===void 0?getOutputAudioNodeAtIndex(createIndexSizeError2,outputAudioNodes,output).disconnect(destinationOrOutput,0):getOutputAudioNodeAtIndex(createIndexSizeError2,outputAudioNodes,output).disconnect(destinationOrOutput,0,input):output===void 0?outputAudioNodes.forEach(outputAudioNode=>outputAudioNode.disconnect(destinationOrOutput)):getOutputAudioNodeAtIndex(createIndexSizeError2,outputAudioNodes,output).disconnect(destinationOrOutput,0);var DEFAULT_OPTIONS11={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},createDynamicsCompressorNodeConstructor=(audioNodeConstructor2,createAudioParam2,createDynamicsCompressorNodeRenderer2,createNativeDynamicsCompressorNode2,createNotSupportedError2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS11),options),nativeDynamicsCompressorNode=createNativeDynamicsCompressorNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),dynamicsCompressorNodeRenderer=isOffline?createDynamicsCompressorNodeRenderer2():null;super(context4,!1,nativeDynamicsCompressorNode,dynamicsCompressorNodeRenderer);this._attack=createAudioParam2(this,isOffline,nativeDynamicsCompressorNode.attack),this._knee=createAudioParam2(this,isOffline,nativeDynamicsCompressorNode.knee),this._nativeDynamicsCompressorNode=nativeDynamicsCompressorNode,this._ratio=createAudioParam2(this,isOffline,nativeDynamicsCompressorNode.ratio),this._release=createAudioParam2(this,isOffline,nativeDynamicsCompressorNode.release),this._threshold=createAudioParam2(this,isOffline,nativeDynamicsCompressorNode.threshold),setAudioNodeTailTime2(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(value){let previousChannelCount=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=value,value>2)throw this._nativeDynamicsCompressorNode.channelCount=previousChannelCount,createNotSupportedError2()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(value){let previousChannelCount=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=value,value==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=previousChannelCount,createNotSupportedError2()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}};var createDynamicsCompressorNodeRendererFactory=(connectAudioParam2,createNativeDynamicsCompressorNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeDynamicsCompressorNodes=new WeakMap,createDynamicsCompressorNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeDynamicsCompressorNode=getNativeAudioNode2(proxy),nativeDynamicsCompressorNodeIsOwnedByContext=isOwnedByContext(nativeDynamicsCompressorNode,nativeOfflineAudioContext);if(!nativeDynamicsCompressorNodeIsOwnedByContext){let options={attack:nativeDynamicsCompressorNode.attack.value,channelCount:nativeDynamicsCompressorNode.channelCount,channelCountMode:nativeDynamicsCompressorNode.channelCountMode,channelInterpretation:nativeDynamicsCompressorNode.channelInterpretation,knee:nativeDynamicsCompressorNode.knee.value,ratio:nativeDynamicsCompressorNode.ratio.value,release:nativeDynamicsCompressorNode.release.value,threshold:nativeDynamicsCompressorNode.threshold.value};nativeDynamicsCompressorNode=createNativeDynamicsCompressorNode2(nativeOfflineAudioContext,options)}return renderedNativeDynamicsCompressorNodes.set(nativeOfflineAudioContext,nativeDynamicsCompressorNode),nativeDynamicsCompressorNodeIsOwnedByContext?(await connectAudioParam2(nativeOfflineAudioContext,proxy.attack,nativeDynamicsCompressorNode.attack,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.knee,nativeDynamicsCompressorNode.knee,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.ratio,nativeDynamicsCompressorNode.ratio,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.release,nativeDynamicsCompressorNode.release,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.threshold,nativeDynamicsCompressorNode.threshold,trace)):(await renderAutomation2(nativeOfflineAudioContext,proxy.attack,nativeDynamicsCompressorNode.attack,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.knee,nativeDynamicsCompressorNode.knee,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.ratio,nativeDynamicsCompressorNode.ratio,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.release,nativeDynamicsCompressorNode.release,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.threshold,nativeDynamicsCompressorNode.threshold,trace)),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeDynamicsCompressorNode,trace),nativeDynamicsCompressorNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeDynamicsCompressorNode=renderedNativeDynamicsCompressorNodes.get(nativeOfflineAudioContext);return renderedNativeDynamicsCompressorNode!==void 0?Promise.resolve(renderedNativeDynamicsCompressorNode):createDynamicsCompressorNode(proxy,nativeOfflineAudioContext,trace)}}};var createEncodingError=()=>new DOMException("","EncodingError");var createEvaluateSource=window3=>source=>new Promise((resolve4,reject2)=>{if(window3===null){reject2(new SyntaxError);return}let head=window3.document.head;if(head===null)reject2(new SyntaxError);else{let script=window3.document.createElement("script"),blob=new Blob([source],{type:"application/javascript"}),url3=URL.createObjectURL(blob),originalOnErrorHandler=window3.onerror,removeErrorEventListenerAndRevokeUrl=()=>{window3.onerror=originalOnErrorHandler,URL.revokeObjectURL(url3)};window3.onerror=(message,src,lineno,colno,error)=>{if(src===url3||src===window3.location.href&&lineno===1&&colno===1)return removeErrorEventListenerAndRevokeUrl(),reject2(error),!1;if(originalOnErrorHandler!==null)return originalOnErrorHandler(message,src,lineno,colno,error)},script.onerror=()=>{removeErrorEventListenerAndRevokeUrl(),reject2(new SyntaxError)},script.onload=()=>{removeErrorEventListenerAndRevokeUrl(),resolve4()},script.src=url3,script.type="module",head.appendChild(script)}});var createEventTargetConstructor=wrapEventListener2=>class{constructor(_nativeEventTarget){this._nativeEventTarget=_nativeEventTarget,this._listeners=new WeakMap}addEventListener(type,listener,options){if(listener!==null){let wrappedEventListener=this._listeners.get(listener);wrappedEventListener===void 0&&(wrappedEventListener=wrapEventListener2(this,listener),typeof listener=="function"&&this._listeners.set(listener,wrappedEventListener)),this._nativeEventTarget.addEventListener(type,wrappedEventListener,options)}}dispatchEvent(event){return this._nativeEventTarget.dispatchEvent(event)}removeEventListener(type,listener,options){let wrappedEventListener=listener===null?void 0:this._listeners.get(listener);this._nativeEventTarget.removeEventListener(type,wrappedEventListener===void 0?null:wrappedEventListener,options)}};var createExposeCurrentFrameAndCurrentTime=window3=>(currentTime,sampleRate,fn)=>{Object.defineProperties(window3,{currentFrame:{configurable:!0,get(){return Math.round(currentTime*sampleRate)}},currentTime:{configurable:!0,get(){return currentTime}}});try{return fn()}finally{window3!==null&&(delete window3.currentFrame,delete window3.currentTime)}};var createFetchSource=createAbortError2=>async url3=>{try{let response2=await fetch(url3);if(response2.ok)return[await response2.text(),response2.url]}catch(e){}throw createAbortError2()};var DEFAULT_OPTIONS12={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},createGainNodeConstructor=(audioNodeConstructor2,createAudioParam2,createGainNodeRenderer2,createNativeGainNode2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS12),options),nativeGainNode=createNativeGainNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),gainNodeRenderer=isOffline?createGainNodeRenderer2():null;super(context4,!1,nativeGainNode,gainNodeRenderer);this._gain=createAudioParam2(this,isOffline,nativeGainNode.gain,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get gain(){return this._gain}};var createGainNodeRendererFactory=(connectAudioParam2,createNativeGainNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeGainNodes=new WeakMap,createGainNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeGainNode=getNativeAudioNode2(proxy),nativeGainNodeIsOwnedByContext=isOwnedByContext(nativeGainNode,nativeOfflineAudioContext);if(!nativeGainNodeIsOwnedByContext){let options={channelCount:nativeGainNode.channelCount,channelCountMode:nativeGainNode.channelCountMode,channelInterpretation:nativeGainNode.channelInterpretation,gain:nativeGainNode.gain.value};nativeGainNode=createNativeGainNode2(nativeOfflineAudioContext,options)}return renderedNativeGainNodes.set(nativeOfflineAudioContext,nativeGainNode),nativeGainNodeIsOwnedByContext?await connectAudioParam2(nativeOfflineAudioContext,proxy.gain,nativeGainNode.gain,trace):await renderAutomation2(nativeOfflineAudioContext,proxy.gain,nativeGainNode.gain,trace),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeGainNode,trace),nativeGainNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeGainNode=renderedNativeGainNodes.get(nativeOfflineAudioContext);return renderedNativeGainNode!==void 0?Promise.resolve(renderedNativeGainNode):createGainNode(proxy,nativeOfflineAudioContext,trace)}}};var createGetActiveAudioWorkletNodeInputs=(activeAudioWorkletNodeInputsStore2,getValueForKey2)=>nativeAudioWorkletNode=>getValueForKey2(activeAudioWorkletNodeInputsStore2,nativeAudioWorkletNode);var createGetAudioNodeRenderer=getAudioNodeConnections2=>audioNode=>{let audioNodeConnections=getAudioNodeConnections2(audioNode);if(audioNodeConnections.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return audioNodeConnections.renderer};var createGetAudioNodeTailTime=audioNodeTailTimeStore2=>audioNode=>{var _a3;return(_a3=audioNodeTailTimeStore2.get(audioNode))!==null&&_a3!==void 0?_a3:0};var createGetAudioParamRenderer=getAudioParamConnections2=>audioParam=>{let audioParamConnections=getAudioParamConnections2(audioParam);if(audioParamConnections.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return audioParamConnections.renderer};var createGetBackupOfflineAudioContext=backupOfflineAudioContextStore2=>nativeContext=>backupOfflineAudioContextStore2.get(nativeContext);var createInvalidStateError=()=>new DOMException("","InvalidStateError");var createGetNativeContext=contextStore=>context4=>{let nativeContext=contextStore.get(context4);if(nativeContext===void 0)throw createInvalidStateError();return nativeContext};var createGetOrCreateBackupOfflineAudioContext=(backupOfflineAudioContextStore2,nativeOfflineAudioContextConstructor2)=>nativeContext=>{let backupOfflineAudioContext=backupOfflineAudioContextStore2.get(nativeContext);if(backupOfflineAudioContext!==void 0)return backupOfflineAudioContext;if(nativeOfflineAudioContextConstructor2===null)throw new Error("Missing the native OfflineAudioContext constructor.");return backupOfflineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100),backupOfflineAudioContextStore2.set(nativeContext,backupOfflineAudioContext),backupOfflineAudioContext};var createGetUnrenderedAudioWorkletNodes=unrenderedAudioWorkletNodeStore2=>nativeContext=>{let unrenderedAudioWorkletNodes=unrenderedAudioWorkletNodeStore2.get(nativeContext);if(unrenderedAudioWorkletNodes===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return unrenderedAudioWorkletNodes};var createInvalidAccessError=()=>new DOMException("","InvalidAccessError");var wrapIIRFilterNodeGetFrequencyResponseMethod=nativeIIRFilterNode=>{nativeIIRFilterNode.getFrequencyResponse=(getFrequencyResponse=>(frequencyHz,magResponse,phaseResponse)=>{if(frequencyHz.length!==magResponse.length||magResponse.length!==phaseResponse.length)throw createInvalidAccessError();return getFrequencyResponse.call(nativeIIRFilterNode,frequencyHz,magResponse,phaseResponse)})(nativeIIRFilterNode.getFrequencyResponse)};var DEFAULT_OPTIONS13={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},createIIRFilterNodeConstructor=(audioNodeConstructor2,createNativeIIRFilterNode2,createIIRFilterNodeRenderer2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),isOffline=isNativeOfflineAudioContext2(nativeContext),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS13),options),nativeIIRFilterNode=createNativeIIRFilterNode2(nativeContext,isOffline?null:context4.baseLatency,mergedOptions),iirFilterNodeRenderer=isOffline?createIIRFilterNodeRenderer2(mergedOptions.feedback,mergedOptions.feedforward):null;super(context4,!1,nativeIIRFilterNode,iirFilterNodeRenderer);wrapIIRFilterNodeGetFrequencyResponseMethod(nativeIIRFilterNode),this._nativeIIRFilterNode=nativeIIRFilterNode,setAudioNodeTailTime2(this,1)}getFrequencyResponse(frequencyHz,magResponse,phaseResponse){return this._nativeIIRFilterNode.getFrequencyResponse(frequencyHz,magResponse,phaseResponse)}};var filterBuffer=(feedback,feedbackLength,feedforward,feedforwardLength,minLength,xBuffer,yBuffer,bufferIndex,bufferLength,input,output)=>{let inputLength=input.length,i=bufferIndex;for(let j=0;j<inputLength;j+=1){let y=feedforward[0]*input[j];for(let k=1;k<minLength;k+=1){let x=i-k&bufferLength-1;y+=feedforward[k]*xBuffer[x],y-=feedback[k]*yBuffer[x]}for(let k=minLength;k<feedforwardLength;k+=1)y+=feedforward[k]*xBuffer[i-k&bufferLength-1];for(let k=minLength;k<feedbackLength;k+=1)y-=feedback[k]*yBuffer[i-k&bufferLength-1];xBuffer[i]=input[j],yBuffer[i]=y,i=i+1&bufferLength-1,output[j]=y}return i};var filterFullBuffer=(renderedBuffer,nativeOfflineAudioContext,feedback,feedforward)=>{let convertedFeedback=feedback instanceof Float64Array?feedback:new Float64Array(feedback),convertedFeedforward=feedforward instanceof Float64Array?feedforward:new Float64Array(feedforward),feedbackLength=convertedFeedback.length,feedforwardLength=convertedFeedforward.length,minLength=Math.min(feedbackLength,feedforwardLength);if(convertedFeedback[0]!==1){for(let i=0;i<feedbackLength;i+=1)convertedFeedforward[i]/=convertedFeedback[0];for(let i=1;i<feedforwardLength;i+=1)convertedFeedback[i]/=convertedFeedback[0]}let bufferLength=32,xBuffer=new Float32Array(bufferLength),yBuffer=new Float32Array(bufferLength),filteredBuffer=nativeOfflineAudioContext.createBuffer(renderedBuffer.numberOfChannels,renderedBuffer.length,renderedBuffer.sampleRate),numberOfChannels=renderedBuffer.numberOfChannels;for(let i=0;i<numberOfChannels;i+=1){let input=renderedBuffer.getChannelData(i),output=filteredBuffer.getChannelData(i);xBuffer.fill(0),yBuffer.fill(0),filterBuffer(convertedFeedback,feedbackLength,convertedFeedforward,feedforwardLength,minLength,xBuffer,yBuffer,0,bufferLength,input,output)}return filteredBuffer},createIIRFilterNodeRendererFactory=(createNativeAudioBufferSourceNode2,getNativeAudioNode2,nativeOfflineAudioContextConstructor2,renderInputsOfAudioNode2,renderNativeOfflineAudioContext2)=>(feedback,feedforward)=>{let renderedNativeAudioNodes=new WeakMap,filteredBufferPromise=null,createAudioNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeAudioBufferSourceNode=null,nativeIIRFilterNode=getNativeAudioNode2(proxy),nativeIIRFilterNodeIsOwnedByContext=isOwnedByContext(nativeIIRFilterNode,nativeOfflineAudioContext);if(nativeOfflineAudioContext.createIIRFilter===void 0?nativeAudioBufferSourceNode=createNativeAudioBufferSourceNode2(nativeOfflineAudioContext,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):nativeIIRFilterNodeIsOwnedByContext||(nativeIIRFilterNode=nativeOfflineAudioContext.createIIRFilter(feedforward,feedback)),renderedNativeAudioNodes.set(nativeOfflineAudioContext,nativeAudioBufferSourceNode===null?nativeIIRFilterNode:nativeAudioBufferSourceNode),nativeAudioBufferSourceNode!==null){if(filteredBufferPromise===null){if(nativeOfflineAudioContextConstructor2===null)throw new Error("Missing the native OfflineAudioContext constructor.");let partialOfflineAudioContext=new nativeOfflineAudioContextConstructor2(proxy.context.destination.channelCount,proxy.context.length,nativeOfflineAudioContext.sampleRate);filteredBufferPromise=(async()=>{await renderInputsOfAudioNode2(proxy,partialOfflineAudioContext,partialOfflineAudioContext.destination,trace);let renderedBuffer=await renderNativeOfflineAudioContext2(partialOfflineAudioContext);return filterFullBuffer(renderedBuffer,nativeOfflineAudioContext,feedback,feedforward)})()}let filteredBuffer=await filteredBufferPromise;return nativeAudioBufferSourceNode.buffer=filteredBuffer,nativeAudioBufferSourceNode.start(0),nativeAudioBufferSourceNode}return await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeIIRFilterNode,trace),nativeIIRFilterNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeAudioNode=renderedNativeAudioNodes.get(nativeOfflineAudioContext);return renderedNativeAudioNode!==void 0?Promise.resolve(renderedNativeAudioNode):createAudioNode(proxy,nativeOfflineAudioContext,trace)}}};var createIncrementCycleCounterFactory=(cycleCounters,disconnectNativeAudioNodeFromNativeAudioNode2,getAudioNodeConnections2,getNativeAudioNode2,getNativeAudioParam2,isActiveAudioNode2)=>isOffline=>(audioNode,count2)=>{let cycleCounter=cycleCounters.get(audioNode);if(cycleCounter===void 0){if(!isOffline&&isActiveAudioNode2(audioNode)){let nativeSourceAudioNode=getNativeAudioNode2(audioNode),{outputs}=getAudioNodeConnections2(audioNode);for(let output of outputs)if(isAudioNodeOutputConnection(output)){let nativeDestinationAudioNode=getNativeAudioNode2(output[0]);disconnectNativeAudioNodeFromNativeAudioNode2(nativeSourceAudioNode,nativeDestinationAudioNode,output[1],output[2])}else{let nativeDestinationAudioParam=getNativeAudioParam2(output[0]);nativeSourceAudioNode.disconnect(nativeDestinationAudioParam,output[1])}}cycleCounters.set(audioNode,count2)}else cycleCounters.set(audioNode,cycleCounter+count2)};var createIsAnyAudioContext=(contextStore,isNativeAudioContext2)=>anything=>{let nativeContext=contextStore.get(anything);return isNativeAudioContext2(nativeContext)||isNativeAudioContext2(anything)};var createIsAnyAudioNode=(audioNodeStore,isNativeAudioNode3)=>anything=>audioNodeStore.has(anything)||isNativeAudioNode3(anything);var createIsAnyAudioParam=(audioParamStore,isNativeAudioParam2)=>anything=>audioParamStore.has(anything)||isNativeAudioParam2(anything);var createIsAnyOfflineAudioContext=(contextStore,isNativeOfflineAudioContext2)=>anything=>{let nativeContext=contextStore.get(anything);return isNativeOfflineAudioContext2(nativeContext)||isNativeOfflineAudioContext2(anything)};var createIsNativeAudioContext=nativeAudioContextConstructor2=>anything=>nativeAudioContextConstructor2!==null&&anything instanceof nativeAudioContextConstructor2;var createIsNativeAudioNode=window3=>anything=>window3!==null&&typeof window3.AudioNode=="function"&&anything instanceof window3.AudioNode;var createIsNativeAudioParam=window3=>anything=>window3!==null&&typeof window3.AudioParam=="function"&&anything instanceof window3.AudioParam;var createIsNativeContext=(isNativeAudioContext2,isNativeOfflineAudioContext2)=>anything=>isNativeAudioContext2(anything)||isNativeOfflineAudioContext2(anything);var createIsNativeOfflineAudioContext=nativeOfflineAudioContextConstructor2=>anything=>nativeOfflineAudioContextConstructor2!==null&&anything instanceof nativeOfflineAudioContextConstructor2;var createIsSecureContext=window3=>window3!==null&&window3.isSecureContext;var createIsSupportedPromise=async(cacheTestResult2,testAudioBufferCopyChannelMethodsSubarraySupport,testAudioContextCloseMethodSupport,testAudioContextDecodeAudioDataMethodTypeErrorSupport,testAudioContextOptionsSupport,testAudioNodeConnectMethodSupport,testAudioWorkletProcessorNoOutputsSupport,testChannelMergerNodeChannelCountSupport,testConstantSourceNodeAccurateSchedulingSupport,testConvolverNodeBufferReassignabilitySupport,testConvolverNodeChannelCountSupport,testDomExceptionContrucorSupport,testIsSecureContextSupport,testMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport,testStereoPannerNodeDefaultValueSupport,testTransferablesSupport2)=>cacheTestResult2(testAudioBufferCopyChannelMethodsSubarraySupport,testAudioBufferCopyChannelMethodsSubarraySupport)&&cacheTestResult2(testAudioContextCloseMethodSupport,testAudioContextCloseMethodSupport)&&cacheTestResult2(testAudioContextOptionsSupport,testAudioContextOptionsSupport)&&cacheTestResult2(testAudioNodeConnectMethodSupport,testAudioNodeConnectMethodSupport)&&cacheTestResult2(testChannelMergerNodeChannelCountSupport,testChannelMergerNodeChannelCountSupport)&&cacheTestResult2(testConstantSourceNodeAccurateSchedulingSupport,testConstantSourceNodeAccurateSchedulingSupport)&&cacheTestResult2(testConvolverNodeBufferReassignabilitySupport,testConvolverNodeBufferReassignabilitySupport)&&cacheTestResult2(testConvolverNodeChannelCountSupport,testConvolverNodeChannelCountSupport)&&cacheTestResult2(testDomExceptionContrucorSupport,testDomExceptionContrucorSupport)&&cacheTestResult2(testIsSecureContextSupport,testIsSecureContextSupport)&&cacheTestResult2(testMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport,testMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport)?(await Promise.all([cacheTestResult2(testAudioContextDecodeAudioDataMethodTypeErrorSupport,testAudioContextDecodeAudioDataMethodTypeErrorSupport),cacheTestResult2(testAudioWorkletProcessorNoOutputsSupport,testAudioWorkletProcessorNoOutputsSupport),cacheTestResult2(testStereoPannerNodeDefaultValueSupport,testStereoPannerNodeDefaultValueSupport),cacheTestResult2(testTransferablesSupport2,testTransferablesSupport2)])).every(result=>result):!1;var createMediaElementAudioSourceNodeConstructor=(audioNodeConstructor2,createNativeMediaElementAudioSourceNode2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),nativeMediaElementAudioSourceNode=createNativeMediaElementAudioSourceNode2(nativeContext,options);if(isNativeOfflineAudioContext2(nativeContext))throw TypeError();super(context4,!0,nativeMediaElementAudioSourceNode,null);this._nativeMediaElementAudioSourceNode=nativeMediaElementAudioSourceNode}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}};var DEFAULT_OPTIONS14={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},createMediaStreamAudioDestinationNodeConstructor=(audioNodeConstructor2,createNativeMediaStreamAudioDestinationNode2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4);if(isNativeOfflineAudioContext2(nativeContext))throw new TypeError;let mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS14),options),nativeMediaStreamAudioDestinationNode=createNativeMediaStreamAudioDestinationNode2(nativeContext,mergedOptions);super(context4,!1,nativeMediaStreamAudioDestinationNode,null);this._nativeMediaStreamAudioDestinationNode=nativeMediaStreamAudioDestinationNode}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}};var createMediaStreamAudioSourceNodeConstructor=(audioNodeConstructor2,createNativeMediaStreamAudioSourceNode2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),nativeMediaStreamAudioSourceNode=createNativeMediaStreamAudioSourceNode2(nativeContext,options);if(isNativeOfflineAudioContext2(nativeContext))throw new TypeError;super(context4,!0,nativeMediaStreamAudioSourceNode,null);this._nativeMediaStreamAudioSourceNode=nativeMediaStreamAudioSourceNode}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}};var createMediaStreamTrackAudioSourceNodeConstructor=(audioNodeConstructor2,createNativeMediaStreamTrackAudioSourceNode2,getNativeContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),nativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNode2(nativeContext,options);super(context4,!0,nativeMediaStreamTrackAudioSourceNode,null)}};var createMinimalAudioContextConstructor=(createInvalidStateError2,createNotSupportedError2,createUnknownError2,minimalBaseAudioContextConstructor2,nativeAudioContextConstructor2)=>class extends minimalBaseAudioContextConstructor2{constructor(options={}){if(nativeAudioContextConstructor2===null)throw new Error("Missing the native AudioContext constructor.");let nativeAudioContext;try{nativeAudioContext=new nativeAudioContextConstructor2(options)}catch(err){throw err.code===12&&err.message==="sampleRate is not in range"?createNotSupportedError2():err}if(nativeAudioContext===null)throw createUnknownError2();if(!isValidLatencyHint(options.latencyHint))throw new TypeError(`The provided value '${options.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(options.sampleRate!==void 0&&nativeAudioContext.sampleRate!==options.sampleRate)throw createNotSupportedError2();super(nativeAudioContext,2);let{latencyHint}=options,{sampleRate}=nativeAudioContext;if(this._baseLatency=typeof nativeAudioContext.baseLatency=="number"?nativeAudioContext.baseLatency:latencyHint==="balanced"?512/sampleRate:latencyHint==="interactive"||latencyHint===void 0?256/sampleRate:latencyHint==="playback"?1024/sampleRate:Math.max(2,Math.min(128,Math.round(latencyHint*sampleRate/128)))*128/sampleRate,this._nativeAudioContext=nativeAudioContext,nativeAudioContextConstructor2.name==="webkitAudioContext"?(this._nativeGainNode=nativeAudioContext.createGain(),this._nativeOscillatorNode=nativeAudioContext.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(nativeAudioContext.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,nativeAudioContext.state==="running"){this._state="suspended";let revokeState=()=>{this._state==="suspended"&&(this._state=null),nativeAudioContext.removeEventListener("statechange",revokeState)};nativeAudioContext.addEventListener("statechange",revokeState)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw createInvalidStateError2()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)}))}resume(){return this._state==="suspended"?new Promise((resolve4,reject2)=>{let resolvePromise=()=>{this._nativeAudioContext.removeEventListener("statechange",resolvePromise),this._nativeAudioContext.state==="running"?resolve4():this.resume().then(resolve4,reject2)};this._nativeAudioContext.addEventListener("statechange",resolvePromise)}):this._nativeAudioContext.resume().catch(err=>{throw err===void 0||err.code===15?createInvalidStateError2():err})}suspend(){return this._nativeAudioContext.suspend().catch(err=>{throw err===void 0?createInvalidStateError2():err})}};var createMinimalBaseAudioContextConstructor=(audioDestinationNodeConstructor2,createAudioListener2,eventTargetConstructor2,isNativeOfflineAudioContext2,unrenderedAudioWorkletNodeStore2,wrapEventListener2)=>class extends eventTargetConstructor2{constructor(_nativeContext,numberOfChannels){super(_nativeContext);this._nativeContext=_nativeContext,CONTEXT_STORE.set(this,_nativeContext),isNativeOfflineAudioContext2(_nativeContext)&&unrenderedAudioWorkletNodeStore2.set(_nativeContext,new Set),this._destination=new audioDestinationNodeConstructor2(this,numberOfChannels),this._listener=createAudioListener2(this,_nativeContext),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(value){let wrappedListener=typeof value=="function"?wrapEventListener2(this,value):null;this._nativeContext.onstatechange=wrappedListener;let nativeOnStateChange=this._nativeContext.onstatechange;this._onstatechange=nativeOnStateChange!==null&&nativeOnStateChange===wrappedListener?value:nativeOnStateChange}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}};var testPromiseSupport=nativeContext=>{let uint32Array=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let promise=nativeContext.decodeAudioData(uint32Array.buffer,()=>{});return promise===void 0?!1:(promise.catch(()=>{}),!0)}catch(e){}return!1};var DEFAULT_OPTIONS15={numberOfChannels:1},createMinimalOfflineAudioContextConstructor=(cacheTestResult2,createInvalidStateError2,createNativeOfflineAudioContext2,minimalBaseAudioContextConstructor2,startRendering2)=>class extends minimalBaseAudioContextConstructor2{constructor(options){let{length,numberOfChannels,sampleRate}=__spreadValues(__spreadValues({},DEFAULT_OPTIONS15),options),nativeOfflineAudioContext=createNativeOfflineAudioContext2(numberOfChannels,length,sampleRate);cacheTestResult2(testPromiseSupport,()=>testPromiseSupport(nativeOfflineAudioContext))||nativeOfflineAudioContext.addEventListener("statechange",(()=>{let i=0,delayStateChangeEvent=event=>{this._state==="running"&&(i>0?(nativeOfflineAudioContext.removeEventListener("statechange",delayStateChangeEvent),event.stopImmediatePropagation(),this._waitForThePromiseToSettle(event)):i+=1)};return delayStateChangeEvent})()),super(nativeOfflineAudioContext,numberOfChannels),this._length=length,this._nativeOfflineAudioContext=nativeOfflineAudioContext,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(createInvalidStateError2()):(this._state="running",startRendering2(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,deactivateAudioGraph(this)}))}_waitForThePromiseToSettle(event){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(event):setTimeout(()=>this._waitForThePromiseToSettle(event))}};var createMonitorConnections=(insertElementInSet2,isNativeAudioNode3)=>(nativeAudioNode,whenConnected,whenDisconnected)=>{let connections=new Set;return nativeAudioNode.connect=(connect2=>(destination,output=0,input=0)=>{let wasDisconnected=connections.size===0;if(isNativeAudioNode3(destination))return connect2.call(nativeAudioNode,destination,output,input),insertElementInSet2(connections,[destination,output,input],connection=>connection[0]===destination&&connection[1]===output&&connection[2]===input,!0),wasDisconnected&&whenConnected(),destination;connect2.call(nativeAudioNode,destination,output),insertElementInSet2(connections,[destination,output],connection=>connection[0]===destination&&connection[1]===output,!0),wasDisconnected&&whenConnected()})(nativeAudioNode.connect),nativeAudioNode.disconnect=(disconnect2=>(destinationOrOutput,output,input)=>{let wasConnected=connections.size>0;if(destinationOrOutput===void 0)disconnect2.apply(nativeAudioNode),connections.clear();else if(typeof destinationOrOutput=="number"){disconnect2.call(nativeAudioNode,destinationOrOutput);for(let connection of connections)connection[1]===destinationOrOutput&&connections.delete(connection)}else{isNativeAudioNode3(destinationOrOutput)?disconnect2.call(nativeAudioNode,destinationOrOutput,output,input):disconnect2.call(nativeAudioNode,destinationOrOutput,output);for(let connection of connections)connection[0]===destinationOrOutput&&(output===void 0||connection[1]===output)&&(input===void 0||connection[2]===input)&&connections.delete(connection)}let isDisconnected=connections.size===0;wasConnected&&isDisconnected&&whenDisconnected()})(nativeAudioNode.disconnect),nativeAudioNode};var assignNativeAudioNodeOption=(nativeAudioNode,options,option)=>{let value=options[option];value!==void 0&&value!==nativeAudioNode[option]&&(nativeAudioNode[option]=value)};var assignNativeAudioNodeOptions=(nativeAudioNode,options)=>{assignNativeAudioNodeOption(nativeAudioNode,options,"channelCount"),assignNativeAudioNodeOption(nativeAudioNode,options,"channelCountMode"),assignNativeAudioNodeOption(nativeAudioNode,options,"channelInterpretation")};var testAnalyserNodeGetFloatTimeDomainDataMethodSupport=nativeAnalyserNode=>typeof nativeAnalyserNode.getFloatTimeDomainData=="function";var wrapAnalyserNodeGetFloatTimeDomainDataMethod=nativeAnalyserNode=>{nativeAnalyserNode.getFloatTimeDomainData=array=>{let byteTimeDomainData=new Uint8Array(array.length);nativeAnalyserNode.getByteTimeDomainData(byteTimeDomainData);let length=Math.max(byteTimeDomainData.length,nativeAnalyserNode.fftSize);for(let i=0;i<length;i+=1)array[i]=(byteTimeDomainData[i]-128)*.0078125;return array}};var createNativeAnalyserNodeFactory=(cacheTestResult2,createIndexSizeError2)=>(nativeContext,options)=>{let nativeAnalyserNode=nativeContext.createAnalyser();if(assignNativeAudioNodeOptions(nativeAnalyserNode,options),!(options.maxDecibels>options.minDecibels))throw createIndexSizeError2();return assignNativeAudioNodeOption(nativeAnalyserNode,options,"fftSize"),assignNativeAudioNodeOption(nativeAnalyserNode,options,"maxDecibels"),assignNativeAudioNodeOption(nativeAnalyserNode,options,"minDecibels"),assignNativeAudioNodeOption(nativeAnalyserNode,options,"smoothingTimeConstant"),cacheTestResult2(testAnalyserNodeGetFloatTimeDomainDataMethodSupport,()=>testAnalyserNodeGetFloatTimeDomainDataMethodSupport(nativeAnalyserNode))||wrapAnalyserNodeGetFloatTimeDomainDataMethod(nativeAnalyserNode),nativeAnalyserNode};var createNativeAudioBufferConstructor=window3=>window3===null?null:window3.hasOwnProperty("AudioBuffer")?window3.AudioBuffer:null;var assignNativeAudioNodeAudioParamValue=(nativeAudioNode,options,audioParam)=>{let value=options[audioParam];value!==void 0&&value!==nativeAudioNode[audioParam].value&&(nativeAudioNode[audioParam].value=value)};var wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=nativeAudioBufferSourceNode=>{nativeAudioBufferSourceNode.start=(start2=>{let isScheduled=!1;return(when=0,offset=0,duration)=>{if(isScheduled)throw createInvalidStateError();start2.call(nativeAudioBufferSourceNode,when,offset,duration),isScheduled=!0}})(nativeAudioBufferSourceNode.start)};var wrapAudioScheduledSourceNodeStartMethodNegativeParameters=nativeAudioScheduledSourceNode=>{nativeAudioScheduledSourceNode.start=(start2=>(when=0,offset=0,duration)=>{if(typeof duration=="number"&&duration<0||offset<0||when<0)throw new RangeError("The parameters can't be negative.");start2.call(nativeAudioScheduledSourceNode,when,offset,duration)})(nativeAudioScheduledSourceNode.start)};var wrapAudioScheduledSourceNodeStopMethodNegativeParameters=nativeAudioScheduledSourceNode=>{nativeAudioScheduledSourceNode.stop=(stop=>(when=0)=>{if(when<0)throw new RangeError("The parameter can't be negative.");stop.call(nativeAudioScheduledSourceNode,when)})(nativeAudioScheduledSourceNode.stop)};var createNativeAudioBufferSourceNodeFactory=(addSilentConnection2,cacheTestResult2,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport2,testAudioBufferSourceNodeStartMethodOffsetClampingSupport2,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport2,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport2,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2,wrapAudioBufferSourceNodeStartMethodOffsetClampling,wrapAudioBufferSourceNodeStopMethodNullifiedBuffer,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls2)=>(nativeContext,options)=>{let nativeAudioBufferSourceNode=nativeContext.createBufferSource();return assignNativeAudioNodeOptions(nativeAudioBufferSourceNode,options),assignNativeAudioNodeAudioParamValue(nativeAudioBufferSourceNode,options,"playbackRate"),assignNativeAudioNodeOption(nativeAudioBufferSourceNode,options,"buffer"),assignNativeAudioNodeOption(nativeAudioBufferSourceNode,options,"loop"),assignNativeAudioNodeOption(nativeAudioBufferSourceNode,options,"loopEnd"),assignNativeAudioNodeOption(nativeAudioBufferSourceNode,options,"loopStart"),cacheTestResult2(testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport2,()=>testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport2(nativeContext))||wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(nativeAudioBufferSourceNode),cacheTestResult2(testAudioBufferSourceNodeStartMethodOffsetClampingSupport2,()=>testAudioBufferSourceNodeStartMethodOffsetClampingSupport2(nativeContext))||wrapAudioBufferSourceNodeStartMethodOffsetClampling(nativeAudioBufferSourceNode),cacheTestResult2(testAudioBufferSourceNodeStopMethodNullifiedBufferSupport2,()=>testAudioBufferSourceNodeStopMethodNullifiedBufferSupport2(nativeContext))||wrapAudioBufferSourceNodeStopMethodNullifiedBuffer(nativeAudioBufferSourceNode,nativeContext),cacheTestResult2(testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2,()=>testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2(nativeContext))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(nativeAudioBufferSourceNode),cacheTestResult2(testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport2,()=>testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport2(nativeContext))||wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls2(nativeAudioBufferSourceNode,nativeContext),cacheTestResult2(testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2,()=>testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2(nativeContext))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(nativeAudioBufferSourceNode),addSilentConnection2(nativeContext,nativeAudioBufferSourceNode),nativeAudioBufferSourceNode};var createNativeAudioContextConstructor=window3=>window3===null?null:window3.hasOwnProperty("AudioContext")?window3.AudioContext:window3.hasOwnProperty("webkitAudioContext")?window3.webkitAudioContext:null;var createNativeAudioDestinationNodeFactory=(createNativeGainNode2,overwriteAccessors2)=>(nativeContext,channelCount,isNodeOfNativeOfflineAudioContext)=>{let nativeAudioDestinationNode=nativeContext.destination;if(nativeAudioDestinationNode.channelCount!==channelCount)try{nativeAudioDestinationNode.channelCount=channelCount}catch(e){}isNodeOfNativeOfflineAudioContext&&nativeAudioDestinationNode.channelCountMode!=="explicit"&&(nativeAudioDestinationNode.channelCountMode="explicit"),nativeAudioDestinationNode.maxChannelCount===0&&Object.defineProperty(nativeAudioDestinationNode,"maxChannelCount",{value:channelCount});let gainNode=createNativeGainNode2(nativeContext,{channelCount,channelCountMode:nativeAudioDestinationNode.channelCountMode,channelInterpretation:nativeAudioDestinationNode.channelInterpretation,gain:1});return overwriteAccessors2(gainNode,"channelCount",get=>()=>get.call(gainNode),set=>value=>{set.call(gainNode,value);try{nativeAudioDestinationNode.channelCount=value}catch(err){if(value>nativeAudioDestinationNode.maxChannelCount)throw err}}),overwriteAccessors2(gainNode,"channelCountMode",get=>()=>get.call(gainNode),set=>value=>{set.call(gainNode,value),nativeAudioDestinationNode.channelCountMode=value}),overwriteAccessors2(gainNode,"channelInterpretation",get=>()=>get.call(gainNode),set=>value=>{set.call(gainNode,value),nativeAudioDestinationNode.channelInterpretation=value}),Object.defineProperty(gainNode,"maxChannelCount",{get:()=>nativeAudioDestinationNode.maxChannelCount}),gainNode.connect(nativeAudioDestinationNode),gainNode};var createNativeAudioWorkletNodeConstructor=window3=>window3===null?null:window3.hasOwnProperty("AudioWorkletNode")?window3.AudioWorkletNode:null;var testClonabilityOfAudioWorkletNodeOptions=audioWorkletNodeOptions=>{let{port1}=new MessageChannel;try{port1.postMessage(audioWorkletNodeOptions)}finally{port1.close()}};var createNativeAudioWorkletNodeFactory=(createInvalidStateError2,createNativeAudioWorkletNodeFaker2,createNativeGainNode2,createNotSupportedError2,monitorConnections2)=>(nativeContext,baseLatency,nativeAudioWorkletNodeConstructor2,name,processorConstructor,options)=>{if(nativeAudioWorkletNodeConstructor2!==null)try{let nativeAudioWorkletNode=new nativeAudioWorkletNodeConstructor2(nativeContext,name,options),patchedEventListeners=new Map,onprocessorerror=null;if(Object.defineProperties(nativeAudioWorkletNode,{channelCount:{get:()=>options.channelCount,set:()=>{throw createInvalidStateError2()}},channelCountMode:{get:()=>"explicit",set:()=>{throw createInvalidStateError2()}},onprocessorerror:{get:()=>onprocessorerror,set:value=>{typeof onprocessorerror=="function"&&nativeAudioWorkletNode.removeEventListener("processorerror",onprocessorerror),onprocessorerror=typeof value=="function"?value:null,typeof onprocessorerror=="function"&&nativeAudioWorkletNode.addEventListener("processorerror",onprocessorerror)}}}),nativeAudioWorkletNode.addEventListener=(addEventListener=>(...args)=>{if(args[0]==="processorerror"){let unpatchedEventListener=typeof args[1]=="function"?args[1]:typeof args[1]=="object"&&args[1]!==null&&typeof args[1].handleEvent=="function"?args[1].handleEvent:null;if(unpatchedEventListener!==null){let patchedEventListener=patchedEventListeners.get(args[1]);patchedEventListener!==void 0?args[1]=patchedEventListener:(args[1]=event=>{event.type==="error"?(Object.defineProperties(event,{type:{value:"processorerror"}}),unpatchedEventListener(event)):unpatchedEventListener(new ErrorEvent(args[0],__spreadValues({},event)))},patchedEventListeners.set(unpatchedEventListener,args[1]))}}return addEventListener.call(nativeAudioWorkletNode,"error",args[1],args[2]),addEventListener.call(nativeAudioWorkletNode,...args)})(nativeAudioWorkletNode.addEventListener),nativeAudioWorkletNode.removeEventListener=(removeEventListener=>(...args)=>{if(args[0]==="processorerror"){let patchedEventListener=patchedEventListeners.get(args[1]);patchedEventListener!==void 0&&(patchedEventListeners.delete(args[1]),args[1]=patchedEventListener)}return removeEventListener.call(nativeAudioWorkletNode,"error",args[1],args[2]),removeEventListener.call(nativeAudioWorkletNode,args[0],args[1],args[2])})(nativeAudioWorkletNode.removeEventListener),options.numberOfOutputs!==0){let nativeGainNode=createNativeGainNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return nativeAudioWorkletNode.connect(nativeGainNode).connect(nativeContext.destination),monitorConnections2(nativeAudioWorkletNode,()=>nativeGainNode.disconnect(),()=>nativeGainNode.connect(nativeContext.destination))}return nativeAudioWorkletNode}catch(err){throw err.code===11?createNotSupportedError2():err}if(processorConstructor===void 0)throw createNotSupportedError2();return testClonabilityOfAudioWorkletNodeOptions(options),createNativeAudioWorkletNodeFaker2(nativeContext,baseLatency,processorConstructor,options)};var computeBufferSize=(baseLatency,sampleRate)=>baseLatency===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(baseLatency*sampleRate)))));var cloneAudioWorkletNodeOptions=audioWorkletNodeOptions=>new Promise((resolve4,reject2)=>{let{port1,port2}=new MessageChannel;port1.onmessage=({data})=>{port1.close(),port2.close(),resolve4(data)},port1.onmessageerror=({data})=>{port1.close(),port2.close(),reject2(data)},port2.postMessage(audioWorkletNodeOptions)});var createAudioWorkletProcessorPromise=async(processorConstructor,audioWorkletNodeOptions)=>{let clonedAudioWorkletNodeOptions=await cloneAudioWorkletNodeOptions(audioWorkletNodeOptions);return new processorConstructor(clonedAudioWorkletNodeOptions)};var createAudioWorkletProcessor=(nativeContext,nativeAudioWorkletNode,processorConstructor,audioWorkletNodeOptions)=>{let nodeToProcessorMap=NODE_TO_PROCESSOR_MAPS.get(nativeContext);nodeToProcessorMap===void 0&&(nodeToProcessorMap=new WeakMap,NODE_TO_PROCESSOR_MAPS.set(nativeContext,nodeToProcessorMap));let audioWorkletProcessorPromise=createAudioWorkletProcessorPromise(processorConstructor,audioWorkletNodeOptions);return nodeToProcessorMap.set(nativeAudioWorkletNode,audioWorkletProcessorPromise),audioWorkletProcessorPromise};var createNativeAudioWorkletNodeFakerFactory=(connectMultipleOutputs2,createIndexSizeError2,createInvalidStateError2,createNativeChannelMergerNode2,createNativeChannelSplitterNode2,createNativeConstantSourceNode2,createNativeGainNode2,createNativeScriptProcessorNode2,createNotSupportedError2,disconnectMultipleOutputs2,exposeCurrentFrameAndCurrentTime2,getActiveAudioWorkletNodeInputs2,monitorConnections2)=>(nativeContext,baseLatency,processorConstructor,options)=>{if(options.numberOfInputs===0&&options.numberOfOutputs===0)throw createNotSupportedError2();let outputChannelCount=Array.isArray(options.outputChannelCount)?options.outputChannelCount:Array.from(options.outputChannelCount);if(outputChannelCount.some(channelCount=>channelCount<1))throw createNotSupportedError2();if(outputChannelCount.length!==options.numberOfOutputs)throw createIndexSizeError2();if(options.channelCountMode!=="explicit")throw createNotSupportedError2();let numberOfInputChannels=options.channelCount*options.numberOfInputs,numberOfOutputChannels=outputChannelCount.reduce((sum2,value)=>sum2+value,0),numberOfParameters=processorConstructor.parameterDescriptors===void 0?0:processorConstructor.parameterDescriptors.length;if(numberOfInputChannels+numberOfParameters>6||numberOfOutputChannels>6)throw createNotSupportedError2();let messageChannel=new MessageChannel,gainNodes=[],inputChannelSplitterNodes=[];for(let i=0;i<options.numberOfInputs;i+=1)gainNodes.push(createNativeGainNode2(nativeContext,{channelCount:options.channelCount,channelCountMode:options.channelCountMode,channelInterpretation:options.channelInterpretation,gain:1})),inputChannelSplitterNodes.push(createNativeChannelSplitterNode2(nativeContext,{channelCount:options.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:options.channelCount}));let constantSourceNodes=[];if(processorConstructor.parameterDescriptors!==void 0)for(let{defaultValue:defaultValue3,maxValue,minValue,name}of processorConstructor.parameterDescriptors){let constantSourceNode=createNativeConstantSourceNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:options.parameterData[name]!==void 0?options.parameterData[name]:defaultValue3===void 0?0:defaultValue3});Object.defineProperties(constantSourceNode.offset,{defaultValue:{get:()=>defaultValue3===void 0?0:defaultValue3},maxValue:{get:()=>maxValue===void 0?MOST_POSITIVE_SINGLE_FLOAT:maxValue},minValue:{get:()=>minValue===void 0?MOST_NEGATIVE_SINGLE_FLOAT:minValue}}),constantSourceNodes.push(constantSourceNode)}let inputChannelMergerNode=createNativeChannelMergerNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,numberOfInputChannels+numberOfParameters)}),bufferSize=computeBufferSize(baseLatency,nativeContext.sampleRate),scriptProcessorNode=createNativeScriptProcessorNode2(nativeContext,bufferSize,numberOfInputChannels+numberOfParameters,Math.max(1,numberOfOutputChannels)),outputChannelSplitterNode=createNativeChannelSplitterNode2(nativeContext,{channelCount:Math.max(1,numberOfOutputChannels),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,numberOfOutputChannels)}),outputChannelMergerNodes=[];for(let i=0;i<options.numberOfOutputs;i+=1)outputChannelMergerNodes.push(createNativeChannelMergerNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:outputChannelCount[i]}));for(let i=0;i<options.numberOfInputs;i+=1){gainNodes[i].connect(inputChannelSplitterNodes[i]);for(let j=0;j<options.channelCount;j+=1)inputChannelSplitterNodes[i].connect(inputChannelMergerNode,j,i*options.channelCount+j)}let parameterMap=new ReadOnlyMap(processorConstructor.parameterDescriptors===void 0?[]:processorConstructor.parameterDescriptors.map(({name},index3)=>{let constantSourceNode=constantSourceNodes[index3];return constantSourceNode.connect(inputChannelMergerNode,0,numberOfInputChannels+index3),constantSourceNode.start(0),[name,constantSourceNode.offset]}));inputChannelMergerNode.connect(scriptProcessorNode);let channelInterpretation=options.channelInterpretation,onprocessorerror=null,outputAudioNodes=options.numberOfOutputs===0?[scriptProcessorNode]:outputChannelMergerNodes,nativeAudioWorkletNodeFaker={get bufferSize(){return bufferSize},get channelCount(){return options.channelCount},set channelCount(_){throw createInvalidStateError2()},get channelCountMode(){return options.channelCountMode},set channelCountMode(_){throw createInvalidStateError2()},get channelInterpretation(){return channelInterpretation},set channelInterpretation(value){for(let gainNode of gainNodes)gainNode.channelInterpretation=value;channelInterpretation=value},get context(){return scriptProcessorNode.context},get inputs(){return gainNodes},get numberOfInputs(){return options.numberOfInputs},get numberOfOutputs(){return options.numberOfOutputs},get onprocessorerror(){return onprocessorerror},set onprocessorerror(value){typeof onprocessorerror=="function"&&nativeAudioWorkletNodeFaker.removeEventListener("processorerror",onprocessorerror),onprocessorerror=typeof value=="function"?value:null,typeof onprocessorerror=="function"&&nativeAudioWorkletNodeFaker.addEventListener("processorerror",onprocessorerror)},get parameters(){return parameterMap},get port(){return messageChannel.port2},addEventListener(...args){return scriptProcessorNode.addEventListener(args[0],args[1],args[2])},connect:connectMultipleOutputs2.bind(null,outputAudioNodes),disconnect:disconnectMultipleOutputs2.bind(null,outputAudioNodes),dispatchEvent(...args){return scriptProcessorNode.dispatchEvent(args[0])},removeEventListener(...args){return scriptProcessorNode.removeEventListener(args[0],args[1],args[2])}},patchedEventListeners=new Map;messageChannel.port1.addEventListener=(addEventListener=>(...args)=>{if(args[0]==="message"){let unpatchedEventListener=typeof args[1]=="function"?args[1]:typeof args[1]=="object"&&args[1]!==null&&typeof args[1].handleEvent=="function"?args[1].handleEvent:null;if(unpatchedEventListener!==null){let patchedEventListener=patchedEventListeners.get(args[1]);patchedEventListener!==void 0?args[1]=patchedEventListener:(args[1]=event=>{exposeCurrentFrameAndCurrentTime2(nativeContext.currentTime,nativeContext.sampleRate,()=>unpatchedEventListener(event))},patchedEventListeners.set(unpatchedEventListener,args[1]))}}return addEventListener.call(messageChannel.port1,args[0],args[1],args[2])})(messageChannel.port1.addEventListener),messageChannel.port1.removeEventListener=(removeEventListener=>(...args)=>{if(args[0]==="message"){let patchedEventListener=patchedEventListeners.get(args[1]);patchedEventListener!==void 0&&(patchedEventListeners.delete(args[1]),args[1]=patchedEventListener)}return removeEventListener.call(messageChannel.port1,args[0],args[1],args[2])})(messageChannel.port1.removeEventListener);let onmessage=null;Object.defineProperty(messageChannel.port1,"onmessage",{get:()=>onmessage,set:value=>{typeof onmessage=="function"&&messageChannel.port1.removeEventListener("message",onmessage),onmessage=typeof value=="function"?value:null,typeof onmessage=="function"&&(messageChannel.port1.addEventListener("message",onmessage),messageChannel.port1.start())}}),processorConstructor.prototype.port=messageChannel.port1;let audioWorkletProcessor=null;createAudioWorkletProcessor(nativeContext,nativeAudioWorkletNodeFaker,processorConstructor,options).then(dWrkltPrcssr=>audioWorkletProcessor=dWrkltPrcssr);let inputs=createNestedArrays(options.numberOfInputs,options.channelCount),outputs=createNestedArrays(options.numberOfOutputs,outputChannelCount),parameters=processorConstructor.parameterDescriptors===void 0?[]:processorConstructor.parameterDescriptors.reduce((prmtrs,{name})=>__spreadProps(__spreadValues({},prmtrs),{[name]:new Float32Array(128)}),{}),isActive=!0,disconnectOutputsGraph=()=>{options.numberOfOutputs>0&&scriptProcessorNode.disconnect(outputChannelSplitterNode);for(let i=0,outputChannelSplitterNodeOutput=0;i<options.numberOfOutputs;i+=1){let outputChannelMergerNode=outputChannelMergerNodes[i];for(let j=0;j<outputChannelCount[i];j+=1)outputChannelSplitterNode.disconnect(outputChannelMergerNode,outputChannelSplitterNodeOutput+j,j);outputChannelSplitterNodeOutput+=outputChannelCount[i]}},activeInputIndexes=new Map;scriptProcessorNode.onaudioprocess=({inputBuffer,outputBuffer})=>{if(audioWorkletProcessor!==null){let activeInputs=getActiveAudioWorkletNodeInputs2(nativeAudioWorkletNodeFaker);for(let i=0;i<bufferSize;i+=128){for(let j=0;j<options.numberOfInputs;j+=1)for(let k=0;k<options.channelCount;k+=1)copyFromChannel(inputBuffer,inputs[j],k,k,i);processorConstructor.parameterDescriptors!==void 0&&processorConstructor.parameterDescriptors.forEach(({name},index3)=>{copyFromChannel(inputBuffer,parameters,name,numberOfInputChannels+index3,i)});for(let j=0;j<options.numberOfInputs;j+=1)for(let k=0;k<outputChannelCount[j];k+=1)outputs[j][k].byteLength===0&&(outputs[j][k]=new Float32Array(128));try{let potentiallyEmptyInputs=inputs.map((input,index3)=>{if(activeInputs[index3].size>0)return activeInputIndexes.set(index3,bufferSize/128),input;let count2=activeInputIndexes.get(index3);return count2===void 0?[]:(input.every(channelData=>channelData.every(sample=>sample===0))&&(count2===1?activeInputIndexes.delete(index3):activeInputIndexes.set(index3,count2-1)),input)});isActive=exposeCurrentFrameAndCurrentTime2(nativeContext.currentTime+i/nativeContext.sampleRate,nativeContext.sampleRate,()=>audioWorkletProcessor.process(potentiallyEmptyInputs,outputs,parameters));for(let j=0,outputChannelSplitterNodeOutput=0;j<options.numberOfOutputs;j+=1){for(let k=0;k<outputChannelCount[j];k+=1)copyToChannel(outputBuffer,outputs[j],k,outputChannelSplitterNodeOutput+k,i);outputChannelSplitterNodeOutput+=outputChannelCount[j]}}catch(error){isActive=!1,nativeAudioWorkletNodeFaker.dispatchEvent(new ErrorEvent("processorerror",{colno:error.colno,filename:error.filename,lineno:error.lineno,message:error.message}))}if(!isActive){for(let j=0;j<options.numberOfInputs;j+=1){gainNodes[j].disconnect(inputChannelSplitterNodes[j]);for(let k=0;k<options.channelCount;k+=1)inputChannelSplitterNodes[i].disconnect(inputChannelMergerNode,k,j*options.channelCount+k)}if(processorConstructor.parameterDescriptors!==void 0){let length=processorConstructor.parameterDescriptors.length;for(let j=0;j<length;j+=1){let constantSourceNode=constantSourceNodes[j];constantSourceNode.disconnect(inputChannelMergerNode,0,numberOfInputChannels+j),constantSourceNode.stop()}}inputChannelMergerNode.disconnect(scriptProcessorNode),scriptProcessorNode.onaudioprocess=null,isConnected?disconnectOutputsGraph():disconnectFakeGraph();break}}}};let isConnected=!1,nativeGainNode=createNativeGainNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),connectFakeGraph=()=>scriptProcessorNode.connect(nativeGainNode).connect(nativeContext.destination),disconnectFakeGraph=()=>{scriptProcessorNode.disconnect(nativeGainNode),nativeGainNode.disconnect()},whenConnected=()=>{if(isActive){disconnectFakeGraph(),options.numberOfOutputs>0&&scriptProcessorNode.connect(outputChannelSplitterNode);for(let i=0,outputChannelSplitterNodeOutput=0;i<options.numberOfOutputs;i+=1){let outputChannelMergerNode=outputChannelMergerNodes[i];for(let j=0;j<outputChannelCount[i];j+=1)outputChannelSplitterNode.connect(outputChannelMergerNode,outputChannelSplitterNodeOutput+j,j);outputChannelSplitterNodeOutput+=outputChannelCount[i]}}isConnected=!0},whenDisconnected=()=>{isActive&&(connectFakeGraph(),disconnectOutputsGraph()),isConnected=!1};return connectFakeGraph(),monitorConnections2(nativeAudioWorkletNodeFaker,whenConnected,whenDisconnected)};var createNativeBiquadFilterNode=(nativeContext,options)=>{let nativeBiquadFilterNode=nativeContext.createBiquadFilter();return assignNativeAudioNodeOptions(nativeBiquadFilterNode,options),assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode,options,"Q"),assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode,options,"detune"),assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode,options,"frequency"),assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode,options,"gain"),assignNativeAudioNodeOption(nativeBiquadFilterNode,options,"type"),nativeBiquadFilterNode};var createNativeChannelMergerNodeFactory=(nativeAudioContextConstructor2,wrapChannelMergerNode2)=>(nativeContext,options)=>{let nativeChannelMergerNode=nativeContext.createChannelMerger(options.numberOfInputs);return nativeAudioContextConstructor2!==null&&nativeAudioContextConstructor2.name==="webkitAudioContext"&&wrapChannelMergerNode2(nativeContext,nativeChannelMergerNode),assignNativeAudioNodeOptions(nativeChannelMergerNode,options),nativeChannelMergerNode};var wrapChannelSplitterNode=channelSplitterNode=>{let channelCount=channelSplitterNode.numberOfOutputs;Object.defineProperty(channelSplitterNode,"channelCount",{get:()=>channelCount,set:value=>{if(value!==channelCount)throw createInvalidStateError()}}),Object.defineProperty(channelSplitterNode,"channelCountMode",{get:()=>"explicit",set:value=>{if(value!=="explicit")throw createInvalidStateError()}}),Object.defineProperty(channelSplitterNode,"channelInterpretation",{get:()=>"discrete",set:value=>{if(value!=="discrete")throw createInvalidStateError()}})};var createNativeChannelSplitterNode=(nativeContext,options)=>{let nativeChannelSplitterNode=nativeContext.createChannelSplitter(options.numberOfOutputs);return assignNativeAudioNodeOptions(nativeChannelSplitterNode,options),wrapChannelSplitterNode(nativeChannelSplitterNode),nativeChannelSplitterNode};var createNativeConstantSourceNodeFactory=(addSilentConnection2,cacheTestResult2,createNativeConstantSourceNodeFaker2,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2)=>(nativeContext,options)=>{if(nativeContext.createConstantSource===void 0)return createNativeConstantSourceNodeFaker2(nativeContext,options);let nativeConstantSourceNode=nativeContext.createConstantSource();return assignNativeAudioNodeOptions(nativeConstantSourceNode,options),assignNativeAudioNodeAudioParamValue(nativeConstantSourceNode,options,"offset"),cacheTestResult2(testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2,()=>testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2(nativeContext))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(nativeConstantSourceNode),cacheTestResult2(testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2,()=>testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2(nativeContext))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(nativeConstantSourceNode),addSilentConnection2(nativeContext,nativeConstantSourceNode),nativeConstantSourceNode};var interceptConnections=(original,interceptor)=>(original.connect=interceptor.connect.bind(interceptor),original.disconnect=interceptor.disconnect.bind(interceptor),original);var createNativeConstantSourceNodeFakerFactory=(addSilentConnection2,createNativeAudioBufferSourceNode2,createNativeGainNode2,monitorConnections2)=>(nativeContext,_a3)=>{var _b2=_a3,{offset}=_b2,audioNodeOptions=__objRest(_b2,["offset"]);let audioBuffer=nativeContext.createBuffer(1,2,44100),audioBufferSourceNode=createNativeAudioBufferSourceNode2(nativeContext,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),gainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{gain:offset})),channelData=audioBuffer.getChannelData(0);channelData[0]=1,channelData[1]=1,audioBufferSourceNode.buffer=audioBuffer,audioBufferSourceNode.loop=!0;let nativeConstantSourceNodeFaker={get bufferSize(){},get channelCount(){return gainNode.channelCount},set channelCount(value){gainNode.channelCount=value},get channelCountMode(){return gainNode.channelCountMode},set channelCountMode(value){gainNode.channelCountMode=value},get channelInterpretation(){return gainNode.channelInterpretation},set channelInterpretation(value){gainNode.channelInterpretation=value},get context(){return gainNode.context},get inputs(){return[]},get numberOfInputs(){return audioBufferSourceNode.numberOfInputs},get numberOfOutputs(){return gainNode.numberOfOutputs},get offset(){return gainNode.gain},get onended(){return audioBufferSourceNode.onended},set onended(value){audioBufferSourceNode.onended=value},addEventListener(...args){return audioBufferSourceNode.addEventListener(args[0],args[1],args[2])},dispatchEvent(...args){return audioBufferSourceNode.dispatchEvent(args[0])},removeEventListener(...args){return audioBufferSourceNode.removeEventListener(args[0],args[1],args[2])},start(when=0){audioBufferSourceNode.start.call(audioBufferSourceNode,when)},stop(when=0){audioBufferSourceNode.stop.call(audioBufferSourceNode,when)}},whenConnected=()=>audioBufferSourceNode.connect(gainNode),whenDisconnected=()=>audioBufferSourceNode.disconnect(gainNode);return addSilentConnection2(nativeContext,audioBufferSourceNode),monitorConnections2(interceptConnections(nativeConstantSourceNodeFaker,gainNode),whenConnected,whenDisconnected)};var createNativeConvolverNodeFactory=(createNotSupportedError2,overwriteAccessors2)=>(nativeContext,options)=>{let nativeConvolverNode=nativeContext.createConvolver();if(assignNativeAudioNodeOptions(nativeConvolverNode,options),options.disableNormalization===nativeConvolverNode.normalize&&(nativeConvolverNode.normalize=!options.disableNormalization),assignNativeAudioNodeOption(nativeConvolverNode,options,"buffer"),options.channelCount>2||(overwriteAccessors2(nativeConvolverNode,"channelCount",get=>()=>get.call(nativeConvolverNode),set=>value=>{if(value>2)throw createNotSupportedError2();return set.call(nativeConvolverNode,value)}),options.channelCountMode==="max"))throw createNotSupportedError2();return overwriteAccessors2(nativeConvolverNode,"channelCountMode",get=>()=>get.call(nativeConvolverNode),set=>value=>{if(value==="max")throw createNotSupportedError2();return set.call(nativeConvolverNode,value)}),nativeConvolverNode};var createNativeDelayNode=(nativeContext,options)=>{let nativeDelayNode=nativeContext.createDelay(options.maxDelayTime);return assignNativeAudioNodeOptions(nativeDelayNode,options),assignNativeAudioNodeAudioParamValue(nativeDelayNode,options,"delayTime"),nativeDelayNode};var createNativeDynamicsCompressorNodeFactory=createNotSupportedError2=>(nativeContext,options)=>{let nativeDynamicsCompressorNode=nativeContext.createDynamicsCompressor();if(assignNativeAudioNodeOptions(nativeDynamicsCompressorNode,options),options.channelCount>2||options.channelCountMode==="max")throw createNotSupportedError2();return assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode,options,"attack"),assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode,options,"knee"),assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode,options,"ratio"),assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode,options,"release"),assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode,options,"threshold"),nativeDynamicsCompressorNode};var createNativeGainNode=(nativeContext,options)=>{let nativeGainNode=nativeContext.createGain();return assignNativeAudioNodeOptions(nativeGainNode,options),assignNativeAudioNodeAudioParamValue(nativeGainNode,options,"gain"),nativeGainNode};var createNativeIIRFilterNodeFactory=createNativeIIRFilterNodeFaker2=>(nativeContext,baseLatency,options)=>{if(nativeContext.createIIRFilter===void 0)return createNativeIIRFilterNodeFaker2(nativeContext,baseLatency,options);let nativeIIRFilterNode=nativeContext.createIIRFilter(options.feedforward,options.feedback);return assignNativeAudioNodeOptions(nativeIIRFilterNode,options),nativeIIRFilterNode};function divide(a,b){let denominator=b[0]*b[0]+b[1]*b[1];return[(a[0]*b[0]+a[1]*b[1])/denominator,(a[1]*b[0]-a[0]*b[1])/denominator]}function multiply(a,b){return[a[0]*b[0]-a[1]*b[1],a[0]*b[1]+a[1]*b[0]]}function evaluatePolynomial(coefficient,z){let result=[0,0];for(let i=coefficient.length-1;i>=0;i-=1)result=multiply(result,z),result[0]+=coefficient[i];return result}var createNativeIIRFilterNodeFakerFactory=(createInvalidAccessError2,createInvalidStateError2,createNativeScriptProcessorNode2,createNotSupportedError2)=>(nativeContext,baseLatency,{channelCount,channelCountMode,channelInterpretation,feedback,feedforward})=>{let bufferSize=computeBufferSize(baseLatency,nativeContext.sampleRate),convertedFeedback=feedback instanceof Float64Array?feedback:new Float64Array(feedback),convertedFeedforward=feedforward instanceof Float64Array?feedforward:new Float64Array(feedforward),feedbackLength=convertedFeedback.length,feedforwardLength=convertedFeedforward.length,minLength=Math.min(feedbackLength,feedforwardLength);if(feedbackLength===0||feedbackLength>20)throw createNotSupportedError2();if(convertedFeedback[0]===0)throw createInvalidStateError2();if(feedforwardLength===0||feedforwardLength>20)throw createNotSupportedError2();if(convertedFeedforward[0]===0)throw createInvalidStateError2();if(convertedFeedback[0]!==1){for(let i=0;i<feedforwardLength;i+=1)convertedFeedforward[i]/=convertedFeedback[0];for(let i=1;i<feedbackLength;i+=1)convertedFeedback[i]/=convertedFeedback[0]}let scriptProcessorNode=createNativeScriptProcessorNode2(nativeContext,bufferSize,channelCount,channelCount);scriptProcessorNode.channelCount=channelCount,scriptProcessorNode.channelCountMode=channelCountMode,scriptProcessorNode.channelInterpretation=channelInterpretation;let bufferLength=32,bufferIndexes=[],xBuffers=[],yBuffers=[];for(let i=0;i<channelCount;i+=1){bufferIndexes.push(0);let xBuffer=new Float32Array(bufferLength),yBuffer=new Float32Array(bufferLength);xBuffer.fill(0),yBuffer.fill(0),xBuffers.push(xBuffer),yBuffers.push(yBuffer)}scriptProcessorNode.onaudioprocess=event=>{let inputBuffer=event.inputBuffer,outputBuffer=event.outputBuffer,numberOfChannels=inputBuffer.numberOfChannels;for(let i=0;i<numberOfChannels;i+=1){let input=inputBuffer.getChannelData(i),output=outputBuffer.getChannelData(i);bufferIndexes[i]=filterBuffer(convertedFeedback,feedbackLength,convertedFeedforward,feedforwardLength,minLength,xBuffers[i],yBuffers[i],bufferIndexes[i],bufferLength,input,output)}};let nyquist=nativeContext.sampleRate/2;return interceptConnections({get bufferSize(){return bufferSize},get channelCount(){return scriptProcessorNode.channelCount},set channelCount(value){scriptProcessorNode.channelCount=value},get channelCountMode(){return scriptProcessorNode.channelCountMode},set channelCountMode(value){scriptProcessorNode.channelCountMode=value},get channelInterpretation(){return scriptProcessorNode.channelInterpretation},set channelInterpretation(value){scriptProcessorNode.channelInterpretation=value},get context(){return scriptProcessorNode.context},get inputs(){return[scriptProcessorNode]},get numberOfInputs(){return scriptProcessorNode.numberOfInputs},get numberOfOutputs(){return scriptProcessorNode.numberOfOutputs},addEventListener(...args){return scriptProcessorNode.addEventListener(args[0],args[1],args[2])},dispatchEvent(...args){return scriptProcessorNode.dispatchEvent(args[0])},getFrequencyResponse(frequencyHz,magResponse,phaseResponse){if(frequencyHz.length!==magResponse.length||magResponse.length!==phaseResponse.length)throw createInvalidAccessError2();let length=frequencyHz.length;for(let i=0;i<length;i+=1){let omega=-Math.PI*(frequencyHz[i]/nyquist),z=[Math.cos(omega),Math.sin(omega)],numerator=evaluatePolynomial(convertedFeedforward,z),denominator=evaluatePolynomial(convertedFeedback,z),response2=divide(numerator,denominator);magResponse[i]=Math.sqrt(response2[0]*response2[0]+response2[1]*response2[1]),phaseResponse[i]=Math.atan2(response2[1],response2[0])}},removeEventListener(...args){return scriptProcessorNode.removeEventListener(args[0],args[1],args[2])}},scriptProcessorNode)};var createNativeMediaElementAudioSourceNode=(nativeAudioContext,options)=>nativeAudioContext.createMediaElementSource(options.mediaElement);var createNativeMediaStreamAudioDestinationNode=(nativeAudioContext,options)=>{let nativeMediaStreamAudioDestinationNode=nativeAudioContext.createMediaStreamDestination();return assignNativeAudioNodeOptions(nativeMediaStreamAudioDestinationNode,options),nativeMediaStreamAudioDestinationNode.numberOfOutputs===1&&Object.defineProperty(nativeMediaStreamAudioDestinationNode,"numberOfOutputs",{get:()=>0}),nativeMediaStreamAudioDestinationNode};var createNativeMediaStreamAudioSourceNode=(nativeAudioContext,{mediaStream})=>{let audioStreamTracks=mediaStream.getAudioTracks();audioStreamTracks.sort((a,b)=>a.id<b.id?-1:a.id>b.id?1:0);let filteredAudioStreamTracks=audioStreamTracks.slice(0,1),nativeMediaStreamAudioSourceNode=nativeAudioContext.createMediaStreamSource(new MediaStream(filteredAudioStreamTracks));return Object.defineProperty(nativeMediaStreamAudioSourceNode,"mediaStream",{value:mediaStream}),nativeMediaStreamAudioSourceNode};var createNativeMediaStreamTrackAudioSourceNodeFactory=(createInvalidStateError2,isNativeOfflineAudioContext2)=>(nativeAudioContext,{mediaStreamTrack})=>{if(typeof nativeAudioContext.createMediaStreamTrackSource=="function")return nativeAudioContext.createMediaStreamTrackSource(mediaStreamTrack);let mediaStream=new MediaStream([mediaStreamTrack]),nativeMediaStreamAudioSourceNode=nativeAudioContext.createMediaStreamSource(mediaStream);if(mediaStreamTrack.kind!=="audio")throw createInvalidStateError2();if(isNativeOfflineAudioContext2(nativeAudioContext))throw new TypeError;return nativeMediaStreamAudioSourceNode};var createNativeOfflineAudioContextConstructor=window3=>window3===null?null:window3.hasOwnProperty("OfflineAudioContext")?window3.OfflineAudioContext:window3.hasOwnProperty("webkitOfflineAudioContext")?window3.webkitOfflineAudioContext:null;var createNativeOscillatorNodeFactory=(addSilentConnection2,cacheTestResult2,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport2,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls2)=>(nativeContext,options)=>{let nativeOscillatorNode=nativeContext.createOscillator();return assignNativeAudioNodeOptions(nativeOscillatorNode,options),assignNativeAudioNodeAudioParamValue(nativeOscillatorNode,options,"detune"),assignNativeAudioNodeAudioParamValue(nativeOscillatorNode,options,"frequency"),options.periodicWave!==void 0?nativeOscillatorNode.setPeriodicWave(options.periodicWave):assignNativeAudioNodeOption(nativeOscillatorNode,options,"type"),cacheTestResult2(testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2,()=>testAudioScheduledSourceNodeStartMethodNegativeParametersSupport2(nativeContext))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(nativeOscillatorNode),cacheTestResult2(testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport2,()=>testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport2(nativeContext))||wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls2(nativeOscillatorNode,nativeContext),cacheTestResult2(testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2,()=>testAudioScheduledSourceNodeStopMethodNegativeParametersSupport2(nativeContext))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(nativeOscillatorNode),addSilentConnection2(nativeContext,nativeOscillatorNode),nativeOscillatorNode};var createNativePannerNodeFactory=createNativePannerNodeFaker2=>(nativeContext,options)=>{let nativePannerNode=nativeContext.createPanner();return nativePannerNode.orientationX===void 0?createNativePannerNodeFaker2(nativeContext,options):(assignNativeAudioNodeOptions(nativePannerNode,options),assignNativeAudioNodeAudioParamValue(nativePannerNode,options,"orientationX"),assignNativeAudioNodeAudioParamValue(nativePannerNode,options,"orientationY"),assignNativeAudioNodeAudioParamValue(nativePannerNode,options,"orientationZ"),assignNativeAudioNodeAudioParamValue(nativePannerNode,options,"positionX"),assignNativeAudioNodeAudioParamValue(nativePannerNode,options,"positionY"),assignNativeAudioNodeAudioParamValue(nativePannerNode,options,"positionZ"),assignNativeAudioNodeOption(nativePannerNode,options,"coneInnerAngle"),assignNativeAudioNodeOption(nativePannerNode,options,"coneOuterAngle"),assignNativeAudioNodeOption(nativePannerNode,options,"coneOuterGain"),assignNativeAudioNodeOption(nativePannerNode,options,"distanceModel"),assignNativeAudioNodeOption(nativePannerNode,options,"maxDistance"),assignNativeAudioNodeOption(nativePannerNode,options,"panningModel"),assignNativeAudioNodeOption(nativePannerNode,options,"refDistance"),assignNativeAudioNodeOption(nativePannerNode,options,"rolloffFactor"),nativePannerNode)};var createNativePannerNodeFakerFactory=(connectNativeAudioNodeToNativeAudioNode2,createInvalidStateError2,createNativeChannelMergerNode2,createNativeGainNode2,createNativeScriptProcessorNode2,createNativeWaveShaperNode2,createNotSupportedError2,disconnectNativeAudioNodeFromNativeAudioNode2,monitorConnections2)=>(nativeContext,_a3)=>{var _b2=_a3,{coneInnerAngle,coneOuterAngle,coneOuterGain,distanceModel,maxDistance,orientationX,orientationY,orientationZ,panningModel,positionX,positionY,positionZ,refDistance,rolloffFactor}=_b2,audioNodeOptions=__objRest(_b2,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]);let pannerNode=nativeContext.createPanner();if(audioNodeOptions.channelCount>2||audioNodeOptions.channelCountMode==="max")throw createNotSupportedError2();assignNativeAudioNodeOptions(pannerNode,audioNodeOptions);let SINGLE_CHANNEL_OPTIONS={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},channelMergerNode=createNativeChannelMergerNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{channelInterpretation:"speakers",numberOfInputs:6})),inputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{gain:1})),orientationXGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:1})),orientationYGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),orientationZGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),positionXGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),positionYGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),positionZGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),scriptProcessorNode=createNativeScriptProcessorNode2(nativeContext,256,6,1),waveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{curve:new Float32Array([1,1]),oversample:"none"})),lastOrientation=[orientationX,orientationY,orientationZ],lastPosition=[positionX,positionY,positionZ];scriptProcessorNode.onaudioprocess=({inputBuffer})=>{let orientation=[inputBuffer.getChannelData(0)[0],inputBuffer.getChannelData(1)[0],inputBuffer.getChannelData(2)[0]];orientation.some((value,index3)=>value!==lastOrientation[index3])&&(pannerNode.setOrientation(...orientation),lastOrientation=orientation);let positon=[inputBuffer.getChannelData(3)[0],inputBuffer.getChannelData(4)[0],inputBuffer.getChannelData(5)[0]];positon.some((value,index3)=>value!==lastPosition[index3])&&(pannerNode.setPosition(...positon),lastPosition=positon)},Object.defineProperty(orientationYGainNode.gain,"defaultValue",{get:()=>0}),Object.defineProperty(orientationZGainNode.gain,"defaultValue",{get:()=>0}),Object.defineProperty(positionXGainNode.gain,"defaultValue",{get:()=>0}),Object.defineProperty(positionYGainNode.gain,"defaultValue",{get:()=>0}),Object.defineProperty(positionZGainNode.gain,"defaultValue",{get:()=>0});let nativePannerNodeFaker={get bufferSize(){},get channelCount(){return pannerNode.channelCount},set channelCount(value){if(value>2)throw createNotSupportedError2();inputGainNode.channelCount=value,pannerNode.channelCount=value},get channelCountMode(){return pannerNode.channelCountMode},set channelCountMode(value){if(value==="max")throw createNotSupportedError2();inputGainNode.channelCountMode=value,pannerNode.channelCountMode=value},get channelInterpretation(){return pannerNode.channelInterpretation},set channelInterpretation(value){inputGainNode.channelInterpretation=value,pannerNode.channelInterpretation=value},get coneInnerAngle(){return pannerNode.coneInnerAngle},set coneInnerAngle(value){pannerNode.coneInnerAngle=value},get coneOuterAngle(){return pannerNode.coneOuterAngle},set coneOuterAngle(value){pannerNode.coneOuterAngle=value},get coneOuterGain(){return pannerNode.coneOuterGain},set coneOuterGain(value){if(value<0||value>1)throw createInvalidStateError2();pannerNode.coneOuterGain=value},get context(){return pannerNode.context},get distanceModel(){return pannerNode.distanceModel},set distanceModel(value){pannerNode.distanceModel=value},get inputs(){return[inputGainNode]},get maxDistance(){return pannerNode.maxDistance},set maxDistance(value){if(value<0)throw new RangeError;pannerNode.maxDistance=value},get numberOfInputs(){return pannerNode.numberOfInputs},get numberOfOutputs(){return pannerNode.numberOfOutputs},get orientationX(){return orientationXGainNode.gain},get orientationY(){return orientationYGainNode.gain},get orientationZ(){return orientationZGainNode.gain},get panningModel(){return pannerNode.panningModel},set panningModel(value){pannerNode.panningModel=value},get positionX(){return positionXGainNode.gain},get positionY(){return positionYGainNode.gain},get positionZ(){return positionZGainNode.gain},get refDistance(){return pannerNode.refDistance},set refDistance(value){if(value<0)throw new RangeError;pannerNode.refDistance=value},get rolloffFactor(){return pannerNode.rolloffFactor},set rolloffFactor(value){if(value<0)throw new RangeError;pannerNode.rolloffFactor=value},addEventListener(...args){return inputGainNode.addEventListener(args[0],args[1],args[2])},dispatchEvent(...args){return inputGainNode.dispatchEvent(args[0])},removeEventListener(...args){return inputGainNode.removeEventListener(args[0],args[1],args[2])}};coneInnerAngle!==nativePannerNodeFaker.coneInnerAngle&&(nativePannerNodeFaker.coneInnerAngle=coneInnerAngle),coneOuterAngle!==nativePannerNodeFaker.coneOuterAngle&&(nativePannerNodeFaker.coneOuterAngle=coneOuterAngle),coneOuterGain!==nativePannerNodeFaker.coneOuterGain&&(nativePannerNodeFaker.coneOuterGain=coneOuterGain),distanceModel!==nativePannerNodeFaker.distanceModel&&(nativePannerNodeFaker.distanceModel=distanceModel),maxDistance!==nativePannerNodeFaker.maxDistance&&(nativePannerNodeFaker.maxDistance=maxDistance),orientationX!==nativePannerNodeFaker.orientationX.value&&(nativePannerNodeFaker.orientationX.value=orientationX),orientationY!==nativePannerNodeFaker.orientationY.value&&(nativePannerNodeFaker.orientationY.value=orientationY),orientationZ!==nativePannerNodeFaker.orientationZ.value&&(nativePannerNodeFaker.orientationZ.value=orientationZ),panningModel!==nativePannerNodeFaker.panningModel&&(nativePannerNodeFaker.panningModel=panningModel),positionX!==nativePannerNodeFaker.positionX.value&&(nativePannerNodeFaker.positionX.value=positionX),positionY!==nativePannerNodeFaker.positionY.value&&(nativePannerNodeFaker.positionY.value=positionY),positionZ!==nativePannerNodeFaker.positionZ.value&&(nativePannerNodeFaker.positionZ.value=positionZ),refDistance!==nativePannerNodeFaker.refDistance&&(nativePannerNodeFaker.refDistance=refDistance),rolloffFactor!==nativePannerNodeFaker.rolloffFactor&&(nativePannerNodeFaker.rolloffFactor=rolloffFactor),(lastOrientation[0]!==1||lastOrientation[1]!==0||lastOrientation[2]!==0)&&pannerNode.setOrientation(...lastOrientation),(lastPosition[0]!==0||lastPosition[1]!==0||lastPosition[2]!==0)&&pannerNode.setPosition(...lastPosition);let whenConnected=()=>{inputGainNode.connect(pannerNode),connectNativeAudioNodeToNativeAudioNode2(inputGainNode,waveShaperNode,0,0),waveShaperNode.connect(orientationXGainNode).connect(channelMergerNode,0,0),waveShaperNode.connect(orientationYGainNode).connect(channelMergerNode,0,1),waveShaperNode.connect(orientationZGainNode).connect(channelMergerNode,0,2),waveShaperNode.connect(positionXGainNode).connect(channelMergerNode,0,3),waveShaperNode.connect(positionYGainNode).connect(channelMergerNode,0,4),waveShaperNode.connect(positionZGainNode).connect(channelMergerNode,0,5),channelMergerNode.connect(scriptProcessorNode).connect(nativeContext.destination)},whenDisconnected=()=>{inputGainNode.disconnect(pannerNode),disconnectNativeAudioNodeFromNativeAudioNode2(inputGainNode,waveShaperNode,0,0),waveShaperNode.disconnect(orientationXGainNode),orientationXGainNode.disconnect(channelMergerNode),waveShaperNode.disconnect(orientationYGainNode),orientationYGainNode.disconnect(channelMergerNode),waveShaperNode.disconnect(orientationZGainNode),orientationZGainNode.disconnect(channelMergerNode),waveShaperNode.disconnect(positionXGainNode),positionXGainNode.disconnect(channelMergerNode),waveShaperNode.disconnect(positionYGainNode),positionYGainNode.disconnect(channelMergerNode),waveShaperNode.disconnect(positionZGainNode),positionZGainNode.disconnect(channelMergerNode),channelMergerNode.disconnect(scriptProcessorNode),scriptProcessorNode.disconnect(nativeContext.destination)};return monitorConnections2(interceptConnections(nativePannerNodeFaker,pannerNode),whenConnected,whenDisconnected)};var createNativePeriodicWaveFactory=createIndexSizeError2=>(nativeContext,{disableNormalization,imag,real})=>{let convertedImag=imag instanceof Float32Array?imag:new Float32Array(imag),convertedReal=real instanceof Float32Array?real:new Float32Array(real),nativePeriodicWave=nativeContext.createPeriodicWave(convertedReal,convertedImag,{disableNormalization});if(Array.from(imag).length<2)throw createIndexSizeError2();return nativePeriodicWave};var createNativeScriptProcessorNode=(nativeContext,bufferSize,numberOfInputChannels,numberOfOutputChannels)=>nativeContext.createScriptProcessor(bufferSize,numberOfInputChannels,numberOfOutputChannels);var createNativeStereoPannerNodeFactory=(createNativeStereoPannerNodeFaker,createNotSupportedError2)=>(nativeContext,options)=>{let channelCountMode=options.channelCountMode;if(channelCountMode==="clamped-max")throw createNotSupportedError2();if(nativeContext.createStereoPanner===void 0)return createNativeStereoPannerNodeFaker(nativeContext,options);let nativeStereoPannerNode=nativeContext.createStereoPanner();return assignNativeAudioNodeOptions(nativeStereoPannerNode,options),assignNativeAudioNodeAudioParamValue(nativeStereoPannerNode,options,"pan"),Object.defineProperty(nativeStereoPannerNode,"channelCountMode",{get:()=>channelCountMode,set:value=>{if(value!==channelCountMode)throw createNotSupportedError2()}}),nativeStereoPannerNode};var createNativeStereoPannerNodeFakerFactory=(createNativeChannelMergerNode2,createNativeChannelSplitterNode2,createNativeGainNode2,createNativeWaveShaperNode2,createNotSupportedError2,monitorConnections2)=>{let CURVE_SIZE=16385,DC_CURVE=new Float32Array([1,1]),HALF_PI=Math.PI/2,SINGLE_CHANNEL_OPTIONS={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS=__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{oversample:"none"}),buildInternalGraphForMono=(nativeContext,inputGainNode,panGainNode,channelMergerNode)=>{let leftWaveShaperCurve=new Float32Array(CURVE_SIZE),rightWaveShaperCurve=new Float32Array(CURVE_SIZE);for(let i=0;i<CURVE_SIZE;i+=1){let x=i/(CURVE_SIZE-1)*HALF_PI;leftWaveShaperCurve[i]=Math.cos(x),rightWaveShaperCurve[i]=Math.sin(x)}let leftGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),leftWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:leftWaveShaperCurve})),panWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:DC_CURVE})),rightGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),rightWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:rightWaveShaperCurve}));return{connectGraph(){inputGainNode.connect(leftGainNode),inputGainNode.connect(panWaveShaperNode.inputs===void 0?panWaveShaperNode:panWaveShaperNode.inputs[0]),inputGainNode.connect(rightGainNode),panWaveShaperNode.connect(panGainNode),panGainNode.connect(leftWaveShaperNode.inputs===void 0?leftWaveShaperNode:leftWaveShaperNode.inputs[0]),panGainNode.connect(rightWaveShaperNode.inputs===void 0?rightWaveShaperNode:rightWaveShaperNode.inputs[0]),leftWaveShaperNode.connect(leftGainNode.gain),rightWaveShaperNode.connect(rightGainNode.gain),leftGainNode.connect(channelMergerNode,0,0),rightGainNode.connect(channelMergerNode,0,1)},disconnectGraph(){inputGainNode.disconnect(leftGainNode),inputGainNode.disconnect(panWaveShaperNode.inputs===void 0?panWaveShaperNode:panWaveShaperNode.inputs[0]),inputGainNode.disconnect(rightGainNode),panWaveShaperNode.disconnect(panGainNode),panGainNode.disconnect(leftWaveShaperNode.inputs===void 0?leftWaveShaperNode:leftWaveShaperNode.inputs[0]),panGainNode.disconnect(rightWaveShaperNode.inputs===void 0?rightWaveShaperNode:rightWaveShaperNode.inputs[0]),leftWaveShaperNode.disconnect(leftGainNode.gain),rightWaveShaperNode.disconnect(rightGainNode.gain),leftGainNode.disconnect(channelMergerNode,0,0),rightGainNode.disconnect(channelMergerNode,0,1)}}},buildInternalGraphForStereo=(nativeContext,inputGainNode,panGainNode,channelMergerNode)=>{let leftInputForLeftOutputWaveShaperCurve=new Float32Array(CURVE_SIZE),leftInputForRightOutputWaveShaperCurve=new Float32Array(CURVE_SIZE),rightInputForLeftOutputWaveShaperCurve=new Float32Array(CURVE_SIZE),rightInputForRightOutputWaveShaperCurve=new Float32Array(CURVE_SIZE),centerIndex=Math.floor(CURVE_SIZE/2);for(let i=0;i<CURVE_SIZE;i+=1)if(i>centerIndex){let x=(i-centerIndex)/(CURVE_SIZE-1-centerIndex)*HALF_PI;leftInputForLeftOutputWaveShaperCurve[i]=Math.cos(x),leftInputForRightOutputWaveShaperCurve[i]=Math.sin(x),rightInputForLeftOutputWaveShaperCurve[i]=0,rightInputForRightOutputWaveShaperCurve[i]=1}else{let x=i/(CURVE_SIZE-1-centerIndex)*HALF_PI;leftInputForLeftOutputWaveShaperCurve[i]=1,leftInputForRightOutputWaveShaperCurve[i]=0,rightInputForLeftOutputWaveShaperCurve[i]=Math.cos(x),rightInputForRightOutputWaveShaperCurve[i]=Math.sin(x)}let channelSplitterNode=createNativeChannelSplitterNode2(nativeContext,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),leftInputForLeftOutputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),leftInputForLeftOutputWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:leftInputForLeftOutputWaveShaperCurve})),leftInputForRightOutputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),leftInputForRightOutputWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:leftInputForRightOutputWaveShaperCurve})),panWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:DC_CURVE})),rightInputForLeftOutputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),rightInputForLeftOutputWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:rightInputForLeftOutputWaveShaperCurve})),rightInputForRightOutputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_OPTIONS),{gain:0})),rightInputForRightOutputWaveShaperNode=createNativeWaveShaperNode2(nativeContext,__spreadProps(__spreadValues({},SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS),{curve:rightInputForRightOutputWaveShaperCurve}));return{connectGraph(){inputGainNode.connect(channelSplitterNode),inputGainNode.connect(panWaveShaperNode.inputs===void 0?panWaveShaperNode:panWaveShaperNode.inputs[0]),channelSplitterNode.connect(leftInputForLeftOutputGainNode,0),channelSplitterNode.connect(leftInputForRightOutputGainNode,0),channelSplitterNode.connect(rightInputForLeftOutputGainNode,1),channelSplitterNode.connect(rightInputForRightOutputGainNode,1),panWaveShaperNode.connect(panGainNode),panGainNode.connect(leftInputForLeftOutputWaveShaperNode.inputs===void 0?leftInputForLeftOutputWaveShaperNode:leftInputForLeftOutputWaveShaperNode.inputs[0]),panGainNode.connect(leftInputForRightOutputWaveShaperNode.inputs===void 0?leftInputForRightOutputWaveShaperNode:leftInputForRightOutputWaveShaperNode.inputs[0]),panGainNode.connect(rightInputForLeftOutputWaveShaperNode.inputs===void 0?rightInputForLeftOutputWaveShaperNode:rightInputForLeftOutputWaveShaperNode.inputs[0]),panGainNode.connect(rightInputForRightOutputWaveShaperNode.inputs===void 0?rightInputForRightOutputWaveShaperNode:rightInputForRightOutputWaveShaperNode.inputs[0]),leftInputForLeftOutputWaveShaperNode.connect(leftInputForLeftOutputGainNode.gain),leftInputForRightOutputWaveShaperNode.connect(leftInputForRightOutputGainNode.gain),rightInputForLeftOutputWaveShaperNode.connect(rightInputForLeftOutputGainNode.gain),rightInputForRightOutputWaveShaperNode.connect(rightInputForRightOutputGainNode.gain),leftInputForLeftOutputGainNode.connect(channelMergerNode,0,0),rightInputForLeftOutputGainNode.connect(channelMergerNode,0,0),leftInputForRightOutputGainNode.connect(channelMergerNode,0,1),rightInputForRightOutputGainNode.connect(channelMergerNode,0,1)},disconnectGraph(){inputGainNode.disconnect(channelSplitterNode),inputGainNode.disconnect(panWaveShaperNode.inputs===void 0?panWaveShaperNode:panWaveShaperNode.inputs[0]),channelSplitterNode.disconnect(leftInputForLeftOutputGainNode,0),channelSplitterNode.disconnect(leftInputForRightOutputGainNode,0),channelSplitterNode.disconnect(rightInputForLeftOutputGainNode,1),channelSplitterNode.disconnect(rightInputForRightOutputGainNode,1),panWaveShaperNode.disconnect(panGainNode),panGainNode.disconnect(leftInputForLeftOutputWaveShaperNode.inputs===void 0?leftInputForLeftOutputWaveShaperNode:leftInputForLeftOutputWaveShaperNode.inputs[0]),panGainNode.disconnect(leftInputForRightOutputWaveShaperNode.inputs===void 0?leftInputForRightOutputWaveShaperNode:leftInputForRightOutputWaveShaperNode.inputs[0]),panGainNode.disconnect(rightInputForLeftOutputWaveShaperNode.inputs===void 0?rightInputForLeftOutputWaveShaperNode:rightInputForLeftOutputWaveShaperNode.inputs[0]),panGainNode.disconnect(rightInputForRightOutputWaveShaperNode.inputs===void 0?rightInputForRightOutputWaveShaperNode:rightInputForRightOutputWaveShaperNode.inputs[0]),leftInputForLeftOutputWaveShaperNode.disconnect(leftInputForLeftOutputGainNode.gain),leftInputForRightOutputWaveShaperNode.disconnect(leftInputForRightOutputGainNode.gain),rightInputForLeftOutputWaveShaperNode.disconnect(rightInputForLeftOutputGainNode.gain),rightInputForRightOutputWaveShaperNode.disconnect(rightInputForRightOutputGainNode.gain),leftInputForLeftOutputGainNode.disconnect(channelMergerNode,0,0),rightInputForLeftOutputGainNode.disconnect(channelMergerNode,0,0),leftInputForRightOutputGainNode.disconnect(channelMergerNode,0,1),rightInputForRightOutputGainNode.disconnect(channelMergerNode,0,1)}}},buildInternalGraph=(nativeContext,channelCount,inputGainNode,panGainNode,channelMergerNode)=>{if(channelCount===1)return buildInternalGraphForMono(nativeContext,inputGainNode,panGainNode,channelMergerNode);if(channelCount===2)return buildInternalGraphForStereo(nativeContext,inputGainNode,panGainNode,channelMergerNode);throw createNotSupportedError2()};return(nativeContext,_a3)=>{var _b2=_a3,{channelCount,channelCountMode,pan}=_b2,audioNodeOptions=__objRest(_b2,["channelCount","channelCountMode","pan"]);if(channelCountMode==="max")throw createNotSupportedError2();let channelMergerNode=createNativeChannelMergerNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{channelCount:1,channelCountMode,numberOfInputs:2})),inputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{channelCount,channelCountMode,gain:1})),panGainNode=createNativeGainNode2(nativeContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:pan}),{connectGraph,disconnectGraph}=buildInternalGraph(nativeContext,channelCount,inputGainNode,panGainNode,channelMergerNode);Object.defineProperty(panGainNode.gain,"defaultValue",{get:()=>0}),Object.defineProperty(panGainNode.gain,"maxValue",{get:()=>1}),Object.defineProperty(panGainNode.gain,"minValue",{get:()=>-1});let nativeStereoPannerNodeFakerFactory2={get bufferSize(){},get channelCount(){return inputGainNode.channelCount},set channelCount(value){inputGainNode.channelCount!==value&&(isConnected&&disconnectGraph(),{connectGraph,disconnectGraph}=buildInternalGraph(nativeContext,value,inputGainNode,panGainNode,channelMergerNode),isConnected&&connectGraph()),inputGainNode.channelCount=value},get channelCountMode(){return inputGainNode.channelCountMode},set channelCountMode(value){if(value==="clamped-max"||value==="max")throw createNotSupportedError2();inputGainNode.channelCountMode=value},get channelInterpretation(){return inputGainNode.channelInterpretation},set channelInterpretation(value){inputGainNode.channelInterpretation=value},get context(){return inputGainNode.context},get inputs(){return[inputGainNode]},get numberOfInputs(){return inputGainNode.numberOfInputs},get numberOfOutputs(){return inputGainNode.numberOfOutputs},get pan(){return panGainNode.gain},addEventListener(...args){return inputGainNode.addEventListener(args[0],args[1],args[2])},dispatchEvent(...args){return inputGainNode.dispatchEvent(args[0])},removeEventListener(...args){return inputGainNode.removeEventListener(args[0],args[1],args[2])}},isConnected=!1,whenConnected=()=>{connectGraph(),isConnected=!0},whenDisconnected=()=>{disconnectGraph(),isConnected=!1};return monitorConnections2(interceptConnections(nativeStereoPannerNodeFakerFactory2,channelMergerNode),whenConnected,whenDisconnected)}};var createNativeWaveShaperNodeFactory=(createConnectedNativeAudioBufferSourceNode2,createInvalidStateError2,createNativeWaveShaperNodeFaker2,isDCCurve2,monitorConnections2,nativeAudioContextConstructor2,overwriteAccessors2)=>(nativeContext,options)=>{let nativeWaveShaperNode=nativeContext.createWaveShaper();if(nativeAudioContextConstructor2!==null&&nativeAudioContextConstructor2.name==="webkitAudioContext"&&nativeContext.createGain().gain.automationRate===void 0)return createNativeWaveShaperNodeFaker2(nativeContext,options);assignNativeAudioNodeOptions(nativeWaveShaperNode,options);let curve=options.curve===null||options.curve instanceof Float32Array?options.curve:new Float32Array(options.curve);if(curve!==null&&curve.length<2)throw createInvalidStateError2();assignNativeAudioNodeOption(nativeWaveShaperNode,{curve},"curve"),assignNativeAudioNodeOption(nativeWaveShaperNode,options,"oversample");let disconnectNativeAudioBufferSourceNode=null,isConnected=!1;return overwriteAccessors2(nativeWaveShaperNode,"curve",get=>()=>get.call(nativeWaveShaperNode),set=>value=>(set.call(nativeWaveShaperNode,value),isConnected&&(isDCCurve2(value)&&disconnectNativeAudioBufferSourceNode===null?disconnectNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNode2(nativeContext,nativeWaveShaperNode):!isDCCurve2(value)&&disconnectNativeAudioBufferSourceNode!==null&&(disconnectNativeAudioBufferSourceNode(),disconnectNativeAudioBufferSourceNode=null)),value)),monitorConnections2(nativeWaveShaperNode,()=>{isConnected=!0,isDCCurve2(nativeWaveShaperNode.curve)&&(disconnectNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNode2(nativeContext,nativeWaveShaperNode))},()=>{isConnected=!1,disconnectNativeAudioBufferSourceNode!==null&&(disconnectNativeAudioBufferSourceNode(),disconnectNativeAudioBufferSourceNode=null)})};var createNativeWaveShaperNodeFakerFactory=(createConnectedNativeAudioBufferSourceNode2,createInvalidStateError2,createNativeGainNode2,isDCCurve2,monitorConnections2)=>(nativeContext,_a3)=>{var _b2=_a3,{curve,oversample}=_b2,audioNodeOptions=__objRest(_b2,["curve","oversample"]);let negativeWaveShaperNode=nativeContext.createWaveShaper(),positiveWaveShaperNode=nativeContext.createWaveShaper();assignNativeAudioNodeOptions(negativeWaveShaperNode,audioNodeOptions),assignNativeAudioNodeOptions(positiveWaveShaperNode,audioNodeOptions);let inputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{gain:1})),invertGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{gain:-1})),outputGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{gain:1})),revertGainNode=createNativeGainNode2(nativeContext,__spreadProps(__spreadValues({},audioNodeOptions),{gain:-1})),disconnectNativeAudioBufferSourceNode=null,isConnected=!1,unmodifiedCurve=null,nativeWaveShaperNodeFaker={get bufferSize(){},get channelCount(){return negativeWaveShaperNode.channelCount},set channelCount(value){inputGainNode.channelCount=value,invertGainNode.channelCount=value,negativeWaveShaperNode.channelCount=value,outputGainNode.channelCount=value,positiveWaveShaperNode.channelCount=value,revertGainNode.channelCount=value},get channelCountMode(){return negativeWaveShaperNode.channelCountMode},set channelCountMode(value){inputGainNode.channelCountMode=value,invertGainNode.channelCountMode=value,negativeWaveShaperNode.channelCountMode=value,outputGainNode.channelCountMode=value,positiveWaveShaperNode.channelCountMode=value,revertGainNode.channelCountMode=value},get channelInterpretation(){return negativeWaveShaperNode.channelInterpretation},set channelInterpretation(value){inputGainNode.channelInterpretation=value,invertGainNode.channelInterpretation=value,negativeWaveShaperNode.channelInterpretation=value,outputGainNode.channelInterpretation=value,positiveWaveShaperNode.channelInterpretation=value,revertGainNode.channelInterpretation=value},get context(){return negativeWaveShaperNode.context},get curve(){return unmodifiedCurve},set curve(value){if(value!==null&&value.length<2)throw createInvalidStateError2();if(value===null)negativeWaveShaperNode.curve=value,positiveWaveShaperNode.curve=value;else{let curveLength=value.length,negativeCurve=new Float32Array(curveLength+2-curveLength%2),positiveCurve=new Float32Array(curveLength+2-curveLength%2);negativeCurve[0]=value[0],positiveCurve[0]=-value[curveLength-1];let length=Math.ceil((curveLength+1)/2),centerIndex=(curveLength+1)/2-1;for(let i=1;i<length;i+=1){let theoreticIndex=i/length*centerIndex,lowerIndex=Math.floor(theoreticIndex),upperIndex=Math.ceil(theoreticIndex);negativeCurve[i]=lowerIndex===upperIndex?value[lowerIndex]:(1-(theoreticIndex-lowerIndex))*value[lowerIndex]+(1-(upperIndex-theoreticIndex))*value[upperIndex],positiveCurve[i]=lowerIndex===upperIndex?-value[curveLength-1-lowerIndex]:-((1-(theoreticIndex-lowerIndex))*value[curveLength-1-lowerIndex])-(1-(upperIndex-theoreticIndex))*value[curveLength-1-upperIndex]}negativeCurve[length]=curveLength%2==1?value[length-1]:(value[length-2]+value[length-1])/2,negativeWaveShaperNode.curve=negativeCurve,positiveWaveShaperNode.curve=positiveCurve}unmodifiedCurve=value,isConnected&&(isDCCurve2(unmodifiedCurve)&&disconnectNativeAudioBufferSourceNode===null?disconnectNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNode2(nativeContext,inputGainNode):disconnectNativeAudioBufferSourceNode!==null&&(disconnectNativeAudioBufferSourceNode(),disconnectNativeAudioBufferSourceNode=null))},get inputs(){return[inputGainNode]},get numberOfInputs(){return negativeWaveShaperNode.numberOfInputs},get numberOfOutputs(){return negativeWaveShaperNode.numberOfOutputs},get oversample(){return negativeWaveShaperNode.oversample},set oversample(value){negativeWaveShaperNode.oversample=value,positiveWaveShaperNode.oversample=value},addEventListener(...args){return inputGainNode.addEventListener(args[0],args[1],args[2])},dispatchEvent(...args){return inputGainNode.dispatchEvent(args[0])},removeEventListener(...args){return inputGainNode.removeEventListener(args[0],args[1],args[2])}};curve!==null&&(nativeWaveShaperNodeFaker.curve=curve instanceof Float32Array?curve:new Float32Array(curve)),oversample!==nativeWaveShaperNodeFaker.oversample&&(nativeWaveShaperNodeFaker.oversample=oversample);let whenConnected=()=>{inputGainNode.connect(negativeWaveShaperNode).connect(outputGainNode),inputGainNode.connect(invertGainNode).connect(positiveWaveShaperNode).connect(revertGainNode).connect(outputGainNode),isConnected=!0,isDCCurve2(unmodifiedCurve)&&(disconnectNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNode2(nativeContext,inputGainNode))},whenDisconnected=()=>{inputGainNode.disconnect(negativeWaveShaperNode),negativeWaveShaperNode.disconnect(outputGainNode),inputGainNode.disconnect(invertGainNode),invertGainNode.disconnect(positiveWaveShaperNode),positiveWaveShaperNode.disconnect(revertGainNode),revertGainNode.disconnect(outputGainNode),isConnected=!1,disconnectNativeAudioBufferSourceNode!==null&&(disconnectNativeAudioBufferSourceNode(),disconnectNativeAudioBufferSourceNode=null)};return monitorConnections2(interceptConnections(nativeWaveShaperNodeFaker,outputGainNode),whenConnected,whenDisconnected)};var createNotSupportedError=()=>new DOMException("","NotSupportedError");var DEFAULT_OPTIONS16={numberOfChannels:1},createOfflineAudioContextConstructor=(baseAudioContextConstructor2,cacheTestResult2,createInvalidStateError2,createNativeOfflineAudioContext2,startRendering2)=>class extends baseAudioContextConstructor2{constructor(a,b,c){let options;if(typeof a=="number"&&b!==void 0&&c!==void 0)options={length:b,numberOfChannels:a,sampleRate:c};else if(typeof a=="object")options=a;else throw new Error("The given parameters are not valid.");let{length,numberOfChannels,sampleRate}=__spreadValues(__spreadValues({},DEFAULT_OPTIONS16),options),nativeOfflineAudioContext=createNativeOfflineAudioContext2(numberOfChannels,length,sampleRate);cacheTestResult2(testPromiseSupport,()=>testPromiseSupport(nativeOfflineAudioContext))||nativeOfflineAudioContext.addEventListener("statechange",(()=>{let i=0,delayStateChangeEvent=event=>{this._state==="running"&&(i>0?(nativeOfflineAudioContext.removeEventListener("statechange",delayStateChangeEvent),event.stopImmediatePropagation(),this._waitForThePromiseToSettle(event)):i+=1)};return delayStateChangeEvent})()),super(nativeOfflineAudioContext,numberOfChannels),this._length=length,this._nativeOfflineAudioContext=nativeOfflineAudioContext,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(createInvalidStateError2()):(this._state="running",startRendering2(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,deactivateAudioGraph(this)}))}_waitForThePromiseToSettle(event){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(event):setTimeout(()=>this._waitForThePromiseToSettle(event))}};var DEFAULT_OPTIONS17={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},createOscillatorNodeConstructor=(audioNodeConstructor2,createAudioParam2,createNativeOscillatorNode2,createOscillatorNodeRenderer2,getNativeContext2,isNativeOfflineAudioContext2,wrapEventListener2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS17),options),nativeOscillatorNode=createNativeOscillatorNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),oscillatorNodeRenderer=isOffline?createOscillatorNodeRenderer2():null,nyquist=context4.sampleRate/2;super(context4,!1,nativeOscillatorNode,oscillatorNodeRenderer);this._detune=createAudioParam2(this,isOffline,nativeOscillatorNode.detune,153600,-153600),this._frequency=createAudioParam2(this,isOffline,nativeOscillatorNode.frequency,nyquist,-nyquist),this._nativeOscillatorNode=nativeOscillatorNode,this._onended=null,this._oscillatorNodeRenderer=oscillatorNodeRenderer,this._oscillatorNodeRenderer!==null&&mergedOptions.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=mergedOptions.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(value){let wrappedListener=typeof value=="function"?wrapEventListener2(this,value):null;this._nativeOscillatorNode.onended=wrappedListener;let nativeOnEnded=this._nativeOscillatorNode.onended;this._onended=nativeOnEnded!==null&&nativeOnEnded===wrappedListener?value:nativeOnEnded}get type(){return this._nativeOscillatorNode.type}set type(value){this._nativeOscillatorNode.type=value,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(periodicWave){this._nativeOscillatorNode.setPeriodicWave(periodicWave),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=periodicWave)}start(when=0){if(this._nativeOscillatorNode.start(when),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=when),this.context.state!=="closed"){setInternalStateToActive(this);let resetInternalStateToPassive=()=>{this._nativeOscillatorNode.removeEventListener("ended",resetInternalStateToPassive),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeOscillatorNode.addEventListener("ended",resetInternalStateToPassive)}}stop(when=0){this._nativeOscillatorNode.stop(when),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=when)}};var createOscillatorNodeRendererFactory=(connectAudioParam2,createNativeOscillatorNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeOscillatorNodes=new WeakMap,periodicWave=null,start2=null,stop=null,createOscillatorNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeOscillatorNode=getNativeAudioNode2(proxy),nativeOscillatorNodeIsOwnedByContext=isOwnedByContext(nativeOscillatorNode,nativeOfflineAudioContext);if(!nativeOscillatorNodeIsOwnedByContext){let options={channelCount:nativeOscillatorNode.channelCount,channelCountMode:nativeOscillatorNode.channelCountMode,channelInterpretation:nativeOscillatorNode.channelInterpretation,detune:nativeOscillatorNode.detune.value,frequency:nativeOscillatorNode.frequency.value,periodicWave:periodicWave===null?void 0:periodicWave,type:nativeOscillatorNode.type};nativeOscillatorNode=createNativeOscillatorNode2(nativeOfflineAudioContext,options),start2!==null&&nativeOscillatorNode.start(start2),stop!==null&&nativeOscillatorNode.stop(stop)}return renderedNativeOscillatorNodes.set(nativeOfflineAudioContext,nativeOscillatorNode),nativeOscillatorNodeIsOwnedByContext?(await connectAudioParam2(nativeOfflineAudioContext,proxy.detune,nativeOscillatorNode.detune,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.frequency,nativeOscillatorNode.frequency,trace)):(await renderAutomation2(nativeOfflineAudioContext,proxy.detune,nativeOscillatorNode.detune,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.frequency,nativeOscillatorNode.frequency,trace)),await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeOscillatorNode,trace),nativeOscillatorNode};return{set periodicWave(value){periodicWave=value},set start(value){start2=value},set stop(value){stop=value},render(proxy,nativeOfflineAudioContext,trace){let renderedNativeOscillatorNode=renderedNativeOscillatorNodes.get(nativeOfflineAudioContext);return renderedNativeOscillatorNode!==void 0?Promise.resolve(renderedNativeOscillatorNode):createOscillatorNode(proxy,nativeOfflineAudioContext,trace)}}};var DEFAULT_OPTIONS18={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},createPannerNodeConstructor=(audioNodeConstructor2,createAudioParam2,createNativePannerNode2,createPannerNodeRenderer2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS18),options),nativePannerNode=createNativePannerNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),pannerNodeRenderer=isOffline?createPannerNodeRenderer2():null;super(context4,!1,nativePannerNode,pannerNodeRenderer);this._nativePannerNode=nativePannerNode,this._orientationX=createAudioParam2(this,isOffline,nativePannerNode.orientationX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationY=createAudioParam2(this,isOffline,nativePannerNode.orientationY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationZ=createAudioParam2(this,isOffline,nativePannerNode.orientationZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionX=createAudioParam2(this,isOffline,nativePannerNode.positionX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionY=createAudioParam2(this,isOffline,nativePannerNode.positionY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionZ=createAudioParam2(this,isOffline,nativePannerNode.positionZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),setAudioNodeTailTime2(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(value){this._nativePannerNode.coneInnerAngle=value}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(value){this._nativePannerNode.coneOuterAngle=value}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(value){this._nativePannerNode.coneOuterGain=value}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(value){this._nativePannerNode.distanceModel=value}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(value){this._nativePannerNode.maxDistance=value}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(value){this._nativePannerNode.panningModel=value}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(value){this._nativePannerNode.refDistance=value}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(value){this._nativePannerNode.rolloffFactor=value}};var createPannerNodeRendererFactory=(connectAudioParam2,createNativeChannelMergerNode2,createNativeConstantSourceNode2,createNativeGainNode2,createNativePannerNode2,getNativeAudioNode2,nativeOfflineAudioContextConstructor2,renderAutomation2,renderInputsOfAudioNode2,renderNativeOfflineAudioContext2)=>()=>{let renderedNativeAudioNodes=new WeakMap,renderedBufferPromise=null,createAudioNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeGainNode=null,nativePannerNode=getNativeAudioNode2(proxy),commonAudioNodeOptions={channelCount:nativePannerNode.channelCount,channelCountMode:nativePannerNode.channelCountMode,channelInterpretation:nativePannerNode.channelInterpretation},commonNativePannerNodeOptions=__spreadProps(__spreadValues({},commonAudioNodeOptions),{coneInnerAngle:nativePannerNode.coneInnerAngle,coneOuterAngle:nativePannerNode.coneOuterAngle,coneOuterGain:nativePannerNode.coneOuterGain,distanceModel:nativePannerNode.distanceModel,maxDistance:nativePannerNode.maxDistance,panningModel:nativePannerNode.panningModel,refDistance:nativePannerNode.refDistance,rolloffFactor:nativePannerNode.rolloffFactor}),nativePannerNodeIsOwnedByContext=isOwnedByContext(nativePannerNode,nativeOfflineAudioContext);if("bufferSize"in nativePannerNode)nativeGainNode=createNativeGainNode2(nativeOfflineAudioContext,__spreadProps(__spreadValues({},commonAudioNodeOptions),{gain:1}));else if(!nativePannerNodeIsOwnedByContext){let options=__spreadProps(__spreadValues({},commonNativePannerNodeOptions),{orientationX:nativePannerNode.orientationX.value,orientationY:nativePannerNode.orientationY.value,orientationZ:nativePannerNode.orientationZ.value,positionX:nativePannerNode.positionX.value,positionY:nativePannerNode.positionY.value,positionZ:nativePannerNode.positionZ.value});nativePannerNode=createNativePannerNode2(nativeOfflineAudioContext,options)}if(renderedNativeAudioNodes.set(nativeOfflineAudioContext,nativeGainNode===null?nativePannerNode:nativeGainNode),nativeGainNode!==null){if(renderedBufferPromise===null){if(nativeOfflineAudioContextConstructor2===null)throw new Error("Missing the native OfflineAudioContext constructor.");let partialOfflineAudioContext=new nativeOfflineAudioContextConstructor2(6,proxy.context.length,nativeOfflineAudioContext.sampleRate),nativeChannelMergerNode=createNativeChannelMergerNode2(partialOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});nativeChannelMergerNode.connect(partialOfflineAudioContext.destination),renderedBufferPromise=(async()=>{let nativeConstantSourceNodes=await Promise.all([proxy.orientationX,proxy.orientationY,proxy.orientationZ,proxy.positionX,proxy.positionY,proxy.positionZ].map(async(audioParam,index3)=>{let nativeConstantSourceNode=createNativeConstantSourceNode2(partialOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:index3===0?1:0});return await renderAutomation2(partialOfflineAudioContext,audioParam,nativeConstantSourceNode.offset,trace),nativeConstantSourceNode}));for(let i=0;i<6;i+=1)nativeConstantSourceNodes[i].connect(nativeChannelMergerNode,0,i),nativeConstantSourceNodes[i].start(0);return renderNativeOfflineAudioContext2(partialOfflineAudioContext)})()}let renderedBuffer=await renderedBufferPromise,inputGainNode=createNativeGainNode2(nativeOfflineAudioContext,__spreadProps(__spreadValues({},commonAudioNodeOptions),{gain:1}));await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,inputGainNode,trace);let channelDatas=[];for(let i=0;i<renderedBuffer.numberOfChannels;i+=1)channelDatas.push(renderedBuffer.getChannelData(i));let lastOrientation=[channelDatas[0][0],channelDatas[1][0],channelDatas[2][0]],lastPosition=[channelDatas[3][0],channelDatas[4][0],channelDatas[5][0]],gateGainNode=createNativeGainNode2(nativeOfflineAudioContext,__spreadProps(__spreadValues({},commonAudioNodeOptions),{gain:1})),partialPannerNode=createNativePannerNode2(nativeOfflineAudioContext,__spreadProps(__spreadValues({},commonNativePannerNodeOptions),{orientationX:lastOrientation[0],orientationY:lastOrientation[1],orientationZ:lastOrientation[2],positionX:lastPosition[0],positionY:lastPosition[1],positionZ:lastPosition[2]}));inputGainNode.connect(gateGainNode).connect(partialPannerNode.inputs[0]),partialPannerNode.connect(nativeGainNode);for(let i=128;i<renderedBuffer.length;i+=128){let orientation=[channelDatas[0][i],channelDatas[1][i],channelDatas[2][i]],positon=[channelDatas[3][i],channelDatas[4][i],channelDatas[5][i]];if(orientation.some((value,index3)=>value!==lastOrientation[index3])||positon.some((value,index3)=>value!==lastPosition[index3])){lastOrientation=orientation,lastPosition=positon;let currentTime=i/nativeOfflineAudioContext.sampleRate;gateGainNode.gain.setValueAtTime(0,currentTime),gateGainNode=createNativeGainNode2(nativeOfflineAudioContext,__spreadProps(__spreadValues({},commonAudioNodeOptions),{gain:0})),partialPannerNode=createNativePannerNode2(nativeOfflineAudioContext,__spreadProps(__spreadValues({},commonNativePannerNodeOptions),{orientationX:lastOrientation[0],orientationY:lastOrientation[1],orientationZ:lastOrientation[2],positionX:lastPosition[0],positionY:lastPosition[1],positionZ:lastPosition[2]})),gateGainNode.gain.setValueAtTime(1,currentTime),inputGainNode.connect(gateGainNode).connect(partialPannerNode.inputs[0]),partialPannerNode.connect(nativeGainNode)}}return nativeGainNode}return nativePannerNodeIsOwnedByContext?(await connectAudioParam2(nativeOfflineAudioContext,proxy.orientationX,nativePannerNode.orientationX,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.orientationY,nativePannerNode.orientationY,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.orientationZ,nativePannerNode.orientationZ,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.positionX,nativePannerNode.positionX,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.positionY,nativePannerNode.positionY,trace),await connectAudioParam2(nativeOfflineAudioContext,proxy.positionZ,nativePannerNode.positionZ,trace)):(await renderAutomation2(nativeOfflineAudioContext,proxy.orientationX,nativePannerNode.orientationX,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.orientationY,nativePannerNode.orientationY,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.orientationZ,nativePannerNode.orientationZ,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.positionX,nativePannerNode.positionX,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.positionY,nativePannerNode.positionY,trace),await renderAutomation2(nativeOfflineAudioContext,proxy.positionZ,nativePannerNode.positionZ,trace)),isNativeAudioNodeFaker(nativePannerNode)?await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativePannerNode.inputs[0],trace):await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativePannerNode,trace),nativePannerNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeGainNodeOrNativePannerNode=renderedNativeAudioNodes.get(nativeOfflineAudioContext);return renderedNativeGainNodeOrNativePannerNode!==void 0?Promise.resolve(renderedNativeGainNodeOrNativePannerNode):createAudioNode(proxy,nativeOfflineAudioContext,trace)}}};var DEFAULT_OPTIONS19={disableNormalization:!1},createPeriodicWaveConstructor=(createNativePeriodicWave2,getNativeContext2,periodicWaveStore,sanitizePeriodicWaveOptions2)=>class PeriodicWave{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=sanitizePeriodicWaveOptions2(__spreadValues(__spreadValues({},DEFAULT_OPTIONS19),options)),periodicWave=createNativePeriodicWave2(nativeContext,mergedOptions);return periodicWaveStore.add(periodicWave),periodicWave}static[Symbol.hasInstance](instance){return instance!==null&&typeof instance=="object"&&Object.getPrototypeOf(instance)===PeriodicWave.prototype||periodicWaveStore.has(instance)}};var createRenderAutomation=(getAudioParamRenderer,renderInputsOfAudioParam2)=>(nativeOfflineAudioContext,audioParam,nativeAudioParam,trace)=>(getAudioParamRenderer(audioParam).replay(nativeAudioParam),renderInputsOfAudioParam2(audioParam,nativeOfflineAudioContext,nativeAudioParam,trace));var createRenderInputsOfAudioNode=(getAudioNodeConnections2,getAudioNodeRenderer2,isPartOfACycle2)=>async(audioNode,nativeOfflineAudioContext,nativeAudioNode,trace)=>{let audioNodeConnections=getAudioNodeConnections2(audioNode),nextTrace=[...trace,audioNode];await Promise.all(audioNodeConnections.activeInputs.map((connections,input)=>Array.from(connections).filter(([source])=>!nextTrace.includes(source)).map(async([source,output])=>{let renderedNativeAudioNode=await getAudioNodeRenderer2(source).render(source,nativeOfflineAudioContext,nextTrace),destination=audioNode.context.destination;!isPartOfACycle2(source)&&(audioNode!==destination||!isPartOfACycle2(audioNode))&&renderedNativeAudioNode.connect(nativeAudioNode,output,input)})).reduce((allRenderingPromises,renderingPromises)=>[...allRenderingPromises,...renderingPromises],[]))};var createRenderInputsOfAudioParam=(getAudioNodeRenderer2,getAudioParamConnections2,isPartOfACycle2)=>async(audioParam,nativeOfflineAudioContext,nativeAudioParam,trace)=>{let audioParamConnections=getAudioParamConnections2(audioParam);await Promise.all(Array.from(audioParamConnections.activeInputs).map(async([source,output])=>{let renderedNativeAudioNode=await getAudioNodeRenderer2(source).render(source,nativeOfflineAudioContext,trace);isPartOfACycle2(source)||renderedNativeAudioNode.connect(nativeAudioParam,output)}))};var createRenderNativeOfflineAudioContext=(cacheTestResult2,createNativeGainNode2,createNativeScriptProcessorNode2,testOfflineAudioContextCurrentTimeSupport)=>nativeOfflineAudioContext=>cacheTestResult2(testPromiseSupport,()=>testPromiseSupport(nativeOfflineAudioContext))?Promise.resolve(cacheTestResult2(testOfflineAudioContextCurrentTimeSupport,testOfflineAudioContextCurrentTimeSupport)).then(isOfflineAudioContextCurrentTimeSupported=>{if(!isOfflineAudioContextCurrentTimeSupported){let scriptProcessorNode=createNativeScriptProcessorNode2(nativeOfflineAudioContext,512,0,1);nativeOfflineAudioContext.oncomplete=()=>{scriptProcessorNode.onaudioprocess=null,scriptProcessorNode.disconnect()},scriptProcessorNode.onaudioprocess=()=>nativeOfflineAudioContext.currentTime,scriptProcessorNode.connect(nativeOfflineAudioContext.destination)}return nativeOfflineAudioContext.startRendering()}):new Promise(resolve4=>{let gainNode=createNativeGainNode2(nativeOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});nativeOfflineAudioContext.oncomplete=event=>{gainNode.disconnect(),resolve4(event.renderedBuffer)},gainNode.connect(nativeOfflineAudioContext.destination),nativeOfflineAudioContext.startRendering()});var createSetActiveAudioWorkletNodeInputs=activeAudioWorkletNodeInputsStore2=>(nativeAudioWorkletNode,activeInputs)=>{activeAudioWorkletNodeInputsStore2.set(nativeAudioWorkletNode,activeInputs)};var createSetAudioNodeTailTime=audioNodeTailTimeStore2=>(audioNode,tailTime)=>audioNodeTailTimeStore2.set(audioNode,tailTime);var createStartRendering=(audioBufferStore2,cacheTestResult2,getAudioNodeRenderer2,getUnrenderedAudioWorkletNodes2,renderNativeOfflineAudioContext2,testAudioBufferCopyChannelMethodsOutOfBoundsSupport2,wrapAudioBufferCopyChannelMethods2,wrapAudioBufferCopyChannelMethodsOutOfBounds2)=>{let trace=[];return(destination,nativeOfflineAudioContext)=>getAudioNodeRenderer2(destination).render(destination,nativeOfflineAudioContext,trace).then(()=>Promise.all(Array.from(getUnrenderedAudioWorkletNodes2(nativeOfflineAudioContext)).map(audioWorkletNode=>getAudioNodeRenderer2(audioWorkletNode).render(audioWorkletNode,nativeOfflineAudioContext,trace)))).then(()=>renderNativeOfflineAudioContext2(nativeOfflineAudioContext)).then(audioBuffer=>(typeof audioBuffer.copyFromChannel!="function"?(wrapAudioBufferCopyChannelMethods2(audioBuffer),wrapAudioBufferGetChannelDataMethod(audioBuffer)):cacheTestResult2(testAudioBufferCopyChannelMethodsOutOfBoundsSupport2,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport2(audioBuffer))||wrapAudioBufferCopyChannelMethodsOutOfBounds2(audioBuffer),audioBufferStore2.add(audioBuffer),audioBuffer))};var DEFAULT_OPTIONS20={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},createStereoPannerNodeConstructor=(audioNodeConstructor2,createAudioParam2,createNativeStereoPannerNode2,createStereoPannerNodeRenderer2,getNativeContext2,isNativeOfflineAudioContext2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS20),options),nativeStereoPannerNode=createNativeStereoPannerNode2(nativeContext,mergedOptions),isOffline=isNativeOfflineAudioContext2(nativeContext),stereoPannerNodeRenderer=isOffline?createStereoPannerNodeRenderer2():null;super(context4,!1,nativeStereoPannerNode,stereoPannerNodeRenderer);this._pan=createAudioParam2(this,isOffline,nativeStereoPannerNode.pan)}get pan(){return this._pan}};var createStereoPannerNodeRendererFactory=(connectAudioParam2,createNativeStereoPannerNode2,getNativeAudioNode2,renderAutomation2,renderInputsOfAudioNode2)=>()=>{let renderedNativeStereoPannerNodes=new WeakMap,createStereoPannerNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeStereoPannerNode=getNativeAudioNode2(proxy),nativeStereoPannerNodeIsOwnedByContext=isOwnedByContext(nativeStereoPannerNode,nativeOfflineAudioContext);if(!nativeStereoPannerNodeIsOwnedByContext){let options={channelCount:nativeStereoPannerNode.channelCount,channelCountMode:nativeStereoPannerNode.channelCountMode,channelInterpretation:nativeStereoPannerNode.channelInterpretation,pan:nativeStereoPannerNode.pan.value};nativeStereoPannerNode=createNativeStereoPannerNode2(nativeOfflineAudioContext,options)}return renderedNativeStereoPannerNodes.set(nativeOfflineAudioContext,nativeStereoPannerNode),nativeStereoPannerNodeIsOwnedByContext?await connectAudioParam2(nativeOfflineAudioContext,proxy.pan,nativeStereoPannerNode.pan,trace):await renderAutomation2(nativeOfflineAudioContext,proxy.pan,nativeStereoPannerNode.pan,trace),isNativeAudioNodeFaker(nativeStereoPannerNode)?await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeStereoPannerNode.inputs[0],trace):await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeStereoPannerNode,trace),nativeStereoPannerNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeStereoPannerNode=renderedNativeStereoPannerNodes.get(nativeOfflineAudioContext);return renderedNativeStereoPannerNode!==void 0?Promise.resolve(renderedNativeStereoPannerNode):createStereoPannerNode(proxy,nativeOfflineAudioContext,trace)}}};var createTestAudioBufferConstructorSupport=nativeAudioBufferConstructor2=>()=>{if(nativeAudioBufferConstructor2===null)return!1;try{new nativeAudioBufferConstructor2({length:1,sampleRate:44100})}catch(e){return!1}return!0};var createTestAudioBufferCopyChannelMethodsSubarraySupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return!1;let nativeAudioBuffer=new nativeOfflineAudioContextConstructor2(1,1,44100).createBuffer(1,1,44100);if(nativeAudioBuffer.copyToChannel===void 0)return!0;let source=new Float32Array(2);try{nativeAudioBuffer.copyFromChannel(source,0,0)}catch(e){return!1}return!0};var createTestAudioContextCloseMethodSupport=nativeAudioContextConstructor2=>()=>{if(nativeAudioContextConstructor2===null)return!1;if(nativeAudioContextConstructor2.prototype!==void 0&&nativeAudioContextConstructor2.prototype.close!==void 0)return!0;let audioContext=new nativeAudioContextConstructor2,isAudioContextClosable=audioContext.close!==void 0;try{audioContext.close()}catch(e){}return isAudioContextClosable};var createTestAudioContextDecodeAudioDataMethodTypeErrorSupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return Promise.resolve(!1);let offlineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100);return new Promise(resolve4=>{let isPending=!0,resolvePromise=err=>{isPending&&(isPending=!1,offlineAudioContext.startRendering(),resolve4(err instanceof TypeError))},promise;try{promise=offlineAudioContext.decodeAudioData(null,()=>{},resolvePromise)}catch(err){resolvePromise(err)}promise!==void 0&&promise.catch(resolvePromise)})};var createTestAudioContextOptionsSupport=nativeAudioContextConstructor2=>()=>{if(nativeAudioContextConstructor2===null)return!1;let audioContext;try{audioContext=new nativeAudioContextConstructor2({latencyHint:"balanced"})}catch(e){return!1}return audioContext.close(),!0};var createTestAudioNodeConnectMethodSupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return!1;let nativeGainNode=new nativeOfflineAudioContextConstructor2(1,1,44100).createGain(),isSupported2=nativeGainNode.connect(nativeGainNode)===nativeGainNode;return nativeGainNode.disconnect(nativeGainNode),isSupported2};var createTestAudioWorkletProcessorNoOutputsSupport=(nativeAudioWorkletNodeConstructor2,nativeOfflineAudioContextConstructor2)=>async()=>{if(nativeAudioWorkletNodeConstructor2===null)return!0;if(nativeOfflineAudioContextConstructor2===null)return!1;let blob=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),messageChannel=new MessageChannel,offlineAudioContext=new nativeOfflineAudioContextConstructor2(1,128,44100),url3=URL.createObjectURL(blob),isCallingProcess=!1;try{await offlineAudioContext.audioWorklet.addModule(url3);let audioWorkletNode=new nativeAudioWorkletNodeConstructor2(offlineAudioContext,"a",{numberOfOutputs:0}),oscillator=offlineAudioContext.createOscillator();await new Promise(resolve4=>{audioWorkletNode.port.onmessage=()=>resolve4(),audioWorkletNode.port.postMessage(messageChannel.port2,[messageChannel.port2])}),audioWorkletNode.port.onmessage=()=>isCallingProcess=!0,oscillator.connect(audioWorkletNode),oscillator.start(0),await offlineAudioContext.startRendering(),isCallingProcess=await new Promise(resolve4=>{messageChannel.port1.onmessage=({data})=>resolve4(data===1),messageChannel.port1.postMessage(0)})}catch(e){}finally{messageChannel.port1.close(),URL.revokeObjectURL(url3)}return isCallingProcess};var createTestAudioWorkletProcessorPostMessageSupport=(nativeAudioWorkletNodeConstructor2,nativeOfflineAudioContextConstructor2)=>async()=>{if(nativeAudioWorkletNodeConstructor2===null)return!0;if(nativeOfflineAudioContextConstructor2===null)return!1;let blob=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),offlineAudioContext=new nativeOfflineAudioContextConstructor2(1,128,44100),url3=URL.createObjectURL(blob),isEmittingMessageEvents=!1,isEmittingProcessorErrorEvents=!1;try{await offlineAudioContext.audioWorklet.addModule(url3);let audioWorkletNode=new nativeAudioWorkletNodeConstructor2(offlineAudioContext,"a",{numberOfOutputs:0}),oscillator=offlineAudioContext.createOscillator();audioWorkletNode.port.onmessage=()=>isEmittingMessageEvents=!0,audioWorkletNode.onprocessorerror=()=>isEmittingProcessorErrorEvents=!0,oscillator.connect(audioWorkletNode),oscillator.start(0),await offlineAudioContext.startRendering()}catch(e){}finally{URL.revokeObjectURL(url3)}return isEmittingMessageEvents&&!isEmittingProcessorErrorEvents};var createTestChannelMergerNodeChannelCountSupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return!1;let nativeChannelMergerNode=new nativeOfflineAudioContextConstructor2(1,1,44100).createChannelMerger();if(nativeChannelMergerNode.channelCountMode==="max")return!0;try{nativeChannelMergerNode.channelCount=2}catch(e){return!0}return!1};var createTestConstantSourceNodeAccurateSchedulingSupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return!1;let nativeOfflineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100);return nativeOfflineAudioContext.createConstantSource===void 0?!0:nativeOfflineAudioContext.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY};var createTestConvolverNodeBufferReassignabilitySupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return!1;let offlineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100),nativeConvolverNode=offlineAudioContext.createConvolver();nativeConvolverNode.buffer=offlineAudioContext.createBuffer(1,1,offlineAudioContext.sampleRate);try{nativeConvolverNode.buffer=offlineAudioContext.createBuffer(1,1,offlineAudioContext.sampleRate)}catch(e){return!1}return!0};var createTestConvolverNodeChannelCountSupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return!1;let nativeConvolverNode=new nativeOfflineAudioContextConstructor2(1,1,44100).createConvolver();try{nativeConvolverNode.channelCount=1}catch(e){return!1}return!0};var createTestIsSecureContextSupport=window3=>()=>window3!==null&&window3.hasOwnProperty("isSecureContext");var createTestMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport=nativeAudioContextConstructor2=>()=>{if(nativeAudioContextConstructor2===null)return!1;let audioContext=new nativeAudioContextConstructor2;try{return audioContext.createMediaStreamSource(new MediaStream),!1}catch(err){return!0}};var createTestOfflineAudioContextCurrentTimeSupport=(createNativeGainNode2,nativeOfflineAudioContextConstructor2)=>()=>{if(nativeOfflineAudioContextConstructor2===null)return Promise.resolve(!1);let nativeOfflineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100),gainNode=createNativeGainNode2(nativeOfflineAudioContext,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(resolve4=>{nativeOfflineAudioContext.oncomplete=()=>{gainNode.disconnect(),resolve4(nativeOfflineAudioContext.currentTime!==0)},nativeOfflineAudioContext.startRendering()})};var createTestStereoPannerNodeDefaultValueSupport=nativeOfflineAudioContextConstructor2=>()=>{if(nativeOfflineAudioContextConstructor2===null)return Promise.resolve(!1);let nativeOfflineAudioContext=new nativeOfflineAudioContextConstructor2(1,1,44100);if(nativeOfflineAudioContext.createStereoPanner===void 0||nativeOfflineAudioContext.createConstantSource===void 0)return Promise.resolve(!0);let constantSourceNode=nativeOfflineAudioContext.createConstantSource(),stereoPanner=nativeOfflineAudioContext.createStereoPanner();return constantSourceNode.channelCount=1,constantSourceNode.offset.value=1,stereoPanner.channelCount=1,constantSourceNode.start(),constantSourceNode.connect(stereoPanner).connect(nativeOfflineAudioContext.destination),nativeOfflineAudioContext.startRendering().then(buffer=>buffer.getChannelData(0)[0]!==1)};var createUnknownError=()=>new DOMException("","UnknownError");var DEFAULT_OPTIONS21={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},createWaveShaperNodeConstructor=(audioNodeConstructor2,createInvalidStateError2,createNativeWaveShaperNode2,createWaveShaperNodeRenderer2,getNativeContext2,isNativeOfflineAudioContext2,setAudioNodeTailTime2)=>class extends audioNodeConstructor2{constructor(context4,options){let nativeContext=getNativeContext2(context4),mergedOptions=__spreadValues(__spreadValues({},DEFAULT_OPTIONS21),options),nativeWaveShaperNode=createNativeWaveShaperNode2(nativeContext,mergedOptions),waveShaperNodeRenderer=isNativeOfflineAudioContext2(nativeContext)?createWaveShaperNodeRenderer2():null;super(context4,!0,nativeWaveShaperNode,waveShaperNodeRenderer);this._isCurveNullified=!1,this._nativeWaveShaperNode=nativeWaveShaperNode,setAudioNodeTailTime2(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(value){if(value===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(value.length<2)throw createInvalidStateError2();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=value}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(value){this._nativeWaveShaperNode.oversample=value}};var createWaveShaperNodeRendererFactory=(createNativeWaveShaperNode2,getNativeAudioNode2,renderInputsOfAudioNode2)=>()=>{let renderedNativeWaveShaperNodes=new WeakMap,createWaveShaperNode=async(proxy,nativeOfflineAudioContext,trace)=>{let nativeWaveShaperNode=getNativeAudioNode2(proxy);if(!isOwnedByContext(nativeWaveShaperNode,nativeOfflineAudioContext)){let options={channelCount:nativeWaveShaperNode.channelCount,channelCountMode:nativeWaveShaperNode.channelCountMode,channelInterpretation:nativeWaveShaperNode.channelInterpretation,curve:nativeWaveShaperNode.curve,oversample:nativeWaveShaperNode.oversample};nativeWaveShaperNode=createNativeWaveShaperNode2(nativeOfflineAudioContext,options)}return renderedNativeWaveShaperNodes.set(nativeOfflineAudioContext,nativeWaveShaperNode),isNativeAudioNodeFaker(nativeWaveShaperNode)?await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeWaveShaperNode.inputs[0],trace):await renderInputsOfAudioNode2(proxy,nativeOfflineAudioContext,nativeWaveShaperNode,trace),nativeWaveShaperNode};return{render(proxy,nativeOfflineAudioContext,trace){let renderedNativeWaveShaperNode=renderedNativeWaveShaperNodes.get(nativeOfflineAudioContext);return renderedNativeWaveShaperNode!==void 0?Promise.resolve(renderedNativeWaveShaperNode):createWaveShaperNode(proxy,nativeOfflineAudioContext,trace)}}};var createWindow=()=>typeof window=="undefined"?null:window;var createWrapAudioBufferCopyChannelMethods=(convertNumberToUnsignedLong2,createIndexSizeError2)=>audioBuffer=>{audioBuffer.copyFromChannel=(destination,channelNumberAsNumber,bufferOffsetAsNumber=0)=>{let bufferOffset=convertNumberToUnsignedLong2(bufferOffsetAsNumber),channelNumber=convertNumberToUnsignedLong2(channelNumberAsNumber);if(channelNumber>=audioBuffer.numberOfChannels)throw createIndexSizeError2();let audioBufferLength=audioBuffer.length,channelData=audioBuffer.getChannelData(channelNumber),destinationLength=destination.length;for(let i=bufferOffset<0?-bufferOffset:0;i+bufferOffset<audioBufferLength&&i<destinationLength;i+=1)destination[i]=channelData[i+bufferOffset]},audioBuffer.copyToChannel=(source,channelNumberAsNumber,bufferOffsetAsNumber=0)=>{let bufferOffset=convertNumberToUnsignedLong2(bufferOffsetAsNumber),channelNumber=convertNumberToUnsignedLong2(channelNumberAsNumber);if(channelNumber>=audioBuffer.numberOfChannels)throw createIndexSizeError2();let audioBufferLength=audioBuffer.length,channelData=audioBuffer.getChannelData(channelNumber),sourceLength=source.length;for(let i=bufferOffset<0?-bufferOffset:0;i+bufferOffset<audioBufferLength&&i<sourceLength;i+=1)channelData[i+bufferOffset]=source[i]}};var createWrapAudioBufferCopyChannelMethodsOutOfBounds=convertNumberToUnsignedLong2=>audioBuffer=>{audioBuffer.copyFromChannel=(copyFromChannel2=>(destination,channelNumberAsNumber,bufferOffsetAsNumber=0)=>{let bufferOffset=convertNumberToUnsignedLong2(bufferOffsetAsNumber),channelNumber=convertNumberToUnsignedLong2(channelNumberAsNumber);if(bufferOffset<audioBuffer.length)return copyFromChannel2.call(audioBuffer,destination,channelNumber,bufferOffset)})(audioBuffer.copyFromChannel),audioBuffer.copyToChannel=(copyToChannel2=>(source,channelNumberAsNumber,bufferOffsetAsNumber=0)=>{let bufferOffset=convertNumberToUnsignedLong2(bufferOffsetAsNumber),channelNumber=convertNumberToUnsignedLong2(channelNumberAsNumber);if(bufferOffset<audioBuffer.length)return copyToChannel2.call(audioBuffer,source,channelNumber,bufferOffset)})(audioBuffer.copyToChannel)};var createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=overwriteAccessors2=>(nativeAudioBufferSourceNode,nativeContext)=>{let nullifiedBuffer=nativeContext.createBuffer(1,1,44100);nativeAudioBufferSourceNode.buffer===null&&(nativeAudioBufferSourceNode.buffer=nullifiedBuffer),overwriteAccessors2(nativeAudioBufferSourceNode,"buffer",get=>()=>{let value=get.call(nativeAudioBufferSourceNode);return value===nullifiedBuffer?null:value},set=>value=>set.call(nativeAudioBufferSourceNode,value===null?nullifiedBuffer:value))};var createWrapChannelMergerNode=(createInvalidStateError2,monitorConnections2)=>(nativeContext,channelMergerNode)=>{channelMergerNode.channelCount=1,channelMergerNode.channelCountMode="explicit",Object.defineProperty(channelMergerNode,"channelCount",{get:()=>1,set:()=>{throw createInvalidStateError2()}}),Object.defineProperty(channelMergerNode,"channelCountMode",{get:()=>"explicit",set:()=>{throw createInvalidStateError2()}});let audioBufferSourceNode=nativeContext.createBufferSource();monitorConnections2(channelMergerNode,()=>{let length=channelMergerNode.numberOfInputs;for(let i=0;i<length;i+=1)audioBufferSourceNode.connect(channelMergerNode,0,i)},()=>audioBufferSourceNode.disconnect(channelMergerNode))};var isDCCurve=curve=>{if(curve===null)return!1;let length=curve.length;return length%2!=0?curve[Math.floor(length/2)]!==0:curve[length/2-1]+curve[length/2]!==0};var overwriteAccessors=(object,property,createGetter,createSetter)=>{let prototype=Object.getPrototypeOf(object);for(;!prototype.hasOwnProperty(property);)prototype=Object.getPrototypeOf(prototype);let{get,set}=Object.getOwnPropertyDescriptor(prototype,property);Object.defineProperty(object,property,{get:createGetter(get),set:createSetter(set)})};var sanitizeAudioWorkletNodeOptions=options=>__spreadProps(__spreadValues({},options),{outputChannelCount:options.outputChannelCount!==void 0?options.outputChannelCount:options.numberOfInputs===1&&options.numberOfOutputs===1?[options.channelCount]:Array.from({length:options.numberOfOutputs},()=>1)});var sanitizeChannelSplitterOptions=options=>__spreadProps(__spreadValues({},options),{channelCount:options.numberOfOutputs});var sanitizePeriodicWaveOptions=options=>{let{imag,real}=options;return imag===void 0?real===void 0?__spreadProps(__spreadValues({},options),{imag:[0,0],real:[0,0]}):__spreadProps(__spreadValues({},options),{imag:Array.from(real,()=>0),real}):real===void 0?__spreadProps(__spreadValues({},options),{imag,real:Array.from(imag,()=>0)}):__spreadProps(__spreadValues({},options),{imag,real})};var setValueAtTimeUntilPossible=(audioParam,value,startTime)=>{try{audioParam.setValueAtTime(value,startTime)}catch(err){if(err.code!==9)throw err;setValueAtTimeUntilPossible(audioParam,value,startTime+1e-7)}};var testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=nativeContext=>{let nativeAudioBufferSourceNode=nativeContext.createBufferSource();nativeAudioBufferSourceNode.start();try{nativeAudioBufferSourceNode.start()}catch(e){return!0}return!1};var testAudioBufferSourceNodeStartMethodOffsetClampingSupport=nativeContext=>{let nativeAudioBufferSourceNode=nativeContext.createBufferSource(),nativeAudioBuffer=nativeContext.createBuffer(1,1,44100);nativeAudioBufferSourceNode.buffer=nativeAudioBuffer;try{nativeAudioBufferSourceNode.start(0,1)}catch(e){return!1}return!0};var testAudioBufferSourceNodeStopMethodNullifiedBufferSupport=nativeContext=>{let nativeAudioBufferSourceNode=nativeContext.createBufferSource();nativeAudioBufferSourceNode.start();try{nativeAudioBufferSourceNode.stop()}catch(e){return!1}return!0};var testAudioScheduledSourceNodeStartMethodNegativeParametersSupport=nativeContext=>{let nativeAudioBufferSourceNode=nativeContext.createOscillator();try{nativeAudioBufferSourceNode.start(-1)}catch(err){return err instanceof RangeError}return!1};var testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=nativeContext=>{let nativeAudioBuffer=nativeContext.createBuffer(1,1,44100),nativeAudioBufferSourceNode=nativeContext.createBufferSource();nativeAudioBufferSourceNode.buffer=nativeAudioBuffer,nativeAudioBufferSourceNode.start(),nativeAudioBufferSourceNode.stop();try{return nativeAudioBufferSourceNode.stop(),!0}catch(e){return!1}};var testAudioScheduledSourceNodeStopMethodNegativeParametersSupport=nativeContext=>{let nativeAudioBufferSourceNode=nativeContext.createOscillator();try{nativeAudioBufferSourceNode.stop(-1)}catch(err){return err instanceof RangeError}return!1};var testAudioWorkletNodeOptionsClonability=audioWorkletNodeOptions=>{let{port1,port2}=new MessageChannel;try{port1.postMessage(audioWorkletNodeOptions)}finally{port1.close(),port2.close()}};var testDomExceptionConstructorSupport=()=>{try{new DOMException}catch(e){return!1}return!0};var testTransferablesSupport=()=>new Promise(resolve4=>{let arrayBuffer=new ArrayBuffer(0),{port1,port2}=new MessageChannel;port1.onmessage=({data})=>resolve4(data!==null),port2.postMessage(arrayBuffer,[arrayBuffer])});var wrapAudioBufferSourceNodeStartMethodOffsetClamping=nativeAudioBufferSourceNode=>{nativeAudioBufferSourceNode.start=(start2=>(when=0,offset=0,duration)=>{let buffer=nativeAudioBufferSourceNode.buffer,clampedOffset=buffer===null?offset:Math.min(buffer.duration,offset);buffer!==null&&clampedOffset>buffer.duration-.5/nativeAudioBufferSourceNode.context.sampleRate?start2.call(nativeAudioBufferSourceNode,when,0,0):start2.call(nativeAudioBufferSourceNode,when,clampedOffset,duration)})(nativeAudioBufferSourceNode.start)};var wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=(nativeAudioScheduledSourceNode,nativeContext)=>{let nativeGainNode=nativeContext.createGain();nativeAudioScheduledSourceNode.connect(nativeGainNode);let disconnectGainNode=(disconnect2=>()=>{disconnect2.call(nativeAudioScheduledSourceNode,nativeGainNode),nativeAudioScheduledSourceNode.removeEventListener("ended",disconnectGainNode)})(nativeAudioScheduledSourceNode.disconnect);nativeAudioScheduledSourceNode.addEventListener("ended",disconnectGainNode),interceptConnections(nativeAudioScheduledSourceNode,nativeGainNode),nativeAudioScheduledSourceNode.stop=(stop=>{let isStopped=!1;return(when=0)=>{if(isStopped)try{stop.call(nativeAudioScheduledSourceNode,when)}catch(e){nativeGainNode.gain.setValueAtTime(0,when)}else stop.call(nativeAudioScheduledSourceNode,when),isStopped=!0}})(nativeAudioScheduledSourceNode.stop)};var wrapEventListener=(target,eventListener)=>event=>{let descriptor={value:target};return Object.defineProperties(event,{currentTarget:descriptor,target:descriptor}),typeof eventListener=="function"?eventListener.call(target,event):eventListener.handleEvent.call(target,event)};var addActiveInputConnectionToAudioNode=createAddActiveInputConnectionToAudioNode(insertElementInSet),addPassiveInputConnectionToAudioNode=createAddPassiveInputConnectionToAudioNode(insertElementInSet),deleteActiveInputConnectionToAudioNode=createDeleteActiveInputConnectionToAudioNode(pickElementFromSet),audioNodeTailTimeStore=new WeakMap,getAudioNodeTailTime=createGetAudioNodeTailTime(audioNodeTailTimeStore),cacheTestResult=createCacheTestResult(new Map,new WeakMap),window2=createWindow(),createNativeAnalyserNode=createNativeAnalyserNodeFactory(cacheTestResult,createIndexSizeError),getAudioNodeRenderer=createGetAudioNodeRenderer(getAudioNodeConnections),renderInputsOfAudioNode=createRenderInputsOfAudioNode(getAudioNodeConnections,getAudioNodeRenderer,isPartOfACycle),createAnalyserNodeRenderer=createAnalyserNodeRendererFactory(createNativeAnalyserNode,getNativeAudioNode,renderInputsOfAudioNode),getNativeContext=createGetNativeContext(CONTEXT_STORE),nativeOfflineAudioContextConstructor=createNativeOfflineAudioContextConstructor(window2),isNativeOfflineAudioContext=createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor),audioParamAudioNodeStore=new WeakMap,eventTargetConstructor=createEventTargetConstructor(wrapEventListener),nativeAudioContextConstructor=createNativeAudioContextConstructor(window2),isNativeAudioContext=createIsNativeAudioContext(nativeAudioContextConstructor),isNativeAudioNode2=createIsNativeAudioNode(window2),isNativeAudioParam=createIsNativeAudioParam(window2),audioNodeConstructor=createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE),createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode,addPassiveInputConnectionToAudioNode,connectNativeAudioNodeToNativeAudioNode,deleteActiveInputConnectionToAudioNode,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getAudioNodeTailTime,getEventListenersOfAudioNode,getNativeAudioNode,insertElementInSet,isActiveAudioNode,isPartOfACycle,isPassiveAudioNode),cacheTestResult,createIncrementCycleCounterFactory(CYCLE_COUNTERS,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,isActiveAudioNode),createIndexSizeError,createInvalidAccessError,createNotSupportedError,createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode,CYCLE_COUNTERS,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,getNativeContext,isActiveAudioNode,isNativeOfflineAudioContext),createDetectCycles(audioParamAudioNodeStore,getAudioNodeConnections,getValueForKey),eventTargetConstructor,getNativeContext,isNativeAudioContext,isNativeAudioNode2,isNativeAudioParam,isNativeOfflineAudioContext),analyserNodeConstructor=createAnalyserNodeConstructor(audioNodeConstructor,createAnalyserNodeRenderer,createIndexSizeError,createNativeAnalyserNode,getNativeContext,isNativeOfflineAudioContext);var audioBufferStore=new WeakSet,nativeAudioBufferConstructor=createNativeAudioBufferConstructor(window2),convertNumberToUnsignedLong=createConvertNumberToUnsignedLong(new Uint32Array(1)),wrapAudioBufferCopyChannelMethods=createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong,createIndexSizeError),wrapAudioBufferCopyChannelMethodsOutOfBounds=createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong),audioBufferConstructor=createAudioBufferConstructor(audioBufferStore,cacheTestResult,createNotSupportedError,nativeAudioBufferConstructor,nativeOfflineAudioContextConstructor,createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor),wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds);var addSilentConnection=createAddSilentConnection(createNativeGainNode),renderInputsOfAudioParam=createRenderInputsOfAudioParam(getAudioNodeRenderer,getAudioParamConnections,isPartOfACycle),connectAudioParam=createConnectAudioParam(renderInputsOfAudioParam),createNativeAudioBufferSourceNode=createNativeAudioBufferSourceNodeFactory(addSilentConnection,cacheTestResult,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport,testAudioBufferSourceNodeStartMethodOffsetClampingSupport,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioBufferSourceNodeStartMethodOffsetClamping,createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors),wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),renderAutomation=createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections),renderInputsOfAudioParam),createAudioBufferSourceNodeRenderer=createAudioBufferSourceNodeRendererFactory(connectAudioParam,createNativeAudioBufferSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),createAudioParam=createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE),audioParamAudioNodeStore,AUDIO_PARAM_STORE,createAudioParamRenderer,import_automation_events2.createCancelAndHoldAutomationEvent,import_automation_events2.createCancelScheduledValuesAutomationEvent,import_automation_events2.createExponentialRampToValueAutomationEvent,import_automation_events2.createLinearRampToValueAutomationEvent,import_automation_events2.createSetTargetAutomationEvent,import_automation_events2.createSetValueAutomationEvent,import_automation_events2.createSetValueCurveAutomationEvent,nativeAudioContextConstructor,setValueAtTimeUntilPossible),audioBufferSourceNodeConstructor=createAudioBufferSourceNodeConstructor(audioNodeConstructor,createAudioBufferSourceNodeRenderer,createAudioParam,createInvalidStateError,createNativeAudioBufferSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener);var audioDestinationNodeConstructor=createAudioDestinationNodeConstructor(audioNodeConstructor,createAudioDestinationNodeRenderer,createIndexSizeError,createInvalidStateError,createNativeAudioDestinationNodeFactory(createNativeGainNode,overwriteAccessors),getNativeContext,isNativeOfflineAudioContext,renderInputsOfAudioNode),createBiquadFilterNodeRenderer=createBiquadFilterNodeRendererFactory(connectAudioParam,createNativeBiquadFilterNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),setAudioNodeTailTime=createSetAudioNodeTailTime(audioNodeTailTimeStore),biquadFilterNodeConstructor=createBiquadFilterNodeConstructor(audioNodeConstructor,createAudioParam,createBiquadFilterNodeRenderer,createInvalidAccessError,createNativeBiquadFilterNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),monitorConnections=createMonitorConnections(insertElementInSet,isNativeAudioNode2),wrapChannelMergerNode=createWrapChannelMergerNode(createInvalidStateError,monitorConnections),createNativeChannelMergerNode=createNativeChannelMergerNodeFactory(nativeAudioContextConstructor,wrapChannelMergerNode),createChannelMergerNodeRenderer=createChannelMergerNodeRendererFactory(createNativeChannelMergerNode,getNativeAudioNode,renderInputsOfAudioNode),channelMergerNodeConstructor=createChannelMergerNodeConstructor(audioNodeConstructor,createChannelMergerNodeRenderer,createNativeChannelMergerNode,getNativeContext,isNativeOfflineAudioContext),createChannelSplitterNodeRenderer=createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode,getNativeAudioNode,renderInputsOfAudioNode),channelSplitterNodeConstructor=createChannelSplitterNodeConstructor(audioNodeConstructor,createChannelSplitterNodeRenderer,createNativeChannelSplitterNode,getNativeContext,isNativeOfflineAudioContext,sanitizeChannelSplitterOptions),createNativeConstantSourceNodeFaker=createNativeConstantSourceNodeFakerFactory(addSilentConnection,createNativeAudioBufferSourceNode,createNativeGainNode,monitorConnections),createNativeConstantSourceNode=createNativeConstantSourceNodeFactory(addSilentConnection,cacheTestResult,createNativeConstantSourceNodeFaker,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport),createConstantSourceNodeRenderer=createConstantSourceNodeRendererFactory(connectAudioParam,createNativeConstantSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),constantSourceNodeConstructor=createConstantSourceNodeConstructor(audioNodeConstructor,createAudioParam,createConstantSourceNodeRenderer,createNativeConstantSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createNativeConvolverNode=createNativeConvolverNodeFactory(createNotSupportedError,overwriteAccessors),createConvolverNodeRenderer=createConvolverNodeRendererFactory(createNativeConvolverNode,getNativeAudioNode,renderInputsOfAudioNode),convolverNodeConstructor=createConvolverNodeConstructor(audioNodeConstructor,createConvolverNodeRenderer,createNativeConvolverNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createDelayNodeRenderer=createDelayNodeRendererFactory(connectAudioParam,createNativeDelayNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),delayNodeConstructor=createDelayNodeConstructor(audioNodeConstructor,createAudioParam,createDelayNodeRenderer,createNativeDelayNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativeDynamicsCompressorNode=createNativeDynamicsCompressorNodeFactory(createNotSupportedError),createDynamicsCompressorNodeRenderer=createDynamicsCompressorNodeRendererFactory(connectAudioParam,createNativeDynamicsCompressorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),dynamicsCompressorNodeConstructor=createDynamicsCompressorNodeConstructor(audioNodeConstructor,createAudioParam,createDynamicsCompressorNodeRenderer,createNativeDynamicsCompressorNode,createNotSupportedError,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createGainNodeRenderer=createGainNodeRendererFactory(connectAudioParam,createNativeGainNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),gainNodeConstructor=createGainNodeConstructor(audioNodeConstructor,createAudioParam,createGainNodeRenderer,createNativeGainNode,getNativeContext,isNativeOfflineAudioContext),createNativeIIRFilterNodeFaker=createNativeIIRFilterNodeFakerFactory(createInvalidAccessError,createInvalidStateError,createNativeScriptProcessorNode,createNotSupportedError),renderNativeOfflineAudioContext=createRenderNativeOfflineAudioContext(cacheTestResult,createNativeGainNode,createNativeScriptProcessorNode,createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode,nativeOfflineAudioContextConstructor)),createIIRFilterNodeRenderer=createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderInputsOfAudioNode,renderNativeOfflineAudioContext),createNativeIIRFilterNode=createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker),iIRFilterNodeConstructor=createIIRFilterNodeConstructor(audioNodeConstructor,createNativeIIRFilterNode,createIIRFilterNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createAudioListener=createAudioListenerFactory(createAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeScriptProcessorNode,isNativeOfflineAudioContext),unrenderedAudioWorkletNodeStore=new WeakMap,minimalBaseAudioContextConstructor=createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor,createAudioListener,eventTargetConstructor,isNativeOfflineAudioContext,unrenderedAudioWorkletNodeStore,wrapEventListener),createNativeOscillatorNode=createNativeOscillatorNodeFactory(addSilentConnection,cacheTestResult,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),createOscillatorNodeRenderer=createOscillatorNodeRendererFactory(connectAudioParam,createNativeOscillatorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),oscillatorNodeConstructor=createOscillatorNodeConstructor(audioNodeConstructor,createAudioParam,createNativeOscillatorNode,createOscillatorNodeRenderer,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createConnectedNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode),createNativeWaveShaperNodeFaker=createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeGainNode,isDCCurve,monitorConnections),createNativeWaveShaperNode=createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeWaveShaperNodeFaker,isDCCurve,monitorConnections,nativeAudioContextConstructor,overwriteAccessors),createNativePannerNodeFaker=createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode,createInvalidStateError,createNativeChannelMergerNode,createNativeGainNode,createNativeScriptProcessorNode,createNativeWaveShaperNode,createNotSupportedError,disconnectNativeAudioNodeFromNativeAudioNode,monitorConnections),createNativePannerNode=createNativePannerNodeFactory(createNativePannerNodeFaker),createPannerNodeRenderer=createPannerNodeRendererFactory(connectAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeGainNode,createNativePannerNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),pannerNodeConstructor=createPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativePannerNode,createPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativePeriodicWave=createNativePeriodicWaveFactory(createIndexSizeError),periodicWaveConstructor=createPeriodicWaveConstructor(createNativePeriodicWave,getNativeContext,new WeakSet,sanitizePeriodicWaveOptions),nativeStereoPannerNodeFakerFactory=createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeGainNode,createNativeWaveShaperNode,createNotSupportedError,monitorConnections),createNativeStereoPannerNode=createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory,createNotSupportedError),createStereoPannerNodeRenderer=createStereoPannerNodeRendererFactory(connectAudioParam,createNativeStereoPannerNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),stereoPannerNodeConstructor=createStereoPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativeStereoPannerNode,createStereoPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext),createWaveShaperNodeRenderer=createWaveShaperNodeRendererFactory(createNativeWaveShaperNode,getNativeAudioNode,renderInputsOfAudioNode),waveShaperNodeConstructor=createWaveShaperNodeConstructor(audioNodeConstructor,createInvalidStateError,createNativeWaveShaperNode,createWaveShaperNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),isSecureContext=createIsSecureContext(window2),exposeCurrentFrameAndCurrentTime=createExposeCurrentFrameAndCurrentTime(window2),backupOfflineAudioContextStore=new WeakMap,getOrCreateBackupOfflineAudioContext=createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore,nativeOfflineAudioContextConstructor),nativeAudioWorkletNodeConstructor=createNativeAudioWorkletNodeConstructor(window2),addAudioWorkletModule=isSecureContext?createAddAudioWorkletModule(cacheTestResult,createNotSupportedError,createEvaluateSource(window2),exposeCurrentFrameAndCurrentTime,createFetchSource(createAbortError),getNativeContext,getOrCreateBackupOfflineAudioContext,isNativeOfflineAudioContext,new WeakMap,new WeakMap,createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),window2):void 0,isNativeContext=createIsNativeContext(isNativeAudioContext,isNativeOfflineAudioContext),decodeAudioData=createDecodeAudioData(audioBufferStore,cacheTestResult,createDataCloneError,createEncodingError,new WeakSet,getNativeContext,isNativeContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,testPromiseSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),baseAudioContextConstructor=createBaseAudioContextConstructor(addAudioWorkletModule,analyserNodeConstructor,audioBufferConstructor,audioBufferSourceNodeConstructor,biquadFilterNodeConstructor,channelMergerNodeConstructor,channelSplitterNodeConstructor,constantSourceNodeConstructor,convolverNodeConstructor,decodeAudioData,delayNodeConstructor,dynamicsCompressorNodeConstructor,gainNodeConstructor,iIRFilterNodeConstructor,minimalBaseAudioContextConstructor,oscillatorNodeConstructor,pannerNodeConstructor,periodicWaveConstructor,stereoPannerNodeConstructor,waveShaperNodeConstructor),mediaElementAudioSourceNodeConstructor=createMediaElementAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaElementAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioDestinationNodeConstructor=createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioDestinationNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioSourceNodeConstructor=createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),createNativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError,isNativeOfflineAudioContext),mediaStreamTrackAudioSourceNodeConstructor=createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamTrackAudioSourceNode,getNativeContext),audioContextConstructor=createAudioContextConstructor(baseAudioContextConstructor,createInvalidStateError,createNotSupportedError,createUnknownError,mediaElementAudioSourceNodeConstructor,mediaStreamAudioDestinationNodeConstructor,mediaStreamAudioSourceNodeConstructor,mediaStreamTrackAudioSourceNodeConstructor,nativeAudioContextConstructor);var getUnrenderedAudioWorkletNodes=createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore),addUnrenderedAudioWorkletNode=createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),connectMultipleOutputs=createConnectMultipleOutputs(createIndexSizeError),deleteUnrenderedAudioWorkletNode=createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),disconnectMultipleOutputs=createDisconnectMultipleOutputs(createIndexSizeError),activeAudioWorkletNodeInputsStore=new WeakMap,getActiveAudioWorkletNodeInputs=createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore,getValueForKey),createNativeAudioWorkletNodeFaker=createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs,createIndexSizeError,createInvalidStateError,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,createNativeScriptProcessorNode,createNotSupportedError,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getActiveAudioWorkletNodeInputs,monitorConnections),createNativeAudioWorkletNode=createNativeAudioWorkletNodeFactory(createInvalidStateError,createNativeAudioWorkletNodeFaker,createNativeGainNode,createNotSupportedError,monitorConnections),createAudioWorkletNodeRenderer=createAudioWorkletNodeRendererFactory(connectAudioParam,connectMultipleOutputs,createNativeAudioBufferSourceNode,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,deleteUnrenderedAudioWorkletNode,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getNativeAudioNode,nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),getBackupOfflineAudioContext=createGetBackupOfflineAudioContext(backupOfflineAudioContextStore),setActiveAudioWorkletNodeInputs=createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore),audioWorkletNodeConstructor=isSecureContext?createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode,audioNodeConstructor,createAudioParam,createAudioWorkletNodeRenderer,createNativeAudioWorkletNode,getAudioNodeConnections,getBackupOfflineAudioContext,getNativeContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,sanitizeAudioWorkletNodeOptions,setActiveAudioWorkletNodeInputs,testAudioWorkletNodeOptionsClonability,wrapEventListener):void 0;var minimalAudioContextConstructor=createMinimalAudioContextConstructor(createInvalidStateError,createNotSupportedError,createUnknownError,minimalBaseAudioContextConstructor,nativeAudioContextConstructor);var createNativeOfflineAudioContext=createCreateNativeOfflineAudioContext(createNotSupportedError,nativeOfflineAudioContextConstructor),startRendering=createStartRendering(audioBufferStore,cacheTestResult,getAudioNodeRenderer,getUnrenderedAudioWorkletNodes,renderNativeOfflineAudioContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),minimalOfflineAudioContextConstructor=createMinimalOfflineAudioContextConstructor(cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,minimalBaseAudioContextConstructor,startRendering);var offlineAudioContextConstructor=createOfflineAudioContextConstructor(baseAudioContextConstructor,cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,startRendering);var isAnyAudioContext=createIsAnyAudioContext(CONTEXT_STORE,isNativeAudioContext),isAnyAudioNode=createIsAnyAudioNode(AUDIO_NODE_STORE,isNativeAudioNode2),isAnyAudioParam=createIsAnyAudioParam(AUDIO_PARAM_STORE,isNativeAudioParam),isAnyOfflineAudioContext=createIsAnyOfflineAudioContext(CONTEXT_STORE,isNativeOfflineAudioContext),isSupported=()=>createIsSupportedPromise(cacheTestResult,createTestAudioBufferCopyChannelMethodsSubarraySupport(nativeOfflineAudioContextConstructor),createTestAudioContextCloseMethodSupport(nativeAudioContextConstructor),createTestAudioContextDecodeAudioDataMethodTypeErrorSupport(nativeOfflineAudioContextConstructor),createTestAudioContextOptionsSupport(nativeAudioContextConstructor),createTestAudioNodeConnectMethodSupport(nativeOfflineAudioContextConstructor),createTestAudioWorkletProcessorNoOutputsSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),createTestChannelMergerNodeChannelCountSupport(nativeOfflineAudioContextConstructor),createTestConstantSourceNodeAccurateSchedulingSupport(nativeOfflineAudioContextConstructor),createTestConvolverNodeBufferReassignabilitySupport(nativeOfflineAudioContextConstructor),createTestConvolverNodeChannelCountSupport(nativeOfflineAudioContextConstructor),testDomExceptionConstructorSupport,createTestIsSecureContextSupport(window2),createTestMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport(nativeAudioContextConstructor),createTestStereoPannerNodeDefaultValueSupport(nativeOfflineAudioContextConstructor),testTransferablesSupport);var Debug_exports={};__export(Debug_exports,{assert:()=>assert,assertContextRunning:()=>assertContextRunning,assertRange:()=>assertRange,log:()=>log,setLogger:()=>setLogger,warn:()=>warn});function assert(statement,error){if(!statement)throw new Error(error)}function assertRange(value,gte,lte=Infinity){if(!(gte<=value&&value<=lte))throw new RangeError(`Value must be within [${gte}, ${lte}], got: ${value}`)}function assertContextRunning(context4){!context4.isOffline&&context4.state!=="running"&&warn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}var defaultLogger=console;function setLogger(logger){defaultLogger=logger}function log(...args){defaultLogger.log(...args)}function warn(...args){defaultLogger.warn(...args)}function isUndef(arg){return typeof arg=="undefined"}function isDefined(arg){return!isUndef(arg)}function isFunction(arg){return typeof arg=="function"}function isNumber(arg){return typeof arg=="number"}function isObject(arg){return Object.prototype.toString.call(arg)==="[object Object]"&&arg.constructor===Object}function isBoolean(arg){return typeof arg=="boolean"}function isArray2(arg){return Array.isArray(arg)}function isString(arg){return typeof arg=="string"}function isNote(arg){return isString(arg)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(arg)}function createAudioContext(options){return new audioContextConstructor(options)}function createOfflineAudioContext(channels,length,sampleRate){return new offlineAudioContextConstructor(channels,length,sampleRate)}var theWindow=typeof self=="object"?self:null,hasAudioContext=theWindow&&(theWindow.hasOwnProperty("AudioContext")||theWindow.hasOwnProperty("webkitAudioContext"));function createAudioWorkletNode(context4,name,options){return assert(isDefined(audioWorkletNodeConstructor),"This node only works in a secure context (https or localhost)"),new audioWorkletNodeConstructor(context4,name,options)}var import_tslib=__toModule(require_tslib()),{__extends:__extends25,__assign,__rest,__decorate,__param,__metadata,__awaiter:__awaiter2,__generator:__generator2,__exportStar,__createBinding,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet}=import_tslib.default;var Ticker3=class{constructor(callback,type,updateInterval){this._callback=callback,this._type=type,this._updateInterval=updateInterval,this._createClock()}_createWorker(){let blob=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),blobUrl=URL.createObjectURL(blob),worker=new Worker(blobUrl);worker.onmessage=this._callback.bind(this),this._worker=worker}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(interval){this._updateInterval=Math.max(interval,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(interval*1e3,1))}get type(){return this._type}set type(type){this._disposeClock(),this._type=type,this._createClock()}dispose(){this._disposeClock()}};function isAudioParam(arg){return isAnyAudioParam(arg)}function isAudioNode2(arg){return isAnyAudioNode(arg)}function isOfflineAudioContext(arg){return isAnyOfflineAudioContext(arg)}function isAudioContext(arg){return isAnyAudioContext(arg)}function isAudioBuffer(arg){return arg instanceof AudioBuffer}function noCopy(key,arg){return key==="value"||isAudioParam(arg)||isAudioNode2(arg)||isAudioBuffer(arg)}function deepMerge(target,...sources){if(!sources.length)return target;let source=sources.shift();if(isObject(target)&&isObject(source))for(let key in source)noCopy(key,source[key])?target[key]=source[key]:isObject(source[key])?(target[key]||Object.assign(target,{[key]:{}}),deepMerge(target[key],source[key])):Object.assign(target,{[key]:source[key]});return deepMerge(target,...sources)}function deepEquals(arrayA,arrayB){return arrayA.length===arrayB.length&&arrayA.every((element,index3)=>arrayB[index3]===element)}function optionsFromArguments(defaults,argsArray,keys2=[],objKey){let opts={},args=Array.from(argsArray);if(isObject(args[0])&&objKey&&!Reflect.has(args[0],objKey)&&(Object.keys(args[0]).some(key=>Reflect.has(defaults,key))||(deepMerge(opts,{[objKey]:args[0]}),keys2.splice(keys2.indexOf(objKey),1),args.shift())),args.length===1&&isObject(args[0]))deepMerge(opts,args[0]);else for(let i=0;i<keys2.length;i++)isDefined(args[i])&&(opts[keys2[i]]=args[i]);return deepMerge(defaults,opts)}function getDefaultsFromInstance(instance){return instance.constructor.getDefaults()}function defaultArg(given,fallback){return isUndef(given)?fallback:given}function omitFromObject(obj,omit){return omit.forEach(prop=>{Reflect.has(obj,prop)&&delete obj[prop]}),obj}var Tone=class{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...args){(this.debug||theWindow&&this.toString()===theWindow.TONE_DEBUG_CLASS)&&log(this,...args)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}};Tone.version=version2;var EPSILON=1e-6;function GT(a,b){return a>b+EPSILON}function GTE(a,b){return GT(a,b)||EQ(a,b)}function LT(a,b){return a+EPSILON<b}function EQ(a,b){return Math.abs(a-b)<EPSILON}function clamp(value,min,max){return Math.max(Math.min(value,max),min)}var Timeline=class extends Tone{constructor(){super();this.name="Timeline",this._timeline=[];let options=optionsFromArguments(Timeline.getDefaults(),arguments,["memory"]);this.memory=options.memory,this.increasing=options.increasing}static getDefaults(){return{memory:Infinity,increasing:!1}}get length(){return this._timeline.length}add(event){if(assert(Reflect.has(event,"time"),"Timeline: events must have a time attribute"),event.time=event.time.valueOf(),this.increasing&&this.length){let lastValue=this._timeline[this.length-1];assert(GTE(event.time,lastValue.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(event)}else{let index3=this._search(event.time);this._timeline.splice(index3+1,0,event)}if(this.length>this.memory){let diff=this.length-this.memory;this._timeline.splice(0,diff)}return this}remove(event){let index3=this._timeline.indexOf(event);return index3!==-1&&this._timeline.splice(index3,1),this}get(time,param="time"){let index3=this._search(time,param);return index3!==-1?this._timeline[index3]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(time,param="time"){let index3=this._search(time,param);return index3+1<this._timeline.length?this._timeline[index3+1]:null}getBefore(time){let len2=this._timeline.length;if(len2>0&&this._timeline[len2-1].time<time)return this._timeline[len2-1];let index3=this._search(time);return index3-1>=0?this._timeline[index3-1]:null}cancel(after){if(this._timeline.length>1){let index3=this._search(after);if(index3>=0)if(EQ(this._timeline[index3].time,after)){for(let i=index3;i>=0&&EQ(this._timeline[i].time,after);i--)index3=i;this._timeline=this._timeline.slice(0,index3)}else this._timeline=this._timeline.slice(0,index3+1);else this._timeline=[]}else this._timeline.length===1&&GTE(this._timeline[0].time,after)&&(this._timeline=[]);return this}cancelBefore(time){let index3=this._search(time);return index3>=0&&(this._timeline=this._timeline.slice(index3+1)),this}previousEvent(event){let index3=this._timeline.indexOf(event);return index3>0?this._timeline[index3-1]:null}_search(time,param="time"){if(this._timeline.length===0)return-1;let beginning=0,len2=this._timeline.length,end=len2;if(len2>0&&this._timeline[len2-1][param]<=time)return len2-1;for(;beginning<end;){let midPoint=Math.floor(beginning+(end-beginning)/2),event=this._timeline[midPoint],nextEvent=this._timeline[midPoint+1];if(EQ(event[param],time)){for(let i=midPoint;i<this._timeline.length;i++){let testEvent=this._timeline[i];if(EQ(testEvent[param],time))midPoint=i;else break}return midPoint}else{if(LT(event[param],time)&&GT(nextEvent[param],time))return midPoint;GT(event[param],time)?end=midPoint:beginning=midPoint+1}}return-1}_iterate(callback,lowerBound=0,upperBound=this._timeline.length-1){this._timeline.slice(lowerBound,upperBound+1).forEach(callback)}forEach(callback){return this._iterate(callback),this}forEachBefore(time,callback){let upperBound=this._search(time);return upperBound!==-1&&this._iterate(callback,0,upperBound),this}forEachAfter(time,callback){let lowerBound=this._search(time);return this._iterate(callback,lowerBound+1),this}forEachBetween(startTime,endTime,callback){let lowerBound=this._search(startTime),upperBound=this._search(endTime);return lowerBound!==-1&&upperBound!==-1?(this._timeline[lowerBound].time!==startTime&&(lowerBound+=1),this._timeline[upperBound].time===endTime&&(upperBound-=1),this._iterate(callback,lowerBound,upperBound)):lowerBound===-1&&this._iterate(callback,0,upperBound),this}forEachFrom(time,callback){let lowerBound=this._search(time);for(;lowerBound>=0&&this._timeline[lowerBound].time>=time;)lowerBound--;return this._iterate(callback,lowerBound+1),this}forEachAtTime(time,callback){let upperBound=this._search(time);if(upperBound!==-1&&EQ(this._timeline[upperBound].time,time)){let lowerBound=upperBound;for(let i=upperBound;i>=0&&EQ(this._timeline[i].time,time);i--)lowerBound=i;this._iterate(event=>{callback(event)},lowerBound,upperBound)}return this}dispose(){return super.dispose(),this._timeline=[],this}};var notifyNewContext=[];function onContextInit(cb){notifyNewContext.push(cb)}function initializeContext(ctx){notifyNewContext.forEach(cb=>cb(ctx))}var notifyCloseContext=[];function onContextClose(cb){notifyCloseContext.push(cb)}function closeContext(ctx){notifyCloseContext.forEach(cb=>cb(ctx))}var Emitter=class extends Tone{constructor(){super(...arguments);this.name="Emitter"}on(event,callback){return event.split(/\W+/).forEach(eventName=>{isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(eventName)||(this._events[eventName]=[]),this._events[eventName].push(callback)}),this}once(event,callback){let boundCallback=(...args)=>{callback(...args),this.off(event,boundCallback)};return this.on(event,boundCallback),this}off(event,callback){return event.split(/\W+/).forEach(eventName=>{if(isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(event))if(isUndef(callback))this._events[event]=[];else{let eventList=this._events[event];for(let i=eventList.length-1;i>=0;i--)eventList[i]===callback&&eventList.splice(i,1)}}),this}emit(event,...args){if(this._events&&this._events.hasOwnProperty(event)){let eventList=this._events[event].slice(0);for(let i=0,len2=eventList.length;i<len2;i++)eventList[i].apply(this,args)}return this}static mixin(constr){["on","once","off","emit"].forEach(name=>{let property=Object.getOwnPropertyDescriptor(Emitter.prototype,name);Object.defineProperty(constr.prototype,name,property)})}dispose(){return super.dispose(),this._events=void 0,this}};var BaseContext=class extends Emitter{constructor(){super(...arguments);this.isOffline=!1}toJSON(){return{}}};var Context=class extends BaseContext{constructor(){super();this.name="Context",this._constants=new Map,this._timeouts=new Timeline,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;let options=optionsFromArguments(Context.getDefaults(),arguments,["context"]);options.context?this._context=options.context:this._context=createAudioContext({latencyHint:options.latencyHint}),this._ticker=new Ticker3(this.emit.bind(this,"tick"),options.clockSource,options.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(options.latencyHint),this.lookAhead=options.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(initializeContext(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(numberOfChannels,length,sampleRate){return this._context.createBuffer(numberOfChannels,length,sampleRate)}createChannelMerger(numberOfInputs){return this._context.createChannelMerger(numberOfInputs)}createChannelSplitter(numberOfOutputs){return this._context.createChannelSplitter(numberOfOutputs)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(maxDelayTime){return this._context.createDelay(maxDelayTime)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(feedForward,feedback){return this._context.createIIRFilter(feedForward,feedback)}createPanner(){return this._context.createPanner()}createPeriodicWave(real,imag,constraints){return this._context.createPeriodicWave(real,imag,constraints)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(stream){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(stream)}createMediaElementSource(element){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(element)}createMediaStreamDestination(){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(audioData){return this._context.decodeAudioData(audioData)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(l){assert(!this._initialized,"The listener cannot be set after initialization."),this._listener=l}get transport(){return this.initialize(),this._transport}set transport(t){assert(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(d){assert(!this._initialized,"Draw cannot be set after initialization."),this._draw=d}get destination(){return this.initialize(),this._destination}set destination(d){assert(!this._initialized,"The destination cannot be set after initialization."),this._destination=d}createAudioWorkletNode(name,options){return createAudioWorkletNode(this.rawContext,name,options)}addAudioWorkletModule(url3,name){return __awaiter2(this,void 0,void 0,function*(){assert(isDefined(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(name)||this._workletModules.set(name,this.rawContext.audioWorklet.addModule(url3)),yield this._workletModules.get(name)})}workletsAreReady(){return __awaiter2(this,void 0,void 0,function*(){let promises=[];this._workletModules.forEach(promise=>promises.push(promise)),yield Promise.all(promises)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(interval){this._ticker.updateInterval=interval}get clockSource(){return this._ticker.type}set clockSource(type){this._ticker.type=type}get latencyHint(){return this._latencyHint}_setLatencyHint(hint){let lookAheadValue=0;if(this._latencyHint=hint,isString(hint))switch(hint){case"interactive":lookAheadValue=.1;break;case"playback":lookAheadValue=.5;break;case"balanced":lookAheadValue=.25;break}this.lookAhead=lookAheadValue,this.updateInterval=lookAheadValue/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return isAudioContext(this._context)?this._context.resume():Promise.resolve()}close(){return __awaiter2(this,void 0,void 0,function*(){isAudioContext(this._context)&&(yield this._context.close()),this._initialized&&closeContext(this)})}getConstant(val){if(this._constants.has(val))return this._constants.get(val);{let buffer=this._context.createBuffer(1,128,this._context.sampleRate),arr=buffer.getChannelData(0);for(let i=0;i<arr.length;i++)arr[i]=val;let constant=this._context.createBufferSource();return constant.channelCount=1,constant.channelCountMode="explicit",constant.buffer=buffer,constant.loop=!0,constant.start(0),this._constants.set(val,constant),constant}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(val=>this._constants[val].disconnect()),this}_timeoutLoop(){let now2=this.now(),firstEvent=this._timeouts.peek();for(;this._timeouts.length&&firstEvent&&firstEvent.time<=now2;)firstEvent.callback(),this._timeouts.shift(),firstEvent=this._timeouts.peek()}setTimeout(fn,timeout){this._timeoutIds++;let now2=this.now();return this._timeouts.add({callback:fn,id:this._timeoutIds,time:now2+timeout}),this._timeoutIds}clearTimeout(id){return this._timeouts.forEach(event=>{event.id===id&&this._timeouts.remove(event)}),this}clearInterval(id){return this.clearTimeout(id)}setInterval(fn,interval){let id=++this._timeoutIds,intervalFn=()=>{let now2=this.now();this._timeouts.add({callback:()=>{fn(),intervalFn()},id,time:now2+interval})};return intervalFn(),id}};var DummyContext=class extends BaseContext{constructor(){super(...arguments);this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(_numberOfChannels,_length,_sampleRate){return{}}createChannelMerger(_numberOfInputs){return{}}createChannelSplitter(_numberOfOutputs){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(_maxDelayTime){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(_feedForward,_feedback){return{}}createPanner(){return{}}createPeriodicWave(_real,_imag,_constraints){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(_stream){return{}}createMediaElementSource(_element){return{}}createMediaStreamDestination(){return{}}decodeAudioData(_audioData){return Promise.resolve({})}createAudioWorkletNode(_name,_options){return{}}get rawContext(){return{}}addAudioWorkletModule(_url,_name){return __awaiter2(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(_fn,_timeout){return 0}clearTimeout(_id){return this}setInterval(_fn,_interval){return 0}clearInterval(_id){return this}getConstant(_val){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(_d){}get destination(){return{}}set destination(_d){}now(){return 0}immediate(){return 0}};function readOnly(target,property){isArray2(property)?property.forEach(str=>readOnly(target,str)):Object.defineProperty(target,property,{enumerable:!0,writable:!1})}function writable(target,property){isArray2(property)?property.forEach(str=>writable(target,str)):Object.defineProperty(target,property,{writable:!0})}var noOp=()=>{};var ToneAudioBuffer=class extends Tone{constructor(){super();this.name="ToneAudioBuffer",this.onload=noOp;let options=optionsFromArguments(ToneAudioBuffer.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=options.reverse,this.onload=options.onload,options.url&&isAudioBuffer(options.url)||options.url instanceof ToneAudioBuffer?this.set(options.url):isString(options.url)&&this.load(options.url).catch(options.onerror)}static getDefaults(){return{onerror:noOp,onload:noOp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:getContext().sampleRate}set(buffer){return buffer instanceof ToneAudioBuffer?buffer.loaded?this._buffer=buffer.get():buffer.onload=()=>{this.set(buffer),this.onload(this)}:this._buffer=buffer,this._reversed&&this._reverse(),this}get(){return this._buffer}load(url3){return __awaiter2(this,void 0,void 0,function*(){let doneLoading=ToneAudioBuffer.load(url3).then(audioBuffer=>{this.set(audioBuffer),this.onload(this)});ToneAudioBuffer.downloads.push(doneLoading);try{yield doneLoading}finally{let index3=ToneAudioBuffer.downloads.indexOf(doneLoading);ToneAudioBuffer.downloads.splice(index3,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(array){let isMultidimensional=isArray2(array)&&array[0].length>0,channels=isMultidimensional?array.length:1,len2=isMultidimensional?array[0].length:array.length,context4=getContext(),buffer=context4.createBuffer(channels,len2,context4.sampleRate),multiChannelArray=!isMultidimensional&&channels===1?[array]:array;for(let c=0;c<channels;c++)buffer.copyToChannel(multiChannelArray[c],c);return this._buffer=buffer,this}toMono(chanNum){if(isNumber(chanNum))this.fromArray(this.toArray(chanNum));else{let outputArray=new Float32Array(this.length),numChannels=this.numberOfChannels;for(let channel=0;channel<numChannels;channel++){let channelArray=this.toArray(channel);for(let i=0;i<channelArray.length;i++)outputArray[i]+=channelArray[i]}outputArray=outputArray.map(sample=>sample/numChannels),this.fromArray(outputArray)}return this}toArray(channel){if(isNumber(channel))return this.getChannelData(channel);if(this.numberOfChannels===1)return this.toArray(0);{let ret=[];for(let c=0;c<this.numberOfChannels;c++)ret[c]=this.getChannelData(c);return ret}}getChannelData(channel){return this._buffer?this._buffer.getChannelData(channel):new Float32Array(0)}slice(start2,end=this.duration){let startSamples=Math.floor(start2*this.sampleRate),endSamples=Math.floor(end*this.sampleRate);assert(startSamples<endSamples,"The start time must be less than the end time");let length=endSamples-startSamples,retBuffer=getContext().createBuffer(this.numberOfChannels,length,this.sampleRate);for(let channel=0;channel<this.numberOfChannels;channel++)retBuffer.copyToChannel(this.getChannelData(channel).subarray(startSamples,endSamples),channel);return new ToneAudioBuffer(retBuffer)}_reverse(){if(this.loaded)for(let i=0;i<this.numberOfChannels;i++)this.getChannelData(i).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(rev){this._reversed!==rev&&(this._reversed=rev,this._reverse())}static fromArray(array){return new ToneAudioBuffer().fromArray(array)}static fromUrl(url3){return __awaiter2(this,void 0,void 0,function*(){return yield new ToneAudioBuffer().load(url3)})}static load(url3){return __awaiter2(this,void 0,void 0,function*(){let matches=url3.match(/\[([^\]\[]+\|.+)\]$/);if(matches){let extensions=matches[1].split("|"),extension=extensions[0];for(let ext of extensions)if(ToneAudioBuffer.supportsType(ext)){extension=ext;break}url3=url3.replace(matches[0],extension)}let baseUrl=ToneAudioBuffer.baseUrl===""||ToneAudioBuffer.baseUrl.endsWith("/")?ToneAudioBuffer.baseUrl:ToneAudioBuffer.baseUrl+"/",response2=yield fetch(baseUrl+url3);if(!response2.ok)throw new Error(`could not load url: ${url3}`);let arrayBuffer=yield response2.arrayBuffer();return yield getContext().decodeAudioData(arrayBuffer)})}static supportsType(url3){let extensions=url3.split("."),extension=extensions[extensions.length-1];return document.createElement("audio").canPlayType("audio/"+extension)!==""}static loaded(){return __awaiter2(this,void 0,void 0,function*(){for(yield Promise.resolve();ToneAudioBuffer.downloads.length;)yield ToneAudioBuffer.downloads[0]})}};ToneAudioBuffer.baseUrl="";ToneAudioBuffer.downloads=[];var OfflineContext=class extends Context{constructor(){super({clockSource:"offline",context:isOfflineAudioContext(arguments[0])?arguments[0]:createOfflineAudioContext(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:isOfflineAudioContext(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]});this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=isOfflineAudioContext(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(asynchronous){return __awaiter2(this,void 0,void 0,function*(){let index3=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,index3++;let yieldEvery=Math.floor(this.sampleRate/128);asynchronous&&index3%yieldEvery==0&&(yield new Promise(done=>setTimeout(done,1)))}})}render(asynchronous=!0){return __awaiter2(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(asynchronous);let buffer=yield this._context.startRendering();return new ToneAudioBuffer(buffer)})}close(){return Promise.resolve()}};var dummyContext=new DummyContext,globalContext=dummyContext;function getContext(){return globalContext===dummyContext&&hasAudioContext&&setContext(new Context),globalContext}function setContext(context4){isAudioContext(context4)?globalContext=new Context(context4):isOfflineAudioContext(context4)?globalContext=new OfflineContext(context4):globalContext=context4}function start(){return globalContext.resume()}if(theWindow&&!theWindow.TONE_SILENCE_LOGGING){let prefix="v";version2==="dev"&&(prefix="");let printString=` * Tone.js ${prefix}${version2} * `;console.log(`%c${printString}`,"background: #000; color: #fff")}function dbToGain(db){return Math.pow(10,db/20)}function gainToDb(gain){return 20*(Math.log(gain)/Math.LN10)}function intervalToFrequencyRatio(interval){return Math.pow(2,interval/12)}var A4=440;function getA4(){return A4}function setA4(freq){A4=freq}function ftom(frequency){return Math.round(ftomf(frequency))}function ftomf(frequency){return 69+12*Math.log2(frequency/A4)}function mtof(midi){return A4*Math.pow(2,(midi-69)/12)}var TimeBaseClass=class extends Tone{constructor(context4,value,units){super();this.defaultUnits="s",this._val=value,this._units=units,this.context=context4,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:value=>this._frequencyToUnits(parseFloat(value)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:value=>this._ticksToUnits(parseInt(value,10)),regexp:/^(\d+)i$/i},m:{method:value=>this._beatsToUnits(parseInt(value,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(value,dot)=>{let numericValue=parseInt(value,10),scalar=dot==="."?1.5:1;return numericValue===1?this._beatsToUnits(this._getTimeSignature())*scalar:this._beatsToUnits(4/numericValue)*scalar},regexp:/^(\d+)n(\.?)$/i},number:{method:value=>this._expressions[this.defaultUnits].method.call(this,value),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:value=>this._secondsToUnits(parseFloat(value)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:value=>parseInt(value,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:value=>{let numericValue=parseInt(value,10);return this._beatsToUnits(8/(Math.floor(numericValue)*3))},regexp:/^(\d+)t$/i},tr:{method:(m,q,s)=>{let total=0;return m&&m!=="0"&&(total+=this._beatsToUnits(this._getTimeSignature()*parseFloat(m))),q&&q!=="0"&&(total+=this._beatsToUnits(parseFloat(q))),s&&s!=="0"&&(total+=this._beatsToUnits(parseFloat(s)/4)),total},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof TimeBaseClass&&this.fromType(this._val),isUndef(this._val))return this._noArg();if(isString(this._val)&&isUndef(this._units)){for(let units in this._expressions)if(this._expressions[units].regexp.test(this._val.trim())){this._units=units;break}}else if(isObject(this._val)){let total=0;for(let typeName in this._val)if(isDefined(this._val[typeName])){let quantity=this._val[typeName];total+=new this.constructor(this.context,typeName).valueOf()*quantity}return total}if(isDefined(this._units)){let expr=this._expressions[this._units],matching=this._val.toString().trim().match(expr.regexp);return matching?expr.method.apply(this,matching.slice(1)):expr.method.call(this,this._val)}else return isString(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(freq){return 1/freq}_beatsToUnits(beats){return 60/this._getBpm()*beats}_secondsToUnits(seconds){return seconds}_ticksToUnits(ticks){return ticks*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(type){switch(this._units=void 0,this.defaultUnits){case"s":this._val=type.toSeconds();break;case"i":this._val=type.toTicks();break;case"hz":this._val=type.toFrequency();break;case"midi":this._val=type.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}};var TimeClass=class extends TimeBaseClass{constructor(){super(...arguments);this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:capture=>this._now()+new this.constructor(this.context,capture).valueOf(),regexp:/^\+(.+)/},quantize:{method:capture=>{let quantTo=new TimeClass(this.context,capture).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(quantTo))},regexp:/^@(.+)/}})}quantize(subdiv,percent=1){let subdivision=new this.constructor(this.context,subdiv).valueOf(),value=this.valueOf(),diff=Math.round(value/subdivision)*subdivision-value;return value+diff*percent}toNotation(){let time=this.toSeconds(),testNotations=["1m"];for(let power=1;power<9;power++){let subdiv=Math.pow(2,power);testNotations.push(subdiv+"n."),testNotations.push(subdiv+"n"),testNotations.push(subdiv+"t")}testNotations.push("0");let closest=testNotations[0],closestSeconds=new TimeClass(this.context,testNotations[0]).toSeconds();return testNotations.forEach(notation=>{let notationSeconds=new TimeClass(this.context,notation).toSeconds();Math.abs(notationSeconds-time)<Math.abs(closestSeconds-time)&&(closest=notation,closestSeconds=notationSeconds)}),closest}toBarsBeatsSixteenths(){let quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;quarters=parseFloat(quarters.toFixed(4));let measures=Math.floor(quarters/this._getTimeSignature()),sixteenths=quarters%1*4;quarters=Math.floor(quarters)%this._getTimeSignature();let sixteenthString=sixteenths.toString();return sixteenthString.length>3&&(sixteenths=parseFloat(parseFloat(sixteenthString).toFixed(3))),[measures,quarters,sixteenths].join(":")}toTicks(){let quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;return Math.round(quarters*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ftom(this.toFrequency())}_now(){return this.context.now()}};function Time(value,units){return new TimeClass(getContext(),value,units)}var FrequencyClass=class extends TimeClass{constructor(){super(...arguments);this.name="Frequency",this.defaultUnits="hz"}static get A4(){return getA4()}static set A4(freq){setA4(freq)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(value){return this.defaultUnits==="midi"?value:FrequencyClass.mtof(value)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(pitch,octave){let noteNumber=noteToScaleIndex[pitch.toLowerCase()]+(parseInt(octave,10)+1)*12;return this.defaultUnits==="midi"?noteNumber:FrequencyClass.mtof(noteNumber)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(m,q,s){let total=1;return m&&m!=="0"&&(total*=this._beatsToUnits(this._getTimeSignature()*parseFloat(m))),q&&q!=="0"&&(total*=this._beatsToUnits(parseFloat(q))),s&&s!=="0"&&(total*=this._beatsToUnits(parseFloat(s)/4)),total}}})}transpose(interval){return new FrequencyClass(this.context,this.valueOf()*intervalToFrequencyRatio(interval))}harmonize(intervals){return intervals.map(interval=>this.transpose(interval))}toMidi(){return ftom(this.valueOf())}toNote(){let freq=this.toFrequency(),log3=Math.log2(freq/FrequencyClass.A4),noteNumber=Math.round(12*log3)+57,octave=Math.floor(noteNumber/12);return octave<0&&(noteNumber+=-12*octave),scaleIndexToNote[noteNumber%12]+octave.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;return Math.floor(quarters*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(freq){return freq}_ticksToUnits(ticks){return 1/(ticks*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(beats){return 1/super._beatsToUnits(beats)}_secondsToUnits(seconds){return 1/seconds}static mtof(midi){return mtof(midi)}static ftom(frequency){return ftom(frequency)}},noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Frequency(value,units){return new FrequencyClass(getContext(),value,units)}var TransportTimeClass=class extends TimeClass{constructor(){super(...arguments);this.name="TransportTime"}_now(){return this.context.transport.seconds}};function TransportTime(value,units){return new TransportTimeClass(getContext(),value,units)}var ToneWithContext=class extends Tone{constructor(){super();let options=optionsFromArguments(ToneWithContext.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=options.context}static getDefaults(){return{context:getContext()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(time){return new TimeClass(this.context,time).toSeconds()}toFrequency(freq){return new FrequencyClass(this.context,freq).toFrequency()}toTicks(time){return new TransportTimeClass(this.context,time).toTicks()}_getPartialProperties(props){let options=this.get();return Object.keys(options).forEach(name=>{isUndef(props[name])&&delete options[name]}),options}get(){let defaults=getDefaultsFromInstance(this);return Object.keys(defaults).forEach(attribute=>{if(Reflect.has(this,attribute)){let member=this[attribute];isDefined(member)&&isDefined(member.value)&&isDefined(member.setValueAtTime)?defaults[attribute]=member.value:member instanceof ToneWithContext?defaults[attribute]=member._getPartialProperties(defaults[attribute]):isArray2(member)||isNumber(member)||isString(member)||isBoolean(member)?defaults[attribute]=member:delete defaults[attribute]}}),defaults}set(props){return Object.keys(props).forEach(attribute=>{Reflect.has(this,attribute)&&isDefined(this[attribute])&&(this[attribute]&&isDefined(this[attribute].value)&&isDefined(this[attribute].setValueAtTime)?this[attribute].value!==props[attribute]&&(this[attribute].value=props[attribute]):this[attribute]instanceof ToneWithContext?this[attribute].set(props[attribute]):this[attribute]=props[attribute])}),this}};var StateTimeline=class extends Timeline{constructor(initial="stopped"){super();this.name="StateTimeline",this._initial=initial,this.setStateAtTime(this._initial,0)}getValueAtTime(time){let event=this.get(time);return event!==null?event.state:this._initial}setStateAtTime(state,time,options){return assertRange(time,0),this.add(Object.assign({},options,{state,time})),this}getLastState(state,time){let index3=this._search(time);for(let i=index3;i>=0;i--){let event=this._timeline[i];if(event.state===state)return event}}getNextState(state,time){let index3=this._search(time);if(index3!==-1)for(let i=index3;i<this._timeline.length;i++){let event=this._timeline[i];if(event.state===state)return event}}};var Param=class extends ToneWithContext{constructor(){super(optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]));this.name="Param",this.overridden=!1,this._minOutput=1e-7;let options=optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]);for(assert(isDefined(options.param)&&(isAudioParam(options.param)||options.param instanceof Param),"param must be an AudioParam");!isAudioParam(options.param);)options.param=options.param._param;this._swappable=isDefined(options.swappable)?options.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=options.param,this.input.connect(this._param)):this._param=this.input=options.param,this._events=new Timeline(1e3),this._initialValue=this._param.defaultValue,this.units=options.units,this.convert=options.convert,this._minValue=options.minValue,this._maxValue=options.maxValue,isDefined(options.value)&&options.value!==this._toType(this._initialValue)&&this.setValueAtTime(options.value,0)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{convert:!0,units:"number"})}get value(){let now2=this.now();return this.getValueAtTime(now2)}set value(value){this.cancelScheduledValues(this.now()),this.setValueAtTime(value,this.now())}get minValue(){return isDefined(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-Infinity:this._param.minValue}get maxValue(){return isDefined(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(arg,type){return this.units===type}_assertRange(value){return isDefined(this.maxValue)&&isDefined(this.minValue)&&assertRange(value,this._fromType(this.minValue),this._fromType(this.maxValue)),value}_fromType(val){return this.convert&&!this.overridden?this._is(val,"time")?this.toSeconds(val):this._is(val,"decibels")?dbToGain(val):this._is(val,"frequency")?this.toFrequency(val):val:this.overridden?0:val}_toType(val){return this.convert&&this.units==="decibels"?gainToDb(val):val}setValueAtTime(value,time){let computedTime=this.toSeconds(time),numericValue=this._fromType(value);return assert(isFinite(numericValue)&&isFinite(computedTime),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(value)}, ${JSON.stringify(time)}`),this._assertRange(numericValue),this.log(this.units,"setValueAtTime",value,computedTime),this._events.add({time:computedTime,type:"setValueAtTime",value:numericValue}),this._param.setValueAtTime(numericValue,computedTime),this}getValueAtTime(time){let computedTime=Math.max(this.toSeconds(time),0),after=this._events.getAfter(computedTime),before=this._events.get(computedTime),value=this._initialValue;if(before===null)value=this._initialValue;else if(before.type==="setTargetAtTime"&&(after===null||after.type==="setValueAtTime")){let previous=this._events.getBefore(before.time),previousVal;previous===null?previousVal=this._initialValue:previousVal=previous.value,before.type==="setTargetAtTime"&&(value=this._exponentialApproach(before.time,previousVal,before.value,before.constant,computedTime))}else if(after===null)value=before.value;else if(after.type==="linearRampToValueAtTime"||after.type==="exponentialRampToValueAtTime"){let beforeValue=before.value;if(before.type==="setTargetAtTime"){let previous=this._events.getBefore(before.time);previous===null?beforeValue=this._initialValue:beforeValue=previous.value}after.type==="linearRampToValueAtTime"?value=this._linearInterpolate(before.time,beforeValue,after.time,after.value,computedTime):value=this._exponentialInterpolate(before.time,beforeValue,after.time,after.value,computedTime)}else value=before.value;return this._toType(value)}setRampPoint(time){time=this.toSeconds(time);let currentVal=this.getValueAtTime(time);return this.cancelAndHoldAtTime(time),this._fromType(currentVal)===0&&(currentVal=this._toType(this._minOutput)),this.setValueAtTime(currentVal,time),this}linearRampToValueAtTime(value,endTime){let numericValue=this._fromType(value),computedTime=this.toSeconds(endTime);return assert(isFinite(numericValue)&&isFinite(computedTime),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(value)}, ${JSON.stringify(endTime)}`),this._assertRange(numericValue),this._events.add({time:computedTime,type:"linearRampToValueAtTime",value:numericValue}),this.log(this.units,"linearRampToValueAtTime",value,computedTime),this._param.linearRampToValueAtTime(numericValue,computedTime),this}exponentialRampToValueAtTime(value,endTime){let numericValue=this._fromType(value);numericValue=EQ(numericValue,0)?this._minOutput:numericValue,this._assertRange(numericValue);let computedTime=this.toSeconds(endTime);return assert(isFinite(numericValue)&&isFinite(computedTime),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(value)}, ${JSON.stringify(endTime)}`),this._events.add({time:computedTime,type:"exponentialRampToValueAtTime",value:numericValue}),this.log(this.units,"exponentialRampToValueAtTime",value,computedTime),this._param.exponentialRampToValueAtTime(numericValue,computedTime),this}exponentialRampTo(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.exponentialRampToValueAtTime(value,startTime+this.toSeconds(rampTime)),this}linearRampTo(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.linearRampToValueAtTime(value,startTime+this.toSeconds(rampTime)),this}targetRampTo(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.exponentialApproachValueAtTime(value,startTime,rampTime),this}exponentialApproachValueAtTime(value,time,rampTime){time=this.toSeconds(time),rampTime=this.toSeconds(rampTime);let timeConstant=Math.log(rampTime+1)/Math.log(200);return this.setTargetAtTime(value,time,timeConstant),this.cancelAndHoldAtTime(time+rampTime*.9),this.linearRampToValueAtTime(value,time+rampTime),this}setTargetAtTime(value,startTime,timeConstant){let numericValue=this._fromType(value);assert(isFinite(timeConstant)&&timeConstant>0,"timeConstant must be a number greater than 0");let computedTime=this.toSeconds(startTime);return this._assertRange(numericValue),assert(isFinite(numericValue)&&isFinite(computedTime),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(value)}, ${JSON.stringify(startTime)}`),this._events.add({constant:timeConstant,time:computedTime,type:"setTargetAtTime",value:numericValue}),this.log(this.units,"setTargetAtTime",value,computedTime,timeConstant),this._param.setTargetAtTime(numericValue,computedTime,timeConstant),this}setValueCurveAtTime(values,startTime,duration,scaling=1){duration=this.toSeconds(duration),startTime=this.toSeconds(startTime);let startingValue=this._fromType(values[0])*scaling;this.setValueAtTime(this._toType(startingValue),startTime);let segTime=duration/(values.length-1);for(let i=1;i<values.length;i++){let numericValue=this._fromType(values[i])*scaling;this.linearRampToValueAtTime(this._toType(numericValue),startTime+i*segTime)}return this}cancelScheduledValues(time){let computedTime=this.toSeconds(time);return assert(isFinite(computedTime),`Invalid argument to cancelScheduledValues: ${JSON.stringify(time)}`),this._events.cancel(computedTime),this._param.cancelScheduledValues(computedTime),this.log(this.units,"cancelScheduledValues",computedTime),this}cancelAndHoldAtTime(time){let computedTime=this.toSeconds(time),valueAtTime=this._fromType(this.getValueAtTime(computedTime));assert(isFinite(computedTime),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(time)}`),this.log(this.units,"cancelAndHoldAtTime",computedTime,"value="+valueAtTime);let before=this._events.get(computedTime),after=this._events.getAfter(computedTime);return before&&EQ(before.time,computedTime)?after?(this._param.cancelScheduledValues(after.time),this._events.cancel(after.time)):(this._param.cancelAndHoldAtTime(computedTime),this._events.cancel(computedTime+this.sampleTime)):after&&(this._param.cancelScheduledValues(after.time),this._events.cancel(after.time),after.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(valueAtTime),computedTime):after.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(valueAtTime),computedTime)),this._events.add({time:computedTime,type:"setValueAtTime",value:valueAtTime}),this._param.setValueAtTime(valueAtTime,computedTime),this}rampTo(value,rampTime=.1,startTime){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(value,rampTime,startTime):this.linearRampTo(value,rampTime,startTime),this}apply(param){let now2=this.context.currentTime;param.setValueAtTime(this.getValueAtTime(now2),now2);let previousEvent=this._events.get(now2);if(previousEvent&&previousEvent.type==="setTargetAtTime"){let nextEvent=this._events.getAfter(previousEvent.time),endTime=nextEvent?nextEvent.time:now2+2,subdivisions=(endTime-now2)/10;for(let i=now2;i<endTime;i+=subdivisions)param.linearRampToValueAtTime(this.getValueAtTime(i),i)}return this._events.forEachAfter(this.context.currentTime,event=>{event.type==="cancelScheduledValues"?param.cancelScheduledValues(event.time):event.type==="setTargetAtTime"?param.setTargetAtTime(event.value,event.time,event.constant):param[event.type](event.value,event.time)}),this}setParam(param){assert(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let input=this.input;return input.disconnect(this._param),this.apply(param),this._param=param,input.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)}_linearInterpolate(t0,v0,t1,v1,t){return v0+(v1-v0)*((t-t0)/(t1-t0))}_exponentialInterpolate(t0,v0,t1,v1,t){return v0*Math.pow(v1/v0,(t-t0)/(t1-t0))}};var ToneAudioNode=class extends ToneWithContext{constructor(){super(...arguments);this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return isDefined(this.input)?isAudioParam(this.input)||this.input instanceof Param?1:this.input.numberOfInputs:0}get numberOfOutputs(){return isDefined(this.output)?this.output.numberOfOutputs:0}_isAudioNode(node){return isDefined(node)&&(node instanceof ToneAudioNode||isAudioNode2(node))}_getInternalNodes(){let nodeList=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&nodeList.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&nodeList.push(this.output),nodeList}_setChannelProperties(options){this._getInternalNodes().forEach(node=>{node.channelCount=options.channelCount,node.channelCountMode=options.channelCountMode,node.channelInterpretation=options.channelInterpretation})}_getChannelProperties(){let nodeList=this._getInternalNodes();assert(nodeList.length>0,"ToneAudioNode does not have any internal nodes");let node=nodeList[0];return{channelCount:node.channelCount,channelCountMode:node.channelCountMode,channelInterpretation:node.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(channelCount){let props=this._getChannelProperties();this._setChannelProperties(Object.assign(props,{channelCount}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(channelCountMode){let props=this._getChannelProperties();this._setChannelProperties(Object.assign(props,{channelCountMode}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(channelInterpretation){let props=this._getChannelProperties();this._setChannelProperties(Object.assign(props,{channelInterpretation}))}connect(destination,outputNum=0,inputNum=0){return connect(this,destination,outputNum,inputNum),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return warn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(destination,outputNum=0,inputNum=0){return disconnect(this,destination,outputNum,inputNum),this}chain(...nodes){return connectSeries(this,...nodes),this}fan(...nodes){return nodes.forEach(node=>this.connect(node)),this}dispose(){return super.dispose(),isDefined(this.input)&&(this.input instanceof ToneAudioNode?this.input.dispose():isAudioNode2(this.input)&&this.input.disconnect()),isDefined(this.output)&&(this.output instanceof ToneAudioNode?this.output.dispose():isAudioNode2(this.output)&&this.output.disconnect()),this._internalChannels=[],this}};function connectSeries(...nodes){let first=nodes.shift();nodes.reduce((prev,current)=>(prev instanceof ToneAudioNode?prev.connect(current):isAudioNode2(prev)&&connect(prev,current),current),first)}function connect(srcNode,dstNode,outputNumber=0,inputNumber=0){for(assert(isDefined(srcNode),"Cannot connect from undefined node"),assert(isDefined(dstNode),"Cannot connect to undefined node"),(dstNode instanceof ToneAudioNode||isAudioNode2(dstNode))&&assert(dstNode.numberOfInputs>0,"Cannot connect to node with no inputs"),assert(srcNode.numberOfOutputs>0,"Cannot connect from node with no outputs");dstNode instanceof ToneAudioNode||dstNode instanceof Param;)isDefined(dstNode.input)&&(dstNode=dstNode.input);for(;srcNode instanceof ToneAudioNode;)isDefined(srcNode.output)&&(srcNode=srcNode.output);isAudioParam(dstNode)?srcNode.connect(dstNode,outputNumber):srcNode.connect(dstNode,outputNumber,inputNumber)}function disconnect(srcNode,dstNode,outputNumber=0,inputNumber=0){if(isDefined(dstNode))for(;dstNode instanceof ToneAudioNode;)dstNode=dstNode.input;for(;!isAudioNode2(srcNode);)isDefined(srcNode.output)&&(srcNode=srcNode.output);isAudioParam(dstNode)?srcNode.disconnect(dstNode,outputNumber):isAudioNode2(dstNode)?srcNode.disconnect(dstNode,outputNumber,inputNumber):srcNode.disconnect()}var Gain=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]));this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let options=optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]);this.gain=new Param({context:this.context,convert:options.convert,param:this._gainNode.gain,units:options.units,value:options.gain,minValue:options.minValue,maxValue:options.maxValue}),readOnly(this,"gain")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}};var OneShotSource=class extends ToneAudioNode{constructor(options){super(options);this.onended=noOp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Gain({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(time){let computedTime=this.toSeconds(time);return this._startTime!==-1&&computedTime>=this._startTime&&(this._stopTime===-1||computedTime<=this._stopTime)?"started":"stopped"},this._fadeIn=options.fadeIn,this._fadeOut=options.fadeOut,this._curve=options.curve,this.onended=options.onended}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:noOp})}_startGain(time,gain=1){assert(this._startTime===-1,"Source cannot be started more than once");let fadeInTime=this.toSeconds(this._fadeIn);return this._startTime=time+fadeInTime,this._startTime=Math.max(this._startTime,this.context.currentTime),fadeInTime>0?(this._gainNode.gain.setValueAtTime(0,time),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(gain,time+fadeInTime):this._gainNode.gain.exponentialApproachValueAtTime(gain,time,fadeInTime)):this._gainNode.gain.setValueAtTime(gain,time),this}stop(time){return this.log("stop",time),this._stopGain(this.toSeconds(time)),this}_stopGain(time){assert(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();let fadeOutTime=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(time)+fadeOutTime,this._stopTime=Math.max(this._stopTime,this.context.currentTime),fadeOutTime>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,fadeOutTime,time):this._gainNode.gain.targetRampTo(0,fadeOutTime,time):(this._gainNode.gain.cancelAndHoldAtTime(time),this._gainNode.gain.setValueAtTime(0,time)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let additionalTail=this._curve==="exponential"?fadeOutTime*2:0;this._stopSource(this.now()+additionalTail),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==noOp&&(this.onended(this),this.onended=noOp,!this.context.isOffline)){let disposeCallback=()=>this.dispose();typeof window.requestIdleCallback!="undefined"?window.requestIdleCallback(disposeCallback):setTimeout(disposeCallback,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),assert(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}};var ToneConstantSource=class extends OneShotSource{constructor(){super(optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]));this.name="ToneConstantSource",this._source=this.context.createConstantSource();let options=optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]);connect(this._source,this._gainNode),this.offset=new Param({context:this.context,convert:options.convert,param:this._source.offset,units:options.units,value:options.offset,minValue:options.minValue,maxValue:options.maxValue})}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{convert:!0,offset:1,units:"number"})}start(time){let computedTime=this.toSeconds(time);return this.log("start",computedTime),this._startGain(computedTime),this._source.start(computedTime),this}_stopSource(time){this._source.stop(time)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}};var Signal2=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Signal2.getDefaults(),arguments,["value","units"]));this.name="Signal",this.override=!0;let options=optionsFromArguments(Signal2.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ToneConstantSource({context:this.context,convert:options.convert,offset:options.value,units:options.units,minValue:options.minValue,maxValue:options.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,units:"number",value:0})}connect(destination,outputNum=0,inputNum=0){return connectSignal(this,destination,outputNum,inputNum),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(value,time){return this._param.setValueAtTime(value,time),this}getValueAtTime(time){return this._param.getValueAtTime(time)}setRampPoint(time){return this._param.setRampPoint(time),this}linearRampToValueAtTime(value,time){return this._param.linearRampToValueAtTime(value,time),this}exponentialRampToValueAtTime(value,time){return this._param.exponentialRampToValueAtTime(value,time),this}exponentialRampTo(value,rampTime,startTime){return this._param.exponentialRampTo(value,rampTime,startTime),this}linearRampTo(value,rampTime,startTime){return this._param.linearRampTo(value,rampTime,startTime),this}targetRampTo(value,rampTime,startTime){return this._param.targetRampTo(value,rampTime,startTime),this}exponentialApproachValueAtTime(value,time,rampTime){return this._param.exponentialApproachValueAtTime(value,time,rampTime),this}setTargetAtTime(value,startTime,timeConstant){return this._param.setTargetAtTime(value,startTime,timeConstant),this}setValueCurveAtTime(values,startTime,duration,scaling){return this._param.setValueCurveAtTime(values,startTime,duration,scaling),this}cancelScheduledValues(time){return this._param.cancelScheduledValues(time),this}cancelAndHoldAtTime(time){return this._param.cancelAndHoldAtTime(time),this}rampTo(value,rampTime,startTime){return this._param.rampTo(value,rampTime,startTime),this}get value(){return this._param.value}set value(value){this._param.value=value}get convert(){return this._param.convert}set convert(convert){this._param.convert=convert}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(overridden){this._param.overridden=overridden}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(param){return this._param.apply(param),this}};function connectSignal(signal,destination,outputNum,inputNum){(destination instanceof Param||isAudioParam(destination)||destination instanceof Signal2&&destination.override)&&(destination.cancelScheduledValues(0),destination.setValueAtTime(0,0),destination instanceof Signal2&&(destination.overridden=!0)),connect(signal,destination,outputNum,inputNum)}var TickParam=class extends Param{constructor(){super(optionsFromArguments(TickParam.getDefaults(),arguments,["value"]));this.name="TickParam",this._events=new Timeline(Infinity),this._multiplier=1;let options=optionsFromArguments(TickParam.getDefaults(),arguments,["value"]);this._multiplier=options.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(options.value)}),this.setValueAtTime(options.value,0)}static getDefaults(){return Object.assign(Param.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(value,time,constant){time=this.toSeconds(time),this.setRampPoint(time);let computedValue=this._fromType(value),prevEvent=this._events.get(time),segments=Math.round(Math.max(1/constant,1));for(let i=0;i<=segments;i++){let segTime=constant*i+time,rampVal=this._exponentialApproach(prevEvent.time,prevEvent.value,computedValue,constant,segTime);this.linearRampToValueAtTime(this._toType(rampVal),segTime)}return this}setValueAtTime(value,time){let computedTime=this.toSeconds(time);super.setValueAtTime(value,time);let event=this._events.get(computedTime),previousEvent=this._events.previousEvent(event),ticksUntilTime=this._getTicksUntilEvent(previousEvent,computedTime);return event.ticks=Math.max(ticksUntilTime,0),this}linearRampToValueAtTime(value,time){let computedTime=this.toSeconds(time);super.linearRampToValueAtTime(value,time);let event=this._events.get(computedTime),previousEvent=this._events.previousEvent(event),ticksUntilTime=this._getTicksUntilEvent(previousEvent,computedTime);return event.ticks=Math.max(ticksUntilTime,0),this}exponentialRampToValueAtTime(value,time){time=this.toSeconds(time);let computedVal=this._fromType(value),prevEvent=this._events.get(time),segments=Math.round(Math.max((time-prevEvent.time)*10,1)),segmentDur=(time-prevEvent.time)/segments;for(let i=0;i<=segments;i++){let segTime=segmentDur*i+prevEvent.time,rampVal=this._exponentialInterpolate(prevEvent.time,prevEvent.value,time,computedVal,segTime);this.linearRampToValueAtTime(this._toType(rampVal),segTime)}return this}_getTicksUntilEvent(event,time){if(event===null)event={ticks:0,time:0,type:"setValueAtTime",value:0};else if(isUndef(event.ticks)){let previousEvent=this._events.previousEvent(event);event.ticks=this._getTicksUntilEvent(previousEvent,event.time)}let val0=this._fromType(this.getValueAtTime(event.time)),val1=this._fromType(this.getValueAtTime(time)),onTheLineEvent=this._events.get(time);return onTheLineEvent&&onTheLineEvent.time===time&&onTheLineEvent.type==="setValueAtTime"&&(val1=this._fromType(this.getValueAtTime(time-this.sampleTime))),.5*(time-event.time)*(val0+val1)+event.ticks}getTicksAtTime(time){let computedTime=this.toSeconds(time),event=this._events.get(computedTime);return Math.max(this._getTicksUntilEvent(event,computedTime),0)}getDurationOfTicks(ticks,time){let computedTime=this.toSeconds(time),currentTick=this.getTicksAtTime(time);return this.getTimeOfTick(currentTick+ticks)-computedTime}getTimeOfTick(tick){let before=this._events.get(tick,"ticks"),after=this._events.getAfter(tick,"ticks");if(before&&before.ticks===tick)return before.time;if(before&&after&&after.type==="linearRampToValueAtTime"&&before.value!==after.value){let val0=this._fromType(this.getValueAtTime(before.time)),delta=(this._fromType(this.getValueAtTime(after.time))-val0)/(after.time-before.time),k=Math.sqrt(Math.pow(val0,2)-2*delta*(before.ticks-tick)),sol1=(-val0+k)/delta,sol2=(-val0-k)/delta;return(sol1>0?sol1:sol2)+before.time}else return before?before.value===0?Infinity:before.time+(tick-before.ticks)/before.value:tick/this._initialValue}ticksToTime(ticks,when){return this.getDurationOfTicks(ticks,when)}timeToTicks(duration,when){let computedTime=this.toSeconds(when),computedDuration=this.toSeconds(duration),startTicks=this.getTicksAtTime(computedTime);return this.getTicksAtTime(computedTime+computedDuration)-startTicks}_fromType(val){return this.units==="bpm"&&this.multiplier?1/(60/val/this.multiplier):super._fromType(val)}_toType(val){return this.units==="bpm"&&this.multiplier?val/this.multiplier*60:super._toType(val)}get multiplier(){return this._multiplier}set multiplier(m){let currentVal=this.value;this._multiplier=m,this.cancelScheduledValues(0),this.setValueAtTime(currentVal,0)}};var TickSignal=class extends Signal2{constructor(){super(optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]));this.name="TickSignal";let options=optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]);this.input=this._param=new TickParam({context:this.context,convert:options.convert,multiplier:options.multiplier,param:this._constantSource.offset,units:options.units,value:options.value})}static getDefaults(){return Object.assign(Signal2.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(ticks,when){return this._param.ticksToTime(ticks,when)}timeToTicks(duration,when){return this._param.timeToTicks(duration,when)}getTimeOfTick(tick){return this._param.getTimeOfTick(tick)}getDurationOfTicks(ticks,time){return this._param.getDurationOfTicks(ticks,time)}getTicksAtTime(time){return this._param.getTicksAtTime(time)}get multiplier(){return this._param.multiplier}set multiplier(m){this._param.multiplier=m}dispose(){return super.dispose(),this._param.dispose(),this}};var TickSource=class extends ToneWithContext{constructor(){super(optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]));this.name="TickSource",this._state=new StateTimeline,this._tickOffset=new Timeline;let options=optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]);this.frequency=new TickSignal({context:this.context,units:options.units,value:options.frequency}),readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ToneWithContext.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(time,offset){let computedTime=this.toSeconds(time);return this._state.getValueAtTime(computedTime)!=="started"&&(this._state.setStateAtTime("started",computedTime),isDefined(offset)&&this.setTicksAtTime(offset,computedTime)),this}stop(time){let computedTime=this.toSeconds(time);if(this._state.getValueAtTime(computedTime)==="stopped"){let event=this._state.get(computedTime);event&&event.time>0&&(this._tickOffset.cancel(event.time),this._state.cancel(event.time))}return this._state.cancel(computedTime),this._state.setStateAtTime("stopped",computedTime),this.setTicksAtTime(0,computedTime),this}pause(time){let computedTime=this.toSeconds(time);return this._state.getValueAtTime(computedTime)==="started"&&this._state.setStateAtTime("paused",computedTime),this}cancel(time){return time=this.toSeconds(time),this._state.cancel(time),this._tickOffset.cancel(time),this}getTicksAtTime(time){let computedTime=this.toSeconds(time),stopEvent=this._state.getLastState("stopped",computedTime),tmpEvent={state:"paused",time:computedTime};this._state.add(tmpEvent);let lastState=stopEvent,elapsedTicks=0;return this._state.forEachBetween(stopEvent.time,computedTime+this.sampleTime,e=>{let periodStartTime=lastState.time,offsetEvent=this._tickOffset.get(e.time);offsetEvent&&offsetEvent.time>=lastState.time&&(elapsedTicks=offsetEvent.ticks,periodStartTime=offsetEvent.time),lastState.state==="started"&&e.state!=="started"&&(elapsedTicks+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(periodStartTime)),lastState=e}),this._state.remove(tmpEvent),elapsedTicks}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(s){let now2=this.now(),ticks=this.frequency.timeToTicks(s,now2);this.setTicksAtTime(ticks,now2)}getSecondsAtTime(time){time=this.toSeconds(time);let stopEvent=this._state.getLastState("stopped",time),tmpEvent={state:"paused",time};this._state.add(tmpEvent);let lastState=stopEvent,elapsedSeconds=0;return this._state.forEachBetween(stopEvent.time,time+this.sampleTime,e=>{let periodStartTime=lastState.time,offsetEvent=this._tickOffset.get(e.time);offsetEvent&&offsetEvent.time>=lastState.time&&(elapsedSeconds=offsetEvent.seconds,periodStartTime=offsetEvent.time),lastState.state==="started"&&e.state!=="started"&&(elapsedSeconds+=e.time-periodStartTime),lastState=e}),this._state.remove(tmpEvent),elapsedSeconds}setTicksAtTime(ticks,time){return time=this.toSeconds(time),this._tickOffset.cancel(time),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(ticks,time),ticks,time}),this}getStateAtTime(time){return time=this.toSeconds(time),this._state.getValueAtTime(time)}getTimeOfTick(tick,before=this.now()){let offset=this._tickOffset.get(before),event=this._state.get(before),startTime=Math.max(offset.time,event.time),absoluteTicks=this.frequency.getTicksAtTime(startTime)+tick-offset.ticks;return this.frequency.getTimeOfTick(absoluteTicks)}forEachTickBetween(startTime,endTime,callback){let lastStateEvent=this._state.get(startTime);this._state.forEachBetween(startTime,endTime,event=>{lastStateEvent&&lastStateEvent.state==="started"&&event.state!=="started"&&this.forEachTickBetween(Math.max(lastStateEvent.time,startTime),event.time-this.sampleTime,callback),lastStateEvent=event});let error=null;if(lastStateEvent&&lastStateEvent.state==="started"){let maxStartTime=Math.max(lastStateEvent.time,startTime),startTicks=this.frequency.getTicksAtTime(maxStartTime),ticksAtStart=this.frequency.getTicksAtTime(lastStateEvent.time),diff=startTicks-ticksAtStart,offset=Math.ceil(diff)-diff;offset=EQ(offset,1)?0:offset;let nextTickTime=this.frequency.getTimeOfTick(startTicks+offset);for(;nextTickTime<endTime;){try{callback(nextTickTime,Math.round(this.getTicksAtTime(nextTickTime)))}catch(e){error=e;break}nextTickTime+=this.frequency.getDurationOfTicks(1,nextTickTime)}}if(error)throw error;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}};var Clock2=class extends ToneWithContext{constructor(){super(optionsFromArguments(Clock2.getDefaults(),arguments,["callback","frequency"]));this.name="Clock",this.callback=noOp,this._lastUpdate=0,this._state=new StateTimeline("stopped"),this._boundLoop=this._loop.bind(this);let options=optionsFromArguments(Clock2.getDefaults(),arguments,["callback","frequency"]);this.callback=options.callback,this._tickSource=new TickSource({context:this.context,frequency:options.frequency,units:options.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(time,offset){assertContextRunning(this.context);let computedTime=this.toSeconds(time);return this.log("start",computedTime),this._state.getValueAtTime(computedTime)!=="started"&&(this._state.setStateAtTime("started",computedTime),this._tickSource.start(computedTime,offset),computedTime<this._lastUpdate&&this.emit("start",computedTime,offset)),this}stop(time){let computedTime=this.toSeconds(time);return this.log("stop",computedTime),this._state.cancel(computedTime),this._state.setStateAtTime("stopped",computedTime),this._tickSource.stop(computedTime),computedTime<this._lastUpdate&&this.emit("stop",computedTime),this}pause(time){let computedTime=this.toSeconds(time);return this._state.getValueAtTime(computedTime)==="started"&&(this._state.setStateAtTime("paused",computedTime),this._tickSource.pause(computedTime),computedTime<this._lastUpdate&&this.emit("pause",computedTime)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(s){this._tickSource.seconds=s}getSecondsAtTime(time){return this._tickSource.getSecondsAtTime(time)}setTicksAtTime(ticks,time){return this._tickSource.setTicksAtTime(ticks,time),this}getTimeOfTick(tick,before=this.now()){return this._tickSource.getTimeOfTick(tick,before)}getTicksAtTime(time){return this._tickSource.getTicksAtTime(time)}nextTickTime(offset,when){let computedTime=this.toSeconds(when),currentTick=this.getTicksAtTime(computedTime);return this._tickSource.getTimeOfTick(currentTick+offset,computedTime)}_loop(){let startTime=this._lastUpdate,endTime=this.now();this._lastUpdate=endTime,this.log("loop",startTime,endTime),startTime!==endTime&&(this._state.forEachBetween(startTime,endTime,e=>{switch(e.state){case"started":let offset=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,offset);break;case"stopped":e.time!==0&&this.emit("stop",e.time);break;case"paused":this.emit("pause",e.time);break}}),this._tickSource.forEachTickBetween(startTime,endTime,(time,ticks)=>{this.callback(time,ticks)}))}getStateAtTime(time){let computedTime=this.toSeconds(time);return this._state.getValueAtTime(computedTime)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}};Emitter.mixin(Clock2);var Delay=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Delay.getDefaults(),arguments,["delayTime","maxDelay"]));this.name="Delay";let options=optionsFromArguments(Delay.getDefaults(),arguments,["delayTime","maxDelay"]),maxDelayInSeconds=this.toSeconds(options.maxDelay);this._maxDelay=Math.max(maxDelayInSeconds,this.toSeconds(options.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(maxDelayInSeconds),this.delayTime=new Param({context:this.context,param:this._delayNode.delayTime,units:"time",value:options.delayTime,minValue:0,maxValue:this.maxDelay}),readOnly(this,"delayTime")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}};function Offline(callback,duration,channels=2,sampleRate=getContext().sampleRate){return __awaiter2(this,void 0,void 0,function*(){let originalContext=getContext(),context4=new OfflineContext(channels,duration,sampleRate);setContext(context4),yield callback(context4);let bufferPromise=context4.render();setContext(originalContext);let buffer=yield bufferPromise;return new ToneAudioBuffer(buffer)})}var ToneAudioBuffers=class extends Tone{constructor(){super();this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let options=optionsFromArguments(ToneAudioBuffers.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=options.baseUrl,Object.keys(options.urls).forEach(name=>{this._loadingCount++;let url3=options.urls[name];this.add(name,url3,this._bufferLoaded.bind(this,options.onload),options.onerror)})}static getDefaults(){return{baseUrl:"",onerror:noOp,onload:noOp,urls:{}}}has(name){return this._buffers.has(name.toString())}get(name){return assert(this.has(name),`ToneAudioBuffers has no buffer named: ${name}`),this._buffers.get(name.toString())}_bufferLoaded(callback){this._loadingCount--,this._loadingCount===0&&callback&&callback()}get loaded(){return Array.from(this._buffers).every(([_,buffer])=>buffer.loaded)}add(name,url3,callback=noOp,onerror=noOp){return isString(url3)?this._buffers.set(name.toString(),new ToneAudioBuffer(this.baseUrl+url3,callback,onerror)):this._buffers.set(name.toString(),new ToneAudioBuffer(url3,callback,onerror)),this}dispose(){return super.dispose(),this._buffers.forEach(buffer=>buffer.dispose()),this._buffers.clear(),this}};var MidiClass=class extends FrequencyClass{constructor(){super(...arguments);this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(freq){return ftom(super._frequencyToUnits(freq))}_ticksToUnits(ticks){return ftom(super._ticksToUnits(ticks))}_beatsToUnits(beats){return ftom(super._beatsToUnits(beats))}_secondsToUnits(seconds){return ftom(super._secondsToUnits(seconds))}toMidi(){return this.valueOf()}toFrequency(){return mtof(this.toMidi())}transpose(interval){return new MidiClass(this.context,this.toMidi()+interval)}};function Midi(value,units){return new MidiClass(getContext(),value,units)}var TicksClass=class extends TransportTimeClass{constructor(){super(...arguments);this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(beats){return this._getPPQ()*beats}_secondsToUnits(seconds){return Math.floor(seconds/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(ticks){return ticks}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}};function Ticks(value,units){return new TicksClass(getContext(),value,units)}var Draw=class extends ToneWithContext{constructor(){super(...arguments);this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Timeline,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(callback,time){return this._events.add({callback,time:this.toSeconds(time)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(after){return this._events.cancel(this.toSeconds(after)),this}_drawLoop(){let now2=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=now2;){let event=this._events.shift();event&&now2-event.time<=this.expiration&&event.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}};onContextInit(context4=>{context4.draw=new Draw({context:context4})});onContextClose(context4=>{context4.draw.dispose()});var IntervalTimeline=class extends Tone{constructor(){super(...arguments);this.name="IntervalTimeline",this._root=null,this._length=0}add(event){assert(isDefined(event.time),"Events must have a time property"),assert(isDefined(event.duration),"Events must have a duration parameter"),event.time=event.time.valueOf();let node=new IntervalNode(event.time,event.time+event.duration,event);for(this._root===null?this._root=node:this._root.insert(node),this._length++;node!==null;)node.updateHeight(),node.updateMax(),this._rebalance(node),node=node.parent;return this}remove(event){if(this._root!==null){let results=[];this._root.search(event.time,results);for(let node of results)if(node.event===event){this._removeNode(node),this._length--;break}}return this}get length(){return this._length}cancel(after){return this.forEachFrom(after,event=>this.remove(event)),this}_setRoot(node){this._root=node,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(node,replacement){node.parent!==null?(node.isLeftChild()?node.parent.left=replacement:node.parent.right=replacement,this._rebalance(node.parent)):this._setRoot(replacement)}_removeNode(node){if(node.left===null&&node.right===null)this._replaceNodeInParent(node,null);else if(node.right===null)this._replaceNodeInParent(node,node.left);else if(node.left===null)this._replaceNodeInParent(node,node.right);else{let balance=node.getBalance(),replacement,temp2=null;if(balance>0)if(node.left.right===null)replacement=node.left,replacement.right=node.right,temp2=replacement;else{for(replacement=node.left.right;replacement.right!==null;)replacement=replacement.right;replacement.parent&&(replacement.parent.right=replacement.left,temp2=replacement.parent,replacement.left=node.left,replacement.right=node.right)}else if(node.right.left===null)replacement=node.right,replacement.left=node.left,temp2=replacement;else{for(replacement=node.right.left;replacement.left!==null;)replacement=replacement.left;replacement.parent&&(replacement.parent.left=replacement.right,temp2=replacement.parent,replacement.left=node.left,replacement.right=node.right)}node.parent!==null?node.isLeftChild()?node.parent.left=replacement:node.parent.right=replacement:this._setRoot(replacement),temp2&&this._rebalance(temp2)}node.dispose()}_rotateLeft(node){let parent=node.parent,isLeftChild=node.isLeftChild(),pivotNode=node.right;pivotNode&&(node.right=pivotNode.left,pivotNode.left=node),parent!==null?isLeftChild?parent.left=pivotNode:parent.right=pivotNode:this._setRoot(pivotNode)}_rotateRight(node){let parent=node.parent,isLeftChild=node.isLeftChild(),pivotNode=node.left;pivotNode&&(node.left=pivotNode.right,pivotNode.right=node),parent!==null?isLeftChild?parent.left=pivotNode:parent.right=pivotNode:this._setRoot(pivotNode)}_rebalance(node){let balance=node.getBalance();balance>1&&node.left?node.left.getBalance()<0?this._rotateLeft(node.left):this._rotateRight(node):balance<-1&&node.right&&(node.right.getBalance()>0?this._rotateRight(node.right):this._rotateLeft(node))}get(time){if(this._root!==null){let results=[];if(this._root.search(time,results),results.length>0){let max=results[0];for(let i=1;i<results.length;i++)results[i].low>max.low&&(max=results[i]);return max.event}}return null}forEach(callback){if(this._root!==null){let allNodes=[];this._root.traverse(node=>allNodes.push(node)),allNodes.forEach(node=>{node.event&&callback(node.event)})}return this}forEachAtTime(time,callback){if(this._root!==null){let results=[];this._root.search(time,results),results.forEach(node=>{node.event&&callback(node.event)})}return this}forEachFrom(time,callback){if(this._root!==null){let results=[];this._root.searchAfter(time,results),results.forEach(node=>{node.event&&callback(node.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(node=>node.dispose()),this._root=null,this}},IntervalNode=class{constructor(low,high,event){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=event,this.low=low,this.high=high,this.max=this.high}insert(node){node.low<=this.low?this.left===null?this.left=node:this.left.insert(node):this.right===null?this.right=node:this.right.insert(node)}search(point,results){point>this.max||(this.left!==null&&this.left.search(point,results),this.low<=point&&this.high>point&&results.push(this),!(this.low>point)&&this.right!==null&&this.right.search(point,results))}searchAfter(point,results){this.low>=point&&(results.push(this),this.left!==null&&this.left.searchAfter(point,results)),this.right!==null&&this.right.searchAfter(point,results)}traverse(callback){callback(this),this.left!==null&&this.left.traverse(callback),this.right!==null&&this.right.traverse(callback)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let balance=0;return this.left!==null&&this.right!==null?balance=this.left.height-this.right.height:this.left!==null?balance=this.left.height+1:this.right!==null&&(balance=-(this.right.height+1)),balance}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(node){this._left=node,node!==null&&(node.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(node){this._right=node,node!==null&&(node.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}};var Units_exports={};var Volume=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Volume.getDefaults(),arguments,["volume"]));this.name="Volume";let options=optionsFromArguments(Volume.getDefaults(),arguments,["volume"]);this.input=this.output=new Gain({context:this.context,gain:options.volume,units:"decibels"}),this.volume=this.output.gain,readOnly(this,"volume"),this._unmutedVolume=options.volume,this.mute=options.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-Infinity}set mute(mute){!this.mute&&mute?(this._unmutedVolume=this.volume.value,this.volume.value=-Infinity):this.mute&&!mute&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}};var Destination=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Destination.getDefaults(),arguments));this.name="Destination",this.input=new Volume({context:this.context}),this.output=new Gain({context:this.context}),this.volume=this.input.volume;let options=optionsFromArguments(Destination.getDefaults(),arguments);connectSeries(this.input,this.output,this.context.rawContext.destination),this.mute=options.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(mute){this.input.mute=mute}chain(...args){return this.input.disconnect(),args.unshift(this.input),args.push(this.output),connectSeries(...args),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};onContextInit(context4=>{context4.destination=new Destination({context:context4})});onContextClose(context4=>{context4.destination.dispose()});var TimelineValue=class extends Tone{constructor(initialValue){super();this.name="TimelineValue",this._timeline=new Timeline({memory:10}),this._initialValue=initialValue}set(value,time){return this._timeline.add({value,time}),this}get(time){let event=this._timeline.get(time);return event?event.value:this._initialValue}};var TransportEvent=class{constructor(transport,opts){this.id=TransportEvent._eventId++;let options=Object.assign(TransportEvent.getDefaults(),opts);this.transport=transport,this.callback=options.callback,this._once=options.once,this.time=options.time}static getDefaults(){return{callback:noOp,once:!1,time:0}}invoke(time){this.callback&&(this.callback(time),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}};TransportEvent._eventId=0;var TransportRepeatEvent=class extends TransportEvent{constructor(transport,opts){super(transport,opts);this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let options=Object.assign(TransportRepeatEvent.getDefaults(),opts);this.duration=new TicksClass(transport.context,options.duration).valueOf(),this._interval=new TicksClass(transport.context,options.interval).valueOf(),this._nextTick=options.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},TransportEvent.getDefaults(),{duration:Infinity,interval:1,once:!1})}invoke(time){this._createEvents(time),super.invoke(time)}_createEvents(time){let ticks=this.transport.getTicksAtTime(time);ticks>=this.time&&ticks>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()))}_restart(time){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;let ticks=this.transport.getTicksAtTime(time);ticks>this.time&&(this._nextTick=this.time+Math.ceil((ticks-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}};var Transport=class extends ToneWithContext{constructor(){super(optionsFromArguments(Transport.getDefaults(),arguments));this.name="Transport",this._loop=new TimelineValue(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Timeline,this._repeatedEvents=new IntervalTimeline,this._syncedSignals=[],this._swingAmount=0;let options=optionsFromArguments(Transport.getDefaults(),arguments);this._ppq=options.ppq,this._clock=new Clock2({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=options.ppq,this.bpm.setValueAtTime(options.bpm,0),readOnly(this,"bpm"),this._timeSignature=options.timeSignature,this._swingTicks=options.ppq/2}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(tickTime,ticks){if(this._loop.get(tickTime)&&ticks>=this._loopEnd&&(this.emit("loopEnd",tickTime),this._clock.setTicksAtTime(this._loopStart,tickTime),ticks=this._loopStart,this.emit("loopStart",tickTime,this._clock.getSecondsAtTime(tickTime)),this.emit("loop",tickTime)),this._swingAmount>0&&ticks%this._ppq!=0&&ticks%(this._swingTicks*2)!=0){let progress=ticks%(this._swingTicks*2)/(this._swingTicks*2),amount=Math.sin(progress*Math.PI)*this._swingAmount;tickTime+=new TicksClass(this.context,this._swingTicks*2/3).toSeconds()*amount}this._timeline.forEachAtTime(ticks,event=>event.invoke(tickTime))}schedule(callback,time){let event=new TransportEvent(this,{callback,time:new TransportTimeClass(this.context,time).toTicks()});return this._addEvent(event,this._timeline)}scheduleRepeat(callback,interval,startTime,duration=Infinity){let event=new TransportRepeatEvent(this,{callback,duration:new TimeClass(this.context,duration).toTicks(),interval:new TimeClass(this.context,interval).toTicks(),time:new TransportTimeClass(this.context,startTime).toTicks()});return this._addEvent(event,this._repeatedEvents)}scheduleOnce(callback,time){let event=new TransportEvent(this,{callback,once:!0,time:new TransportTimeClass(this.context,time).toTicks()});return this._addEvent(event,this._timeline)}clear(eventId){if(this._scheduledEvents.hasOwnProperty(eventId)){let item=this._scheduledEvents[eventId.toString()];item.timeline.remove(item.event),item.event.dispose(),delete this._scheduledEvents[eventId.toString()]}return this}_addEvent(event,timeline){return this._scheduledEvents[event.id.toString()]={event,timeline},timeline.add(event),event.id}cancel(after=0){let computedAfter=this.toTicks(after);return this._timeline.forEachFrom(computedAfter,event=>this.clear(event.id)),this._repeatedEvents.forEachFrom(computedAfter,event=>this.clear(event.id)),this}_bindClockEvents(){this._clock.on("start",(time,offset)=>{offset=new TicksClass(this.context,offset).toSeconds(),this.emit("start",time,offset)}),this._clock.on("stop",time=>{this.emit("stop",time)}),this._clock.on("pause",time=>{this.emit("pause",time)})}get state(){return this._clock.getStateAtTime(this.now())}start(time,offset){let offsetTicks;return isDefined(offset)&&(offsetTicks=this.toTicks(offset)),this._clock.start(time,offsetTicks),this}stop(time){return this._clock.stop(time),this}pause(time){return this._clock.pause(time),this}toggle(time){return time=this.toSeconds(time),this._clock.getStateAtTime(time)!=="started"?this.start(time):this.stop(time),this}get timeSignature(){return this._timeSignature}set timeSignature(timeSig){isArray2(timeSig)&&(timeSig=timeSig[0]/timeSig[1]*4),this._timeSignature=timeSig}get loopStart(){return new TimeClass(this.context,this._loopStart,"i").toSeconds()}set loopStart(startPosition){this._loopStart=this.toTicks(startPosition)}get loopEnd(){return new TimeClass(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(endPosition){this._loopEnd=this.toTicks(endPosition)}get loop(){return this._loop.get(this.now())}set loop(loop){this._loop.set(loop,this.now())}setLoopPoints(startPosition,endPosition){return this.loopStart=startPosition,this.loopEnd=endPosition,this}get swing(){return this._swingAmount}set swing(amount){this._swingAmount=amount}get swingSubdivision(){return new TicksClass(this.context,this._swingTicks).toNotation()}set swingSubdivision(subdivision){this._swingTicks=this.toTicks(subdivision)}get position(){let now2=this.now(),ticks=this._clock.getTicksAtTime(now2);return new TicksClass(this.context,ticks).toBarsBeatsSixteenths()}set position(progress){let ticks=this.toTicks(progress);this.ticks=ticks}get seconds(){return this._clock.seconds}set seconds(s){let now2=this.now(),ticks=this._clock.frequency.timeToTicks(s,now2);this.ticks=ticks}get progress(){if(this.loop){let now2=this.now();return(this._clock.getTicksAtTime(now2)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){let now2=this.now();if(this.state==="started"){let ticks=this._clock.getTicksAtTime(now2),remainingTick=this._clock.frequency.getDurationOfTicks(Math.ceil(ticks)-ticks,now2),time=now2+remainingTick;this.emit("stop",time),this._clock.setTicksAtTime(t,time),this.emit("start",time,this._clock.getSecondsAtTime(time))}else this._clock.setTicksAtTime(t,now2)}}getTicksAtTime(time){return Math.round(this._clock.getTicksAtTime(time))}getSecondsAtTime(time){return this._clock.getSecondsAtTime(time)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(ppq){this._clock.frequency.multiplier=ppq}nextSubdivision(subdivision){if(subdivision=this.toTicks(subdivision),this.state!=="started")return 0;{let now2=this.now(),transportPos=this.getTicksAtTime(now2),remainingTicks=subdivision-transportPos%subdivision;return this._clock.nextTickTime(remainingTicks,now2)}}syncSignal(signal,ratio){if(!ratio){let now2=this.now();if(signal.getValueAtTime(now2)!==0){let bpm=this.bpm.getValueAtTime(now2),computedFreq=1/(60/bpm/this.PPQ);ratio=signal.getValueAtTime(now2)/computedFreq}else ratio=0}let ratioSignal=new Gain(ratio);return this.bpm.connect(ratioSignal),ratioSignal.connect(signal._param),this._syncedSignals.push({initial:signal.value,ratio:ratioSignal,signal}),signal.value=0,this}unsyncSignal(signal){for(let i=this._syncedSignals.length-1;i>=0;i--){let syncedSignal=this._syncedSignals[i];syncedSignal.signal===signal&&(syncedSignal.ratio.dispose(),syncedSignal.signal.value=syncedSignal.initial,this._syncedSignals.splice(i,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),writable(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}};Emitter.mixin(Transport);onContextInit(context4=>{context4.transport=new Transport({context:context4})});onContextClose(context4=>{context4.transport.dispose()});var Source=class extends ToneAudioNode{constructor(options){super(options);this.input=void 0,this._state=new StateTimeline("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=noOp,this._syncedStop=noOp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Volume({context:this.context,mute:options.mute,volume:options.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.onstop=options.onstop}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,onstop:noOp,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(mute){this._volume.mute=mute}_clampToCurrentTime(time){return this._synced?time:Math.max(time,this.context.currentTime)}start(time,offset,duration){let computedTime=isUndef(time)&&this._synced?this.context.transport.seconds:this.toSeconds(time);if(computedTime=this._clampToCurrentTime(computedTime),!this._synced&&this._state.getValueAtTime(computedTime)==="started")assert(GT(computedTime,this._state.get(computedTime).time),"Start time must be strictly greater than previous start time"),this._state.cancel(computedTime),this._state.setStateAtTime("started",computedTime),this.log("restart",computedTime),this.restart(computedTime,offset,duration);else if(this.log("start",computedTime),this._state.setStateAtTime("started",computedTime),this._synced){let event=this._state.get(computedTime);event&&(event.offset=this.toSeconds(defaultArg(offset,0)),event.duration=duration?this.toSeconds(duration):void 0);let sched=this.context.transport.schedule(t=>{this._start(t,offset,duration)},computedTime);this._scheduled.push(sched),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>computedTime&&this._syncedStart(this.now(),this.context.transport.seconds)}else assertContextRunning(this.context),this._start(computedTime,offset,duration);return this}stop(time){let computedTime=isUndef(time)&&this._synced?this.context.transport.seconds:this.toSeconds(time);if(computedTime=this._clampToCurrentTime(computedTime),this._state.getValueAtTime(computedTime)==="started"||isDefined(this._state.getNextState("started",computedTime))){if(this.log("stop",computedTime),!this._synced)this._stop(computedTime);else{let sched=this.context.transport.schedule(this._stop.bind(this),computedTime);this._scheduled.push(sched)}this._state.cancel(computedTime),this._state.setStateAtTime("stopped",computedTime)}return this}restart(time,offset,duration){return time=this.toSeconds(time),this._state.getValueAtTime(time)==="started"&&(this._state.cancel(time),this._restart(time,offset,duration)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(time,offset)=>{if(offset>0){let stateEvent=this._state.get(offset);if(stateEvent&&stateEvent.state==="started"&&stateEvent.time!==offset){let startOffset=offset-this.toSeconds(stateEvent.time),duration;stateEvent.duration&&(duration=this.toSeconds(stateEvent.duration)-startOffset),this._start(time,this.toSeconds(stateEvent.offset)+startOffset,duration)}}},this._syncedStop=time=>{let seconds=this.context.transport.getSecondsAtTime(Math.max(time-this.sampleTime,0));this._state.getValueAtTime(seconds)==="started"&&this._stop(time)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(id=>this.context.transport.clear(id)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=noOp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}};var ToneBufferSource=class extends OneShotSource{constructor(){super(optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]));this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let options=optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]);connect(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Param({context:this.context,param:this._source.playbackRate,units:"positive",value:options.playbackRate}),this.loop=options.loop,this.loopStart=options.loopStart,this.loopEnd=options.loopEnd,this._buffer=new ToneAudioBuffer(options.url,options.onload,options.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{url:new ToneAudioBuffer,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(time,offset,duration,gain=1){assert(this.buffer.loaded,"buffer is either not set or not loaded");let computedTime=this.toSeconds(time);this._startGain(computedTime,gain),this.loop?offset=defaultArg(offset,this.loopStart):offset=defaultArg(offset,0);let computedOffset=Math.max(this.toSeconds(offset),0);if(this.loop){let loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,loopStart=this.toSeconds(this.loopStart),loopDuration=loopEnd-loopStart;GTE(computedOffset,loopEnd)&&(computedOffset=(computedOffset-loopStart)%loopDuration+loopStart),EQ(computedOffset,this.buffer.duration)&&(computedOffset=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LT(computedOffset,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(computedTime,computedOffset)),isDefined(duration)){let computedDur=this.toSeconds(duration);computedDur=Math.max(computedDur,0),this.stop(computedTime+computedDur)}return this}_stopSource(time){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(time)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(loopStart){this._source.loopStart=this.toSeconds(loopStart)}get loopEnd(){return this._source.loopEnd}set loopEnd(loopEnd){this._source.loopEnd=this.toSeconds(loopEnd)}get buffer(){return this._buffer}set buffer(buffer){this._buffer.set(buffer)}get loop(){return this._source.loop}set loop(loop){this._source.loop=loop,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}};var Noise=class extends Source{constructor(){super(optionsFromArguments(Noise.getDefaults(),arguments,["type"]));this.name="Noise",this._source=null;let options=optionsFromArguments(Noise.getDefaults(),arguments,["type"]);this._playbackRate=options.playbackRate,this.type=options.type,this._fadeIn=options.fadeIn,this._fadeOut=options.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(type){if(assert(type in _noiseBuffers,"Noise: invalid type: "+type),this._type!==type&&(this._type=type,this.state==="started")){let now2=this.now();this._stop(now2),this._start(now2)}}get playbackRate(){return this._playbackRate}set playbackRate(rate){this._playbackRate=rate,this._source&&(this._source.playbackRate.value=rate)}_start(time){let buffer=_noiseBuffers[this._type];this._source=new ToneBufferSource({url:buffer,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(time),Math.random()*(buffer.duration-.001))}_stop(time){this._source&&(this._source.stop(this.toSeconds(time)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(time){this._fadeIn=time,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(time){this._fadeOut=time,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(time){this._stop(time),this._start(time)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}},BUFFER_LENGTH=44100*5,NUM_CHANNELS=2,_noiseCache={brown:null,pink:null,white:null},_noiseBuffers={get brown(){if(!_noiseCache.brown){let buffer=[];for(let channelNum=0;channelNum<NUM_CHANNELS;channelNum++){let channel=new Float32Array(BUFFER_LENGTH);buffer[channelNum]=channel;let lastOut=0;for(let i=0;i<BUFFER_LENGTH;i++){let white2=Math.random()*2-1;channel[i]=(lastOut+.02*white2)/1.02,lastOut=channel[i],channel[i]*=3.5}}_noiseCache.brown=new ToneAudioBuffer().fromArray(buffer)}return _noiseCache.brown},get pink(){if(!_noiseCache.pink){let buffer=[];for(let channelNum=0;channelNum<NUM_CHANNELS;channelNum++){let channel=new Float32Array(BUFFER_LENGTH);buffer[channelNum]=channel;let b0,b1,b2,b3,b4,b5,b6;b0=b1=b2=b3=b4=b5=b6=0;for(let i=0;i<BUFFER_LENGTH;i++){let white2=Math.random()*2-1;b0=.99886*b0+white2*.0555179,b1=.99332*b1+white2*.0750759,b2=.969*b2+white2*.153852,b3=.8665*b3+white2*.3104856,b4=.55*b4+white2*.5329522,b5=-.7616*b5-white2*.016898,channel[i]=b0+b1+b2+b3+b4+b5+b6+white2*.5362,channel[i]*=.11,b6=white2*.115926}}_noiseCache.pink=new ToneAudioBuffer().fromArray(buffer)}return _noiseCache.pink},get white(){if(!_noiseCache.white){let buffer=[];for(let channelNum=0;channelNum<NUM_CHANNELS;channelNum++){let channel=new Float32Array(BUFFER_LENGTH);buffer[channelNum]=channel;for(let i=0;i<BUFFER_LENGTH;i++)channel[i]=Math.random()*2-1}_noiseCache.white=new ToneAudioBuffer().fromArray(buffer)}return _noiseCache.white}};var UserMedia=class extends ToneAudioNode{constructor(){super(optionsFromArguments(UserMedia.getDefaults(),arguments,["volume"]));this.name="UserMedia";let options=optionsFromArguments(UserMedia.getDefaults(),arguments,["volume"]);this._volume=this.output=new Volume({context:this.context,volume:options.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.mute=options.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}open(labelOrId){return __awaiter2(this,void 0,void 0,function*(){assert(UserMedia.supported,"UserMedia is not supported"),this.state==="started"&&this.close();let devices=yield UserMedia.enumerateDevices();isNumber(labelOrId)?this._device=devices[labelOrId]:(this._device=devices.find(device=>device.label===labelOrId||device.deviceId===labelOrId),!this._device&&devices.length>0&&(this._device=devices[0]),assert(isDefined(this._device),`No matching device ${labelOrId}`));let constraints={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(constraints.audio.deviceId=this._device.deviceId);let stream=yield navigator.mediaDevices.getUserMedia(constraints);if(!this._stream){this._stream=stream;let mediaStreamNode=this.context.createMediaStreamSource(stream);connect(mediaStreamNode,this.output),this._mediaStream=mediaStreamNode}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(track=>{track.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return __awaiter2(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(device=>device.kind==="audioinput")})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){if(this._device)return this._device.deviceId}get groupId(){if(this._device)return this._device.groupId}get label(){if(this._device)return this._device.label}get mute(){return this._volume.mute}set mute(mute){this._volume.mute=mute}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return isDefined(navigator.mediaDevices)&&isDefined(navigator.mediaDevices.getUserMedia)}};function generateWaveform(instance,length){return __awaiter2(this,void 0,void 0,function*(){let duration=length/instance.context.sampleRate,context4=new OfflineContext(1,duration,instance.context.sampleRate);return new instance.constructor(Object.assign(instance.get(),{frequency:2/duration,detune:0,context:context4})).toDestination().start(0),(yield context4.render()).getChannelData(0)})}var ToneOscillatorNode=class extends OneShotSource{constructor(){super(optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]));this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let options=optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]);connect(this._oscillator,this._gainNode),this.type=options.type,this.frequency=new Param({context:this.context,param:this._oscillator.frequency,units:"frequency",value:options.frequency}),this.detune=new Param({context:this.context,param:this._oscillator.detune,units:"cents",value:options.detune}),readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(time){let computedTime=this.toSeconds(time);return this.log("start",computedTime),this._startGain(computedTime),this._oscillator.start(computedTime),this}_stopSource(time){this._oscillator.stop(time)}setPeriodicWave(periodicWave){return this._oscillator.setPeriodicWave(periodicWave),this}get type(){return this._oscillator.type}set type(type){this._oscillator.type=type}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}};var Oscillator=class extends Source{constructor(){super(optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]));this.name="Oscillator",this._oscillator=null;let options=optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal2({context:this.context,units:"frequency",value:options.frequency}),readOnly(this,"frequency"),this.detune=new Signal2({context:this.context,units:"cents",value:options.detune}),readOnly(this,"detune"),this._partials=options.partials,this._partialCount=options.partialCount,this._type=options.type,options.partialCount&&options.type!=="custom"&&(this._type=this.baseType+options.partialCount.toString()),this.phase=options.phase}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(time){let computedTime=this.toSeconds(time),oscillator=new ToneOscillatorNode({context:this.context,onended:()=>this.onstop(this)});this._oscillator=oscillator,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(computedTime)}_stop(time){let computedTime=this.toSeconds(time);this._oscillator&&this._oscillator.stop(computedTime)}_restart(time){let computedTime=this.toSeconds(time);return this.log("restart",computedTime),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(computedTime),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Oscillator._periodicWaveCache.find(description=>description.phase===this._phase&&deepEquals(description.partials,this._partials));{let oscProps=Oscillator._periodicWaveCache.find(description=>description.type===this._type&&description.phase===this._phase);return this._partialCount=oscProps?oscProps.partialCount:this._partialCount,oscProps}}get type(){return this._type}set type(type){this._type=type;let isBasicType=["sine","square","sawtooth","triangle"].indexOf(type)!==-1;if(this._phase===0&&isBasicType)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=type);else{let cache2=this._getCachedPeriodicWave();if(isDefined(cache2)){let{partials,wave}=cache2;this._wave=wave,this._partials=partials,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{let[real,imag]=this._getRealImaginary(type,this._phase),periodicWave=this.context.createPeriodicWave(real,imag);this._wave=periodicWave,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Oscillator._periodicWaveCache.push({imag,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real,type:this._type,wave:this._wave}),Oscillator._periodicWaveCache.length>100&&Oscillator._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(baseType){this.partialCount&&this._type!=="custom"&&baseType!=="custom"?this.type=baseType+this.partialCount:this.type=baseType}get partialCount(){return this._partialCount}set partialCount(p){assertRange(p,0);let type=this._type,partial=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(partial&&(type=partial[1]),this._type!=="custom")p===0?this.type=type:this.type=type+p.toString();else{let fullPartials=new Float32Array(p);this._partials.forEach((v,i)=>fullPartials[i]=v),this._partials=Array.from(fullPartials),this.type=this._type}}_getRealImaginary(type,phase){let periodicWaveSize=4096/2,real=new Float32Array(periodicWaveSize),imag=new Float32Array(periodicWaveSize),partialCount=1;if(type==="custom"){if(partialCount=this._partials.length+1,this._partialCount=this._partials.length,periodicWaveSize=partialCount,this._partials.length===0)return[real,imag]}else{let partial=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(type);partial?(partialCount=parseInt(partial[2],10)+1,this._partialCount=parseInt(partial[2],10),type=partial[1],partialCount=Math.max(partialCount,2),periodicWaveSize=partialCount):this._partialCount=0,this._partials=[]}for(let n=1;n<periodicWaveSize;++n){let piFactor=2/(n*Math.PI),b;switch(type){case"sine":b=n<=partialCount?1:0,this._partials[n-1]=b;break;case"square":b=n&1?2*piFactor:0,this._partials[n-1]=b;break;case"sawtooth":b=piFactor*(n&1?1:-1),this._partials[n-1]=b;break;case"triangle":n&1?b=2*(piFactor*piFactor)*(n-1>>1&1?-1:1):b=0,this._partials[n-1]=b;break;case"custom":b=this._partials[n-1];break;default:throw new TypeError("Oscillator: invalid type: "+type)}b!==0?(real[n]=-b*Math.sin(phase*n),imag[n]=b*Math.cos(phase*n)):(real[n]=0,imag[n]=0)}return[real,imag]}_inverseFFT(real,imag,phase){let sum2=0,len2=real.length;for(let i=0;i<len2;i++)sum2+=real[i]*Math.cos(i*phase)+imag[i]*Math.sin(i*phase);return sum2}getInitialValue(){let[real,imag]=this._getRealImaginary(this._type,0),maxValue=0,twoPi=Math.PI*2,testPositions=32;for(let i=0;i<testPositions;i++)maxValue=Math.max(this._inverseFFT(real,imag,i/testPositions*twoPi),maxValue);return clamp(-this._inverseFFT(real,imag,this._phase)/maxValue,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(partials){this._partials=partials,this._partialCount=this._partials.length,partials.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(phase){this._phase=phase*Math.PI/180,this.type=this._type}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}};Oscillator._periodicWaveCache=[];var SignalOperator=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(SignalOperator.getDefaults(),arguments,["context"])))}connect(destination,outputNum=0,inputNum=0){return connectSignal(this,destination,outputNum,inputNum),this}};var WaveShaper=class extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"])));this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let options=optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]);isArray2(options.mapping)||options.mapping instanceof Float32Array?this.curve=Float32Array.from(options.mapping):isFunction(options.mapping)&&this.setMap(options.mapping,options.length)}static getDefaults(){return Object.assign(Signal2.getDefaults(),{length:1024})}setMap(mapping,length=1024){let array=new Float32Array(length);for(let i=0,len2=length;i<len2;i++){let normalized=i/(len2-1)*2-1;array[i]=mapping(normalized,i)}return this.curve=array,this}get curve(){return this._shaper.curve}set curve(mapping){this._shaper.curve=mapping}get oversample(){return this._shaper.oversample}set oversample(oversampling){let isOverSampleType=["none","2x","4x"].some(str=>str.includes(oversampling));assert(isOverSampleType,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=oversampling}dispose(){return super.dispose(),this._shaper.disconnect(),this}};var AudioToGain=class extends SignalOperator{constructor(){super(...arguments);this.name="AudioToGain",this._norm=new WaveShaper({context:this.context,mapping:x=>(x+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}};var Multiply=class extends Signal2{constructor(){super(Object.assign(optionsFromArguments(Multiply.getDefaults(),arguments,["value"])));this.name="Multiply",this.override=!1;let options=optionsFromArguments(Multiply.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Gain({context:this.context,minValue:options.minValue,maxValue:options.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(options.value,0)}static getDefaults(){return Object.assign(Signal2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}};var AMOscillator=class extends Source{constructor(){super(optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]));this.name="AMOscillator",this._modulationScale=new AudioToGain({context:this.context}),this._modulationNode=new Gain({context:this.context});let options=optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:options.detune,frequency:options.frequency,onstop:()=>this.onstop(this),phase:options.phase,type:options.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Oscillator({context:this.context,phase:options.phase,type:options.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:options.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),readOnly(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(time){this._modulator.start(time),this._carrier.start(time)}_stop(time){this._modulator.stop(time),this._carrier.stop(time)}_restart(time){this._modulator.restart(time),this._carrier.restart(time)}get type(){return this._carrier.type}set type(type){this._carrier.type=type}get baseType(){return this._carrier.baseType}set baseType(baseType){this._carrier.baseType=baseType}get partialCount(){return this._carrier.partialCount}set partialCount(partialCount){this._carrier.partialCount=partialCount}get modulationType(){return this._modulator.type}set modulationType(type){this._modulator.type=type}get phase(){return this._carrier.phase}set phase(phase){this._carrier.phase=phase,this._modulator.phase=phase}get partials(){return this._carrier.partials}set partials(partials){this._carrier.partials=partials}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}};var FMOscillator=class extends Source{constructor(){super(optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]));this.name="FMOscillator",this._modulationNode=new Gain({context:this.context,gain:0});let options=optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:options.detune,frequency:0,onstop:()=>this.onstop(this),phase:options.phase,type:options.type}),this.detune=this._carrier.detune,this.frequency=new Signal2({context:this.context,units:"frequency",value:options.frequency}),this._modulator=new Oscillator({context:this.context,phase:options.phase,type:options.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:options.harmonicity}),this.modulationIndex=new Multiply({context:this.context,units:"positive",value:options.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),readOnly(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(time){this._modulator.start(time),this._carrier.start(time)}_stop(time){this._modulator.stop(time),this._carrier.stop(time)}_restart(time){return this._modulator.restart(time),this._carrier.restart(time),this}get type(){return this._carrier.type}set type(type){this._carrier.type=type}get baseType(){return this._carrier.baseType}set baseType(baseType){this._carrier.baseType=baseType}get partialCount(){return this._carrier.partialCount}set partialCount(partialCount){this._carrier.partialCount=partialCount}get modulationType(){return this._modulator.type}set modulationType(type){this._modulator.type=type}get phase(){return this._carrier.phase}set phase(phase){this._carrier.phase=phase,this._modulator.phase=phase}get partials(){return this._carrier.partials}set partials(partials){this._carrier.partials=partials}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}};var PulseOscillator=class extends Source{constructor(){super(optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]));this.name="PulseOscillator",this._widthGate=new Gain({context:this.context,gain:0}),this._thresh=new WaveShaper({context:this.context,mapping:val=>val<=0?-1:1});let options=optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]);this.width=new Signal2({context:this.context,units:"audioRange",value:options.width}),this._triangle=new Oscillator({context:this.context,detune:options.detune,frequency:options.frequency,onstop:()=>this.onstop(this),phase:options.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),readOnly(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(time){time=this.toSeconds(time),this._triangle.start(time),this._widthGate.gain.setValueAtTime(1,time)}_stop(time){time=this.toSeconds(time),this._triangle.stop(time),this._widthGate.gain.cancelScheduledValues(time),this._widthGate.gain.setValueAtTime(0,time)}_restart(time){this._triangle.restart(time),this._widthGate.gain.cancelScheduledValues(time),this._widthGate.gain.setValueAtTime(1,time)}get phase(){return this._triangle.phase}set phase(phase){this._triangle.phase=phase}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(type){this._triangle.type=type}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}};var FatOscillator=class extends Source{constructor(){super(optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]));this.name="FatOscillator",this._oscillators=[];let options=optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Signal2({context:this.context,units:"frequency",value:options.frequency}),this.detune=new Signal2({context:this.context,units:"cents",value:options.detune}),this._spread=options.spread,this._type=options.type,this._phase=options.phase,this._partials=options.partials,this._partialCount=options.partialCount,this.count=options.count,readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(time){time=this.toSeconds(time),this._forEach(osc=>osc.start(time))}_stop(time){time=this.toSeconds(time),this._forEach(osc=>osc.stop(time))}_restart(time){this._forEach(osc=>osc.restart(time))}_forEach(iterator){for(let i=0;i<this._oscillators.length;i++)iterator(this._oscillators[i],i)}get type(){return this._type}set type(type){this._type=type,this._forEach(osc=>osc.type=type)}get spread(){return this._spread}set spread(spread){if(this._spread=spread,this._oscillators.length>1){let start2=-spread/2,step=spread/(this._oscillators.length-1);this._forEach((osc,i)=>osc.detune.value=start2+step*i)}}get count(){return this._oscillators.length}set count(count2){if(assertRange(count2,1),this._oscillators.length!==count2){this._forEach(osc=>osc.dispose()),this._oscillators=[];for(let i=0;i<count2;i++){let osc=new Oscillator({context:this.context,volume:-6-count2*1.1,type:this._type,phase:this._phase+i/count2*360,partialCount:this._partialCount,onstop:i===0?()=>this.onstop(this):noOp});this.type==="custom"&&(osc.partials=this._partials),this.frequency.connect(osc.frequency),this.detune.connect(osc.detune),osc.detune.overridden=!1,osc.connect(this.output),this._oscillators[i]=osc}this.spread=this._spread,this.state==="started"&&this._forEach(osc=>osc.start())}}get phase(){return this._phase}set phase(phase){this._phase=phase,this._forEach((osc,i)=>osc.phase=this._phase+i/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(baseType){this._forEach(osc=>osc.baseType=baseType),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(partials){this._partials=partials,this._partialCount=this._partials.length,partials.length&&(this._type="custom",this._forEach(osc=>osc.partials=partials))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(partialCount){this._partialCount=partialCount,this._forEach(osc=>osc.partialCount=partialCount),this._type=this._oscillators[0].type}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(osc=>osc.dispose()),this}};var PWMOscillator=class extends Source{constructor(){super(optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]));this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Multiply({context:this.context,value:2});let options=optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new PulseOscillator({context:this.context,frequency:options.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Oscillator({context:this.context,detune:options.detune,frequency:options.frequency,onstop:()=>this.onstop(this),phase:options.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),readOnly(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(time){time=this.toSeconds(time),this._modulator.start(time),this._pulse.start(time)}_stop(time){time=this.toSeconds(time),this._modulator.stop(time),this._pulse.stop(time)}_restart(time){this._modulator.restart(time),this._pulse.restart(time)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(phase){this._modulator.phase=phase}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}};var OmniOscillatorSourceMap={am:AMOscillator,fat:FatOscillator,fm:FMOscillator,oscillator:Oscillator,pulse:PulseOscillator,pwm:PWMOscillator},OmniOscillator=class extends Source{constructor(){super(optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]));this.name="OmniOscillator";let options=optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal2({context:this.context,units:"frequency",value:options.frequency}),this.detune=new Signal2({context:this.context,units:"cents",value:options.detune}),readOnly(this,["frequency","detune"]),this.set(options)}static getDefaults(){return Object.assign(Oscillator.getDefaults(),FMOscillator.getDefaults(),AMOscillator.getDefaults(),FatOscillator.getDefaults(),PulseOscillator.getDefaults(),PWMOscillator.getDefaults())}_start(time){this._oscillator.start(time)}_stop(time){this._oscillator.stop(time)}_restart(time){return this._oscillator.restart(time),this}get type(){let prefix="";return["am","fm","fat"].some(p=>this._sourceType===p)&&(prefix=this._sourceType),prefix+this._oscillator.type}set type(type){type.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=type.substr(2)):type.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=type.substr(2)):type.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=type.substr(3)):type==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):type==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=type)}get partials(){return this._oscillator.partials}set partials(partials){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=partials)}get partialCount(){return this._oscillator.partialCount}set partialCount(partialCount){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=partialCount)}set(props){return Reflect.has(props,"type")&&props.type&&(this.type=props.type),super.set(props),this}_createNewOscillator(oscType){if(oscType!==this._sourceType){this._sourceType=oscType;let OscConstructor=OmniOscillatorSourceMap[oscType],now2=this.now();if(this._oscillator){let oldOsc=this._oscillator;oldOsc.stop(now2),this.context.setTimeout(()=>oldOsc.dispose(),this.blockTime)}this._oscillator=new OscConstructor({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(now2)}}get phase(){return this._oscillator.phase}set phase(phase){this._oscillator.phase=phase}get sourceType(){return this._sourceType}set sourceType(sType){let baseType="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(baseType=this._oscillator.type),sType==="fm"?this.type="fm"+baseType:sType==="am"?this.type="am"+baseType:sType==="fat"?this.type="fat"+baseType:sType==="oscillator"?this.type=baseType:sType==="pulse"?this.type="pulse":sType==="pwm"&&(this.type="pwm")}_getOscType(osc,sourceType){return osc instanceof OmniOscillatorSourceMap[sourceType]}get baseType(){return this._oscillator.baseType}set baseType(baseType){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&baseType!=="pulse"&&baseType!=="pwm"&&(this._oscillator.baseType=baseType)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(count2){this._getOscType(this._oscillator,"fat")&&isNumber(count2)&&(this._oscillator.count=count2)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(spread){this._getOscType(this._oscillator,"fat")&&isNumber(spread)&&(this._oscillator.spread=spread)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(mType){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&isString(mType)&&(this._oscillator.modulationType=mType)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){return generateWaveform(this,length)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}};var Add=class extends Signal2{constructor(){super(Object.assign(optionsFromArguments(Add.getDefaults(),arguments,["value"])));this.override=!1,this.name="Add",this._sum=new Gain({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,connectSeries(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Signal2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}};var Scale=class extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(Scale.getDefaults(),arguments,["min","max"])));this.name="Scale";let options=optionsFromArguments(Scale.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Multiply({context:this.context,value:options.max-options.min}),this._add=this.output=new Add({context:this.context,value:options.min}),this._min=options.min,this._max=options.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(SignalOperator.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(min){this._min=min,this._setRange()}get max(){return this._max}set max(max){this._max=max,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}};var Zero=class extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(Zero.getDefaults(),arguments)));this.name="Zero",this._gain=new Gain({context:this.context}),this.output=this._gain,this.input=void 0,connect(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),disconnect(this.context.getConstant(0),this._gain),this}};var LFO=class extends ToneAudioNode{constructor(){super(optionsFromArguments(LFO.getDefaults(),arguments,["frequency","min","max"]));this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Param.prototype._fromType,this._toType=Param.prototype._toType,this._is=Param.prototype._is,this._clampValue=Param.prototype._clampValue;let options=optionsFromArguments(LFO.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new Oscillator(options),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Gain({context:this.context,gain:options.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Signal2({context:this.context,units:"audioRange",value:0}),this._zeros=new Zero({context:this.context}),this._a2g=new AudioToGain({context:this.context}),this._scaler=this.output=new Scale({context:this.context,max:options.max,min:options.min}),this.units=options.units,this.min=options.min,this.max=options.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),readOnly(this,["amplitude","frequency"]),this.phase=options.phase}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(time){return time=this.toSeconds(time),this._stoppedSignal.setValueAtTime(0,time),this._oscillator.start(time),this}stop(time){return time=this.toSeconds(time),this._stoppedSignal.setValueAtTime(this._stoppedValue,time),this._oscillator.stop(time),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(min){min=this._fromType(min),this._scaler.min=min}get max(){return this._toType(this._scaler.max)}set max(max){max=this._fromType(max),this._scaler.max=max}get type(){return this._oscillator.type}set type(type){this._oscillator.type=type,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(partials){this._oscillator.partials=partials,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(phase){this._oscillator.phase=phase,this._setStoppedValue()}get units(){return this._units}set units(val){let currentMin=this.min,currentMax=this.max;this._units=val,this.min=currentMin,this.max=currentMax}get state(){return this._oscillator.state}connect(node,outputNum,inputNum){return(node instanceof Param||node instanceof Signal2)&&(this.convert=node.convert,this.units=node.units),connectSignal(this,node,outputNum,inputNum),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}};function range2(min,max=Infinity){let valueMap=new WeakMap;return function(target,propertyKey){Reflect.defineProperty(target,propertyKey,{configurable:!0,enumerable:!0,get:function(){return valueMap.get(this)},set:function(newValue){assertRange(newValue,min,max),valueMap.set(this,newValue)}})}}function timeRange(min,max=Infinity){let valueMap=new WeakMap;return function(target,propertyKey){Reflect.defineProperty(target,propertyKey,{configurable:!0,enumerable:!0,get:function(){return valueMap.get(this)},set:function(newValue){assertRange(this.toSeconds(newValue),min,max),valueMap.set(this,newValue)}})}}var Player=class extends Source{constructor(){super(optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]));this.name="Player",this._activeSources=new Set;let options=optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer({onload:this._onload.bind(this,options.onload),onerror:options.onerror,reverse:options.reverse,url:options.url}),this.autostart=options.autostart,this._loop=options.loop,this._loopStart=options.loopStart,this._loopEnd=options.loopEnd,this._playbackRate=options.playbackRate,this.fadeIn=options.fadeIn,this.fadeOut=options.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1,reverse:!1})}load(url3){return __awaiter2(this,void 0,void 0,function*(){return yield this._buffer.load(url3),this._onload(),this})}_onload(callback=noOp){callback(),this.autostart&&this.start()}_onSourceEnd(source){this.onstop(this),this._activeSources.delete(source),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(time,offset,duration){return super.start(time,offset,duration),this}_start(startTime,offset,duration){this._loop?offset=defaultArg(offset,this._loopStart):offset=defaultArg(offset,0);let computedOffset=this.toSeconds(offset),origDuration=duration;duration=defaultArg(duration,Math.max(this._buffer.duration-computedOffset,0));let computedDuration=this.toSeconds(duration);computedDuration=computedDuration/this._playbackRate,startTime=this.toSeconds(startTime);let source=new ToneBufferSource({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(startTime+computedDuration),this._state.setStateAtTime("stopped",startTime+computedDuration,{implicitEnd:!0})),this._activeSources.add(source),this._loop&&isUndef(origDuration)?source.start(startTime,computedOffset):source.start(startTime,computedOffset,computedDuration-this.toSeconds(this.fadeOut))}_stop(time){let computedTime=this.toSeconds(time);this._activeSources.forEach(source=>source.stop(computedTime))}restart(time,offset,duration){return super.restart(time,offset,duration),this}_restart(time,offset,duration){this._stop(time),this._start(time,offset,duration)}seek(offset,when){let computedTime=this.toSeconds(when);if(this._state.getValueAtTime(computedTime)==="started"){let computedOffset=this.toSeconds(offset);this._stop(computedTime),this._start(computedTime,computedOffset)}return this}setLoopPoints(loopStart,loopEnd){return this.loopStart=loopStart,this.loopEnd=loopEnd,this}get loopStart(){return this._loopStart}set loopStart(loopStart){this._loopStart=loopStart,this.buffer.loaded&&assertRange(this.toSeconds(loopStart),0,this.buffer.duration),this._activeSources.forEach(source=>{source.loopStart=loopStart})}get loopEnd(){return this._loopEnd}set loopEnd(loopEnd){this._loopEnd=loopEnd,this.buffer.loaded&&assertRange(this.toSeconds(loopEnd),0,this.buffer.duration),this._activeSources.forEach(source=>{source.loopEnd=loopEnd})}get buffer(){return this._buffer}set buffer(buffer){this._buffer.set(buffer)}get loop(){return this._loop}set loop(loop){if(this._loop!==loop&&(this._loop=loop,this._activeSources.forEach(source=>{source.loop=loop}),loop)){let stopEvent=this._state.getNextState("stopped",this.now());stopEvent&&this._state.cancel(stopEvent.time)}}get playbackRate(){return this._playbackRate}set playbackRate(rate){this._playbackRate=rate;let now2=this.now(),stopEvent=this._state.getNextState("stopped",now2);stopEvent&&stopEvent.implicitEnd&&(this._state.cancel(stopEvent.time),this._activeSources.forEach(source=>source.cancelStop())),this._activeSources.forEach(source=>{source.playbackRate.setValueAtTime(rate,now2)})}get reverse(){return this._buffer.reverse}set reverse(rev){this._buffer.reverse=rev}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(source=>source.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}};__decorate([timeRange(0)],Player.prototype,"fadeIn",void 0);__decorate([timeRange(0)],Player.prototype,"fadeOut",void 0);var Players=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Players.getDefaults(),arguments,["urls","onload"],"urls"));this.name="Players",this.input=void 0,this._players=new Map;let options=optionsFromArguments(Players.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new Volume({context:this.context,volume:options.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this._buffers=new ToneAudioBuffers({urls:options.urls,onload:options.onload,baseUrl:options.baseUrl,onerror:options.onerror}),this.mute=options.mute,this._fadeIn=options.fadeIn,this._fadeOut=options.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:noOp,onerror:noOp,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(mute){this._volume.mute=mute}get fadeIn(){return this._fadeIn}set fadeIn(fadeIn){this._fadeIn=fadeIn,this._players.forEach(player=>{player.fadeIn=fadeIn})}get fadeOut(){return this._fadeOut}set fadeOut(fadeOut){this._fadeOut=fadeOut,this._players.forEach(player=>{player.fadeOut=fadeOut})}get state(){return Array.from(this._players).some(([_,player])=>player.state==="started")?"started":"stopped"}has(name){return this._buffers.has(name)}player(name){if(assert(this.has(name),`No Player with the name ${name} exists on this object`),!this._players.has(name)){let player=new Player({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(name)}).connect(this.output);this._players.set(name,player)}return this._players.get(name)}get loaded(){return this._buffers.loaded}add(name,url3,callback){return assert(!this._buffers.has(name),"A buffer with that name already exists on this object"),this._buffers.add(name,url3,callback),this}stopAll(time){return this._players.forEach(player=>player.stop(time)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(player=>player.dispose()),this._buffers.dispose(),this}};var GrainPlayer=class extends Source{constructor(){super(optionsFromArguments(GrainPlayer.getDefaults(),arguments,["url","onload"]));this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];let options=optionsFromArguments(GrainPlayer.getDefaults(),arguments,["url","onload"]);this.buffer=new ToneAudioBuffer({onload:options.onload,onerror:options.onerror,reverse:options.reverse,url:options.url}),this._clock=new Clock2({context:this.context,callback:this._tick.bind(this),frequency:1/options.grainSize}),this._playbackRate=options.playbackRate,this._grainSize=options.grainSize,this._overlap=options.overlap,this.detune=options.detune,this.overlap=options.overlap,this.loop=options.loop,this.playbackRate=options.playbackRate,this.grainSize=options.grainSize,this.loopStart=options.loopStart,this.loopEnd=options.loopEnd,this.reverse=options.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Source.getDefaults(),{onload:noOp,onerror:noOp,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(time,offset,duration){offset=defaultArg(offset,0),offset=this.toSeconds(offset),time=this.toSeconds(time);let grainSize=1/this._clock.frequency.getValueAtTime(time);this._clock.start(time,offset/grainSize),duration&&this.stop(time+this.toSeconds(duration))}restart(time,offset,duration){return super.restart(time,offset,duration),this}_restart(time,offset,duration){this._stop(time),this._start(time,offset,duration)}_stop(time){this._clock.stop(time)}_onstop(time){this._activeSources.forEach(source=>{source.fadeOut=0,source.stop(time)}),this.onstop(this)}_tick(time){let ticks=this._clock.getTicksAtTime(time),offset=ticks*this._grainSize;if(this.log("offset",offset),!this.loop&&offset>this.buffer.duration){this.stop(time);return}let fadeIn=offset<this._overlap?0:this._overlap,source=new ToneBufferSource({context:this.context,url:this.buffer,fadeIn,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:intervalToFrequencyRatio(this.detune/100)}).connect(this.output);source.start(time,this._grainSize*ticks),source.stop(time+this._grainSize/this.playbackRate),this._activeSources.push(source),source.onended=()=>{let index3=this._activeSources.indexOf(source);index3!==-1&&this._activeSources.splice(index3,1)}}get playbackRate(){return this._playbackRate}set playbackRate(rate){assertRange(rate,.001),this._playbackRate=rate,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(time){this.buffer.loaded&&assertRange(this.toSeconds(time),0,this.buffer.duration),this._loopStart=this.toSeconds(time)}get loopEnd(){return this._loopEnd}set loopEnd(time){this.buffer.loaded&&assertRange(this.toSeconds(time),0,this.buffer.duration),this._loopEnd=this.toSeconds(time)}get reverse(){return this.buffer.reverse}set reverse(rev){this.buffer.reverse=rev}get grainSize(){return this._grainSize}set grainSize(size){this._grainSize=this.toSeconds(size),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(time){let computedTime=this.toSeconds(time);assertRange(computedTime,0),this._overlap=computedTime}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(source=>source.dispose()),this}};var Abs=class extends SignalOperator{constructor(){super(...arguments);this.name="Abs",this._abs=new WaveShaper({context:this.context,mapping:val=>Math.abs(val)<.001?0:Math.abs(val)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}};var GainToAudio=class extends SignalOperator{constructor(){super(...arguments);this.name="GainToAudio",this._norm=new WaveShaper({context:this.context,mapping:x=>Math.abs(x)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}};var Negate=class extends SignalOperator{constructor(){super(...arguments);this.name="Negate",this._multiply=new Multiply({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}};var Subtract=class extends Signal2{constructor(){super(Object.assign(optionsFromArguments(Subtract.getDefaults(),arguments,["value"])));this.override=!1,this.name="Subtract",this._sum=new Gain({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new Negate({context:this.context}),this.subtrahend=this._param,connectSeries(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(Signal2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}};var GreaterThanZero=class extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(GreaterThanZero.getDefaults(),arguments)));this.name="GreaterThanZero",this._thresh=this.output=new WaveShaper({context:this.context,length:127,mapping:val=>val<=0?0:1}),this._scale=this.input=new Multiply({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}};var GreaterThan=class extends Signal2{constructor(){super(Object.assign(optionsFromArguments(GreaterThan.getDefaults(),arguments,["value"])));this.name="GreaterThan",this.override=!1;let options=optionsFromArguments(GreaterThan.getDefaults(),arguments,["value"]);this._subtract=this.input=new Subtract({context:this.context,value:options.value}),this._gtz=this.output=new GreaterThanZero({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,readOnly(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(Signal2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}};var Pow=class extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(Pow.getDefaults(),arguments,["value"])));this.name="Pow";let options=optionsFromArguments(Pow.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new WaveShaper({context:this.context,mapping:this._expFunc(options.value),length:8192}),this._exponent=options.value}static getDefaults(){return Object.assign(SignalOperator.getDefaults(),{value:1})}_expFunc(exponent){return val=>Math.pow(Math.abs(val),exponent)}get value(){return this._exponent}set value(exponent){this._exponent=exponent,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}};var ScaleExp=class extends Scale{constructor(){super(Object.assign(optionsFromArguments(ScaleExp.getDefaults(),arguments,["min","max","exponent"])));this.name="ScaleExp";let options=optionsFromArguments(ScaleExp.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new Pow({context:this.context,value:options.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(Scale.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(exp){this._exp.value=exp}dispose(){return super.dispose(),this._exp.dispose(),this}};var SyncedSignal=class extends Signal2{constructor(){super(optionsFromArguments(Signal2.getDefaults(),arguments,["value","units"]));this.name="SyncedSignal",this.override=!1;let options=optionsFromArguments(Signal2.getDefaults(),arguments,["value","units"]);this._lastVal=options.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new ToneConstantSource({context:this.context,offset:options.value,units:options.units}).start(0),this.setValueAtTime(options.value,0)}_onTick(time){let val=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==val&&(this._lastVal=val,this._constantSource.offset.setValueAtTime(val,time))}_anchorValue(time){let val=super.getValueAtTime(this.context.transport.seconds);this._lastVal=val,this._constantSource.offset.cancelAndHoldAtTime(time),this._constantSource.offset.setValueAtTime(val,time)}getValueAtTime(time){let computedTime=new TransportTimeClass(this.context,time).toSeconds();return super.getValueAtTime(computedTime)}setValueAtTime(value,time){let computedTime=new TransportTimeClass(this.context,time).toSeconds();return super.setValueAtTime(value,computedTime),this}linearRampToValueAtTime(value,time){let computedTime=new TransportTimeClass(this.context,time).toSeconds();return super.linearRampToValueAtTime(value,computedTime),this}exponentialRampToValueAtTime(value,time){let computedTime=new TransportTimeClass(this.context,time).toSeconds();return super.exponentialRampToValueAtTime(value,computedTime),this}setTargetAtTime(value,startTime,timeConstant){let computedTime=new TransportTimeClass(this.context,startTime).toSeconds();return super.setTargetAtTime(value,computedTime,timeConstant),this}cancelScheduledValues(startTime){let computedTime=new TransportTimeClass(this.context,startTime).toSeconds();return super.cancelScheduledValues(computedTime),this}setValueCurveAtTime(values,startTime,duration,scaling){let computedTime=new TransportTimeClass(this.context,startTime).toSeconds();return duration=this.toSeconds(duration),super.setValueCurveAtTime(values,computedTime,duration,scaling),this}cancelAndHoldAtTime(time){let computedTime=new TransportTimeClass(this.context,time).toSeconds();return super.cancelAndHoldAtTime(computedTime),this}setRampPoint(time){let computedTime=new TransportTimeClass(this.context,time).toSeconds();return super.setRampPoint(computedTime),this}exponentialRampTo(value,rampTime,startTime){let computedTime=new TransportTimeClass(this.context,startTime).toSeconds();return super.exponentialRampTo(value,rampTime,computedTime),this}linearRampTo(value,rampTime,startTime){let computedTime=new TransportTimeClass(this.context,startTime).toSeconds();return super.linearRampTo(value,rampTime,computedTime),this}targetRampTo(value,rampTime,startTime){let computedTime=new TransportTimeClass(this.context,startTime).toSeconds();return super.targetRampTo(value,rampTime,computedTime),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}};var Envelope=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]));this.name="Envelope",this._sig=new Signal2({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let options=optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=options.attack,this.decay=options.decay,this.sustain=options.sustain,this.release=options.release,this.attackCurve=options.attackCurve,this.releaseCurve=options.releaseCurve,this.decayCurve=options.decayCurve}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(curve,direction){if(isString(curve))return curve;{let curveName;for(curveName in EnvelopeCurves)if(EnvelopeCurves[curveName][direction]===curve)return curveName;return curve}}_setCurve(name,direction,curve){if(isString(curve)&&Reflect.has(EnvelopeCurves,curve)){let curveDef=EnvelopeCurves[curve];isObject(curveDef)?name!=="_decayCurve"&&(this[name]=curveDef[direction]):this[name]=curveDef}else if(isArray2(curve)&&name!=="_decayCurve")this[name]=curve;else throw new Error("Envelope: invalid curve: "+curve)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(curve){this._setCurve("_attackCurve","In",curve)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(curve){this._setCurve("_releaseCurve","Out",curve)}get decayCurve(){return this._decayCurve}set decayCurve(curve){assert(["linear","exponential"].some(c=>c===curve),`Invalid envelope curve: ${curve}`),this._decayCurve=curve}triggerAttack(time,velocity=1){this.log("triggerAttack",time,velocity),time=this.toSeconds(time);let attack=this.toSeconds(this.attack),decay=this.toSeconds(this.decay),currentValue=this.getValueAtTime(time);if(currentValue>0){let attackRate=1/attack;attack=(1-currentValue)/attackRate}if(attack<this.sampleTime)this._sig.cancelScheduledValues(time),this._sig.setValueAtTime(velocity,time);else if(this._attackCurve==="linear")this._sig.linearRampTo(velocity,attack,time);else if(this._attackCurve==="exponential")this._sig.targetRampTo(velocity,attack,time);else{this._sig.cancelAndHoldAtTime(time);let curve=this._attackCurve;for(let i=1;i<curve.length;i++)if(curve[i-1]<=currentValue&&currentValue<=curve[i]){curve=this._attackCurve.slice(i),curve[0]=currentValue;break}this._sig.setValueCurveAtTime(curve,time,attack,velocity)}if(decay&&this.sustain<1){let decayValue=velocity*this.sustain,decayStart=time+attack;this.log("decay",decayStart),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(decayValue,decay+decayStart):this._sig.exponentialApproachValueAtTime(decayValue,decayStart,decay)}return this}triggerRelease(time){this.log("triggerRelease",time),time=this.toSeconds(time);let currentValue=this.getValueAtTime(time);if(currentValue>0){let release=this.toSeconds(this.release);release<this.sampleTime?this._sig.setValueAtTime(0,time):this._releaseCurve==="linear"?this._sig.linearRampTo(0,release,time):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,release,time):(assert(isArray2(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(time),this._sig.setValueCurveAtTime(this._releaseCurve,time,release,currentValue))}return this}getValueAtTime(time){return this._sig.getValueAtTime(time)}triggerAttackRelease(duration,time,velocity=1){return time=this.toSeconds(time),this.triggerAttack(time,velocity),this.triggerRelease(time+this.toSeconds(duration)),this}cancel(after){return this._sig.cancelScheduledValues(this.toSeconds(after)),this}connect(destination,outputNumber=0,inputNumber=0){return connectSignal(this,destination,outputNumber,inputNumber),this}asArray(length=1024){return __awaiter2(this,void 0,void 0,function*(){let duration=length/this.context.sampleRate,context4=new OfflineContext(1,duration,this.context.sampleRate),attackPortion=this.toSeconds(this.attack)+this.toSeconds(this.decay),envelopeDuration=attackPortion+this.toSeconds(this.release),sustainTime=envelopeDuration*.1,totalDuration=envelopeDuration+sustainTime,clone=new this.constructor(Object.assign(this.get(),{attack:duration*this.toSeconds(this.attack)/totalDuration,decay:duration*this.toSeconds(this.decay)/totalDuration,release:duration*this.toSeconds(this.release)/totalDuration,context:context4}));return clone._sig.toDestination(),clone.triggerAttackRelease(duration*(attackPortion+sustainTime)/totalDuration,0),(yield context4.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}};__decorate([timeRange(0)],Envelope.prototype,"attack",void 0);__decorate([timeRange(0)],Envelope.prototype,"decay",void 0);__decorate([range2(0,1)],Envelope.prototype,"sustain",void 0);__decorate([timeRange(0)],Envelope.prototype,"release",void 0);var EnvelopeCurves=(()=>{let curveLen=128,i,k,cosineCurve=[];for(i=0;i<curveLen;i++)cosineCurve[i]=Math.sin(i/(curveLen-1)*(Math.PI/2));let rippleCurve=[],rippleCurveFreq=6.4;for(i=0;i<curveLen-1;i++){k=i/(curveLen-1);let sineWave=Math.sin(k*(Math.PI*2)*rippleCurveFreq-Math.PI/2)+1;rippleCurve[i]=sineWave/10+k*.83}rippleCurve[curveLen-1]=1;let stairsCurve=[],steps=5;for(i=0;i<curveLen;i++)stairsCurve[i]=Math.ceil(i/(curveLen-1)*steps)/steps;let sineCurve=[];for(i=0;i<curveLen;i++)k=i/(curveLen-1),sineCurve[i]=.5*(1-Math.cos(Math.PI*k));let bounceCurve=[];for(i=0;i<curveLen;i++){k=i/(curveLen-1);let freq=Math.pow(k,3)*4+.2,val=Math.cos(freq*Math.PI*2*k);bounceCurve[i]=Math.abs(val*(1-k))}function invertCurve(curve){let out=new Array(curve.length);for(let j=0;j<curve.length;j++)out[j]=1-curve[j];return out}function reverseCurve(curve){return curve.slice(0).reverse()}return{bounce:{In:invertCurve(bounceCurve),Out:bounceCurve},cosine:{In:cosineCurve,Out:reverseCurve(cosineCurve)},exponential:"exponential",linear:"linear",ripple:{In:rippleCurve,Out:invertCurve(rippleCurve)},sine:{In:sineCurve,Out:invertCurve(sineCurve)},step:{In:stairsCurve,Out:invertCurve(stairsCurve)}}})();var Instrument=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Instrument.getDefaults(),arguments));this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;let options=optionsFromArguments(Instrument.getDefaults(),arguments);this._volume=this.output=new Volume({context:this.context,volume:options.volume}),this.volume=this._volume.volume,readOnly(this,"volume")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let changed=!1;return this._synced||(this._synced=!0,changed=!0),changed}_syncMethod(method,timePosition){let originalMethod=this["_original_"+method]=this[method];this[method]=(...args)=>{let time=args[timePosition],id=this.context.transport.schedule(t=>{args[timePosition]=t,originalMethod.apply(this,args)},time);this._scheduledEvents.push(id)}}unsync(){return this._scheduledEvents.forEach(id=>this.context.transport.clear(id)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(note,duration,time,velocity){let computedTime=this.toSeconds(time),computedDuration=this.toSeconds(duration);return this.triggerAttack(note,computedTime,velocity),this.triggerRelease(computedTime+computedDuration),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}};var Monophonic=class extends Instrument{constructor(){super(optionsFromArguments(Monophonic.getDefaults(),arguments));let options=optionsFromArguments(Monophonic.getDefaults(),arguments);this.portamento=options.portamento,this.onsilence=options.onsilence}static getDefaults(){return Object.assign(Instrument.getDefaults(),{detune:0,onsilence:noOp,portamento:0})}triggerAttack(note,time,velocity=1){this.log("triggerAttack",note,time,velocity);let seconds=this.toSeconds(time);return this._triggerEnvelopeAttack(seconds,velocity),this.setNote(note,seconds),this}triggerRelease(time){this.log("triggerRelease",time);let seconds=this.toSeconds(time);return this._triggerEnvelopeRelease(seconds),this}setNote(note,time){let computedTime=this.toSeconds(time),computedFrequency=note instanceof FrequencyClass?note.toFrequency():note;if(this.portamento>0&&this.getLevelAtTime(computedTime)>.05){let portTime=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(computedFrequency,portTime,computedTime)}else this.frequency.setValueAtTime(computedFrequency,computedTime);return this}};__decorate([timeRange(0)],Monophonic.prototype,"portamento",void 0);var AmplitudeEnvelope=class extends Envelope{constructor(){super(optionsFromArguments(AmplitudeEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"]));this.name="AmplitudeEnvelope",this._gainNode=new Gain({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}};var Synth=class extends Monophonic{constructor(){super(optionsFromArguments(Synth.getDefaults(),arguments));this.name="Synth";let options=optionsFromArguments(Synth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign({context:this.context,detune:options.detune,onstop:()=>this.onsilence(this)},options.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},options.envelope)),this.oscillator.chain(this.envelope,this.output),readOnly(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(time,velocity){if(this.envelope.triggerAttack(time,velocity),this.oscillator.start(time),this.envelope.sustain===0){let computedAttack=this.toSeconds(this.envelope.attack),computedDecay=this.toSeconds(this.envelope.decay);this.oscillator.stop(time+computedAttack+computedDecay)}}_triggerEnvelopeRelease(time){this.envelope.triggerRelease(time),this.oscillator.stop(time+this.toSeconds(this.envelope.release))}getLevelAtTime(time){return time=this.toSeconds(time),this.envelope.getValueAtTime(time)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}};var ModulationSynth=class extends Monophonic{constructor(){super(optionsFromArguments(ModulationSynth.getDefaults(),arguments));this.name="ModulationSynth";let options=optionsFromArguments(ModulationSynth.getDefaults(),arguments);this._carrier=new Synth({context:this.context,oscillator:options.oscillator,envelope:options.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Synth({context:this.context,oscillator:options.modulation,envelope:options.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Signal2({context:this.context,units:"frequency"}),this.detune=new Signal2({context:this.context,value:options.detune,units:"cents"}),this.harmonicity=new Multiply({context:this.context,value:options.harmonicity,minValue:0}),this._modulationNode=new Gain({context:this.context,gain:0}),readOnly(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{harmonicity:3,oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(time,velocity){this._carrier._triggerEnvelopeAttack(time,velocity),this._modulator._triggerEnvelopeAttack(time,velocity)}_triggerEnvelopeRelease(time){return this._carrier._triggerEnvelopeRelease(time),this._modulator._triggerEnvelopeRelease(time),this}getLevelAtTime(time){return time=this.toSeconds(time),this.envelope.getValueAtTime(time)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}};var AMSynth=class extends ModulationSynth{constructor(){super(optionsFromArguments(AMSynth.getDefaults(),arguments));this.name="AMSynth",this._modulationScale=new AudioToGain({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}};var BiquadFilter=class extends ToneAudioNode{constructor(){super(optionsFromArguments(BiquadFilter.getDefaults(),arguments,["frequency","type"]));this.name="BiquadFilter";let options=optionsFromArguments(BiquadFilter.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Param({context:this.context,units:"number",value:options.Q,param:this._filter.Q}),this.frequency=new Param({context:this.context,units:"frequency",value:options.frequency,param:this._filter.frequency}),this.detune=new Param({context:this.context,units:"cents",value:options.detune,param:this._filter.detune}),this.gain=new Param({context:this.context,units:"decibels",convert:!1,value:options.gain,param:this._filter.gain}),this.type=options.type}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(type){assert(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(type)!==-1,`Invalid filter type: ${type}`),this._filter.type=type}getFrequencyResponse(len2=128){let freqValues=new Float32Array(len2);for(let i=0;i<len2;i++){let freq=Math.pow(i/len2,2)*(2e4-20)+20;freqValues[i]=freq}let magValues=new Float32Array(len2),phaseValues=new Float32Array(len2),filterClone=this.context.createBiquadFilter();return filterClone.type=this.type,filterClone.Q.value=this.Q.value,filterClone.frequency.value=this.frequency.value,filterClone.gain.value=this.gain.value,filterClone.getFrequencyResponse(freqValues,magValues,phaseValues),magValues}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}};var Filter3=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Filter3.getDefaults(),arguments,["frequency","type","rolloff"]));this.name="Filter",this.input=new Gain({context:this.context}),this.output=new Gain({context:this.context}),this._filters=[];let options=optionsFromArguments(Filter3.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new Signal2({context:this.context,units:"positive",value:options.Q}),this.frequency=new Signal2({context:this.context,units:"frequency",value:options.frequency}),this.detune=new Signal2({context:this.context,units:"cents",value:options.detune}),this.gain=new Signal2({context:this.context,units:"decibels",convert:!1,value:options.gain}),this._type=options.type,this.rolloff=options.rolloff,readOnly(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(type){assert(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(type)!==-1,`Invalid filter type: ${type}`),this._type=type,this._filters.forEach(filter=>filter.type=type)}get rolloff(){return this._rolloff}set rolloff(rolloff){let rolloffNum=isNumber(rolloff)?rolloff:parseInt(rolloff,10),possibilities=[-12,-24,-48,-96],cascadingCount=possibilities.indexOf(rolloffNum);assert(cascadingCount!==-1,`rolloff can only be ${possibilities.join(", ")}`),cascadingCount+=1,this._rolloff=rolloffNum,this.input.disconnect(),this._filters.forEach(filter=>filter.disconnect()),this._filters=new Array(cascadingCount);for(let count2=0;count2<cascadingCount;count2++){let filter=new BiquadFilter({context:this.context});filter.type=this._type,this.frequency.connect(filter.frequency),this.detune.connect(filter.detune),this.Q.connect(filter.Q),this.gain.connect(filter.gain),this._filters[count2]=filter}this._internalChannels=this._filters,connectSeries(this.input,...this._internalChannels,this.output)}getFrequencyResponse(len2=128){let filterClone=new BiquadFilter({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),totalResponse=new Float32Array(len2).map(()=>1);return this._filters.forEach(()=>{filterClone.getFrequencyResponse(len2).forEach((val,i)=>totalResponse[i]*=val)}),filterClone.dispose(),totalResponse}dispose(){return super.dispose(),this._filters.forEach(filter=>{filter.dispose()}),writable(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}};var FrequencyEnvelope=class extends Envelope{constructor(){super(optionsFromArguments(FrequencyEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"]));this.name="FrequencyEnvelope";let options=optionsFromArguments(FrequencyEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=options.octaves,this._baseFrequency=this.toFrequency(options.baseFrequency),this._exponent=this.input=new Pow({context:this.context,value:options.exponent}),this._scale=this.output=new Scale({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Envelope.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(min){let freq=this.toFrequency(min);assertRange(freq,0),this._baseFrequency=freq,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(octaves){this._octaves=octaves,this._scale.max=this._baseFrequency*Math.pow(2,octaves)}get exponent(){return this._exponent.value}set exponent(exponent){this._exponent.value=exponent}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}};var MonoSynth=class extends Monophonic{constructor(){super(optionsFromArguments(MonoSynth.getDefaults(),arguments));this.name="MonoSynth";let options=optionsFromArguments(MonoSynth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign(options.oscillator,{context:this.context,detune:options.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Filter3(Object.assign(options.filter,{context:this.context})),this.filterEnvelope=new FrequencyEnvelope(Object.assign(options.filterEnvelope,{context:this.context})),this.envelope=new AmplitudeEnvelope(Object.assign(options.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),readOnly(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(omitFromObject(Filter3.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(omitFromObject(FrequencyEnvelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),Object.keys(Source.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(time,velocity=1){if(this.envelope.triggerAttack(time,velocity),this.filterEnvelope.triggerAttack(time),this.oscillator.start(time),this.envelope.sustain===0){let computedAttack=this.toSeconds(this.envelope.attack),computedDecay=this.toSeconds(this.envelope.decay);this.oscillator.stop(time+computedAttack+computedDecay)}}_triggerEnvelopeRelease(time){this.envelope.triggerRelease(time),this.filterEnvelope.triggerRelease(time),this.oscillator.stop(time+this.toSeconds(this.envelope.release))}getLevelAtTime(time){return time=this.toSeconds(time),this.envelope.getValueAtTime(time)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}};var DuoSynth=class extends Monophonic{constructor(){super(optionsFromArguments(DuoSynth.getDefaults(),arguments));this.name="DuoSynth";let options=optionsFromArguments(DuoSynth.getDefaults(),arguments);this.voice0=new MonoSynth(Object.assign(options.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new MonoSynth(Object.assign(options.voice1,{context:this.context})),this.harmonicity=new Multiply({context:this.context,units:"positive",value:options.harmonicity}),this._vibrato=new LFO({frequency:options.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new Gain({context:this.context,units:"normalRange",gain:options.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Signal2({context:this.context,units:"frequency",value:440}),this.detune=new Signal2({context:this.context,units:"cents",value:options.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),readOnly(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(time){return time=this.toSeconds(time),this.voice0.envelope.getValueAtTime(time)+this.voice1.envelope.getValueAtTime(time)}static getDefaults(){return deepMerge(Monophonic.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:deepMerge(omitFromObject(MonoSynth.getDefaults(),Object.keys(Monophonic.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:deepMerge(omitFromObject(MonoSynth.getDefaults(),Object.keys(Monophonic.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(time,velocity){this.voice0._triggerEnvelopeAttack(time,velocity),this.voice1._triggerEnvelopeAttack(time,velocity)}_triggerEnvelopeRelease(time){return this.voice0._triggerEnvelopeRelease(time),this.voice1._triggerEnvelopeRelease(time),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}};var FMSynth=class extends ModulationSynth{constructor(){super(optionsFromArguments(FMSynth.getDefaults(),arguments));this.name="FMSynth";let options=optionsFromArguments(FMSynth.getDefaults(),arguments);this.modulationIndex=new Multiply({context:this.context,value:options.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(ModulationSynth.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}};var inharmRatios=[1,1.483,1.932,2.546,2.63,3.897],MetalSynth=class extends Monophonic{constructor(){super(optionsFromArguments(MetalSynth.getDefaults(),arguments));this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];let options=optionsFromArguments(MetalSynth.getDefaults(),arguments);this.detune=new Signal2({context:this.context,units:"cents",value:options.detune}),this.frequency=new Signal2({context:this.context,units:"frequency"}),this._amplitude=new Gain({context:this.context,gain:0}).connect(this.output),this._highpass=new Filter3({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let i=0;i<inharmRatios.length;i++){let osc=new FMOscillator({context:this.context,harmonicity:options.harmonicity,modulationIndex:options.modulationIndex,modulationType:"square",onstop:i===0?()=>this.onsilence(this):noOp,type:"square"});osc.connect(this._highpass),this._oscillators[i]=osc;let mult=new Multiply({context:this.context,value:inharmRatios[i]});this._freqMultipliers[i]=mult,this.frequency.chain(mult,osc.frequency),this.detune.connect(osc.detune)}this._filterFreqScaler=new Scale({context:this.context,max:7e3,min:this.toFrequency(options.resonance)}),this.envelope=new Envelope({attack:options.envelope.attack,attackCurve:"linear",context:this.context,decay:options.envelope.decay,release:options.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=options.octaves,this.octaves=options.octaves}static getDefaults(){return deepMerge(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(time,velocity=1){return this.envelope.triggerAttack(time,velocity),this._oscillators.forEach(osc=>osc.start(time)),this.envelope.sustain===0&&this._oscillators.forEach(osc=>{osc.stop(time+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(time){return this.envelope.triggerRelease(time),this._oscillators.forEach(osc=>osc.stop(time+this.toSeconds(this.envelope.release))),this}getLevelAtTime(time){return time=this.toSeconds(time),this.envelope.getValueAtTime(time)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(val){this._oscillators.forEach(osc=>osc.modulationIndex.value=val)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(val){this._oscillators.forEach(osc=>osc.harmonicity.value=val)}get resonance(){return this._filterFreqScaler.min}set resonance(val){this._filterFreqScaler.min=this.toFrequency(val),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(val){this._octaves=val,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,val)}dispose(){return super.dispose(),this._oscillators.forEach(osc=>osc.dispose()),this._freqMultipliers.forEach(freqMult=>freqMult.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}};var MembraneSynth=class extends Synth{constructor(){super(optionsFromArguments(MembraneSynth.getDefaults(),arguments));this.name="MembraneSynth",this.portamento=0;let options=optionsFromArguments(MembraneSynth.getDefaults(),arguments);this.pitchDecay=options.pitchDecay,this.octaves=options.octaves,readOnly(this,["oscillator","envelope"])}static getDefaults(){return deepMerge(Monophonic.getDefaults(),Synth.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(note,time){let seconds=this.toSeconds(time),hertz=this.toFrequency(note instanceof FrequencyClass?note.toFrequency():note),maxNote=hertz*this.octaves;return this.oscillator.frequency.setValueAtTime(maxNote,seconds),this.oscillator.frequency.exponentialRampToValueAtTime(hertz,seconds+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}};__decorate([range2(0)],MembraneSynth.prototype,"octaves",void 0);__decorate([timeRange(0)],MembraneSynth.prototype,"pitchDecay",void 0);var NoiseSynth=class extends Instrument{constructor(){super(optionsFromArguments(NoiseSynth.getDefaults(),arguments));this.name="NoiseSynth";let options=optionsFromArguments(NoiseSynth.getDefaults(),arguments);this.noise=new Noise(Object.assign({context:this.context},options.noise)),this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},options.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(omitFromObject(Noise.getDefaults(),Object.keys(Source.getDefaults())),{type:"white"})})}triggerAttack(time,velocity=1){return time=this.toSeconds(time),this.envelope.triggerAttack(time,velocity),this.noise.start(time),this.envelope.sustain===0&&this.noise.stop(time+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(time){return time=this.toSeconds(time),this.envelope.triggerRelease(time),this.noise.stop(time+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(duration,time,velocity=1){return time=this.toSeconds(time),duration=this.toSeconds(duration),this.triggerAttack(time,velocity),this.triggerRelease(time+duration),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}};var workletContext=new Set;function addToWorklet(classOrFunction){workletContext.add(classOrFunction)}function registerProcessor(name,classDesc){let processor=`registerProcessor("${name}", ${classDesc})`;workletContext.add(processor)}function getWorkletGlobalScope(){return Array.from(workletContext).join(`
`)}var ToneAudioWorklet=class extends ToneAudioNode{constructor(options){super(options);this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=noOp;let blobUrl=URL.createObjectURL(new Blob([getWorkletGlobalScope()],{type:"text/javascript"})),name=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(blobUrl,name).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(name,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}};var toneAudioWorkletProcessor=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;addToWorklet(toneAudioWorkletProcessor);var singleIOProcess=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;addToWorklet(singleIOProcess);var delayLine=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;addToWorklet(delayLine);var workletName="feedback-comb-filter",feedbackCombFilter=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;registerProcessor(workletName,feedbackCombFilter);var FeedbackCombFilter=class extends ToneAudioWorklet{constructor(){super(optionsFromArguments(FeedbackCombFilter.getDefaults(),arguments,["delayTime","resonance"]));this.name="FeedbackCombFilter";let options=optionsFromArguments(FeedbackCombFilter.getDefaults(),arguments,["delayTime","resonance"]);this.input=new Gain({context:this.context}),this.output=new Gain({context:this.context}),this.delayTime=new Param({context:this.context,value:options.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new Param({context:this.context,value:options.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),readOnly(this,["resonance","delayTime"])}_audioWorkletName(){return workletName}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{delayTime:.1,resonance:.5})}onReady(node){connectSeries(this.input,node,this.output);let delayTime=node.parameters.get("delayTime");this.delayTime.setParam(delayTime);let feedback=node.parameters.get("feedback");this.resonance.setParam(feedback)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}};var OnePoleFilter=class extends ToneAudioNode{constructor(){super(optionsFromArguments(OnePoleFilter.getDefaults(),arguments,["frequency","type"]));this.name="OnePoleFilter";let options=optionsFromArguments(OnePoleFilter.getDefaults(),arguments,["frequency","type"]);this._frequency=options.frequency,this._type=options.type,this.input=new Gain({context:this.context}),this.output=new Gain({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){let oldFilter=this._filter,freq=this.toFrequency(this._frequency),t=1/(2*Math.PI*freq);if(this._type==="lowpass"){let a0=1/(t*this.context.sampleRate),b1=a0-1;this._filter=this.context.createIIRFilter([a0,0],[1,b1])}else{let b1=1/(t*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,b1])}this.input.chain(this._filter,this.output),oldFilter&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(oldFilter),oldFilter.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(fq){this._frequency=fq,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(len2=128){let freqValues=new Float32Array(len2);for(let i=0;i<len2;i++){let freq=Math.pow(i/len2,2)*(2e4-20)+20;freqValues[i]=freq}let magValues=new Float32Array(len2),phaseValues=new Float32Array(len2);return this._filter.getFrequencyResponse(freqValues,magValues,phaseValues),magValues}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}};var LowpassCombFilter=class extends ToneAudioNode{constructor(){super(optionsFromArguments(LowpassCombFilter.getDefaults(),arguments,["delayTime","resonance","dampening"]));this.name="LowpassCombFilter";let options=optionsFromArguments(LowpassCombFilter.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new FeedbackCombFilter({context:this.context,delayTime:options.delayTime,resonance:options.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new OnePoleFilter({context:this.context,frequency:options.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(fq){this._lowpass.frequency=fq}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}};var PluckSynth=class extends Instrument{constructor(){super(optionsFromArguments(PluckSynth.getDefaults(),arguments));this.name="PluckSynth";let options=optionsFromArguments(PluckSynth.getDefaults(),arguments);this._noise=new Noise({context:this.context,type:"pink"}),this.attackNoise=options.attackNoise,this._lfcf=new LowpassCombFilter({context:this.context,dampening:options.dampening,resonance:options.resonance}),this.resonance=options.resonance,this.release=options.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return deepMerge(Instrument.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(fq){this._lfcf.dampening=fq}triggerAttack(note,time){let freq=this.toFrequency(note);time=this.toSeconds(time);let delayAmount=1/freq;return this._lfcf.delayTime.setValueAtTime(delayAmount,time),this._noise.start(time),this._noise.stop(time+delayAmount*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(time),this._lfcf.resonance.setValueAtTime(this.resonance,time),this}triggerRelease(time){return this._lfcf.resonance.linearRampTo(0,this.release,time),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}};var PolySynth=class extends Instrument{constructor(){super(optionsFromArguments(PolySynth.getDefaults(),arguments,["voice","options"]));this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;let options=optionsFromArguments(PolySynth.getDefaults(),arguments,["voice","options"]);assert(!isNumber(options.voice),"DEPRECATED: The polyphony count is no longer the first argument.");let defaults=options.voice.getDefaults();this.options=Object.assign(defaults,options.options),this.voice=options.voice,this.maxPolyphony=options.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();let index3=this._voices.indexOf(this._dummyVoice);this._voices.splice(index3,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{maxPolyphony:32,options:{},voice:Synth})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(voice){this._availableVoices.push(voice);let activeVoiceIndex=this._activeVoices.findIndex(e=>e.voice===voice);this._activeVoices.splice(activeVoiceIndex,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){let voice=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return voice.connect(this.output),this._voices.push(voice),voice}else warn("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){let firstAvail=this._availableVoices.shift(),index3=this._voices.indexOf(firstAvail);this._voices.splice(index3,1),this.context.isOffline||firstAvail.dispose()}}_triggerAttack(notes,time,velocity){notes.forEach(note=>{let midiNote=new MidiClass(this.context,note).toMidi(),voice=this._getNextAvailableVoice();voice&&(voice.triggerAttack(note,time,velocity),this._activeVoices.push({midi:midiNote,voice,released:!1}),this.log("triggerAttack",note,time))})}_triggerRelease(notes,time){notes.forEach(note=>{let midiNote=new MidiClass(this.context,note).toMidi(),event=this._activeVoices.find(({midi,released})=>midi===midiNote&&!released);event&&(event.voice.triggerRelease(time),event.released=!0,this.log("triggerRelease",note,time))})}_scheduleEvent(type,notes,time,velocity){assert(!this.disposed,"Synth was already disposed"),time<=this.now()?type==="attack"?this._triggerAttack(notes,time,velocity):this._triggerRelease(notes,time):this.context.setTimeout(()=>{this._scheduleEvent(type,notes,time,velocity)},time-this.now())}triggerAttack(notes,time,velocity){Array.isArray(notes)||(notes=[notes]);let computedTime=this.toSeconds(time);return this._scheduleEvent("attack",notes,computedTime,velocity),this}triggerRelease(notes,time){Array.isArray(notes)||(notes=[notes]);let computedTime=this.toSeconds(time);return this._scheduleEvent("release",notes,computedTime),this}triggerAttackRelease(notes,duration,time,velocity){let computedTime=this.toSeconds(time);if(this.triggerAttack(notes,computedTime,velocity),isArray2(duration)){assert(isArray2(notes),"If the duration is an array, the notes must also be an array"),notes=notes;for(let i=0;i<notes.length;i++){let d=duration[Math.min(i,duration.length-1)],durationSeconds=this.toSeconds(d);assert(durationSeconds>0,"The duration must be greater than 0"),this.triggerRelease(notes[i],computedTime+durationSeconds)}}else{let durationSeconds=this.toSeconds(duration);assert(durationSeconds>0,"The duration must be greater than 0"),this.triggerRelease(notes,computedTime+durationSeconds)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(options){let sanitizedOptions=omitFromObject(options,["onsilence","context"]);return this.options=deepMerge(this.options,sanitizedOptions),this._voices.forEach(voice=>voice.set(sanitizedOptions)),this._dummyVoice.set(sanitizedOptions),this}get(){return this._dummyVoice.get()}releaseAll(time){let computedTime=this.toSeconds(time);return this._activeVoices.forEach(({voice})=>{voice.triggerRelease(computedTime)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(v=>v.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}};var Sampler=class extends Instrument{constructor(){super(optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"));this.name="Sampler",this._activeSources=new Map;let options=optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),urlMap={};Object.keys(options.urls).forEach(note=>{let noteNumber=parseInt(note,10);if(assert(isNote(note)||isNumber(noteNumber)&&isFinite(noteNumber),`url key is neither a note or midi pitch: ${note}`),isNote(note)){let mid=new FrequencyClass(this.context,note).toMidi();urlMap[mid]=options.urls[note]}else isNumber(noteNumber)&&isFinite(noteNumber)&&(urlMap[noteNumber]=options.urls[noteNumber])}),this._buffers=new ToneAudioBuffers({urls:urlMap,onload:options.onload,baseUrl:options.baseUrl,onerror:options.onerror}),this.attack=options.attack,this.release=options.release,this.curve=options.curve,this._buffers.loaded&&Promise.resolve().then(options.onload)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:noOp,onerror:noOp,release:.1,urls:{}})}_findClosest(midi){let MAX_INTERVAL=96,interval=0;for(;interval<MAX_INTERVAL;){if(this._buffers.has(midi+interval))return-interval;if(this._buffers.has(midi-interval))return interval;interval++}throw new Error(`No available buffers for note: ${midi}`)}triggerAttack(notes,time,velocity=1){return this.log("triggerAttack",notes,time,velocity),Array.isArray(notes)||(notes=[notes]),notes.forEach(note=>{let midiFloat=ftomf(new FrequencyClass(this.context,note).toFrequency()),midi=Math.round(midiFloat),remainder=midiFloat-midi,difference=this._findClosest(midi),closestNote=midi-difference,buffer=this._buffers.get(closestNote),playbackRate=intervalToFrequencyRatio(difference+remainder),source=new ToneBufferSource({url:buffer,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate}).connect(this.output);source.start(time,0,buffer.duration/playbackRate,velocity),isArray2(this._activeSources.get(midi))||this._activeSources.set(midi,[]),this._activeSources.get(midi).push(source),source.onended=()=>{if(this._activeSources&&this._activeSources.has(midi)){let sources=this._activeSources.get(midi),index3=sources.indexOf(source);index3!==-1&&sources.splice(index3,1)}}}),this}triggerRelease(notes,time){return this.log("triggerRelease",notes,time),Array.isArray(notes)||(notes=[notes]),notes.forEach(note=>{let midi=new FrequencyClass(this.context,note).toMidi();if(this._activeSources.has(midi)&&this._activeSources.get(midi).length){let sources=this._activeSources.get(midi);time=this.toSeconds(time),sources.forEach(source=>{source.stop(time)}),this._activeSources.set(midi,[])}}),this}releaseAll(time){let computedTime=this.toSeconds(time);return this._activeSources.forEach(sources=>{for(;sources.length;)sources.shift().stop(computedTime)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(notes,duration,time,velocity=1){let computedTime=this.toSeconds(time);return this.triggerAttack(notes,computedTime,velocity),isArray2(duration)?(assert(isArray2(notes),"notes must be an array when duration is array"),notes.forEach((note,index3)=>{let d=duration[Math.min(index3,duration.length-1)];this.triggerRelease(note,computedTime+this.toSeconds(d))})):this.triggerRelease(notes,computedTime+this.toSeconds(duration)),this}add(note,url3,callback){if(assert(isNote(note)||isFinite(note),`note must be a pitch or midi: ${note}`),isNote(note)){let mid=new FrequencyClass(this.context,note).toMidi();this._buffers.add(mid,url3,callback)}else this._buffers.add(note,url3,callback);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(sources=>{sources.forEach(source=>source.dispose())}),this._activeSources.clear(),this}};__decorate([timeRange(0)],Sampler.prototype,"attack",void 0);__decorate([timeRange(0)],Sampler.prototype,"release",void 0);var ToneEvent=class extends ToneWithContext{constructor(){super(optionsFromArguments(ToneEvent.getDefaults(),arguments,["callback","value"]));this.name="ToneEvent",this._state=new StateTimeline("stopped"),this._startOffset=0;let options=optionsFromArguments(ToneEvent.getDefaults(),arguments,["callback","value"]);this._loop=options.loop,this.callback=options.callback,this.value=options.value,this._loopStart=this.toTicks(options.loopStart),this._loopEnd=this.toTicks(options.loopEnd),this._playbackRate=options.playbackRate,this._probability=options.probability,this._humanize=options.humanize,this.mute=options.mute,this._playbackRate=options.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(after=-1){this._state.forEachFrom(after,event=>{let duration;if(event.state==="started"){event.id!==-1&&this.context.transport.clear(event.id);let startTick=event.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||isNumber(this._loop)&&this._loop>1){duration=Infinity,isNumber(this._loop)&&(duration=this._loop*this._getLoopDuration());let nextEvent=this._state.getAfter(startTick);nextEvent!==null&&(duration=Math.min(duration,nextEvent.time-startTick)),duration!==Infinity&&(this._state.setStateAtTime("stopped",startTick+duration+1,{id:-1}),duration=new TicksClass(this.context,duration));let interval=new TicksClass(this.context,this._getLoopDuration());event.id=this.context.transport.scheduleRepeat(this._tick.bind(this),interval,new TicksClass(this.context,startTick),duration)}else event.id=this.context.transport.schedule(this._tick.bind(this),new TicksClass(this.context,startTick))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(offset){this._startOffset=offset}get probability(){return this._probability}set probability(prob){this._probability=prob}get humanize(){return this._humanize}set humanize(variation){this._humanize=variation}start(time){let ticks=this.toTicks(time);return this._state.getValueAtTime(ticks)==="stopped"&&(this._state.add({id:-1,state:"started",time:ticks}),this._rescheduleEvents(ticks)),this}stop(time){this.cancel(time);let ticks=this.toTicks(time);if(this._state.getValueAtTime(ticks)==="started"){this._state.setStateAtTime("stopped",ticks,{id:-1});let previousEvent=this._state.getBefore(ticks),reschedulTime=ticks;previousEvent!==null&&(reschedulTime=previousEvent.time),this._rescheduleEvents(reschedulTime)}return this}cancel(time){time=defaultArg(time,-Infinity);let ticks=this.toTicks(time);return this._state.forEachFrom(ticks,event=>{this.context.transport.clear(event.id)}),this._state.cancel(ticks),this}_tick(time){let ticks=this.context.transport.getTicksAtTime(time);if(!this.mute&&this._state.getValueAtTime(ticks)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let variation=.02;isBoolean(this.humanize)||(variation=this.toSeconds(this.humanize)),time+=(Math.random()*2-1)*variation}this.callback(time,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(loop){this._loop=loop,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(rate){this._playbackRate=rate,this._rescheduleEvents()}get loopEnd(){return new TicksClass(this.context,this._loopEnd).toSeconds()}set loopEnd(loopEnd){this._loopEnd=this.toTicks(loopEnd),this._loop&&this._rescheduleEvents()}get loopStart(){return new TicksClass(this.context,this._loopStart).toSeconds()}set loopStart(loopStart){this._loopStart=this.toTicks(loopStart),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){let ticks=this.context.transport.ticks,lastEvent=this._state.get(ticks);if(lastEvent!==null&&lastEvent.state==="started"){let loopDuration=this._getLoopDuration();return(ticks-lastEvent.time)%loopDuration/loopDuration}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}};var Loop=class extends ToneWithContext{constructor(){super(optionsFromArguments(Loop.getDefaults(),arguments,["callback","interval"]));this.name="Loop";let options=optionsFromArguments(Loop.getDefaults(),arguments,["callback","interval"]);this._event=new ToneEvent({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:options.interval,playbackRate:options.playbackRate,probability:options.probability}),this.callback=options.callback,this.iterations=options.iterations}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{interval:"4n",callback:noOp,playbackRate:1,iterations:Infinity,probability:1,mute:!1,humanize:!1})}start(time){return this._event.start(time),this}stop(time){return this._event.stop(time),this}cancel(time){return this._event.cancel(time),this}_tick(time){this.callback(time)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(interval){this._event.loopEnd=interval}get playbackRate(){return this._event.playbackRate}set playbackRate(rate){this._event.playbackRate=rate}get humanize(){return this._event.humanize}set humanize(variation){this._event.humanize=variation}get probability(){return this._event.probability}set probability(prob){this._event.probability=prob}get mute(){return this._event.mute}set mute(mute){this._event.mute=mute}get iterations(){return this._event.loop===!0?Infinity:this._event.loop}set iterations(iters){iters===Infinity?this._event.loop=!0:this._event.loop=iters}dispose(){return super.dispose(),this._event.dispose(),this}};var Part=class extends ToneEvent{constructor(){super(optionsFromArguments(Part.getDefaults(),arguments,["callback","events"]));this.name="Part",this._state=new StateTimeline("stopped"),this._events=new Set;let options=optionsFromArguments(Part.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,options.events.forEach(event=>{isArray2(event)?this.add(event[0],event[1]):this.add(event)})}static getDefaults(){return Object.assign(ToneEvent.getDefaults(),{events:[]})}start(time,offset){let ticks=this.toTicks(time);if(this._state.getValueAtTime(ticks)!=="started"){offset=defaultArg(offset,this._loop?this._loopStart:0),this._loop?offset=defaultArg(offset,this._loopStart):offset=defaultArg(offset,0);let computedOffset=this.toTicks(offset);this._state.add({id:-1,offset:computedOffset,state:"started",time:ticks}),this._forEach(event=>{this._startNote(event,ticks,computedOffset)})}return this}_startNote(event,ticks,offset){ticks-=offset,this._loop?event.startOffset>=this._loopStart&&event.startOffset<this._loopEnd?(event.startOffset<offset&&(ticks+=this._getLoopDuration()),event.start(new TicksClass(this.context,ticks))):event.startOffset<this._loopStart&&event.startOffset>=offset&&(event.loop=!1,event.start(new TicksClass(this.context,ticks))):event.startOffset>=offset&&event.start(new TicksClass(this.context,ticks))}get startOffset(){return this._startOffset}set startOffset(offset){this._startOffset=offset,this._forEach(event=>{event.startOffset+=this._startOffset})}stop(time){let ticks=this.toTicks(time);return this._state.cancel(ticks),this._state.setStateAtTime("stopped",ticks),this._forEach(event=>{event.stop(time)}),this}at(time,value){let timeInTicks=new TransportTimeClass(this.context,time).toTicks(),tickTime=new TicksClass(this.context,1).toSeconds(),iterator=this._events.values(),result=iterator.next();for(;!result.done;){let event=result.value;if(Math.abs(timeInTicks-event.startOffset)<tickTime)return isDefined(value)&&(event.value=value),event;result=iterator.next()}return isDefined(value)?(this.add(time,value),this.at(time)):null}add(time,value){time instanceof Object&&Reflect.has(time,"time")&&(value=time,time=value.time);let ticks=this.toTicks(time),event;return value instanceof ToneEvent?(event=value,event.callback=this._tick.bind(this)):event=new ToneEvent({callback:this._tick.bind(this),context:this.context,value}),event.startOffset=ticks,event.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(event),this._restartEvent(event),this}_restartEvent(event){this._state.forEach(stateEvent=>{stateEvent.state==="started"?this._startNote(event,stateEvent.time,stateEvent.offset):event.stop(new TicksClass(this.context,stateEvent.time))})}remove(time,value){return isObject(time)&&time.hasOwnProperty("time")&&(value=time,time=value.time),time=this.toTicks(time),this._events.forEach(event=>{event.startOffset===time&&(isUndef(value)||isDefined(value)&&event.value===value)&&(this._events.delete(event),event.dispose())}),this}clear(){return this._forEach(event=>event.dispose()),this._events.clear(),this}cancel(after){return this._forEach(event=>event.cancel(after)),this._state.cancel(this.toTicks(after)),this}_forEach(callback){return this._events&&this._events.forEach(event=>{event instanceof Part?event._forEach(callback):callback(event)}),this}_setAll(attr,value){this._forEach(event=>{event[attr]=value})}_tick(time,value){this.mute||this.callback(time,value)}_testLoopBoundries(event){this._loop&&(event.startOffset<this._loopStart||event.startOffset>=this._loopEnd)?event.cancel(0):event.state==="stopped"&&this._restartEvent(event)}get probability(){return this._probability}set probability(prob){this._probability=prob,this._setAll("probability",prob)}get humanize(){return this._humanize}set humanize(variation){this._humanize=variation,this._setAll("humanize",variation)}get loop(){return this._loop}set loop(loop){this._loop=loop,this._forEach(event=>{event.loopStart=this.loopStart,event.loopEnd=this.loopEnd,event.loop=loop,this._testLoopBoundries(event)})}get loopEnd(){return new TicksClass(this.context,this._loopEnd).toSeconds()}set loopEnd(loopEnd){this._loopEnd=this.toTicks(loopEnd),this._loop&&this._forEach(event=>{event.loopEnd=loopEnd,this._testLoopBoundries(event)})}get loopStart(){return new TicksClass(this.context,this._loopStart).toSeconds()}set loopStart(loopStart){this._loopStart=this.toTicks(loopStart),this._loop&&this._forEach(event=>{event.loopStart=this.loopStart,this._testLoopBoundries(event)})}get playbackRate(){return this._playbackRate}set playbackRate(rate){this._playbackRate=rate,this._setAll("playbackRate",rate)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}};function*upPatternGen(values){let index3=0;for(;index3<values.length;)index3=clampToArraySize(index3,values),yield values[index3],index3++}function*downPatternGen(values){let index3=values.length-1;for(;index3>=0;)index3=clampToArraySize(index3,values),yield values[index3],index3--}function*infiniteGen(values,gen){for(;;)yield*gen(values)}function clampToArraySize(index3,values){return clamp(index3,0,values.length-1)}function*alternatingGenerator(values,directionUp){let index3=directionUp?0:values.length-1;for(;;)index3=clampToArraySize(index3,values),yield values[index3],directionUp?(index3++,index3>=values.length-1&&(directionUp=!1)):(index3--,index3<=0&&(directionUp=!0))}function*jumpUp(values){let index3=0,stepIndex=0;for(;index3<values.length;)index3=clampToArraySize(index3,values),yield values[index3],stepIndex++,index3+=stepIndex%2?2:-1}function*jumpDown(values){let index3=values.length-1,stepIndex=0;for(;index3>=0;)index3=clampToArraySize(index3,values),yield values[index3],stepIndex++,index3+=stepIndex%2?-2:1}function*randomGen(values){for(;;){let randomIndex=Math.floor(Math.random()*values.length);yield values[randomIndex]}}function*randomOnce(values){let copy=[];for(let i=0;i<values.length;i++)copy.push(i);for(;copy.length>0;){let randVal=copy.splice(Math.floor(copy.length*Math.random()),1),index3=clampToArraySize(randVal[0],values);yield values[index3]}}function*randomWalk(values){let index3=Math.floor(Math.random()*values.length);for(;;)index3===0?index3++:index3===values.length-1||Math.random()<.5?index3--:index3++,yield values[index3]}function*PatternGenerator(values,pattern="up",index3=0){switch(assert(values.length>0,"The array must have more than one value in it"),pattern){case"up":yield*infiniteGen(values,upPatternGen);case"down":yield*infiniteGen(values,downPatternGen);case"upDown":yield*alternatingGenerator(values,!0);case"downUp":yield*alternatingGenerator(values,!1);case"alternateUp":yield*infiniteGen(values,jumpUp);case"alternateDown":yield*infiniteGen(values,jumpDown);case"random":yield*randomGen(values);case"randomOnce":yield*infiniteGen(values,randomOnce);case"randomWalk":yield*randomWalk(values)}}var Pattern=class extends Loop{constructor(){super(optionsFromArguments(Pattern.getDefaults(),arguments,["callback","values","pattern"]));this.name="Pattern";let options=optionsFromArguments(Pattern.getDefaults(),arguments,["callback","values","pattern"]);this.callback=options.callback,this._values=options.values,this._pattern=PatternGenerator(options.values,options.pattern),this._type=options.pattern}static getDefaults(){return Object.assign(Loop.getDefaults(),{pattern:"up",values:[],callback:noOp})}_tick(time){let value=this._pattern.next();this._value=value.value,this.callback(time,this._value)}get values(){return this._values}set values(val){this._values=val,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(pattern){this._type=pattern,this._pattern=PatternGenerator(this._values,this._type)}};var Sequence=class extends ToneEvent{constructor(){super(optionsFromArguments(Sequence.getDefaults(),arguments,["callback","events","subdivision"]));this.name="Sequence",this._part=new Part({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];let options=optionsFromArguments(Sequence.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(options.subdivision),this.events=options.events,this.loop=options.loop,this.loopStart=options.loopStart,this.loopEnd=options.loopEnd,this.playbackRate=options.playbackRate,this.probability=options.probability,this.humanize=options.humanize,this.mute=options.mute,this.playbackRate=options.playbackRate}static getDefaults(){return Object.assign(omitFromObject(ToneEvent.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(time,value){value!==null&&this.callback(time,value)}get events(){return this._events}set events(s){this.clear(),this._eventsArray=s,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(time,offset){return this._part.start(time,offset&&this._indexTime(offset)),this}stop(time){return this._part.stop(time),this}get subdivision(){return new TicksClass(this.context,this._subdivision).toSeconds()}_createSequence(array){return new Proxy(array,{get:(target,property)=>target[property],set:(target,property,value)=>(isString(property)&&isFinite(parseInt(property,10))&&isArray2(value)?target[property]=this._createSequence(value):target[property]=value,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(sequence,subdivision,startOffset){sequence.forEach((value,index3)=>{let eventOffset=index3*subdivision+startOffset;if(isArray2(value))this._rescheduleSequence(value,subdivision/value.length,eventOffset);else{let startTime=new TicksClass(this.context,eventOffset,"i").toSeconds();this._part.add(startTime,value)}})}_indexTime(index3){return new TicksClass(this.context,index3*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(l){this._part.loop=l}get loopStart(){return this._loopStart}set loopStart(index3){this._loopStart=index3,this._part.loopStart=this._indexTime(index3)}get loopEnd(){return this._loopEnd}set loopEnd(index3){this._loopEnd=index3,index3===0?this._part.loopEnd=this._indexTime(this._eventsArray.length):this._part.loopEnd=this._indexTime(index3)}get startOffset(){return this._part.startOffset}set startOffset(start2){this._part.startOffset=start2}get playbackRate(){return this._part.playbackRate}set playbackRate(rate){this._part.playbackRate=rate}get probability(){return this._part.probability}set probability(prob){this._part.probability=prob}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(variation){this._part.humanize=variation}get length(){return this._part.length}};var CrossFade=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(CrossFade.getDefaults(),arguments,["fade"])));this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new GainToAudio({context:this.context}),this.a=new Gain({context:this.context,gain:0}),this.b=new Gain({context:this.context,gain:0}),this.output=new Gain({context:this.context}),this._internalChannels=[this.a,this.b];let options=optionsFromArguments(CrossFade.getDefaults(),arguments,["fade"]);this.fade=new Signal2({context:this.context,units:"normalRange",value:options.fade}),readOnly(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",connect(this._split,this.a.gain,0),connect(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}};var Effect=class extends ToneAudioNode{constructor(options){super(options);this.name="Effect",this._dryWet=new CrossFade({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Gain({context:this.context}),this.effectReturn=new Gain({context:this.context}),this.input=new Gain({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(options.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],readOnly(this,"wet")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{wet:1})}connectEffect(effect){return this._internalChannels.push(effect),this.effectSend.chain(effect,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};var LFOEffect=class extends Effect{constructor(options){super(options);this.name="LFOEffect",this._lfo=new LFO({context:this.context,frequency:options.frequency,amplitude:options.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=options.type,readOnly(this,["frequency","depth"])}static getDefaults(){return Object.assign(Effect.getDefaults(),{frequency:1,type:"sine",depth:1})}start(time){return this._lfo.start(time),this}stop(time){return this._lfo.stop(time),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(type){this._lfo.type=type}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}};var AutoFilter=class extends LFOEffect{constructor(){super(optionsFromArguments(AutoFilter.getDefaults(),arguments,["frequency","baseFrequency","octaves"]));this.name="AutoFilter";let options=optionsFromArguments(AutoFilter.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Filter3(Object.assign(options.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=options.octaves,this.baseFrequency=options.baseFrequency}static getDefaults(){return Object.assign(LFOEffect.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(freq){this._lfo.min=this.toFrequency(freq),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(oct){this._octaves=oct,this._lfo.max=this._lfo.min*Math.pow(2,oct)}dispose(){return super.dispose(),this.filter.dispose(),this}};var Panner=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Panner.getDefaults(),arguments,["pan"])));this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let options=optionsFromArguments(Panner.getDefaults(),arguments,["pan"]);this.pan=new Param({context:this.context,param:this._panner.pan,value:options.pan,minValue:-1,maxValue:1}),this._panner.channelCount=options.channelCount,this._panner.channelCountMode="explicit",readOnly(this,"pan")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}};var AutoPanner=class extends LFOEffect{constructor(){super(optionsFromArguments(AutoPanner.getDefaults(),arguments,["frequency"]));this.name="AutoPanner";let options=optionsFromArguments(AutoPanner.getDefaults(),arguments,["frequency"]);this._panner=new Panner({context:this.context,channelCount:options.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(LFOEffect.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}};var Follower=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Follower.getDefaults(),arguments,["smoothing"]));this.name="Follower";let options=optionsFromArguments(Follower.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new Abs({context:this.context}),this._lowpass=this.output=new OnePoleFilter({context:this.context,frequency:1/this.toSeconds(options.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=options.smoothing}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(smoothing){this._smoothing=smoothing,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}};var AutoWah=class extends Effect{constructor(){super(optionsFromArguments(AutoWah.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]));this.name="AutoWah";let options=optionsFromArguments(AutoWah.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new Follower({context:this.context,smoothing:options.follower}),this._sweepRange=new ScaleExp({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(options.baseFrequency),this._octaves=options.octaves,this._inputBoost=new Gain({context:this.context}),this._bandpass=new Filter3({context:this.context,rolloff:-48,frequency:0,Q:options.Q}),this._peaking=new Filter3({context:this.context,type:"peaking"}),this._peaking.gain.value=options.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=options.sensitivity,readOnly(this,["gain","Q"])}static getDefaults(){return Object.assign(Effect.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(octaves){this._octaves=octaves,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(follower){this._follower.smoothing=follower}get baseFrequency(){return this._baseFrequency}set baseFrequency(baseFreq){this._baseFrequency=this.toFrequency(baseFreq),this._setSweepRange()}get sensitivity(){return gainToDb(1/this._inputBoost.gain.value)}set sensitivity(sensitivity){this._inputBoost.gain.value=1/dbToGain(sensitivity)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}};var workletName2="bit-crusher",bitCrusherWorklet=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;registerProcessor(workletName2,bitCrusherWorklet);var BitCrusher=class extends Effect{constructor(){super(optionsFromArguments(BitCrusher.getDefaults(),arguments,["bits"]));this.name="BitCrusher";let options=optionsFromArguments(BitCrusher.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new BitCrusherWorklet({context:this.context,bits:options.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(Effect.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}},BitCrusherWorklet=class extends ToneAudioWorklet{constructor(){super(optionsFromArguments(BitCrusherWorklet.getDefaults(),arguments));this.name="BitCrusherWorklet";let options=optionsFromArguments(BitCrusherWorklet.getDefaults(),arguments);this.input=new Gain({context:this.context}),this.output=new Gain({context:this.context}),this.bits=new Param({context:this.context,value:options.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(ToneAudioWorklet.getDefaults(),{bits:12})}_audioWorkletName(){return workletName2}onReady(node){connectSeries(this.input,node,this.output);let bits=node.parameters.get("bits");this.bits.setParam(bits)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}};var Chebyshev=class extends Effect{constructor(){super(optionsFromArguments(Chebyshev.getDefaults(),arguments,["order"]));this.name="Chebyshev";let options=optionsFromArguments(Chebyshev.getDefaults(),arguments,["order"]);this._shaper=new WaveShaper({context:this.context,length:4096}),this._order=options.order,this.connectEffect(this._shaper),this.order=options.order,this.oversample=options.oversample}static getDefaults(){return Object.assign(Effect.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(x,degree,memo){return memo.has(degree)||(degree===0?memo.set(degree,0):degree===1?memo.set(degree,x):memo.set(degree,2*x*this._getCoefficient(x,degree-1,memo)-this._getCoefficient(x,degree-2,memo))),memo.get(degree)}get order(){return this._order}set order(order){this._order=order,this._shaper.setMap(x=>this._getCoefficient(x,order,new Map))}get oversample(){return this._shaper.oversample}set oversample(oversampling){this._shaper.oversample=oversampling}dispose(){return super.dispose(),this._shaper.dispose(),this}};var Split=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Split.getDefaults(),arguments,["channels"]));this.name="Split";let options=optionsFromArguments(Split.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(options.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}};var Merge=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Merge.getDefaults(),arguments,["channels"]));this.name="Merge";let options=optionsFromArguments(Merge.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(options.channels)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}};var StereoEffect=class extends ToneAudioNode{constructor(options){super(options);this.name="StereoEffect",this.input=new Gain({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new CrossFade({context:this.context,fade:options.wet}),this.wet=this._dryWet.fade,this._split=new Split({context:this.context,channels:2}),this._merge=new Merge({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),readOnly(this,["wet"])}connectEffectLeft(...nodes){this._split.connect(nodes[0],0,0),connectSeries(...nodes),connect(nodes[nodes.length-1],this._merge,0,0)}connectEffectRight(...nodes){this._split.connect(nodes[0],1,0),connectSeries(...nodes),connect(nodes[nodes.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}};var StereoFeedbackEffect=class extends StereoEffect{constructor(options){super(options);this.feedback=new Signal2({context:this.context,value:options.feedback,units:"normalRange"}),this._feedbackL=new Gain({context:this.context}),this._feedbackR=new Gain({context:this.context}),this._feedbackSplit=new Split({context:this.context,channels:2}),this._feedbackMerge=new Merge({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),readOnly(this,["feedback"])}static getDefaults(){return Object.assign(StereoEffect.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}};var Chorus=class extends StereoFeedbackEffect{constructor(){super(optionsFromArguments(Chorus.getDefaults(),arguments,["frequency","delayTime","depth"]));this.name="Chorus";let options=optionsFromArguments(Chorus.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=options.depth,this._delayTime=options.delayTime/1e3,this._lfoL=new LFO({context:this.context,frequency:options.frequency,min:0,max:1}),this._lfoR=new LFO({context:this.context,frequency:options.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Delay({context:this.context}),this._delayNodeR=new Delay({context:this.context}),this.frequency=this._lfoL.frequency,readOnly(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=options.type,this.spread=options.spread}static getDefaults(){return Object.assign(StereoFeedbackEffect.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(depth){this._depth=depth;let deviation=this._delayTime*depth;this._lfoL.min=Math.max(this._delayTime-deviation,0),this._lfoL.max=this._delayTime+deviation,this._lfoR.min=Math.max(this._delayTime-deviation,0),this._lfoR.max=this._delayTime+deviation}get delayTime(){return this._delayTime*1e3}set delayTime(delayTime){this._delayTime=delayTime/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(type){this._lfoL.type=type,this._lfoR.type=type}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(spread){this._lfoL.phase=90-spread/2,this._lfoR.phase=spread/2+90}start(time){return this._lfoL.start(time),this._lfoR.start(time),this}stop(time){return this._lfoL.stop(time),this._lfoR.stop(time),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}};var Distortion=class extends Effect{constructor(){super(optionsFromArguments(Distortion.getDefaults(),arguments,["distortion"]));this.name="Distortion";let options=optionsFromArguments(Distortion.getDefaults(),arguments,["distortion"]);this._shaper=new WaveShaper({context:this.context,length:4096}),this._distortion=options.distortion,this.connectEffect(this._shaper),this.distortion=options.distortion,this.oversample=options.oversample}static getDefaults(){return Object.assign(Effect.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(amount){this._distortion=amount;let k=amount*100,deg=Math.PI/180;this._shaper.setMap(x=>Math.abs(x)<.001?0:(3+k)*x*20*deg/(Math.PI+k*Math.abs(x)))}get oversample(){return this._shaper.oversample}set oversample(oversampling){this._shaper.oversample=oversampling}dispose(){return super.dispose(),this._shaper.dispose(),this}};var FeedbackEffect=class extends Effect{constructor(options){super(options);this.name="FeedbackEffect",this._feedbackGain=new Gain({context:this.context,gain:options.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,readOnly(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Effect.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}};var FeedbackDelay=class extends FeedbackEffect{constructor(){super(optionsFromArguments(FeedbackDelay.getDefaults(),arguments,["delayTime","feedback"]));this.name="FeedbackDelay";let options=optionsFromArguments(FeedbackDelay.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Delay({context:this.context,delayTime:options.delayTime,maxDelay:options.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),readOnly(this,"delayTime")}static getDefaults(){return Object.assign(FeedbackEffect.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}};var PhaseShiftAllpass=class extends ToneAudioNode{constructor(options){super(options);this.name="PhaseShiftAllpass",this.input=new Gain({context:this.context}),this.output=new Gain({context:this.context}),this.offset90=new Gain({context:this.context});let allpassBank1Values=[.6923878,.9360654322959,.988229522686,.9987488452737],allpassBank2Values=[.4021921162426,.856171088242,.9722909545651,.9952884791278];this._bank0=this._createAllPassFilterBank(allpassBank1Values),this._bank1=this._createAllPassFilterBank(allpassBank2Values),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),connectSeries(this.input,...this._bank0,this._oneSampleDelay,this.output),connectSeries(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(bankValues){return bankValues.map(value=>{let coefficients=[[value*value,0,-1],[1,0,-(value*value)]];return this.context.createIIRFilter(coefficients[0],coefficients[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(f=>f.disconnect()),this._bank1.forEach(f=>f.disconnect()),this._oneSampleDelay.disconnect(),this}};var FrequencyShifter=class extends Effect{constructor(){super(optionsFromArguments(FrequencyShifter.getDefaults(),arguments,["frequency"]));this.name="FrequencyShifter";let options=optionsFromArguments(FrequencyShifter.getDefaults(),arguments,["frequency"]);this.frequency=new Signal2({context:this.context,units:"frequency",value:options.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new ToneOscillatorNode({context:this.context,type:"sine"}),this._cosine=new Oscillator({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new Multiply({context:this.context}),this._cosineMultiply=new Multiply({context:this.context}),this._negate=new Negate({context:this.context}),this._add=new Add({context:this.context}),this._phaseShifter=new PhaseShiftAllpass({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);let now2=this.immediate();this._sine.start(now2),this._cosine.start(now2)}static getDefaults(){return Object.assign(Effect.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}};var combFilterTunings=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],allpassFilterFrequencies=[225,556,441,341],Freeverb=class extends StereoEffect{constructor(){super(optionsFromArguments(Freeverb.getDefaults(),arguments,["roomSize","dampening"]));this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];let options=optionsFromArguments(Freeverb.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new Signal2({context:this.context,value:options.roomSize,units:"normalRange"}),this._allpassFiltersL=allpassFilterFrequencies.map(freq=>{let allpassL=this.context.createBiquadFilter();return allpassL.type="allpass",allpassL.frequency.value=freq,allpassL}),this._allpassFiltersR=allpassFilterFrequencies.map(freq=>{let allpassR=this.context.createBiquadFilter();return allpassR.type="allpass",allpassR.frequency.value=freq,allpassR}),this._combFilters=combFilterTunings.map((delayTime,index3)=>{let lfpf=new LowpassCombFilter({context:this.context,dampening:options.dampening,delayTime});return index3<combFilterTunings.length/2?this.connectEffectLeft(lfpf,...this._allpassFiltersL):this.connectEffectRight(lfpf,...this._allpassFiltersR),this.roomSize.connect(lfpf.resonance),lfpf}),readOnly(this,["roomSize"])}static getDefaults(){return Object.assign(StereoEffect.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(d){this._combFilters.forEach(c=>c.dampening=d)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(al=>al.disconnect()),this._allpassFiltersR.forEach(ar=>ar.disconnect()),this._combFilters.forEach(cf=>cf.dispose()),this.roomSize.dispose(),this}};var combFilterDelayTimes=[1687/25e3,1601/25e3,2053/25e3,2251/25e3],combFilterResonances=[.773,.802,.753,.733],allpassFilterFreqs=[347,113,37],JCReverb=class extends StereoEffect{constructor(){super(optionsFromArguments(JCReverb.getDefaults(),arguments,["roomSize"]));this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];let options=optionsFromArguments(JCReverb.getDefaults(),arguments,["roomSize"]);this.roomSize=new Signal2({context:this.context,value:options.roomSize,units:"normalRange"}),this._scaleRoomSize=new Scale({context:this.context,min:-.733,max:.197}),this._allpassFilters=allpassFilterFreqs.map(freq=>{let allpass=this.context.createBiquadFilter();return allpass.type="allpass",allpass.frequency.value=freq,allpass}),this._feedbackCombFilters=combFilterDelayTimes.map((delayTime,index3)=>{let fbcf=new FeedbackCombFilter({context:this.context,delayTime});return this._scaleRoomSize.connect(fbcf.resonance),fbcf.resonance.value=combFilterResonances[index3],index3<combFilterDelayTimes.length/2?this.connectEffectLeft(...this._allpassFilters,fbcf):this.connectEffectRight(...this._allpassFilters,fbcf),fbcf}),this.roomSize.connect(this._scaleRoomSize),readOnly(this,["roomSize"])}static getDefaults(){return Object.assign(StereoEffect.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(apf=>apf.disconnect()),this._feedbackCombFilters.forEach(fbcf=>fbcf.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}};var StereoXFeedbackEffect=class extends StereoFeedbackEffect{constructor(options){super(options);this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),readOnly(this,["feedback"])}};var PingPongDelay=class extends StereoXFeedbackEffect{constructor(){super(optionsFromArguments(PingPongDelay.getDefaults(),arguments,["delayTime","feedback"]));this.name="PingPongDelay";let options=optionsFromArguments(PingPongDelay.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Delay({context:this.context,maxDelay:options.maxDelay}),this._rightDelay=new Delay({context:this.context,maxDelay:options.maxDelay}),this._rightPreDelay=new Delay({context:this.context,maxDelay:options.maxDelay}),this.delayTime=new Signal2({context:this.context,units:"time",value:options.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),readOnly(this,["delayTime"])}static getDefaults(){return Object.assign(StereoXFeedbackEffect.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}};var PitchShift=class extends FeedbackEffect{constructor(){super(optionsFromArguments(PitchShift.getDefaults(),arguments,["pitch"]));this.name="PitchShift";let options=optionsFromArguments(PitchShift.getDefaults(),arguments,["pitch"]);this._frequency=new Signal2({context:this.context}),this._delayA=new Delay({maxDelay:1,context:this.context}),this._lfoA=new LFO({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Delay({maxDelay:1,context:this.context}),this._lfoB=new LFO({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new CrossFade({context:this.context}),this._crossFadeLFO=new LFO({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Delay({delayTime:options.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,readOnly(this,"delayTime"),this._pitch=options.pitch,this._windowSize=options.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);let now2=this.now();this._lfoA.start(now2),this._lfoB.start(now2),this._crossFadeLFO.start(now2),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(FeedbackEffect.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(interval){this._pitch=interval;let factor=0;interval<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,factor=intervalToFrequencyRatio(interval-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,factor=intervalToFrequencyRatio(interval)-1),this._frequency.value=factor*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(size){this._windowSize=this.toSeconds(size),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}};var Phaser=class extends StereoEffect{constructor(){super(optionsFromArguments(Phaser.getDefaults(),arguments,["frequency","octaves","baseFrequency"]));this.name="Phaser";let options=optionsFromArguments(Phaser.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new LFO({context:this.context,frequency:options.frequency,min:0,max:1}),this._lfoR=new LFO({context:this.context,frequency:options.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(options.baseFrequency),this._octaves=options.octaves,this.Q=new Signal2({context:this.context,value:options.Q,units:"positive"}),this._filtersL=this._makeFilters(options.stages,this._lfoL),this._filtersR=this._makeFilters(options.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=options.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=options.baseFrequency,this.octaves=options.octaves,this._lfoL.start(),this._lfoR.start(),readOnly(this,["frequency","Q"])}static getDefaults(){return Object.assign(StereoEffect.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(stages,connectToFreq){let filters2=[];for(let i=0;i<stages;i++){let filter=this.context.createBiquadFilter();filter.type="allpass",this.Q.connect(filter.Q),connectToFreq.connect(filter.frequency),filters2.push(filter)}return filters2}get octaves(){return this._octaves}set octaves(octaves){this._octaves=octaves;let max=this._baseFrequency*Math.pow(2,octaves);this._lfoL.max=max,this._lfoR.max=max}get baseFrequency(){return this._baseFrequency}set baseFrequency(freq){this._baseFrequency=this.toFrequency(freq),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(f=>f.disconnect()),this._filtersR.forEach(f=>f.disconnect()),this.frequency.dispose(),this}};var Reverb=class extends Effect{constructor(){super(optionsFromArguments(Reverb.getDefaults(),arguments,["decay"]));this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();let options=optionsFromArguments(Reverb.getDefaults(),arguments,["decay"]);this._decay=options.decay,this._preDelay=options.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Effect.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(time){time=this.toSeconds(time),assertRange(time,.001),this._decay=time,this.generate()}get preDelay(){return this._preDelay}set preDelay(time){time=this.toSeconds(time),assertRange(time,0),this._preDelay=time,this.generate()}generate(){return __awaiter2(this,void 0,void 0,function*(){let previousReady=this.ready,context4=new OfflineContext(2,this._decay+this._preDelay,this.context.sampleRate),noiseL=new Noise({context:context4}),noiseR=new Noise({context:context4}),merge=new Merge({context:context4});noiseL.connect(merge,0,0),noiseR.connect(merge,0,1);let gainNode=new Gain({context:context4}).toDestination();merge.connect(gainNode),noiseL.start(0),noiseR.start(0),gainNode.gain.setValueAtTime(0,0),gainNode.gain.setValueAtTime(1,this._preDelay),gainNode.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);let renderPromise=context4.render();return this.ready=renderPromise.then(noOp),yield previousReady,this._convolver.buffer=(yield renderPromise).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}};var MidSideSplit=class extends ToneAudioNode{constructor(){super(optionsFromArguments(MidSideSplit.getDefaults(),arguments));this.name="MidSideSplit",this._split=this.input=new Split({channels:2,context:this.context}),this._midAdd=new Add({context:this.context}),this.mid=new Multiply({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Subtract({context:this.context}),this.side=new Multiply({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}};var MidSideMerge=class extends ToneAudioNode{constructor(){super(optionsFromArguments(MidSideMerge.getDefaults(),arguments));this.name="MidSideMerge",this.mid=new Gain({context:this.context}),this.side=new Gain({context:this.context}),this._left=new Add({context:this.context}),this._leftMult=new Multiply({context:this.context,value:Math.SQRT1_2}),this._right=new Subtract({context:this.context}),this._rightMult=new Multiply({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Merge({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}};var MidSideEffect=class extends Effect{constructor(options){super(options);this.name="MidSideEffect",this._midSideMerge=new MidSideMerge({context:this.context}),this._midSideSplit=new MidSideSplit({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...nodes){this._midSend.chain(...nodes,this._midReturn)}connectEffectSide(...nodes){this._sideSend.chain(...nodes,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}};var StereoWidener=class extends MidSideEffect{constructor(){super(optionsFromArguments(StereoWidener.getDefaults(),arguments,["width"]));this.name="StereoWidener";let options=optionsFromArguments(StereoWidener.getDefaults(),arguments,["width"]);this.width=new Signal2({context:this.context,value:options.width,units:"normalRange"}),readOnly(this,["width"]),this._twoTimesWidthMid=new Multiply({context:this.context,value:2}),this._twoTimesWidthSide=new Multiply({context:this.context,value:2}),this._midMult=new Multiply({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Subtract({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),connect(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new Multiply({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(MidSideEffect.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}};var Tremolo=class extends StereoEffect{constructor(){super(optionsFromArguments(Tremolo.getDefaults(),arguments,["frequency","depth"]));this.name="Tremolo";let options=optionsFromArguments(Tremolo.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new LFO({context:this.context,type:options.type,min:1,max:0}),this._lfoR=new LFO({context:this.context,type:options.type,min:1,max:0}),this._amplitudeL=new Gain({context:this.context}),this._amplitudeR=new Gain({context:this.context}),this.frequency=new Signal2({context:this.context,value:options.frequency,units:"frequency"}),this.depth=new Signal2({context:this.context,value:options.depth,units:"normalRange"}),readOnly(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=options.spread}static getDefaults(){return Object.assign(StereoEffect.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(time){return this._lfoL.start(time),this._lfoR.start(time),this}stop(time){return this._lfoL.stop(time),this._lfoR.stop(time),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(type){this._lfoL.type=type,this._lfoR.type=type}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(spread){this._lfoL.phase=90-spread/2,this._lfoR.phase=spread/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}};var Vibrato=class extends Effect{constructor(){super(optionsFromArguments(Vibrato.getDefaults(),arguments,["frequency","depth"]));this.name="Vibrato";let options=optionsFromArguments(Vibrato.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new Delay({context:this.context,delayTime:0,maxDelay:options.maxDelay}),this._lfo=new LFO({context:this.context,type:options.type,min:0,max:options.maxDelay,frequency:options.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=options.depth,readOnly(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Effect.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(type){this._lfo.type=type}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}};var Analyser=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Analyser.getDefaults(),arguments,["type","size"]));this.name="Analyser",this._analysers=[],this._buffers=[];let options=optionsFromArguments(Analyser.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new Gain({context:this.context}),this._split=new Split({context:this.context,channels:options.channels}),this.input.connect(this._split),assertRange(options.channels,1);for(let channel=0;channel<options.channels;channel++)this._analysers[channel]=this.context.createAnalyser(),this._split.connect(this._analysers[channel],channel,0);this.size=options.size,this.type=options.type}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((analyser,index3)=>{let buffer=this._buffers[index3];this._type==="fft"?analyser.getFloatFrequencyData(buffer):this._type==="waveform"&&analyser.getFloatTimeDomainData(buffer)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(size){this._analysers.forEach((analyser,index3)=>{analyser.fftSize=size*2,this._buffers[index3]=new Float32Array(size)})}get channels(){return this._analysers.length}get type(){return this._type}set type(type){assert(type==="waveform"||type==="fft",`Analyser: invalid type: ${type}`),this._type=type}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(val){this._analysers.forEach(a=>a.smoothingTimeConstant=val)}dispose(){return super.dispose(),this._analysers.forEach(a=>a.disconnect()),this._split.dispose(),this._gain.dispose(),this}};var MeterBase=class extends ToneAudioNode{constructor(){super(optionsFromArguments(MeterBase.getDefaults(),arguments));this.name="MeterBase",this.input=this.output=this._analyser=new Analyser({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}};var Meter=class extends MeterBase{constructor(){super(optionsFromArguments(Meter.getDefaults(),arguments,["smoothing"]));this.name="Meter",this._rms=0;let options=optionsFromArguments(Meter.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new Analyser({context:this.context,size:256,type:"waveform",channels:options.channels}),this.smoothing=options.smoothing,this.normalRange=options.normalRange}static getDefaults(){return Object.assign(MeterBase.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return warn("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){let aValues=this._analyser.getValue(),vals=(this.channels===1?[aValues]:aValues).map(values=>{let totalSquared=values.reduce((total,current)=>total+current*current,0),rms=Math.sqrt(totalSquared/values.length);return this._rms=Math.max(rms,this._rms*this.smoothing),this.normalRange?this._rms:gainToDb(this._rms)});return this.channels===1?vals[0]:vals}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}};var FFT=class extends MeterBase{constructor(){super(optionsFromArguments(FFT.getDefaults(),arguments,["size"]));this.name="FFT";let options=optionsFromArguments(FFT.getDefaults(),arguments,["size"]);this.normalRange=options.normalRange,this._analyser.type="fft",this.size=options.size}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(v=>this.normalRange?dbToGain(v):v)}get size(){return this._analyser.size}set size(size){this._analyser.size=size}get smoothing(){return this._analyser.smoothing}set smoothing(val){this._analyser.smoothing=val}getFrequencyOfIndex(index3){return assert(0<=index3&&index3<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),index3*this.context.sampleRate/(this.size*2)}};var DCMeter=class extends MeterBase{constructor(){super(optionsFromArguments(DCMeter.getDefaults(),arguments));this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}};var Waveform=class extends MeterBase{constructor(){super(optionsFromArguments(Waveform.getDefaults(),arguments,["size"]));this.name="Waveform";let options=optionsFromArguments(Waveform.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=options.size}static getDefaults(){return Object.assign(MeterBase.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(size){this._analyser.size=size}};var Solo=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Solo.getDefaults(),arguments,["solo"]));this.name="Solo";let options=optionsFromArguments(Solo.getDefaults(),arguments,["solo"]);this.input=this.output=new Gain({context:this.context}),Solo._allSolos.has(this.context)||Solo._allSolos.set(this.context,new Set),Solo._allSolos.get(this.context).add(this),this.solo=options.solo}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(solo){solo?this._addSolo():this._removeSolo(),Solo._allSolos.get(this.context).forEach(instance=>instance._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Solo._soloed.has(this.context)||Solo._soloed.set(this.context,new Set),Solo._soloed.get(this.context).add(this)}_removeSolo(){Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).delete(this)}_isSoloed(){return Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).has(this)}_noSolos(){return!Solo._soloed.has(this.context)||Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Solo._allSolos.get(this.context).delete(this),this._removeSolo(),this}};Solo._allSolos=new Map;Solo._soloed=new Map;var PanVol=class extends ToneAudioNode{constructor(){super(optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]));this.name="PanVol";let options=optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Panner({context:this.context,pan:options.pan,channelCount:options.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Volume({context:this.context,volume:options.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=options.mute,readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(mute){this._volume.mute=mute}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}};var Channel=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]));this.name="Channel";let options=optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Solo({solo:options.solo,context:this.context}),this._panVol=this.output=new PanVol({context:this.context,pan:options.pan,volume:options.volume,mute:options.mute,channelCount:options.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(solo){this._solo.solo=solo}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(mute){this._panVol.mute=mute}_getBus(name){return Channel.buses.has(name)||Channel.buses.set(name,new Gain({context:this.context})),Channel.buses.get(name)}send(name,volume=0){let bus=this._getBus(name),sendKnob=new Gain({context:this.context,units:"decibels",gain:volume});return this.connect(sendKnob),sendKnob.connect(bus),sendKnob}receive(name){return this._getBus(name).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}};Channel.buses=new Map;var Mono=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Mono.getDefaults(),arguments));this.name="Mono",this.input=new Gain({context:this.context}),this._merge=this.output=new Merge({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}};var MultibandSplit=class extends ToneAudioNode{constructor(){super(optionsFromArguments(MultibandSplit.getDefaults(),arguments,["lowFrequency","highFrequency"]));this.name="MultibandSplit",this.input=new Gain({context:this.context}),this.output=void 0,this.low=new Filter3({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Filter3({context:this.context,frequency:0,type:"highpass"}),this.mid=new Filter3({context:this.context,frequency:0,type:"lowpass"}),this.high=new Filter3({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];let options=optionsFromArguments(MultibandSplit.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new Signal2({context:this.context,units:"frequency",value:options.lowFrequency}),this.highFrequency=new Signal2({context:this.context,units:"frequency",value:options.highFrequency}),this.Q=new Signal2({context:this.context,units:"positive",value:options.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),readOnly(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),writable(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}};var Listener=class extends ToneAudioNode{constructor(){super(...arguments);this.name="Listener",this.positionX=new Param({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Param({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Param({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Param({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Param({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Param({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Param({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Param({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Param({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}};onContextInit(context4=>{context4.listener=new Listener({context:context4})});onContextClose(context4=>{context4.listener.dispose()});var Panner3D=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Panner3D.getDefaults(),arguments,["positionX","positionY","positionZ"]));this.name="Panner3D";let options=optionsFromArguments(Panner3D.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=options.panningModel,this.maxDistance=options.maxDistance,this.distanceModel=options.distanceModel,this.coneOuterGain=options.coneOuterGain,this.coneOuterAngle=options.coneOuterAngle,this.coneInnerAngle=options.coneInnerAngle,this.refDistance=options.refDistance,this.rolloffFactor=options.rolloffFactor,this.positionX=new Param({context:this.context,param:this._panner.positionX,value:options.positionX}),this.positionY=new Param({context:this.context,param:this._panner.positionY,value:options.positionY}),this.positionZ=new Param({context:this.context,param:this._panner.positionZ,value:options.positionZ}),this.orientationX=new Param({context:this.context,param:this._panner.orientationX,value:options.orientationX}),this.orientationY=new Param({context:this.context,param:this._panner.orientationY,value:options.orientationY}),this.orientationZ=new Param({context:this.context,param:this._panner.orientationZ,value:options.orientationZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(x,y,z){return this.positionX.value=x,this.positionY.value=y,this.positionZ.value=z,this}setOrientation(x,y,z){return this.orientationX.value=x,this.orientationY.value=y,this.orientationZ.value=z,this}get panningModel(){return this._panner.panningModel}set panningModel(val){this._panner.panningModel=val}get refDistance(){return this._panner.refDistance}set refDistance(val){this._panner.refDistance=val}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(val){this._panner.rolloffFactor=val}get distanceModel(){return this._panner.distanceModel}set distanceModel(val){this._panner.distanceModel=val}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(val){this._panner.coneInnerAngle=val}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(val){this._panner.coneOuterAngle=val}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(val){this._panner.coneOuterGain=val}get maxDistance(){return this._panner.maxDistance}set maxDistance(val){this._panner.maxDistance=val}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}};var Recorder=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Recorder.getDefaults(),arguments));this.name="Recorder";let options=optionsFromArguments(Recorder.getDefaults(),arguments);this.input=new Gain({context:this.context}),assert(Recorder.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:options.mimeType})}static getDefaults(){return ToneAudioNode.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return theWindow!==null&&Reflect.has(theWindow,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return __awaiter2(this,void 0,void 0,function*(){assert(this.state!=="started","Recorder is already started");let startPromise=new Promise(done=>{let handleStart=()=>{this._recorder.removeEventListener("start",handleStart,!1),done()};this._recorder.addEventListener("start",handleStart,!1)});return this._recorder.start(),yield startPromise})}stop(){return __awaiter2(this,void 0,void 0,function*(){assert(this.state!=="stopped","Recorder is not started");let dataPromise=new Promise(done=>{let handleData=e=>{this._recorder.removeEventListener("dataavailable",handleData,!1),done(e.data)};this._recorder.addEventListener("dataavailable",handleData,!1)});return this._recorder.stop(),yield dataPromise})}pause(){return assert(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}};var Compressor=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Compressor.getDefaults(),arguments,["threshold","ratio"]));this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;let options=optionsFromArguments(Compressor.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new Param({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:options.threshold}),this.attack=new Param({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:options.attack}),this.release=new Param({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:options.release}),this.knee=new Param({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:options.knee}),this.ratio=new Param({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:options.ratio}),readOnly(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}};var Gate=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Gate.getDefaults(),arguments,["threshold","smoothing"])));this.name="Gate";let options=optionsFromArguments(Gate.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new Follower({context:this.context,smoothing:options.smoothing}),this._gt=new GreaterThan({context:this.context,value:dbToGain(options.threshold)}),this.input=new Gain({context:this.context}),this._gate=this.output=new Gain({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return gainToDb(this._gt.value)}set threshold(thresh){this._gt.value=dbToGain(thresh)}get smoothing(){return this._follower.smoothing}set smoothing(smoothingTime){this._follower.smoothing=smoothingTime}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}};var Limiter=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Limiter.getDefaults(),arguments,["threshold"])));this.name="Limiter";let options=optionsFromArguments(Limiter.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new Compressor({context:this.context,ratio:20,attack:.003,release:.01,threshold:options.threshold}),this.threshold=this._compressor.threshold,readOnly(this,"threshold")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}};var MidSideCompressor=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(MidSideCompressor.getDefaults(),arguments)));this.name="MidSideCompressor";let options=optionsFromArguments(MidSideCompressor.getDefaults(),arguments);this._midSideSplit=this.input=new MidSideSplit({context:this.context}),this._midSideMerge=this.output=new MidSideMerge({context:this.context}),this.mid=new Compressor(Object.assign(options.mid,{context:this.context})),this.side=new Compressor(Object.assign(options.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),readOnly(this,["mid","side"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}};var MultibandCompressor=class extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(MultibandCompressor.getDefaults(),arguments)));this.name="MultibandCompressor";let options=optionsFromArguments(MultibandCompressor.getDefaults(),arguments);this._splitter=this.input=new MultibandSplit({context:this.context,lowFrequency:options.lowFrequency,highFrequency:options.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new Gain({context:this.context}),this.low=new Compressor(Object.assign(options.low,{context:this.context})),this.mid=new Compressor(Object.assign(options.mid,{context:this.context})),this.high=new Compressor(Object.assign(options.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),readOnly(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}};var EQ3=class extends ToneAudioNode{constructor(){super(optionsFromArguments(EQ3.getDefaults(),arguments,["low","mid","high"]));this.name="EQ3",this.output=new Gain({context:this.context}),this._internalChannels=[];let options=optionsFromArguments(EQ3.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new MultibandSplit({context:this.context,highFrequency:options.highFrequency,lowFrequency:options.lowFrequency}),this._lowGain=new Gain({context:this.context,gain:options.low,units:"decibels"}),this._midGain=new Gain({context:this.context,gain:options.mid,units:"decibels"}),this._highGain=new Gain({context:this.context,gain:options.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),readOnly(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),writable(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}};var Convolver=class extends ToneAudioNode{constructor(){super(optionsFromArguments(Convolver.getDefaults(),arguments,["url","onload"]));this.name="Convolver",this._convolver=this.context.createConvolver();let options=optionsFromArguments(Convolver.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer(options.url,buffer=>{this.buffer=buffer,options.onload()}),this.input=new Gain({context:this.context}),this.output=new Gain({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=options.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{normalize:!0,onload:noOp})}load(url3){return __awaiter2(this,void 0,void 0,function*(){this.buffer=yield this._buffer.load(url3)})}get buffer(){return this._buffer.length?this._buffer:null}set buffer(buffer){buffer&&this._buffer.set(buffer),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));let buff=this._buffer.get();this._convolver.buffer=buff||null}get normalize(){return this._convolver.normalize}set normalize(norm){this._convolver.normalize=norm}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}};function now(){return getContext().now()}function immediate(){return getContext().immediate()}var Transport2=getContext().transport;function getTransport(){return getContext().transport}var Destination2=getContext().destination,Master=getContext().destination;function getDestination(){return getContext().destination}var Listener2=getContext().listener;function getListener(){return getContext().listener}var Draw2=getContext().draw;function getDraw(){return getContext().draw}var context3=getContext();function loaded(){return ToneAudioBuffer.loaded()}var Buffer4=ToneAudioBuffer,Buffers=ToneAudioBuffers,BufferSource=ToneBufferSource;var import_howler=__toModule(require_howler());var _ServerManager=class extends PsychObject{constructor({psychoJS,autoLog=!1}={}){super(psychoJS);this._session={},this._resources=new Map,this._nbLoadedResources=0,this._setupPreloadQueue(),this._addAttribute("autoLog",autoLog),this._addAttribute("status",_ServerManager.Status.READY)}getConfiguration(configURL){let response2={origin:"ServerManager.getConfiguration",context:"when reading the configuration file: "+configURL};this._psychoJS.logger.debug("reading the configuration file: "+configURL);let self2=this;return new Promise(async(resolve4,reject2)=>{try{let getResponse=await fetch(configURL,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer"});if(getResponse.status===404)throw"the configuration file could not be found";if(getResponse.status!==200)throw`unable to read the configuration file: status= ${getResponse.status}`;let config=await getResponse.json();resolve4(Object.assign(response2,{config}))}catch(error){self2.setStatus(_ServerManager.Status.ERROR),console.error("error:",error),reject2(Object.assign(response2,{error}))}})}openSession(params={}){let response2={origin:"ServerManager.openSession",context:"when opening a session for experiment: "+this._psychoJS.config.experiment.fullpath};this._psychoJS.logger.debug("opening a session for experiment: "+this._psychoJS.config.experiment.fullpath),this.setStatus(_ServerManager.Status.BUSY);let self2=this;return new Promise(async(resolve4,reject2)=>{try{let postResponse=await this._queryServerAPI("POST",`experiments/${this._psychoJS.config.gitlab.projectId}/sessions`,params,"FORM"),openSessionResponse=await postResponse.json();if(postResponse.status!==200)throw"error"in openSessionResponse?openSessionResponse.error:openSessionResponse;if(!("token"in openSessionResponse))throw self2.setStatus(_ServerManager.Status.ERROR),"unexpected answer from the server: no token";if(!("experiment"in openSessionResponse))throw self2.setStatus(_ServerManager.Status.ERROR),"unexpected answer from server: no experiment";self2._psychoJS.config.session={token:openSessionResponse.token,status:"OPEN"};let experiment=openSessionResponse.experiment;self2._psychoJS.config.experiment.status=experiment.status2,self2._psychoJS.config.experiment.saveFormat=Symbol.for(experiment.saveFormat),self2._psychoJS.config.experiment.saveIncompleteResults=experiment.saveIncompleteResults,self2._psychoJS.config.experiment.license=experiment.license,self2._psychoJS.config.experiment.runMode=experiment.runMode,"keys"in experiment?self2._psychoJS.config.experiment.keys=experiment.keys:self2._psychoJS.config.experiment.keys=[],self2.setStatus(_ServerManager.Status.READY),resolve4(__spreadProps(__spreadValues({},response2),{token:openSessionResponse.token,status:openSessionResponse.status}))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}async closeSession(isCompleted=!1,sync=!1){let response2={origin:"ServerManager.closeSession",context:"when closing the session for experiment: "+this._psychoJS.config.experiment.fullpath};if(this._psychoJS.logger.debug("closing the session for experiment: "+this._psychoJS.config.experiment.name),this.setStatus(_ServerManager.Status.BUSY),sync){let url3=this._psychoJS.config.pavlovia.URL+"/api/v2/experiments/"+this._psychoJS.config.gitlab.projectId+"/sessions/"+this._psychoJS.config.session.token+"/delete",formData=new FormData;formData.append("isCompleted",isCompleted),navigator.sendBeacon(url3,formData),this._psychoJS.config.session.status="CLOSED"}else{let self2=this;return new Promise(async(resolve4,reject2)=>{try{let deleteResponse=await this._queryServerAPI("DELETE",`experiments/${this._psychoJS.config.gitlab.projectId}/sessions/${this._psychoJS.config.session.token}`,{isCompleted},"FORM"),closeSessionResponse=await deleteResponse.json();if(deleteResponse.status!==200)throw"error"in closeSessionResponse?closeSessionResponse.error:closeSessionResponse;self2.setStatus(_ServerManager.Status.READY),self2._psychoJS.config.session.status="CLOSED",resolve4(__spreadValues(__spreadValues({},response2),closeSessionResponse))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}}getResource(name,errorIfNotDownloaded=!1){let response2={origin:"ServerManager.getResource",context:"when getting the value of resource: "+name},pathStatusData=this._resources.get(name);if(typeof pathStatusData=="undefined")throw Object.assign(response2,{error:"unknown resource"});if(errorIfNotDownloaded&&pathStatusData.status!==_ServerManager.ResourceStatus.DOWNLOADED)throw Object.assign(response2,{error:name+" is not available for use (yet), its current status is: "+toString(pathStatusData.status)});return pathStatusData.data}releaseResource(name){let response2={origin:"ServerManager.releaseResource",context:"when releasing resource: "+name};return typeof this._resources.get(name)=="undefined"?!1:(this._psychoJS.logger.debug(`releasing resource: ${name}`),this._resources.delete(name),!0)}getResourceStatus(names){let response2={origin:"ServerManager.getResourceStatus",context:`when getting the status of resource(s): ${JSON.stringify(names)}`};if(typeof names=="string"&&(names=[names]),!Array.isArray(names))throw Object.assign(response2,{error:"names should be either a string or an array of strings"});let statusOrder=new Map([[Symbol.keyFor(_ServerManager.ResourceStatus.ERROR),0],[Symbol.keyFor(_ServerManager.ResourceStatus.REGISTERED),1],[Symbol.keyFor(_ServerManager.ResourceStatus.DOWNLOADING),2],[Symbol.keyFor(_ServerManager.ResourceStatus.DOWNLOADED),3]]),reducedStatus=_ServerManager.ResourceStatus.DOWNLOADED;for(let name of names){let pathStatusData=this._resources.get(name);if(typeof pathStatusData=="undefined")throw Object.assign(response2,{error:`unable to find a previously registered resource with name: ${name}`});statusOrder.get(Symbol.keyFor(pathStatusData.status))<statusOrder.get(Symbol.keyFor(reducedStatus))&&(reducedStatus=pathStatusData.status)}return reducedStatus}setStatus(status){let response2={origin:"ServerManager.setStatus",context:"when changing the status of the server manager to: "+toString(status)},statusKey=typeof status=="symbol"?Symbol.keyFor(status):null;if(!statusKey)throw Object.assign(response2,{error:"status must be a symbol"});if(!_ServerManager.Status.hasOwnProperty(statusKey))throw Object.assign(response2,{error:"unknown status"});return this._status=status,this.emit(_ServerManager.Event.STATUS,this._status),this._status}resetStatus(){return this.setStatus(_ServerManager.Status.READY)}async prepareResources(resources3=[]){let response2={origin:"ServerManager.prepareResources",context:"when preparing resources for experiment: "+this._psychoJS.config.experiment.name};this._psychoJS.logger.debug("preparing resources for experiment: "+this._psychoJS.config.experiment.name);try{let resourcesToDownload=new Set;if(resources3!==null){if(typeof resources3=="string"&&(resources3=[resources3]),!Array.isArray(resources3))throw"resources should be either (a) a string or (b) an array of string or objects";let allResources=resources3.length===1&&resources3[0]===_ServerManager.ALL_RESOURCES;if(this._psychoJS.config.environment===ExperimentHandler.Environment.SERVER&&allResources){let serverResponse=await this._listResources();for(let name of serverResponse.resources)if(!this._resources.has(name)){let path=serverResponse.resourceDirectory+"/"+name;this._resources.set(name,{status:_ServerManager.ResourceStatus.REGISTERED,path,data:void 0}),this._psychoJS.logger.debug(`registered resource: name= ${name}, path= ${path}`),resourcesToDownload.add(name)}}else{if(this._psychoJS.config.environment===ExperimentHandler.Environment.LOCAL&&allResources)throw"resources must be manually specified when the experiment is running locally: ALL_RESOURCES cannot be used";for(let r=0;r<resources3.length;++r){typeof resources3[r]=="string"&&(resources3[r]={name:resources3[r],path:resources3[r],download:!0});let resource=resources3[r];if("surveyId"in resource){if(this._psychoJS.config.environment!==ExperimentHandler.Environment.SERVER)throw"survey models cannot be downloaded when the experiment is running locally";resources3[r]={name:`${resource.surveyId}.sid`,path:resource.surveyId,download:!0}}"surveyLibrary"in resource&&(resources3[r]={name:"jquery-3.6.0.min.js",path:"./lib/vendors/jquery-3.6.0.min.js",download:!0},resources3.push({name:"survey.jquery-1.9.50.min.js",path:"./lib/vendors/survey.jquery-1.9.50.min.js",download:!0}),resources3.push({name:"survey.defaultV2-1.9.50.min.css",path:"./lib/vendors/survey.defaultV2-1.9.50.min.css",download:!0}),resources3.push({name:"survey.widgets.css",path:"./lib/vendors/survey.widgets.css",download:!0}),resources3.push({name:"survey.grey_style.css",path:"./lib/vendors/survey.grey_style.css",download:!0}))}for(let{name,path,download}of resources3)this._resources.has(name)||((path.toLowerCase().indexOf("www.")===0||path.toLowerCase().indexOf("http:")===0||path.toLowerCase().indexOf("https:")===0)&&path.indexOf("pavlovia.org")===-1&&(path="https://pavlovia.org/api/v2/proxy/"+path),this._resources.set(name,{status:_ServerManager.ResourceStatus.REGISTERED,path,data:void 0}),this._psychoJS.logger.debug(`registered resource: name= ${name}, path= ${path}`),(typeof download=="undefined"||download)&&resourcesToDownload.add(name))}}return resourcesToDownload.size===0?(this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOAD_COMPLETED}),Promise.resolve()):new Promise((resolve4,reject2)=>{let uuid=this.on(_ServerManager.Event.RESOURCE,signal=>{signal.message===_ServerManager.Event.DOWNLOAD_COMPLETED&&(this.off(_ServerManager.Event.RESOURCE,uuid),resolve4())});this._downloadResources(resourcesToDownload)})}catch(error){throw console.error("error",error),Object.assign(response2,{error})}}waitForResources(resources3=[]){this._waitForDownloadComponent={status:PsychoJS.Status.NOT_STARTED,clock:new Clock,resources:new Set};let self2=this;return async()=>{let t=self2._waitForDownloadComponent.clock.getTime();if(t>=0&&self2._waitForDownloadComponent.status===PsychoJS.Status.NOT_STARTED){if(self2._waitForDownloadComponent.tStart=t,self2._waitForDownloadComponent.status=PsychoJS.Status.STARTED,resources3.length===0)for(let[name,{status,path,data}]of this._resources)resources3.push({name,path});let resourcesToDownload=new Set;for(let{name,path}of resources3){(path.toLowerCase().indexOf("www.")===0||path.toLowerCase().indexOf("http:")===0||path.toLowerCase().indexOf("https:")===0)&&path.indexOf("pavlovia.org")===-1&&(path="https://pavlovia.org/api/v2/proxy/"+path);let pathStatusData=this._resources.get(name);typeof pathStatusData=="undefined"?(self2._resources.set(name,{status:_ServerManager.ResourceStatus.REGISTERED,path,data:void 0}),self2._waitForDownloadComponent.resources.add(name),resourcesToDownload.add(name),self2._psychoJS.logger.debug("registered resource:",name,path)):typeof pathStatusData.status!==_ServerManager.ResourceStatus.DOWNLOADED&&self2._waitForDownloadComponent.resources.add(name)}self2._waitForDownloadComponent.status=PsychoJS.Status.STARTED,self2._downloadResources(resourcesToDownload)}if(self2._waitForDownloadComponent.status===PsychoJS.Status.STARTED){for(let name of self2._waitForDownloadComponent.resources)if(this._resources.get(name).status!==_ServerManager.ResourceStatus.DOWNLOADED)return Scheduler.Event.FLIP_REPEAT;return self2._waitForDownloadComponent.status=PsychoJS.Status.FINISHED,Scheduler.Event.NEXT}}}uploadData(key,value,sync=!1){let response2={origin:"ServerManager.uploadData",context:"when uploading participant's results for experiment: "+this._psychoJS.config.experiment.fullpath};this._psychoJS.logger.debug("uploading data for experiment: "+this._psychoJS.config.experiment.fullpath),this.setStatus(_ServerManager.Status.BUSY);let path=`experiments/${this._psychoJS.config.gitlab.projectId}/sessions/${this._psychoJS.config.session.token}/results`;if(sync){let formData=new FormData;formData.append("key",key),formData.append("value",value),navigator.sendBeacon(`${this._psychoJS.config.pavlovia.URL}/api/v2/${path}`,formData)}else{let self2=this;return new Promise(async(resolve4,reject2)=>{try{let postResponse=await this._queryServerAPI("POST",`experiments/${this._psychoJS.config.gitlab.projectId}/sessions/${this._psychoJS.config.session.token}/results`,{key,value},"FORM"),uploadDataResponse=await postResponse.json();if(postResponse.status!==200)throw"error"in uploadDataResponse?uploadDataResponse.error:uploadDataResponse;self2.setStatus(_ServerManager.Status.READY),resolve4(__spreadValues(__spreadValues({},response2),uploadDataResponse))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}}uploadLog(logs,compressed=!1){let response2={origin:"ServerManager.uploadLog",context:"when uploading participant's log for experiment: "+this._psychoJS.config.experiment.fullpath};this._psychoJS.logger.debug("uploading server log for experiment: "+this._psychoJS.config.experiment.fullpath),this.setStatus(_ServerManager.Status.BUSY);let info=this.psychoJS.experiment.extraInfo,data={filename:`${this.psychoJS.experiment.dataFileName.split(/[\\/]/).pop()}.log`,logs,compressed},self2=this;return new Promise(async(resolve4,reject2)=>{try{let postResponse=await this._queryServerAPI("POST",`experiments/${this._psychoJS.config.gitlab.projectId}/sessions/${self2._psychoJS.config.session.token}/logs`,data,"FORM"),uploadLogsResponse=await postResponse.json();if(postResponse.status!==200)throw"error"in uploadLogsResponse?uploadLogsResponse.error:uploadLogsResponse;self2.setStatus(_ServerManager.Status.READY),resolve4(__spreadValues(__spreadValues({},response2),uploadLogsResponse))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}async uploadAudioVideo({mediaBlob,tag,waitForCompletion=!1,showDialog=!1,dialogMsg="Please wait a few moments while the data is uploading to the server"}){let response2={origin:"ServerManager.uploadAudio",context:"when uploading media data for experiment: "+this._psychoJS.config.experiment.fullpath};try{if(this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER||this._psychoJS.config.experiment.status!=="RUNNING"||this._psychoJS._serverMsg.has("__pilotToken"))throw"media recordings can only be uploaded to the server for experiments running on the server";this._psychoJS.logger.debug(`uploading media data for experiment: ${this._psychoJS.config.experiment.fullpath}`),this.setStatus(_ServerManager.Status.BUSY),showDialog&&this.psychoJS.gui.dialog({warning:dialogMsg,showOK:!1});let info=this.psychoJS.experiment.extraInfo,participant=typeof info.participant=="string"&&info.participant.length>0?info.participant:"PARTICIPANT",experimentName=typeof info.expName!="undefined"?info.expName:this.psychoJS.config.experiment.name,datetime=typeof info.date!="undefined"?info.date:MonotonicClock.getDateStr(),filename=participant+"_"+experimentName+"_"+datetime+"_"+tag,formData=new FormData;formData.append("media",mediaBlob,filename);let url3=this._psychoJS.config.pavlovia.URL+"/api/v2/experiments/"+this._psychoJS.config.gitlab.projectId+"/sessions/"+this._psychoJS.config.session.token+"/media",response3=await fetch(url3,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",body:formData}),postMediaResponse=await response3.json();if(this._psychoJS.logger.debug(`post media response: ${JSON.stringify(postMediaResponse)}`),!response3.ok)throw postMediaResponse;if(waitForCompletion){if(!("uploadToken"in postMediaResponse))throw"incorrect server response: missing uploadToken";let uploadToken=postMediaResponse.uploadToken;for(;;){await new Promise(r=>{setTimeout(r,1e3)}),url3=this._psychoJS.config.pavlovia.URL+"/api/v2/experiments/"+this._psychoJS.config.gitlab.projectId+"/sessions/"+this._psychoJS.config.session.token+"/media/"+uploadToken+"/status",response3=await fetch(url3,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer"});let checkStatusResponse=await response3.json();if(this._psychoJS.logger.debug(`check upload status response: ${JSON.stringify(checkStatusResponse)}`),"status"in checkStatusResponse&&checkStatusResponse.status==="COMPLETED")break}}return showDialog&&this.psychoJS.gui.closeDialog(),this.setStatus(_ServerManager.Status.READY),postMediaResponse}catch(error){throw this.setStatus(_ServerManager.Status.ERROR),console.error(error),__spreadProps(__spreadValues({},response2),{error})}}async uploadSurveyResponse(surveyId,surveyResponse,isComplete){let response2={origin:"ServerManager.uploadSurveyResponse",context:`when uploading the survey response for experiment: ${this._psychoJS.config.experiment.fullpath} and survey: ${surveyId}`};if(this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER||this._psychoJS.config.experiment.status!=="RUNNING"||this._psychoJS._serverMsg.has("__pilotToken"))throw"survey responses can only be uploaded to the server for experiments running on the server";this._psychoJS.logger.debug(`uploading a survey response for experiment: ${this._psychoJS.config.experiment.fullpath} and survey: ${surveyId}`),this.setStatus(_ServerManager.Status.BUSY);let self2=this;return new Promise(async(resolve4,reject2)=>{try{let info=this._psychoJS.experiment.extraInfo,participant=typeof info.participant=="string"&&info.participant.length>0?info.participant:"PARTICIPANT",postResponse=await this._queryServerAPI("POST",`surveys/${surveyId}`,{experimentId:this._psychoJS.config.gitlab.projectId,sessionToken:this._psychoJS.config.session.token,participant,surveyResponse,isComplete},"JSON"),uploadDataResponse=await postResponse.json();if(postResponse.status!==200)throw"error"in uploadDataResponse?uploadDataResponse.error:uploadDataResponse;self2.setStatus(_ServerManager.Status.READY),resolve4(__spreadValues(__spreadValues({},response2),uploadDataResponse))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}async getSurveyExperimentParameters(surveyId,experimentInfo){let response2={origin:"ServerManager.getSurveyExperimentParameters",context:`when downloading the experiment parameters for survey: ${surveyId}`};if(this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER)throw"survey experiment parameters cannot be downloaded when the experiment is running locally";this._psychoJS.logger.debug(`downloading the experiment parameters of survey: ${surveyId}`),this.setStatus(_ServerManager.Status.BUSY);let self2=this;return new Promise(async(resolve4,reject2)=>{try{let getResponse=await this._queryServerAPI("GET",`surveys/${surveyId}/experiment`),getExperimentParametersResponse=await getResponse.json();if(getResponse.status!==200)throw"error"in getExperimentParametersResponse?getExperimentParametersResponse.error:getExperimentParametersResponse;if(getExperimentParametersResponse.experimentParameters===null)throw"either there is no survey with the given id, or it is not currently active";let experimentParameters=getExperimentParametersResponse.experimentParameters;for(let parameter in experimentParameters)typeof experimentInfo[parameter]=="undefined"&&(experimentInfo[parameter]=experimentParameters[parameter]);self2.setStatus(_ServerManager.Status.READY),resolve4(__spreadValues(__spreadValues({},response2),getExperimentParametersResponse))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}_listResources(){let response2={origin:"ServerManager._listResourcesSession",context:"when listing the resources for experiment: "+this._psychoJS.config.experiment.fullpath};this._psychoJS.logger.debug(`listing the resources for experiment: ${this._psychoJS.config.experiment.fullpath}`),this.setStatus(_ServerManager.Status.BUSY);let data={token:this._psychoJS.config.session.token},self2=this;return new Promise(async(resolve4,reject2)=>{try{let getResourcesResponse=await(await this._queryServerAPI("GET",`experiments/${this._psychoJS.config.gitlab.projectId}/resources`,data)).json();if(!("resources"in getResourcesResponse))throw self2.setStatus(_ServerManager.Status.ERROR),"unexpected answer from server: no resources";if(!("resourceDirectory"in getResourcesResponse))throw self2.setStatus(_ServerManager.Status.ERROR),"unexpected answer from server: no resourceDirectory";self2.setStatus(_ServerManager.Status.READY),resolve4(__spreadProps(__spreadValues({},response2),{resources:data.resources,resourceDirectory:data.resourceDirectory}))}catch(error){console.error(error),self2.setStatus(_ServerManager.Status.ERROR),reject2(__spreadProps(__spreadValues({},response2),{error}))}})}async _downloadResources(resources3){let response2={origin:"ServerManager._downloadResources",context:"when downloading resources for experiment: "+this._psychoJS.config.experiment.name};this._psychoJS.logger.debug("downloading resources for experiment: "+this._psychoJS.config.experiment.name),this.setStatus(_ServerManager.Status.BUSY),this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOADING_RESOURCES,count:resources3.size});let preloadManifest=[],soundResources=new Set,fontResources=[],surveyModelResources=[];for(let name of resources3){let nameParts=name.toLowerCase().split("."),extension=nameParts.length>1?nameParts.pop():void 0;typeof extension=="undefined"&&this.psychoJS.logger.warn(`"${name}" does not appear to have an extension, which may negatively impact its loading. We highly recommend you add an extension.`);let pathStatusData=this._resources.get(name);if(typeof pathStatusData=="undefined")throw Object.assign(response2,{error:name+" has not been previously registered"});if(pathStatusData.status!==_ServerManager.ResourceStatus.REGISTERED)throw Object.assign(response2,{error:name+" is already downloaded or is currently already downloading"});let pathParts=pathStatusData.path.toLowerCase().split("."),pathExtension=pathParts.length>1?pathParts.pop():void 0;["csv","odp","xls","xlsx","json"].indexOf(extension)>-1?preloadManifest.push({id:name,src:pathStatusData.path,type:createjs.Types.BINARY,crossOrigin:"Anonymous"}):["mp3","mpeg","opus","ogg","oga","wav","aac","caf","m4a","weba","dolby","flac"].indexOf(extension)>-1?(soundResources.add(name),extension==="wav"&&this.psychoJS.logger.warn(`wav files are not supported by all browsers. We recommend you convert "${name}" to another format, e.g. mp3`)):["ttf","otf","woff","woff2","eot"].indexOf(pathExtension)>-1?fontResources.push(name):["sid"].indexOf(extension)>-1?surveyModelResources.push(name):preloadManifest.push({id:name,src:pathStatusData.path,crossOrigin:"Anonymous"})}preloadManifest.length>0?this._preloadQueue.loadManifest(preloadManifest):this._nbLoadedResources===resources3.size&&(this.setStatus(_ServerManager.Status.READY),this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOAD_COMPLETED}));for(let name of fontResources){let pathStatusData=this._resources.get(name);pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADING,this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOADING_RESOURCE,resource:name});let pathExtension=pathStatusData.path.toLowerCase().split(".").pop();try{let newFont=await new FontFace(name,`url('${pathStatusData.path}') format('${pathExtension}')`).load();document.fonts.add(newFont),++this._nbLoadedResources,pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADED,this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.RESOURCE_DOWNLOADED,resource:name}),this._nbLoadedResources===resources3.size&&(this.setStatus(_ServerManager.Status.READY),this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOAD_COMPLETED}))}catch(error){throw console.error(error),this.setStatus(_ServerManager.Status.ERROR),pathStatusData.status=_ServerManager.ResourceStatus.ERROR,Object.assign(response2,{error:`unable to download resource: ${name}: ${error}`})}}let self2=this;for(let name of surveyModelResources){let pathStatusData=this._resources.get(name);pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADING,this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOADING_RESOURCE,resource:name});try{let getResponse=await this._queryServerAPI("GET",`surveys/${pathStatusData.path}/model`),getModelResponse=await getResponse.json();if(getResponse.status!==200){let error="error"in getModelResponse?getModelResponse.error:getModelResponse;throw toString(error)}if(getModelResponse.model===null)throw"either there is no survey with the given id, or it is not currently active";++self2._nbLoadedResources,pathStatusData.data=new TextEncoder().encode(JSON.stringify(getModelResponse.model)),pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADED,self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.RESOURCE_DOWNLOADED,resource:name}),self2._nbLoadedResources===resources3.size&&(self2.setStatus(_ServerManager.Status.READY),self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOAD_COMPLETED}))}catch(error){throw console.error(error),self2.setStatus(_ServerManager.Status.ERROR),__spreadProps(__spreadValues({},response2),{error:`unable to download resource: ${name}: ${toString(error)}`})}}for(let name of soundResources){let pathStatusData=this._resources.get(name);pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADING,this.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOADING_RESOURCE,resource:name});let howl=new import_howler.Howl({src:pathStatusData.path,preload:!1,autoplay:!1});howl.on("load",event=>{++self2._nbLoadedResources,pathStatusData.data=howl,pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADED,self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.RESOURCE_DOWNLOADED,resource:name}),self2._nbLoadedResources===resources3.size&&(self2.setStatus(_ServerManager.Status.READY),self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOAD_COMPLETED}))}),howl.on("loaderror",(id,error)=>{throw Object.assign(response2,{error:"unable to download resource: "+name+" ("+toString(error)+")"})}),howl.load()}}_setupPreloadQueue(){let response2={origin:"ServerManager._setupPreloadQueue",context:"when setting up a preload queue"};this._preloadQueue=new createjs.LoadQueue(!0,"",!0);let self2=this;this._preloadQueue.addEventListener("filestart",event=>{let pathStatusData=self2._resources.get(event.item.id);pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADING,self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOADING_RESOURCE,resource:event.item.id})}),this._preloadQueue.addEventListener("fileload",event=>{let pathStatusData=self2._resources.get(event.item.id);pathStatusData.data=event.result,pathStatusData.status=_ServerManager.ResourceStatus.DOWNLOADED,++self2._nbLoadedResources,self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.RESOURCE_DOWNLOADED,resource:event.item.id})}),this._preloadQueue.addEventListener("complete",event=>{self2._preloadQueue.close(),self2._nbLoadedResources===self2._resources.size&&(self2.setStatus(_ServerManager.Status.READY),self2.emit(_ServerManager.Event.RESOURCE,{message:_ServerManager.Event.DOWNLOAD_COMPLETED}))}),this._preloadQueue.addEventListener("error",event=>{if(self2.setStatus(_ServerManager.Status.ERROR),typeof event.item!="undefined"){let pathStatusData=self2._resources.get(event.item.id);throw pathStatusData.status=_ServerManager.ResourceStatus.ERROR,Object.assign(response2,{error:"unable to download resource: "+event.item.id+" ("+event.title+")"})}else if(console.error(event),event.title==="FILE_LOAD_ERROR"&&typeof event.data!="undefined"){let id=event.data.id,title=event.data.src;throw Object.assign(response2,{error:"unable to download resource: "+id+" ("+title+")"})}else throw Object.assign(response2,{error:"unspecified download error"})})}_queryServerAPI(method,path,data,contentType="JSON"){let fullPath=`${this._psychoJS.config.pavlovia.URL}/api/v2/${path}`;if(method==="PUT"||method==="POST"||method==="DELETE"){if(contentType==="JSON")return fetch(fullPath,{method,mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});{let formData=new FormData;for(let attribute in data)formData.append(attribute,data[attribute]);return fetch(fullPath,{method,mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",body:formData})}}if(method==="GET"){let url3=new URL(fullPath);return url3.search=new URLSearchParams(data).toString(),fetch(url3,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer"})}throw{origin:"ServerManager._queryServer",context:"when querying the server",error:"the method should be GET, PUT, POST, or DELETE"}}},ServerManager=_ServerManager;__publicField(ServerManager,"ALL_RESOURCES",Symbol.for("ALL_RESOURCES"));ServerManager.Event={RESOURCE:Symbol.for("RESOURCE"),DOWNLOADING_RESOURCES:Symbol.for("DOWNLOADING_RESOURCES"),DOWNLOADING_RESOURCE:Symbol.for("DOWNLOADING_RESOURCE"),RESOURCE_DOWNLOADED:Symbol.for("RESOURCE_DOWNLOADED"),DOWNLOAD_COMPLETED:Symbol.for("DOWNLOAD_COMPLETED"),STATUS:Symbol.for("STATUS")};ServerManager.Status={READY:Symbol.for("READY"),BUSY:Symbol.for("BUSY"),ERROR:Symbol.for("ERROR")};ServerManager.ResourceStatus={ERROR:Symbol.for("ERROR"),REGISTERED:Symbol.for("REGISTERED"),DOWNLOADING:Symbol.for("DOWNLOADING"),DOWNLOADED:Symbol.for("DOWNLOADED")};var focusableSelectors=['a[href]:not([tabindex^="-"])','area[href]:not([tabindex^="-"])','input:not([type="hidden"]):not([type="radio"]):not([disabled]):not([tabindex^="-"])','input[type="radio"]:not([disabled]):not([tabindex^="-"])','select:not([disabled]):not([tabindex^="-"])','textarea:not([disabled]):not([tabindex^="-"])','button:not([disabled]):not([tabindex^="-"])','iframe:not([tabindex^="-"])','audio[controls]:not([tabindex^="-"])','video[controls]:not([tabindex^="-"])','[contenteditable]:not([tabindex^="-"])','[tabindex]:not([tabindex^="-"])'],TAB_KEY="Tab",ESCAPE_KEY="Escape";function A11yDialog(element){this._show=this.show.bind(this),this._hide=this.hide.bind(this),this._maintainFocus=this._maintainFocus.bind(this),this._bindKeypress=this._bindKeypress.bind(this),this.$el=element,this.shown=!1,this._id=this.$el.getAttribute("data-a11y-dialog")||this.$el.id,this._previouslyFocused=null,this._listeners={},this.create()}A11yDialog.prototype.create=function(){return this.$el.setAttribute("aria-hidden",!0),this.$el.setAttribute("aria-modal",!0),this.$el.setAttribute("tabindex",-1),this.$el.hasAttribute("role")||this.$el.setAttribute("role","dialog"),this._openers=$$('[data-a11y-dialog-show="'+this._id+'"]'),this._openers.forEach(function(opener){opener.addEventListener("click",this._show)}.bind(this)),this._closers=$$("[data-a11y-dialog-hide]",this.$el).concat($$('[data-a11y-dialog-hide="'+this._id+'"]')),this._closers.forEach(function(closer){closer.addEventListener("click",this._hide)}.bind(this)),this._fire("create"),this};A11yDialog.prototype.show=function(event){return this.shown?this:(this._previouslyFocused=document.activeElement,this.$el.removeAttribute("aria-hidden"),this.shown=!0,moveFocusToDialog(this.$el),document.body.addEventListener("focus",this._maintainFocus,!0),document.addEventListener("keydown",this._bindKeypress),this._fire("show",event),this)};A11yDialog.prototype.hide=function(event){return this.shown?(this.shown=!1,this.$el.setAttribute("aria-hidden","true"),this._previouslyFocused&&this._previouslyFocused.focus&&this._previouslyFocused.focus(),document.body.removeEventListener("focus",this._maintainFocus,!0),document.removeEventListener("keydown",this._bindKeypress),this._fire("hide",event),this):this};A11yDialog.prototype.destroy=function(){return this.hide(),this._openers.forEach(function(opener){opener.removeEventListener("click",this._show)}.bind(this)),this._closers.forEach(function(closer){closer.removeEventListener("click",this._hide)}.bind(this)),this._fire("destroy"),this._listeners={},this};A11yDialog.prototype.on=function(type,handler2){return typeof this._listeners[type]=="undefined"&&(this._listeners[type]=[]),this._listeners[type].push(handler2),this};A11yDialog.prototype.off=function(type,handler2){var index3=(this._listeners[type]||[]).indexOf(handler2);return index3>-1&&this._listeners[type].splice(index3,1),this};A11yDialog.prototype._fire=function(type,event){var listeners=this._listeners[type]||[],domEvent=new CustomEvent(type,{detail:event});this.$el.dispatchEvent(domEvent),listeners.forEach(function(listener){listener(this.$el,event)}.bind(this))};A11yDialog.prototype._bindKeypress=function(event){!this.$el.contains(document.activeElement)||(this.shown&&event.key===ESCAPE_KEY&&this.$el.getAttribute("role")!=="alertdialog"&&(event.preventDefault(),this.hide(event)),this.shown&&event.key===TAB_KEY&&trapTabKey(this.$el,event))};A11yDialog.prototype._maintainFocus=function(event){this.shown&&!event.target.closest('[aria-modal="true"]')&&!event.target.closest("[data-a11y-dialog-ignore-focus-trap]")&&moveFocusToDialog(this.$el)};function toArray(collection){return Array.prototype.slice.call(collection)}function $$(selector,context4){return toArray((context4||document).querySelectorAll(selector))}function moveFocusToDialog(node){var focused=node.querySelector("[autofocus]")||node;focused.focus()}function getFocusableChildren(node){return $$(focusableSelectors.join(","),node).filter(function(child){return!!(child.offsetWidth||child.offsetHeight||child.getClientRects().length)})}function trapTabKey(node,event){var focusableChildren=getFocusableChildren(node),focusedItemIndex=focusableChildren.indexOf(document.activeElement);event.shiftKey&&focusedItemIndex===0?(focusableChildren[focusableChildren.length-1].focus(),event.preventDefault()):!event.shiftKey&&focusedItemIndex===focusableChildren.length-1&&(focusableChildren[0].focus(),event.preventDefault())}function instantiateDialogs(){$$("[data-a11y-dialog]").forEach(function(node){new A11yDialog(node)})}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",instantiateDialogs):window.requestAnimationFrame?window.requestAnimationFrame(instantiateDialogs):window.setTimeout(instantiateDialogs,16));var _GUI=class{get dialogComponent(){return this._dialogComponent}constructor(psychoJS){this._psychoJS=psychoJS,this._excludedInfo={},psychoJS.serverManager.on(ServerManager.Event.RESOURCE,signal=>{this._onResourceEvents(signal)})}DlgFromDict({logoUrl,text,dictionary,title,requireParticipantClick=_GUI.DEFAULT_SETTINGS.DlgFromDict.requireParticipantClick}){this._progressBarMax=0,this._allResourcesDownloaded=!1,this._requiredKeys=[],this._setRequiredKeys=new Map,this._progressMessage="&nbsp;",this._requireParticipantClick=requireParticipantClick,this._dictionary=dictionary,this._dialogComponent={},this._dialogComponent.status=PsychoJS.Status.NOT_STARTED;let dialogClock=new Clock,self2=this;return()=>{let t=dialogClock.getTime();if(t>=0&&self2._dialogComponent.status===PsychoJS.Status.NOT_STARTED){self2._dialogComponent.tStart=t,self2._dialogComponent.status=PsychoJS.Status.STARTED;let excludedInfo={};for(let key in self2._excludedInfo)excludedInfo[key.trim().toLowerCase()]=self2._excludedInfo[key];getUrlParameters().forEach((value,key)=>{excludedInfo[key.trim().toLowerCase()]=value}),self2._psychoJS.getEnvironment()===ExperimentHandler.Environment.SERVER&&typeof self2._psychoJS.config.experiment.license!="undefined"&&self2._psychoJS.config.experiment.runMode==="LICENSE"&&typeof self2._psychoJS.config.experiment.license.institutionLogo!="undefined"&&(logoUrl=self2._psychoJS.config.experiment.license.institutionLogo);let markup="<div class='dialog-container' id='experiment-dialog' aria-hidden='true' role='alertdialog'>";markup+="<div class='dialog-overlay'></div>",markup+="<div class='dialog-content'>",markup+="<div id='experiment-dialog-title' class='dialog-title'>",markup+=`<p>${title}</p>`,markup+="<button id='dialogClose' class='dialog-close' data-a11y-dialog-hide aria-label='Cancel Experiment'>&times;</button>",markup+="</div>",markup+="<div class='scrollable-container'>",typeof logoUrl=="string"&&(markup+='<img id="dialog-logo" class="logo" alt="logo" src="'+logoUrl+'">');let atLeastOneIncludedKey=!1;Object.keys(dictionary).forEach((key,keyIdx)=>{let value=dictionary[key],keyId="form-input-"+keyIdx;if(!(key.trim().toLowerCase()in excludedInfo))if(atLeastOneIncludedKey=!0,markup+=`<label for='${keyId}'> ${key} </label>`,key.slice(-1)==="*"&&self2._requiredKeys.push(keyId),Array.isArray(value)){markup+=`<select name='${key}' id='${keyId}' class='text'>`,key.slice(-1)==="*"&&(markup+="<option disabled selected>...</option>");for(let option of value)markup+=`<option> ${option} </option>`;markup+="</select>"}else markup+=`<input type='text' name='${key}' id='${keyId}' value='${value}' class='text'>`}),self2._requiredKeys.length>0&&(markup+="<p class='validateTips'>Fields marked with an asterisk (*) are required.</p>"),markup+="</div>",atLeastOneIncludedKey&&(markup+="<hr>"),markup+=`<div id='progressMsg' class='progress-msg'>${self2._progressMessage}</div>`,markup+="<div class='progress-container'><div id='progressBar' class='progress-bar'></div></div>",markup+="<hr>",markup+="<div class='dialog-button-group'>",markup+="<button id='dialogCancel' class='dialog-button' aria-label='Cancel Experiment'>Cancel</button>",self2._requireParticipantClick&&(markup+="<button id='dialogOK' class='dialog-button disabled' aria-label='Start Experiment'>Ok</button>"),markup+="</div>",markup+="</div></div>";let dialogElement=document.getElementById("root");dialogElement.innerHTML=markup;let dialogDiv=document.getElementById("experiment-dialog");self2._dialog=new A11yDialog(dialogDiv),self2._dialog.show(),self2._dialogComponent.button="Cancel",self2._cancelButton=document.getElementById("dialogCancel"),self2._cancelButton.onclick=self2._onCancelExperiment.bind(self2),self2._requireParticipantClick&&(self2._okButton=document.getElementById("dialogOK"),self2._okButton.onclick=self2._onStartExperiment.bind(self2)),self2._closeButton=document.getElementById("dialogClose"),self2._closeButton.onclick=self2._onCancelExperiment.bind(self2),self2._updateDialog(),self2._progressMsg=document.getElementById("progressMsg"),self2._progressBar=document.getElementById("progressBar"),self2._updateProgressBar(),this._requiredKeys.forEach(keyId=>{let input=document.getElementById(keyId);input&&(input.oninput=event=>_GUI._onKeyChange(self2,event))})}return self2._dialogComponent.status===PsychoJS.Status.FINISHED?Scheduler.Event.NEXT:Scheduler.Event.FLIP_REPEAT}}dialog({message,warning,error,showOK=!0,onOK,showCancel=!1,onCancel}={}){this.closeDialog();let markup="<div class='dialog-container' id='experiment-dialog' aria-hidden='true' role='alertdialog'>";if(markup+="<div class='dialog-overlay'></div>",markup+="<div class='dialog-content'>",typeof error!="undefined"){this._psychoJS.logger.fatal(toString(error)),error||(error="Unspecified JavaScript error");let errorCode=null,stackCode="<ul>";for(;;)if(typeof error=="object"&&"errorCode"in error&&(errorCode=error.errorCode),typeof error=="object"&&"context"in error)stackCode+="<li>"+error.context+"</li>",error=error.error;else{error.length>=1e3&&(error=error.substring(1,1e3)),stackCode+="<li><b>"+error+"</b></li>";break}if(stackCode+="</ul>",errorCode){let error2=this._userFriendlyError(errorCode);markup+=`<div id='experiment-dialog-title' class='dialog-title ${error2.class}'><p>${error2.title}</p></div>`,markup+="<div class='scrollable-container'>",markup+=`<p>${error2.text}</p>`,markup+="</div>"}else markup+="<div id='experiment-dialog-title' class='dialog-title dialog-error'><p>Error</p></div>",markup+="<div class='scrollable-container'>",markup+="<p>Unfortunately we encountered the following error:</p>",markup+=stackCode,markup+="<p>Try to run the experiment again. If the error persists, contact the experiment designer.</p>",markup+="</div>"}else typeof warning!="undefined"?(markup+="<div id='experiment-dialog-title' class='dialog-title dialog-warning'><p>Warning</p></div>",markup+="<div class='scrollable-container'>",markup+=`<p>${warning}</p>`,markup+="</div>"):typeof message!="undefined"&&(markup+="<div id='experiment-dialog-title' class='dialog-title'><p>Message</p></div>",markup+="<div class='scrollable-container'>",markup+=`<p>${message}</p>`,markup+="</div>");(showOK||showCancel)&&(markup+="<hr>"),(showCancel||showOK)&&(markup+="<div class='button-group'>",showCancel&&(markup+="<button id='dialogCancel' class='dialog-button' aria-label='Close dialog'>Cancel</button>"),showOK&&(markup+="<button id='dialogOK' class='dialog-button' aria-label='Close dialog'>Ok</button>"),markup+="</div>"),markup+="</div></div>";let dialogElement=document.getElementById("root");dialogElement.innerHTML=markup;let dialogDiv=document.getElementById("experiment-dialog");this._dialog=new A11yDialog(dialogDiv),this._dialog.show(),showOK&&(this._okButton=document.getElementById("dialogOK"),this._okButton.onclick=()=>{this.closeDialog(),typeof onOK!="undefined"&&onOK()}),showCancel&&(this._cancelButton=document.getElementById("dialogCancel"),this._cancelButton.onclick=()=>{this.closeDialog(),typeof onCancel!="undefined"&&onCancel()})}finishDialog({text="",nbSteps=0}){this.closeDialog();let markup="<div class='dialog-container' id='experiment-dialog' aria-hidden='true' role='alertdialog'>";markup+="<div class='dialog-overlay'></div>",markup+="<div class='dialog-content'>",markup+="<div id='experiment-dialog-title' class='dialog-title dialog-warning'><p>Warning</p></div>",markup+=`<p>${text}</p>`,markup+="<hr><div id='progressMsg' class='progress-msg'>&nbsp;</div>",markup+="<div class='progress-container'><div id='progressBar' class='progress-bar'></div></div>",markup+="</div></div>";let dialogElement=document.getElementById("root");dialogElement.innerHTML=markup;let dialogDiv=document.getElementById("experiment-dialog");this._dialog=new A11yDialog(dialogDiv),this._dialog.show(),this._progressMsg=document.getElementById("progressMsg"),this._progressBar=document.getElementById("progressBar"),this._progressMessage="&nbsp;",this._progressBarCurrentValue=0,this._progressBarMax=nbSteps,this._updateProgressBar()}finishDialogNextStep(text){this._setProgressMessage(text),++this._progressBarCurrentValue,this._updateProgressBar()}closeDialog(){this._dialog&&this._dialog.hide()}_setProgressMessage(message){this._progressMessage=message,typeof this._progressMsg!="undefined"&&(this._progressMsg.innerText=message)}_updateProgressBar(){typeof this._progressBar!="undefined"&&(this._progressBar.style.width=`${Math.round(this._progressBarCurrentValue*100/this._progressBarMax)}%`)}_onCancelExperiment(){this._dialogComponent.button="Cancel",this._dialog.hide(),this._dialog=null,this._dialogComponent.status=PsychoJS.Status.FINISHED}_onStartExperiment(){this._dialogComponent.button="OK",Object.keys(this._dictionary).forEach((key,keyIdx)=>{let input=document.getElementById("form-input-"+keyIdx);input&&(this._dictionary[key]=input.value)}),start(),this._psychoJS.window.adjustScreenSize(),this._psychoJS.eventManager.clearEvents(),this._dialog.hide(),this._dialog=null,this._dialogComponent.status=PsychoJS.Status.FINISHED}_onResourceEvents(signal){this._psychoJS.logger.debug("signal: "+toString(signal)),signal.message===ServerManager.Event.DOWNLOADING_RESOURCES?(this._progressBarMax=signal.count*2,this._progressBarCurrentValue=0,this._updateProgressBar()):signal.message===ServerManager.Event.DOWNLOAD_COMPLETED?(this._allResourcesDownloaded=!0,this._progressBarMax=100,this._progressBarCurrentValue=100,this._updateProgressBar(),this._setProgressMessage("all resources downloaded."),this._updateDialog()):signal.message===ServerManager.Event.DOWNLOADING_RESOURCE||signal.message===ServerManager.Event.RESOURCE_DOWNLOADED?(typeof this._progressBarCurrentValue=="undefined"&&(this._progressBarCurrentValue=0),++this._progressBarCurrentValue,signal.message===ServerManager.Event.RESOURCE_DOWNLOADED?this._setProgressMessage(`downloaded ${this._progressBarCurrentValue/2}  / ${this._progressBarMax/2}`):this._setProgressMessage(`downloading ${this._progressBarCurrentValue/2}  / ${this._progressBarMax/2}`),this._updateProgressBar()):this._progressMsg.innerHTML=signal.message}_updateDialog(changeOKButtonFocus=!0){let allRequirementsFulfilled=this._allResourcesDownloaded&&this._setRequiredKeys&&this._setRequiredKeys.size>=this._requiredKeys.length;if(this._requireParticipantClick){typeof this._okButton!="undefined"&&(this._psychoJS.getEnvironment()===ExperimentHandler.Environment.LOCAL||allRequirementsFulfilled?(this._okButton.classList.add("dialog-button"),this._okButton.classList.remove("disabled"),changeOKButtonFocus&&this._okButton.focus()):this._okButton.classList.add("dialog-button","disabled"));return}allRequirementsFulfilled&&this._onStartExperiment()}static _onKeyChange(gui,event){let value=event.target.value;typeof value!="undefined"&&value.length>0?gui._setRequiredKeys.set(event.target,!0):gui._setRequiredKeys.delete(event.target),gui._updateDialog(!1)}_userFriendlyError(errorCode){switch(errorCode){case 1:return{class:"dialog-error",title:"Error",text:"<p>Oops we encountered an <strong>internal server error</strong>.</p><p>Try to run the experiment again. If the error persists, contact the experiment designer.</p>"};case 2:return{class:"dialog-error",title:"Error",text:"<p>Oops we encountered a <strong>database error</strong>.</p><p>Try to run the experiment again. If the error persists, contact the experiment designer.</p>"};case 20:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> does not have any status and cannot be run.</p><p>If you are the experiment designer, go to your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a> and change the experiment status to either PILOTING or RUNNING.</p><p>Otherwise please contact the experiment designer to let him or her know that the status must be changed to RUNNING for participants to be able to run it.</p>`};case 21:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> is currently inactive and cannot be run.</p><p>If you are the experiment designer, go to your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a> and change the experiment status to either PILOTING or RUNNING.</p><p>Otherwise please contact the experiment designer to let him or her know that the status must be changed to RUNNING for participants to be able to run it.</p>`};case 22:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> has been deleted and cannot be run.</p><p>If you are the experiment designer, either go to your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a> and change the experiment status to either PILOTING or RUNNING, or generate a new experiment.</p><p>Otherwise please contact the experiment designer to let him or her know that the experiment has been deleted and cannot be run any longer.</p>`};case 23:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> has been archived and cannot be run.</p><p>If you are the experiment designer, go to your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a> and change the experiment status to either PILOTING or RUNNING.</p><p>Otherwise please contact the experiment designer to let him or her know that the experiment has been archived and cannot be run at the moment.</p>`};case 30:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> is currently in PILOTING mode but the pilot token is missing from the URL.</p><p>If you are the experiment designer, you can pilot it by pressing the pilot button on your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a>.</p><p>Otherwise please contact the experiment designer to let him or her know that the experiment status must be changed to RUNNING for participants to be able to run it.</p>`};case 31:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> cannot be run because the pilot token in the URL is invalid, possibly because it has expired.</p><p>If you are the experiment designer, you can generate a new token by pressing the pilot button on your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a>.</p><p>Otherwise please contact the experiment designer to let him or her know that the experiment status must be changed to RUNNING for participants to be able to run it.</p>`};case 50:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> is covered by a license that has expired. </p><p>If you are the experiment designer, you can either contact the license manager to inquire about the expiration, or you can run your experiments using credits. You will find all relevant details about the license on your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a>, where you will also be able to change its running mode to CREDIT.</p><p>Otherwise please contact the experiment designer to let him or her know that there is an issue with the experiment's license having expired.</p>`};case 51:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> is covered by a license that requires one or more documents to be approved before the experiment can be run. </p><p>If you are the experiment designer, please contact the license manager and ask him or her which documents must be approved. You will find all relevant details about the license on your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a>.</p><p>Otherwise please contact the experiment designer to let him or her know that there is an issue with the experiment's license requiring documents to be approved.</p>`};case 60:return{class:"dialog-warning",title:"Warning",text:`<p><strong>${this._psychoJS.config.experiment.fullpath}</strong> does not have any assigned credit left and cannot be run.</p><p>If you are the experiment designer, you can assign more credits to it on your <a href="https://pavlovia.org/${this._psychoJS.config.experiment.fullpath}">experiment page</a>.</p><p>Otherwise please contact the experiment designer to let him or her know that the experiment requires more assigned credits to run.</p>`};default:return{class:"dialog-error",title:"Error",text:`<p>Unfortunately we encountered an unspecified error (error code: ${errorCode}.</p><p>Try to run the experiment again. If the error persists, contact the experiment designer.</p>`}}}},GUI=_GUI;__publicField(GUI,"DEFAULT_SETTINGS",{DlgFromDict:{requireParticipantClick:!0}});var import_log4javascript=__toModule(require_log4javascript()),import_pako=__toModule(require_pako());var Logger=class{constructor(psychoJS,threshold){this._psychoJS=psychoJS,this.consoleLogger=import_log4javascript.default.getLogger("psychojs");let appender=new import_log4javascript.default.BrowserConsoleAppender;appender.setLayout(this._customConsoleLayout()),appender.setThreshold(threshold),this.consoleLogger.addAppender(appender),this.consoleLogger.setLevel(threshold),this._serverLogs=[],this._serverLevel=Logger.ServerLevel.WARNING,this._serverLevelValue=this._getValue(this._serverLevel),this._throttling={window:1,threshold:20,factor:10,minimumDuration:2,startOfThrottling:0,isThrottling:!1,index:0,designerWasWarned:!1}}setLevel(serverLevel){this._serverLevel=serverLevel,this._serverLevelValue=this._getValue(this._serverLevel)}exp(msg,time,obj){this.log(msg,Logger.ServerLevel.EXP,time,obj)}data(msg,time,obj){this.log(msg,Logger.ServerLevel.DATA,time,obj)}log(msg,level,time,obj){this._getValue(level)<this._serverLevelValue||(typeof time=="undefined"&&(time=MonotonicClock.getReferenceTime()),this._serverLogs.push({msg,level,time,obj:toString(obj)}))}_throttle(time){if(this._serverLogs.length>this._throttling.threshold){let timeAtStartThrottlingWindow=this._serverLogs[this._serverLogs.length-1-this._throttling.threshold].time;if(time-timeAtStartThrottlingWindow<this._throttling.window){if(!this._throttling.isThrottling){let msg=`<p>[time= ${time.toFixed(3)}] More than ${this._throttling.threshold} messages were logged in the past ${this._throttling.window}s.</p><p>We are now throttling: only 1 in ${this._throttling.factor} messages will be logged.</p><p>You may want to change your experiment's logging level. Please see <a href="https://www.psychopy.org/api/logging.html">psychopy.org/api/logging.html</a> for details.</p>`;this._psychoJS.logger.warn(msg),!this._throttling.designerWasWarned&&(this._psychoJS.getEnvironment()===ExperimentHandler.Environment.LOCAL||this._psychoJS.config.experiment.status==="PILOTING")&&(this._throttling.designerWasWarned=!0,this._psychoJS.gui.dialog({warning:msg,showOK:!0})),this._throttling.isThrottling=!0,this._throttling.startOfThrottling=time,this._throttling.index=0}if(++this._throttling.index,this._throttling.index<this._throttling.factor)return!0;this._throttling.index=0}else this._throttling.isThrottling&&time-this._throttling.startOfThrottling>this._throttling.minimumDuration&&(this._psychoJS.logger.info(`[time= ${time.toFixed(3)}] Log messages are not throttled any longer.`),this._throttling.isThrottling=!1)}return!1}async flush(){let response2={origin:"Logger.flush",context:"when flushing participant's logs for experiment: "+this._psychoJS.config.experiment.fullpath};this._psychoJS.logger.info("[PsychoJS] Flush server logs.");let formattedLogs="";for(let log3 of this._serverLogs){let formattedLog=toString(log3.time)+"	"+Symbol.keyFor(log3.level)+"	"+log3.msg;log3.obj!=="undefined"&&(formattedLog+="	"+log3.obj),formattedLog+=`
`,formattedLogs+=formattedLog}if(this._psychoJS.getEnvironment()===ExperimentHandler.Environment.SERVER&&this._psychoJS.config.experiment.status==="RUNNING"&&!this._psychoJS._serverMsg.has("__pilotToken"))if(typeof import_pako.default!="undefined")try{let utf16DeflatedLogs=import_pako.default.deflate(formattedLogs,{to:"string"}),base64DeflatedLogs=btoa(utf16DeflatedLogs);return await this._psychoJS.serverManager.uploadLog(base64DeflatedLogs,!0)}catch(error){throw console.error("log compression error:",error),Object.assign(response2,{error})}else return await this._psychoJS.serverManager.uploadLog(formattedLogs,!1);else this._psychoJS.logger.debug(`
`+formattedLogs)}_customConsoleLayout(){let detectedBrowser=detectBrowser(),customLayout=new import_log4javascript.default.PatternLayout("%p %d{HH:mm:ss.SSS} %f{1} | %m");return customLayout.setCustomField("location",function(layout,loggingReference){try{throw Error("fake exception")}catch(e){let stackEntries=e.stack.replace(/^.*?\n/,"").replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anon}(").split(`
`),relevantEntry;if(detectedBrowser==="Firefox"){for(let entry of stackEntries)if(entry.indexOf("log4javascript.min.js")<=0){relevantEntry=entry;break}let buf=relevantEntry.split(":"),line=buf[buf.length-2],file=buf[buf.length-3].split("/").pop();return relevantEntry.split("@")[0]+" "+file+":"+line}else{if(detectedBrowser==="Safari")return"unknown";if(detectedBrowser==="Chrome"){relevantEntry=stackEntries.pop();let buf=relevantEntry.split(" "),fileLine=buf.pop(),method=buf.pop();buf=fileLine.split(":"),buf.pop();let line=buf.pop(),file=buf.pop().split("/").pop();return method+" "+file+":"+line}else return"unknown"}}}),customLayout}_getValue(level){let levelAsString=Symbol.keyFor(level);return levelAsString in Logger._ServerLevelValue?Logger._ServerLevelValue[levelAsString]:30}};Logger.ServerLevel={CRITICAL:Symbol.for("CRITICAL"),ERROR:Symbol.for("ERROR"),WARNING:Symbol.for("WARNING"),DATA:Symbol.for("DATA"),EXP:Symbol.for("EXP"),INFO:Symbol.for("INFO"),DEBUG:Symbol.for("DEBUG"),NOTSET:Symbol.for("NOTSET")};Logger._ServerLevelValue={CRITICAL:50,ERROR:40,WARNING:30,DATA:25,EXP:22,INFO:20,DEBUG:10,NOTSET:0};var extendStatics25=function(d,b){return extendStatics25=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])},extendStatics25(d,b)};function __extends26(d,b){extendStatics25(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var vertex8=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,fragment11=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform float gamma;
uniform float contrast;
uniform float saturation;
uniform float brightness;
uniform float red;
uniform float green;
uniform float blue;
uniform float alpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (c.a > 0.0) {
        c.rgb /= c.a;

        vec3 rgb = pow(c.rgb, vec3(1. / gamma));
        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);
        rgb.r *= red;
        rgb.g *= green;
        rgb.b *= blue;
        c.rgb = rgb * brightness;

        c.rgb *= c.a;
    }

    gl_FragColor = c * alpha;
}
`,AdjustmentFilter=function(_super){__extends26(AdjustmentFilter2,_super);function AdjustmentFilter2(options){var _this=_super.call(this,vertex8,fragment11)||this;return _this.gamma=1,_this.saturation=1,_this.contrast=1,_this.brightness=1,_this.red=1,_this.green=1,_this.blue=1,_this.alpha=1,Object.assign(_this,options),_this}return AdjustmentFilter2.prototype.apply=function(filterManager,input,output,clear){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,filterManager.applyFilter(this,input,output,clear)},AdjustmentFilter2}(Filter);var Window=class extends PsychObject{static checkWebGLSupport(){return settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0,utils_exports.isWebGLSupported()}get monitorFramePeriod(){return 1/this.getActualFrameRate()}constructor({psychoJS,name,fullscr=!1,color=new Color("black"),gamma=1,contrast=1,units="pix",waitBlanking=!1,autoLog=!0}={}){super(psychoJS,name);this._msgToBeLogged=[],this._adjustmentFilter=new AdjustmentFilter({gamma,contrast}),this._drawList=[],this._addAttribute("fullscr",fullscr),this._addAttribute("color",color,new Color("black"),()=>{this._backgroundSprite&&(this._backgroundSprite.tint=this._color.int)}),this._addAttribute("gamma",gamma,1,()=>{this._adjustmentFilter.gamma=this._gamma}),this._addAttribute("contrast",contrast,1,()=>{this._adjustmentFilter.contrast=this._contrast}),this._addAttribute("units",units),this._addAttribute("waitBlanking",waitBlanking),this._addAttribute("autoLog",autoLog),this._addAttribute("size",[]),this._setupPixi(),this._frameCount=0,this._flipCallbacks=[],this._windowAlreadyInFullScreen=!1;let self2=this;document.addEventListener("fullscreenchange",event=>{self2._windowAlreadyInFullScreen=!!document.fullscreenElement,console.log("windowAlreadyInFullScreen:",self2._windowAlreadyInFullScreen),self2._needUpdate=!0;for(let stimulus of self2._drawList)stimulus._needUpdate=!0}),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}close(){!this._renderer||(this._rootContainer.destroy(),document.body.contains(this._renderer.view)&&document.body.removeChild(this._renderer.view),typeof this._renderer.gl!="undefined"&&this._renderer.gl.getExtension("WEBGL_lose_context").loseContext(),this._renderer.destroy(),window.removeEventListener("resize",this._resizeCallback),window.removeEventListener("orientationchange",this._resizeCallback),this._renderer=null)}getActualFrameRate(){let lastDelta=this.psychoJS.scheduler._lastDelta;return lastDelta===0?60:1e3/lastDelta}adjustScreenSize(){this.fullscr&&(this._psychoJS.logger.debug("Resizing Window: ",this._name,"to full screen."),typeof document.documentElement.requestFullscreen=="function"?document.documentElement.requestFullscreen().catch(()=>{this.psychoJS.logger.warn("Unable to go fullscreen.")}):typeof document.documentElement.mozRequestFullScreen=="function"?document.documentElement.mozRequestFullScreen():typeof document.documentElement.webkitRequestFullscreen=="function"?document.documentElement.webkitRequestFullscreen():typeof document.documentElement.msRequestFullscreen=="function"?document.documentElement.msRequestFullscreen():this.psychoJS.logger.warn("Unable to go fullscreen."))}closeFullScreen(){this.fullscr&&(this._psychoJS.logger.debug("Resizing Window: ",this._name,"back from full screen."),typeof document.exitFullscreen=="function"?document.exitFullscreen().catch(()=>{this.psychoJS.logger.warn("Unable to close fullscreen.")}):typeof document.mozCancelFullScreen=="function"?document.mozCancelFullScreen():typeof document.webkitExitFullscreen=="function"?document.webkitExitFullscreen():typeof document.msExitFullscreen=="function"?document.msExitFullscreen():this.psychoJS.logger.warn("Unable to close fullscreen."))}logOnFlip({msg,level=Logger.ServerLevel.EXP,obj}={}){this._msgToBeLogged.push({msg,level,obj})}callOnFlip(flipCallback,...flipCallbackArgs){this._flipCallbacks.push({function:flipCallback,arguments:flipCallbackArgs})}addPixiObject(pixiObject){this._stimsContainer.addChild(pixiObject)}removePixiObject(pixiObject){this._stimsContainer.removeChild(pixiObject)}render(){if(!!this._renderer){this._frameCount++,this._renderer.render(this._rootContainer),typeof this._renderer.gl!="undefined"&&(this._renderer.gl.readPixels(0,0,1,1,this._renderer.gl.RGBA,this._renderer.gl.UNSIGNED_BYTE,new Uint8Array(4)),this._waitBlanking&&this._renderer.gl.finish());for(let callback of this._flipCallbacks)callback.function(...callback.arguments);this._flipCallbacks=[],this._writeLogOnFlip(),this._refresh()}}_updateIfNeeded(){this._needUpdate&&(this._renderer&&(this._renderer.backgroundColor=this._color.int,this._backgroundSprite.tint=this._color.int),document.body.style.backgroundColor=this._color.hex,this._needUpdate=!1)}_refresh(){this._updateIfNeeded();for(let stimulus of this._drawList)stimulus._needUpdate&&typeof stimulus._pixi!="undefined"&&(this._stimsContainer.removeChild(stimulus._pixi),stimulus._updateIfNeeded(),this._stimsContainer.addChild(stimulus._pixi))}_fullRefresh(){this._needUpdate=!0;for(let stimulus of this._drawList)stimulus.refresh();this._refresh()}_setupPixi(){this._size[0]=window.innerWidth,this._size[1]=window.innerHeight,this._psychoJS._checkWebGLSupport&&(settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0),this._renderer=autoDetectRenderer({width:this._size[0],height:this._size[1],backgroundColor:this.color.int,powerPreference:"high-performance",resolution:window.devicePixelRatio}),this._renderer.view.style.transform="translatez(0)",this._renderer.view.style.position="absolute",document.body.appendChild(this._renderer.view),document.body.style.backgroundColor=this._color.hex,this._backgroundSprite=new Sprite(Texture.WHITE),this._backgroundSprite.tint=this.color.int,this._backgroundSprite.width=this._size[0],this._backgroundSprite.height=this._size[1],this._backgroundSprite.anchor.set(.5),this._stimsContainer=new Container,this._stimsContainer.sortableChildren=!0,this._rootContainer=new Container,this._rootContainer.addChild(this._backgroundSprite,this._stimsContainer),this._rootContainer.sortableChildren=!0,this._rootContainer.interactive=!0,this._rootContainer.filters=[this._adjustmentFilter],Window._resizePixiRenderer(this),this.psychoJS.eventManager.addMouseListeners(this._renderer),this._resizeCallback=e=>{let keyboardHeight=300;hasTouchScreen()&&window.screen.height-window.visualViewport.height>keyboardHeight||(Window._resizePixiRenderer(this,e),this._backgroundSprite.width=this._size[0],this._backgroundSprite.height=this._size[1],this._fullRefresh())},window.addEventListener("resize",this._resizeCallback),window.addEventListener("orientationchange",this._resizeCallback)}static _resizePixiRenderer(pjsWindow,event){pjsWindow._psychoJS.logger.debug("resizing Window: ",pjsWindow._name,"event:",JSON.stringify(event)),pjsWindow._size[0]=window.innerWidth,pjsWindow._size[1]=window.innerHeight,pjsWindow._renderer.view.style.width=pjsWindow._size[0]+"px",pjsWindow._renderer.view.style.height=pjsWindow._size[1]+"px",pjsWindow._renderer.view.style.left="0px",pjsWindow._renderer.view.style.top="0px",pjsWindow._renderer.resize(pjsWindow._size[0],pjsWindow._size[1]),pjsWindow._rootContainer.position.x=pjsWindow._size[0]/2,pjsWindow._rootContainer.position.y=pjsWindow._size[1]/2,pjsWindow._rootContainer.scale.y=-1}_writeLogOnFlip(){let logTime=MonotonicClock.getReferenceTime();for(let entry of this._msgToBeLogged)this._psychoJS.experimentLogger.log(entry.msg,entry.level,logTime,entry.obj);this._msgToBeLogged=[]}};var _MAX_KEY_LENGTH,_Shelf=class extends PsychObject{constructor({psychoJS,autoLog=!1}={}){super(psychoJS);this._addAttribute("autoLog",autoLog),this._addAttribute("status",_Shelf.Status.READY),this._throttlingPeriod_ms=500,this._lastCallTimestamp=0,this._lastScheduledCallTimestamp=0}getBooleanValue({key,defaultValue:defaultValue3}={}){return this._getValue(key,_Shelf.Type.BOOLEAN,{defaultValue:defaultValue3})}setBooleanValue({key,value}={}){if(typeof value!="boolean")throw{origin:"Shelf.setIntegerValue",context:`when setting the value of the BOOLEAN record associated with the key: ${JSON.stringify(key)}`,error:"the value should be a boolean"};let update={action:"SET",value};return this._updateValue(key,_Shelf.Type.BOOLEAN,update)}flipBooleanValue({key}={}){let update={action:"FLIP"};return this._updateValue(key,_Shelf.Type.BOOLEAN,update)}getIntegerValue({key,defaultValue:defaultValue3}={}){return this._getValue(key,_Shelf.Type.INTEGER,{defaultValue:defaultValue3})}setIntegerValue({key,value}={}){if(!Number.isInteger(value))throw{origin:"Shelf.setIntegerValue",context:`when setting the value of the INTEGER record associated with the key: ${JSON.stringify(key)}`,error:"the value should be an integer"};let update={action:"SET",value};return this._updateValue(key,_Shelf.Type.INTEGER,update)}addIntegerValue({key,delta}={}){if(!Number.isInteger(delta))throw{origin:"Shelf.setIntegerValue",context:`when adding a value to the value of the INTEGER record associated with the key: ${JSON.stringify(key)}`,error:"the value should be an integer"};let update={action:"ADD",delta};return this._updateValue(key,_Shelf.Type.INTEGER,update)}getTextValue({key,defaultValue:defaultValue3}={}){return this._getValue(key,_Shelf.Type.TEXT,{defaultValue:defaultValue3})}setTextValue({key,value}={}){if(typeof value!="string")throw{origin:"Shelf.setTextValue",context:`when setting the value of the TEXT record associated with the key: ${JSON.stringify(key)}`,error:"the value should be a string"};let update={action:"SET",value};return this._updateValue(key,_Shelf.Type.TEXT,update)}getListValue({key,defaultValue:defaultValue3}={}){return this._getValue(key,_Shelf.Type.LIST,{defaultValue:defaultValue3})}setListValue({key,value}={}){if(!Array.isArray(value))throw{origin:"Shelf.setListValue",context:`when setting the value of the LIST record associated with the key: ${JSON.stringify(key)}`,error:"the value should be an array"};let update={action:"SET",value};return this._updateValue(key,_Shelf.Type.LIST,update)}appendListValue({key,elements}={}){let update={action:"APPEND",elements};return this._updateValue(key,_Shelf.Type.LIST,update)}popListValue({key,index:index3=-1}={}){let update={action:"POP",index:index3};return this._updateValue(key,_Shelf.Type.LIST,update)}clearListValue({key}={}){let update={action:"CLEAR"};return this._updateValue(key,_Shelf.Type.LIST,update)}shuffleListValue({key}={}){let update={action:"SHUFFLE"};return this._updateValue(key,_Shelf.Type.LIST,update)}async getDictionaryFieldNames({key}={}){return this._getValue(key,_Shelf.Type.DICTIONARY,{fieldNames:!0})}async getDictionaryFieldValue({key,fieldName,defaultValue:defaultValue3}={}){return this._getValue(key,_Shelf.Type.DICTIONARY,{fieldName,defaultValue:defaultValue3})}async setDictionaryFieldValue({key,fieldName,fieldValue}={}){let update={action:"FIELD_SET",fieldName,fieldValue};return this._updateValue(key,_Shelf.Type.DICTIONARY,update)}getDictionaryValue({key,defaultValue:defaultValue3}={}){return this._getValue(key,_Shelf.Type.DICTIONARY,{defaultValue:defaultValue3})}setDictionaryValue({key,value}={}){if(typeof value!="object")throw{origin:"Shelf.setDictionaryValue",context:`when setting the value of the DICTIONARY record associated with the key: ${JSON.stringify(key)}`,error:"the value should be an object"};let update={action:"SET",value};return this._updateValue(key,_Shelf.Type.DICTIONARY,update)}incrementComponent(key=[],increment=1,callback){let response2={origin:"Shelf.incrementComponent",context:"when making a component to increment a shelf counter"};try{let incrementComponent={};return incrementComponent.status=PsychoJS.Status.NOT_STARTED,()=>(incrementComponent.status===PsychoJS.Status.NOT_STARTED&&(incrementComponent.status=PsychoJS.Status.STARTED,this.increment(key,increment).then(newValue=>{callback(newValue),incrementComponent.status=PsychoJS.Status.FINISHED})),incrementComponent.status===PsychoJS.Status.FINISHED?Scheduler.Event.NEXT:Scheduler.Event.FLIP_REPEAT)}catch(error){throw this._status=_Shelf.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}}async counterBalanceSelect({key,groups,groupSizes}={}){let response2={origin:"Shelf.counterBalanceSelect",context:`when getting the name of a group, using a counterbalanced design, with key: ${JSON.stringify(key)}`};try{await this._checkAvailability("counterBalanceSelect"),this._checkKey(key);let url3=`${this._psychoJS.config.pavlovia.URL}/api/v2/shelf/${this._psychoJS.config.session.token}/counterbalance`,data={key,groups,groupSizes},putResponse=await fetch(url3,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}),document2=await putResponse.json();if(putResponse.status!==200)throw"error"in document2?document2.error:document2;return this._status=_Shelf.Status.READY,{group:document2.group,finished:document2.finished}}catch(error){throw this._status=_Shelf.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}}async _updateValue(key,type,update){let response2={origin:"Shelf._updateValue",context:`when updating the value of the ${Symbol.keyFor(type)} record associated with key: ${JSON.stringify(key)}`};try{await this._checkAvailability("_updateValue"),this._checkKey(key);let url3=`${this._psychoJS.config.pavlovia.URL}/api/v2/shelf/${this._psychoJS.config.session.token}/value`,data={key,type:Symbol.keyFor(type),update},postResponse=await fetch(url3,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}),document2=await postResponse.json();if(postResponse.status!==200)throw"error"in document2?document2.error:document2;return this._status=_Shelf.Status.READY,document2.value}catch(error){throw this._status=_Shelf.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}}async _getValue(key,type,options){let response2={origin:"Shelf._getValue",context:`when getting the value of the ${Symbol.keyFor(type)} record associated with key: ${JSON.stringify(key)}`};try{await this._checkAvailability("_getValue"),this._checkKey(key);let url3=`${this._psychoJS.config.pavlovia.URL}/api/v2/shelf/${this._psychoJS.config.session.token}/value`,data={key,type:Symbol.keyFor(type)};if(typeof options!="undefined")for(let attribute in options)typeof options[attribute]!="undefined"&&(data[attribute]=options[attribute]);let putResponse=await fetch(url3,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}),document2=await putResponse.json();if(putResponse.status!==200)throw"error"in document2?document2.error:document2;return this._status=_Shelf.Status.READY,document2.value}catch(error){throw this._status=_Shelf.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}}_checkAvailability(methodName=""){if(this._psychoJS.config.environment!==ExperimentHandler.Environment.SERVER)throw{origin:"Shelf._checkAvailability",context:"when checking whether Shelf is available",error:"the experiment has to be run on the server: shelf commands are not available locally"};let self2=this;return new Promise((resolve4,reject2)=>{let now2=performance.now(),timeoutDuration;now2>self2._lastScheduledCallTimestamp?(timeoutDuration=Math.max(0,self2._throttlingPeriod_ms-(now2-self2._lastCallTimestamp)),self2._lastScheduledCallTimestamp=now2+timeoutDuration):(self2._lastScheduledCallTimestamp+=self2._throttlingPeriod_ms,timeoutDuration=self2._lastScheduledCallTimestamp),setTimeout(()=>{self2._lastCallTimestamp=performance.now(),self2._status=_Shelf.Status.BUSY,resolve4()},timeoutDuration)})}_checkKey(key){if(!Array.isArray(key)||key.length===0)throw"the key must be a non empty array";if(key.length>__privateGet(_Shelf,_MAX_KEY_LENGTH))throw"the key consists of too many components"}},Shelf=_Shelf;_MAX_KEY_LENGTH=new WeakMap,__privateAdd(Shelf,_MAX_KEY_LENGTH,10);Shelf.Status={READY:Symbol.for("READY"),BUSY:Symbol.for("BUSY"),ERROR:Symbol.for("ERROR")};Shelf.Type={INTEGER:Symbol.for("INTEGER"),TEXT:Symbol.for("TEXT"),DICTIONARY:Symbol.for("DICTIONARY"),BOOLEAN:Symbol.for("BOOLEAN"),LIST:Symbol.for("LIST")};var PsychoJS=class{get status(){return this._status}set status(status){this._status=status}get config(){return this._config}get window(){return this._window}get serverManager(){return this._serverManager}get experiment(){return this._experiment}get scheduler(){return this._scheduler}get monotonicClock(){return this._monotonicClock}get logger(){return this._logger.consoleLogger}get experimentLogger(){return this._logger}get eventManager(){return this._eventManager}get gui(){return this._gui}get IP(){return this._IP}get serverMsg(){return this._serverMsg}get browser(){return this._browser}get shelf(){return this._shelf}constructor({debug=!0,collectIP=!1,hosts=[],topLevelStatus=!0,autoStartScheduler=!0,saveResults=!0,captureErrors=!0,checkWebGLSupport=!1}={}){this._logger=new Logger(this,debug?import_log4javascript2.default.Level.DEBUG:import_log4javascript2.default.Level.INFO),captureErrors&&this._captureErrors(),this._browser=detectBrowser(),this.logger.info("[PsychoJS] Detected browser:",this._browser),this._monotonicClock=new MonotonicClock,this._eventManager=new EventManager(this),this._serverManager=new ServerManager({psychoJS:this});let hostsWithPavlovia=new Set([...hosts,"https://pavlovia.org/run/","https://run.pavlovia.org/"]);this._hosts=Array.from(hostsWithPavlovia),this._gui=new GUI(this),this._collectIP=collectIP,this._scheduler=new Scheduler(this),this._window=void 0,this._shelf=new Shelf({psychoJS:this}),this._cancellationUrl=void 0,this._completionUrl=void 0,this.status=PsychoJS.Status.NOT_CONFIGURED,topLevelStatus&&this._makeStatusTopLevel(),this._autoStartScheduler=autoStartScheduler,this._checkWebGLSupport=checkWebGLSupport,this._saveResults=saveResults,this.logger.info("[PsychoJS] Initialised."),this.logger.info("[PsychoJS] @version 2022.3.0"),document.getElementById("root").classList.add("is-ready")}getEnvironment(){if(typeof this._config!="undefined")return this._config.environment}openWindow({name,fullscr,color,gamma,units,waitBlanking,autoLog}={}){if(this.logger.info("[PsychoJS] Open Window."),typeof this._window!="undefined")throw{origin:"PsychoJS.openWindow",context:"when opening a Window",error:"A Window has already been opened."};this._window=new Window({psychoJS:this,name,fullscr,color,gamma,units,waitBlanking,autoLog})}setRedirectUrls(completionUrl,cancellationUrl){this._completionUrl=completionUrl,this._cancellationUrl=cancellationUrl}schedule(task,args){this.logger.debug("schedule task: ",task.toString().substring(0,50),"..."),this._scheduler.add(task,args)}scheduleCondition(condition,thenScheduler,elseScheduler){this.logger.debug("schedule condition: ",condition.toString().substring(0,50),"..."),this._scheduler.addConditional(condition,thenScheduler,elseScheduler)}async start({configURL="config.json",expName="UNKNOWN",expInfo={},resources:resources3=[],dataFileName,surveyId}={}){this.logger.debug();let response2={origin:"PsychoJS.start",context:"when starting the experiment"};try{if(await this._configure(configURL,expName),this._collectIP?this._getParticipantIPInfo():this._IP={IP:"X",hostname:"X",city:"X",region:"X",country:"X",location:"X"},this._experiment=new ExperimentHandler({psychoJS:this,extraInfo:expInfo,dataFileName}),this.getEnvironment()===ExperimentHandler.Environment.SERVER){let params={};this._serverMsg.has("__pilotToken")&&(params.pilotToken=this._serverMsg.get("__pilotToken")),typeof surveyId!="undefined"&&(params.surveyId=surveyId),await this._serverManager.openSession(params),this.beforeunloadCallback=event=>{event.preventDefault(),event.returnValue=""},window.addEventListener("beforeunload",this.beforeunloadCallback);let self2=this;window.addEventListener("unload",event=>{self2._config.session.status==="OPEN"&&(self2._config.experiment.saveIncompleteResults&&self2._saveResults&&self2._experiment.save({sync:!0}),self2._serverManager.closeSession(!1,!0)),typeof self2._window!="undefined"&&self2._window.close()})}this._serverManager.prepareResources(resources3),this._checkWebGLSupport&&!Window.checkWebGLSupport()?(this._experiment.addData("hardware_acceleration","NOT SUPPORTED"),this._experiment.nextEntry(),this._gui.dialog({warning:"It appears that hardware acceleration is either not supported by your browser or currently switched off.<br>As a consequence, this experiment will be rendered using software emulation and advanced features, such as gratings and gamma correction, will not be available.<br><br>You may want to press Cancel, change your browser settings, and reload the experiment. Otherwise press OK to proceed as is.",showCancel:!0,onCancel:()=>{this.quit()},onOK:()=>{this.status=PsychoJS.Status.STARTED,this.logger.info("[PsychoJS] Start Experiment (software emulation mode)."),this._scheduler.start()}})):this._autoStartScheduler&&(this.status=PsychoJS.Status.STARTED,this.logger.info("[PsychoJS] Start Experiment."),this._scheduler.start())}catch(error){throw this.status=PsychoJS.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}}waitForResources(resources3=[]){let response2={origin:"PsychoJS.waitForResources",context:"while waiting for resources to be downloaded"};try{return this.serverManager.waitForResources(resources3)}catch(error){this._gui.dialog({error:Object.assign(response2,{error})})}}importAttributes(obj){if(this.logger.debug("import attributes from: ",toString(obj)),typeof obj!="undefined")for(let attribute in obj)window[attribute]=obj[attribute]}async quit({message,isCompleted=!1,closeWindow=!0,showOK=!0}={}){this.logger.info("[PsychoJS] Quit.");let response2={origin:"PsychoJS.quit",context:"when terminating the experiment"};this._experiment.experimentEnded=!0,this._experiment.isCompleted=isCompleted,this.status=PsychoJS.Status.STOPPED;let isServerEnv=this.getEnvironment()===ExperimentHandler.Environment.SERVER;try{this._scheduler.stop(),isServerEnv&&window.removeEventListener("beforeunload",this.beforeunloadCallback),this.gui.finishDialog({text:"Terminating the experiment. Please wait a few moments...",nbSteps:(this._saveResults?2:0)+(isServerEnv?1:0)}),(isCompleted||this._config.experiment.saveIncompleteResults)&&this._saveResults&&(this.gui.finishDialogNextStep("saving results"),await this._experiment.save(),this.gui.finishDialogNextStep("saving logs"),await this._logger.flush()),isServerEnv&&(this.gui.finishDialogNextStep("closing the session"),await this._serverManager.closeSession(isCompleted));let onTerminate=()=>{if(closeWindow)for(this._window.close();document.body.hasChildNodes();)document.body.removeChild(document.body.lastChild);this._window.closeFullScreen(),this.status=PsychoJS.Status.FINISHED,isCompleted&&typeof this._completionUrl!="undefined"?window.location=this._completionUrl:!isCompleted&&typeof this._cancellationUrl!="undefined"&&(window.location=this._cancellationUrl)};if(showOK){let text="Thank you for your patience.";text+=typeof message!="undefined"?message:"Goodbye!",this._gui.dialog({message:text,onOK:onTerminate})}else this._gui.closeDialog(),onTerminate()}catch(error){throw this.status=PsychoJS.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}}async _configure(configURL,name){let response2={origin:"PsychoJS.configure",context:"when configuring PsychoJS for the experiment"};try{this.status=PsychoJS.Status.CONFIGURING;let experimentUrl=window.location.href;if(this._hosts.some(url3=>experimentUrl.indexOf(url3)===0)){let serverResponse=await this._serverManager.getConfiguration(configURL);if(this._config=serverResponse.config,"psychoJsManager"in this._config&&(delete this._config.psychoJsManager,this._config.pavlovia={URL:"https://pavlovia.org"}),!("experiment"in this._config))throw"missing experiment block in configuration";if(!("name"in this._config.experiment))throw"missing name in experiment block in configuration";if(!("fullpath"in this._config.experiment))throw"missing fullpath in experiment block in configuration";if(!("pavlovia"in this._config))throw"missing pavlovia block in configuration";if(!("URL"in this._config.pavlovia))throw"missing URL in pavlovia block in configuration";if(!("gitlab"in this._config))throw"missing gitlab block in configuration";if(!("projectId"in this._config.gitlab))throw"missing projectId in gitlab block in configuration";this._config.environment=ExperimentHandler.Environment.SERVER}else this._config={environment:ExperimentHandler.Environment.LOCAL,experiment:{name,saveFormat:ExperimentHandler.SaveFormat.CSV,saveIncompleteResults:!0,keys:[]}};this._serverMsg=new Map,getUrlParameters().forEach((value,key)=>{key.indexOf("__")===0&&this._serverMsg.set(key,value)}),this._serverMsg.has("__noOutput")&&(this._saveResults=!1),this.status=PsychoJS.Status.CONFIGURED,this.logger.debug("configuration:",toString(this._config))}catch(error){throw Object.assign(response2,{error})}}async _getParticipantIPInfo(){let response2={origin:"PsychoJS._getParticipantIPInfo",context:"when getting the IP information of the participant"};this.logger.debug("getting the IP information of the participant"),this._IP={};try{let getResponse=await fetch("http://www.geoplugin.net/json.gp",{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer"});if(getResponse.status!==200)throw`unable to obtain the IP of the participant: ${response2.statusText}`;let geoData=await getResponse.json();this._IP={IP:geoData.geoplugin_request,country:geoData.geoplugin_countryName,latitude:geoData.geoplugin_latitude,longitude:geoData.geoplugin_longitude},this.logger.debug("IP information of the participant:",toString(this._IP))}catch(error){throw Object.assign(response2,{error})}}_captureErrors(){this.logger.debug("capturing all errors and showing them in a pop up window");let self2=this;window.onerror=function(message,source,lineno,colno,error){return message==="ResizeObserver loop limit exceeded"||message==="ResizeObserver loop completed with undelivered notifications."?(console.warn(message),!0):(console.error(error),document.body.setAttribute("data-error",JSON.stringify({message,source,lineno,colno,error})),error!==null?self2._gui.dialog({error}):self2._gui.dialog({error:message}),!0)},window.onunhandledrejection=function(error){var _a3,_b2;return console.error(error==null?void 0:error.reason),((_a3=error==null?void 0:error.reason)==null?void 0:_a3.stack)===void 0?document.body.setAttribute("data-error",JSON.stringify(error==null?void 0:error.reason)):document.body.setAttribute("data-error",JSON.stringify((_b2=error==null?void 0:error.reason)==null?void 0:_b2.stack)),self2._gui.dialog({error:error==null?void 0:error.reason}),!0}}_makeStatusTopLevel(){for(let status in PsychoJS.Status)window[status]=PsychoJS.Status[status]}};PsychoJS.Status={NOT_CONFIGURED:Symbol.for("NOT_CONFIGURED"),CONFIGURING:Symbol.for("CONFIGURING"),CONFIGURED:Symbol.for("CONFIGURED"),NOT_STARTED:Symbol.for("NOT_STARTED"),STARTED:Symbol.for("STARTED"),PAUSED:Symbol.for("PAUSED"),FINISHED:Symbol.for("FINISHED"),STOPPED:Symbol.for("FINISHED"),ERROR:Symbol.for("ERROR")};var EventManager=class{constructor(psychoJS){this._psychoJS=psychoJS;for(let keyName in EventManager._pygletMap)EventManager._reversePygletMap[EventManager._pygletMap[keyName]]=keyName;this._keyBuffer=[],this._addKeyListeners(),this._mouseInfo={pos:[0,0],wheelRel:[0,0],buttons:{pressed:[0,0,0],clocks:[new Clock,new Clock,new Clock],times:[0,0,0]},moveClock:new Clock}}getKeys({keyList=null,timeStamped=!1}={}){keyList!=null&&(keyList=EventManager.pyglet2w3c(keyList));let newBuffer=[],keys2=[];for(let i=0;i<this._keyBuffer.length;++i){let key=this._keyBuffer[i],keyId=null;if(keyList!=null){let index3=keyList.indexOf(key.code);index3<0&&(index3=keyList.indexOf(EventManager._keycodeMap[key.keyCode])),index3>=0&&(keyId=EventManager._reversePygletMap[keyList[index3]])}else keyId=EventManager._reversePygletMap[key.code];keyId!=null?timeStamped?keys2.push([keyId,key.timestamp]):keys2.push(keyId):newBuffer.push(key)}return this._keyBuffer=newBuffer,keys2}getMouseInfo(){return this._mouseInfo}clearEvents(attribs){this.clearKeys()}clearKeys(){this._keyBuffer=[]}startMoveClock(){}stopMoveClock(){}resetMoveClock(){}addMouseListeners(renderer){let self2=this;renderer.view.addEventListener("pointerdown",event=>{event.preventDefault(),self2._mouseInfo.buttons.pressed[event.button]=1,self2._mouseInfo.buttons.times[event.button]=self2._psychoJS._monotonicClock.getTime()-self2._mouseInfo.buttons.clocks[event.button].getLastResetTime(),self2._mouseInfo.pos=[event.offsetX,event.offsetY],this._psychoJS.experimentLogger.data("Mouse: "+event.button+" button down, pos=("+self2._mouseInfo.pos[0]+","+self2._mouseInfo.pos[1]+")")},!1),renderer.view.addEventListener("touchstart",event=>{event.preventDefault(),self2._mouseInfo.buttons.pressed[0]=1,self2._mouseInfo.buttons.times[0]=self2._psychoJS._monotonicClock.getTime()-self2._mouseInfo.buttons.clocks[0].getLastResetTime();let touches=event.changedTouches;self2._mouseInfo.pos=[touches[0].pageX,touches[0].pageY],this._psychoJS.experimentLogger.data("Mouse: "+event.button+" button down, pos=("+self2._mouseInfo.pos[0]+","+self2._mouseInfo.pos[1]+")")},!1),renderer.view.addEventListener("pointerup",event=>{event.preventDefault(),self2._mouseInfo.buttons.pressed[event.button]=0,self2._mouseInfo.buttons.times[event.button]=self2._psychoJS._monotonicClock.getTime()-self2._mouseInfo.buttons.clocks[event.button].getLastResetTime(),self2._mouseInfo.pos=[event.offsetX,event.offsetY],this._psychoJS.experimentLogger.data("Mouse: "+event.button+" button up, pos=("+self2._mouseInfo.pos[0]+","+self2._mouseInfo.pos[1]+")")},!1),renderer.view.addEventListener("pointerout",event=>{event.preventDefault(),self2._mouseInfo.buttons.pressed=[0,0,0],self2._mouseInfo.buttons.times=[0,0,0],self2._mouseInfo.pos=[event.offsetX,event.offsetY],this._psychoJS.experimentLogger.data("Mouse: out, pos=("+self2._mouseInfo.pos[0]+","+self2._mouseInfo.pos[1]+")")},!1),renderer.view.addEventListener("touchend",event=>{event.preventDefault(),self2._mouseInfo.buttons.pressed[0]=0,self2._mouseInfo.buttons.times[0]=self2._psychoJS._monotonicClock.getTime()-self2._mouseInfo.buttons.clocks[0].getLastResetTime();let touches=event.changedTouches;self2._mouseInfo.pos=[touches[0].pageX,touches[0].pageY],this._psychoJS.experimentLogger.data("Mouse: "+event.button+" button up, pos=("+self2._mouseInfo.pos[0]+","+self2._mouseInfo.pos[1]+")")},!1),renderer.view.addEventListener("pointermove",event=>{event.preventDefault(),self2._mouseInfo.moveClock.reset(),self2._mouseInfo.pos=[event.offsetX,event.offsetY]},!1),renderer.view.addEventListener("touchmove",event=>{event.preventDefault(),self2._mouseInfo.moveClock.reset();let touches=event.changedTouches;self2._mouseInfo.pos=[touches[0].pageX,touches[0].pageY]},!1),renderer.view.addEventListener("wheel",event=>{self2._mouseInfo.wheelRel[0]+=event.deltaX,self2._mouseInfo.wheelRel[1]+=event.deltaY,this._psychoJS.experimentLogger.data("Mouse: wheel shift=("+event.deltaX+","+event.deltaY+"), pos=("+self2._mouseInfo.pos[0]+","+self2._mouseInfo.pos[1]+")")},!1)}_addKeyListeners(){let self2=this;window.addEventListener("keydown",event=>{let timestamp=MonotonicClock.getReferenceTime(),code=EventManager._pygletMap[event.key];typeof code=="undefined"&&(code=EventManager.keycode2w3c(event.keyCode)),self2._keyBuffer.push({code,key:event.key,keyCode:event.keyCode,timestamp}),self2._psychoJS.logger.trace("keydown: ",event.key),self2._psychoJS.experimentLogger.data("Keydown: "+event.key),event.stopPropagation()})}static pyglet2w3c(pygletKeyList){let w3cKeyList=[];for(let i=0;i<pygletKeyList.length;i++)typeof EventManager._pygletMap[pygletKeyList[i]]=="undefined"?w3cKeyList.push(pygletKeyList[i]):w3cKeyList.push(EventManager._pygletMap[pygletKeyList[i]]);return w3cKeyList}static w3c2pyglet(code){return code in EventManager._reversePygletMap?EventManager._reversePygletMap[code]:"N/A"}static keycode2w3c(keycode){return EventManager._keycodeMap[keycode]}};EventManager._keycodeMap={49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",48:"Digit0",65:"KeyA",66:"KeyB",67:"KeyC",68:"KeyD",69:"KeyE",70:"KeyF",71:"KeyG",72:"KeyH",73:"KeyI",74:"KeyJ",75:"KeyK",76:"KeyL",77:"KeyM",78:"KeyN",79:"KeyO",80:"KeyP",81:"KeyQ",82:"KeyR",83:"KeyS",84:"KeyT",85:"KeyU",86:"KeyV",87:"KeyW",88:"KeyX",89:"KeyY",90:"KeyZ",188:"Comma",190:"Period",186:"Semicolon",222:"Quote",219:"BracketLeft",221:"BracketRight",192:"Backquote",220:"Backslash",189:"Minus",187:"Equal",144:"NumLock",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",107:"NumpadAdd",194:"NumpadComma",110:"NumpadDecimal",111:"NumpadDivide",12:"NumpadEqual",106:"NumpadMultiply",109:"NumpadSubtract",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",27:"Escape",32:"Space"};EventManager._pygletMap={grave:"Backquote",backslash:"Backslash",backspace:"Backspace",bracketleft:"BracketLeft",bracketright:"BracketRight",comma:"Comma","0":"Digit0","1":"Digit1","2":"Digit2","3":"Digit3","4":"Digit4","5":"Digit5","6":"Digit6","7":"Digit7","8":"Digit8","9":"Digit9",equal:"Equal",a:"KeyA",b:"KeyB",c:"KeyC",d:"KeyD",e:"KeyE",f:"KeyF",g:"KeyG",h:"KeyH",i:"KeyI",j:"KeyJ",k:"KeyK",l:"KeyL",m:"KeyM",n:"KeyN",o:"KeyO",p:"KeyP",q:"KeyQ",r:"KeyR",s:"KeyS",t:"KeyT",u:"KeyU",v:"KeyV",w:"KeyW",x:"KeyX",y:"KeyY",z:"KeyZ",minus:"Minus",period:"Period",apostrophe:"Quote",semicolon:"Semicolon",slash:"Slash",escape:"Escape",loption:"AltLeft",roption:"AltRight",capslock:"CapsLock",lcontrol:"ControlLeft",rcontrol:"ControlRight",return:"Enter",lcommand:"MetaLeft",rcommand:"MetaRight",lshift:"ShiftLeft",rshift:"ShiftRight",space:"Space",tab:"Tab",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",num_0:"Numpad0",num_1:"Numpad1",num_2:"Numpad2",num_3:"Numpad3",num_4:"Numpad4",num_5:"Numpad5",num_6:"Numpad6",num_7:"Numpad7",num_8:"Numpad8",num_9:"Numpad9",num_decimal:"NumpadDecimal",num_enter:"NumpadEnter",num_add:"NumpadAdd",num_subtract:"NumpadSubtract",num_multiply:"NumpadMultiply",num_divide:"NumpadDivide",num_equal:"NumpadEqual",num_numlock:"NumpadNumlock"};EventManager._reversePygletMap={};var BuilderKeyResponse=class{constructor(psychoJS){this._psychoJS=psychoJS,this.status=PsychoJS.Status.NOT_STARTED,this.keys=[],this.corr=0,this.rt=[],this.clock=new Clock}};var KeyPress=class{constructor(code,tDown,name){this.code=code,this.tDown=tDown,this.name=typeof name!="undefined"?name:EventManager.w3c2pyglet(code),this.duration=void 0,this.rt=void 0}},Keyboard=class extends PsychObject{constructor({psychoJS,bufferSize=1e4,waitForStart=!1,clock,autoLog=!1}={}){super(psychoJS);typeof clock=="undefined"&&(clock=new Clock),this._addAttribute("bufferSize",bufferSize),this._addAttribute("waitForStart",waitForStart),this._addAttribute("clock",clock),this._addAttribute("autoLog",autoLog),this._addAttribute("status",waitForStart?PsychoJS.Status.NOT_STARTED:PsychoJS.Status.STARTED),this.clearEvents(),this._addKeyListeners()}start(){this._status=PsychoJS.Status.STARTED}stop(){this._status=PsychoJS.Status.STOPPED}getEvents(){if(this._bufferLength===0)return[];let filteredEvents=[],i=this._bufferLength===this._bufferSize?this._bufferIndex:-1;do{i=(i+1)%this._bufferSize;let keyEvent=this._circularBuffer[i];keyEvent&&filteredEvents.push(keyEvent)}while(i!==this._bufferIndex);return filteredEvents}getKeys({keyList=[],waitRelease=!0,clear=!0}={}){if(this._bufferLength===0)return[];let keyPresses=[],i=this._bufferLength===this._bufferSize?this._bufferIndex:-1;do{i=(i+1)%this._bufferSize;let keyEvent=this._circularBuffer[i];if(keyEvent&&keyEvent.status===Keyboard.KeyStatus.KEY_UP&&(keyList.length===0||keyList.includes(keyEvent.pigletKey))){let precedingKeydownIndex=keyEvent.keydownIndex;if(typeof precedingKeydownIndex!="undefined"){let precedingKeydownEvent=this._circularBuffer[precedingKeydownIndex];if(precedingKeydownEvent){let tDown=precedingKeydownEvent.timestamp,keyPress=new KeyPress(keyEvent.code,tDown,keyEvent.pigletKey);keyPress.rt=tDown-this._clock.getLastResetTime(),keyPress.duration=keyEvent.timestamp-precedingKeydownEvent.timestamp,keyPresses.push(keyPress),clear&&(this._circularBuffer[precedingKeydownIndex]=null)}}clear&&(this._circularBuffer[i]=null)}}while(i!==this._bufferIndex);if(!waitRelease)for(let unmatchedKeyDownIndex of this._unmatchedKeydownMap.values()){let keyEvent=this._circularBuffer[unmatchedKeyDownIndex];if(keyEvent&&(keyList.length===0||keyList.includes(keyEvent.pigletKey))){let tDown=keyEvent.timestamp,keyPress=new KeyPress(keyEvent.code,tDown,keyEvent.pigletKey);keyPress.rt=tDown-this._clock.getLastResetTime(),keyPresses.push(keyPress),clear&&(this._unmatchedKeydownMap.delete(keyEvent.code),this._circularBuffer[unmatchedKeyDownIndex]=null)}}return clear&&keyList.length===0&&this.clearEvents(),keyPresses}clearEvents(){this._circularBuffer=new Array(this._bufferSize),this._bufferLength=0,this._bufferIndex=-1,this._previousKeydownKey=void 0,this._unmatchedKeydownMap=new Map}static includes(keypressList,keyName){return Array.isArray(keypressList)?typeof keypressList.find(keypress=>keypress.name===keyName)!="undefined":!1}_addKeyListeners(){this._previousKeydownKey=void 0;let self2=this;window.addEventListener("keydown",event=>{if(event.repeat)return;let timestamp=MonotonicClock.getReferenceTime();if(this._status!==PsychoJS.Status.STARTED)return;self2._previousKeydownKey=event.key;let code=EventManager._pygletMap[event.key];typeof code=="undefined"&&(code=EventManager.keycode2w3c(event.keyCode));let pigletKey=EventManager.w3c2pyglet(code);self2._bufferIndex=(self2._bufferIndex+1)%self2._bufferSize,self2._bufferLength=Math.min(self2._bufferLength+1,self2._bufferSize),self2._circularBuffer[self2._bufferIndex]={code,key:event.key,pigletKey,status:Keyboard.KeyStatus.KEY_DOWN,timestamp},self2._unmatchedKeydownMap.set(event.code,self2._bufferIndex),self2._psychoJS.logger.trace("keydown: ",event.key),event.stopPropagation()}),window.addEventListener("keyup",event=>{let timestamp=MonotonicClock.getReferenceTime();if(this._status!==PsychoJS.Status.STARTED)return;self2._previousKeydownKey=void 0;let code=EventManager._pygletMap[event.key];typeof code=="undefined"&&(code=EventManager.keycode2w3c(event.keyCode));let pigletKey=EventManager.w3c2pyglet(code);self2._bufferIndex=(self2._bufferIndex+1)%self2._bufferSize,self2._bufferLength=Math.min(self2._bufferLength+1,self2._bufferSize),self2._circularBuffer[self2._bufferIndex]={code,key:event.key,pigletKey,status:Keyboard.KeyStatus.KEY_UP,timestamp};let correspondingKeydownIndex=self2._unmatchedKeydownMap.get(event.code);typeof correspondingKeydownIndex!="undefined"&&(self2._circularBuffer[self2._bufferIndex].keydownIndex=correspondingKeydownIndex,self2._unmatchedKeydownMap.delete(event.code)),self2._psychoJS.logger.trace("keyup: ",event.key),event.stopPropagation()})}};Keyboard.KeyStatus={KEY_DOWN:Symbol.for("KEY_DOWN"),KEY_UP:Symbol.for("KEY_UP")};var MinimalStim=class extends PsychObject{constructor({name,win,autoDraw,autoLog}={}){super(win._psychoJS,name);this._pixi=void 0,this._addAttribute("win",win,void 0),this._addAttribute("autoDraw",autoDraw,!1),this._addAttribute("autoLog",autoLog,typeof win!="undefined"&&win!==null?win.autoLog:!1),this._needUpdate=!1,this.status=PsychoJS.Status.NOT_STARTED}setAutoDraw(autoDraw,log3=!1){this._setAttribute("autoDraw",autoDraw,log3),this._autoDraw?this.draw():this.hide()}draw(){this.win&&(this._win._drawList.indexOf(this)<0?(this._updateIfNeeded(),typeof this._pixi=="undefined"?this.psychoJS.logger.warn("the Pixi.js representation of this stimulus is undefined."):(this._win.addPixiObject(this._pixi),this.win._drawList.push(this))):this._needUpdate&&typeof this._pixi!="undefined"&&(this._win.removePixiObject(this._pixi),this._updateIfNeeded(),this._win.addPixiObject(this._pixi))),this.status=PsychoJS.Status.STARTED}hide(){if(this._win){let index3=this._win._drawList.indexOf(this);index3>=0&&(this._win._drawList.splice(index3,1),typeof this._pixi!="undefined"&&this._win.removePixiObject(this._pixi)),this.status=PsychoJS.Status.STOPPED}}contains(object,units){throw{origin:"MinimalStim.contains",context:`when determining whether stimulus: ${this._name} contains object: ${toString(object)}`,error:"this method is abstract and should not be called."}}release(log3=!1){this._setAttribute("autoDraw",!1,log3),this.status=PsychoJS.Status.STOPPED,typeof this._pixi!="undefined"&&(this._pixi.destroy(!0),this._pixi=void 0)}_updateIfNeeded(){throw{origin:"MinimalStim._updateIfNeeded",context:"when updating stimulus: "+this._name,error:"this method is abstract and should not be called."}}};var Mouse=class extends PsychObject{constructor({name,win,autoLog=!0}={}){super(win._psychoJS,name);this._lastPos=void 0,this._prevPos=void 0,this._movedistance=0;let units=win.units,visible=1;this._addAttribute("win",win),this._addAttribute("units",units),this._addAttribute("visible",visible),this._addAttribute("autoLog",autoLog),this.status=PsychoJS.Status.NOT_STARTED}getPos(){let pos_px=this.psychoJS.eventManager.getMouseInfo().pos.slice();return pos_px[0]=pos_px[0]-this.win.size[0]/2,pos_px[1]=this.win.size[1]/2-pos_px[1],this._lastPos=to_win(pos_px,"pix",this._win),this._lastPos}getRel(){if(typeof this._lastPos=="undefined")return this.getPos();{let lastPos=this._lastPos,pos=this.getPos();return[-lastPos[0]+pos[0],-lastPos[1]+pos[1]]}}getWheelRel(){let mouseInfo=this.psychoJS.eventManager.getMouseInfo(),wheelRel_px=mouseInfo.wheelRel.slice(),wheelRel=to_win(wheelRel_px,"pix",this._win);return mouseInfo.wheelRel=[0,0],wheelRel}getPressed(getTime=!1){let buttonPressed=this.psychoJS.eventManager.getMouseInfo().buttons.pressed.slice();if(getTime){let buttonTimes=this.psychoJS.eventManager.getMouseInfo().buttons.times.slice();return[buttonPressed,buttonTimes]}else return buttonPressed}isPressedIn(...args){let[{shape:shapeMaybe,buttons:buttonsMaybe}={}]=args.filter(v=>!!v),hasKey=key=>object=>!!(object&&object[key]),isShape=hasKey("contains"),shape=(isShape(shapeMaybe)?shapeMaybe:args.find(isShape))||shapeMaybe,hasButtons=hasKey("buttons"),{isInteger}=Number,buttonsFound=isInteger(buttonsMaybe)?buttonsMaybe:args.find(o=>hasButtons(o)||isInteger(o)),{buttons:wanted=buttonsFound||buttonsMaybe}=buttonsFound||{};if(typeof shape.contains=="function"){let mouseInfo=this.psychoJS.eventManager.getMouseInfo(),{pressed}=mouseInfo.buttons;return(isInteger(wanted)?pressed[wanted]>0:pressed.some(v=>v>0))&&shape.contains(this)}return!1}mouseMoved(distance,reset=!1){return typeof this._lastPos=="undefined"&&this.getPos(),this._prevPos=this._lastPos.slice(),this.getPos(),typeof reset=="boolean"&&reset==!1?typeof distance=="undefined"?this._prevPos[0]!=this._lastPos[0]||this._prevPos[1]!=this._lastPos[1]:typeof distance=="number"?(this._movedistance=Math.sqrt((this._prevPos[0]-this._lastPos[0])*(this._prevPos[0]-this._lastPos[0])+(this._prevPos[1]-this._lastPos[1])*(this._prevPos[1]-this._lastPos[1])),this._movedistance>distance):this._prevPos[0]+distance[0]-this._lastPos[0]>0||this._prevPos[1]+distance[1]-this._lastPos[0]>0:typeof reset=="boolean"&&reset==!0?(this.psychoJS.eventManager.getMouseInfo().moveClock.reset(),!1):reset==="here"?(this._prevPos=this._lastPos.clone(),!1):reset instanceof Array?(this._prevPos=reset.slice(),distance?typeof distance=="number"?(this._movedistance=Math.sqrt((this._prevPos[0]-this._lastPos[0])*(this._prevPos[0]-this._lastPos[0])+(this._prevPos[1]-this._lastPos[1])*(this._prevPos[1]-this._lastPos[1])),this._movedistance>distance):Math.abs(this._lastPos[0]-this._prevPos[0])>distance[0]||Math.abs(this._lastPos[1]-this._prevPos[1])>distance[1]:!1):!1}mouseMoveTime(){return this.psychoJS.eventManager.getMouseInfo().moveClock.getTime()}clickReset(buttons=[0,1,2]){let mouseInfo=this.psychoJS.eventManager.getMouseInfo();for(let b of buttons)mouseInfo.buttons.clocks[b].reset(),mouseInfo.buttons.times[b]=0}};var WindowMixin=superclass=>class extends superclass{constructor(args){super(args)}_getLengthPix(length,integerCoordinates=!1){let response2={origin:"WindowMixin._getLengthPix",context:"when converting a length from stimulus unit to pixel units"},length_px;if(this._units==="pix")length_px=length;else if(typeof this._units=="undefined"||this._units==="norm"){var winSize=this.win.size;length_px=length*winSize[1]/2}else if(this._units==="height"){let minSize=Math.min(this.win.size[0],this.win.size[1]);length_px=length*minSize}else throw Object.assign(response2,{error:"unable to deal with unit: "+this._units});return integerCoordinates?Math.round(length_px):length_px}_getLengthUnits(length_px){let response2={origin:"WindowMixin._getLengthUnits",context:"when converting a length from pixel unit to stimulus units"};if(this._units==="pix")return length_px;if(typeof this._units=="undefined"||this._units==="norm"){let winSize=this.win.size;return length_px/(winSize[1]/2)}else if(this._units==="height"){let minSize=Math.min(this.win.size[0],this.win.size[1]);return length_px/minSize}else throw Object.assign(response2,{error:"unable to deal with unit: "+this._units})}_getHorLengthPix(length){let response2={origin:"WindowMixin._getHorLengthPix",context:"when converting a length from stimulus units to pixel units"};if(this._units==="pix")return length;if(typeof this._units=="undefined"||this._units==="norm"){var winSize=this.win.size;return length*winSize[0]/2}else if(this._units==="height"){let minSize=Math.min(this.win.size[0],this.win.size[1]);return length*minSize}else throw Object.assign(response2,{error:"unable to deal with unit: "+this._units})}_getVerLengthPix(length){let response2={origin:"WindowMixin._getVerLengthPix",context:"when converting a length from pixel unit to stimulus units"};if(this._units==="pix")return length;if(typeof this._units=="undefined"||this._units==="norm"){var winSize=this.win.size;return length*winSize[1]/2}else if(this._units==="height"){let minSize=Math.min(this.win.size[0],this.win.size[1]);return length*minSize}else throw Object.assign(response2,{error:"unable to deal with unit: "+this._units})}};var data_exports={};__export(data_exports,{ExperimentHandler:()=>ExperimentHandler,MultiStairHandler:()=>MultiStairHandler,QuestHandler:()=>QuestHandler,Shelf:()=>Shelf,TrialHandler:()=>TrialHandler});var import_seedrandom2=__toModule(require_seedrandom2());var TrialHandler=class extends PsychObject{get experimentHandler(){return this._experimentHandler}set experimentHandler(exp){this._experimentHandler=exp}constructor({psychoJS,trialList=[void 0],nReps,method=TrialHandler.Method.RANDOM,extraInfo=[],seed,name,autoLog=!0}={}){super(psychoJS);this._addAttribute("trialList",trialList),this._addAttribute("nReps",nReps),this._addAttribute("method",method),this._addAttribute("extraInfo",extraInfo),this._addAttribute("name",name),this._addAttribute("autoLog",autoLog),this._addAttribute("seed",seed),this._prepareTrialList(),this.nStim=this.trialList.length,this.nTotal=this.nReps*this.nStim,this.nRemaining=this.nTotal,this.thisRepN=0,this.thisTrialN=-1,this.thisN=-1,this.thisIndex=0,this.ran=0,this.order=-1,this._snapshots=[],this._prepareSequence(),this._experimentHandler=null,this.thisTrial=null,this._finished=!1}next(){let trialIterator=this[Symbol.iterator](),{value}=trialIterator.next();return value}[Symbol.iterator](){return{next:()=>(this.thisTrialN++,this.thisN++,this.nRemaining--,this.nRemaining===0,this.thisTrialN===this.nStim&&(this.thisTrialN=0,this.thisRepN++),this.thisRepN>=this.nReps?(this.thisTrial=null,{done:!0}):(this.thisIndex=this._trialSequence[this.thisRepN][this.thisTrialN],this.thisTrial=this.trialList[this.thisIndex],this.ran=1,this.order=this.thisN,{value:this.thisTrial,done:!1}))}}forEach(callback){let trialIterator=this[Symbol.iterator]();for(;;){let result=trialIterator.next();if(result.done)break;callback(result.value)}}getSnapshot(){let currentIndex=this.thisIndex,snapshot={handler:this,name:this.name,nStim:this.nStim,nTotal:this.nTotal,nRemaining:this.nRemaining,thisRepN:this.thisRepN,thisTrialN:this.thisTrialN,thisN:this.thisN,thisIndex:this.thisIndex,ran:this.ran,finished:this._finished,getCurrentTrial:()=>this.getTrial(currentIndex),getTrial:(index3=0)=>this.getTrial(index3),addData:(key,value)=>this.addData(key,value)},currentTrial=this.getCurrentTrial(),excludedAttributes=["handler","name","nStim","nRemaining","thisRepN","thisTrialN","thisN","thisIndex","ran","finished"],trialAttributes=[];for(let attribute in currentTrial)attribute in excludedAttributes?this._psychoJS.logger.warn(`attempt to replace the value of protected TrialHandler variable: ${attribute}`):(snapshot[attribute]=currentTrial[attribute],trialAttributes.push(attribute));return snapshot.trialAttributes=trialAttributes,this._snapshots.push(snapshot),snapshot}setSeed(seed,log3){this._setAttribute("seed",seed,log3),typeof seed!="undefined"?this._randomNumberGenerator=(0,import_seedrandom2.default)(seed):this._randomNumberGenerator=(0,import_seedrandom2.default)()}static fromSnapshot(snapshot){if(typeof snapshot=="undefined")return;snapshot.handler.nStim=snapshot.nStim,snapshot.handler.nTotal=snapshot.nTotal,snapshot.handler.nRemaining=snapshot.nRemaining,snapshot.handler.thisRepN=snapshot.thisRepN,snapshot.handler.thisTrialN=snapshot.thisTrialN,snapshot.handler.thisN=snapshot.thisN,snapshot.handler.thisIndex=snapshot.thisIndex,snapshot.handler.ran=snapshot.ran,snapshot.handler._finished=snapshot._finished,snapshot.handler.thisTrial=snapshot.handler.getCurrentTrial();let name=snapshot.name;name[name.length-1]==="s"&&(name=name.substr(0,name.length-1)),name=`this${name[0].toUpperCase()}${name.substr(1)}`;let value={};for(let attribute of snapshot.trialAttributes)value[attribute]=snapshot[attribute];window[name]=value}get finished(){return this._finished}set finished(isFinished){this._finished=isFinished,this._snapshots.forEach(snapshot=>{snapshot.finished=isFinished})}getTrialIndex(){return this.thisIndex}setTrialIndex(index3){this.thisIndex=index3}getAttributes(){return!Array.isArray(this.trialList)||this.nStim===0?[]:this.trialList[0]?Object.keys(this.trialList[0]):[]}getCurrentTrial(){return this.trialList[this.thisIndex]}getTrial(index3=0){if(!(index3<0||index3>this.nTotal))return this.trialList[index3]}getFutureTrial(n=1){if(!(this.thisIndex+n<0||n>this.nRemaining))return this.trialList[this.thisIndex+n]}getEarlierTrial(n=-1){return getFutureTrial(-abs(n))}addData(key,value){this._experimentHandler&&this._experimentHandler.addData(key,value)}static importConditions(serverManager,resourceName,selection=null){try{let resourceExtension=resourceName.split(".").pop();if(["csv","odp","xls","xlsx"].indexOf(resourceExtension)>-1){let resourceValue=serverManager.getResource(resourceName,!0),decodedResourceMaybe=new Uint8Array(resourceValue),type=resourceExtension==="csv"?"string":"array",decodedResource=type==="string"?new TextDecoder().decode(decodedResourceMaybe):decodedResourceMaybe,workbook=readSync(decodedResource,{type});if(workbook.SheetNames.length===0)throw"workbook should contain at least one worksheet";let sheetName=workbook.SheetNames[0],worksheet=workbook.Sheets[sheetName],sheet=utils.sheet_to_json(worksheet,{header:1,blankrows:!1}),fields=sheet.shift(),selectedRows=selection===null?sheet:selectFromArray(sheet,selection),trialList=new Array(selectedRows.length-1);for(let r=0;r<selectedRows.length;++r){let row=selectedRows[r],trial={};for(let l=0;l<fields.length;++l){let value=row[l],arrayMaybe=turnSquareBracketsIntoArrays(value);if(Array.isArray(arrayMaybe)&&(value=arrayMaybe),typeof value=="string"){let numberMaybe=Number.parseFloat(value);!isNaN(numberMaybe)&&numberMaybe.toString().length===value.length?value=numberMaybe:value=value.replace(/(\n)/g,`
`)}trial[fields[l]]=value}trialList[r]=trial}return trialList}else throw"extension: "+resourceExtension+" currently not supported."}catch(error){throw{origin:"TrialHandler.importConditions",context:`when importing condition: ${resourceName}`,error}}}_prepareTrialList(){let response2={origin:"TrialHandler._prepareTrialList",context:"when preparing the trial list"};if(typeof this._trialList=="undefined")this.trialList=[void 0];else if(Array.isArray(this._trialList))this._trialList.length===0&&(this.trialList=[void 0]);else if(typeof this._trialList=="string")this.trialList=TrialHandler.importConditions(this.psychoJS.serverManager,this._trialList);else throw Object.assign(response2,{error:`unable to prepare trial list: unknown type: ${typeof this._trialList}`})}_prepareSequence(){let response2={origin:"TrialHandler._prepareSequence",context:"when preparing a sequence of trials"},indices2=Array.from(this.trialList.keys());if(this._method===TrialHandler.Method.SEQUENTIAL)this._trialSequence=Array(this.nReps).fill(indices2);else if(this._method===TrialHandler.Method.RANDOM){this._trialSequence=[];for(let i=0;i<this.nReps;++i)this._trialSequence.push(shuffle(indices2.slice(),this._randomNumberGenerator))}else if(this._method===TrialHandler.Method.FULL_RANDOM){let flatSequence=[];for(let i=0;i<this.nReps;++i)flatSequence.push.apply(flatSequence,indices2);shuffle(flatSequence,this._randomNumberGenerator),this._trialSequence=[];for(let i=0;i<this.nReps;i++)this._trialSequence.push(flatSequence.slice(i*this.nStim,(i+1)*this.nStim))}else throw Object.assign(response2,{error:"unknown method"});return this._trialSequence}};TrialHandler.Method={SEQUENTIAL:Symbol.for("SEQUENTIAL"),RANDOM:Symbol.for("RANDOM"),FULL_RANDOM:Symbol.for("FULL_RANDOM"),FULLRANDOM:Symbol.for("FULL_RANDOM")};var QuestHandler=class extends TrialHandler{constructor({psychoJS,varName,startVal,startValSd,minVal,maxVal,pThreshold,nTrials,stopInterval,method,beta,delta,gamma,grain,name,autoLog}={}){super({psychoJS,name,autoLog,method:TrialHandler.Method.SEQUENTIAL,trialList:Array(nTrials),nReps:1});this._addAttribute("varName",varName),this._addAttribute("startVal",startVal),this._addAttribute("minVal",minVal,Number.MIN_VALUE),this._addAttribute("maxVal",maxVal,Number.MAX_VALUE),this._addAttribute("startValSd",startValSd),this._addAttribute("pThreshold",pThreshold,.82),this._addAttribute("nTrials",nTrials),this._addAttribute("stopInterval",stopInterval,Number.MIN_VALUE),this._addAttribute("beta",beta,3.5),this._addAttribute("delta",delta,.01),this._addAttribute("gamma",gamma,.5),this._addAttribute("grain",grain,.01),this._addAttribute("method",method,QuestHandler.Method.QUANTILE),this._setupJsQuest(),this._estimateQuestValue()}setMethod(method,log3){let methodMapping={quantile:QuestHandler.Method.QUANTILE,mean:QuestHandler.Method.MEAN,mode:QuestHandler.Method.MODE};methodMapping.hasOwnProperty(method)&&(method=methodMapping[method]),this._setAttribute("method",method,log3)}addResponse(response2,value,doAddData=!0){if(response2!==0&&response2!==1)throw{origin:"QuestHandler.addResponse",context:"when adding a trial response",error:`the response must be either 0 or 1, got: ${JSON.stringify(response2)}`};doAddData&&this._psychoJS.experiment.addData(this._name+".response",response2),typeof value!="undefined"?this._jsQuest=jsQUEST.QuestUpdate(this._jsQuest,value,response2):this._jsQuest=jsQUEST.QuestUpdate(this._jsQuest,this._questValue,response2),this._finished||(this.next(),this._estimateQuestValue())}simulate(trueValue){let response2=jsQUEST.QuestSimulate(this._jsQuest,this._questValue,trueValue);return this._questValue=Math.max(this._minVal,Math.min(this._maxVal,this._questValue)),this._psychoJS.logger.debug(`simulated response: ${response2}`),response2}mean(){return jsQUEST.QuestMean(this._jsQuest)}sd(){return jsQUEST.QuestSd(this._jsQuest)}mode(){let[mode,pdf]=jsQUEST.QuestMode(this._jsQuest);return mode}quantile(quantileOrder){return jsQUEST.QuestQuantile(this._jsQuest,quantileOrder)}getQuestValue(){return this._questValue}get intensity(){return this.getQuestValue()}confInterval(getDifference=!1){let CI=[jsQUEST.QuestQuantile(this._jsQuest,.05),jsQUEST.QuestQuantile(this._jsQuest,.95)];return getDifference?Math.abs(CI[0]-CI[1]):CI}_setupJsQuest(){this._jsQuest=jsQUEST.QuestCreate(this._startVal,this._startValSd,this._pThreshold,this._beta,this._delta,this._gamma,this._grain)}_estimateQuestValue(){if(this._method===QuestHandler.Method.QUANTILE)this._questValue=jsQUEST.QuestQuantile(this._jsQuest);else if(this._method===QuestHandler.Method.MEAN)this._questValue=jsQUEST.QuestMean(this._jsQuest);else if(this._method===QuestHandler.Method.MODE){let[mode,pdf]=jsQUEST.QuestMode(this._jsQuest);this._questValue=mode}else throw{origin:"QuestHandler._estimateQuestValue",context:"when estimating the next value of the QUEST variable",error:`unknown method: ${this._method}, please use: mean, mode, or quantile`};if(this._psychoJS.logger.debug(`estimated value for QUEST variable ${this._varName}: ${this._questValue}`),this.thisN>0&&(this.nRemaining===0||this.confInterval(!0)<this._stopInterval)){this._finished=!0;for(let t=0;t<this._snapshots.length-1;++t)if(typeof this._trialList[t+1]=="undefined"){this._snapshots[t].finished=!0;break}return}for(let t=0;t<this._trialList.length;++t)if(typeof this._trialList[t]=="undefined"){this._trialList[t]={[this._varName]:this._questValue},typeof this._snapshots[t]!="undefined"&&(this._snapshots[t][this._varName]=this._questValue,this._snapshots[t].trialAttributes.push(this._varName));break}}};QuestHandler.Method={QUANTILE:Symbol.for("QUANTILE"),MEAN:Symbol.for("MEAN"),MODE:Symbol.for("MODE")};var import_seedrandom3=__toModule(require_seedrandom2());var MultiStairHandler=class extends TrialHandler{constructor({psychoJS,varName,stairType,conditions,method=TrialHandler.Method.RANDOM,nTrials=50,randomSeed,name,autoLog}={}){super({psychoJS,name,autoLog,seed:randomSeed,method:TrialHandler.Method.SEQUENTIAL,trialList:Array(nTrials),nReps:1});this._multiMethod=method,this._addAttribute("varName",varName),this._addAttribute("stairType",stairType,MultiStairHandler.StaircaseType.SIMPLE),this._addAttribute("conditions",conditions,[void 0]),this._addAttribute("nTrials",nTrials),typeof randomSeed!="undefined"?this._randomNumberGenerator=(0,import_seedrandom3.default)(randomSeed):this._randomNumberGenerator=(0,import_seedrandom3.default)(),this._prepareStaircases(),this._nextTrial()}get currentStaircase(){return this._currentStaircase}get intensity(){if(this._currentStaircase instanceof QuestHandler)return this._currentStaircase.getQuestValue()}addResponse(response2,value){if(response2!==0&&response2!==1)throw{origin:"MultiStairHandler.addResponse",context:"when adding a trial response",error:`the response must be either 0 or 1, got: ${JSON.stringify(response2)}`};this._psychoJS.experiment.addData(this._name+".response",response2),this._finished||(this._currentStaircase.addResponse(response2,value,!1),this._nextTrial())}_validateConditions(){try{if(!Array.isArray(this._conditions)||this._conditions.length===0)throw"conditions should be a non empty array of objects";if(this._stairType===MultiStairHandler.StaircaseType.SIMPLE)throw"'simple' staircases are currently not supported";for(let condition of this._conditions){if(typeof condition!="object")throw"one of the conditions is not an object";if(!("startVal"in condition))throw"each condition should include a startVal field";if(!("label"in condition))throw"each condition should include a label field";if(this._stairType===MultiStairHandler.StaircaseType.QUEST&&!("startValSd"in condition))throw"QUEST conditions must include a startValSd field"}}catch(error){throw{origin:"MultiStairHandler._validateConditions",context:"when validating the conditions",error}}}_prepareStaircases(){try{this._validateConditions(),this._staircases=[];for(let condition of this._conditions){let handler2;if(this._stairType===MultiStairHandler.StaircaseType.QUEST){let args=Object.assign({},condition);args.psychoJS=this._psychoJS,args.varName=this._varName,args.name=condition.label,args.autoLog=this._autoLog,typeof condition.nTrials=="undefined"&&(args.nTrials=this._nTrials),handler2=new QuestHandler(args)}this._stairType!==MultiStairHandler.StaircaseType.SIMPLE&&this._staircases.push(handler2)}this._currentPass=[],this._currentStaircase=null}catch(error){throw{origin:"MultiStairHandler._prepareStaircases",context:"when preparing the staircases",error}}}_nextTrial(){try{if(this._currentPass.length===0&&(this._currentPass=this._staircases.filter(handler2=>!handler2.finished),this._multiMethod!==TrialHandler.Method.SEQUENTIAL)){if(this._multiMethod===TrialHandler.Method.RANDOM)this._currentPass=shuffle(this._currentPass,this._randomNumberGenerator);else if(this._multiMethod===TrialHandler.Method.FULL_RANDOM&&this._currentPass.length>0){let index3=Math.floor(this._randomNumberGenerator()*this._currentPass.length),handler2=this._currentPass[index3];this._currentPass=[handler2]}}if(this._currentStaircase=this._currentPass.shift(),typeof this._currentStaircase=="undefined"){this._finished=!0;for(let t=0;t<this._snapshots.length-1;++t)if(typeof this._trialList[t+1]=="undefined"){this._snapshots[t].finished=!0;break}return}let value=Number.MIN_VALUE;this._currentStaircase instanceof QuestHandler&&(value=this._currentStaircase.getQuestValue()),this._psychoJS.logger.debug(`selected staircase: ${this._currentStaircase.name}, estimated value for variable ${this._varName}: ${value}`);for(let t=0;t<this._trialList.length;++t)if(typeof this._trialList[t]=="undefined"){this._trialList[t]={[this._name+"."+this._varName]:value,[this._name+".intensity"]:value};for(let attribute of this._currentStaircase._userAttributes)attribute==="name"?this._trialList[t][this._name+".label"]=this._currentStaircase._name:attribute!=="trialList"&&attribute!=="extraInfo"&&(this._trialList[t][this._name+"."+attribute]=this._currentStaircase["_"+attribute]);if(typeof this._snapshots[t]!="undefined"){let fieldName=this._varName;this._snapshots[t][fieldName]=value,this._snapshots[t].trialAttributes.push(fieldName),fieldName="intensity",this._snapshots[t][fieldName]=value,this._snapshots[t].trialAttributes.push(fieldName);for(let attribute of this._currentStaircase._userAttributes)attribute==="name"?(fieldName="label",this._snapshots[t][fieldName]=this._currentStaircase._name,this._snapshots[t].trialAttributes.push(fieldName)):attribute!=="trialList"&&attribute!=="extraInfo"&&(fieldName=attribute,this._snapshots[t][fieldName]=this._currentStaircase["_"+attribute],this._snapshots[t].trialAttributes.push(fieldName))}break}}catch(error){throw{origin:"MultiStairHandler._nextTrial",context:"when moving onto the next trial",error}}}};MultiStairHandler.StaircaseType={SIMPLE:Symbol.for("SIMPLE"),QUEST:Symbol.for("QUEST")};MultiStairHandler.StaircaseStatus={RUNNING:Symbol.for("RUNNING"),FINISHED:Symbol.for("FINISHED")};var visual_exports={};__export(visual_exports,{ButtonStim:()=>ButtonStim,FaceDetector:()=>FaceDetector,Form:()=>Form,GratingStim:()=>GratingStim,ImageStim:()=>ImageStim,MovieStim:()=>MovieStim,PROGRESS_TYPES:()=>PROGRESS_TYPES,ParticleEmitter:()=>ParticleEmitter,Polygon:()=>Polygon2,Progress:()=>Progress,Rect:()=>Rect,ShapeStim:()=>ShapeStim,Slider:()=>Slider,Survey:()=>Survey,TextBox:()=>TextBox,TextInput:()=>TextInput,TextStim:()=>TextStim,VisualStim:()=>VisualStim});var TextInput=class extends Container{constructor(styles){super();this._input_style=Object.assign({position:"absolute",background:"none",border:"none",outline:"none",text:"",transformOrigin:"0 0",lineHeight:"1",boxSizing:"border-box"},styles.input),styles.box?this._box_generator=typeof styles.box=="function"?styles.box:new DefaultBoxGenerator(styles.box):this._box_generator=null,this._input_style.hasOwnProperty("multiline")?(this._multiline=!!this._input_style.multiline,delete this._input_style.multiline):this._multiline=!1,this._anchor=new ObservablePoint(this._onAnchorUpdate,this,0,0),this._box_cache={},this._previous={},this._dom_added=!1,this._dom_visible=!0,this._placeholder="",this._placeholderColor=11119017,this._selection=[0,0],this._restrict_value="",this._createDOMInput(),this.substituteText=!this._multiline,this._setState("DEFAULT")}get substituteText(){return this._substituted}set substituteText(substitute){this._substituted!=substitute&&(this._substituted=substitute,substitute?(this._createSurrogate(),this._dom_visible=!1):(this._destroySurrogate(),this._dom_visible=!0),this.placeholder=this._placeholder,this._update())}get placeholder(){return this._placeholder}set placeholder(text){this._placeholder=text,this._substituted?(this._updateSurrogate(),this._dom_input.placeholder=""):this._dom_input.placeholder=text}get disabled(){return this._disabled}set disabled(disabled){this._disabled=disabled,this._dom_input.disabled=disabled,this._dom_input.contentEditable=!disabled,this._setState(disabled?"DISABLED":"DEFAULT")}get maxLength(){return this._max_length}set maxLength(length){this._max_length=length,this._dom_input.setAttribute("maxlength",length)}get restrict(){return this._restrict_regex}set restrict(regex){regex instanceof RegExp?(regex=regex.toString().slice(1,-1),regex.charAt(0)!=="^"&&(regex="^"+regex),regex.charAt(regex.length-1)!=="$"&&(regex=regex+"$"),regex=new RegExp(regex)):regex=new RegExp("^["+regex+"]*$"),this._restrict_regex=regex}get text(){return this._dom_input.tagName==="INPUT"||this._dom_input.tagName==="TEXTAREA"?this._dom_input.value:this._dom_input.innerText}set text(text){this._dom_input.tagName==="INPUT"||this._dom_input.tagName==="TEXTAREA"?this._dom_input.value=text:this._dom_input.innerText=text,this._substituted&&this._updateSurrogate()}get htmlInput(){return this._dom_input}get anchor(){return this._anchor}set anchor(v){this._anchor.copyFrom(v)}focus(options={preventScroll:!0}){this._substituted&&!this.dom_visible&&this._setDOMInputVisible(!0),this._dom_input.focus(options)}blur(){this._dom_input.blur()}select(){this.focus(),this._dom_input.select()}setInputStyle(key,value){this._input_style[key]=value,this._dom_input.style[key]=value,this._substituted&&(key==="fontFamily"||key==="fontSize")&&this._updateFontMetrics(),this._last_renderer&&this._update()}getInputStyle(key){return this._dom_input.style[key]}destroy(options){this._destroyBoxCache(),super.destroy(options)}_createDOMInput(){this._multiline?(this._dom_input=document.createElement("div"),this._dom_input.contentEditable="true"):(this._dom_input=document.createElement("input"),this._dom_input.type="text");for(let key in this._input_style)this._dom_input.style[key]=this._input_style[key]}_addListeners(){this.on("added",this._onAdded.bind(this)),this.on("removed",this._onRemoved.bind(this)),this._dom_input.addEventListener("keydown",this._onInputKeyDown.bind(this)),this._dom_input.addEventListener("input",this._onInputInput.bind(this)),this._dom_input.addEventListener("keyup",this._onInputKeyUp.bind(this)),this._dom_input.addEventListener("focus",this._onFocused.bind(this)),this._dom_input.addEventListener("blur",this._onBlurred.bind(this))}_onAnchorUpdate(){this.pivot.x=this._anchor.x*this.scale.x*this.width,this.pivot.y=this._anchor.y*this.scale.y*this.height}_onInputKeyDown(e){this._selection=[this._dom_input.selectionStart,this._dom_input.selectionEnd],this.emit("keydown",e.keyCode)}_onInputInput(e){this._disabled||(this._restrict_regex&&this._applyRestriction(),this._substituted&&this._updateSubstitution(),this._updateBox(),this.emit("input",this.text))}_onInputKeyUp(e){this.emit("keyup",e.keyCode)}_onFocused(){this._setState("FOCUSED"),this.emit("focus")}_onBlurred(){this._setState("DEFAULT"),this.emit("blur")}_onAdded(){document.body.appendChild(this._dom_input),this._updateDOMInput(),this._dom_added=!0}_onRemoved(){document.body.removeChild(this._dom_input),this._dom_added=!1}_setState(state){this.state=state,this._updateBox(),this._substituted&&this._updateSubstitution()}renderWebGL(renderer){super.renderWebGL(renderer),this._renderInternal(renderer)}renderCanvas(renderer){super.renderCanvas(renderer),this._renderInternal(renderer)}render(renderer){super.render(renderer),this._renderInternal(renderer)}_renderInternal(renderer){this._resolution=renderer.resolution,this._last_renderer=renderer,this._canvas_bounds=this._getCanvasBounds(),this._needsUpdate()&&this._update()}_update(){this._updateDOMInput(),this._substituted&&this._updateSurrogate(),this._updateBox()}_updateBox(){!this._box_generator||(this._needsNewBoxCache()&&this._buildBoxCache(),!(this.state==this._previous.state&&this._box==this._box_cache[this.state])&&(this._box&&this.removeChild(this._box),this._box=this._box_cache[this.state],this._box.interactive=!this._disabled,this.addChildAt(this._box,0),this._previous.state=this.state,this.pivot.x=this._anchor.x*this.scale.x*this.width,this.pivot.y=this._anchor.y*this.scale.y*this.height))}_updateSubstitution(){this.state==="FOCUSED"?(this._dom_visible=!0,this._surrogate.visible=this.text.length===0):(this._dom_visible=!1,this._surrogate.visible=!0),this._updateDOMInput(),this._updateSurrogate()}_updateDOMInput(){!this._canvas_bounds||(this._dom_input.style.top=(this._canvas_bounds.top||0)+"px",this._dom_input.style.left=(this._canvas_bounds.left||0)+"px",this._dom_input.style.transform=this._pixiMatrixToCSS(this._getDOMRelativeWorldTransform()),this._dom_input.style.opacity=this.worldAlpha,this._setDOMInputVisible(this.worldVisible&&this._dom_visible),this._previous.canvas_bounds=this._canvas_bounds,this._previous.world_transform=this.worldTransform.clone(),this._previous.world_alpha=this.worldAlpha,this._previous.world_visible=this.worldVisible)}_applyRestriction(){this._restrict_regex.test(this.text)?this._restrict_value=this.text:(this.text=this._restrict_value,this._dom_input.setSelectionRange(this._selection[0],this._selection[1]))}_needsUpdate(){return!this._comparePixiMatrices(this.worldTransform,this._previous.world_transform)||!this._compareClientRects(this._canvas_bounds,this._previous.canvas_bounds)||this.worldAlpha!=this._previous.world_alpha||this.worldVisible!=this._previous.world_visible}_needsNewBoxCache(){let input_bounds=this._getDOMInputBounds();return!this._previous.input_bounds||input_bounds.width!=this._previous.input_bounds.width||input_bounds.height!=this._previous.input_bounds.height}_createSurrogate(){this._surrogate_hitbox=new Graphics,this._surrogate_hitbox.alpha=0,this._surrogate_hitbox.interactive=!0,this._surrogate_hitbox.cursor="text",this._surrogate_hitbox.on("pointerdown",this._onSurrogateFocus.bind(this)),this.addChild(this._surrogate_hitbox),this._surrogate_mask=new Graphics,this.addChild(this._surrogate_mask),this._surrogate=new Text("",{}),this.addChild(this._surrogate),this._surrogate.mask=this._surrogate_mask,this._updateFontMetrics(),this._updateSurrogate()}_updateSurrogate(){let padding=this._deriveSurrogatePadding(),input_bounds=this._getDOMInputBounds();switch(this._surrogate.style=this._deriveSurrogateStyle(),this._surrogate.style.padding=Math.max.apply(Math,padding),this._surrogate.y=this._multiline?padding[0]:(input_bounds.height-this._surrogate.height)/2,this._surrogate.x=padding[3],this._surrogate.text=this._deriveSurrogateText(),this._surrogate.style.align){case"left":this._surrogate.x=padding[3];break;case"center":this._surrogate.x=input_bounds.width*.5-this._surrogate.width*.5;break;case"right":this._surrogate.x=input_bounds.width-padding[1]-this._surrogate.width;break}this._updateSurrogateHitbox(input_bounds),this._updateSurrogateMask(input_bounds,padding)}_updateSurrogateHitbox(bounds){this._surrogate_hitbox.clear(),this._surrogate_hitbox.beginFill(0),this._surrogate_hitbox.drawRect(0,0,bounds.width,bounds.height),this._surrogate_hitbox.endFill(),this._surrogate_hitbox.interactive=!this._disabled}_updateSurrogateMask(bounds,padding){this._surrogate_mask.clear(),this._surrogate_mask.beginFill(0),this._surrogate_mask.drawRect(padding[3],0,bounds.width-padding[3]-padding[1],bounds.height),this._surrogate_mask.endFill()}_destroySurrogate(){!this._surrogate||(this.removeChild(this._surrogate),this.removeChild(this._surrogate_hitbox),this._surrogate.destroy(),this._surrogate_hitbox.destroy(),this._surrogate=null,this._surrogate_hitbox=null)}_onSurrogateFocus(){this._setDOMInputVisible(!0),setTimeout(this._ensureFocus.bind(this),10)}_ensureFocus(){this._hasFocus()||this.focus()}_deriveSurrogateStyle(){let style=new TextStyle;for(let key in this._input_style)switch(key){case"color":style.fill=this._input_style.color;break;case"fontFamily":case"fontSize":case"fontWeight":case"fontVariant":case"fontStyle":style[key]=this._input_style[key];break;case"letterSpacing":style.letterSpacing=parseFloat(this._input_style.letterSpacing);break;case"textAlign":style.align=this._input_style.textAlign;break}return this._multiline&&(style.lineHeight=parseFloat(style.fontSize),style.wordWrap=!0,style.wordWrapWidth=this._getDOMInputBounds().width),this._dom_input.value.length===0&&(style.fill=this._placeholderColor),style}_deriveSurrogatePadding(){let indent=this._input_style.textIndent?parseFloat(this._input_style.textIndent):0;if(this._input_style.padding&&this._input_style.padding.length>0){let components=this._input_style.padding.trim().split(" ");if(components.length==1){let padding=parseFloat(components[0]);return[padding,padding,padding,padding+indent]}else if(components.length==2){let paddingV=parseFloat(components[0]),paddingH=parseFloat(components[1]);return[paddingV,paddingH,paddingV,paddingH+indent]}else if(components.length==4){let padding=components.map(component=>parseFloat(component));return padding[3]+=indent,padding}}return[0,0,0,indent]}_deriveSurrogateText(){return this._dom_input.value.length===0?this._placeholder:this._dom_input.type=="password"?"\u2022".repeat(this._dom_input.value.length):this._dom_input.value}_updateFontMetrics(){let font=this._deriveSurrogateStyle().toFontString();this._font_metrics=TextMetrics.measureFont(font)}_buildBoxCache(){this._destroyBoxCache();let states=["DEFAULT","FOCUSED","DISABLED"],input_bounds=this._getDOMInputBounds();states.forEach(state=>{this._box_cache[state]=this._box_generator(input_bounds.width,input_bounds.height,state)}),this._previous.input_bounds=input_bounds}_destroyBoxCache(){this._box&&(this.removeChild(this._box),this._box=null);for(let i in this._box_cache)this._box_cache[i].destroy(),this._box_cache[i]=null,delete this._box_cache[i]}_hasFocus(){return document.activeElement===this._dom_input}_setDOMInputVisible(visible){let definedStyle=this._input_style.display;this._dom_input.style.display=visible?definedStyle||"display":"none"}_getCanvasBounds(){let rect=this._last_renderer.view.getBoundingClientRect(),bounds={top:rect.top,left:rect.left,width:rect.width,height:rect.height};return bounds.left+=window.scrollX,bounds.top+=window.scrollY,bounds}_getDOMInputBounds(){let remove_after=!1;this._dom_added||(document.body.appendChild(this._dom_input),remove_after=!0);let org_transform=this._dom_input.style.transform,org_display=this._dom_input.style.display;this._dom_input.style.transform="",this._dom_input.style.display="block";let bounds=this._dom_input.getBoundingClientRect();return this._dom_input.style.transform=org_transform,this._dom_input.style.display=org_display,remove_after&&document.body.removeChild(this._dom_input),bounds}_getDOMRelativeWorldTransform(){let canvas_bounds=this._last_renderer.view.getBoundingClientRect(),matrix=this.worldTransform.clone();return matrix.scale(this._resolution,this._resolution),matrix.scale(canvas_bounds.width/this._last_renderer.width,canvas_bounds.height/this._last_renderer.height),matrix}_pixiMatrixToCSS(m){return"matrix("+[m.a,m.b,m.c,m.d,m.tx,m.ty].join(",")+")"}_comparePixiMatrices(m1,m2){return!m1||!m2?!1:m1.a==m2.a&&m1.b==m2.b&&m1.c==m2.c&&m1.d==m2.d&&m1.tx==m2.tx&&m1.ty==m2.ty}_compareClientRects(r1,r2){return!r1||!r2?!1:r1.left==r2.left&&r1.top==r2.top&&r1.width==r2.width&&r1.height==r2.height}};function DefaultBoxGenerator(styles){if(styles=styles||{fill:13421772},styles.default)styles.focused=styles.focused||styles.default,styles.disabled=styles.disabled||styles.default;else{let temp_styles=styles;styles={},styles.default=styles.focused=styles.disabled=temp_styles}return function(w,h,state){var _a3;let style=styles[state.toLowerCase()],box=new Graphics;return this._multiline&&(box.hitArea=new Rectangle(0,0,w,h),box.interactive=!this._disabled,box.on("pointerdown",()=>{this._dom_input.focus()})),box.beginFill(style.fill,style.alpha),style.stroke&&box.lineStyle((_a3=style.stroke.width)!=null?_a3:1,style.stroke.color,style.stroke.alpha),style.rounded?box.drawRoundedRect(0,0,w,h,style.rounded):box.drawRect(0,0,w,h),box.endFill(),box.closePath(),box}}var VisualStim=class extends mix(MinimalStim).with(WindowMixin){constructor({name,win,units,ori,opacity,depth,pos,anchor,size,clipMask,autoDraw,autoLog}={}){super({win,name,autoDraw,autoLog});this._addAttribute("units",units,typeof win!="undefined"&&win!==null?win.units:"height",this._onChange(!0,!0)),this._addAttribute("pos",pos,[0,0]),this._addAttribute("anchor",anchor,"center"),this._addAttribute("size",size,void 0),this._addAttribute("ori",ori,0),this._addAttribute("opacity",opacity,1,this._onChange(!0,!1)),this._addAttribute("depth",depth,0,this._onChange(!1,!1)),this._addAttribute("clipMask",clipMask,null,this._onChange(!1,!1)),this._addAttribute("boundingBox",Rectangle.EMPTY),this._needUpdate=!0,this._needPixiUpdate=!0}refresh(){this._onChange(!0,!0)()}setSize(size,log3=!1){typeof size!="undefined"&&size!==null&&(size=toNumerical(size),Array.isArray(size)||(size=[size,size])),this._setAttribute("size",size,log3)&&this._onChange(!0,!0)()}setOri(ori,log3=!1){if(this._setAttribute("ori",ori,log3)){let radians=-ori*.017453292519943295;this._rotationMatrix=[[Math.cos(radians),-Math.sin(radians)],[Math.sin(radians),Math.cos(radians)]],this._pixi instanceof DisplayObject?this._pixi.rotation=-ori*Math.PI/180:this._onChange(!0,!0)()}}setPos(pos,log3=!1){let prevPos=this._pos;this._setAttribute("pos",toNumerical(pos),log3)&&(this._needUpdate=!0,this._boundingBox.x+=this._pos[0]-prevPos[0],this._boundingBox.y+=this._pos[1]-prevPos[1])}setDepth(depth=0,log3=!1){this._setAttribute("depth",depth,log3),this._pixi&&(this._pixi.zIndex=-this._depth)}contains(object,units){let objectPos_px=getPositionFromObject(object,units);if(typeof objectPos_px=="undefined")throw{origin:"VisualStim.contains",context:"when determining whether VisualStim: "+this._name+" contains object: "+toString(object),error:"unable to determine the position of the object"};return this._getBoundingBox_px().contains(objectPos_px[0],objectPos_px[1])}setAnchor(anchor="center",log3=!1){if(this._setAttribute("anchor",anchor,log3),this._pixi!==void 0){let anchorNum=this._anchorTextToNum(this._anchor);this._pixi.anchor!==void 0?(this._pixi.anchor.x=anchorNum[0],this._pixi.anchor.y=anchorNum[1]):(this._pixi.pivot.x=anchorNum[0]*this._pixi.scale.x*this._pixi.width,this._pixi.pivot.y=anchorNum[1]*this._pixi.scale.y*this._pixi.height)}}_anchorTextToNum(anchorText=""){let anchor=[.5,.5];return anchorText.indexOf("left")>-1?anchor[0]=0:anchorText.indexOf("right")>-1&&(anchor[0]=1),anchorText.indexOf("top")>-1?anchor[1]=0:anchorText.indexOf("bottom")>-1&&(anchor[1]=1),anchor}_estimateBoundingBox(){throw{origin:"VisualStim._estimateBoundingBox",context:`when estimating the bounding box of visual stimulus: ${this._name}`,error:"this method is abstract and should not be called."}}_getBoundingBox_px(){if(this._units==="pix")return this._boundingBox.clone();if(this._units==="norm")return new Rectangle(this._boundingBox.x*this._win.size[0]/2,this._boundingBox.y*this._win.size[1]/2,this._boundingBox.width*this._win.size[0]/2,this._boundingBox.height*this._win.size[1]/2);if(this._units==="height"){let minSize=Math.min(this._win.size[0],this._win.size[1]);return new Rectangle(this._boundingBox.x*minSize,this._boundingBox.y*minSize,this._boundingBox.width*minSize,this._boundingBox.height*minSize)}else throw Object.assign(response,{error:`unknown units: ${this._units}`})}_onChange(withPixi=!1,withBoundingBox=!1){return()=>{this._needUpdate=!0,withPixi&&(this._needPixiUpdate=!0),withBoundingBox&&this._estimateBoundingBox()}}};var TextBox=class extends mix(VisualStim).with(ColorMixin){constructor({name,win,pos,anchor,size,units,ori,opacity,depth,text,placeholder,font,letterHeight,bold,italic,alignment,color,contrast,flipHoriz,flipVert,fillColor,languageStyle,borderColor,borderWidth,padding,editable,multiline,autofocus,clipMask,autoDraw,autoLog,fitToContent,boxFn}={}){super({name,win,pos,anchor,size,units,ori,opacity,depth,clipMask,autoDraw,autoLog});this._addAttribute("text",text,""),this._addAttribute("placeholder",placeholder,"",this._onChange(!0,!0)),this._addAttribute("flipHoriz",flipHoriz,!1,this._onChange(!1,!1)),this._addAttribute("flipVert",flipVert,!1,this._onChange(!1,!1)),this._addAttribute("font",font,"Arial"),this._addAttribute("letterHeight",letterHeight,this._getDefaultLetterHeight()),this._addAttribute("bold",bold,!1,this._onChange(!0,!0)),this._addAttribute("italic",italic,!1,this._onChange(!0,!0)),this._addAttribute("alignment",alignment,"center"),this._addAttribute("languageStyle",languageStyle,"LTR"),this._addAttribute("color",color,void 0),this._addAttribute("fillColor",fillColor,void 0),this._addAttribute("borderColor",borderColor,void 0),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1)),this._addAttribute("borderWidth",borderWidth,to_unit([1,0],"pix",win,this._units)[0],this._onChange(!0,!0)),this._addAttribute("padding",padding,this._letterHeight/2,this._onChange(!0,!0)),this._addAttribute("multiline",multiline,!1,this._onChange(!0,!0)),this._addAttribute("editable",editable,!1,this._onChange(!0,!0)),this._addAttribute("autofocus",autofocus,!0,this._onChange(!0,!1)),this._addAttribute("fitToContent",fitToContent,!1),this.setSize(size),this._addAttribute("boxFn",boxFn,null),this._estimateBoundingBox(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${toString(this)}`)}reset(){this.setText(this.placeholder)}clear(){this.setText()}setAlignment(alignment="center",log3=!1){if(this._setAttribute("alignment",alignment,log3),this._pixi!==void 0){let alignmentStyles=TextBox._alignmentToFlexboxMap.get(alignment);alignmentStyles||(alignmentStyles=["center","center"]),this._pixi.setInputStyle("justifyContent",alignmentStyles[0]),this._pixi.setInputStyle("textAlign",alignmentStyles[1])}}setLanguageStyle(languageStyle="LTR",log3=!1){this._setAttribute("languageStyle",languageStyle,log3);let langDir=TEXT_DIRECTION[languageStyle];langDir===void 0&&(langDir=TEXT_DIRECTION.LTR),this._pixi!==void 0&&this._pixi.setInputStyle("direction",langDir)}setText(text=""){typeof this._pixi!="undefined"&&(this._pixi.text=text),this._text=text}setFont(font="Arial",log3=!1){this._setAttribute("font",font,log3),this._pixi!==void 0&&this._pixi.setInputStyle("fontFamily",font)}setLetterHeight(fontSize=this._getDefaultLetterHeight(),log3=!1){this._setAttribute("letterHeight",fontSize,log3);let fontSize_px=this._getLengthPix(fontSize);this._pixi!==void 0&&this._pixi.setInputStyle("fontSize",`${fontSize_px}px`)}getText(){return typeof this._pixi!="undefined"?this._pixi.text:this._text}setColor(color,log3=!1){this._setAttribute("color",color,log3),this._needUpdate=!0,this._needPixiUpdate=!0}setFillColor(fillColor,log3=!1){this._setAttribute("fillColor",fillColor,log3),this._needUpdate=!0,this._needPixiUpdate=!0}setBorderColor(borderColor,log3=!1){this._setAttribute("borderColor",borderColor,log3),this._needUpdate=!0,this._needPixiUpdate=!0}setFitToContent(fitToContent,log3=!1){this._setAttribute("fitToContent",fitToContent,log3);let width_px=Math.abs(Math.round(this._getLengthPix(this._size[0]))),height_px=Math.abs(Math.round(this._getLengthPix(this._size[1])));this._pixi!==void 0&&(this._pixi.setInputStyle("width",fitToContent?"auto":`${width_px}px`),this._pixi.setInputStyle("height",fitToContent?"auto":`${height_px}px`))}setSize(size,log3){let isSizeUndefined=typeof size=="undefined"||size===null||Array.isArray(size)&&size.every(v=>typeof v=="undefined"||v===null);if(this.fitToContent=isSizeUndefined,isSizeUndefined&&(size=TextBox._defaultSizeMap.get(this._units),typeof size=="undefined"))throw{origin:"TextBox.setSize",context:"when setting the size of TextBox: "+this._name,error:"no default size for unit: "+this._units};this._setAttribute("size",size,log3)&&(this._needUpdate=!0,this._needPixiUpdate=!0,this._estimateBoundingBox())}_addEventListeners(){this._pixi.on("input",textContent=>{if(this._text=textContent,this._fitToContent){let size=to_unit([this._pixi.width,this._pixi.height],"pix",this._win,this._units);this._setAttribute("size",size,!1)}})}_getDefaultLetterHeight(){let height=TextBox._defaultLetterHeightMap.get(this._units);if(typeof height=="undefined")throw{origin:"TextBox._getDefaultLetterHeight",context:"when getting the default height of TextBox: "+this._name,error:"no default letter height for unit: "+this._units};return height}_getTextInputOptions(){let letterHeight_px=Math.round(this._getLengthPix(this._letterHeight)),padding_px=Math.round(this._getLengthPix(this._padding)),borderWidth_px=Math.round(this._getLengthPix(this._borderWidth)),width_px=Math.abs(Math.round(this._getLengthPix(this._size[0]))),height_px=Math.abs(Math.round(this._getLengthPix(this._size[1]))),alignmentStyles=TextBox._alignmentToFlexboxMap.get(this._alignment);alignmentStyles||(alignmentStyles=["center","center"]);let box;return this._boxFn!==null?box=this._boxFn:box={fill:new Color(this._fillColor).int,alpha:this._fillColor===void 0||this._fillColor===null?0:1,rounded:5,stroke:{color:new Color(this._borderColor).int,width:borderWidth_px,alpha:this._borderColor===void 0||this._borderColor===null?0:1}},{input:{display:"flex",flexDirection:"column",fontFamily:this._font,fontSize:`${letterHeight_px}px`,color:this._color===void 0||this._color===null?"transparent":new Color(this._color).hex,fontWeight:this._bold?"bold":"normal",fontStyle:this._italic?"italic":"normal",direction:TEXT_DIRECTION[this._languageStyle],justifyContent:alignmentStyles[0],textAlign:alignmentStyles[1],padding:`${padding_px}px`,multiline:this._multiline,text:this._text,height:this._fitToContent?"auto":this._multiline?`${height_px}px`:void 0,width:this._fitToContent?"auto":`${width_px}px`,maxWidth:`${this.win.size[0]}px`,maxHeight:`${this.win.size[1]}px`,overflow:"hidden",pointerEvents:"none"},box}}_estimateBoundingBox(){let boxHeight=this._letterHeight+2*this._padding+2*this._borderWidth,anchor=this._anchorTextToNum(this._anchor);this._boundingBox=new Rectangle(this._pos[0]-anchor[0]*this._size[0],this._pos[1]-anchor[1]*boxHeight,this._size[0],boxHeight)}_updateIfNeeded(){if(!!this._needUpdate){if(this._needUpdate=!1,this._needPixiUpdate){this._needPixiUpdate=!1;let enteredText="";this._pixi!==void 0&&this._pixi.parent!==null?enteredText=this._pixi.text:enteredText=this._text,typeof this._pixi!="undefined"&&this._pixi.destroy(!0),this._pixi=new TextInput(this._getTextInputOptions()),this instanceof ButtonStim||(this._pixi._addListeners(),this._addEventListeners());let{_drawList=[]}=this.psychoJS.window,otherTextBoxWithFocus=_drawList.some(item=>item instanceof TextBox&&item._pixi&&item._pixi._hasFocus());this._autofocus&&!otherTextBoxWithFocus&&this._pixi._onSurrogateFocus(),this._multiline&&(this._pixi._multiline=this._multiline),this._editable?(this.text=enteredText,this._pixi.placeholder=this._placeholder):this._pixi.text=this._text}this._pixi.disabled=!this._editable,this.anchor=this._anchor,this._pixi.scale.x=this._flipHoriz?-1:1,this._pixi.scale.y=this._flipVert?1:-1,this._pixi.rotation=-this._ori*Math.PI/180,[this._pixi.x,this._pixi.y]=to_px(this._pos,this._units,this._win),this._pixi.alpha=this._opacity,this._pixi.zIndex=-this._depth,this._pixi.mask=this._clipMask}}};TextBox._alignmentToFlexboxMap=new Map([["center",["center","center"]],["top-center",["flex-start","center"]],["bottom-center",["flex-end","center"]],["center-left",["center","left"]],["center-right",["center","right"]],["top-left",["flex-start","left"]],["top-right",["flex-start","right"]],["bottom-left",["flex-end","left"]],["bottom-right",["flex-end","right"]]]);TextBox._defaultLetterHeightMap=new Map([["cm",1],["deg",1],["degs",1],["degFlatPos",1],["degFlat",1],["norm",.1],["height",.2],["pix",20],["pixels",20]]);TextBox._defaultSizeMap=new Map([["cm",[15,-1]],["deg",[15,-1]],["degs",[15,-1]],["degFlatPos",[15,-1]],["degFlat",[15,-1]],["norm",[1,-1]],["height",[1,-1]],["pix",[500,-1]],["pixels",[500,-1]]]);var ButtonStim=class extends TextBox{constructor({win,name,text,font,pos,size,padding,anchor="center",units,color,fillColor="darkgrey",borderColor,borderWidth=0,opacity,depth,letterHeight,bold=!0,italic,autoDraw,autoLog,boxFn,multiline}={}){super({win,name,text,font,pos,size,padding,anchor,units,color,fillColor,borderColor,borderWidth,opacity,depth,letterHeight,multiline,bold,italic,alignment:"center",autoDraw,autoLog,boxFn});this.psychoJS.logger.debug("create a new Button with name: ",name),this.listener=new Mouse({name,win,autoLog}),this._addAttribute("wasClicked",!1),this._addAttribute("timesOn",[]),this._addAttribute("timesOff",[]),this._addAttribute("numClicks",0),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${toString(this)}`)}get numClicks(){return this.timesOn.length}get isClicked(){return this.listener.isPressedIn(this,[1,0,0])}};var Slider=class extends mix(VisualStim).with(ColorMixin,WindowMixin){constructor({name,win,pos,size,ori,units,color,markerColor,lineColor,contrast,opacity,depth,style,ticks,labels,startValue,granularity,flip,readOnly:readOnly2,font,bold,italic,fontSize,compact,clipMask,autoDraw,autoLog,dependentStims}={}){super({name,win,units,ori,opacity,depth,pos,size,clipMask,autoDraw,autoLog});this._needMarkerUpdate=!1,this._skin={},Object.assign(this._skin,Slider.Skin);let onChange=(withPixi=!1,withBoundingBox=!1,withSanitize=!1)=>{let visualOnChange=this._onChange(withPixi,withBoundingBox);return()=>{withSanitize&&this._sanitizeAttributes(),visualOnChange()}};this._addAttribute("style",style,[Slider.Style.RATING],onChange(!0,!0,!0)),this._addAttribute("ticks",ticks,[1,2,3,4,5],onChange(!0,!0,!0)),this._addAttribute("labels",labels,[],onChange(!0,!0,!0)),this._addAttribute("startValue",startValue,void 0),this._addAttribute("granularity",granularity,0,this._onChange(!1,!1)),this._addAttribute("readOnly",readOnly2,!1),this._addAttribute("compact",compact,!1,this._onChange(!0,!0)),this._addAttribute("font",font,"Arial",this._onChange(!0,!0)),this._addAttribute("fontSize",fontSize,this._units==="pix"?14:.03,this._onChange(!0,!0)),this._addAttribute("bold",bold,!0,this._onChange(!0,!0)),this._addAttribute("italic",italic,!1,this._onChange(!0,!0)),this._addAttribute("flip",flip,!1,this._onChange(!0,!0)),this._addAttribute("color",color,"lightgray",this._onChange(!0,!1)),this._addAttribute("lineColor",lineColor,"lightgray",this._onChange(!0,!1)),this._addAttribute("markerColor",markerColor,"red",this._onChange(!0,!1)),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1)),this._addAttribute("dependentStims",dependentStims,[],this._onChange(!1,!1)),this._addAttribute("rating",void 0),this._addAttribute("markerPos",void 0),this._addAttribute("history",[]),this._addAttribute("lineAspectRatio",.01),this._sanitizeAttributes(),this._estimateBoundingBox(),this._responseClock=new Clock,this._pixiLabels=[],this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`),this._handlePointerDownBinded=this._handlePointerDown.bind(this),this._handlePointerUpBinded=this._handlePointerUp.bind(this),this._handlePointerMoveBinded=this._handlePointerMove.bind(this)}refresh(){super.refresh(),this._needMarkerUpdate=!0}reset(){this.psychoJS.logger.debug("reset Slider: ",this._name),this._markerPos=void 0,this._history=[],this._rating=void 0,this._responseClock.reset(),this.status=PsychoJS.Status.NOT_STARTED,this._needPixiUpdate=!0,this._needUpdate=!0,typeof this._marker!="undefined"&&(this._marker.alpha=0)}isMarkerDragging(){return this._markerDragging}getRating(){let historyLength=this._history.length;if(historyLength>0)return this._history[historyLength-1].rating}getRT(){let historyLength=this._history.length;if(historyLength>0)return this._history[historyLength-1].responseTime}setReadOnly(readOnly2=!0,log3=!1){this._setAttribute("readOnly",readOnly2,log3)&&(readOnly2?this._opacity/=2:this._opacity*=2,this._needUpdate=!0)}setMarkerPos(displayedRating,log3=!1){let previousMarkerPos=this._markerPos;this._markerPos=this._granularise(displayedRating),previousMarkerPos!==this._markerPos&&(this._needMarkerUpdate=!0,this._needUpdate=!0)}setRating(rating,log3=!1){rating=this._granularise(rating),this._markerPos=rating,this._isCategorical&&(rating=this._labels[Math.round(rating)]),this._setAttribute("rating",rating,log3)}setOri(ori=0,log3=!1){if(this._setAttribute("ori",ori,log3)){this._pixi.rotation=-this._ori*Math.PI/180;let i;for(i=0;i<this._pixiLabels.length;++i)this._pixiLabels[i].rotation=-(this._ori+this._labelOri)*Math.PI/180}}setAnchor(anchor="center",log3=!1){if(this._setAttribute("anchor",anchor,log3),this._pixi!==void 0){let anchorNum=this._anchorTextToNum(this._anchor);this._pixi.pivot.x=(anchorNum[0]-.5)*this._pixi.scale.x*this._pixi.width,this._pixi.pivot.y=(anchorNum[1]-.5)*this._pixi.scale.y*this._pixi.height}}set borderColor(color){this.lineColor=color}setBorderColor(color){this.setLineColor(color)}get borderColor(){return this.lineColor}getBorderColor(){return this.getLineColor()}set fillColor(color){this.markerColor=color}setFillColor(color){this.setMarkerColor(color)}get fillColor(){return this.markerColor}getFillColor(){return this.getMarkerColor()}_estimateBoundingBox(){this._setupStyle(),this._tickSize_px=to_px(this._tickSize,this._units,this._win),this._fontSize_px=this._getLengthPix(this._fontSize),this._barSize_px=to_px(this._barSize,this._units,this._win,!0).map(v=>Math.max(1,v)),this._markerSize_px=to_px(this._markerSize,this._units,this._win,!0);let pos_px=to_px(this._pos,this._units,this._win),size_px=to_px(this._size,this._units,this._win),tickPositions=this._ratingToPos(this._ticks);this._tickPositions_px=tickPositions.map(p=>to_px(p,this._units,this._win));let limits_px=[0,0,size_px[0],size_px[1]];this._labelPositions_px=new Array(this._labels.length);let labelTextStyle=this._getTextStyle(),prevLabelBounds=null,prevNonOverlapOffset=0,tolerance=10;for(let l=0;l<this._labels.length;++l){let tickPositionIndex=Math.round(l/(this._labels.length-1)*(this._ticks.length-1));this._labelPositions_px[l]=this._tickPositions_px[tickPositionIndex];let labelBounds=TextMetrics.measureText(this._labels[l].toString(),labelTextStyle);this._isHorizontal()?(this._flip?this._labelPositions_px[l][1]-=labelBounds.height+this._tickSize_px[1]:this._labelPositions_px[l][1]+=this._tickSize_px[1],this._style.indexOf(Slider.Style.LABELS_45)===-1&&(this._labelPositions_px[l][0]-=labelBounds.width/2,this._compact&&(this._labelPositions_px[l][0]=Math.min(size_px[0]/2-labelBounds.width,Math.max(-size_px[0]/2,this._labelPositions_px[l][0]))),prevLabelBounds&&this._labelPositions_px[l-1][0]+prevLabelBounds.width+tolerance>=this._labelPositions_px[l][0]&&(prevNonOverlapOffset===0?(prevNonOverlapOffset=prevLabelBounds.height,this._labelPositions_px[l][1]+=prevNonOverlapOffset):prevNonOverlapOffset=0),prevLabelBounds=labelBounds)):(this._labelPositions_px[l][1]-=labelBounds.height/2,this._compact&&(this._labelPositions_px[l][1]=Math.min(size_px[1]/2-labelBounds.width,Math.max(-size_px[1]/2,this._labelPositions_px[l][1]))),this._flip?this._labelPositions_px[l][0]+=this._tickSize_px[0]*2:this._labelOri===0?this._labelPositions_px[l][0]-=labelBounds.width+this._tickSize_px[0]*2:this._labelPositions_px[l][0]-=this._tickSize_px[0]),limits_px[0]=Math.min(limits_px[0],this._labelPositions_px[l][0]),limits_px[1]=Math.min(limits_px[1],this._labelPositions_px[l][1]),limits_px[2]=Math.max(limits_px[2],this._labelPositions_px[l][0]+labelBounds.width),limits_px[3]=Math.max(limits_px[3],this._labelPositions_px[l][1]+labelBounds.height)}this._isHorizontal()&&(limits_px[1]-=this._tickSize_px[1]*2);let position_px=this._getPosition_px();this._boundingBox=new Rectangle(this._getLengthUnits(position_px.x+limits_px[0]),this._getLengthUnits(position_px.y+limits_px[1]),this._getLengthUnits(limits_px[2]-limits_px[0]),this._getLengthUnits(limits_px[3]-limits_px[1]))}_sanitizeAttributes(){if(this._isSliderStyle=!1,this._frozenMarker=!1,this._style.forEach((style,index3)=>{typeof style=="string"&&(this._style[index3]=Symbol.for(style.toUpperCase()))}),this._style.indexOf(Slider.Style.SLIDER)>-1){if(this._isSliderStyle=!0,this._ticks.length>2&&(this.psychoJS.logger.warn(`Slider "${this._name}" has style: SLIDER and more than two ticks. We cut the ticks to 2.`),this._ticks=this._ticks.slice(0,2)),this._ticks.length<2)throw{origin:"Slider._sanitizeAttributes",context:"when sanitizing the attributes of Slider: "+this._name,error:"less than 2 ticks were given for a slider of type: SLIDER"};this._ticks[0]!==0&&(this.psychoJS.logger.warn(`Slider "${this._name}" has style: SLIDER but the first tick is not 0. We changed it to 0.`),this._ticks[0]=0),this._ticks[1]<1&&(this.psychoJS.logger.warn(`Slider "${this._name}" has style: SLIDER but the second tick is less than 1. We changed it to 1.`),this._ticks[1]=1),this._ticks[1]===1&&(this._frozenMarker=!0)}this._isCategorical=this._ticks.length===0,this._isCategorical&&(this._ticks=[...Array(this._labels.length)].map((_,i)=>i),this._granularity=1)}recordRating(rating,responseTime=void 0,log3=!1){typeof responseTime=="undefined"&&(responseTime=this._responseClock.getTime()),this.setRating(rating,log3),this._history.push({rating:this._rating,responseTime}),this.psychoJS.logger.debug("record a new rating: ",this._rating,"with response time: ",responseTime,"for Slider: ",this._name),this._needMarkerUpdate=!0,this._needUpdate=!0}release(log3=!1){this._removeEventListeners(),super.release(log3)}_updateIfNeeded(){if(!!this._needUpdate){this._needUpdate=!1,this._estimateBoundingBox(),this._setupSlider(),this._updateMarker(),this._pixi.scale.x=1,this._pixi.scale.y=-1,this._pixi.rotation=-this._ori*Math.PI/180,this._pixi.position=this._getPosition_px(),this._pixi.alpha=this._opacity,this._pixi.zIndex=-this._depth,this.anchor=this._anchor;for(let dependentStim of this._dependentStims)dependentStim.draw()}}_getPosition_px(){let position=to_pixiPoint(this.pos,this.units,this.win,!0);return this._compact&&(this._style.indexOf(Slider.Style.RADIO)>-1||this._style.indexOf(Slider.Style.RATING)>-1)&&(this._isHorizontal()?position.y-=this._getLengthPix(this._tickSize[1])*(this._flip?-1:1):position.x+=this._getLengthPix(this._tickSize[0])*(this._flip?-1:1)),position}_updateMarker(){if(!!this._needMarkerUpdate&&(this._needMarkerUpdate=!1,typeof this._marker!="undefined"))if(typeof this._markerPos!="undefined"){let visibleMarkerPos=this._ratingToPos([this._markerPos]);this._marker.position=to_pixiPoint(visibleMarkerPos[0],this.units,this.win,!0),this._marker.alpha=1}else this._marker.alpha=0}_handlePointerDown(e){if(!(e.data.pointerType==="mouse"&&e.data.button!==0)){if(this._markerDragging=!0,!this._frozenMarker){let mouseLocalPos_px=e.data.getLocalPosition(this._pixi),rating=this._posToRating([mouseLocalPos_px.x,mouseLocalPos_px.y]);this.setMarkerPos(rating)}e.stopPropagation()}}_handlePointerMove(e){if(this._markerDragging){if(!this._frozenMarker){let mouseLocalPos_px=e.data.getLocalPosition(this._pixi),rating=this._posToRating([mouseLocalPos_px.x,mouseLocalPos_px.y]);this.setMarkerPos(rating)}e.stopPropagation()}}_handlePointerUp(e){if(this._markerDragging){if(this._markerDragging=!1,!this._frozenMarker){let mouseLocalPos_px=e.data.getLocalPosition(this._pixi),rating=this._posToRating([mouseLocalPos_px.x,mouseLocalPos_px.y]);this.recordRating(rating)}e.stopPropagation()}}_addEventListeners(){this._pixi.on("pointerdown",this._handlePointerDownBinded),this._win._rootContainer.on("pointermove",this._handlePointerMoveBinded),this._win._rootContainer.on("pointerup",this._handlePointerUpBinded)}_removeEventListeners(){this._pixi&&this._pixi.off("pointerdown",this._handlePointerDownBinded),this._win._rootContainer.off("pointermove",this._handlePointerMoveBinded),this._win._rootContainer.off("pointerup",this._handlePointerUpBinded)}_setupSlider(){if(!this._needPixiUpdate)return;this._needPixiUpdate=!1,this._setupStyle(),this._tickSize_px=to_px(this._tickSize,this._units,this._win),this._fontSize_px=this._getLengthPix(this._fontSize),this._barSize_px=to_px(this._barSize,this._units,this._win,!0).map(v=>Math.max(1,v)),this._markerSize_px=to_px(this._markerSize,this._units,this._win,!0);let tickPositions=this._ratingToPos(this._ticks);if(this._tickPositions_px=tickPositions.map(p=>to_px(p,this._units,this._win)),typeof this._pixi!="undefined"&&(this._removeEventListeners(),this._pixi.destroy(!0)),this._pixi=new Container,this._pixi.interactive=!0,this._pixi.mask=this._clipMask,this._body=new Graphics,this._body.interactive=!0,this._pixi.addChild(this._body),this._tickType===Slider.Shape.DISC){let maxTickSize_px=Math.max(this._tickSize_px[0],this._tickSize_px[1]);this._body.hitArea=new Rectangle(-(this._barSize_px[0]+maxTickSize_px)*.5,-(this._barSize_px[1]+maxTickSize_px)*.5,this._barSize_px[0]+maxTickSize_px,this._barSize_px[1]+maxTickSize_px)}else this._body.hitArea=new Rectangle(-this._barSize_px[0]/2-this._tickSize_px[0]/2,-this._barSize_px[1]/2-this._tickSize_px[1]/2,this._barSize_px[0]+this._tickSize_px[0],this._barSize_px[1]+this._tickSize_px[1]);this._setupBar(),this._setupTicks(),this._setupLabels(),this._setupMarker(),this._addEventListeners()}_setupBar(){this._barLineWidth_px>0&&(this._body.lineStyle(this._barLineWidth_px,this._barLineColor.int,1,.5),typeof this._barFillColor!="undefined"&&this._body.beginFill(this._barFillColor.int,1),this._body.drawRect(Math.round(-this._barSize_px[0]/2),Math.round(-this._barSize_px[1]/2),Math.round(this._barSize_px[0]),Math.round(this._barSize_px[1])),typeof this._barFillColor!="undefined"&&this._body.endFill())}_setupMarker(){this._marker=new Graphics;let markerVal;if(Number.isFinite(this._rating)?markerVal=this._rating:Number.isFinite(this._startValue)&&(markerVal=this._startValue),Number.isFinite(markerVal)){this._markerPos=this._granularise(markerVal);let visibleMarkerPos=this._ratingToPos([this._markerPos]);this._marker.position=to_pixiPoint(visibleMarkerPos[0],this.units,this.win,!0)}else this._marker.alpha=0;this._marker.interactive=!0,this._pixi.addChild(this._marker);let halfMarkerSize_px=Math.round(Math.max(...this._markerSize_px)/2);this._markerType===Slider.Shape.DISC?(this._marker.lineStyle(1,this._markerColor.int,1,.5),this._marker.beginFill(this._markerColor.int,1),this._marker.drawCircle(0,0,halfMarkerSize_px),this._marker.endFill()):this._markerType===Slider.Shape.TRIANGLE?(this._marker.lineStyle(1,this._markerColor.int,1,.5),this._marker.beginFill(this._markerColor.int,1),this._marker.moveTo(0,0),this._isHorizontal()?this._flip?(this._marker.lineTo(halfMarkerSize_px,halfMarkerSize_px),this._marker.lineTo(-halfMarkerSize_px,halfMarkerSize_px)):(this._marker.lineTo(halfMarkerSize_px,-halfMarkerSize_px),this._marker.lineTo(-halfMarkerSize_px,-halfMarkerSize_px)):this._flip?(this._marker.lineTo(-halfMarkerSize_px,halfMarkerSize_px),this._marker.lineTo(-halfMarkerSize_px,-halfMarkerSize_px)):(this._marker.lineTo(halfMarkerSize_px,halfMarkerSize_px),this._marker.lineTo(halfMarkerSize_px,-halfMarkerSize_px)),this._marker.endFill()):this._markerType===Slider.Shape.BOX&&(this._marker.lineStyle(1,this.getContrastedColor(this._markerColor,.5).int,1,0),this._marker.beginFill(this._markerColor.int,1),this._marker.drawRect(Math.round(-this._markerSize_px[0]/2),Math.round(-this._markerSize_px[1]/2),this._markerSize_px[0],this._markerSize_px[1]),this._marker.endFill());let self2=this;self2._markerDragging=!1,this._isSliderStyle&&(self2._pointerIsOver=!1,this._pixi.pointerover=this._pixi.mouseover=event=>{self2._pointerIsOver=!0,event.stopPropagation()},this._pixi.pointerout=this._pixi.mouseout=event=>{self2._pointerIsOver=!1,event.stopPropagation()})}_setupTicks(){if(this._style.indexOf(Slider.Style.SLIDER)>-1)return;let maxTickSize=Math.max(this._tickSize_px[0],this._tickSize_px[1]);this._body.lineStyle(this._barLineWidth_px*2,this._tickColor.int,1,.5);for(let tickPosition_px of this._tickPositions_px)this._tickType===Slider.Shape.LINE?(this._body.moveTo(tickPosition_px[0]-this._tickSize_px[0]/2,tickPosition_px[1]-this._tickSize_px[1]/2),this._body.lineTo(tickPosition_px[0]+this._tickSize_px[0]/2,tickPosition_px[1]+this._tickSize_px[1]/2)):this._tickType===Slider.Shape.DISC&&(this._body.beginFill(this._tickColor.int,1),this._body.drawCircle(tickPosition_px[0],tickPosition_px[1],maxTickSize*.5),this._body.endFill())}_getTextStyle(){return this._fontSize_px=this._getLengthPix(this._fontSize),new TextStyle({fontFamily:this._font,fontSize:Math.round(this._fontSize_px),fontWeight:this._bold?"bold":"normal",fontStyle:this._italic?"italic":"normal",fill:this.getContrastedColor(this._labelColor,this._contrast).hex,align:"center"})}_setupLabels(){let labelTextStyle=this._getTextStyle();this._pixiLabels=new Array(this._labels.length);for(let l=0;l<this._labels.length;++l)this._pixiLabels[l]=new Text(this._labels[l],labelTextStyle),this._pixiLabels[l].position.x=this._labelPositions_px[l][0],this._pixiLabels[l].position.y=this._labelPositions_px[l][1],this._pixiLabels[l].rotation=-(this._ori+this._labelOri)*Math.PI/180,this._pixiLabels[l].anchor=this._labelAnchor,this._pixiLabels[l].alpha=1,this._pixi.addChild(this._pixiLabels[l])}_setupStyle(){let skin=this._style.indexOf(Slider.Style.WHITE_ON_BLACK)>-1?this._skin.WHITE_ON_BLACK:this._skin.STANDARD;this._isHorizontal()?(this._barSize=[this._size[0],0],this._tickSize=[0,this._size[1]],this._labelAnchor=new Point(0,0)):(this._barSize=[0,this._size[1]],this._tickSize=[this._size[0],0],this._labelAnchor=new Point(0,0)),this._barLineWidth_px=1,this._barLineColor=skin.BAR_LINE_COLOR?skin.BAR_LINE_COLOR:new Color(this._lineColor),this._barFillColor=void 0,this._tickType=Slider.Shape.LINE,this._tickColor=skin.TICK_COLOR?skin.TICK_COLOR:new Color(this._lineColor),this.markerColor===void 0&&(this.markerColor=skin.MARKER_COLOR),this.markerColor=new Color(this.markerColor),this._markerType=Slider.Shape.DISC,this._markerSize=this._skin.MARKER_SIZE?this._skin.MARKER_SIZE:this._tickSize,this._labelColor=skin.LABEL_COLOR?skin.LABEL_COLOR:new Color(this._color),this._labelOri=0,this._style.indexOf(Slider.Style.RATING)>-1,this._style.indexOf(Slider.Style.TRIANGLE_MARKER)>-1&&(this._markerType=Slider.Shape.TRIANGLE,this._skin.MARKER_SIZE||(this._markerSize=this._markerSize.map(s=>s*2))),this._style.indexOf(Slider.Style.SLIDER)>-1&&(this._markerType=Slider.Shape.BOX,this._skin.MARKER_SIZE||(this._markerSize=this._isHorizontal()?[this._size[0]/(this._ticks[this._ticks.length-1]-this._ticks[0]),this._size[1]]:[this._size[0],this._size[1]/(this._ticks[this._ticks.length-1]-this._ticks[0])]),this._barSize=[this._size[0],this._size[1]],this._barFillColor=this.getContrastedColor(new Color(this.color),.5)),this._style.indexOf(Slider.Style.LABELS_45)>-1&&(this._labelOri=-45,this._flip?this._labelAnchor=new Point(0,.5):this._labelAnchor=new Point(1,0)),this._style.indexOf(Slider.Style.RADIO)>-1&&(this._barLineWidth_px=0,this._tickType=Slider.Shape.DISC,this.granularity=1,this._skin.MARKER_SIZE||(this._markerSize=this._markerSize.map(s=>s*.7)))}_ratingToPos(ratings){let range3=this._ticks[this._ticks.length-1]-this._ticks[0];return this._isHorizontal()?this._compact&&this._style.indexOf(Slider.Style.RADIO)>-1?ratings.map(v=>[(v-this._ticks[0])/range3*(this._size[0]-this._tickSize[1]*2)-this._size[0]/2+this._tickSize[1],0]):this._style.indexOf(Slider.Style.SLIDER)>-1?ratings.map(v=>[((v-this._ticks[0])/range3-.5)*(this._size[0]-this._markerSize[0]),0]):ratings.map(v=>[((v-this._ticks[0])/range3-.5)*this._size[0],0]):this._compact&&this._style.indexOf(Slider.Style.RADIO)>-1?ratings.map(v=>[0,(v-this._ticks[0])/range3*(this._size[1]-this._tickSize[0]*2)-this._size[1]/2+this._tickSize[0]]):this._style.indexOf(Slider.Style.SLIDER)>-1?ratings.map(v=>[0,((v-this._ticks[0])/range3-.5)*(this._size[1]-this._markerSize[1])]):ratings.map(v=>[0,(1-(v-this._ticks[0])/range3-.5)*this._size[1]])}_posToRating(pos_px){let range3=this._ticks[this._ticks.length-1]-this._ticks[0],size_px=to_px(this._size,this._units,this._win),markerSize_px=to_px(this._markerSize,this._units,this._win);if(this._isHorizontal())return this._style.indexOf(Slider.Style.SLIDER)>-1?(pos_px[0]/(size_px[0]-markerSize_px[0])+.5)*range3+this._ticks[0]:(pos_px[0]/size_px[0]+.5)*range3+this._ticks[0];if(this._style.indexOf(Slider.Style.SLIDER)>-1){if(size_px[1]!==markerSize_px[1])return(pos_px[1]/(size_px[1]-markerSize_px[1])+.5)*range3+this._ticks[0]}else return(1-(pos_px[1]/size_px[1]+.5))*range3+this._ticks[0]}_isHorizontal(){return this._size[0]>this._size[1]}_granularise(rating){if(typeof rating!="undefined")return this._granularity>0&&(rating=Math.round(rating/this._granularity)*this._granularity),rating=Math.min(Math.max(this._ticks[0],rating),this._ticks[this._ticks.length-1]),rating}};Slider.Shape={DISC:Symbol.for("DISC"),TRIANGLE:Symbol.for("TRIANGLE"),LINE:Symbol.for("LINE"),BOX:Symbol.for("BOX")};Slider.Style={RATING:Symbol.for("RATING"),TRIANGLE_MARKER:Symbol.for("TRIANGLE_MARKER"),SLIDER:Symbol.for("SLIDER"),WHITE_ON_BLACK:Symbol.for("WHITE_ON_BLACK"),LABELS_45:Symbol.for("LABELS_45"),RADIO:Symbol.for("RADIO")};Slider.Skin={MARKER_SIZE:null,STANDARD:{MARKER_COLOR:new Color("red"),BAR_LINE_COLOR:null,TICK_COLOR:null,LABEL_COLOR:null},WHITE_ON_BLACK:{MARKER_COLOR:new Color("white"),BAR_LINE_COLOR:new Color("black"),TICK_COLOR:new Color("black"),LABEL_COLOR:new Color("black")}};var TextStim=class extends mix(VisualStim).with(ColorMixin){constructor({name,win,text,font,pos,anchor,color,opacity,depth,contrast,units,ori,height,bold,italic,alignHoriz,alignVert,wrapWidth,flipHoriz,flipVert,clipMask,autoDraw,autoLog}={}){super({name,win,units,ori,opacity,depth,pos,anchor,clipMask,autoDraw,autoLog});let onChange=(withPixi=!1,withBoundingBox=!1,withMetrics=!1)=>{let visualOnChange=this._onChange(withPixi,withBoundingBox);return()=>{visualOnChange(),withMetrics&&(this._textMetrics=void 0)}};this._addAttribute("text",text,"Hello World",onChange(!0,!0,!0)),this._addAttribute("alignHoriz",alignHoriz,"center",onChange(!0,!0,!0)),this._addAttribute("alignVert",alignVert,"center",onChange(!0,!0,!0)),this._addAttribute("flipHoriz",flipHoriz,!1,onChange(!0,!0,!0)),this._addAttribute("flipVert",flipVert,!1,onChange(!0,!0,!0)),this._addAttribute("font",font,"Arial",this._onChange(!0,!0)),this._addAttribute("height",height,this._getDefaultLetterHeight(),onChange(!0,!0,!0)),this._addAttribute("wrapWidth",wrapWidth,this._getDefaultWrapWidth(),onChange(!0,!0,!0)),this._addAttribute("bold",bold,!1,onChange(!0,!0,!0)),this._addAttribute("italic",italic,!1,onChange(!0,!0,!0)),this._addAttribute("color",color,"white"),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1)),typeof alignVert=="string"&&typeof alignHoriz=="string"&&(this.anchor=`${alignVert}-${alignHoriz}`),this._estimateBoundingBox(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}getTextMetrics(){if(typeof this._textMetrics=="undefined"){this._textMetrics=TextMetrics.measureText(this._text,this._getTextStyle());let textMetricsCanvas=document.createElement("canvas");document.body.appendChild(textMetricsCanvas);let ctx=textMetricsCanvas.getContext("2d");ctx.font=this._getTextStyle().toFontString(),ctx.textBaseline="alphabetic",ctx.textAlign="left",this._textMetrics.boundingBox=ctx.measureText(this._text),document.body.removeChild(textMetricsCanvas)}return this._textMetrics}_getDefaultLetterHeight(){let height=TextStim._defaultLetterHeightMap.get(this._units);if(typeof height=="undefined")throw{origin:"TextStim._getDefaultLetterHeight",context:"when getting the default height of TextStim: "+this._name,error:"no default letter height for unit: "+this._units};return height}_getDefaultWrapWidth(){let wrapWidth=TextStim._defaultWrapWidthMap.get(this._units);if(typeof wrapWidth=="undefined")throw{origin:"TextStim._getDefaultWrapWidth",context:"when getting the default wrap width of TextStim: "+this._name,error:"no default wrap width for unit: "+this._units};return wrapWidth}getBoundingBox(tight=!1){if(tight){let textMetrics_px=this.getTextMetrics(),left_px=this._pos[0]-textMetrics_px.boundingBox.actualBoundingBoxLeft,top_px=this._pos[1]+textMetrics_px.fontProperties.descent-textMetrics_px.boundingBox.actualBoundingBoxDescent,width_px=textMetrics_px.boundingBox.actualBoundingBoxRight+textMetrics_px.boundingBox.actualBoundingBoxLeft,height_px=textMetrics_px.boundingBox.actualBoundingBoxAscent+textMetrics_px.boundingBox.actualBoundingBoxDescent,boundingBox_px=this._getBoundingBox_px();switch(this._alignHoriz){case"left":break;case"right":break;default:case"center":left_px-=(boundingBox_px.width-width_px)/2}switch(this._alignVert){case"top":break;case"bottom":break;default:case"center":top_px-=(boundingBox_px.height-height_px)/2}let leftTop=to_unit([left_px,top_px],"pix",this._win,this._units),dimensions=to_unit([width_px,height_px],"pix",this._win,this._units);return new Rectangle(leftTop[0],leftTop[1],dimensions[0],dimensions[1])}else return this._boundingBox.clone()}_estimateBoundingBox(){let textMetrics=this.getTextMetrics(),textSize=to_unit([textMetrics.width,textMetrics.height],"pix",this._win,this._units),anchor=this._anchorTextToNum(this._anchor);this._boundingBox=new Rectangle(this._pos[0]-anchor[0]*textSize[0],this._pos[1]-textSize[1]+anchor[1]*textSize[1],textSize[0],textSize[1])}_getTextStyle(){return new TextStyle({fontFamily:this._font,fontSize:Math.round(this._getLengthPix(this._height)),fontWeight:this._bold?"bold":"normal",fontStyle:this._italic?"italic":"normal",fill:this.getContrastedColor(new Color(this._color),this._contrast).hex,align:this._alignHoriz,wordWrap:typeof this._wrapWidth!="undefined",wordWrapWidth:typeof this._wrapWidth!="undefined"?this._getHorLengthPix(this._wrapWidth):0})}setColor(color,log3=!1){this._setAttribute("color",color,log3)&&typeof this._pixi!="undefined"&&(this._pixi.style=this._getTextStyle(),this._needUpdate=!0)}_updateIfNeeded(){if(!this._needUpdate)return;this._needUpdate=!1,this._needPixiUpdate&&(this._needPixiUpdate=!1,typeof this._pixi!="undefined"&&this._pixi.destroy(!0),this._pixi=new Text(this._text,this._getTextStyle()));let anchor=this._anchorTextToNum(this._anchor);[this._pixi.anchor.x,this._pixi.anchor.y]=anchor,this._pixi.scale.x=this._flipHoriz?-1:1,this._pixi.scale.y=this._flipVert?1:-1,this._pixi.rotation=-this._ori*Math.PI/180,this._pixi.position=to_pixiPoint(this.pos,this.units,this.win),this._pixi.alpha=this._opacity,this._pixi.zIndex=-this._depth,this._pixi.mask=this._clipMask,this._size=to_unit([Math.abs(this._pixi.width),Math.abs(this._pixi.height)],"pix",this._win,this._units),this._boundingBox=new Rectangle(this._pos[0]-anchor[0]*this._size[0],this._pos[1]-this._size[1]+anchor[1]*this._size[1],this._size[0],this._size[1])}_getAnchor(){let anchor=[];switch(this._alignHoriz){case"left":anchor.push(0);break;case"right":anchor.push(1);break;default:case"center":anchor.push(.5)}switch(this._alignVert){case"top":anchor.push(0);break;case"bottom":anchor.push(1);break;default:case"center":anchor.push(.5)}return anchor}};TextStim._defaultLetterHeightMap=new Map([["cm",1],["deg",1],["degs",1],["degFlatPos",1],["degFlat",1],["norm",.1],["height",.2],["pix",20],["pixels",20]]);TextStim._defaultWrapWidthMap=new Map([["cm",15],["deg",15],["degs",15],["degFlatPos",15],["degFlat",15],["norm",1],["height",1],["pix",500],["pixels",500]]);var Form=class extends mix(VisualStim).with(ColorMixin){constructor({name,win,pos,size,units,borderColor,fillColor,itemColor,markerColor,responseColor,color,contrast,opacity,depth,items,randomize,itemPadding,font,fontFamily,bold,italic,fontSize,clipMask,autoDraw,autoLog}={}){super({name,win,units,opacity,depth,pos,size,clipMask,autoDraw,autoLog});this._addAttribute("itemPadding",itemPadding,to_unit([20,0],"pix",win,this._units)[0],this._onChange(!0,!1)),this._addAttribute("color",color,void 0,this._onChange(!0,!1)),this._addAttribute("borderColor",borderColor,fillColor,this._onChange(!0,!1)),this._addAttribute("fillColor",fillColor,void 0,this._onChange(!0,!1)),this._addAttribute("itemColor",itemColor,void 0,this._onChange(!0,!1)),this._addAttribute("markerColor",markerColor,void 0,this._onChange(!0,!1)),this._addAttribute("responseColor",responseColor,void 0,this._onChange(!0,!1)),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1)),this._addAttribute("font",font,"Arial",this._onChange(!0,!0)),this._addAttribute("fontFamily",fontFamily,"Helvetica",this._onChange(!0,!0)),this._addAttribute("fontSize",fontSize,this._units==="pix"?14:.03,this._onChange(!0,!0)),this._addAttribute("bold",bold,!1,this._onChange(!0,!0)),this._addAttribute("italic",italic,!1,this._onChange(!0,!0));let onItemChange=()=>{this._processItems(),this._setupStimuli(),this._onChange(!0,!0)()};this._addAttribute("items",items,[],onItemChange),this._addAttribute("randomize",randomize,!1,onItemChange),this._scrollbarWidth=.02,this._responseTextHeightRatio=.8,this._processItems(),this._setupStimuli(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}refresh(){super.refresh();for(let i=0;i<this._items.length;++i){this._visual.textStims[i].refresh();let responseStim=this._visual.responseStims[i];responseStim&&responseStim.refresh()}}draw(){this._scrollbar.markerPos!==this._prevScrollbarMarkerPos&&(this._prevScrollbarMarkerPos=this._scrollbar.markerPos,this._needUpdate=!0),super.draw();for(let i=0;i<this._items.length;++i)if(this._visual.visibles[i]){this._visual.textStims[i].draw();let responseStim=this._visual.responseStims[i];responseStim&&responseStim.draw()}this._scrollbar.draw()}hide(){if(super.hide(),typeof this._items!="undefined"){for(let i=0;i<this._items.length;++i)if(this._visual.visibles[i]){this._visual.textStims[i].hide();let responseStim=this._visual.responseStims[i];responseStim&&responseStim.hide()}this._scrollbar.hide()}}reset(){this.psychoJS.logger.debug("reset Form: ",this._name);for(let i=0;i<this._items.length;++i){this._visual.textStims[i].reset();let responseStim=this._visual.responseStims[i];responseStim&&responseStim.reset()}this._needUpdate=!0}getData(){let nbIncompleteResponse=0;for(let i=0;i<this._items.length;++i){let item=this._items[i],responseStim=this._visual.responseStims[i];responseStim&&(item.type===Form.Types.CHOICE||item.type===Form.Types.RATING||item.type===Form.Types.SLIDER?(item.response=responseStim.getRating(),item.rt=responseStim.getRT(),typeof item.response=="undefined"&&++nbIncompleteResponse):item.type===Form.Types.FREE_TEXT&&(item.response=responseStim.text,item.rt=void 0,item.response.length===0&&++nbIncompleteResponse))}return this._items._complete=nbIncompleteResponse===0,this._items.map(item=>Object.assign({},item))}formComplete(){return this.getData(),this._items._complete}addDataToExp(experiment,format3="rows"){let addAsColumns=["cols","columns"].includes(format3.toLowerCase()),data=this.getData(),_doNotSave=["itemCtrl","responseCtrl","itemColor","options","ticks","tickLabels","responseWidth","responseColor","layout"];for(let item of this.getData()){let index3=0;for(let field in item){if(!_doNotSave.includes(field)){let columnName=addAsColumns?`${this._name}[${index3}]${field}`:`${this._name}${field}`;experiment.addData(columnName,item[field])}++index3}addAsColumns||experiment.nextEntry()}addAsColumns&&experiment.nextEntry()}_processItems(){let response2={origin:"Form._processItems",context:"when processing the form items"};try{this._autoLog&&this._psychoJS.experimentLogger.exp("Importing items..."),this._importItems(),this._sanitizeItems(),this._randomize&&shuffle(this._items)}catch(error){throw Object.assign(response2,{error})}}_importItems(){let response2={origin:"Form._importItems",context:"when importing the form items"};try{let itemsType=typeof this._items;if(itemsType==="undefined")this._items=[Form._defaultItems];else if(itemsType==="string")this._items=TrialHandler.importConditions(this._psychoJS.serverManager,this._items);else throw`unable to import items of unknown type: ${itemsType}`;Array.isArray(this._items)&&this._items.length===0&&(this._items=[Form._defaultItems])}catch(error){throw Object.assign(response2,{error})}}_sanitizeItems(){let response2={origin:"Form._sanitizeItems",context:"when sanitizing the form items"};try{for(let item of this._items)typeof item.questionText!="undefined"&&(item.itemText=item.questionText,delete item.questionText,item.itemWidth=item.questionWidth,delete item.questionWidth,(item.type==="rating"||item.type==="slider")&&(item.ticks=item.options,item.options=void 0));let defaultKeys=Object.keys(Form._defaultItems),missingKeys=new Set;for(let item of this._items){let itemKeys=Object.keys(item);for(let key of defaultKeys)itemKeys.includes(key)?typeof item[key]=="undefined"&&(item[key]=Form._defaultItems[key]):(missingKeys.add(key),item[key]=Form._defaultItems[key])}missingKeys.size>0&&this._psychoJS.logger.warn(`Missing headers: ${Array.from(missingKeys).join(", ")}
Note, headers are case sensitive and must match: ${Array.from(defaultKeys).join(", ")}`);let formTypes=Object.getOwnPropertyNames(Form.Types);for(let item of this._items){if(item.type=item.type.toUpperCase().replace(" ","_"),!formTypes.includes(item.type))throw`${item.type} is not a valid type for item: ${item.itemText}`;if(item.type==="RADIO"&&(item.type="CHOICE"),item.type=Symbol.for(item.type),item.type===Form.Types.CHOICE){if(item.options=item.options.split(","),item.options.length<2)throw`at least two choices should be provided for choice item: ${item.itemText}`}else(item.type===Form.Types.RATING||item.type===Form.Types.SLIDER)&&(item.ticks=item.ticks.split(",").map((_,t)=>parseInt(t)),item.tickLabels=item.tickLabels.length>0?item.tickLabels.split(","):[])}let formLayouts=["HORIZ","VERT"];for(let item of this._items){if(item.layout=item.layout.toUpperCase(),!formLayouts.includes(item.layout))throw`${item.layout} is not a valid layout for item: ${item.itemText}`;item.layout=item.layout==="HORIZ"?Form.Layout.HORIZONTAL:Form.Layout.VERTICAL}}catch(error){throw Object.assign(response2,{error})}}_estimateBoundingBox(){this._boundingBox=new Rectangle(this._pos[0]-this._size[0]/2,this._pos[1]-this._size[1]/2,this._size[0],this._size[1])}_setupStimuli(){if(this._autoLog&&this._psychoJS.experimentLogger.exp(`Setting layout of Form: ${this.name}`),typeof this._visual!="undefined"){for(let textStim2 of this._visual.textStims)textStim2.release();for(let responseStim of this._visual.responseStims)responseStim.release()}this._visual={rowHeights:[],textStims:[],responseStims:[],visibles:[],stimuliTotalHeight:0},this._stimuliClipMask=new Graphics;let textStimOption={win:this._win,name:"item text",font:this.font,units:this._units,alignHoriz:"left",alignVert:"top",height:this._fontSize,color:this.itemColor,ori:0,opacity:1,depth:this._depth-1,clipMask:this._stimuliClipMask},sliderOption={win:this._win,name:"choice response",units:this._units,flip:!1,fontFamily:this.fontFamily,font:this.font,bold:!1,italic:!1,fontSize:this._fontSize*this._responseTextHeightRatio,color:this.responseColor,markerColor:this.markerColor,opacity:1,depth:this._depth-1,clipMask:this._stimuliClipMask,granularity:1},textBoxOption={win:this._win,name:"free text response",units:this._units,anchor:"left-top",flip:!1,opacity:1,depth:this._depth-1,font:this.font,letterHeight:this._fontSize*this._responseTextHeightRatio,bold:!1,italic:!1,alignment:"left",color:this.responseColor,fillColor:this.fillColor,contrast:1,borderColor:this.responseColor,borderWidth:.002,padding:.01,editable:!0,clipMask:this._stimuliClipMask},textStim=new TextStim(Object.assign(textStimOption,{text:"Ag",pos:[0,0]})),textMetrics_px=textStim.getTextMetrics(),sliderTickSize=this._getLengthUnits(textMetrics_px.height)/2;textStim.release(!1);let stimulusOffset=-this._itemPadding;for(let item of this._items){this._visual.visibles.push(!1);let rowWidth;item.type===Form.Types.HEADING||item.type===Form.Types.DESCRIPTION||item.type===Form.Types.CHOICE&&item.layout===Form.Layout.VERTICAL?rowWidth=this._size[0]-this._itemPadding*2-this._scrollbarWidth:rowWidth=this._size[0]-this._itemPadding*3-this._scrollbarWidth;let itemWidth=rowWidth*item.itemWidth,textStim2=new TextStim(Object.assign(textStimOption,{text:item.itemText,wrapWidth:itemWidth}));textStim2._relativePos=[this._itemPadding,stimulusOffset];let textHeight=textStim2.boundingBox.height;this._visual.textStims.push(textStim2);let responseStim=null,responseHeight=0,compact,flip,responseWidth=rowWidth*item.responseWidth;if(item.type===Form.Types.CHOICE||item.type===Form.Types.RATING||item.type===Form.Types.SLIDER){let sliderSize;item.layout===Form.Layout.HORIZONTAL?(sliderSize=[responseWidth,sliderTickSize],compact=!0,flip=!1):(sliderSize=[sliderTickSize,sliderTickSize*1.5*item.options.length],compact=!1,flip=!0);let style,labels,ticks,granularity=1;item.type===Form.Types.CHOICE?(style=[Slider.Style.RATING,Slider.Style.RADIO],labels=item.options,ticks=[]):item.type===Form.Types.SLIDER?(style=[Slider.Style.SLIDER],labels=item.tickLabels,ticks=item.ticks,granularity=0):(style=[Slider.Style.RATING],labels=item.tickLabels,ticks=item.ticks,granularity=1),responseStim=new Slider(Object.assign({},sliderOption,{granularity,size:sliderSize,style,labels,ticks,compact,flip})),responseHeight=responseStim.boundingBox.height,item.layout===Form.Layout.HORIZONTAL?responseStim._relativePos=[this._itemPadding*2+itemWidth+responseWidth/2,stimulusOffset]:(responseStim._relativePos=[this._itemPadding*2+itemWidth,stimulusOffset-responseHeight/2-textHeight-this._itemPadding],responseHeight+=textHeight+this._itemPadding)}else item.type===Form.Types.FREE_TEXT&&(responseStim=new TextBox(Object.assign(textBoxOption,{text:item.options,size:[responseWidth,-1]})),responseHeight=responseStim.boundingBox.height,responseStim._relativePos=[this._itemPadding*2+itemWidth,stimulusOffset]);this._visual.responseStims.push(responseStim);let rowHeight=Math.max(textHeight,responseHeight);this._visual.rowHeights.push(rowHeight),stimulusOffset-=rowHeight+this._itemPadding}this._visual.stimuliTotalHeight=stimulusOffset,this._scrollbar=new Slider({win:this._win,name:"scrollbar",units:this._units,color:this.itemColor,depth:this._depth-1,pos:[0,0],size:[this._scrollbarWidth,this._size[1]],style:[Slider.Style.SLIDER],ticks:[0,-this._visual.stimuliTotalHeight/this._size[1]],dependentStims:[this]}),this._prevScrollbarMarkerPos=0,this._scrollbar.setMarkerPos(this._prevScrollbarMarkerPos),this._estimateBoundingBox(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Layout set for: ${this.name}`)}_updateIfNeeded(){!this._needUpdate||(this._needUpdate=!1,this._leftEdge=this._pos[0]-this._size[0]/2,this._rightEdge=this._pos[0]+this._size[0]/2,this._topEdge=this._pos[1]+this._size[1]/2,this._bottomEdge=this._pos[1]-this._size[1]/2,[this._leftEdge_px,this._topEdge_px]=to_px([this._leftEdge,this._topEdge],this.units,this.win,!0),[this._rightEdge_px,this._bottomEdge_px]=to_px([this._rightEdge,this._bottomEdge],this.units,this.win,!0),this._itemPadding_px=this._getLengthPix(this._itemPadding),this._scrollbarWidth_px=this._getLengthPix(this._scrollbarWidth,!0),this._size_px=to_px(this._size,this.units,this.win,!0),this._stimuliClipMask.clear(),this._stimuliClipMask.beginFill(16777215),this._stimuliClipMask.drawRect(this._win._stimsContainer.position.x+this._leftEdge_px+2,this._win._stimsContainer.position.y+this._bottomEdge_px+2,this._size_px[0]-4,this._size_px[1]-6),this._stimuliClipMask.endFill(),this._scrollbar.setPos([this._rightEdge-this._scrollbarWidth/2,this._pos[1]],!1),this._scrollbar.setOpacity(.5),this._scrollbarOffset=this._prevScrollbarMarkerPos*(this._visual.stimuliTotalHeight+this._size[1])/(-this._visual.stimuliTotalHeight/this._size[1]),this._updateVisibleStimuli(),this._updateDecorations())}_updateVisibleStimuli(){for(let i=0;i<this._items.length;++i){let textStim=this._visual.textStims[i],textStimPos=[this._leftEdge+textStim._relativePos[0],this._topEdge+textStim._relativePos[1]-this._scrollbarOffset];textStim.setPos(textStimPos);let responseStim=this._visual.responseStims[i];if(responseStim){let responseStimPos=[this._leftEdge+responseStim._relativePos[0],this._topEdge+responseStim._relativePos[1]-this._scrollbarOffset];responseStim.setPos(responseStimPos)}textStimPos[1]>this._bottomEdge&&textStimPos[1]-this._visual.rowHeights[i]<=this._topEdge?this._visual.visibles[i]=!0:(this._visual.visibles[i]&&(textStim.hide(),responseStim&&responseStim.hide()),this._visual.visibles[i]=!1)}}_updateDecorations(){typeof this._pixi!="undefined"&&this._pixi.destroy(!0),this._pixi=new Graphics,this._pixi.scale.x=1,this._pixi.scale.y=1,this._pixi.rotation=0,this._pixi.position=to_pixiPoint(this.pos,this.units,this.win),this._pixi.alpha=this._opacity,this._pixi.zIndex=-this._depth,this._pixi.mask=this._clipMask,this._pixi.lineStyle(1,new Color(this.borderColor).int,this._opacity,.5),this._pixi.beginFill(new Color(this.fillColor).int),this._pixi.drawRect(this._leftEdge_px,this._bottomEdge_px,this._size_px[0],this._size_px[1]),this._pixi.endFill(),this._decorations=new Graphics,this._pixi.addChild(this._decorations),this._decorations.mask=this._stimuliClipMask,this._decorations.lineStyle(1,new Color("gray").int,this._opacity,.5),this._decorations.alpha=.5;for(let i=0;i<this._items.length;++i)if(this._visual.visibles[i]){let item=this._items[i];if(item.type===Form.Types.HEADING||item.type===Form.Types.DESCRIPTION){let textStim=this._visual.textStims[i],textStimPos=[this._leftEdge+textStim._relativePos[0],this._topEdge+textStim._relativePos[1]-this._scrollbarOffset],textStimPos_px=to_px(textStimPos,this._units,this._win);this._decorations.beginFill(new Color("darkgray").int),this._decorations.drawRect(textStimPos_px[0]-this._itemPadding_px/2,textStimPos_px[1]+this._itemPadding_px/2,this._size_px[0]-this._itemPadding_px-this._scrollbarWidth_px,-this._getLengthPix(this._visual.rowHeights[i])-this._itemPadding_px),this._decorations.endFill()}}}};Form.Types={HEADING:Symbol.for("HEADING"),DESCRIPTION:Symbol.for("DESCRIPTION"),RATING:Symbol.for("RATING"),SLIDER:Symbol.for("SLIDER"),FREE_TEXT:Symbol.for("FREE_TEXT"),CHOICE:Symbol.for("CHOICE"),RADIO:Symbol.for("RADIO")};Form.Layout={HORIZONTAL:Symbol.for("HORIZONTAL"),VERTICAL:Symbol.for("VERTICAL")};Form._defaultItems={itemText:"Default question",type:"rating",options:"Yes, No",tickLabels:"",itemWidth:.7,itemColor:"white",responseWidth:.3,responseColor:"white",index:0,layout:"horiz"};var hardware_exports={};__export(hardware_exports,{Camera:()=>Camera});var Camera=class extends PsychObject{constructor({win,name,format:format3,clock,autoLog}={}){super(win._psychoJS);this._addAttribute("win",win,void 0),this._addAttribute("name",name,"camera"),this._addAttribute("format",format3,"video/webm;codecs=vp9",this._onChange),this._addAttribute("clock",clock,new Clock),this._addAttribute("autoLog",autoLog,!1),this._addAttribute("status",PsychoJS.Status.NOT_STARTED),this._stream=null,this._recorder=null,this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}async authorize(showDialog=!1,dialogMsg=void 0){let response2={origin:"Camera.authorize",context:"when authorizing access to the device's camera"};showDialog&&(dialogMsg!=null||(dialogMsg="Please wait a few moments while the camera initialises. You may need to grant permission to your browser to use the camera."),this.psychoJS.gui.dialog({warning:dialogMsg,showOK:!1}));try{this._stream=await navigator.mediaDevices.getUserMedia({video:!0})}catch(error){throw showDialog&&this.psychoJS.gui.closeDialog(),this._status=PsychoJS.Status.ERROR,__spreadProps(__spreadValues({},response2),{error})}showDialog&&this.psychoJS.gui.closeDialog()}get isReady(){return this._recorder!==null}getStream(){return this._stream}getVideo(){let video=document.createElement("video");return this._videos.push(video),video.width=this._streamSettings.width,video.height=this._streamSettings.height,video.autoplay=!0,video.onclick=mouseEvent=>(mouseEvent.preventDefault(),!1),video.srcObject=this._stream,video}open(){if(this._stream===null)throw{origin:"Camera.open",context:"when opening the camera's video stream",error:"access to the camera has not been authorized, or no camera could be found"};this._prepareRecording()}record(){if(this._status===PsychoJS.Status.PAUSED)return this.resume({clear:!0});if(this._status!==PsychoJS.Status.STARTED){this._psychoJS.logger.debug("request to start video recording");try{if(!this._recorder)throw"the recorder has not been created yet, possibly because the participant has not given the authorisation to record video";this._recorder.start();let self2=this;return new Promise((resolve4,reject2)=>{self2._startCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw this._psychoJS.logger.error("unable to start the video recording: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Camera.record",context:"when starting the video recording for camera: "+this._name,error}}}}stop(){if(this._status===PsychoJS.Status.STARTED||this._status===PsychoJS.Status.PAUSED){this._psychoJS.logger.debug("request to stop video recording");for(let video of this._videos)video.pause();this._recorder.stop();let self2=this;return new Promise((resolve4,reject2)=>{self2._stopCallback=resolve4,self2._errorCallback=reject2})}}pause(){if(this._status===PsychoJS.Status.STARTED){this._psychoJS.logger.debug("request to pause video recording");try{if(!this._recorder)throw"the recorder has not been created yet, possibly because the participant has not given the authorisation to record video";this._recorder.pause();let self2=this;return new Promise((resolve4,reject2)=>{self2._pauseCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw self._psychoJS.logger.error("unable to pause the video recording: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Camera.pause",context:"when pausing the video recording for camera: "+this._name,error}}}}resume({clear=!1}={}){if(this._status===PsychoJS.Status.PAUSED){this._psychoJS.logger.debug("request to resume video recording");try{if(!this._recorder)throw"the recorder has not been created yet, possibly because the participant has not given the authorisation to record video";clear&&(this._audioBuffer=[],this._videoBuffer.length=0),this._recorder.resume();let self2=this;return new Promise((resolve4,reject2)=>{self2._resumeCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw self._psychoJS.logger.error("unable to resume the video recording: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Camera.resume",context:"when resuming the video recording for camera: "+this._name,error}}}}flush(){if(this._status===PsychoJS.Status.STARTED||this._status===PsychoJS.Status.PAUSED){this._psychoJS.logger.debug("request to flush video recording"),this._recorder.requestData();let self2=this;return new Promise((resolve4,reject2)=>{self2._dataAvailableCallback=resolve4,self2._errorCallback=reject2})}}async getRecording({tag,flush=!1}={}){typeof tag=="undefined"&&(tag=this._name)}save({tag,waitForCompletion=!1,showDialog=!1,dialogMsg=""}={}){if(this._psychoJS.logger.info("[PsychoJS] Save video recording."),typeof tag=="undefined"&&(tag=this._name),tag+=extensionFromMimeType(this._format),this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER||this._psychoJS.config.experiment.status!=="RUNNING"||this._psychoJS._serverMsg.has("__pilotToken")){let videoBlob2=new Blob(this._videoBuffer),anchor=document.createElement("a");anchor.href=window.URL.createObjectURL(videoBlob2),anchor.download=tag,document.body.appendChild(anchor),anchor.click(),document.body.removeChild(anchor);return}let videoBlob=new Blob(this._videoBuffer);return this._psychoJS.serverManager.uploadAudioVideo({mediaBlob:videoBlob,tag,waitForCompletion,showDialog,dialogMsg})}async close(){await this.stop(),this._videos=[],this._stream=null,this._recorder=null}_onChange(){this._status===PsychoJS.Status.STARTED&&this.stop(),this._prepareRecording(),this.start()}_prepareRecording(){this._videoBuffer=[],this._recorder=null,this._videos=[],this._streamSettings=this._stream.getVideoTracks()[0].getSettings(),this._psychoJS.logger.debug(`camera stream settings: ${JSON.stringify(this._streamSettings)}`);let options;typeof this._format=="string"&&MediaRecorder.isTypeSupported(this._format)?options={type:this._format}:this._psychoJS.logger.warn(`The specified video format, ${this._format}, is not supported by this browser, using the default format instead`),this._recorder=new MediaRecorder(this._stream,options);let self2=this;this._recorder.onstart=()=>{self2._videoBuffer=[],self2._videoBuffer.length=0,self2._clock.reset(),self2._status=PsychoJS.Status.STARTED,self2._psychoJS.logger.debug("video recording started"),self2._startCallback&&self2._startCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onpause=()=>{self2._status=PsychoJS.Status.PAUSED,self2._psychoJS.logger.debug("video recording paused"),self2._pauseCallback&&self2._pauseCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onresume=()=>{self2._status=PsychoJS.Status.STARTED,self2._psychoJS.logger.debug("video recording resumed"),self2._resumeCallback&&self2._resumeCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.ondataavailable=event=>{let data=event.data;self2._videoBuffer.push(data),self2._psychoJS.logger.debug("video data added to the buffer"),self2._dataAvailableCallback&&self2._dataAvailableCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onstop=()=>{self2._psychoJS.logger.debug("video recording stopped"),self2._status=PsychoJS.Status.STOPPED,self2._stopCallback&&self2._stopCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onerror=event=>{self2._psychoJS.logger.error("video recording error: "+JSON.stringify(event)),self2._status=PsychoJS.Status.ERROR}}};var ImageStim=class extends mix(VisualStim).with(ColorMixin){constructor({name,win,image,mask,pos,anchor,units,ori,size,color,opacity,contrast,texRes,depth,interpolate,flipHoriz,flipVert,autoDraw,autoLog,aspectRatio,blurVal}={}){super({name,win,units,ori,opacity,depth,pos,anchor,size,autoDraw,autoLog});this._blurFilter=void 0,this._addAttribute("image",image),this._addAttribute("mask",mask),this._addAttribute("color",color,"white",this._onChange(!0,!1)),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1)),this._addAttribute("texRes",texRes,128,this._onChange(!0,!1)),this._addAttribute("interpolate",interpolate,!1),this._addAttribute("flipHoriz",flipHoriz,!1,this._onChange(!1,!1)),this._addAttribute("flipVert",flipVert,!1,this._onChange(!1,!1)),this._addAttribute("aspectRatio",aspectRatio,ImageStim.AspectRatioStrategy.VARIABLE,this._onChange(!0,!0)),this._addAttribute("blurVal",blurVal,0),this._estimateBoundingBox(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}setImage(image,log3=!1){let response2={origin:"ImageStim.setImage",context:"when setting the image of ImageStim: "+this._name};try{if(typeof image=="undefined")this.psychoJS.logger.warn("setting the image of ImageStim: "+this._name+" with argument: undefined."),this.psychoJS.logger.debug("set the image of ImageStim: "+this._name+" as: undefined");else if(typeof image=="string"&&(image=this.psychoJS.serverManager.getResource(image)),image instanceof Camera&&(image=image.getVideo()),image instanceof HTMLImageElement)this.psychoJS.logger.debug("set the image of ImageStim: "+this._name+" as: src= "+image.src+", size= "+image.width+"x"+image.height);else if(image instanceof HTMLVideoElement)this.psychoJS.logger.debug(`set the image of ImageStim: ${this._name} as: src= ${image.src}, size= ${image.videoWidth}x${image.videoHeight}, duration= ${image.duration}s`);else throw"the argument: "+image.toString()+' is neither an image nor a video" }';let existingImage=this.getImage(),hasChanged=existingImage?existingImage.src!==image.src:!0;this._setAttribute("image",image,log3),hasChanged&&this._onChange(!0,!0)()}catch(error){throw Object.assign(response2,{error})}}setMask(mask,log3=!1){let response2={origin:"ImageStim.setMask",context:"when setting the mask of ImageStim: "+this._name};try{if(typeof mask=="undefined")this.psychoJS.logger.warn("setting the mask of ImageStim: "+this._name+" with argument: undefined."),this.psychoJS.logger.debug("set the mask of ImageStim: "+this._name+" as: undefined");else{if(typeof mask=="string"&&(mask=this.psychoJS.serverManager.getResource(mask)),!(mask instanceof HTMLImageElement))throw"the argument: "+mask.toString()+' is not an image" }';this.psychoJS.logger.debug("set the mask of ImageStim: "+this._name+" as: src= "+mask.src+", size= "+mask.width+"x"+mask.height)}this._setAttribute("mask",mask,log3),this._onChange(!0,!1)()}catch(error){throw Object.assign(response2,{error})}}setInterpolate(interpolate=!1,log3=!1){this._setAttribute("interpolate",interpolate,log3),this._pixi instanceof Sprite&&(this._pixi.texture.baseTexture.scaleMode=interpolate?SCALE_MODES2.LINEAR:SCALE_MODES2.NEAREST,this._pixi.texture.baseTexture.update())}setBlurVal(blurVal=0,log3=!1){this._setAttribute("blurVal",blurVal,log3),this._pixi instanceof Sprite&&(this._blurFilter===void 0?(this._blurFilter=new filters.BlurFilter,this._blurFilter.blur=blurVal):this._blurFilter.blur=blurVal,this._pixi.filters instanceof Array&&this._pixi.filters.indexOf(this._blurFilter)===-1?this._pixi.filters.push(this._blurFilter):this._pixi.filters=[this._blurFilter])}_estimateBoundingBox(){let size=this._getDisplaySize();typeof size!="undefined"&&(this._boundingBox=new Rectangle(this._pos[0]-size[0]/2,this._pos[1]-size[1]/2,size[0],size[1]))}_updateIfNeeded(){if(!this._needUpdate)return;if(this._needUpdate=!1,this._needPixiUpdate){if(this._needPixiUpdate=!1,typeof this._pixi!="undefined"&&(this._pixi.filters=null,this._pixi.destroy(!0)),this._pixi=void 0,typeof this._image=="undefined")return;if(this._image instanceof HTMLImageElement){let texOpts={scaleMode:this._interpolate?SCALE_MODES2.LINEAR:SCALE_MODES2.NEAREST};this._texture=new Texture(new BaseTexture(this._image,texOpts))}else if(this._image instanceof HTMLVideoElement){let texOpts={resourceOptions:{autoPlay:!0},scaleMode:this._interpolate?SCALE_MODES2.LINEAR:SCALE_MODES2.NEAREST};this._texture=new Texture(new BaseTexture(this._image,texOpts))}if(this.aspectRatio===ImageStim.AspectRatioStrategy.HORIZONTAL_TILING){let[width_px,_]=to_px([this.size[0],0],this.units,this.win);this._pixi=TilingSprite.from(this._texture,1,1),this._pixi.width=width_px,this._pixi.height=this._texture.height}else this._pixi=Sprite.from(this._texture);if(typeof this._mask!="undefined"&&(this._pixi.mask=Sprite.from(new Texture(new BaseTexture(this._mask))),this._pixi.mask.anchor.x=.5,this._pixi.mask.anchor.y=.5,this._pixi.addChild(this._pixi.mask)),this._texture.width===0){this._needUpdate=!0,this._needPixiUpdate=!0;return}}this._pixi.zIndex=-this._depth,this._pixi.alpha=this.opacity;let displaySize=this._getDisplaySize(),size_px=to_px(displaySize,this.units,this.win),scaleX=size_px[0]/this._texture.width,scaleY=size_px[1]/this._texture.height;this.aspectRatio===ImageStim.AspectRatioStrategy.FIT_TO_WIDTH?scaleY=scaleX:this.aspectRatio===ImageStim.AspectRatioStrategy.FIT_TO_HEIGHT?scaleX=scaleY:this.aspectRatio===ImageStim.AspectRatioStrategy.HORIZONTAL_TILING&&(scaleX=1,scaleY=1),this.anchor=this._anchor,this._pixi.scale.x=this.flipHoriz?-scaleX:scaleX,this._pixi.scale.y=this.flipVert?scaleY:-scaleY,this._pixi.position=to_pixiPoint(this.pos,this.units,this.win),this._pixi.rotation=-this.ori*Math.PI/180,this._blurVal>0&&this.setBlurVal(this._blurVal),this._estimateBoundingBox()}_getDisplaySize(){let displaySize=this.size;if(typeof displaySize=="undefined"){if(typeof this._texture!="undefined"&&this._texture.width>0){let textureSize=[this._texture.width,this._texture.height];displaySize=to_unit(textureSize,"pix",this.win,this.units)}}else this.aspectRatio===ImageStim.AspectRatioStrategy.FIT_TO_WIDTH?typeof this._texture!="undefined"&&this._texture.width>0&&(displaySize=[displaySize[0],displaySize[0]*this._texture.height/this._texture.width]):this.aspectRatio===ImageStim.AspectRatioStrategy.FIT_TO_HEIGHT?typeof this._texture!="undefined"&&this._texture.width>0&&(displaySize=[displaySize[1]*this._texture.width/this._texture.height,displaySize[1]]):this.aspectRatio===ImageStim.AspectRatioStrategy.HORIZONTAL_TILING&&typeof this._texture!="undefined"&&this._texture.width>0&&(displaySize=[displaySize[0],this._texture.height]);return displaySize}};ImageStim.AspectRatioStrategy={FIT_TO_WIDTH:Symbol.for("FIT_TO_WIDTH"),HORIZONTAL_TILING:Symbol.for("HORIZONTAL_TILING"),FIT_TO_HEIGHT:Symbol.for("FIT_TO_HEIGHT"),VARIABLE:Symbol.for("VARIABLE")};var defaultQuad_default=`#version 300 es
precision mediump float;in vec2 aVertexPosition;in vec2 aUvs;out vec2 vUvs;uniform mat3 translationMatrix;uniform mat3 projectionMatrix;void main(){vUvs=aUvs;gl_Position=vec4((projectionMatrix*translationMatrix*vec3(aVertexPosition,1.0)).xy,0.0,1.0);}`;var imageShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform sampler2D uTex;uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;vec4 s=texture(uTex,vec2(uv.x*uFreq+uPhase,uv.y));s.xyz=s.xyz*2.-1.;shaderOut=vec4(s.xyz*uColor*.5+.5,s.a)*uAlpha;}`;var sinShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs-.25;float s=sin((uFreq*uv.x+uPhase)*2.*M_PI);shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sqrShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs-.25;float s=sign(sin((uFreq*uv.x+uPhase)*2.*M_PI));shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sawShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float s=uFreq*uv.x+uPhase;s=mod(s,1.)*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var triShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform float uPeriod;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float s=uFreq*uv.x+uPhase;s=(2.*abs(s/uPeriod-floor(s/uPeriod+.5)))*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sinXsinShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
#define PI2 2.* M_PI
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vec2(vUvs.x-.25,vUvs.y*-1.-.25);float sx=sin((uFreq*uv.x+uPhase)*PI2);float sy=sin((uFreq*uv.y+uPhase)*PI2);float s=sx*sy;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sqrXsqrShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
#define PI2 2.* M_PI
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vec2(vUvs.x-.25,vUvs.y*-1.-.25);float sx=sign(sin((uFreq*uv.x+uPhase)*PI2));float sy=sign(sin((uFreq*uv.y+uPhase)*PI2));float s=sx*sy;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var circleShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uRadius;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float s=(1.-step(uRadius,length(uv*2.-1.)))*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var gaussShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;uniform float uA;uniform float uB;uniform float uC;uniform vec3 uColor;uniform float uAlpha;
#define M_PI 3.14159265358979
void main(){vec2 uv=vUvs;float c2=uC*uC;float x=length(uv-.5);float g=uA*exp(-pow(x-uB,2.)/c2*.5)*2.-1.;shaderOut=vec4(vec3(g)*uColor*.5+.5,1.)*uAlpha;}`;var crossShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uThickness;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float sx=step(uThickness,length(uv.x*2.-1.));float sy=step(uThickness,length(uv.y*2.-1.));float s=(1.-sx*sy)*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var radRampShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;uniform float uSqueeze;uniform vec3 uColor;uniform float uAlpha;
#define M_PI 3.14159265358979
void main(){vec2 uv=vUvs;float s=(1.-length(uv*2.-1.)*uSqueeze)*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var raisedCosShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;
#define M_PI 3.14159265358979
uniform float uBeta;uniform float uPeriod;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float absX=length(uv*2.-1.);float edgeArgument1=(1.-uBeta)/(2.*uPeriod);float edgeArgument2=(1.+uBeta)/(2.*uPeriod);float frequencyFactor=(M_PI*uPeriod)/uBeta;float s=.5*(1.+cos(frequencyFactor*(absX-edgeArgument1)));if(absX<=edgeArgument1){s=1.;}else if(absX>edgeArgument2){s=0.;}s=s*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var radialShader_default=`
#version 300 es
precision mediump float;in vec2 vUvs;out vec4 shaderOut;uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;
#define M_PI 3.14159265358979
#define PI2 2.* M_PI
float aastep(float x){float w=fwidth(x);return smoothstep(.7,-.7,(abs(fract(x-.25)-.5)-.25)/w);}void main(){vec2 uv=vUvs*2.-1.;float v=uFreq*atan(uv.y,uv.x)/6.28;float s=aastep(v)*2.-1.;shaderOut=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var defaultQuad_default2="precision mediump float;attribute vec2 aVertexPosition;attribute vec2 aUvs;varying vec2 vUvs;uniform mat3 translationMatrix;uniform mat3 projectionMatrix;void main(){vUvs=aUvs;gl_Position=vec4((projectionMatrix*translationMatrix*vec3(aVertexPosition,1.0)).xy,0.0,1.0);}";var imageShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform sampler2D uTex;uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;vec4 s=texture2D(uTex,vec2(uv.x*uFreq+uPhase,uv.y));s.xyz=s.xyz*2.-1.;gl_FragColor=vec4(s.xyz*uColor*.5+.5,s.a)*uAlpha;}`;var sinShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs-.25;float s=sin((uFreq*uv.x+uPhase)*2.*M_PI);gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sqrShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs-.25;float s=sign(sin((uFreq*uv.x+uPhase)*2.*M_PI));gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sawShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float s=uFreq*uv.x+uPhase;s=mod(s,1.)*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var triShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uFreq;uniform float uPhase;uniform float uPeriod;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float s=uFreq*uv.x+uPhase;s=(2.*abs(s/uPeriod-floor(s/uPeriod+.5)))*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sinXsinShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
#define PI2 2.* M_PI
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vec2(vUvs.x-.25,vUvs.y*-1.-.25);float sx=sin((uFreq*uv.x+uPhase)*PI2);float sy=sin((uFreq*uv.y+uPhase)*PI2);float s=sx*sy;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var sqrXsqrShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
#define PI2 2.* M_PI
uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vec2(vUvs.x-.25,vUvs.y*-1.-.25);float sx=sign(sin((uFreq*uv.x+uPhase)*PI2));float sy=sign(sin((uFreq*uv.y+uPhase)*PI2));float s=sx*sy;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var circleShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uRadius;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float s=(1.-step(uRadius,length(uv*2.-1.)))*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var gaussShader_default2=`precision mediump float;varying vec2 vUvs;uniform float uA;uniform float uB;uniform float uC;uniform vec3 uColor;uniform float uAlpha;
#define M_PI 3.14159265358979
void main(){vec2 uv=vUvs;float c2=uC*uC;float x=length(uv-.5);float g=uA*exp(-pow(x-uB,2.)/c2*.5)*2.-1.;gl_FragColor=vec4(vec3(g)*uColor*.5+.5,1.)*uAlpha;}`;var crossShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uThickness;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float sx=step(uThickness,length(uv.x*2.-1.));float sy=step(uThickness,length(uv.y*2.-1.));float s=(1.-sx*sy)*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var radRampShader_default2=`precision mediump float;varying vec2 vUvs;uniform float uSqueeze;uniform vec3 uColor;uniform float uAlpha;
#define M_PI 3.14159265358979
void main(){vec2 uv=vUvs;float s=(1.-length(uv*2.-1.)*uSqueeze)*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var raisedCosShader_default2=`precision mediump float;varying vec2 vUvs;
#define M_PI 3.14159265358979
uniform float uBeta;uniform float uPeriod;uniform vec3 uColor;uniform float uAlpha;void main(){vec2 uv=vUvs;float absX=length(uv*2.-1.);float edgeArgument1=(1.-uBeta)/(2.*uPeriod);float edgeArgument2=(1.+uBeta)/(2.*uPeriod);float frequencyFactor=(M_PI*uPeriod)/uBeta;float s=.5*(1.+cos(frequencyFactor*(absX-edgeArgument1)));if(absX<=edgeArgument1){s=1.;}else if(absX>edgeArgument2){s=0.;}s=s*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var radialShader_default2=`precision mediump float;varying vec2 vUvs;uniform float uFreq;uniform float uPhase;uniform vec3 uColor;uniform float uAlpha;uniform float uStep;uniform float uDX;
#define M_PI 3.14159265358979
#define PI2 2.* M_PI
float aastep(float x,float w){return smoothstep(.7,-.7,(abs(fract(x-.25)-.5)-.25)/w);}void main(){vec2 uv=vUvs*2.-1.;float v=uFreq*atan(uv.y,uv.x)/6.28;float dF_dx=(uFreq*(atan(uv.y,uv.x+uStep)-atan(uv.y,uv.x-uStep))/6.28)/uDX;float dF_dy=(uFreq*(atan(uv.y+uStep,uv.x)-atan(uv.y-uStep,uv.x))/6.28)/uDX;float w=abs(dF_dx)+abs(dF_dy);float s=aastep(v,w)*2.-1.;gl_FragColor=vec4(vec3(s)*uColor*.5+.5,1.0)*uAlpha;}`;var _SHADERS,_SHADERSWGL1,_DEFAULT_STIM_SIZE_PX,_BLEND_MODES_MAP,_GratingStim=class extends VisualStim{constructor({name,tex="sin",win,mask,pos,anchor,units,sf=1,ori,phase,size,color,colorSpace,opacity,contrast=1,depth,interpolate,blendmode,autoDraw,autoLog,maskParams}={}){super({name,win,units,ori,opacity,depth,pos,anchor,size,autoDraw,autoLog});this._adjustmentFilter=new AdjustmentFilter({contrast}),this._addAttribute("tex",tex),this._addAttribute("mask",mask),this._addAttribute("SF",sf,__privateGet(_GratingStim,_SHADERS)[tex]&&__privateGet(_GratingStim,_SHADERS)[tex].uniforms.uFreq||1),this._addAttribute("phase",phase,__privateGet(_GratingStim,_SHADERS)[tex]&&__privateGet(_GratingStim,_SHADERS)[tex].uniforms.uPhase||0),this._addAttribute("color",color,"white"),this._addAttribute("colorSpace",colorSpace,"RGB"),this._addAttribute("contrast",contrast,1,()=>{this._adjustmentFilter.contrast=this._contrast}),this._addAttribute("blendmode",blendmode,"avg"),this._addAttribute("interpolate",interpolate,!1),this._estimateBoundingBox(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`),(!Array.isArray(this.size)||this.size.length===0)&&(this.size=to_unit(__privateGet(_GratingStim,_DEFAULT_STIM_SIZE_PX),"pix",this.win,this.units)),this._size_px=to_px(this.size,this.units,this.win)}setTex(tex,log3=!1){let response2={origin:"GratingStim.setTex",context:"when setting the tex of GratingStim: "+this._name};try{let hasChanged=!1;if(typeof tex=="undefined")this.psychoJS.logger.warn("setting the tex of GratingStim: "+this._name+" with argument: undefined."),this.psychoJS.logger.debug("set the tex of GratingStim: "+this._name+" as: undefined");else if(__privateGet(_GratingStim,_SHADERS)[tex]!==void 0){this.psychoJS.logger.debug("the tex is one of predefined functions. Set the tex of GratingStim: "+this._name+" as: "+tex);let curFuncName=this.getTex();hasChanged=curFuncName?curFuncName!==tex:!0}else{if(typeof tex=="string"&&(tex=this.psychoJS.serverManager.getResource(tex)),!(tex instanceof HTMLImageElement))throw"the argument: "+tex.toString()+' is not an image" }';this.psychoJS.logger.debug("set the tex of GratingStim: "+this._name+" as: src= "+tex.src+", size= "+tex.width+"x"+tex.height);let existingImage=this.getTex();hasChanged=existingImage?existingImage.src!==tex.src:!0}this._setAttribute("tex",tex,log3),hasChanged&&this._onChange(!0,!0)()}catch(error){throw Object.assign(response2,{error})}}setMask(mask,log3=!1){let response2={origin:"GratingStim.setMask",context:"when setting the mask of GratingStim: "+this._name};try{if(typeof mask=="undefined")this.psychoJS.logger.warn("setting the mask of GratingStim: "+this._name+" with argument: undefined."),this.psychoJS.logger.debug("set the mask of GratingStim: "+this._name+" as: undefined");else if(__privateGet(_GratingStim,_SHADERS)[mask]!==void 0)this.psychoJS.logger.debug("the mask is one of predefined functions. Set the mask of GratingStim: "+this._name+" as: "+mask);else{if(typeof mask=="string"&&(mask=this.psychoJS.serverManager.getResource(mask)),!(mask instanceof HTMLImageElement))throw"the argument: "+mask.toString()+' is not an image" }';this.psychoJS.logger.debug("set the mask of GratingStim: "+this._name+" as: src= "+mask.src+", size= "+mask.width+"x"+mask.height)}this._setAttribute("mask",mask,log3),this._onChange(!0,!1)()}catch(error){throw Object.assign(response2,{error})}}_getDisplaySize(){let displaySize=this._size;if(typeof displaySize=="undefined"&&typeof this._pixi!="undefined"&&this._pixi.width>0){let pixiContainerSize=[this._pixi.width,this._pixi.height];displaySize=to_unit(pixiContainerSize,"pix",this.win,this.units)}return displaySize}_estimateBoundingBox(){let size=this._getDisplaySize();typeof size!="undefined"&&(this._boundingBox=new Rectangle(this._pos[0]-size[0]/2,this._pos[1]-size[1]/2,size[0],size[1]))}_getPixiMeshFromPredefinedShaders(shaderName="",uniforms={}){let geometry=new Geometry;geometry.addAttribute("aVertexPosition",[-this._size_px[0]*.5,-this._size_px[1]*.5,this._size_px[0]*.5,-this._size_px[1]*.5,this._size_px[0]*.5,this._size_px[1]*.5,-this._size_px[0]*.5,this._size_px[1]*.5],2),geometry.addAttribute("aUvs",[0,0,1,0,1,1,0,1],2),geometry.addIndex([0,1,2,0,2,3]);let vertexSrc,fragmentSrc,uniformsFinal;this._win._renderer.context.webGLVersion>=2?(vertexSrc=defaultQuad_default,fragmentSrc=__privateGet(_GratingStim,_SHADERS)[shaderName].shader,uniformsFinal=Object.assign({},__privateGet(_GratingStim,_SHADERS)[shaderName].uniforms,uniforms)):(vertexSrc=defaultQuad_default2,fragmentSrc=__privateGet(_GratingStim,_SHADERSWGL1)[shaderName].shader,uniformsFinal=Object.assign({},__privateGet(_GratingStim,_SHADERSWGL1)[shaderName].uniforms,uniforms));let shader=Shader.from(vertexSrc,fragmentSrc,uniformsFinal);return new Mesh(geometry,shader)}setPhase(phase,log3=!1){this._setAttribute("phase",phase,log3),this._pixi instanceof Mesh&&(this._pixi.shader.uniforms.uPhase=-phase)}setColorSpace(colorSpaceVal="RGB",log3=!1){let colorSpaceValU=colorSpaceVal.toUpperCase();Color.COLOR_SPACE[colorSpaceValU]===void 0&&(colorSpaceValU="RGB"),this._setAttribute("colorSpace",colorSpaceValU,log3)&&this.setColor(this._color)}setColor(colorVal="white",log3=!1){let colorObj=colorVal instanceof Color?colorVal:new Color(colorVal,Color.COLOR_SPACE[this._colorSpace]);this._setAttribute("color",colorObj,log3),this._pixi instanceof Mesh&&(this._pixi.shader.uniforms.uColor=colorObj.rgbFull)}setOpacity(opacity=1,log3=!1){this._setAttribute("opacity",opacity,log3),this._pixi instanceof Mesh&&(this._pixi.shader.uniforms.uAlpha=opacity)}setSF(sf,log3=!1){this._setAttribute("SF",sf,log3),this._pixi instanceof Mesh&&(this._pixi.shader.uniforms.uFreq=sf)}setBlendmode(blendMode="avg",log3=!1){if(this._setAttribute("blendmode",blendMode,log3),this._pixi!==void 0){let pixiBlendMode=__privateGet(_GratingStim,_BLEND_MODES_MAP)[blendMode];pixiBlendMode===void 0&&(pixiBlendMode=BLEND_MODES2.NORMAL),this._pixi.filters?this._pixi.filters[this._pixi.filters.length-1].blendMode=pixiBlendMode:this._pixi.blendMode=pixiBlendMode}}setInterpolate(interpolate=!1,log3=!1){this._setAttribute("interpolate",interpolate,log3),this._pixi instanceof Mesh&&this._pixi.shader.uniforms.uTex instanceof Texture&&(this._pixi.shader.uniforms.uTex.baseTexture.scaleMode=interpolate?SCALE_MODES2.LINEAR:SCALE_MODES2.NEAREST,this._pixi.shader.uniforms.uTex.baseTexture.update())}setAnchor(anchor="center",log3=!1){if(this._setAttribute("anchor",anchor,log3),this._pixi!==void 0){let anchorNum=this._anchorTextToNum(this._anchor);this._pixi.pivot.x=(anchorNum[0]-.5)*this._pixi.scale.x*this._pixi.width,this._pixi.pivot.y=(anchorNum[1]-.5)*this._pixi.scale.y*this._pixi.height}}_updateIfNeeded(){if(!this._needUpdate)return;if(this._needUpdate=!1,this._needPixiUpdate){this._needPixiUpdate=!1,this._size_px=to_px(this._size,this.units,this.win);let shaderName,shaderUniforms,currentUniforms={};if(typeof this._pixi!="undefined"&&(this._pixi instanceof Mesh&&Object.assign(currentUniforms,this._pixi.shader.uniforms),this._pixi.destroy(!0)),this._pixi=void 0,typeof this._tex=="undefined")return;if(this._tex instanceof HTMLImageElement?(shaderName="imageShader",shaderUniforms={uTex:new Texture(new BaseTexture(this._tex,{wrapMode:WRAP_MODES2.REPEAT,scaleMode:this._interpolate?SCALE_MODES2.LINEAR:SCALE_MODES2.NEAREST})),uFreq:this._SF,uPhase:this._phase,uColor:this._color.rgbFull}):(shaderName=this._tex,shaderUniforms={uFreq:this._SF,uPhase:this._phase,uColor:this._color.rgbFull}),this._pixi=this._getPixiMeshFromPredefinedShaders(shaderName,Object.assign(shaderUniforms,currentUniforms)),this._pixi.filters=[this._adjustmentFilter],typeof this._mask!="undefined"){if(this._mask instanceof HTMLImageElement)this._pixi.mask=Sprite.from(new Texture(new BaseTexture(this._mask))),this._pixi.mask.width=this._size_px[0],this._pixi.mask.height=this._size_px[1],this._pixi.addChild(this._pixi.mask);else{let maskMesh=this._getPixiMeshFromPredefinedShaders(this._mask);maskMesh.position.set(this._size_px[0]*.5,this._size_px[1]*.5);let rt=RenderTexture.create({width:this._size_px[0],height:this._size_px[1],scaleMode:this._interpolate?SCALE_MODES2.LINEAR:SCALE_MODES2.NEAREST});this.win._renderer.render(maskMesh,{renderTexture:rt});let maskSprite=new Sprite.from(rt);this._pixi.mask=maskSprite,this._pixi.addChild(maskSprite)}this._pixi.mask.anchor.set(.5)}if(this._pixi.width===0){this._needUpdate=!0,this._needPixiUpdate=!0;return}}this._pixi.zIndex=-this._depth,this.opacity=this._opacity,this.anchor=this._anchor,this._pixi.scale.x=1,this._pixi.scale.y=-1;let pos=to_pixiPoint(this.pos,this.units,this.win);this._pixi.position.set(pos.x,pos.y),this._pixi.rotation=-this.ori*Math.PI/180,this._estimateBoundingBox()}},GratingStim=_GratingStim;_SHADERS=new WeakMap,_SHADERSWGL1=new WeakMap,_DEFAULT_STIM_SIZE_PX=new WeakMap,_BLEND_MODES_MAP=new WeakMap,__privateAdd(GratingStim,_SHADERS,{imageShader:{shader:imageShader_default,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},sin:{shader:sinShader_default,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},sqr:{shader:sqrShader_default,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},saw:{shader:sawShader_default,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},tri:{shader:triShader_default,uniforms:{uFreq:1,uPhase:0,uPeriod:1,uColor:[1,1,1],uAlpha:1}},sinXsin:{shader:sinXsinShader_default,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},sqrXsqr:{shader:sqrXsqrShader_default,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},circle:{shader:circleShader_default,uniforms:{uRadius:1,uColor:[1,1,1],uAlpha:1}},gauss:{shader:gaussShader_default,uniforms:{uA:1,uB:0,uC:.16,uColor:[1,1,1],uAlpha:1}},cross:{shader:crossShader_default,uniforms:{uThickness:.2,uColor:[1,1,1],uAlpha:1}},radRamp:{shader:radRampShader_default,uniforms:{uSqueeze:1,uColor:[1,1,1],uAlpha:1}},raisedCos:{shader:raisedCosShader_default,uniforms:{uBeta:.25,uPeriod:.625,uColor:[1,1,1],uAlpha:1}},radialStim:{shader:radialShader_default,uniforms:{uFreq:20,uPhase:0,uColor:[1,1,1],uAlpha:1}}}),__privateAdd(GratingStim,_SHADERSWGL1,{imageShader:{shader:imageShader_default2,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},sin:{shader:sinShader_default2,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},sqr:{shader:sqrShader_default2,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},saw:{shader:sawShader_default2,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},tri:{shader:triShader_default2,uniforms:{uFreq:1,uPhase:0,uPeriod:1,uColor:[1,1,1],uAlpha:1}},sinXsin:{shader:sinXsinShader_default2,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},sqrXsqr:{shader:sqrXsqrShader_default2,uniforms:{uFreq:1,uPhase:0,uColor:[1,1,1],uAlpha:1}},circle:{shader:circleShader_default2,uniforms:{uRadius:1,uColor:[1,1,1],uAlpha:1}},gauss:{shader:gaussShader_default2,uniforms:{uA:1,uB:0,uC:.16,uColor:[1,1,1],uAlpha:1}},cross:{shader:crossShader_default2,uniforms:{uThickness:.2,uColor:[1,1,1],uAlpha:1}},radRamp:{shader:radRampShader_default2,uniforms:{uSqueeze:1,uColor:[1,1,1],uAlpha:1}},raisedCos:{shader:raisedCosShader_default2,uniforms:{uBeta:.25,uPeriod:.625,uColor:[1,1,1],uAlpha:1}},radialStim:{shader:radialShader_default2,uniforms:{uFreq:20,uStep:.0017,uDX:1,uPhase:0,uColor:[1,1,1],uAlpha:1}}}),__privateAdd(GratingStim,_DEFAULT_STIM_SIZE_PX,[256,256]),__privateAdd(GratingStim,_BLEND_MODES_MAP,{avg:BLEND_MODES2.NORMAL,add:BLEND_MODES2.ADD,mul:BLEND_MODES2.MULTIPLY,screen:BLEND_MODES2.SCREEN});var MovieStim=class extends VisualStim{constructor({name,win,movie,pos,anchor,units,ori,size,color,opacity,contrast,interpolate,flipHoriz,flipVert,loop,volume,noAudio,autoPlay,autoDraw,autoLog}={}){super({name,win,units,ori,opacity,pos,anchor,size,autoDraw,autoLog});this.psychoJS.logger.debug("create a new MovieStim with name: ",name),this._addAttribute("movie",movie),this._addAttribute("volume",volume,1,this._onChange(!1,!1)),this._addAttribute("noAudio",noAudio,!1,this._onChange(!1,!1)),this._addAttribute("autoPlay",autoPlay,!0,this._onChange(!1,!1)),this._addAttribute("flipHoriz",flipHoriz,!1,this._onChange(!1,!1)),this._addAttribute("flipVert",flipVert,!1,this._onChange(!1,!1)),this._addAttribute("interpolate",interpolate,!1,this._onChange(!0,!1)),this._addAttribute("color",color,"white",this._onChange(!0,!1)),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1)),this._addAttribute("loop",loop,!1,this._onChange(!1,!1)),this._estimateBoundingBox();let videoElement=document.createElement("video");this._hasFastSeek=typeof videoElement.fastSeek=="function",this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}setMovie(movie,log3=!1){let response2={origin:"MovieStim.setMovie",context:`when setting the movie of MovieStim: ${this._name}`};try{if(typeof movie=="undefined")this.psychoJS.logger.warn(`setting the movie of MovieStim: ${this._name} with argument: undefined.`),this.psychoJS.logger.debug(`set the movie of MovieStim: ${this._name} as: undefined`);else{if(typeof movie=="string"?movie=this.psychoJS.serverManager.getResource(movie):movie instanceof Camera&&(movie=movie.getVideo()),!(movie instanceof HTMLVideoElement))throw`${movie.toString()} is not a video`;this.psychoJS.logger.debug(`set the movie of MovieStim: ${this._name} as: src= ${movie.src}, size= ${movie.videoWidth}x${movie.videoHeight}, duration= ${movie.duration}s`),movie.onended||(movie.onended=()=>{this.status=PsychoJS.Status.FINISHED})}this._setAttribute("movie",movie,log3),this._needUpdate=!0,this._needPixiUpdate=!0}catch(error){throw Object.assign(response2,{error})}}reset(log3=!1){this.status=PsychoJS.Status.NOT_STARTED,this._movie.pause(),this.seek(0,log3)}play(log3=!1){this.status=PsychoJS.Status.STARTED;let playPromise=this._movie.play();playPromise!==void 0&&playPromise.catch(error=>{throw{origin:"MovieStim.play",context:`when attempting to play MovieStim: ${this._name}`,error}})}pause(log3=!1){this.status=PsychoJS.Status.STOPPED,this._movie.pause()}stop(log3=!1){this.status=PsychoJS.Status.STOPPED,this._movie.pause(),this.seek(0,log3)}seek(timePoint,log3=!1){if(timePoint<0||timePoint>this._movie.duration)throw{origin:"MovieStim.seek",context:`when seeking to timepoint: ${timePoint} of MovieStim: ${this._name}`,error:`the timepoint does not belong to [0, ${this._movie.duration}`};if(this._hasFastSeek)this._movie.fastSeek(timePoint);else try{this._movie.currentTime=timePoint}catch(error){throw{origin:"MovieStim.seek",context:`when seeking to timepoint: ${timePoint} of MovieStim: ${this._name}`,error}}}_estimateBoundingBox(){let size=this._getDisplaySize();typeof size!="undefined"&&(this._boundingBox=new Rectangle(this._pos[0]-size[0]/2,this._pos[1]-size[1]/2,size[0],size[1]))}_updateIfNeeded(){if(!this._needUpdate)return;if(this._needUpdate=!1,this._needPixiUpdate){if(this._needPixiUpdate=!1,typeof this._pixi!="undefined"&&this._pixi.destroy({children:!0,texture:!0,baseTexture:!1}),this._pixi=void 0,typeof this._movie=="undefined")return;if(this._texture=Texture.from(this._movie,{resourceOptions:{autoPlay:this.autoPlay}}),this._pixi=new Sprite(this._texture),this._texture.width===0){this._needUpdate=!0,this._needPixiUpdate=!0;return}}this._movie.muted=this._noAudio,this._movie.volume=this._volume,this._movie.loop=this._loop,this._pixi.alpha=this.opacity;let displaySize=this._getDisplaySize(),size_px=to_px(displaySize,this.units,this.win),scaleX=size_px[0]/this._texture.width,scaleY=size_px[1]/this._texture.height;this._pixi.scale.x=this.flipHoriz?-scaleX:scaleX,this._pixi.scale.y=this.flipVert?scaleY:-scaleY,this._pixi.position=to_pixiPoint(this.pos,this.units,this.win),this._pixi.rotation=-this.ori*Math.PI/180,this.anchor=this._anchor,this._estimateBoundingBox()}_getDisplaySize(){let displaySize=this.size;if(typeof displaySize=="undefined"&&typeof this._texture!="undefined"&&this._texture.width>0){let textureSize=[this._texture.width,this._texture.height];displaySize=to_unit(textureSize,"pix",this.win,this.units)}return displaySize}};var ShapeStim=class extends mix(VisualStim).with(ColorMixin,WindowMixin){constructor({name,win,lineWidth,lineColor,fillColor,opacity,vertices,closeShape,pos,anchor,size,ori,units,contrast,depth,interpolate,autoDraw,autoLog}={}){super({name,win,units,ori,opacity,pos,anchor,depth,size,autoDraw,autoLog});this._pixiPolygon_px=void 0,this._vertices_px=void 0,(typeof size=="undefined"||size===null)&&(this.size=[1,1]),this._addAttribute("vertices",vertices,[[-.5,0],[0,.5],[.5,0]]),this._addAttribute("closeShape",closeShape,!0,this._onChange(!0,!1)),this._addAttribute("interpolate",interpolate,!0,this._onChange(!0,!1)),this._addAttribute("lineWidth",lineWidth,1.5,this._onChange(!0,!0)),this._addAttribute("lineColor",lineColor,"white",this._onChange(!0,!1)),this._addAttribute("fillColor",fillColor,void 0,this._onChange(!0,!1)),this._addAttribute("contrast",contrast,1,this._onChange(!0,!1))}setVertices(vertices,log3=!1){let response2={origin:"ShapeStim.setVertices",context:"when setting the vertices of ShapeStim: "+this._name};this._psychoJS.logger.debug("set the vertices of ShapeStim:",this.name);try{if(typeof vertices=="string")if(vertices in ShapeStim.KnownShapes)vertices=ShapeStim.KnownShapes[vertices];else throw`unknown shape: ${vertices}`;this._setAttribute("vertices",vertices,log3),this._onChange(!0,!0)()}catch(error){throw Object.assign(response2,{error})}}contains(object,units){let objectPos_px=getPositionFromObject(object,units);if(typeof objectPos_px=="undefined")throw{origin:"VisualStim.contains",context:"when determining whether VisualStim: "+this._name+" contains object: "+toString(object),error:"unable to determine the position of the object"};let pos_px=to_px(this.pos,this.units,this.win);this._getVertices_px();let polygon_px=this._vertices_px.map(v=>[v[0]+pos_px[0],v[1]+pos_px[1]]);return IsPointInsidePolygon(objectPos_px,polygon_px)}setAnchor(anchor="center",log3=!1){if(this._setAttribute("anchor",anchor,log3),this._pixi!==void 0){let anchorNum=this._anchorTextToNum(this._anchor);this._pixi.pivot.x=(anchorNum[0]-.5)*this._pixi.scale.x*this._pixi.width,this._pixi.pivot.y=(anchorNum[1]-.5)*-this._pixi.scale.y*this._pixi.height}}_estimateBoundingBox(){this._getVertices_px();let limits_px=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let vertex9 of this._vertices_px)limits_px[0]=Math.min(limits_px[0],vertex9[0]),limits_px[1]=Math.min(limits_px[1],vertex9[1]),limits_px[2]=Math.max(limits_px[2],vertex9[0]),limits_px[3]=Math.max(limits_px[3],vertex9[1]);this._boundingBox=new Rectangle(this._pos[0]+this._getLengthUnits(limits_px[0]),this._pos[1]+this._getLengthUnits(limits_px[1]),this._getLengthUnits(limits_px[2]-limits_px[0]),this._getLengthUnits(limits_px[3]-limits_px[1]))}_updateIfNeeded(){if(!!this._needUpdate){if(this._needUpdate=!1,this._needPixiUpdate){if(this._needPixiUpdate=!1,typeof this._pixi!="undefined"&&this._pixi.destroy(!0),this._pixi=void 0,this._getPixiPolygon(),this._pixi=new Graphics,this._pixi.lineStyle(this._lineWidth,this._lineColor.int,this._opacity,.5),typeof this._fillColor!="undefined"&&this._fillColor!==null){let contrastedColor=this.getContrastedColor(new Color(this._fillColor),this._contrast);this._pixi.beginFill(contrastedColor.int,this._opacity)}this._pixi.drawPolygon(this._pixiPolygon_px),typeof this._fillColor!="undefined"&&this._fillColor!==null&&this._pixi.endFill(),this._pixi.zIndex=-this._depth,this.anchor=this._anchor}this._pixi.position=to_pixiPoint(this.pos,this.units,this.win),this._pixi.rotation=-this.ori*Math.PI/180}}_getPixiPolygon(){this._getVertices_px();let coords_px=[];for(let vertex_px of this._vertices_px)coords_px.push.apply(coords_px,vertex_px);if(coords_px.length>=6&&this._closeShape){let n=coords_px.length;(coords_px[0]!==coords_px[n-2]||coords_px[1]!==coords_px[n-1])&&(coords_px.push(coords_px[0]),coords_px.push(coords_px[1]))}return this._pixiPolygon_px=new Polygon(coords_px),this._pixiPolygon_px.closeStroke=this._closeShape,this._pixiPolygon_px}_getVertices_px(){let flip=[1,1];return"_flipHoriz"in this&&this._flipHoriz&&(flip[0]=-1),"_flipVert"in this&&this._flipVert&&(flip[1]=-1),this._vertices_px=this._vertices.map(v=>to_px([v[0]*this._size[0]*flip[0],v[1]*this._size[1]*flip[1]],this._units,this._win)),this._vertices_px}};ShapeStim.KnownShapes={cross:[[-.1,.5],[.1,.5],[.1,.1],[.5,.1],[.5,-.1],[.1,-.1],[.1,-.5],[-.1,-.5],[-.1,-.1],[-.5,-.1],[-.5,.1],[-.1,.1]],star7:[[0,.5],[.09,.18],[.39,.31],[.19,.04],[.49,-.11],[.16,-.12],[.22,-.45],[0,-.2],[-.22,-.45],[-.16,-.12],[-.49,-.11],[-.19,.04],[-.39,.31],[-.09,.18]],triangle:[[0,.5],[-.5,-.5],[.5,-.5]],rectangle:[[-.5,.5],[.5,.5],[.5,-.5],[-.5,-.5]],arrow:[[0,.5],[-.5,0],[-1/6,0],[-1/6,-.5],[1/6,-.5],[1/6,0],[.5,0]]};ShapeStim.KnownShapes.star=ShapeStim.KnownShapes.star7;var Polygon2=class extends ShapeStim{constructor({name,win,lineWidth,lineColor,fillColor,opacity,edges,radius,pos,size,ori,units,contrast,depth,interpolate,autoDraw,autoLog}={}){super({name,win,lineWidth,lineColor,fillColor,opacity,pos,ori,size,units,contrast,depth,interpolate,autoDraw,autoLog});this._psychoJS.logger.debug("create a new Polygon with name: ",name),this._addAttribute("edges",edges,3),this._addAttribute("radius",radius,.5),this._updateVertices(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}setRadius(radius,log3=!1){this._setAttribute("radius",radius,log3)&&this._updateVertices()}setEdges(edges,log3=!1){this._setAttribute("edges",Math.round(edges),log3)&&this._updateVertices()}_updateVertices(){this._psychoJS.logger.debug("update the vertices of Polygon: ",this.name);let angle=2*Math.PI/this._edges,vertices=[];for(let v=0;v<this._edges;++v)vertices.push([Math.sin(v*angle)*this._radius,Math.cos(v*angle)*this._radius]);this.setVertices(vertices)}};var Rect=class extends ShapeStim{constructor({name,win,lineWidth,lineColor,fillColor,opacity,width,height,pos,anchor,size,ori,units,contrast,depth,interpolate,autoDraw,autoLog}={}){super({name,win,lineWidth,lineColor,fillColor,opacity,pos,anchor,ori,size,units,contrast,depth,interpolate,autoDraw,autoLog});this._psychoJS.logger.debug("create a new Rect with name: ",name),this._addAttribute("width",width,.5),this._addAttribute("height",height,.5),this._updateVertices(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}setWidth(width,log3=!1){this._psychoJS.logger.debug("set the width of Rect: ",this.name,"to: ",width),this._setAttribute("width",width,log3)&&this._updateVertices()}setHeight(height,log3=!1){this._psychoJS.logger.debug("set the height of Rect: ",this.name,"to: ",height),this._setAttribute("height",height,log3)&&this._updateVertices()}_updateVertices(){this._psychoJS.logger.debug("update the vertices of Rect: ",this.name);let halfWidth=this._width/2,halfHeight=this._height/2;this.setVertices([[-halfWidth,-halfHeight],[halfWidth,-halfHeight],[halfWidth,halfHeight],[-halfWidth,halfHeight]])}};var FaceDetector=class extends VisualStim{constructor({name,win,input,modelDir,faceApiUrl,units,ori,opacity,pos,size,autoDraw,autoLog}={}){super({name,win,units,ori,opacity,pos,size,autoDraw,autoLog});this._addAttribute("input",input,void 0),this._addAttribute("faceApiUrl",faceApiUrl,"face-api.js"),this._addAttribute("modelDir",modelDir,"models"),this._addAttribute("autoLog",autoLog,!1),this._addAttribute("status",PsychoJS.Status.NOT_STARTED),this._initFaceApi(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}isReady(){return this._modelsLoaded}setInput(input,log3=!1){let response2={origin:"FaceDetector.setInput",context:"when setting the video of FaceDetector: "+this._name};try{if(typeof input=="undefined")this.psychoJS.logger.warn("setting the movie of MovieStim: "+this._name+" with argument: undefined."),this.psychoJS.logger.debug("set the movie of MovieStim: "+this._name+" as: undefined");else{if(typeof input=="string"||input instanceof Camera&&(input=input.getVideo()),!(input instanceof HTMLVideoElement))throw input.toString()+" is not a video";this.psychoJS.logger.debug(`set the video of FaceDetector: ${this._name} as: src= ${input.src}, size= ${input.videoWidth}x${input.videoHeight}, duration= ${input.duration}s`),input.onended||(input.onended=()=>{this.status=PsychoJS.Status.FINISHED})}this._setAttribute("input",input,log3),this._needUpdate=!0,this._needPixiUpdate=!0}catch(error){throw Object.assign(response2,{error})}}start(period,detectionCallback,log3=!1){this.status=PsychoJS.Status.STARTED,typeof this._detectionId!="undefined"&&(clearInterval(this._detectionId),this._detectionId=void 0),this._detectionId=setInterval(async()=>{this._detections=await faceapi.detectAllFaces(this._input,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks().withFaceExpressions(),this._needUpdate=!0,this._needPixiUpdate=!0,detectionCallback(this._detections)},period)}stop(log3=!1){this.status=PsychoJS.Status.NOT_STARTED,typeof this._detectionId!="undefined"&&(clearInterval(this._detectionId),this._detectionId=void 0)}async _initFaceApi(){this._modelsLoaded=!1,await faceapi.nets.tinyFaceDetector.loadFromUri(this._modelDir),await faceapi.nets.faceLandmark68Net.loadFromUri(this._modelDir),await faceapi.nets.faceRecognitionNet.loadFromUri(this._modelDir),await faceapi.nets.faceExpressionNet.loadFromUri(this._modelDir),this._modelsLoaded=!0}_updateIfNeeded(){if(!!this._needUpdate){if(this._needUpdate=!1,this._needPixiUpdate){this._needPixiUpdate=!1,typeof this._pixi!="undefined"&&this._pixi.destroy(!0),this._pixi=new Container,this._pixi.interactive=!0,this._body=new Graphics,this._body.interactive=!0,this._pixi.addChild(this._body);let size_px=to_px(this.size,this.units,this.win);if(typeof this._detections!="undefined")for(let detection of this._detections){let landmarks=detection.landmarks,imageWidth=detection.alignedRect.imageWidth,imageHeight=detection.alignedRect.imageHeight;for(let position of landmarks.positions)this._body.beginFill(new Color("red").int,this._opacity),this._body.drawCircle(position._x/imageWidth*size_px[0]-size_px[0]/2,position._y/imageHeight*size_px[1]-size_px[1]/2,2),this._body.endFill()}}this._pixi.scale.x=1,this._pixi.scale.y=-1,this._pixi.rotation=-this.ori*Math.PI/180,this._pixi.position=to_pixiPoint(this.pos,this.units,this.win),this._pixi.alpha=this._opacity}}_estimateBoundingBox(){}};function init3(Survey2){var widget={name:"selectbox",title:"My custom widg",iconName:"",widgetIsLoaded:function(){return!0},isFit:function(question){return question.getType()==="selectbox"},activatedByChanged:function(activatedBy){Survey2.JsonObject.metaData.addClass("selectbox",[],null,"text"),Survey2.JsonObject.metaData.addProperties("selectbox",[{name:"choices",isArray:!0,default:[]},{name:"multipleAnswer",default:!0}])},isDefaultRender:!1,htmlTemplate:"<div></div>",afterRender:function(question,el){let optionsHTML="",i;for(i=0;i<question.choices.length;i++)optionsHTML+=`<option value="${question.choices[i].value}">${question.choices[i].text}</option>`;let additionalAttr="";question.multipleAnswer?additionalAttr="multiple":additionalAttr='size="4"';let selectHTML=`<select class="srv-select-multiple" ${additionalAttr}>${optionsHTML}</select>`;el.insertAdjacentHTML("beforeend",selectHTML),el.querySelector("select").addEventListener("input",e=>{let i2,opts=new Array(e.currentTarget.selectedOptions.length);for(i2=0;i2<e.currentTarget.selectedOptions.length;i2++)opts[i2]=e.currentTarget.selectedOptions[i2].value;question.value=opts})},willUnmount:function(question,el){}};Survey2.CustomWidgetCollection.Instance.addCustomWidget(widget,"customtype")}function init4(Survey2){var widget={name:"slider",title:"Slider",iconName:"",widgetIsLoaded:function(){return!0},isFit:function(question){return question.getType()==="slider"},activatedByChanged:function(activatedBy){Survey2.JsonObject.metaData.addClass("slider",[],null,"text"),Survey2.JsonObject.metaData.addProperties("slider",[{name:"choices",isArray:!0,default:[]},{name:"minVal",default:0},{name:"maxVal",default:100},{name:"showValue",default:!0},{name:"sliderType",default:"regular"},{name:"snapToGrid",default:!1},{name:"gridStep",default:10}])},isDefaultRender:!1,htmlTemplate:"<div></div>",afterRender:function(question,el){let html="",i;for(i=0;i<question.choices.length;i++)html+=`<div class="srv-slider-container ${question.sliderType==="bar"?"srv-slider-bar":""}">
				<input type="range" max="100" class="srv-slider" data-idx="${i}">
				<div class="srv-slider-title">${question.choices[i]}</div>
				<div class="srv-slider-display ${question.showValue?"":"hidden"}"></div>
				</div>`;el.insertAdjacentHTML("beforeend",html);let containers=el.querySelectorAll(".srv-slider-container"),inputDOMS=el.querySelectorAll(".srv-slider"),sliderDisplayDOMS=el.querySelectorAll(".srv-slider-display");question.value instanceof Array||(question.value=new Array(inputDOMS.length),question.value.fill(0));function handleInput(e){let idx=parseInt(e.currentTarget.dataset.idx,10);question.value[idx]=parseFloat(e.currentTarget.value),question.value=question.value,onValueChangedCallback()}for(i=0;i<inputDOMS.length;i++)inputDOMS[i].min=question.minVal,inputDOMS[i].max=question.maxVal,inputDOMS[i].addEventListener("input",handleInput);function positionSliderDisplay(v,min,max,displayDOM){v=parseFloat(v),min=parseFloat(min),max=parseFloat(max),displayDOM.style.left=`calc(${(v-min)/(max-min)*100}% + ${10-v*.2}px)`}var onValueChangedCallback=function(){let i2,v;for(i2=0;i2<question.choices.length;i2++)v=question.value[i2]||0,inputDOMS[i2].value=v,sliderDisplayDOMS[i2].innerText=v,positionSliderDisplay(v,question.minVal,question.maxVal,sliderDisplayDOMS[i2])},onReadOnlyChangedCallback=function(){let i2;if(question.isReadOnly)for(i2=0;i2<question.choices.length;i2++)inputDOMS[i2].setAttribute("disabled","disabled");else for(i2=0;i2<question.choices.length;i2++)inputDOMS[i2].removeAttribute("disabled")};question.readOnlyChangedCallback=onReadOnlyChangedCallback,question.valueChangedCallback=onValueChangedCallback,onValueChangedCallback(),onReadOnlyChangedCallback()},willUnmount:function(question,el){}};Survey2.CustomWidgetCollection.Instance.addCustomWidget(widget,"customtype")}var CELL_TYPES={DROP_DOWN:"dropdown",RADIO:"radio",CHECKBOX:"checkbox",TEXT:"text"},_SideBySideMatrix=class{constructor(cfg={}){let surveyCSS=cfg.question.css;this._CSS_CLASSES={WRAPPER:`${surveyCSS.matrix.tableWrapper} sbs-matrix`,TABLE:surveyCSS.matrix.root,TABLE_ROW:surveyCSS.matrixdropdown.row,TABLE_HEADER_CELL:surveyCSS.matrix.headerCell,TABLE_CELL:surveyCSS.matrix.cell,INPUT_TEXT:surveyCSS.text.root,LABEL:surveyCSS.matrix.label,ITEM_CHECKED:surveyCSS.matrix.itemChecked,ITEM_VALUE:surveyCSS.matrix.itemValue,ITEM_DECORATOR:surveyCSS.matrix.materialDecorator,RADIO:surveyCSS.radiogroup.item,SELECT:surveyCSS.dropdown.control,CHECKBOX:surveyCSS.checkbox.item,CHECKBOX_CONTROL:surveyCSS.checkbox.itemControl,CHECKBOX_DECORATOR:surveyCSS.checkbox.materialDecorator,CHECKBOX_DECORATOR_SVG:surveyCSS.checkbox.itemDecorator},this._question=cfg.question,this._DOM=cfg.el,this._DOM.classList.add(...this._CSS_CLASSES.WRAPPER.split(" ")),this._bindedHandlers={_handleInput:this._handleInput.bind(this),_handleSelectChange:this._handleSelectChange.bind(this)},this._init(this._question,this._DOM)}_generateDropdownCells(row,col,subColumns,CSS_CLASSES){let bodyCells="",selectOptions='<option value=""></option>',i;for(i=0;i<subColumns.length;i++)selectOptions+=`<option value="${subColumns[i].value}">${subColumns[i].text}</option>`;return bodyCells=`<td class="${CSS_CLASSES.TABLE_CELL}">
		<select class="${CSS_CLASSES.SELECT}" name="${row.value}-${col.value}">${selectOptions}</select>
		</td>`,bodyCells}_generateRadioCells(row,col,subColumns,CSS_CLASSES){let bodyCells="",i;for(i=0;i<subColumns.length;i++)bodyCells+=`<td class="${CSS_CLASSES.TABLE_CELL}">
			<label class="${CSS_CLASSES.LABEL}">
				<input class="${CSS_CLASSES.ITEM_VALUE}" type="${col.cellType}" name="${row.value}-${col.value}" value="${subColumns[i].value}">
				<span class="${CSS_CLASSES.ITEM_DECORATOR}"></span>
			</label>
			</td>`;return bodyCells}_generateCheckboxCells(row,col,subColumns,CSS_CLASSES){let bodyCells="",i;for(i=0;i<subColumns.length;i++)bodyCells+=`<td class="${CSS_CLASSES.TABLE_CELL}">
			<label class="${CSS_CLASSES.LABEL}">
				<input class="${CSS_CLASSES.CHECKBOX_CONTROL}" type="${col.cellType}" name="${row.value}-${col.value}-${subColumns[i].value}">
				<span class="${CSS_CLASSES.CHECKBOX_DECORATOR}">
					<svg class="${CSS_CLASSES.CHECKBOX_DECORATOR_SVG}">
						<use data-bind="attr:{'xlink:href':question.itemSvgIcon}" xlink:href="#icon-v2check"></use>
					</svg>
				</span>
			</label>
			</td>`;return bodyCells}_generateTextInputCells(row,col,subColumns,CSS_CLASSES){let bodyCells="",i;for(i=0;i<subColumns.length;i++)bodyCells+=`<td class="${CSS_CLASSES.TABLE_CELL}">
			<input class="${CSS_CLASSES.INPUT_TEXT}" type="${col.cellType}" name="${row.value}-${col.value}-${subColumns[i].value}">
			</td>`;return bodyCells}_ensureQuestionValueFields(row,col){this._question.value===void 0&&(this._question.value={}),this._question.value[row]===void 0&&(this._question.value[row]={[col]:{}}),this._question.value[row][col]===void 0&&(this._question.value[row][col]={})}_handleInput(e){let valueCoordinates=e.currentTarget.name.split("-"),row=valueCoordinates[0],col=valueCoordinates[1],subCol=valueCoordinates[2]!==void 0?valueCoordinates[2]:e.currentTarget.value;this._ensureQuestionValueFields(row,col),e.currentTarget.type==="text"?this._question.value[row][col][subCol]=e.currentTarget.value:e.currentTarget.type==="radio"?this._question.value[row][col]=e.currentTarget.value:e.currentTarget.type==="checkbox"&&(this._question.value[row][col][subCol]=e.currentTarget.checked),this._question.value=this._question.value}_handleSelectChange(e){let valueCoordinates=e.currentTarget.name.split("-"),row=valueCoordinates[0],col=valueCoordinates[1];this._ensureQuestionValueFields(row,col),this._question.value[row][col]=e.currentTarget.value,this._question.value=this._question.value}_init(question,el){let t=performance.now(),CSS_CLASSES=this._CSS_CLASSES;if(question.css.matrix.mainRoot){let rootClass=`${question.css.matrix.mainRoot} ${question.cssClasses.withFrame||""}`;question.setCssRoot(rootClass),question.cssClasses.mainRoot=rootClass}let html,headerCells="",subHeaderCells="",bodyCells="",bodyHTML="",cellGenerator,i,j;for(i=0;i<question.columns.length;i++){if(question.columns[i].cellType!==CELL_TYPES.DROP_DOWN)for(headerCells+=`<th class="${CSS_CLASSES.TABLE_HEADER_CELL}" colspan="${question.columns[i].subColumns.length}">
				${question.columns[i].title}
				</th>`,j=0;j<question.columns[i].subColumns.length;j++)subHeaderCells+=`<th
					class="${CSS_CLASSES.TABLE_HEADER_CELL} sbs-matrix-header-cell--${question.columns[i].cellType}">
					${question.columns[i].subColumns[j].text}
					</th>`;else headerCells+=`<th class="${CSS_CLASSES.TABLE_HEADER_CELL}">
				${question.columns[i].title}
				</th>`,subHeaderCells+=`<td class="${CSS_CLASSES.TABLE_HEADER_CELL} sbs-matrix-header-cell--${question.columns[i].cellType}"></td>`;headerCells+="<td></td>",subHeaderCells+="<td></td>"}for(i=0;i<question.rows.length;i++){for(bodyCells="",j=0;j<question.columns.length;j++)cellGenerator=this[_SideBySideMatrix.CELL_GENERATORS[question.columns[j].cellType]],typeof cellGenerator=="function"?bodyCells+=`${cellGenerator.call(this,question.rows[i],question.columns[j],question.columns[j].subColumns,CSS_CLASSES)}<td></td>`:console.log("No cell generator found for cellType",question.columns[j].cellType);bodyHTML+=`<tr class="${CSS_CLASSES.TABLE_ROW}"><td class="${CSS_CLASSES.TABLE_CELL}">${question.rows[i].text}</td><td></td>${bodyCells}</tr>`}html=`<table class="${CSS_CLASSES.TABLE}">
		<thead>
		<tr><td></td><td></td>${headerCells}</tr>
		<tr><td></td><td></td>${subHeaderCells}</tr>
		</thead>
		<tbody>${bodyHTML}</tbody>
		</table>`,el.insertAdjacentHTML("beforeend",html);let inputDOMS=el.querySelectorAll("input"),selectDOMS=el.querySelectorAll("select");for(i=0;i<inputDOMS.length;i++)inputDOMS[i].addEventListener("input",this._bindedHandlers._handleInput);for(i=0;i<selectDOMS.length;i++)selectDOMS[i].addEventListener("change",this._bindedHandlers._handleSelectChange)}},SideBySideMatrix=_SideBySideMatrix;__publicField(SideBySideMatrix,"CELL_GENERATORS",{[CELL_TYPES.DROP_DOWN]:"_generateDropdownCells",[CELL_TYPES.RADIO]:"_generateRadioCells",[CELL_TYPES.CHECKBOX]:"_generateCheckboxCells",[CELL_TYPES.TEXT]:"_generateTextInputCells"});function init5(Survey2){var widget={name:"sidebysidematrix",title:"Side by side matrix",iconName:"",widgetIsLoaded:function(){return!0},isFit:function(question){return question.getType()==="sidebysidematrix"},activatedByChanged:function(activatedBy){Survey2.JsonObject.metaData.addClass("sidebysidematrix",[],null,"text"),Survey2.JsonObject.metaData.addProperties("sidebysidematrix",[{name:"rows",isArray:!0,default:[]},{name:"columns",isArray:!0,default:[]}])},isDefaultRender:!1,htmlTemplate:"<div></div>",afterRender:function(question,el){new SideBySideMatrix({question,el})},willUnmount:function(question,el){}};Survey2.CustomWidgetCollection.Instance.addCustomWidget(widget,"customtype")}var MaxDiffMatrix=class{constructor(cfg={}){let surveyCSS=cfg.question.css;this._CSS_CLASSES={WRAPPER:`${surveyCSS.matrix.tableWrapper} matrix-maxdiff`,TABLE:surveyCSS.matrix.root,TABLE_ROW:surveyCSS.matrixdropdown.row,TABLE_HEADER_CELL:surveyCSS.matrix.headerCell,TABLE_CELL:surveyCSS.matrix.cell,INPUT_TEXT:surveyCSS.text.root,LABEL:surveyCSS.matrix.label,ITEM_CHECKED:surveyCSS.matrix.itemChecked,ITEM_VALUE:surveyCSS.matrix.itemValue,ITEM_DECORATOR:surveyCSS.matrix.materialDecorator,RADIO:surveyCSS.radiogroup.item,SELECT:surveyCSS.dropdown.control,CHECKBOX:surveyCSS.checkbox.item},this._question=cfg.question,this._DOM=cfg.el,this._DOM.classList.add(...this._CSS_CLASSES.WRAPPER.split(" ")),this._bindedHandlers={_handleInput:this._handleInput.bind(this)},this._init(this._question,this._DOM)}_handleInput(e){let row=e.currentTarget.name.split("-")[0],col=parseInt(e.currentTarget.dataset.column,10),colRadioDOMS=this._DOM.querySelectorAll(`input[data-column="${col}"]`);this._question.value===void 0&&(this._question.value={});let oldVal=this._question.value,newVal={[row]:col},inputRow,i;for(i=0;i<colRadioDOMS.length;i++)colRadioDOMS[i]!==e.currentTarget&&(colRadioDOMS[i].checked=!1,inputRow=colRadioDOMS[i].name,oldVal[inputRow]!==void 0&&oldVal[inputRow]!==col&&(newVal[inputRow]=oldVal[inputRow]));this._question.value=newVal,console.log(row,col,this._question.value)}_init(question,el){let t=performance.now(),CSS_CLASSES=this._CSS_CLASSES;if(question.css.matrix.mainRoot){let rootClass=`${question.css.matrix.mainRoot} ${question.cssClasses.withFrame||""}`;question.setCssRoot(rootClass),question.cssClasses.mainRoot=rootClass}let headerCells=`<th class="${CSS_CLASSES.TABLE_HEADER_CELL}">${question.columns[0].text}</th>
		<td></td>
		<td></td>
		<td></td>
		<th class="${CSS_CLASSES.TABLE_HEADER_CELL}">${question.columns[1].text}</th>`,bodyHTML="";for(let i=0;i<question.rows.length;i++){let bodyCells=`<td class="${CSS_CLASSES.TABLE_CELL}">
			<label class="${CSS_CLASSES.LABEL}">
				<input type="radio" class="${CSS_CLASSES.ITEM_VALUE}" name="${question.rows[i].value}" data-column=${question.columns[0].value}>
				<span class="${CSS_CLASSES.ITEM_DECORATOR}"></span>
			</label>
			</td>
			<td></td>
			<td class="${CSS_CLASSES.TABLE_CELL}">${question.rows[i].text}</td>
			<td></td>
			<td class="${CSS_CLASSES.TABLE_CELL}">
			<label class="${CSS_CLASSES.LABEL}">
				<input type="radio" class="${CSS_CLASSES.ITEM_VALUE}" name="${question.rows[i].value}" data-column=${question.columns[1].value}>
				<span class="${CSS_CLASSES.ITEM_DECORATOR}"></span>
			</label>
			</td>`;bodyHTML+=`<tr class="${CSS_CLASSES.TABLE_ROW}">${bodyCells}</tr>`}let html=`<table class="${CSS_CLASSES.TABLE}">
		<thead>
		<tr>${headerCells}</tr>
		</thead>
		<tbody>${bodyHTML}</tbody>
		</table>`;console.log("maxdiff matrix generation took",performance.now()-t),el.insertAdjacentHTML("beforeend",html);let inputDOMS=el.querySelectorAll("input");for(let i=0;i<inputDOMS.length;i++)inputDOMS[i].addEventListener("input",this._bindedHandlers._handleInput)}};function init6(Survey2){var widget={name:"maxdiffmatrix",title:"MaxDiff matrix",iconName:"",widgetIsLoaded:function(){return!0},isFit:function(question){return question.getType()==="maxdiffmatrix"},activatedByChanged:function(activatedBy){Survey2.JsonObject.metaData.addClass("maxdiffmatrix",[],null,"text"),Survey2.JsonObject.metaData.addProperties("maxdiffmatrix",[{name:"rows",isArray:!0,default:[]},{name:"columns",isArray:!0,default:[]}])},isDefaultRender:!1,htmlTemplate:"<div></div>",afterRender:function(question,el){console.log("MaxDiff mat",question.rows,question.columns),new MaxDiffMatrix({question,el})},willUnmount:function(question,el){}};Survey2.CustomWidgetCollection.Instance.addCustomWidget(widget,"customtype")}var SliderStar=class{constructor(cfg={}){let surveyCSS=cfg.question.css;this._CSS_CLASSES={INPUT_TEXT:"slider-star-text-input"},this._question=cfg.question,this._DOM=cfg.el,this._engagedInputIdx=void 0,this._pdowns={},this._bindedHandlers={_handleInput:this._handleInput.bind(this),_handlePointerDown:this._handlePointerDown.bind(this),_handlePointerUp:this._handlePointerUp.bind(this),_handlePointerMove:this._handlePointerMove.bind(this)},this._init(this._question,this._DOM)}_markStarsActive(n,qIdx){let stars=this._DOM.querySelectorAll(`.stars-container[data-idx="${qIdx}"] .star-slider-star-input`),i;for(i=0;i<stars.length;i++)stars[i].classList.remove("active"),i<=n-1&&stars[i].classList.add("active")}_handleIndividualValueUpdate(v,qIdx){this._question.value===void 0&&(this._question.value={}),this._question.value[qIdx]!==v&&(this._question.value[qIdx]=v,this._DOM.querySelector(`.slider-star-text-input[name="${qIdx}"]`).value=v,this._markStarsActive(v,qIdx),this._question.value=this._question.value)}_handleInput(e){let v=parseInt(e.currentTarget.value,10)||0;v=Math.max(0,Math.min(this._question.starCount,v));let qIdx=e.currentTarget.name;this._handleIndividualValueUpdate(v,qIdx)}_handlePointerDown(e){e.preventDefault(),this._engagedInputIdx=e.currentTarget.dataset.idx,this._pdowns[this._engagedInputIdx]=!0;let starIdx=[].indexOf.call(e.target.parentElement.children,e.target);this._handleIndividualValueUpdate(starIdx+1,this._engagedInputIdx)}_handlePointerUp(e){this._engagedInputIdx!==void 0&&(this._pdowns[this._engagedInputIdx]=!1),this._engagedInputIdx=void 0}_handlePointerMove(e){if(this._pdowns[this._engagedInputIdx]){e.preventDefault();let starIdx=[].indexOf.call(e.target.parentElement.children,e.target);this._handleIndividualValueUpdate(starIdx+1,this._engagedInputIdx)}}_init(question,el){let t=performance.now(),starsHTML=new Array(question.starCount).fill('<div class="star-slider-star-input">\u2605</div>').join(""),html="",i;for(i=0;i<question.choices.length;i++)html+=`<div class="star-slider-container">
			<div class="star-slider-title">${question.choices[i].text}</div>
			<div class="star-slider-inputs">
			<div class="stars-container" data-idx="${question.choices[i].value}">${starsHTML}</div>
			${question.showValue?`<input type="number" class="${this._CSS_CLASSES.INPUT_TEXT}" max="${question.starCount}" min="0" name="${question.choices[i].value}">`:""}
			</div>
			</div>`;el.insertAdjacentHTML("beforeend",html);let inputDOMS=el.querySelectorAll(".slider-star-text-input"),starsContainers=el.querySelectorAll(".stars-container");for(i=0;i<starsContainers.length;i++)inputDOMS[i].addEventListener("input",this._bindedHandlers._handleInput),starsContainers[i].addEventListener("pointerdown",this._bindedHandlers._handlePointerDown),starsContainers[i].addEventListener("pointermove",this._bindedHandlers._handlePointerMove);window.addEventListener("pointerup",this._bindedHandlers._handlePointerUp)}};function init7(Survey2){var widget={name:"sliderstar",title:"Slider Star",iconName:"",widgetIsLoaded:function(){return!0},isFit:function(question){return question.getType()==="sliderstar"},activatedByChanged:function(activatedBy){Survey2.JsonObject.metaData.addClass("sliderstar",[],null,"text"),Survey2.JsonObject.metaData.addProperties("sliderstar",[{name:"choices",isArray:!0,default:[]},{name:"starCount",default:5},{name:"showValue",default:!0},{name:"starType",default:"descrete"}])},isDefaultRender:!1,htmlTemplate:"<div></div>",afterRender:function(question,el){new SliderStar({question,el})},willUnmount:function(question,el){}};Survey2.CustomWidgetCollection.Instance.addCustomWidget(widget,"customtype")}function handleBipolarMatrixRendering(survey,options){let surveyCSS=options.question.css;options.htmlElement.querySelector("table").classList.add("matrix-bipolar");let rowsDOM=options.htmlElement.querySelectorAll("tbody tr"),rowCaptionsDOM=options.htmlElement.querySelectorAll("tbody tr td:nth-child(1) span"),captionsClassList=rowCaptionsDOM[0].classList,cellClassList=rowsDOM[0].children[0].classList,rowCaptions=new Array(options.question.rows.length),rowCaptionOppositeHTML="",i;for(i=0;i<rowCaptions.length;i++)rowCaptions[i]=options.question.rows[i].text.split(":"),rowCaptionsDOM[i].innerText=rowCaptions[i][0],rowCaptionOppositeHTML=`<td class="${cellClassList.value}"><span class="${captionsClassList.value}">${rowCaptions[i][1]}</span></td>`,rowsDOM[i].insertAdjacentHTML("beforeend",rowCaptionOppositeHTML)}var MatrixBipolar_default={registerSurveyProperties(Survey2){Survey2.Serializer.addProperty("matrix",{name:"subType:text",default:"",category:"general"})},registerModelCallbacks(surveyModel){surveyModel.onAfterRenderQuestion.add((survey,options)=>{options.question.getType()==="matrix"&&options.question.getPropertyValue("subType")==="bipolar"&&handleBipolarMatrixRendering(survey,options)})}};function handleValueChange(survey,options,e){options.question.value=e.currentTarget.value}function handleValueChangeForDOM(survey,options){options.htmlElement.querySelector("select").value=options.question.value}function handleDropdownRendering(survey,options){let surveyCSS=options.question.css,choices=options.question.getChoices(),optionsHTML='<option value=""></option>',i;for(i=0;i<choices.length;i++)optionsHTML+=`<option value="${choices[i].value}">${choices[i].text}</option>`;let selectHTML=`<select data-name="${options.question.name}" class="${surveyCSS.dropdown.control} dropdown-mobile">${optionsHTML}</select>`;options.htmlElement.querySelector(".sd-selectbase").insertAdjacentHTML("beforebegin",selectHTML),options.htmlElement.querySelector("select").addEventListener("change",handleValueChange.bind(this,survey,options)),options.question.valueChangedCallback=handleValueChangeForDOM.bind(this,survey,options)}var DropdownExtensions_default={registerModelCallbacks(surveyModel){surveyModel.onAfterRenderQuestion.add((survey,options)=>{options.question.getType()==="dropdown"&&handleDropdownRendering(survey,options)})}};var ExpressionFunctions=class{static rnd(){return Math.random()}static arrayContains(params){if(params[0]instanceof Array){let searchValue=params[1],searchResult=params[0].indexOf(searchValue)!==-1;return searchResult===!1&&(typeof searchValue=="string"?(searchValue=parseFloat(searchValue),searchResult=params[0].indexOf(searchValue)!==-1):typeof searchValue=="number"&&(searchValue=searchValue.toString(),searchResult=params[0].indexOf(searchValue)!==-1)),searchResult}return!1}static stringContains(params){return typeof params[0]=="string"?params[0].indexOf(params[1])!==-1:!1}static isEmpty(params){let questionIsEmpty=!1;return params[0]instanceof Array||typeof params[0]=="string"?questionIsEmpty=params[0].length===0:questionIsEmpty=params[0]===void 0||params[0]===null,questionIsEmpty}static isNotEmpty(params){return!ExpressionFunctions.isEmpty(params)}},customExpressionFunctions_default=[{func:ExpressionFunctions.rnd,isAsync:!1},{func:ExpressionFunctions.arrayContains,isAsync:!1},{func:ExpressionFunctions.stringContains,isAsync:!1},{func:ExpressionFunctions.isEmpty,isAsync:!1},{func:ExpressionFunctions.isNotEmpty,isAsync:!1}];var _Survey=class extends VisualStim{constructor({name,win,model,surveyId,pos,units,ori,size,depth,autoDraw,autoLog}={}){super({name,win,units,ori,depth,pos,size,autoDraw,autoLog});this._signaturePads=[],this.isFinished=!1,this._isCompletedAll=!0,this._questionAnswerTimestamps={},this._questionAnswerTimestampClock=new Clock,this._overallSurveyResults={},this._surveyData=void 0,this._surveyModel=void 0,this._expressionsRunner=void 0,this._lastPageSwitchHandledIdx=-1,this._variables={},this._surveyRunningPromise=void 0,this._surveyRunningPromiseResolve=void 0,this._surveyRunningPromiseReject=void 0,this._onFinishedCallback=()=>{},this._initSurveyJS(),typeof size=="undefined"&&(this.size=this.unit==="norm"?[2,2]:[1,1]),this._addAttribute("model",model),this._hasSelfGeneratedSurveyId=typeof surveyId=="undefined";let defaultSurveyId=this._psychoJS.getEnvironment()===ExperimentHandler.Environment.SERVER?makeUuid(`${name}@${this._psychoJS.config.gitlab.projectId}`):makeUuid(`${name}@${this._psychoJS.config.experiment.name}`);this._addAttribute("surveyId",surveyId,defaultSurveyId),this._estimateBoundingBox(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}get isCompleted(){return this.isFinished&&this._isCompletedAll}setModel(model,log3=!1){let response2={origin:"Survey.setModel",context:`when setting the model of Survey: ${this._name}`};try{if(typeof model=="undefined")this.psychoJS.logger.warn(`setting the model of Survey: ${this._name} with argument: undefined.`),this.psychoJS.logger.debug(`set the model of Survey: ${this._name} as: undefined`);else{if(typeof model=="string"){let encodedModel=this.psychoJS.serverManager.getResource(model),decodedModel=new TextDecoder("utf-8").decode(encodedModel);model=JSON.parse(decodedModel)}if(typeof model!="object")throw"model is neither the name of a resource nor an object";"surveyFlow"in model||(model={surveys:[model],embeddedData:[],surveysMap:{},questionMapsBySurvey:{},surveyFlow:{name:"root",type:"SEQUENTIAL_GROUP",nodes:[{type:"QUESTION_BLOCK",surveyIdx:0}]},surveySettings:{showPrevButton:!1},surveyRunLogic:{},inQuestionRandomization:{},questionsOrderRandomization:[],questionSkipLogic:{},questionsConverted:-1,questionsTotal:-1,logs:[]},this.psychoJS.logger.debug(`converted the legacy model to the new super-flow model: ${JSON.stringify(model)}`)),this._surveyData=model,this._setAttribute("model",model,log3),this._onChange(!0,!0)()}}catch(error){throw __spreadProps(__spreadValues({},response2),{error})}}setSurveyId(surveyId,log3=!1){this._setAttribute("surveyId",surveyId,log3),this._hasSelfGeneratedSurveyId||this.setModel(`${surveyId}.sid`,log3)}setVariables(variables,excludedNames){for(let name in variables)excludedNames.indexOf(name)===-1&&(this._variables[name]=variables[name])}evaluateExpression(expression){if(!(typeof expression=="undefined"||typeof this._surveyModel=="undefined"))return expression.indexOf("'")===-1&&expression.indexOf("{")===-1&&(expression=`'${expression}'`),this._surveyModel.runExpression(expression)}onFinished(callback){if(typeof this._surveyData=="undefined")throw{origin:"Survey.onFinished",context:"when setting a callback triggered when the participant finishes the survey",error:"the survey does not have a model"};typeof callback=="function"&&(this._onFinishedCallback=callback)}getResponse(){return this._overallSurveyResults}save(){this._psychoJS.logger.info("[PsychoJS] Save survey response.");let response2=this.getResponse();for(let field in this.psychoJS.experiment.extraInfo)_Survey.SURVEY_EXPERIMENT_PARAMETERS.indexOf(field)===-1&&(response2[field]=this.psychoJS.experiment.extraInfo[field]);for(let question in this._questionAnswerTimestamps)response2[`${question}_rt`]=this._questionAnswerTimestamps[question].timestamp;let sortedResponses=Object.keys(response2).sort().reduce((sorted,key)=>(sorted[key]=response2[key],sorted),{});if(this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER||this._psychoJS.config.experiment.status!=="RUNNING"||this._psychoJS._serverMsg.has("__pilotToken")){let filename=`survey_${this._surveyId}.json`,blob=new Blob([JSON.stringify(sortedResponses)],{type:"application/json"}),anchor=document.createElement("a");return anchor.href=window.URL.createObjectURL(blob),anchor.download=filename,document.body.appendChild(anchor),anchor.click(),document.body.removeChild(anchor),Promise.resolve({})}return this._hasSelfGeneratedSurveyId?this._psychoJS.serverManager.uploadSurveyResponse(this._surveyId,sortedResponses,this.isCompleted,this._surveyData):this._psychoJS.serverManager.uploadSurveyResponse(this._surveyId,sortedResponses,this.isCompleted)}hide(){let surveyDiv=document.getElementById(this._surveyDivId);surveyDiv!==null&&document.body.removeChild(surveyDiv),super.hide()}_estimateBoundingBox(){this._boundingBox=new Rectangle(this._pos[0]-this._size[0]/2,this._pos[1]-this._size[1]/2,this._size[0],this._size[1])}_updateIfNeeded(){!this._needUpdate||(this._needUpdate=!1,this._needPixiUpdate&&(this._needPixiUpdate=!1,document.getElementById(this._surveyDivId)===null&&document.body.insertAdjacentHTML("beforeend",`<div id=${this._surveyDivId} class='survey'></div>`),typeof this._surveyData!="undefined"&&this._runSurveyFlow(this._surveyData.surveyFlow,this._surveyData)))}_registerCustomExpressionFunctions(Survey2,customFuncs=[]){for(let i=0;i<customFuncs.length;i++)Survey2.FunctionFactory.Instance.register(customFuncs[i].func.name,customFuncs[i].func,customFuncs[i].isAsync)}_registerWidgets(Survey2){init3(Survey2),init4(Survey2),init5(Survey2),init6(Survey2),init7(Survey2)}_registerCustomSurveyProperties(Survey2){MatrixBipolar_default.registerSurveyProperties(Survey2),Survey2.Serializer.addProperty("signaturepad",{name:"maxSignatureWidth",type:"number",default:500})}_registerCustomComponentCallbacks(surveyModel){MatrixBipolar_default.registerModelCallbacks(surveyModel),DropdownExtensions_default.registerModelCallbacks(surveyModel)}_onQuestionValueChanged(survey,questionData){typeof this._questionAnswerTimestamps[questionData.name]=="undefined"&&(this._questionAnswerTimestamps[questionData.name]={timestamp:0}),this._questionAnswerTimestamps[questionData.name].timestamp=this._questionAnswerTimestampClock.getTime()}_composeModelWithRandomizedQuestions(surveyModel,inBlockRandomizationSettings){let t=performance.now(),questions=[],questionsMap={},newSurveyModel={pages:[{elements:new Array(inBlockRandomizationSettings.questionsPerPage)}]};for(let i=0;i<surveyModel.pages.length;i++)for(let j=0;j<surveyModel.pages[i].elements.length;j++){questions.push(surveyModel.pages[i].elements[j]);let k=questions.length-1;questionsMap[questions[k].name]=questions[k]}if(inBlockRandomizationSettings.layout.length>0){let j=0,k=0,curPage=0,curElement=0,shuffledSet0=shuffle(Array.from(inBlockRandomizationSettings.set0)),shuffledSet1=shuffle(Array.from(inBlockRandomizationSettings.set1));for(let i=0;i<inBlockRandomizationSettings.layout.length;i++)curElement===inBlockRandomizationSettings.questionsPerPage&&(newSurveyModel.pages.push({elements:new Array(inBlockRandomizationSettings.questionsPerPage)}),curPage++,curElement=0),inBlockRandomizationSettings.layout[i]==="set0"?(newSurveyModel.pages[curPage].elements[curElement]=questionsMap[shuffledSet0[j]],j++):inBlockRandomizationSettings.layout[i]==="set1"?(newSurveyModel.pages[curPage].elements[curElement]=questionsMap[shuffledSet1[k]],k++):newSurveyModel.pages[curPage].elements[curElement]=questionsMap[inBlockRandomizationSettings.layout[i]],curElement++}else if(inBlockRandomizationSettings.showOnly>0){let shuffledQuestions=shuffle(Array.from(questions));newSurveyModel.pages[0].elements=shuffledQuestions.splice(0,inBlockRandomizationSettings.showOnly)}else newSurveyModel.pages[0].elements=shuffle(Array.from(questions));return console.log("model recomposition took",performance.now()-t),console.log("recomposed model:",newSurveyModel),newSurveyModel}_applyInQuestionRandomization(questionData,inQuestionRandomizationSettings,surveyData){let t=performance.now(),choicesFieldName,valueFieldName;if(questionData.rows!==void 0?(choicesFieldName="rows",valueFieldName="value"):questionData.choices!==void 0?(choicesFieldName="choices",valueFieldName="value"):questionData.items!==void 0?(choicesFieldName="items",valueFieldName="name"):console.log("[Survey runner]: Uknown choicesFieldName for",questionData),inQuestionRandomizationSettings.randomizeAll)questionData[choicesFieldName]=shuffle(Array.from(questionData[choicesFieldName]));else if(inQuestionRandomizationSettings.showOnly>0)questionData[choicesFieldName]=shuffle(Array.from(questionData[choicesFieldName]).splice(0,inQuestionRandomizationSettings.showOnly));else if(inQuestionRandomizationSettings.reverse)questionData[choicesFieldName]=Math.round(Math.random())===1?questionData[choicesFieldName].reverse():questionData[choicesFieldName];else if(inQuestionRandomizationSettings.layout.length>0){let initialChoices=questionData[choicesFieldName],choicesMap={},setIndices=[0,0,0],i;for(i=0;i<questionData[choicesFieldName].length;i++)choicesMap[questionData[choicesFieldName][i][valueFieldName]]=questionData[choicesFieldName][i];questionData[choicesFieldName]=new Array(inQuestionRandomizationSettings.layout.length);let shuffledSet0=shuffle(Array.from(inQuestionRandomizationSettings.set0)),shuffledSet1=shuffle(Array.from(inQuestionRandomizationSettings.set1)),reversedSet=Math.round(Math.random())===1?inQuestionRandomizationSettings.reverseOrder.reverse():inQuestionRandomizationSettings.reverseOrder;for(i=0;i<inQuestionRandomizationSettings.layout.length;i++)inQuestionRandomizationSettings.layout[i]==="set0"?(questionData[choicesFieldName][i]=choicesMap[shuffledSet0[setIndices[0]]],setIndices[0]++):inQuestionRandomizationSettings.layout[i]==="set1"?(questionData[choicesFieldName][i]=choicesMap[shuffledSet1[setIndices[1]]],setIndices[1]++):inQuestionRandomizationSettings.layout[i]==="reverseOrder"?(questionData[choicesFieldName][i]=choicesMap[reversedSet[setIndices[2]]],setIndices[2]++):questionData[choicesFieldName][i]=choicesMap[inQuestionRandomizationSettings.layout[i]];inQuestionRandomizationSettings.layout.length<initialChoices.length&&(surveyData.unusedChoices===void 0&&(surveyData.unusedChoices={}),surveyData.unusedChoices[questionData.name]={set1:shuffledSet1.splice(setIndices[1],shuffledSet1.length)},console.log("unused choices",questionData.name,surveyData.unusedChoices[questionData.name]))}console.log("applying question randomization took",performance.now()-t)}_processSurveyData(surveyData,surveyIdx){let t=performance.now(),i,j,newSurveyModel;for(surveyData.questionsOrderRandomization[surveyIdx]!==void 0&&(newSurveyModel=this._composeModelWithRandomizedQuestions(surveyData.surveys[surveyIdx],surveyData.questionsOrderRandomization[surveyIdx])),i=0;i<surveyData.surveys[surveyIdx].pages.length;i++)for(j=0;j<surveyData.surveys[surveyIdx].pages[i].elements.length;j++)surveyData.inQuestionRandomization[surveyData.surveys[surveyIdx].pages[i].elements[j].name]!==void 0&&(newSurveyModel===void 0&&(newSurveyModel=JSON.parse(JSON.stringify(surveyData.surveys[surveyIdx]))),this._applyInQuestionRandomization(newSurveyModel.pages[i].elements[j],surveyData.inQuestionRandomization[newSurveyModel.pages[i].elements[j].name],surveyData));return newSurveyModel===void 0&&(newSurveyModel=surveyData.surveys[surveyIdx]),console.log("survey model preprocessing took",performance.now()-t),newSurveyModel}_onCurrentPageChanging(surveyModel,options){if(this._lastPageSwitchHandledIdx===options.oldCurrentPage.visibleIndex)return;this._lastPageSwitchHandledIdx=options.oldCurrentPage.visibleIndex;let questions=surveyModel.getCurrentPageQuestions(),lastQuestion=questions[questions.length-1],skipLogic=this._surveyData.questionSkipLogic[lastQuestion.name];if(skipLogic!==void 0&&(this._expressionsRunner.expressionExecutor.setExpression(skipLogic.expression),this._expressionsRunner.run(surveyModel.data)))if(options.allowChanging=!1,skipLogic.destination==="ENDOFSURVEY")surveyModel.setCompleted(),this._surveyRunningPromiseResolve(_Survey.SURVEY_COMPLETION_CODES.SKIP_TO_END_OF_SURVEY);else if(skipLogic.destination==="ENDOFBLOCK")surveyModel.setCompleted(),this._surveyRunningPromiseResolve(_Survey.SURVEY_COMPLETION_CODES.SKIP_TO_END_OF_BLOCK);else{let targetQuestion=surveyModel.getQuestionByName(skipLogic.destination),page=surveyModel.getPageByQuestion(targetQuestion),pageQuestions=page.questions,i;for(i=0;i<pageQuestions.length&&pageQuestions[i]!==targetQuestion;i++)pageQuestions[i].visible=!1;targetQuestion.focus(),surveyModel.currentPage=page}}_onSurveyComplete(surveyModel,options){Object.assign(this._overallSurveyResults,surveyModel.data);let completionCode=_Survey.SURVEY_COMPLETION_CODES.NORMAL,questions=surveyModel.getAllQuestions(),lastQuestion=questions[questions.length-1],skipLogic=this._surveyData.questionSkipLogic[lastQuestion.name];skipLogic!==void 0&&(this._expressionsRunner.expressionExecutor.setExpression(skipLogic.expression),this._expressionsRunner.run(surveyModel.data)&&(skipLogic.destination==="ENDOFSURVEY"?(completionCode=_Survey.SURVEY_COMPLETION_CODES.SKIP_TO_END_OF_SURVEY,surveyModel.setCompleted()):skipLogic.destination==="ENDOFBLOCK"&&(completionCode=_Survey.SURVEY_COMPLETION_CODES.SKIP_TO_END_OF_BLOCK))),surveyModel.stopTimer();let surveyVisibleQuestions=this._surveyModel.getAllQuestions(!0),nbAnsweredQuestions=surveyVisibleQuestions.reduce((count2,question)=>{let type=question.getType();return type==="html"||type==="ranking"||type==="checkbox"||type==="comment"||!question.isEmpty()?count2+1:count2},0);this._isCompletedAll=this._isCompletedAll&&nbAnsweredQuestions===surveyVisibleQuestions.length,this._isCompletedAll===!1&&this.psychoJS.logger.warn("Flag _isCompletedAll is false!"),this._surveyRunningPromiseResolve(completionCode)}_onFlowComplete(){this.isFinished=!0,this._onFinishedCallback()}_onTextMarkdown(survey,options){options.html=options.text}_beginSurvey(surveyData,surveyFlowBlock){this._lastPageSwitchHandledIdx=-1;let surveyIdx=surveyFlowBlock.surveyIdx,surveyModelInput=this._processSurveyData(surveyData,surveyIdx);this._surveyModel=new window.Survey.Model(surveyModelInput);for(let j in this._variables)this._surveyModel.variablesHash[j]=this._variables[j];this._surveyModel.isInitialized||(this._registerCustomComponentCallbacks(this._surveyModel),this._surveyModel.onValueChanged.add(this._onQuestionValueChanged.bind(this)),this._surveyModel.onCurrentPageChanging.add(this._onCurrentPageChanging.bind(this)),this._surveyModel.onComplete.add(this._onSurveyComplete.bind(this)),this._surveyModel.onTextMarkdown.add(this._onTextMarkdown.bind(this)),this._surveyModel.isInitialized=!0,this._surveyModel.onAfterRenderQuestion.add(this._handleAfterQuestionRender.bind(this)));let completeText=surveyIdx<this._surveyData.surveys.length-1?this._surveyModel.pageNextText||_Survey.CAPTIONS.NEXT:void 0;return jQuery(".survey").Survey(__spreadValues({model:this._surveyModel,showItemsInOrder:"column",completeText},surveyData.surveySettings)),this._questionAnswerTimestampClock.reset(),this._surveyModel.startTimer(),this._surveyRunningPromise=new Promise((res,rej)=>{this._surveyRunningPromiseResolve=res,this._surveyRunningPromiseReject=rej}),this._surveyRunningPromise}async _runSurveyFlow(surveyBlock,surveyData,prevBlockResults={}){let nodeExitCode=_Survey.NODE_EXIT_CODES.NORMAL;if(surveyBlock.type===_Survey.SURVEY_FLOW_PLAYBACK_TYPES.CONDITIONAL){let dataset=Object.assign({},this._overallSurveyResults,this._variables);this._expressionsRunner.expressionExecutor.setExpression(surveyBlock.condition),this._expressionsRunner.run(dataset)&&surveyBlock.nodes[0]!==void 0?nodeExitCode=await this._runSurveyFlow(surveyBlock.nodes[0],surveyData,prevBlockResults):surveyBlock.nodes[1]!==void 0&&(nodeExitCode=await this._runSurveyFlow(surveyBlock.nodes[1],surveyData,prevBlockResults))}else if(surveyBlock.type===_Survey.SURVEY_FLOW_PLAYBACK_TYPES.RANDOMIZER)shuffle(surveyBlock.nodes,Math.random,0,surveyBlock.nodes.length-1);else if(surveyBlock.type===_Survey.SURVEY_FLOW_PLAYBACK_TYPES.EMBEDDED_DATA){let t=performance.now(),surveyBlockData=surveyData.embeddedData[surveyBlock.dataIdx];for(let j=0;j<surveyBlockData.length;j++)surveyBlockData[j].type==="Custom"&&(this._expressionsRunner.expressionExecutor.setExpression(surveyBlockData[j].value),this._expressionsRunner.expressionExecutor.canRun()?this._variables[surveyBlockData[j].key]=this._expressionsRunner.run(this._variables):this._variables[surveyBlockData[j].key]=surveyBlockData[j].value);console.log("embedded data variables accumulation took",performance.now()-t)}else if(surveyBlock.type===_Survey.SURVEY_FLOW_PLAYBACK_TYPES.ENDSURVEY)this._surveyModel&&this._surveyModel.setCompleted(),console.log("EndSurvey block encountered, exiting."),nodeExitCode=_Survey.NODE_EXIT_CODES.BREAK_FLOW;else if(surveyBlock.type===_Survey.SURVEY_FLOW_PLAYBACK_TYPES.DIRECT){let surveyCompletionCode=await this._beginSurvey(surveyData,surveyBlock);Object.assign({},prevBlockResults,this._surveyModel.data),surveyCompletionCode===_Survey.SURVEY_COMPLETION_CODES.SKIP_TO_END_OF_SURVEY&&(nodeExitCode=_Survey.NODE_EXIT_CODES.BREAK_FLOW)}if(nodeExitCode===_Survey.NODE_EXIT_CODES.NORMAL&&surveyBlock.type!==_Survey.SURVEY_FLOW_PLAYBACK_TYPES.CONDITIONAL&&surveyBlock.nodes instanceof Array)for(let i=0;i<surveyBlock.nodes.length&&(nodeExitCode=await this._runSurveyFlow(surveyBlock.nodes[i],surveyData,prevBlockResults),nodeExitCode!==_Survey.NODE_EXIT_CODES.BREAK_FLOW);i++);return surveyBlock.name==="root"&&this._onFlowComplete(),nodeExitCode}_resetState(){this._lastPageSwitchHandledIdx=-1}_handleWindowResize(e){if(this._surveyModel)for(let i=this._signaturePads.length-1;i>=0;i--)this._signaturePads[i].question.signaturePad?this._signaturePads[i].question.signatureWidth=Math.min(this._signaturePads[i].question.maxSignatureWidth,this._signaturePads[i].htmlElement.getBoundingClientRect().width):this._signaturePads.splice(i,1)}_addEventListeners(){window.addEventListener("resize",e=>this._handleWindowResize(e))}_handleAfterQuestionRender(sender,options){options.question.getType()==="signaturepad"&&(this._signaturePads.push(options),options.question.signatureWidth=Math.min(options.question.maxSignatureWidth,options.htmlElement.getBoundingClientRect().width))}_initSurveyJS(){this._surveyDivId=`survey-${this._name}`,this._registerCustomExpressionFunctions(window.Survey,customExpressionFunctions_default),this._registerWidgets(window.Survey),this._registerCustomSurveyProperties(window.Survey),this._addEventListeners(),this._expressionsRunner=new window.Survey.ExpressionRunner,window.Survey.Serializer.getProperty("expression","minWidth").defaultValue="100px",window.Survey.settings.minWidth="100px",window.Survey.StylesManager.applyTheme("defaultV2")}},Survey=_Survey;__publicField(Survey,"SURVEY_EXPERIMENT_PARAMETERS",["surveyId","showStartDialog","showEndDialog","completionUrl","cancellationUrl","quitOnEsc"]),__publicField(Survey,"SURVEY_FLOW_PLAYBACK_TYPES",{DIRECT:"QUESTION_BLOCK",CONDITIONAL:"IF_THEN_ELSE_GROUP",EMBEDDED_DATA:"VARIABLES",RANDOMIZER:"RANDOM_GROUP",SEQUENTIAL:"SEQUENTIAL_GROUP",ENDSURVEY:"END"}),__publicField(Survey,"CAPTIONS",{NEXT:"Next"}),__publicField(Survey,"SURVEY_COMPLETION_CODES",{NORMAL:0,SKIP_TO_END_OF_BLOCK:1,SKIP_TO_END_OF_SURVEY:2}),__publicField(Survey,"NODE_EXIT_CODES",{NORMAL:0,BREAK_FLOW:1});var DEFAULT_POOL_SIZE=1024,DEFAULT_PARTICLE_WIDTH=10,DEFAULT_PARTICLE_HEIGHT=10,DEFAULT_PARTICLE_LIFETIME=3,DEFAULT_PARTICLE_COLOR=16777215,DEFAULT_PARTICLES_PER_SEC=60,DEFAULT_PARTICLE_V=100,Particle=class{constructor(cfg){this.x=0,this.y=0,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.lifeTime=0,this.widthChange=0,this.heightChange=0,this.sprite=void 0,this.inUse=!1,cfg.particleImage!==void 0?this.sprite=Sprite.from(Texture.from(cfg.particleImage)):(this.sprite=new Sprite(Texture.WHITE),this.sprite.tint=cfg.particleColor||DEFAULT_PARTICLE_COLOR),this.sprite.anchor.set(.5),this.width=cfg.particleWidth||DEFAULT_PARTICLE_WIDTH,this.height=cfg.particleHeight||DEFAULT_PARTICLE_HEIGHT}set width(w){this._width=w,this.sprite.width=w}get width(){return this._width}set height(h){this._height=h,this.sprite.height=h}get height(){return this._height}update(dt){let dt2=dt*dt;this.vx+=this.ax*dt,this.vy+=this.ay*dt,this.x=this.x+this.vx*dt+this.ax*dt2*.5,this.y=this.y+this.vy*dt+this.ay*dt2*.5,this.sprite.rotation=Math.atan2(this.vy,this.vx),this.sprite.x=this.x,this.sprite.y=this.y,this.width>0&&(this.width=Math.max(0,this.width+this.widthChange)),this.height>0&&(this.height=Math.max(0,this.height+this.heightChange)),this.lifeTime-=dt,this.width<=0&&this.height<=0&&(this.lifeTime=0),this.lifeTime<=0&&(this.inUse=!1)}},ParticleEmitter=class{constructor(cfg={}){this.x=0,this.y=0,this._cfg=cfg,this._particlesPerSec=cfg.particlesPerSec||DEFAULT_PARTICLES_PER_SEC,this._spawnCoolDown=0,this._parentObj=void 0,this._particlePool=new Array(DEFAULT_POOL_SIZE),this.setParentObject(cfg.parentObject),this._fillParticlePool(cfg)}_fillParticlePool(cfg){let i;for(i=0;i<this._particlePool.length;i++)this._particlePool[i]=new Particle(cfg)}_setupParticle(p){let spawnAreaWidth=this._cfg.spawnAreaWidth||0,spawnAreaHeight=this._cfg.spawnAreaHeight||0;this._parentObj!==void 0&&this._cfg.useParentSizeAsSpawnArea&&(spawnAreaWidth=this._parentObj.width,spawnAreaHeight=this._parentObj.height);let spawnOffsetX=Math.random()*spawnAreaWidth-spawnAreaWidth*.5,spawnOffsetY=Math.random()*spawnAreaHeight-spawnAreaHeight*.5,x=this.x+spawnOffsetX,y=this.y+spawnOffsetY;p.x=x,p.y=y,p.ax=0,p.ay=0,Number.isFinite(this._cfg.initialVx)?p.vx=this._cfg.initialVx:this._cfg.initialVx instanceof Array&&this._cfg.initialVx.length>=2?p.vx=Math.random()*(this._cfg.initialVx[1]-this._cfg.initialVx[0])+this._cfg.initialVx[0]:p.vx=Math.random()*DEFAULT_PARTICLE_V-DEFAULT_PARTICLE_V*.5,Number.isFinite(this._cfg.initialVy)?p.vy=this._cfg.initialVy:this._cfg.initialVy instanceof Array&&this._cfg.initialVy.length>=2?p.vy=Math.random()*(this._cfg.initialVy[1]-this._cfg.initialVy[0])+this._cfg.initialVy[0]:p.vy=Math.random()*DEFAULT_PARTICLE_V-DEFAULT_PARTICLE_V*.5,p.lifeTime=this._cfg.lifeTime||DEFAULT_PARTICLE_LIFETIME,p.width=this._cfg.particleWidth||DEFAULT_PARTICLE_WIDTH,p.height=this._cfg.particleHeight||DEFAULT_PARTICLE_HEIGHT,p.widthChange=this._cfg.particleWidthChange||0,p.heightChange=this._cfg.particleHeightChange||0,this._cfg.particleImage?p.sprite.texture=Texture.from(this._cfg.particleImage):p.sprite.texture=Texture.WHITE,this._cfg.particleColor!==void 0?p.sprite.tint=this._cfg.particleColor:p.sprite.tint=16777215}_spawnParticles(n=0){let i;for(i=0;i<this._particlePool.length&&n>0;i++)this._particlePool[i].inUse===!1&&(this._particlePool[i].inUse=!0,n--,this._setupParticle(this._particlePool[i]),this._cfg.container.addChild(this._particlePool[i].sprite))}_getResultingExternalForce(){let externalForce=[0,0];if(this._cfg.externalForces instanceof Array){let i;for(i=0;i<this._cfg.externalForces.length;i++)externalForce[0]+=this._cfg.externalForces[i][0],externalForce[1]+=this._cfg.externalForces[i][1]}return externalForce}setParentObject(po){this._parentObj=po}addExternalForce(f){this._cfg.externalForces.push(f)}removeExternalForce(f){let i=this._cfg.externalForces.indexOf(f);i!==-1&&this._cfg.externalForces.splice(i,1)}removeExternalForceByIdx(idx){this._cfg.externalForces[idx]!==void 0&&this._cfg.externalForces.splice(idx,1)}update(dt){let externalForce;if(this._parentObj!==void 0&&(this.x=this._parentObj.x,this.y=this._parentObj.y),Number.isFinite(this._cfg.positionOffsetX)&&(this.x+=this._cfg.positionOffsetX),Number.isFinite(this._cfg.positionOffsetY)&&(this.y+=this._cfg.positionOffsetY),this._spawnCoolDown<=0){this._spawnCoolDown=1/this._particlesPerSec;let frameTime=Math.min(dt,1/60),particlesPerFrame=Math.ceil(frameTime/this._spawnCoolDown);this._spawnParticles(particlesPerFrame)}else this._spawnCoolDown-=dt;let i;for(i=0;i<this._particlePool.length;i++)this._particlePool[i].inUse&&(externalForce=this._getResultingExternalForce(),this._particlePool[i].ax=externalForce[0],this._particlePool[i].ay=externalForce[1],this._particlePool[i].update(dt)),this._particlePool[i].lifeTime<=0&&this._particlePool[i].sprite.parent&&this._cfg.container.removeChild(this._particlePool[i].sprite)}};var Progress=class extends VisualStim{constructor({name,win,units="pix",ori,opacity,depth,pos,anchor="left",size=[300,30],clipMask,autoDraw,autoLog,progress=1,type,fillColor,fillTexture}){super({name,win,units,ori,opacity,depth,pos,anchor,size,clipMask,autoDraw,autoLog});this._addAttribute("progress",progress,0),this._addAttribute("type",type,PROGRESS_TYPES.BAR),this._addAttribute("fillColor",fillColor,"lightgreen"),this._addAttribute("fillTexture",fillTexture,Texture.WHITE),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}setProgress(progress=0,log3=!1){if(this._setAttribute("progress",Math.min(1,Math.max(0,progress)),log3),this._pixi!==void 0){this._pixi.clear();let size_px=to_px(this._size,this._units,this._win),progressWidth=size_px[0]*this._progress;if(this._fillTexture){let t=Texture.WHITE;typeof this._fillTexture=="string"&&(t=Texture.from(this._fillTexture),t.baseTexture.scaleMode=SCALE_MODES2.NEAREST),this._pixi.beginTextureFill({texture:t})}else this._pixi.beginFill(new Color(this._fillColor).int,this._opacity);this._type===PROGRESS_TYPES.BAR&&this._pixi.drawRect(0,0,progressWidth,size_px[1]),this._pixi.endFill(),this.anchor=this._anchor}}_estimateBoundingBox(){let boundingBox=new Rectangle(0,0,0,0),anchorNum=this._anchorTextToNum(this._anchor),pos_px=to_px(this._pos,this._units,this._win),size_px=to_px(this._size,this._units,this._win);boundingBox.x=pos_px[0]-anchorNum[0]*size_px[0],boundingBox.y=pos_px[1]-anchorNum[1]*size_px[1],boundingBox.width=size_px[0],boundingBox.height=size_px[1],this._boundingBox=boundingBox}_updateIfNeeded(){!this._needUpdate||(this._needUpdate=!1,this._needPixiUpdate&&(this._needPixiUpdate=!1,typeof this._pixi!="undefined"&&this._pixi.destroy(!0),this._pixi=new Graphics,this.setProgress(this._progress),this._pixi.scale.y=-1,this._pixi.zIndex=-this._depth,this.anchor=this._anchor),this._pixi.position=to_pixiPoint(this._pos,this._units,this._win),this._pixi.rotation=-this.ori*Math.PI/180,this._estimateBoundingBox())}},PROGRESS_TYPES={BAR:0,CIRCLE:1};var sound_exports={};__export(sound_exports,{AudioClip:()=>AudioClip,AudioClipPlayer:()=>AudioClipPlayer,Microphone:()=>Microphone,Sound:()=>Sound2,SoundPlayer:()=>SoundPlayer,SpeechRecognition:()=>SpeechRecognition,TonePlayer:()=>TonePlayer,TrackPlayer:()=>TrackPlayer,Transcript:()=>Transcript});var AudioClip=class extends PsychObject{constructor({psychoJS,name,sampleRateHz,format:format3,data,autoLog}={}){super(psychoJS);this._addAttribute("name",name,"audioclip"),this._addAttribute("format",format3),this._addAttribute("sampleRateHz",sampleRateHz),this._addAttribute("data",data),this._addAttribute("autoLog",!1,autoLog),this._addAttribute("status",AudioClip.Status.CREATED),this._addAttribute("volume",1),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`),this._decodeAudio()}setVolume(volume){this._volume=volume}async startPlayback(){this._psychoJS.logger.debug("request to play the audio clip"),await this._decodeAudio(),this._source=this._audioContext.createBufferSource(),this._source.buffer=this._audioBuffer,this._gainNode=this._audioContext.createGain(),this._source.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),this._gainNode.gain.value=this._volume,this._source.start()}async stopPlayback(fadeDuration=17){this._source.stop()}async getDuration(){return await this._decodeAudio(),this._audioBuffer.duration}upload(){this._psychoJS.logger.debug("request to upload the audio clip to pavlovia.org");let filename=this._name+extensionFromMimeType(this._format);return this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER||this._psychoJS.config.experiment.status!=="RUNNING"||this._psychoJS._serverMsg.has("__pilotToken")?this.download(filename):this._psychoJS.serverManager.uploadAudioVideo({mediaBlob:this._data,tag:filename})}download(filename="audio.webm"){let anchor=document.createElement("a");anchor.href=window.URL.createObjectURL(this._data),anchor.download=filename,document.body.appendChild(anchor),anchor.click(),document.body.removeChild(anchor)}async transcribe({engine,languageCode}={}){let response2={origin:"AudioClip.transcribe",context:`when transcribing audio clip: ${this._name}`};this._psychoJS.logger.debug(response2);let fullEngineName=`sound.AudioClip.Engine.${Symbol.keyFor(engine)}`,transcriptionKey;for(let key of this._psychoJS.config.experiment.keys)key.name===fullEngineName&&(transcriptionKey=key.value);if(typeof transcriptionKey=="undefined")throw __spreadProps(__spreadValues({},response2),{error:`missing key for engine: ${fullEngineName}`});if(await this._decodeAudio(),engine===AudioClip.Engine.GOOGLE)return this._GoogleTranscribe(transcriptionKey,languageCode);throw __spreadProps(__spreadValues({},response2),{error:`unsupported speech-to-text engine: ${engine}`})}_GoogleTranscribe(transcriptionKey,languageCode){return new Promise(async(resolve4,reject2)=>{let buffer=new ArrayBuffer(this._audioData.length*2),uint16View=new Uint16Array(buffer);for(let t=0;t<this._audioData.length;++t)uint16View[t]=this._audioData[t]<0?this._audioData[t]*32768:this._audioData[t]*32767;let base64Data=this._base64ArrayBuffer(new Uint8Array(buffer)),body={config:{encoding:"LINEAR16",sampleRateHertz:this._sampleRateHz,languageCode},audio:{content:base64Data}},url3=`https://speech.googleapis.com/v1/speech:recognize?key=${transcriptionKey}`,decodedResponse=await(await fetch(url3,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)})).json();this._psychoJS.logger.debug("speech.googleapis.com response:",JSON.stringify(decodedResponse)),"results"in decodedResponse&&decodedResponse.results.length>0?resolve4(decodedResponse.results[0].alternatives[0]):resolve4({transcript:"",confidence:-1})})}_decodeAudio(){if(this._psychoJS.logger.debug("request to decode the data of the audio clip"),this._status===AudioClip.Status.READY)return;if(this._status===AudioClip.Status.DECODING){let self2=this;return new Promise(function(resolve4,reject2){self2._decodingCallbacks.push(resolve4)}.bind(this))}this._status=AudioClip.Status.DECODING,this._audioData=null,this._source=null,this._gainNode=null,this._decodingCallbacks=[],this._audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:this._sampleRateHz});let reader=new window.FileReader;reader.onloadend=async()=>{try{this._audioBuffer=await this._audioContext.decodeAudioData(reader.result),this._audioData=this._audioBuffer.getChannelData(0),this._status=AudioClip.Status.READY;for(let callback of this._decodingCallbacks)callback()}catch(error){console.error(error)}},reader.onerror=error=>{},reader.readAsArrayBuffer(this._data)}_base64ArrayBuffer(arrayBuffer){let base64="",encodings2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bytes=new Uint8Array(arrayBuffer),byteLength=bytes.byteLength,byteRemainder=byteLength%3,mainLength=byteLength-byteRemainder,a,b,c,d,chunk;for(let i=0;i<mainLength;i+=3)chunk=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2],a=(chunk&16515072)>>18,b=(chunk&258048)>>12,c=(chunk&4032)>>6,d=chunk&63,base64+=encodings2[a]+encodings2[b]+encodings2[c]+encodings2[d];return byteRemainder===1?(chunk=bytes[mainLength],a=(chunk&252)>>2,b=(chunk&3)<<4,base64+=`${encodings2[a]}${encodings2[b]}==`):byteRemainder===2&&(chunk=bytes[mainLength]<<8|bytes[mainLength+1],a=(chunk&64512)>>10,b=(chunk&1008)>>4,c=(chunk&15)<<2,base64+=`${encodings2[a]}${encodings2[b]}${encodings2[c]}=`),base64}};AudioClip.Engine={GOOGLE:Symbol.for("GOOGLE")};AudioClip.Status={CREATED:Symbol.for("CREATED"),DECODING:Symbol.for("DECODING"),READY:Symbol.for("READY")};var SoundPlayer=class extends PsychObject{constructor(psychoJS){super(psychoJS)}play(loops){throw{origin:"SoundPlayer.play",context:"when starting the playback of a sound",error:"this method is abstract and should not be called."}}stop(){throw{origin:"SoundPlayer.stop",context:"when stopping the playback of a sound",error:"this method is abstract and should not be called."}}getDuration(){throw{origin:"SoundPlayer.getDuration",context:"when getting the duration of the sound",error:"this method is abstract and should not be called."}}setDuration(duration_s){throw{origin:"SoundPlayer.setDuration",context:"when setting the duration of the sound",error:"this method is abstract and should not be called."}}setLoops(loops){throw{origin:"SoundPlayer.setLoops",context:"when setting the number of loops",error:"this method is abstract and should not be called."}}setVolume(volume,mute=!1){throw{origin:"SoundPlayer.setVolume",context:"when setting the volume of the sound",error:"this method is abstract and should not be called."}}};var AudioClipPlayer=class extends SoundPlayer{constructor({psychoJS,audioClip,startTime=0,stopTime=-1,stereo=!0,volume=0,loops=0}={}){super(psychoJS);this._addAttribute("audioClip",audioClip),this._addAttribute("startTime",startTime),this._addAttribute("stopTime",stopTime),this._addAttribute("stereo",stereo),this._addAttribute("loops",loops),this._addAttribute("volume",volume),this._currentLoopIndex=-1}static accept(psychoJS,value){return value instanceof AudioClip?{audioClip:value}:!1}getDuration(){return this._audioClip.getDuration()}setDuration(duration_s){throw{origin:"AudioClipPlayer.setDuration",context:"when setting the duration of the playback for audio clip player: "+this._name,error:"not implemented yet"}}setVolume(volume,mute=!1){this._volume=volume,this._audioClip.setVolume(mute?0:volume)}setLoops(loops){this._loops=loops,this._currentLoopIndex=-1}setAudioClip(audioClip){audioClip instanceof AudioClip&&(this._audioClip!==void 0&&this.stop(),this._audioClip=audioClip)}play(loops,fadeDuration=17){typeof loops!="undefined"&&this.setLoops(loops),loops>0,this._audioClip.startPlayback()}stop(fadeDuration=17){this._audioClip.stopPlayback(fadeDuration)}};var TonePlayer=class extends SoundPlayer{constructor({psychoJS,note="C4",secs=.5,volume=1,loops=0,soundLibrary=TonePlayer.SoundLibrary.TONE_JS,autoLog=!0}={}){super(psychoJS);this._addAttribute("note",note),this._addAttribute("duration_s",secs),this._addAttribute("volume",volume),this._addAttribute("loops",loops),this._addAttribute("soundLibrary",soundLibrary),this._addAttribute("autoLog",autoLog),this._initSoundLibrary(),this._toneLoop=null,this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}static accept(value,octave){if(isNumeric(value))return{note:value};if(typeof value=="string"){let psychopyToToneMap=new Map;for(let note2 of["A","B","C","D","E","F","G"])psychopyToToneMap.set(note2,note2),psychopyToToneMap.set(note2+"fl",note2+"b"),psychopyToToneMap.set(note2+"sh",note2+"#");let note=psychopyToToneMap.get(value);if(typeof note!="undefined")return{note:note+octave}}return!1}getDuration(){return this.duration_s}setDuration(secs){this.duration_s=secs}setLoops(loops){this._loops=loops}setVolume(volume,mute=!1){this._volume=volume,this._soundLibrary===TonePlayer.SoundLibrary.TONE_JS&&typeof this._volumeNode!="undefined"&&(this._volumeNode.mute=mute,this._volumeNode.volume.value=-60+volume*66)}setTone(value="C",octave=4){let args=TonePlayer.accept(value,octave);this._note=args.note,typeof this._synth!="undefined"&&this._synth.setNote(this._note)}play(loops){typeof loops!="undefined"&&(this._loops=loops);let actualDuration_s=this._duration_s===-1?1e6:this._duration_s,self2=this,playToneCallback;this._soundLibrary===TonePlayer.SoundLibrary.TONE_JS?playToneCallback=()=>{self2._synth.triggerAttackRelease(self2._note,actualDuration_s,context3.currentTime)}:playToneCallback=()=>{self2._webAudioOscillator=self2._audioContext.createOscillator(),self2._webAudioOscillator.type="sine",self2._webAudioOscillator.frequency.value=440,self2._webAudioOscillator.connect(self2._audioContext.destination);let contextCurrentTime=self2._audioContext.currentTime;self2._webAudioOscillator.start(contextCurrentTime),self2._webAudioOscillator.stop(contextCurrentTime+actualDuration_s)},this.loops===0?playToneCallback():this.loops===-1?this._toneId=Transport2.scheduleRepeat(playToneCallback,this.duration_s,now(),Infinity):this._toneId=Transport2.scheduleRepeat(playToneCallback,this.duration_s,now(),this.duration_s*(this._loops+1))}stop(){if(this._soundLibrary===TonePlayer.SoundLibrary.TONE_JS)this._synth.triggerRelease(),this._toneId&&Transport2.clear(this._toneId);else{let contextCurrentTime=this._audioContext.currentTime;this._webAudioOscillator.stop(contextCurrentTime)}}_initSoundLibrary(){let response2={origin:"TonePlayer._initSoundLibrary",context:"when initialising the sound library"};if(this._soundLibrary===TonePlayer.SoundLibrary.TONE_JS){if(typeof esm_exports=="undefined")throw Object.assign(response2,{error:"Tone.js is not available. A different sound library must be selected. Please contact the experiment designer."});typeof esm_exports!="undefined"&&Transport2.state!=="started"&&(this.psychoJS.logger.info("[PsychoJS] start Tone Transport"),Transport2.start(now()),context3.lookAhead=0),this._synthOtions={oscillator:{type:"square"},envelope:{attack:.001,decay:.001,sustain:1,release:.001}},this._synth=new Synth(this._synthOtions),this._volumeNode=new Volume(-60+this._volume*66),this._synth.connect(this._volumeNode),typeof this._volumeNode.toDestination=="function"?this._volumeNode.toDestination():this._volumeNode.toMaster()}else if(typeof this._audioContext=="undefined"){let AudioContext2=window.AudioContext||window.webkitAudioContext;if(typeof AudioContext2=="undefined")throw Object.assign(response2,{error:`AudioContext is not available on your browser, ${this._psychoJS.browser}, please contact the experiment designer.`});this._audioContext=new AudioContext2}}};TonePlayer.SoundLibrary={AUDIO_CONTEXT:Symbol.for("AUDIO_CONTEXT"),TONE_JS:Symbol.for("TONE_JS")};var import_howler2=__toModule(require_howler());var TrackPlayer=class extends SoundPlayer{constructor({psychoJS,howl,startTime=0,stopTime=-1,stereo=!0,volume=0,loops=0}={}){super(psychoJS);this._addAttribute("howl",howl),this._addAttribute("startTime",startTime),this._addAttribute("stopTime",stopTime),this._addAttribute("stereo",stereo),this._addAttribute("loops",loops),this._addAttribute("volume",volume),this._currentLoopIndex=-1}static checkValueSupport(value){return typeof value=="string"}static accept(psychoJS,value){if(typeof value=="string"){let howl=psychoJS.serverManager.getResource(value);if(typeof howl!="undefined")return{howl}}return!1}getDuration(){return this._howl.duration()}setDuration(duration_s){typeof this._howl!="undefined"&&(this._howl._duration=duration_s)}setVolume(volume,mute=!1){this._volume=volume,this._howl.volume(volume),this._howl.mute(mute)}setLoops(loops){this._loops=loops,this._currentLoopIndex=-1,loops===0?this._howl.loop(!1):this._howl.loop(!0)}setTrack(track){let newHowl;typeof track=="string"?newHowl=this.psychoJS.serverManager.getResource(track):track instanceof import_howler2.Howl&&(newHowl=track),newHowl!==void 0&&(this._howl.once("fade",id=>{this._howl.stop(id),this._howl.off("end"),this._howl=newHowl}),this._howl.fade(this._howl.volume(),0,17,this._id))}play(loops,fadeDuration=17){if(typeof loops!="undefined"&&this.setLoops(loops),loops>0){let self2=this;this._howl.on("end",event=>{++this._currentLoopIndex,self2._currentLoopIndex>self2._loops?self2.stop():(self2._howl.seek(self2._startTime),self2._id=self2._howl.play(),self2._howl.fade(0,self2._volume,fadeDuration,self2._id))})}this._howl.seek(this._startTime),this._id=this._howl.play(),this._howl.fade(0,this._volume,fadeDuration,this._id)}stop(fadeDuration=17){this._howl.once("fade",id=>{this._howl.stop(id),this._howl.off("end")}),this._howl.fade(this._howl.volume(),0,fadeDuration,this._id)}};var Sound2=class extends PsychObject{constructor({name,win,value="C",octave=4,secs=.5,startTime=0,stopTime=-1,stereo=!0,volume=1,loops=0,autoLog=!0}={}){super(win._psychoJS,name);this._player=void 0,this._addAttribute("win",win),this._addAttribute("octave",octave),this._addAttribute("secs",secs),this._addAttribute("startTime",startTime),this._addAttribute("stopTime",stopTime),this._addAttribute("stereo",stereo),this._addAttribute("volume",volume),this._addAttribute("loops",loops),this._addAttribute("autoLog",autoLog),this._addAttribute("value",value),this.status=PsychoJS.Status.NOT_STARTED}play(loops,log3=!0){this.status=PsychoJS.Status.STARTED,this._player.play(loops)}stop({log:log3=!0}={}){this._player.stop(),this.status=PsychoJS.Status.STOPPED}getDuration(){return this._player.getDuration()}setVolume(volume,mute=!1,log3=!0){this._setAttribute("volume",volume,log3),typeof this._player!="undefined"&&this._player.setVolume(volume,mute)}setSound(sound,log3=!0){if(!(sound instanceof Sound2))throw{origin:"Sound.setSound",context:"when setting the sound",error:"the argument should be an instance of the Sound class."};return this._setAttribute("value",sound.value,log3),typeof this._player!="undefined"&&(this._player=this._player.constructor.accept(this)),this}setValue(value="C",octave=4,log3=!0){this._setAttribute("value",value,log3);let args={psychoJS:this._psychoJS,stereo:this._stereo,volume:this._volume,loops:this._loops,startTime:this._startTime,stopTime:this._stopTime,secs:this._secs},playerArgs=TonePlayer.accept(value,octave);if(playerArgs){this._player instanceof TonePlayer?this._player.setTone(value,octave):this._player=new TonePlayer(Object.assign(args,playerArgs));return}if(playerArgs=TrackPlayer.accept(this._psychoJS,value),playerArgs){this._player instanceof TrackPlayer?this._player.setTrack(value):this._player=new TrackPlayer(Object.assign(args,playerArgs));return}if(playerArgs=AudioClipPlayer.accept(this._psychoJS,value),playerArgs){this._player instanceof AudioClipPlayer?this._player.setAudioClip(value):this._player=new AudioClipPlayer(Object.assign(args,playerArgs));return}throw{origin:"Sound.setValue",context:"when setting the sound value",error:"could not find an appropriate player."}}setLoops(loops=0,log3=!0){this._setAttribute("loops",loops,log3),typeof this._player!="undefined"&&this._player.setLoops(loops)}setSecs(secs=.5,log3=!0){this._setAttribute("secs",secs,log3),typeof this._player!="undefined"&&this._player.setDuration(secs)}_getPlayer(){let acceptFns=[sound=>TonePlayer.accept(sound),sound=>TrackPlayer.accept(sound),sound=>AudioClipPlayer.accept(sound)];for(let acceptFn of acceptFns)if(this._player=acceptFn(this),typeof this._player!="undefined")return this._player;throw{origin:"SoundPlayer._getPlayer",context:"when finding a player for the sound",error:"could not find an appropriate player."}}};var Microphone=class extends PsychObject{constructor({win,name,format:format3,sampleRateHz,clock,autoLog}={}){super(win._psychoJS);this._addAttribute("win",win,void 0),this._addAttribute("name",name,"microphone"),this._addAttribute("format",format3,"audio/webm;codecs=opus",this._onChange),this._addAttribute("sampleRateHz",sampleRateHz,48e3,this._onChange),this._addAttribute("clock",clock,new Clock),this._addAttribute("autoLog",autoLog,autoLog),this._addAttribute("status",PsychoJS.Status.NOT_STARTED),this._prepareRecording(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}start(){if(this._status===PsychoJS.Status.PAUSED)return this.resume({clear:!0});if(this._status!==PsychoJS.Status.STARTED){this._psychoJS.logger.debug("request to start audio recording");try{if(!this._recorder)throw"the recorder has not been created yet, possibly because the participant has not given the authorisation to record audio";this._recorder.start();let self2=this;return new Promise((resolve4,reject2)=>{self2._startCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw this._psychoJS.logger.error("unable to start the audio recording: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Microphone.start",context:"when starting the audio recording for microphone: "+this._name,error}}}}stop({filename}={}){if(this._status===PsychoJS.Status.STARTED||this._status===PsychoJS.Status.PAUSED){this._psychoJS.logger.debug("request to stop audio recording"),this._stopOptions={filename},this._recorder.stop();let self2=this;return new Promise((resolve4,reject2)=>{self2._stopCallback=resolve4,self2._errorCallback=reject2})}}pause(){if(this._status===PsychoJS.Status.STARTED){this._psychoJS.logger.debug("request to pause audio recording");try{if(!this._recorder)throw"the recorder has not been created yet, possibly because the participant has not given the authorisation to record audio";this._recorder.pause();let self2=this;return new Promise((resolve4,reject2)=>{self2._pauseCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw self._psychoJS.logger.error("unable to pause the audio recording: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Microphone.pause",context:"when pausing the audio recording for microphone: "+this._name,error}}}}resume({clear=!1}={}){if(this._status===PsychoJS.Status.PAUSED){this._psychoJS.logger.debug("request to resume audio recording");try{if(!this._recorder)throw"the recorder has not been created yet, possibly because the participant has not given the authorisation to record audio";clear&&(this._audioBuffer=[],this._audioBuffer.length=0),this._recorder.resume();let self2=this;return new Promise((resolve4,reject2)=>{self2._resumeCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw self._psychoJS.logger.error("unable to resume the audio recording: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Microphone.resume",context:"when resuming the audio recording for microphone: "+this._name,error}}}}flush(){if(this._status===PsychoJS.Status.STARTED||this._status===PsychoJS.Status.PAUSED){this._psychoJS.logger.debug("request to flush audio recording"),this._recorder.requestData();let self2=this;return new Promise((resolve4,reject2)=>{self2._dataAvailableCallback=resolve4,self2._errorCallback=reject2})}}download(filename="audio.webm"){let audioBlob=new Blob(this._audioBuffer),anchor=document.createElement("a");anchor.href=window.URL.createObjectURL(audioBlob),anchor.download=filename,document.body.appendChild(anchor),anchor.click(),document.body.removeChild(anchor)}async upload({tag}={}){if(typeof tag=="undefined"&&(tag=this._name),tag+=extensionFromMimeType(this._format),this._psychoJS.getEnvironment()!==ExperimentHandler.Environment.SERVER||this._psychoJS.config.experiment.status!=="RUNNING"||this._psychoJS._serverMsg.has("__pilotToken"))return this.download(tag);let audioBlob=new Blob(this._audioBuffer);return this._psychoJS.serverManager.uploadAudioVideo({mediaBlob:audioBlob,tag})}async getRecording({tag,flush=!1}={}){return typeof tag=="undefined"&&(tag=this._name),new AudioClip({psychoJS:this._psychoJS,name:tag,format:this._format,sampleRateHz:this._sampleRateHz,data:new Blob(this._audioBuffer)})}_onChange(){this._status===PsychoJS.Status.STARTED&&this.stop(),this._prepareRecording(),this.start()}async _prepareRecording(){this._audioBuffer=[],this._recorder=null;let stream=await navigator.mediaDevices.getUserMedia({audio:{advanced:[{channelCount:1,sampleRate:this._sampleRateHz}]}}),options;typeof this._format=="string"&&MediaRecorder.isTypeSupported(this._format)?options={type:this._format}:this._psychoJS.logger.warn(`The specified audio format, ${this._format}, is not supported by this browser, using the default format instead`),this._recorder=new MediaRecorder(stream,options);let self2=this;this._recorder.onstart=()=>{self2._audioBuffer=[],self2._audioBuffer.length=0,self2._clock.reset(),self2._status=PsychoJS.Status.STARTED,self2._psychoJS.logger.debug("audio recording started"),self2._startCallback&&self2._startCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onpause=()=>{self2._status=PsychoJS.Status.PAUSED,self2._psychoJS.logger.debug("audio recording paused"),self2._pauseCallback&&self2._pauseCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onresume=()=>{self2._status=PsychoJS.Status.STARTED,self2._psychoJS.logger.debug("audio recording resumed"),self2._resumeCallback&&self2._resumeCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.ondataavailable=event=>{let data=event.data;self2._audioBuffer.push(data),self2._psychoJS.logger.debug("audio data added to the buffer"),self2._dataAvailableCallback&&self2._dataAvailableCallback(self2._psychoJS.monotonicClock.getTime())},this._recorder.onstop=()=>{self2._psychoJS.logger.debug("audio recording stopped"),self2._status=PsychoJS.Status.NOT_STARTED,self2._stopCallback&&self2._stopCallback(self2._psychoJS.monotonicClock.getTime()),typeof self2._stopOptions.filename=="string"&&self2.download(self2._stopOptions.filename)},this._recorder.onerror=event=>{self2._psychoJS.logger.error("audio recording error: "+JSON.stringify(event)),self2._status=PsychoJS.Status.ERROR}}};var Transcript=class{constructor(transcriber,text="",confidence=0){this.text=text,this.confidence=confidence,this.speechStart=transcriber._speechStart,this.speechEnd=transcriber._speechEnd,this.time=transcriber._recognitionTime}},SpeechRecognition=class extends PsychObject{constructor({psychoJS,name,bufferSize,continuous,lang,interimResults,maxAlternatives,tokens,clock,autoLog}={}){super(psychoJS);this._addAttribute("name",name,"speech recognition"),this._addAttribute("bufferSize",bufferSize,1e4),this._addAttribute("continuous",continuous,!0,this._onChange),this._addAttribute("lang",lang,"en-US",this._onChange),this._addAttribute("interimResults",interimResults,!1,this._onChange),this._addAttribute("maxAlternatives",maxAlternatives,1,this._onChange),this._addAttribute("tokens",tokens,[],this._onChange),this._addAttribute("clock",clock,new Clock),this._addAttribute("autoLog",!1,autoLog),this._addAttribute("status",PsychoJS.Status.NOT_STARTED),this._prepareRecognition(),this._autoLog&&this._psychoJS.experimentLogger.exp(`Created ${this.name} = ${this.toString()}`)}start(){if(this._status!==PsychoJS.Status.STARTED){this._psychoJS.logger.debug("request to start the speech recognition process");try{if(!this._recognition)throw"the speech recognition has not been initialised yet, possibly because the participant has not given the authorisation to record audio";this._recognition.start();let self2=this;return new Promise((resolve4,reject2)=>{self2._startCallback=resolve4,self2._errorCallback=reject2})}catch(error){throw this._psychoJS.logger.error("unable to start the speech to text transcription: "+JSON.stringify(error)),this._status=PsychoJS.Status.ERROR,{origin:"Transcriber.start",context:"when starting the speech to text transcription with transcriber: "+this._name,error}}}}stop(){if(this._status===PsychoJS.Status.STARTED){this._psychoJS.logger.debug("request to stop the speech recognition process"),this._recognition.stop();let self2=this;return new Promise((resolve4,reject2)=>{self2._stopCallback=resolve4,self2._errorCallback=reject2})}}getTranscripts({transcriptList=[],clear=!0}={}){if(this._bufferLength===0)return[];let filteredTranscripts=[],i=this._bufferLength===this._bufferSize?this._bufferIndex:-1;do{i=(i+1)%this._bufferSize;let transcript=this._circularBuffer[i];transcript&&(transcriptList.length===0||transcriptList.includes(transcript.text))&&(filteredTranscripts.push(transcript),clear&&(this._circularBuffer[i]=null))}while(i!==this._bufferIndex);return filteredTranscripts}clearTranscripts(){this._circularBuffer=new Array(this._bufferSize),this._bufferLength=0,this._bufferIndex=-1}_onChange(){this._status===PsychoJS.Status.STARTED&&this.stop(),this._prepareRecognition(),this.start()}_prepareRecognition(){this.clearTranscripts();let SpeechRecognition2=window.SpeechRecognition||window.webkitSpeechRecognition;if(this._recognition=new SpeechRecognition2,this._recognition.continuous=this._continuous,this._recognition.lang=this._lang,this._recognition.interimResults=this._interimResults,this._recognition.maxAlternatives=this._maxAlternatives,Array.isArray(this._tokens)&&this._tokens.length>0){let SpeechGrammarList=window.SpeechGrammarList||window.webkitSpeechGrammarList,name="NULL",grammar=`#JSGF V1.0; grammar ${name}; public <${name}> = ${this._tokens.join("|")};`,grammarList=new SpeechGrammarList;grammarList.addFromString(grammar,1),this._recognition.grammars=grammarList}let self2=this;this._recognition.onspeechstart=e=>{this._currentSpeechStart=this._clock.getTime(),self2._psychoJS.logger.debug("speech started")},this._recognition.onspeechend=()=>{this._currentSpeechEnd=this._clock.getTime(),self2._psychoJS.logger.debug("speech ended")},this._recognition.onstart=()=>{this._clock.reset(),this._status=PsychoJS.Status.STARTED,self2._psychoJS.logger.debug("speech recognition started"),self2._startCallback()&&self2._startCallback({time:self2._psychoJS.monotonicClock.getTime()})},this._recognition.onend=()=>{this._status=PsychoJS.Status.STOPPED,self2._psychoJS.logger.debug("speech recognition ended"),self2._stopCallback&&self2._stopCallback({time:self2._psychoJS.monotonicClock.getTime()})},this._recognition.onresult=event=>{if(this._recognitionTime=this._clock.getTime(),self2._status!==PsychoJS.Status.STARTED)return;let resultIndex=self2._continuous?event.resultIndex:0,alternativeIndex=0,results=event.results,text=results[resultIndex][alternativeIndex].transcript,confidence=results[resultIndex][alternativeIndex].confidence,transcript=new Transcript(self2,text,confidence);self2._bufferIndex=(self2._bufferIndex+1)%self2._bufferSize,self2._bufferLength=Math.min(self2._bufferLength+1,self2._bufferSize),self2._circularBuffer[self2._bufferIndex]=transcript,self2._psychoJS.logger.debug("speech recognition transcript: ",JSON.stringify(transcript))},this._recognition.onerror=event=>{event.error!=="no-speech"&&(self2._psychoJS.logger.error("speech recognition error: ",JSON.stringify(event)),self2._status=PsychoJS.Status.ERROR)}}};return src_exports;})();
//# sourceMappingURL=psychojs-2023.2.2.iife.js.map
